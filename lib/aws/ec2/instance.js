(function(){define(["constant","MC","Design"],function(e,t,n){var r,i,s,o,u,a,f,l,c;return r={"m1.large":!0,"m1.xlarge":!0,"m2.2xlarge":!0,"m2.4xlarge":!0,"m3.xlarge":!0,"m3.2xlarge":!0,"c1.xlarge":!0,"c3.xlarge":!0,"c3.2xlarge":!0,"c3.4xlarge":!0,"g2.2xlarge":!0,"i2.xlarge":!0,"i2.2xlarge":!0,"i2.4xlarge":!0},f=function(n,r){var i,s,o,u,a;a=t.canvas_data.component;for(s in a){o=a[s];if(o.type===e.AWS_RESOURCE_TYPE.AWS_VPC_NetworkInterface){i=o.resource.Attachment;if(i&&i.InstanceId&&i.InstanceId.indexOf(n)!==-1&&""+i.DeviceIndex!="0"){u=s;break}}}if(r>1){t.canvas.display(n,"instance-number-group",!0),t.canvas.display(n,"port-instance-rtb",!1),t.canvas.update(n,"text","instance-number",r),t.canvas.display(n,"instance-state",!1);if(u)return t.canvas.display(u,"eni-number-group",!0),t.canvas.update(u,"text","eni-number",r),t.canvas.display(u,"port-eni-rtb",!1)}else{t.canvas.display(n,"instance-number-group",!1),t.canvas.display(n,"instance-state",!0),t.canvas.display(n,"port-instance-rtb",!0);if(u)return t.canvas.display(u,"eni-number-group",!1),t.canvas.display(u,"port-eni-rtb",!0)}},i=function(e){return r.hasOwnProperty(e.get("InstanceType"))?e.get("cachedAmi").rootDeviceType==="instance-store"?!1:!0:!1},c=function(e){return t.canvas.getState()==="stack"?null:(e&&n.instance().get("id")===e&&t.canvas.updateInstanceState(),null)},u=function(e){var r,i;return t.data.resource_list&&(r=t.data.resource_list[n.instance().region()][e],r&&(i=r.instanceState.name)),i},l=function(e,r){var i,s,u;return t.canvas.getState()==="stack"?null:(e&&n.instance().get("id")===e&&(i=n.instance().serialize().component,u=void 0,s=void 0,$.each(i,function(e,t){var n;if(t.type==="AWS.EC2.Instance"&&t.number>1&&t.index===0){if(r===t.serverGroupUid||!r)n=o(i,t.serverGroupUid),n.length!==t.number?(Canvon("#"+e+"_instance-number-group").addClass("deleted"),Canvon("#"+e).addClass("deleted")):(Canvon("#"+e+"_instance-number-group").removeClass("deleted"),Canvon("#"+e).removeClass("deleted"));if(r===t.serverGroupUid)return!1}})),null)},o=function(e,r){var i;return i=[],e&&r&&$.each(e,function(e,s){var o,u;if(s.type==="AWS.EC2.Instance"&&s.serverGroupUid===r){u=s.resource.InstanceId,o=t.data.resource_list[n.instance().region()][u];if(u&&o&&o.instanceState.name!=="terminated"&&o.instanceState.name!=="shutting-down")return i.push(s.resource.InstanceId)}}),i},s=function(r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;l=n.instance().component(r),p={uid:null,mid:null};if(l)p.uid=r;else{S=n.modelClassForType(e.AWS_RESOURCE_TYPE.AWS_EC2_Instance).allObjects();for(d=0,y=S.length;d<y;d++){a=S[d];if(a.get("appId")===r){p.uid=a.id,p.mid=""+a.id+"_0",o=!0;break}if(a.groupMembers){x=a.groupMembers();for(u=v=0,b=x.length;v<b;u=++v){f=x[u];if(f&&f.appId===r){p.uid=a.id,p.mid=""+f.id+"_"+(u+1),o=!0;break}}}}if(!o){h=t.data.resource_list[n.instance().region()],T=n.modelClassForType(e.AWS_RESOURCE_TYPE.AWS_AutoScaling_Group).allObjects();for(m=0,w=T.length;m<w;m++){i=T[m],s=h[i.get("appId")];if(!s)continue;s=s.Instances,s.member&&(s=s.member);for(g=0,E=s.length;g<E;g++){c=s[g];if(c===r||c.InstanceId===r){p.uid=i.get("lc").id,p.mid=r;break}}}}}return p},a=function(e,n){return n.length===38?t.canvas.instanceList.selectById(e,n):t.canvas.asgList.selectById(e,n)},{updateCount:f,updateStateIcon:c,canSetEbsOptimized:i,getInstanceState:u,updateServerGroupState:l,getInstanceInServerGroup:o,getEffectiveId:s,resetSelectedinGroup:a}})}).call(this);