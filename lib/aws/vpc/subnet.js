(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["MC","constant","i18n!nls/lang.js"],function(t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;return y=function(e,t){var n,r,i,s;return n=t-e.length+1,r=_.map(function(){s=[];for(var e=1;1<=n?e<n:e>n;1<=n?e++:e--)s.push(e);return s}.apply(this),function(){return"0"}),e=r.join("")+e},b=function(e,t){var n,r,i,s;return n=t-e.length+1,r=_.map(function(){s=[];for(var e=1;1<=n?e<n:e>n;1<=n?e++:e--)s.push(e);return s}.apply(this),function(){return"0"}),e+=r.join("")},w=function(e){var t,n,r,i,s,o;return t=e.split("/"),n=t[0],o=Number(t[1]),s=32-o,r=n.split("."),i=_.map(r,function(e){return y(parseInt(e).toString(2),8)}),i.join("")},a=function(e){var t,n,r,i,s,o;return t=e.split("/"),n=t[0],o=Number(t[1]),r=n.split("."),i="",s="",o>23?(i=r[0]+"."+r[1]+"."+r[2]+".",s="x"):(i=r[0]+"."+r[1]+".",s="x.x"),[i,s]},u=function(e,t){var n,r,i,s,o,u;return u=Number(e.split("/")[1]),s=t.split("/"),o=Number(s[1]),i=s[0].split("."),n="",r="",u>23?(n=i[0]+"."+i[1]+"."+i[2]+".",r=i[3]+"/"+o):(n=i[0]+"."+i[1]+".",r=i[2]+"."+i[3]+"/"+o),[n,r]},v=function(e,t){var n,r,i,s,o;return n=w(e),i=w(t),r=Number(e.split("/")[1]),s=Number(t.split("/")[1]),r===0&&r===s?!0:(o=r,r>s&&(o=s),n.slice(0,o)===i.slice(0,o)&&o!==0?!0:!1)},m=function(e,n){var r,i,s,o;return i="",n?i=n:i=t.canvas_data.component[e].resource.CidrBlock,s=t.aws.subnet.getVPC(e),o=s.uid,r=!1,_.each(t.canvas_data.component,function(n){var s,u,a;if(n.type==="AWS.VPC.Subnet"){a=t.extractID(n.resource.VpcId),u=n.uid,s=n.resource.CidrBlock;if(a===o&&e!==u&&v(i,s))return r=!0,!1}return null}),r},d=function(e,n){var r,i;return t.aws.subnet.isSubnetConflict(e,n)?(i=Number(e.split("/")[1]),r=Number(n.split("/")[1]),r<i?!1:!0):!1},i=function(e,t){var n,r,i,s,o,u,a,f;return n=Math.ceil(Math.log(t)/Math.log(2)),u=Number(e.split("/")[1]),o=w(e),s=o.slice(0,u),i=u+n,r=[],_.each(function(){f=[];for(var e=0;0<=t?e<t:e>t;0<=t?e++:e--)f.push(e);return f}.apply(this),function(e){var t,o,u,a,f;return t=y(e.toString(2),n),a=b(s+t,32),o=_.map([0,8,16,24],function(e){return parseInt(a.slice(e,e+8),2)}),u=o.join("."),f=u+"/"+i,r.push(f),null}),r},s=function(e,t,n){var r,i,s,o,u,a,f,l,c;r=[],s=e.split("/"),o=s[0],u=Number(s[1]),c=o.split("."),i=Number(n.split("/")[1]);if(u===16||u===24&&i===u)a=c[0],f=c[1],l=c[2],_.each(t,function(e){var t,n,i,s,o;return n=e.split("/"),i=n[0],s=Number(n[1]),o=i.split("."),o[0]=a,o[1]=f,u===24&&(o[2]=l),t=o.join(".")+"/"+s,r.push(t),null});return r},l=function(e){var n,r;return n=t.canvas_data.component[e],r=t.extractID(n.resource.VpcId),r?t.canvas_data.component[r]:null},g=function(e,n,r){var i,s,o,u,a,f,l,c,h,p,d;u=!1,t.aws.aws.checkDefaultVPC()&&(u=!0),l=0,c="",s="",d="",a=[];if(u)s=e,p=t.aws.vpc.getAZSubnetForDefaultVPC(s),n&&(a=t.aws.eni.getAllNoAutoAssignIPInCIDR(s)),c=p.cidrBlock,l=t.aws.eni.getSubnetNeedIPCount(s);else{h=t.canvas_data.component[e];if(!h)return;d=t.aws.aws.genResRef(h.uid,"resource.SubnetId"),n&&(a=t.aws.eni.getAllNoAutoAssignIPInCIDR(d)),c=h.resource.CidrBlock,l=t.aws.eni.getSubnetNeedIPCount(h.uid)}return r&&_.isArray(r)&&(a=_.union(a,r)),o=t.aws.eni.getAvailableIPInCIDR(c,a,l),i=[],_.each(o,function(e){if(l===0)return!1;if(e.available)return l--,i.push(e.ip)}),f=0,_.each(t.canvas_data.component,function(e){var r;if(e.type!=="AWS.VPC.NetworkInterface")return;if(!u&&e.resource.SubnetId===d||u&&e.resource.AvailabilityZone===s)r=_.map(e.resource.PrivateIpAddressSet,function(e){var t,r;t=$.extend(!0,{},e);if(!n||(r=t.AutoAssign)===!0||r==="true")t.PrivateIpAddress=i[f++],t.AutoAssign=!0;return t}),t.canvas_data.component[e.uid].resource.PrivateIpAddressSet=r;return null}),null},o=function(e,i){var s,o,u,a,f,l,c,h,p;u=t.canvas_data.component[e],f=t.canvas_data.component[i].resource.AvailabilityZone,h=u.resource.Instances;for(l=0,c=h.length;l<c;l++){a=h[l];if(t.canvas_data.component[t.extractID(a.InstanceId)].resource.Placement.AvailabilityZone===f)return r.ide.CVS_MSG_ERR_DEL_ELB_LINE_2}p=t.canvas_data.component;for(o in p){s=p[o];if(s.type===n.AWS_RESOURCE_TYPE.AWS_AutoScaling_Group&&s.resource.LoadBalancerNames.join(" ").indexOf(e)!==-1&&s.resource.AvailabilityZones.join(" ").indexOf(f)!==-1)return r.ide.CVS_MSG_ERR_DEL_ELB_LINE_2}return!0},h=function(e){var n;return n=t.aws.aws.genResRef(e,"resource.SubnetId"),_.some(t.canvas_data.component,function(e,t){return e.type==="AWS.ELB"&&_.contains(e.resource.Subnets,n)})},f=function(){var e,n,r,i,s,o,u,a,f,l,c;return n=t.aws.vpc.getVPCUID(),e=t.canvas_data.component[n].resource.CidrBlock,a=e.split("/"),f=a[0],l=f.split("."),c=Number(a[1]),c!==16?null:(i=-1,_.each(t.canvas_data.component,function(e){var t,n,r,s,o,u;if(e.type==="AWS.VPC.Subnet"){n=e.resource.CidrBlock,r=n.split("/"),o=r[0],u=Number(r[1]),s=o.split("."),c===16&&(t=Number(s[2])),c===24&&(t=Number(s[3]));if(i<t)return i=t}}),u=i+1,u>255?null:(r=l,s="",c===16&&(r[2]=String(u),s="24"),o=r.join(".")+"/"+s,o))},c=function(e){var n,r;return r=t.canvas_data.component[e],n=+r.resource.CidrBlock.split("/")[1],console.log(r.resource.CidrBlock),console.log(n),n<=27?!0:!1},p=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,b,E,S,x,T,N,C,k,L;return c=n.split("/"),d=Number(c[1]),l=c[0].split("."),h=w(c[0]),p=h.slice(0,d),i=w(t),s=i.slice(0,d),o=i.slice(d),v=32-d,b=_.map(function(){k=[];for(var e=1,t=v+1;1<=t?e<t:e>t;1<=t?e++:e--)k.push(e);return k}.apply(this),function(){return"0"}),E=b.join(""),m=E.replace(/0/g,"1"),S=parseInt(E,2),g=parseInt(m,2),u=function(){L=[];for(var e=S,t=g+1;S<=t?e<t:e>t;S<=t?e++:e--)L.push(e);return L}.apply(this),a=u.length,f=!1,r=[],_.each(u,function(e,t){var n;return n=y(e.toString(2),v),(t===0||t===1||t===2||t===3||t===a-1)&&r.push(n),null}),e.call(r,o)>=0?!1:p===s?!0:!1},{genCIDRPrefixSuffix:a,isSubnetConflict:v,isInVPCCIDR:d,autoAssignAllCIDR:i,genCIDRDivAry:u,getVPC:l,updateAllENIIPList:g,isSubnetConflictInVPC:m,autoAssignSimpleCIDR:s,canDeleteSubnetToELBConnection:o,generateCIDRPossibile:f,isConnectToELB:h,isAbleConnectToELB:c,isIPInSubnet:p}})}).call(this);