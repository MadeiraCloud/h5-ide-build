(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["MC","jquery"],function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;return N=function(e,t){var n,r,i,s;return n=t-e.length+1,r=_.map(function(){s=[];for(var e=1;1<=n?e<n:e>n;1<=n?e++:e--)s.push(e);return s}.apply(this),function(){return"0"}),e=r.join("")+e},a=function(t,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;return u=t.split("/"),a=u[0],w=Number(u[1]),g=32-w,f=a.split("."),l=_.map(f,function(e){return N(parseInt(e).toString(2),8)}),h=l.join(""),c=h.slice(0,w),d=h.slice(w).replace(/1/g,"0"),p=d.replace(/0/g,"1"),m=parseInt(d,2),v=parseInt(p,2),s=[],o=0,y=function(){x=[];for(var e=m,t=v+1;m<=t?e<t:e>t;m<=t?e++:e--)x.push(e);return x}.apply(this),b=y.length,n.each(y,function(t,n){var u,a,f,l,h;f=c+N(n.toString(2),g),u=!0;if(t===0||t===1||t===2||t===3)u=!1;return t===b-1&&(u=!1),a=_.map([0,8,16,24],function(e){var t;return t=parseInt(f.slice(e,e+8),2),t}),h=a.join("."),e.call(r,h)>=0&&(u=!1),l={ip:h,available:u},s.push(l),u&&o++,o>i?!1:null}),console.log("availableIPCount: "+o),s},o=function(e,n){var r,i,s;return s=t.aws.aws.checkDefaultVPC(),r=t.canvas_data.component,i=[],_.each(r,function(t){var r,o,u;if(t.type==="AWS.VPC.NetworkInterface"){if(t.uid===n)return;o=t.resource.SubnetId,r=t.resource.AvailabilityZone;if(!s&&o===e||s&&r===e)u=t.resource.PrivateIpAddressSet,_.each(u,function(e){return i.push(e.PrivateIpAddress),null})}return null}),i},s=function(e){var n,r,i;return i=t.aws.aws.checkDefaultVPC(),n=t.canvas_data.component,r=[],_.each(n,function(t){var n,s,o;if(t.type==="AWS.VPC.NetworkInterface"){s=t.resource.SubnetId,n=t.resource.AvailabilityZone;if(!i&&s===e||i&&n===e)o=t.resource.PrivateIpAddressSet,_.each(o,function(e){var t;return((t=e.AutoAssign)==="false"||t===!1)&&r.push(e.PrivateIpAddress),null})}return null}),r},S=function(e,n){var r,i,s,o;return r=t.canvas_data.component[e],i=r.resource.Attachment.InstanceId,o=[],s=!0,_.each(n,function(e){var t,n,r,u,a;return u=e.ip,n=e.eip,t=e.auto,r="",n&&(r=i),a={Association:{IpOwnerId:"",AssociationID:"",InstanceId:r,PublicDnsName:"",AllocationID:"",PublicIp:""},PrivateIpAddress:u,AutoAssign:t,Primary:s},s=!1,o.push(a),null}),t.canvas_data.component[e].resource.PrivateIpAddressSet=o},i=function(e,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;return a=t.canvas_data.component[e],d=e,w="",r=[],f=t.aws.aws.checkDefaultVPC(),o="",f?(o=a.resource.AvailabilityZone,r=t.aws.eni.getAllOtherIPInCIDR(o,d)):(w=a.resource.SubnetId,r=t.aws.eni.getAllOtherIPInCIDR(w,d)),c=0,v=[],_.each(n,function(e){var t;return t=e.ip,t.slice(t.length-1)!=="x"?v.push(e.ip):c++}),l=r.concat(v),m="",f?(b=t.aws.vpc.getAZSubnetForDefaultVPC(o),m=b.cidrBlock):(y=t.extractID(w),g=t.canvas_data.component[y],m=g.resource.CidrBlock),h=0,f?h=t.aws.eni.getSubnetNeedIPCount(o):h=t.aws.eni.getSubnetNeedIPCount(y),u=t.aws.eni.getAvailableIPInCIDR(m,l,h),s=[],_.each(u,function(e){if(c===0)return!1;if(e.available)return c--,s.push(e.ip)}),p=[],i=0,_.each(n,function(e){var t,n,r;return r=e.ip,n=e.eip,r.slice(r.length-1)==="x"?(t=s[i++],p.push({ip:t,eip:n,auto:!0})):p.push({ip:r,eip:n,auto:!1}),null}),p},p=function(e){var n;return n=null,_.each(t.canvas_data.component,function(r){if(r.type==="AWS.VPC.NetworkInterface"&&r.resource.Attachment.DeviceIndex==="0"&&r.resource.Attachment.InstanceId===t.aws.aws.genResRef(e,"resource.InstanceId")){n=r;return}return null}),n},l=function(e,t){var n,r,i,s;return s=Number(e.split("/")[1]),n=t.split("."),r="",i="",s>23?(r=n[0]+"."+n[1]+"."+n[2]+".",i=n[3]):(r=n[0]+"."+n[1]+".",i=n[2]+"."+n[3]),[r,i]},v=function(e){var n,r,i;return n=t.canvas_data.component[e],i=n.resource.SubnetId,r=t.extractID(i),t.canvas_data.component[r]},m=function(e){var n,r,i,s;return r=!1,t.aws.aws.checkDefaultVPC()&&(r=!0),i=0,s="",n="",r?n=e:s=t.aws.aws.genResRef(e,"resource.SubnetId"),_.each(t.canvas_data.component,function(e){return e.type==="AWS.VPC.NetworkInterface"&&(!r&&e.resource.SubnetId===s||r&&e.resource.AvailabilityZone===n)&&(i+=e.resource.PrivateIpAddressSet.length),null}),i},r=function(e,n){return t.canvas.display(e,"eni-number-group",n)},h=function(e){var n,r,i,s,o,u,a,f;n=t.canvas_data.component[e];if(!n)return 0;u="";if(n.type==="AWS.VPC.NetworkInterface"){a=n.resource.Attachment.InstanceId;if(!a)return 0;u=t.extractID(a)}else u=e;return i=t.canvas_data.component[u],s=i.resource.InstanceType,o=s.split("."),!o[0]||!o[1]?0:(f=t.data.config[t.canvas_data.region].instance_type,f?(r=f[o[0]][o[1]].ip_per_eni,r?r:0):0)},E=function(e){var n,r,i,s,o,u,a;n=t.aws.eni.getENIMaxIPNum(e),i=t.canvas_data.component[e];if(!i)return;return s="",i.type==="AWS.VPC.NetworkInterface"?(s=i.uid,u=i.resource.PrivateIpAddressSet):(r=t.aws.eni.getInstanceDefaultENI(e),s=r.uid,u=r.resource.PrivateIpAddressSet),o=0,a=_.filter(u,function(e){return o++,o>n&&n!==0?!1:!0}),t.canvas_data.component[s].resource.PrivateIpAddressSet=a},w=function(e){return _.each(t.canvas_data.component,function(n){var r,i;if(n.type==="AWS.VPC.NetworkInterface"){i=n.resource.Attachment.InstanceId;if(!i)return;r=t.extractID(i),r===e&&t.aws.eni.reduceIPNumByInstanceType(n.uid)}return null})},b=function(){return _.each(t.canvas_data.component,function(e){return e.type==="AWS.VPC.NetworkInterface"&&_.each(e.resource.PrivateIpAddressSet,function(e){return e.AutoAssign=!1}),null})},g=function(e,n){var r;return r=!1,_.each(t.canvas_data.component,function(t){var i;return t.type==="AWS.VPC.NetworkInterface"&&(i=t.resource.PrivateIpAddressSet,_.each(i,function(i,s){var o,u;if(t.uid!==n){if((u=i.AutoAssign)===!1||u==="false")o=i.PrivateIpAddress,o===e&&(r=!0);return null}})),null}),r},x=function(e){var n;return n=t.aws.aws.genResRef(e,"resource.InstanceId"),_.each(t.canvas_data.component,function(e){var r,i;return e.type==="AWS.VPC.NetworkInterface"&&e.resource.Attachment.InstanceId===n&&(r=e.resource.PrivateIpAddressSet,i=_.map(r,function(e){return e.AutoAssign=!0,e}),t.canvas_data.component[e.uid].resource.PrivateIpAddressSet=i),null})},u=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;return n=e.split("/"),r=n[0],p=Number(n[1]),h=32-p,i=r.split("."),s=_.map(i,function(e){return N(parseInt(e).toString(2),8)}),u=s.join(""),o=u.slice(0,p),f=u.slice(p).replace(/1/g,"0"),a=f.replace(/0/g,"1"),c=parseInt(f,2),l=parseInt(a,2),t=l-c+1-5,t<0&&(t=0),t},d=function(e){return t.extractID(e.resource.Attachment.InstanceId)},T=function(e,r){var i,s,o;return t.canvas.getState()==="stack"?null:(e&&Design.instance().get("id")===e&&(i=Design.instance().serialize().component,o=void 0,s=void 0,n.each(i,function(e,n){var u,a,f;if(n.type==="AWS.VPC.NetworkInterface"&&n.index===0&&n.serverGroupUid){f=d(n),u=i[f];if(!(f&&u&&u.number>1))return o=n.resource.NetworkInterfaceId,s=t.data.resource_list[Design.instance().region()][o],s?Canvon("#"+e).removeClass("deleted"):Canvon("#"+e).addClass("deleted");if(r===n.serverGroupUid||!r)return a=c(i,n.serverGroupUid),a.length!==u.number?(Canvon("#"+e+"_eni-number-group").addClass("deleted"),Canvon("#"+e).addClass("deleted")):(Canvon("#"+e+"_eni-number-group").removeClass("deleted"),Canvon("#"+e).removeClass("deleted"))}})),null)},c=function(e,r){var i;return i=[],e&&r&&n.each(e,function(e,n){var s,o;if(n.type==="AWS.VPC.NetworkInterface"&&n.serverGroupUid===r){o=n.resource.NetworkInterfaceId,s=t.data.resource_list[Design.instance().region()][o];if(o&&s)return i.push(n.resource.NetworkInterfaceId)}}),i},f=function(e){var n;return n=t.data.resource_list[Design.instance().region()][e],n},y=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;return n=!0,t=e.split("."),i=[1,0,0,1],r=[126,255,255,254],o=[128,1,0,1],s=[191,254,255,254],a=[192,0,1,1],u=[223,255,254,254],l=[10,0,0,0],f=[10,255,255,255],h=[172,16,0,0],c=[172,31,255,255],d=[192,168,0,0],p=[192,168,255,255],t[0]>=l[0]&&t[1]>=l[1]&&t[2]>=l[2]&&t[3]>=l[3]&&t[0]<=f[0]&&t[1]<=f[1]&&t[2]<=f[2]&&t[3]<=f[3]&&(n=!1),t[0]>=h[0]&&t[1]>=h[1]&&t[2]>=h[2]&&t[3]>=h[3]&&t[0]<=c[0]&&t[1]<=c[1]&&t[2]<=c[2]&&t[3]<=c[3]&&(n=!1),t[0]>=d[0]&&t[1]>=d[1]&&t[2]>=d[2]&&t[3]>=d[3]&&t[0]<=p[0]&&t[1]<=p[1]&&t[2]<=p[2]&&t[3]<=p[3]&&(n=!1),n},{markAutoAssginFalse:b,getAvailableIPInCIDR:a,getAllOtherIPInCIDR:o,saveIPList:S,generateIPList:i,getInstanceDefaultENI:p,getENIDivIPAry:l,getSubnetComp:v,getSubnetNeedIPCount:m,displayENINumber:r,getENIMaxIPNum:h,reduceIPNumByInstanceType:E,reduceAllENIIPList:w,getAllNoAutoAssignIPInCIDR:s,haveIPConflictWithOtherENI:g,updateAllInstanceENIIPToAutoAssign:x,getAvailableIPCountInCIDR:u,updateServerGroupState:T,getENIInServerGroup:c,getInstanceIdOfENI:d,getENIById:f,isPublicIPAddress:y}})}).call(this);