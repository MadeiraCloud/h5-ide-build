var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["MC","constant","underscore","jquery","Design","i18n!/nls/lang.js","OpsModel"],function(e,t,n,r,i,s,o){var u,a,f,l,c;l=function(e){var r;return r={parent:null,self:null},i.instance().eachComponent(function(i){var s,o,u;s=i.groupMembers&&i.groupMembers(),(r.parent||r.self)&&null;if(i.get("appId")===e)return s&&s.length?(r.parent=i,r.self=new Backbone.Model({name:""+i.get("name")+"-0"})):r.self=i,null;if(s&&__indexOf.call(n.pluck(s,"appId"),e)>=0){if(i.type===t.RESTYPE.LC)r.parent=i.parent();else{r.parent=i;for(o in s){u=s[o];if(u.appId===e){r.self=new Backbone.Model({name:""+i.get("name")+"-"+(+o+1)});break}}}return null}}),r},u=function(r,i,s){var o;return o=!1,n.each(r,function(n){var r,u,a,f;return n.type===t.RESTYPE.EIP&&(u=n.resource.NetworkInterfaceId,r=e.extractID(u),i===r&&(f=n.resource.PrivateIpAddress.split("."),a=f[3],Number(a)===s&&(o=!0))),null}),o},f=function(s,u){var a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;k=[];if(i.instance().type()!==o.Type.OpenStack){A=function(){var e,t;return e=r("#OpsEditor g.AWS-AutoScaling-LaunchConfiguration.selected").parent("g.AWS-AutoScaling-Group"),t=e.data("id"),t?App.sceneManager.activeScene().getAwakeSpace().view.canvas.getItem(t).model:null};if(s.type===t.RESTYPE.ASG){C=s.resource.LaunchConfigurationName;if(C){N=e.extractID(C),s=u[N];if(!s)return null}}m=s.uid,v=s.type,b=!1,d=null,v===t.RESTYPE.LC&&(b=!0),w=!1,E=!1,y=null,g=null,s.number&&(s.number>1?(w=!0,g=s.serverGroupName):(E=!0,y=s.serverGroupName)),u=u||this.get("allCompData"),h=[],p=t.STATE_REF_DICT,n.each(u,function(r,i){var s,o,a,f,l,c,g,y,b,w,E,S;l=r.name,g=r.uid,c=r.type,f=!1,g===m&&(l="self"),c===t.RESTYPE.ASG&&(C=r.resource.LaunchConfigurationName,C&&(N=e.extractID(C),w=u[N],v===t.RESTYPE.LC&&m===N&&(o=A(),o&&o.get("id")===g&&(d=l,l="self")),w.resource.AssociatePublicIpAddress&&(s=!0)));if(c===t.RESTYPE.INSTANCE)return;if(c===t.RESTYPE.ENI){if(r.index!==0)return;if(r.serverGroupUid!==g)return;y=r.resource.Attachment.InstanceId;if(!y)return;if((S=r.resource.Attachment.DeviceIndex)==="0"||S===0)b=e.extractID(y),b&&(l=u[b].serverGroupName,g=b,b===m&&(l="self"))}return E=c.replace(/\./ig,"_"),a=p[E],a&&n.each(a,function(i,o){var a,f,p,d,v;f=l+".",a=g+".";if(o==="__array")return;f+=o,a+=o,d=!1;if(o==="PublicIp"){if(c===t.RESTYPE.ASG&&!s)return;c===t.RESTYPE.ENI&&!e.aws.aws.checkPrivateIPIfHaveEIP(u,r.uid,0)&&!r.resource.AssociatePublicIpAddress&&(d=!0)}d||h.push({name:f,value:a,uid:g});if(i){E==="AWS_AutoScaling_Group"&&o==="AvailabilityZones"&&(p=r.resource.AvailabilityZones,p.length>1&&n.each(p,function(e,t){return h.push({name:f+"["+t+"]",value:a+"["+t+"]",uid:g}),null}));if(E==="AWS_VPC_NetworkInterface")if(o==="PublicDnsName"||o==="PublicIp"||o==="PrivateDnsName"||o==="PrivateIpAddress"){v=r.resource.PrivateIpAddressSet;if(r.index!==0)return;v.length>1&&n.each(v,function(t,n){if(o==="PublicIp"&&!e.aws.aws.checkPrivateIPIfHaveEIP(u,r.uid,n))return;return h.push({name:f+"["+n+"]",value:a+"["+n+"]",uid:g}),null})}E==="AWS_ELB"&&o==="AvailabilityZones"&&(p=r.resource.AvailabilityZones,p.length>1&&n.each(p,function(e,t){return h.push({name:f+"["+t+"]",value:a+"["+t+"]",uid:g}),null}))}return null}),null}),x=[],T=[],n.each(h,function(e){var t,n,r,i;if(e.name.indexOf("self.")===0){E&&(r=e.name.replace("self",y),i=e.value.replace("self",y),T.push({name:r,value:i,uid:e.uid}));if(b||w)return t=null,n=null,b?(t=e.name.replace("self",d),n=e.value.replace("self",d)):w&&(t=e.name.replace("self",g),n=e.value.replace("self",g)),x.push({name:t,value:n,uid:e.uid})}}),h=h.concat(x),h=h.concat(T),k=n.map(h,function(e){return e.name.indexOf("self.")===0&&(e.value=e.value.replace(e.uid,"self"),e.uid="self"),{name:""+e.name,value:""+e.name,ref:""+e.value,uid:""+e.uid}}),a=n.map(k,function(e){return e.name}),n.each(["self.PrivateIpAddress","self.MacAddress","self.PublicIp"],function(e){if(__indexOf.call(a,e)<0)return k.push({name:""+e,value:""+e,ref:""+e,uid:"self"})}),k=n.filter(k,function(e){return e.name.indexOf("self.")===0?e.name.indexOf(".AvailabilityZones")!==-1?!1:!0:!0}),k=k.sort(function(e,t){if(e.name<t.name)return-1;if(e.name>t.name)return 1})}else m=s.uid,S=i.instance().component(m),L=function(e,t,n){return{name:""+e+"."+n,ref:""+t+"."+n,uid:""+t+"."+n,value:""+e+"."+n}},l=i.modelClassForType(t.RESTYPE.OSPORT).allObjects(),n.each(l,function(e){var t,n,r,i;n=e.get("name"),e.isEmbedded()&&(n=(i=e.owner())!=null?i.get("name"):void 0),r=e.id;if(!n||!r)return;k=k.concat([L(n,r,"ip_address"),L(n,r,"mac_address")]),t=e.getFloatingIp();if(t)return r=t.id,k=k.concat([L(n,r,"public_ip")])}),f=i.modelClassForType(t.RESTYPE.OSLISTENER).allObjects(),n.each(f,function(e){var t,n,r;n=e.get("name"),r=e.id,k=k.concat([L(n,r,"ip_address"),L(n,r,"mac_address"),L(n,r,"protocol"),L(n,r,"port")]),t=e.getFloatingIp();if(t)return r=t.id,k=k.concat([L(n,r,"public_ip")])}),c=i.modelClassForType(t.RESTYPE.OSSUBNET).allObjects(),n.each(c,function(e){var t,n;return t=e.get("name"),n=e.id,k=k.concat([L(t,n,"cidr")])});return k},c=function(e,t){var r,i,s,o,u;return u=[{low:"1.0.0.1",high:"126.255.255.254"},{low:"128.1.0.1",high:"191.254.255.254"},{low:"192.0.1.1",high:"223.255.254.254"}],o=[{low:"10.0.0.0",high:"10.255.255.255"},{low:"172.16.0.0",high:"172.31.255.255"},{low:"192.168.0.0",high:"192.168.255.255"}],i=function(e,t,r){var i,s,o,u;return s=e.split("."),o=t.split("."),i=r.split("."),u=!0,n.each(i,function(e,t){return Number(i[t])>=Number(s[t])&&Number(i[t])<=Number(o[t])||(u=!1),null}),u},r=[],t==="public"?r=u:t==="private"&&(r=o),s=!1,n.each(r,function(t){var n,r,o;return o=t.low,n=t.high,r=i(o,n,e),r&&(s=!0),null}),s},a=function(t,n,o){var u,a,f,l,c;return a=function(e,t){var n,r;return void 0,n=i.instance().component(e),n.get("name")===t?!1:(r=!1,i.instance().eachComponent(function(e){if(e.get("name")===t)return r=!0,!1}),r)},f=function(e,t){var n,r;return r=i.instance(),n=r.component(e),n?r.isPreservedName(n.type,t):!1},l=function(e){var t;t=!1;if(e==="self"||e==="this"||e==="global"||e==="meta"||e==="madeira")t=!0;return t},n.length||(n=r(n)),c=n.val(),o||(o=c),c&&!e.validate("awsName",c)&&(u=sprintf(s.PARSLEY.THIS_VALUE_SHOULD_BE_A_VALID_TYPE_NAME,o)),!u&&a(t,c)&&(u=sprintf(s.PARSLEY.TYPE_NAME_CONFLICT,o,c)),!u&&f(t,c)&&(u=sprintf(s.PARSLEY.TYPE_NAME_CONFLICT,o,c)),!u&&l(c)&&(u=sprintf(s.PARSLEY.TYPE_NAME_CONFLICT,o,c)),c.indexOf("elbsg-")===0&&(u=s.PARSLEY.RESOURCE_NAME_ELBSG_RESERVED),n.parsley("custom",function(){return u}),n.parsley("validate")},e.aws={},e.aws.aws={getCompByResIdForState:l,genAttrRefList:f,isValidInIPRange:c,checkPrivateIPIfHaveEIP:u,checkResName:a}});