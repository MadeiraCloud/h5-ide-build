(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["MC","constant","underscore","jquery","Design","i18n!/nls/lang.js"],function(t,n,r,i,s,o){var u,a,f,l,c;l=function(t){var i;return i={parent:null,self:null},s.instance().eachComponent(function(s){var o,u,a;o=s.groupMembers&&s.groupMembers(),(i.parent||i.self)&&null;if(s.get("appId")===t)return o&&o.length?(i.parent=s,i.self=new Backbone.Model({name:""+s.get("name")+"-0"})):i.self=s,null;if(o&&e.call(r.pluck(o,"appId"),t)>=0){if(s.type===n.RESTYPE.LC)i.parent=s.parent();else{i.parent=s;for(u in o){a=o[u];if(a.appId===t){i.self=new Backbone.Model({name:""+s.get("name")+"-"+(+u+1)});break}}}return null}}),i},u=function(e,i,s){var o;return o=!1,r.each(e,function(e){var r,u,a,f;return e.type===n.RESTYPE.EIP&&(u=e.resource.NetworkInterfaceId,r=t.extractID(u),i===r&&(f=e.resource.PrivateIpAddress.split("."),a=f[3],Number(a)===s&&(o=!0))),null}),o},f=function(o,u){var a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;d=s.instance().get("cloud_type"),L=[];if(d==="aws"){O=function(){var e,t;return e=i("#OpsEditor g.AWS-AutoScaling-LaunchConfiguration.selected").parent("g.AWS-AutoScaling-Group"),t=e.data("id"),t?App.workspaces.getAwakeSpace().view.canvas.getItem(t).model:null};if(o.type===n.RESTYPE.ASG){k=o.resource.LaunchConfigurationName;if(k){C=t.extractID(k),o=u[C];if(!o)return null}}g=o.uid,m=o.type,w=!1,v=null,m===n.RESTYPE.LC&&(w=!0),E=!1,S=!1,b=null,y=null,o.number&&(o.number>1?(E=!0,y=o.serverGroupName):(S=!0,b=o.serverGroupName)),u=u||this.get("allCompData"),h=[],p=n.STATE_REF_DICT,r.each(u,function(e,i){var s,o,a,f,l,c,d,y,b,w,E,S;l=e.name,d=e.uid,c=e.type,f=!1,d===g&&(l="self"),c===n.RESTYPE.ASG&&(k=e.resource.LaunchConfigurationName,k&&(C=t.extractID(k),w=u[C],m===n.RESTYPE.LC&&g===C&&(o=O(),o&&o.get("id")===d&&(v=l,l="self")),w.resource.AssociatePublicIpAddress&&(s=!0)));if(c===n.RESTYPE.INSTANCE)return;if(c===n.RESTYPE.ENI){if(e.index!==0)return;if(e.serverGroupUid!==d)return;y=e.resource.Attachment.InstanceId;if(!y)return;if((S=e.resource.Attachment.DeviceIndex)==="0"||S===0)b=t.extractID(y),b&&(l=u[b].serverGroupName,d=b,b===g&&(l="self"))}return E=c.replace(/\./ig,"_"),a=p[E],a&&r.each(a,function(i,o){var a,f,p,v,m;f=l+".",a=d+".";if(o==="__array")return;f+=o,a+=o,v=!1;if(o==="PublicIp"){if(c===n.RESTYPE.ASG&&!s)return;c===n.RESTYPE.ENI&&!t.aws.aws.checkPrivateIPIfHaveEIP(u,e.uid,0)&&!e.resource.AssociatePublicIpAddress&&(v=!0)}v||h.push({name:f,value:a,uid:d});if(i){E==="AWS_AutoScaling_Group"&&o==="AvailabilityZones"&&(p=e.resource.AvailabilityZones,p.length>1&&r.each(p,function(e,t){return h.push({name:f+"["+t+"]",value:a+"["+t+"]",uid:d}),null}));if(E==="AWS_VPC_NetworkInterface")if(o==="PublicDnsName"||o==="PublicIp"||o==="PrivateDnsName"||o==="PrivateIpAddress"){m=e.resource.PrivateIpAddressSet;if(e.index!==0)return;m.length>1&&r.each(m,function(n,r){if(o==="PublicIp"&&!t.aws.aws.checkPrivateIPIfHaveEIP(u,e.uid,r))return;return h.push({name:f+"["+r+"]",value:a+"["+r+"]",uid:d}),null})}E==="AWS_ELB"&&o==="AvailabilityZones"&&(p=e.resource.AvailabilityZones,p.length>1&&r.each(p,function(e,t){return h.push({name:f+"["+t+"]",value:a+"["+t+"]",uid:d}),null}))}return null}),null}),T=[],N=[],r.each(h,function(e){var t,n,r,i;if(e.name.indexOf("self.")===0){S&&(r=e.name.replace("self",b),i=e.value.replace("self",b),N.push({name:r,value:i,uid:e.uid}));if(w||E)return t=null,n=null,w?(t=e.name.replace("self",v),n=e.value.replace("self",v)):E&&(t=e.name.replace("self",y),n=e.value.replace("self",y)),T.push({name:t,value:n,uid:e.uid})}}),h=h.concat(T),h=h.concat(N),L=r.map(h,function(e){return e.name.indexOf("self.")===0&&(e.value=e.value.replace(e.uid,"self"),e.uid="self"),{name:""+e.name,value:""+e.name,ref:""+e.value,uid:""+e.uid}}),a=r.map(L,function(e){return e.name}),r.each(["self.PrivateIpAddress","self.MacAddress","self.PublicIp"],function(t){if(e.call(a,t)<0)return L.push({name:""+t,value:""+t,ref:""+t,uid:"self"})}),L=r.filter(L,function(e){return e.name.indexOf("self.")===0?e.name.indexOf(".AvailabilityZones")!==-1?!1:!0:!0}),L=L.sort(function(e,t){if(e.name<t.name)return-1;if(e.name>t.name)return 1})}else g=o.uid,x=s.instance().component(g),A=function(e,t,n){return{name:""+e+"."+n,ref:""+t+"."+n,uid:""+t+"."+n,value:""+e+"."+n}},l=s.modelClassForType(n.RESTYPE.OSPORT).allObjects(),r.each(l,function(e){var t,n,r,i;n=e.get("name"),e.isEmbedded()&&(n=(i=e.owner())!=null?i.get("name"):void 0),r=e.id;if(!n||!r)return;L=L.concat([A(n,r,"ip_address"),A(n,r,"mac_address")]),t=e.getFloatingIp();if(t)return r=t.id,L=L.concat([A(n,r,"public_ip")])}),f=s.modelClassForType(n.RESTYPE.OSLISTENER).allObjects(),r.each(f,function(e){var t,n;return t=e.get("name"),n=e.id,L=L.concat([A(t,n,"cidr"),A(t,n,"protocol"),A(t,n,"port")])}),c=s.modelClassForType(n.RESTYPE.OSSUBNET).allObjects(),r.each(c,function(e){var t,n;return t=e.get("name"),n=e.id,L=L.concat([A(t,n,"ip_address"),A(t,n,"gateway_ip")])});return L},c=function(e,t){var n,i,s,o,u;return u=[{low:"1.0.0.1",high:"126.255.255.254"},{low:"128.1.0.1",high:"191.254.255.254"},{low:"192.0.1.1",high:"223.255.254.254"}],o=[{low:"10.0.0.0",high:"10.255.255.255"},{low:"172.16.0.0",high:"172.31.255.255"},{low:"192.168.0.0",high:"192.168.255.255"}],i=function(e,t,n){var i,s,o,u;return s=e.split("."),o=t.split("."),i=n.split("."),u=!0,r.each(i,function(e,t){return Number(i[t])>=Number(s[t])&&Number(i[t])<=Number(o[t])||(u=!1),null}),u},n=[],t==="public"?n=u:t==="private"&&(n=o),s=!1,r.each(n,function(t){var n,r,o;return o=t.low,n=t.high,r=i(o,n,e),r&&(s=!0),null}),s},a=function(e,n,r){var u,a,f,l,c;return a=function(e,t){var n,r;return void 0,n=s.instance().component(e),n.get("name")===t?!1:(r=!1,s.instance().eachComponent(function(e){if(e.get("name")===t)return r=!0,!1}),r)},f=function(e,t){var n,r;return r=s.instance(),n=r.component(e),n?r.isPreservedName(n.type,t):!1},l=function(e){var t;t=!1;if(e==="self"||e==="this"||e==="global"||e==="meta"||e==="madeira")t=!0;return t},n.length||(n=i(n)),c=n.val(),r||(r=c),c&&!t.validate("awsName",c)&&(u=sprintf(o.PARSLEY.THIS_VALUE_SHOULD_BE_A_VALID_TYPE_NAME,r)),!u&&a(e,c)&&(u=sprintf(o.PARSLEY.TYPE_NAME_CONFLICT,r,c)),!u&&f(e,c)&&(u=sprintf(o.PARSLEY.TYPE_NAME_CONFLICT,r,c)),!u&&l(c)&&(u=sprintf(o.PARSLEY.TYPE_NAME_CONFLICT,r,c)),c.indexOf("elbsg-")===0&&(u=o.PARSLEY.RESOURCE_NAME_ELBSG_RESERVED),n.parsley("custom",function(){return u}),n.parsley("validate")},t.aws={},t.aws.aws={getCompByResIdForState:l,genAttrRefList:f,isValidInIPRange:c,checkPrivateIPIfHaveEIP:u,checkResName:a}})}).call(this);