(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["MC","constant","underscore","jquery","Design","i18n!/nls/lang.js"],function(t,n,r,i,s,o){var u,a,f,l,c;l=function(t){var i;return i={parent:null,self:null},s.instance().eachComponent(function(s){var o,u,a;o=s.groupMembers&&s.groupMembers(),(i.parent||i.self)&&null;if(s.get("appId")===t)return o&&o.length?(i.parent=s,i.self=new Backbone.Model({name:""+s.get("name")+"-0"})):i.self=s,null;if(o&&e.call(r.pluck(o,"appId"),t)>=0){if(s.type===n.RESTYPE.LC)i.parent=s.parent();else{i.parent=s;for(u in o){a=o[u];if(a.appId===t){i.self=new Backbone.Model({name:""+s.get("name")+"-"+(+u+1)});break}}}return null}}),i},u=function(e,i,s){var o;return o=!1,r.each(e,function(e){var r,u,a,f;return e.type===n.RESTYPE.EIP&&(u=e.resource.NetworkInterfaceId,r=t.extractID(u),i===r&&(f=e.resource.PrivateIpAddress.split("."),a=f[3],Number(a)===s&&(o=!0))),null}),o},f=function(s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;x=function(){var e,t;return e=i("#OpsEditor g.AWS-AutoScaling-LaunchConfiguration.selected").parent("g.AWS-AutoScaling-Group"),t=e.data("id"),t?App.workspaces.getAwakeSpace().view.canvas.getItem(t).model:null};if(s.type===n.RESTYPE.ASG){E=s.resource.LaunchConfigurationName;if(E){w=t.extractID(E),s=o[w];if(!s)return null}}return h=s.uid,c=s.type,v=!1,l=null,c===n.RESTYPE.LC&&(v=!0),m=!1,g=!1,d=null,p=null,s.number&&(s.number>1?(m=!0,p=s.serverGroupName):(g=!0,d=s.serverGroupName)),o=o||this.get("allCompData"),a=[],f=n.STATE_REF_DICT,r.each(o,function(e,i){var s,u,p,d,v,m,g,y,b,S,T,N;v=e.name,g=e.uid,m=e.type,d=!1,g===h&&(v="self"),m===n.RESTYPE.ASG&&(E=e.resource.LaunchConfigurationName,E&&(w=t.extractID(E),S=o[w],c===n.RESTYPE.LC&&h===w&&(u=x(),u&&u.get("id")===g&&(l=v,v="self")),S.resource.AssociatePublicIpAddress&&(s=!0)));if(m===n.RESTYPE.INSTANCE)return;if(m===n.RESTYPE.ENI){if(e.index!==0)return;if(e.serverGroupUid!==g)return;y=e.resource.Attachment.InstanceId;if(!y)return;if((N=e.resource.Attachment.DeviceIndex)==="0"||N===0)b=t.extractID(y),b&&(v=o[b].serverGroupName,g=b,b===h&&(v="self"))}return T=m.replace(/\./ig,"_"),p=f[T],p&&r.each(p,function(i,u){var f,l,c,h,p;l=v+".",f=g+".";if(u==="__array")return;l+=u,f+=u,h=!1;if(u==="PublicIp"){if(m===n.RESTYPE.ASG&&!s)return;m===n.RESTYPE.ENI&&!t.aws.aws.checkPrivateIPIfHaveEIP(o,e.uid,0)&&!e.resource.AssociatePublicIpAddress&&(h=!0)}h||a.push({name:l,value:f,uid:g});if(i){T==="AWS_AutoScaling_Group"&&u==="AvailabilityZones"&&(c=e.resource.AvailabilityZones,c.length>1&&r.each(c,function(e,t){return a.push({name:l+"["+t+"]",value:f+"["+t+"]",uid:g}),null}));if(T==="AWS_VPC_NetworkInterface")if(u==="PublicDnsName"||u==="PublicIp"||u==="PrivateDnsName"||u==="PrivateIpAddress"){p=e.resource.PrivateIpAddressSet;if(e.index!==0)return;p.length>1&&r.each(p,function(n,r){if(u==="PublicIp"&&!t.aws.aws.checkPrivateIPIfHaveEIP(o,e.uid,r))return;return a.push({name:l+"["+r+"]",value:f+"["+r+"]",uid:g}),null})}T==="AWS_ELB"&&u==="AvailabilityZones"&&(c=e.resource.AvailabilityZones,c.length>1&&r.each(c,function(e,t){return a.push({name:l+"["+t+"]",value:f+"["+t+"]",uid:g}),null}))}return null}),null}),y=[],b=[],r.each(a,function(e){var t,n,r,i;if(e.name.indexOf("self.")===0){g&&(r=e.name.replace("self",d),i=e.value.replace("self",d),b.push({name:r,value:i,uid:e.uid}));if(v||m)return t=null,n=null,v?(t=e.name.replace("self",l),n=e.value.replace("self",l)):m&&(t=e.name.replace("self",p),n=e.value.replace("self",p)),y.push({name:t,value:n,uid:e.uid})}}),a=a.concat(y),a=a.concat(b),S=r.map(a,function(e){return e.name.indexOf("self.")===0&&(e.value=e.value.replace(e.uid,"self"),e.uid="self"),{name:""+e.name,value:""+e.name,ref:""+e.value,uid:""+e.uid}}),u=r.map(S,function(e){return e.name}),r.each(["self.PrivateIpAddress","self.MacAddress","self.PublicIp"],function(t){if(e.call(u,t)<0)return S.push({name:""+t,value:""+t,ref:""+t,uid:"self"})}),S=r.filter(S,function(e){return e.name.indexOf("self.")===0?e.name.indexOf(".AvailabilityZones")!==-1?!1:!0:!0}),S=S.sort(function(e,t){if(e.name<t.name)return-1;if(e.name>t.name)return 1}),S},c=function(e,t){var n,i,s,o,u;return u=[{low:"1.0.0.1",high:"126.255.255.254"},{low:"128.1.0.1",high:"191.254.255.254"},{low:"192.0.1.1",high:"223.255.254.254"}],o=[{low:"10.0.0.0",high:"10.255.255.255"},{low:"172.16.0.0",high:"172.31.255.255"},{low:"192.168.0.0",high:"192.168.255.255"}],i=function(e,t,n){var i,s,o,u;return s=e.split("."),o=t.split("."),i=n.split("."),u=!0,r.each(i,function(e,t){return Number(i[t])>=Number(s[t])&&Number(i[t])<=Number(o[t])||(u=!1),null}),u},n=[],t==="public"?n=u:t==="private"&&(n=o),s=!1,r.each(n,function(t){var n,r,o;return o=t.low,n=t.high,r=i(o,n,e),r&&(s=!0),null}),s},a=function(e,n,r){var u,a,f,l,c;return a=function(e,t){var n,r;return void 0,n=s.instance().component(e),n.get("name")===t?!1:(r=!1,s.instance().eachComponent(function(e){if(e.get("name")===t)return r=!0,!1}),r)},f=function(e,t){var n,r;return r=s.instance(),n=r.component(e),n?r.isPreservedName(n.type,t):!1},l=function(e){var t;t=!1;if(e==="self"||e==="this"||e==="global"||e==="meta"||e==="madeira")t=!0;return t},n.length||(n=i(n)),c=n.val(),r||(r=c),c&&!t.validate("awsName",c)&&(u=sprintf(o.ide.PARSLEY_THIS_VALUE_SHOULD_BE_A_VALID_TYPE_NAME,r)),!u&&a(e,c)&&(u=sprintf(o.ide.PARSLEY_TYPE_NAME_CONFLICT,r,c)),!u&&f(e,c)&&(u=sprintf(o.ide.PARSLEY_TYPE_NAME_CONFLICT,r,c)),!u&&l(c)&&(u=sprintf(o.ide.PARSLEY_TYPE_NAME_CONFLICT,r,c)),c.indexOf("elbsg-")===0&&(u=o.ide.PARSLEY_RESOURCE_NAME_ELBSG_RESERVED),n.parsley("custom",function(){return u}),n.parsley("validate")},t.aws={},t.aws.aws={getCompByResIdForState:l,genAttrRefList:f,isValidInIPRange:c,checkPrivateIPIfHaveEIP:u,checkResName:a}})}).call(this);