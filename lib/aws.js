(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["MC","constant","underscore","jquery","Design"],function(t,n,r,i,s){var o,u,a,f;a=function(t){var i;return i={parent:null,self:null},s.instance().eachComponent(function(s){var o,u,a;o=s.groupMembers&&s.groupMembers(),(i.parent||i.self)&&null;if(s.get("appId")===t)return o&&o.length?(i.parent=s,i.self=new Backbone.Model({name:""+s.get("name")+"-0"})):i.self=s,null;if(o&&e.call(r.pluck(o,"appId"),t)>=0){if(s.type===n.RESTYPE.LC)i.parent=s.parent();else{i.parent=s;for(u in o){a=o[u];if(a.appId===t){i.self=new Backbone.Model({name:""+s.get("name")+"-"+(+u+1)});break}}}return null}}),i},o=function(e,i,s){var o;return o=!1,r.each(e,function(e){var r,u,a,f;return e.type===n.RESTYPE.EIP&&(u=e.resource.NetworkInterfaceId,r=t.extractID(u),i===r&&(f=e.resource.PrivateIpAddress.split("."),a=f[3],Number(a)===s&&(o=!0))),null}),o},u=function(e,i){var s,o,u,a,f,l,c,h,p,d,v,m,g;return f=e.uid,a=e.type,h=!1,u=null,a===n.RESTYPE.LC&&(h=!0),p=!1,d=!1,c=null,l=null,e.number&&(e.number>1?(p=!0,l=e.serverGroupName):(d=!0,c=e.serverGroupName)),i=i||this.get("allCompData"),s=[],o=n.STATE_REF_DICT,r.each(i,function(e,l){var c,h,p,d,v,m,g,y,b,w,E,S,x,T;v=e.name,g=e.uid,m=e.type,d=!1,g===f&&(v="self"),m===n.RESTYPE.ASG&&(S=e.resource.LaunchConfigurationName,S&&(E=t.extractID(S),w=i[E],a===n.RESTYPE.LC&&f===E&&(u=v,v="self",h=!0),w.resource.AssociatePublicIpAddress&&(c=!0)));if(m===n.RESTYPE.INSTANCE)return;if(m===n.RESTYPE.ENI){if(e.index!==0)return;if(e.serverGroupUid!==g)return;y=e.resource.Attachment.InstanceId;if(!y)return;if((T=e.resource.Attachment.DeviceIndex)==="0"||T===0)b=t.extractID(y),b&&(v=i[b].serverGroupName,g=b,b===f&&(v="self"))}return x=m.replace(/\./ig,"_"),p=o[x],p&&r.each(p,function(o,u){var a,f,l,h,p;f=v+".",a=g+".";if(u==="__array")return;f+=u,a+=u,h=!1;if(u==="PublicIp"){if(m===n.RESTYPE.ASG&&!c)return;m===n.RESTYPE.ENI&&!t.aws.aws.checkPrivateIPIfHaveEIP(i,e.uid,0)&&!e.resource.AssociatePublicIpAddress&&(h=!0)}h||s.push({name:f,value:a,uid:g});if(o){x==="AWS_AutoScaling_Group"&&u==="AvailabilityZones"&&(l=e.resource.AvailabilityZones,l.length>1&&r.each(l,function(e,t){return s.push({name:f+"["+t+"]",value:a+"["+t+"]",uid:g}),null}));if(x==="AWS_VPC_NetworkInterface")if(u==="PublicDnsName"||u==="PublicIp"||u==="PrivateDnsName"||u==="PrivateIpAddress"){p=e.resource.PrivateIpAddressSet;if(e.index!==0)return;p.length>1&&r.each(p,function(n,r){if(u==="PublicIp"&&!t.aws.aws.checkPrivateIPIfHaveEIP(i,e.uid,r))return;return s.push({name:f+"["+r+"]",value:a+"["+r+"]",uid:g}),null})}x==="AWS_ELB"&&u==="AvailabilityZones"&&(l=e.resource.AvailabilityZones,l.length>1&&r.each(l,function(e,t){return s.push({name:f+"["+t+"]",value:a+"["+t+"]",uid:g}),null}))}return null}),null}),v=[],m=[],r.each(s,function(e){var t,n,r,i;if(e.name.indexOf("self.")===0){d&&(r=e.name.replace("self",c),i=e.value.replace("self",c),m.push({name:r,value:i,uid:e.uid}));if(h||p)return t=null,n=null,h?(t=e.name.replace("self",u),n=e.value.replace("self",u)):p&&(t=e.name.replace("self",l),n=e.value.replace("self",l)),v.push({name:t,value:n,uid:e.uid})}}),s=s.concat(v),s=s.concat(m),g=r.map(s,function(e){return e.name.indexOf("self.")===0&&(e.value=e.value.replace(e.uid,"self"),e.uid="self"),{name:""+e.name,value:""+e.name,ref:""+e.value,uid:""+e.uid}}),g=r.filter(g,function(e){return e.name.indexOf("self.")===0?e.name.indexOf(".AvailabilityZones")!==-1?!1:!0:!0}),g=g.sort(function(e,t){if(e.name<t.name)return-1;if(e.name>t.name)return 1}),g},f=function(e,t){var n,i,s,o,u;return u=[{low:"1.0.0.1",high:"126.255.255.254"},{low:"128.1.0.1",high:"191.254.255.254"},{low:"192.0.1.1",high:"223.255.254.254"}],o=[{low:"10.0.0.0",high:"10.255.255.255"},{low:"172.16.0.0",high:"172.31.255.255"},{low:"192.168.0.0",high:"192.168.255.255"}],i=function(e,t,n){var i,s,o,u;return s=e.split("."),o=t.split("."),i=n.split("."),u=!0,r.each(i,function(e,t){return Number(i[t])>=Number(s[t])&&Number(i[t])<=Number(o[t])||(u=!1),null}),u},n=[],t==="public"?n=u:t==="private"&&(n=o),s=!1,r.each(n,function(t){var n,r,o;return o=t.low,n=t.high,r=i(o,n,e),r&&(s=!0),null}),s},t.aws={},t.aws.aws={getCompByResIdForState:a,genAttrRefList:u,isValidInIPRange:f,checkPrivateIPIfHaveEIP:o}})}).call(this);