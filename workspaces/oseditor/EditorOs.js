define("workspaces/oseditor/template/TplOsEditor",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o;s+='<div id="OpsEditor" class="pos-r">\n  <nav class="OEPanelTop"></nav>\n  <aside class="OEPanelRight" id="OEPanelRight"></aside>\n\n<div class="OEMiddleWrap">\n  <div class="OEPanelBottom"></div>\n\n  <section class="OEPanelCenter nano"> <div class="nano-content">\n    <div class="canvas-view">\n      <button class="svg_resizer icon-resize-down tooltip" data-tooltip=\'',o=n.i18n.call(t,"CANVAS.CVS_TIP_EXPAND_H",{hash:{},data:i});if(o||o===0)s+=o;s+="'></button>\n      <button class=\"svg_resizer icon-resize-up tooltip\" data-tooltip='",o=n.i18n.call(t,"CANVAS.CVS_TIP_SHRINK_H",{hash:{},data:i});if(o||o===0)s+=o;s+="'></button>\n      <button class=\"svg_resizer icon-resize-right tooltip\" data-tooltip='",o=n.i18n.call(t,"CANVAS.CVS_TIP_EXPAND_W",{hash:{},data:i});if(o||o===0)s+=o;s+="'></button>\n      <button class=\"svg_resizer icon-resize-left tooltip\" data-tooltip='",o=n.i18n.call(t,"CANVAS.CVS_TIP_SHRINK_W",{hash:{},data:i});if(o||o===0)s+=o;return s+='\'></button>\n      <svg width="100%" height="100%"></svg>\n    </div> </div>\n    <q class="canvas-message"></q>\n  </section>\n</div>\n</div>',s};return e.template(t)}),define("workspaces/oseditor/template/TplPanel",["handlebars"],function(e){var t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<article class="panel-body"></article>\n<article class="panel-float hidden"></article>'};return e.template(t)}),define("workspaces/oseditor/subviews/panels/template/TplResourcePanel",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<nav class="clearfix">\n    <h1 class="title">Resource</h1>\n    <ul class="action clearfix">\n        <li class="btn-refresh-panel icon-refresh tooltip" data-tooltip="Refresh Resources"></li>\n        <li class="btn-open-shareres js-toggle-dropdown icon-resources tooltip" data-target=".resources-dropdown-wrapper" data-tooltip="Manage Other Resources"></li>\n    </ul>\n    <ul class="dropdown-menu resources-dropdown-wrapper">\n        <li data-action="keypair" class="icon-kp"><span>'+o(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_KEY_PAIR",{hash:{},data:i}))+'</span></li>\n        <li data-action="snapshot" class="icon-ebs-snap"><span>'+o(n.i18n.call(t,"PROP.VOLUME_SNAPSHOT",{hash:{},data:i}))+'</span></li>\n    </ul>\n</nav>\n\n<div>\n    <section class="system-image">\n        <header>\n            Server\n            <aside class="selectbox ami-type-select">\n                <div class="selection">System Image</div>\n                <ul class="dropdown">\n                    <li class="item selected" data-id="public">System Image</li>\n                    <li class="item" data-id="private">Image Snapshot</li>\n                </ul>\n            </aside>\n        </header>\n        <article>\n            <ul class="nano-content resource-list-ami"></ul>\n        </article>\n    </section>\n\n    <section class="block-storage">\n        <header>Block Storage</header>\n        <article>\n            <ul class="resource-list-volume clearfix"></ul>\n        </article>\n        <button class="btn btn-primary full-width manage-snapshot">Manage Snapshots</button>\n    </section>\n\n    <section class="network">\n        <header>Network</header>\n        <article>\n            <ul class="resource-list-network clearfix">\n                <li class="tooltip resource-item ossubnet" data-tooltip=\''+o(n.i18n.call(t,"DRAG_AND_DROP_IN_NETOWRK_TO_CREATE_SUBNET",{hash:{},data:i}))+'\' data-type="OSSUBNET">'+o(n.i18n.call(t,"LBL_OSSUBNET",{hash:{},data:i}))+'</li>\n\n                <li class="tooltip resource-item osrt" data-tooltip=\''+o(n.i18n.call(t,"DRAG_AND_DROP_OUTSIDE_NETOWRK_TO_CREATE_ROUTER",{hash:{},data:i}))+'\' data-type="OSRT">'+o(n.i18n.call(t,"LBL_OSRT",{hash:{},data:i}))+'</li>\n\n                <li class="tooltip resource-item osport" data-tooltip=\''+o(n.i18n.call(t,"DRAG_AND_DROP_IN_SUBNET_TO_CREATE_PORT",{hash:{},data:i}))+'\' data-type="OSPORT">'+o(n.i18n.call(t,"LBL_OSPORT",{hash:{},data:i}))+'</li>\n            </ul>\n        </article>\n\n    </section>\n\n    <section class="network">\n        <header>Load Balancing</header>\n        <article>\n            <ul class="resource-list-network clearfix">\n                <li class="tooltip resource-item oselb" data-tooltip=\''+o(n.i18n.call(t,"DRAG_AND_DROP_IN_SUBNET_TO_CREATE_LOAD_BALANCE",{hash:{},data:i}))+'\' data-type="OSELB">'+o(n.i18n.call(t,"LBL_OSELB",{hash:{},data:i}))+'</li>\n\n                <li class="tooltip resource-item oslistener" data-tooltip=\''+o(n.i18n.call(t,"DRAG_AND_DROP_IN_SUBNET_TO_CREATE_LISTENER",{hash:{},data:i}))+'\' data-type="OSLISTENER">'+o(n.i18n.call(t,"LBL_OSLISTENER",{hash:{},data:i}))+'</li>\n\n                <li class="tooltip resource-item ospool" data-tooltip=\''+o(n.i18n.call(t,"DRAG_AND_DROP_IN_SUBNET_TO_CREATE_POOL",{hash:{},data:i}))+'\' data-type="OSPOOL">'+o(n.i18n.call(t,"LBL_OSPOOL",{hash:{},data:i}))+"</li>\n\n            </ul>\n        </article>\n    </section>\n</div>",s},n.frame=e.template(t),t=function(e,t,n,r,i){function f(e,t){var n="",r;return n+='\n<li class="bubble resource-item osserver" data-bubble-template="resPanelOsAmiInfo" data-bubble-data=\'{"region":"'+u((r=e&&e.region,typeof r===o?r.apply(e):r))+'","imageId":"'+u((r=e&&e.id,typeof r===o?r.apply(e):r))+'"}\' data-type="OSSERVER" data-option=\'{"imageId":"'+u((r=e&&e.id,typeof r===o?r.apply(e):r))+'"}\'>\n    <img src="/assets/images/ide/ami-os/'+u((r=e&&e.os_type,typeof r===o?r.apply(e):r))+"."+u((r=e&&e.architecture,typeof r===o?r.apply(e):r))+'@2x.png">\n    '+u((r=e&&e.name,typeof r===o?r.apply(e):r))+"\n</li>\n",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.ami=e.template(t),t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\n<li class="resource-item bubble ossnapshot" data-date="'+a((r=e&&e.created_at,typeof r===u?r.apply(e):r))+'" data-storge="'+a((r=e&&e.size,typeof r===u?r.apply(e):r))+'" data-bubble-template="resPanelOsSnapshot" data-bubble-data=\'{"id":"'+a((r=e&&e.id,typeof r===u?r.apply(e):r))+'", "region":"'+a((r=e&&e.region,typeof r===u?r.apply(e):r))+'"}\' data-type="OSVOL" data-option=\'{"size":'+a((r=e&&e.size,typeof r===u?r.apply(e):r))+', "snapshot": "'+a((r=e&&e.id,typeof r===u?r.apply(e):r))+'"}\'>\n  <div class="ebs-size">'+a((r=e&&e.size,typeof r===u?r.apply(e):r))+" GB</div>"+a((r=e&&e.name,typeof r===u?r.apply(e):r))+"\n</li>\n",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<li class="tooltip resource-item osvol" data-tooltip=\''+a(n.i18n.call(t,"DRAG_AND_DROP_ON_SERVER_TO_ATTACH_VOLUME",{hash:{},data:i}))+'\' data-type="OSVOL">'+a(n.i18n.call(t,"LBL_OSVOL",{hash:{},data:i}))+"</li>\n",o=n.each.call(t,t,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s},n.snapshot=e.template(t),n}),function(){define("workspaces/oseditor/subviews/panels/ResourcePanel",["backbone","constant","CloudResources","./template/TplResourcePanel","OsSnapshot","OsKp"],function(e,t,n,r,i,s){return MC.template.resPanelOsAmiInfo=function(e){var r;if(!e.region||!e.imageId)return;return r=n(t.RESTYPE.OSIMAGE,e.region).get(e.imageId),MC.template.bubbleOsAmiInfo((r!=null?r.toJSON():void 0)||{})},MC.template.resPanelOsSnapshot=function(e){var r;if(!e.region||!e.id)return;return r=n(t.RESTYPE.OSSNAP,e.region).get(e.id),MC.template.bubbleOsSnapshotInfo((r!=null?r.toJSON():void 0)||{})},e.View.extend({events:{"mousedown .resource-item":"startDrag","OPTION_CHANGE .ami-type-select":"changeAmiType","click .btn-refresh-panel":"refreshPanelData","click .manage-snapshot":"manageSnapshot","click .resources-dropdown-wrapper li":"resourcesMenuClick"},amiType:"public",initialize:function(e){var r;return _.extend(this,e),r=this.workspace.opsModel.get("region"),this.listenTo(n(t.RESTYPE.OSSNAP,r),"update",this.renderSnapshot),this.listenTo(n(t.RESTYPE.OSIMAGE,r),"update",this.renderAmi)},resourcesMenuClick:function(e){var t,n;t=$(e.currentTarget),n=t.data("action");switch(n){case"keypair":return(new s).manage();case"snapshot":return(new i).render()}},changeAmiType:function(e,t){return this.amiType=t,this.renderAmi()},render:function(){return this.$el.html(r.frame({})),this.renderAmi(),this.renderSnapshot(),this},renderSnapshot:function(){var e,i,s;return i=this.workspace.opsModel.get("region"),s=n(t.RESTYPE.OSSNAP,i).toJSON(),e=_.map(s,function(e){return _.extend({region:i},e)}),this.$(".resource-list-volume").html(r.snapshot(e)),this},manageSnapshot:function(){var e;return e=new i,e.render()},renderAmi:function(){var e,i,s,o,u;return u=this,o=this.workspace.opsModel.get("region"),e=n(t.RESTYPE.OSIMAGE,o).toJSON(),i=_.filter(e,function(e){return e.visibility===u.amiType}),s=_.map(i,function(e){return _.extend({region:o},e)}),this.$(".resource-list-ami").html(r.ami(s)),this},refreshPanelData:function(e){var r,i,s;r=$(e.currentTarget);if(r.hasClass("reloading"))return;r.addClass("reloading"),s=this.workspace.opsModel.get("region"),i=[n(t.RESTYPE.OSIMAGE,s).fetchForce(),n(t.RESTYPE.OSSNAP,s).fetchForce()],Q.all(i).done(function(){return r.removeClass("reloading")})},startDrag:function(e){var n,r,i,s;if(e.button!==0)return!1;n=$(e.currentTarget);if(n.hasClass("disabled"))return!1;if(e.target&&$(e.target).hasClass("btn-fav-ami"))return;return s=t.RESTYPE[n.attr("data-type")],r="#OpsEditor .OEPanelCenter",i=$.extend(!0,{},n.data("option")||{}),i.type=s,n.dnd(e,{dropTargets:$(r),dataTransfer:i,eventPrefix:s===t.RESTYPE.OSVOL?"addVol_":"addItem_"}),!1}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/oseditor/property/OsPropertyView",["constant"],function(t){var n,r;return r={stack:{},app:{},appedit:{}},n=Backbone.View.extend({events:{"change .selection[data-target]":"updateAttribute"},constructor:function(e){return e&&_.isObject(e)&&_.extend(this,e),this.__subViews=[],Backbone.View.apply(this,arguments)},reg:function(t){return e.call(this.__subViews,t)>=0?t:t===this?t:(this.__subViews.push(t),_.extend(t,_.pick(this,"propertyPanel","panel","workspace")),t.__superView=this,t)},remove:function(){var e,t,n,r;r=this.__subViews;for(t=0,n=r.length;t<n;t++)e=r[t],e!=null&&typeof e.remove=="function"&&e.remove();return Backbone.View.prototype.remove.apply(this,arguments)},getRenderData:function(){return _.extend({},this.getExtendJson(),this.getModelJson())},getExtendJson:function(){return{modeIsApp:this.modeIsApp(),modeIsAppEdit:this.modeIsAppEdit(),modeIsStack:this.modeIsStack()}},getModelJson:function(){var e,t;switch(!1){case!this.modeIsStack():return this.model.toJSON();case!this.modeIsApp():return(e=this.appModel)!=null?e.toJSON():void 0;case!this.modeIsAppEdit():return _.extend(this.model.toJSON(),{app:(t=this.appModel)!=null?t.toJSON():void 0})}},updateAttribute:function(e){var t,n,r,i;t=$(e.currentTarget),n=t.data("target");if(!n)return;r=t.getValue(),(i=this.getModelForUpdateAttr(e))!=null&&i.set(n,r);if(n==="name")return this.setTitle(r)},getModelForUpdateAttr:function(){return this.model},getPanel:function(){var e;return this.panel||((e=this.__superView)!=null?e.panel:void 0)},getPropertyPanel:function(){var e;return this.propertyPanel||((e=this.__superView)!=null?e.propertyPanel:void 0)},getModelForMode:function(){return this.model},mode:function(){var e,t;return t=this.getModelForMode(),t?(e=Design.instance().mode(),e==="appedit"&&!t.get("appId")&&(e="stack"),e):""},modeIsApp:function(){return this.mode()==="app"},modeIsAppEdit:function(){return this.mode()==="appedit"},modeIsStack:function(){return this.mode()==="stack"},getTitle:function(){var e;return(e=this.model)!=null?e.get("name"):void 0},setTitle:function(){var e;return(e=this.getPropertyPanel())!=null?e.setTitle.apply(this.getPropertyPanel(),arguments):void 0},showFloatPanel:function(){var e;return(e=this.getPanel())!=null?e.showFloatPanel.apply(this.getPanel(),arguments):void 0},hideFloatPanel:function(){var e;return(e=this.getPanel())!=null?e.hideFloatPanel.apply(this.getPanel(),arguments):void 0},beforeRender:function(){var e;return(e=this.getPanel())!=null?e.hideFloatPanel():void 0},afterRender:function(){}},{extend:function(e,t){var r,i,s;return r=Backbone.View.extend.apply(this,arguments),delete r.register,delete r.getClass,_.isFunction(r.prototype.render)&&(r.prototype.originalRender=r.prototype.render,r.prototype.render=function(){var e;return this.beforeRender(),e=this.originalRender(),this.afterRender(),e}),t&&(s=t.handleTypes,i=t.handleModes,n.register(s,i,r)),r},register:function(e,t,n){var i,s,o,u,a,f;for(o=0,a=t.length;o<a;o++){i=t[o];for(u=0,f=e.length;u<f;u++)s=e[u],r[i][s]=n}return null},getClass:function(e,t){return r[e][t]}}),n})}.call(this),define("workspaces/oseditor/property/default/template",["handlebars"],function(e){var t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="os-property-default">Select a resource on canvas to edit property</div>'};return e.template(t)}),function(){define("workspaces/oseditor/property/default/view",["constant","../OsPropertyView","./template"],function(e,t,n){return t.extend({render:function(){return this.$el.html(n({})),this}},{handleTypes:["default"],handleModes:["stack","app","appedit"]})})}.call(this),define("workspaces/oseditor/property/globalconfig/stack",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){return"App"}function c(e,t){return"Stack"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;s+='<section class="group required">\n    <label class="name">',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:u.program(3,c,i),fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;s+=' Name</label>\n    <input data-target="name" class="selection string" value="'+f((o=t&&t.name,typeof o===a?o.apply(t):o))+'"/>\n</section>\n\n<section class="group">\n    <label class="name">',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:u.program(3,c,i),fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;s+=' Description</label>\n    <input data-target="description" class="selection string" value="'+f((o=t&&t.description,typeof o===a?o.apply(t):o))+'"/>\n</section>\n\n<section class="group">\n    <dl class="dl-horizontal">\n        <dt>Platform</dt><dd>'+f((o=t&&t.platform,typeof o===a?o.apply(t):o))+"</dd>\n        <dt>Region</dt><dd>"+f((o=t&&t.region,typeof o===a?o.apply(t):o))+"</dd>\n        <dt>",o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:u.program(3,c,i),fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;return s+=" ID</dt><dd>"+f((o=t&&t.id,typeof o===a?o.apply(t):o))+"</dd>\n    </dl>\n</section>",s};return e.template(t)}),define("workspaces/oseditor/property/globalconfig/app",["handlebars"],function(e){var t=function(e,t,n,r,i){function f(e,t){var r="";return r+="\n            <dd>"+u(n.i18n.call(e,"PROP.LBL_ENABLED",{hash:{},data:t}))+"</dd>\n        ",r}function l(e,t){var r="";return r+="\n            <dd>"+u(n.i18n.call(e,"PROP.LBL_DISABLED",{hash:{},data:t}))+"</dd>\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a=this;s+='<section class="group">\n    <dl class="dl-horizontal">\n        <dt>Platform</dt><dd>'+u(n.emptyStr.call(t,t&&t.platform,{hash:{},data:i}))+"</dd>\n        <dt>Region</dt><dd>"+u(n.emptyStr.call(t,t&&t.region,{hash:{},data:i}))+"</dd>\n        <dt>App ID</dt><dd>"+u(n.emptyStr.call(t,t&&t.id,{hash:{},data:i}))+"</dd>\n        <dt>Usage</dt><dd>"+u(n.emptyStr.call(t,t&&t.usage,{hash:{},data:i}))+'</dd>\n    </dl>\n</section>\n\n<section class="group">\n    <dl class="dl-vertical">\n        <dt>Description</dt><dd>'+u(n.emptyStr.call(t,t&&t.description,{hash:{},data:i}))+"</dd>\n        <dt>Instance State</dt><dd>"+u(n.emptyStr.call(t,(o=t&&t.agent,o==null||o===!1?o:o.enabled),{hash:{},data:i}))+"</dd>\n        <!-- <dt>"+u(n.i18n.call(t,"PROP.APP_LBL_RESDIFF_VIEW",{hash:{},data:i}))+"</dt>\n        ",o=n["if"].call(t,t&&t.resource_diff,{hash:{},inverse:a.program(3,l,i),fn:a.program(1,f,i),data:i});if(o||o===0)s+=o;return s+=" -->\n    </dl>\n</section>",s};return e.template(t)}),define("workspaces/oseditor/property/ossglist/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\n        <option value="'+a((r=e&&e.uid,typeof r===u?r.apply(e):r))+'">'+a((r=e&&e.name,typeof r===u?r.apply(e):r))+"</option>\n        ",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="option-group-head expand">\n    Security Group\n</div>\n<div class="option-group">\n    <select class="selection option mutil show-input item-list" data-target="sglist" value="'+a((o=t&&t.attachedSGList,typeof o===u?o.apply(t):o))+'" data-button-tpl="button" data-select-tpl="sgOption" data-item-tpl="sgItem">\n        ',o=n.each.call(t,t&&t.sgList,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n    </select>\n</div>",s},n.stack=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="item">\n    <span class="item-name">'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'</span>\n    <div class="item-remove icon-del tooltip" data-tooltip="Unassociate Security Group"></div>\n</div>',s},n.item=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="option">\n    <div class="name">'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'</div>\n    <div class="info">\n        '+a((o=t&&t.ruleCount,typeof o===u?o.apply(t):o))+" Rules, "+a((o=t&&t.memberCount,typeof o===u?o.apply(t):o))+" Members, "+a((o=t&&t.description,typeof o===u?o.apply(t):o))+"\n    </div>\n</div>",s},n.option=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div>Create <span class="default">New Security Group...</span><span class="new"></span></div>'},n.addButton=e.template(t),t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\n        <li class="item" data-id="'+a((r=e&&e.id,typeof r===u?r.apply(e):r))+'">\n            <div class="item-name">'+a((r=e&&e.name,typeof r===u?r.apply(e):r))+'</div>\n            <span class="item-info">'+a((r=e&&e.ruleCount,typeof r===u?r.apply(e):r))+" Rules, "+a((r=e&&e.memberCount,typeof r===u?r.apply(e):r))+" Members, "+a((r=e&&e.description,typeof r===u?r.apply(e):r))+"</span>\n        </li>\n        ",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="option-group-head expand">\n    Security Group ('+a((o=(o=t&&t.attachedSGList,o==null||o===!1?o:o.length),typeof o===u?o.apply(t):o))+')\n</div>\n<div class="option-group">\n    <ul class="item-readable-list">\n        ',o=n.each.call(t,t&&t.attachedSGList,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n    </ul>\n</div>",s},n.app=e.template(t),n}),define("workspaces/oseditor/property/ossg/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var r;return r=n.unless.call(e,e&&e.defaultSG,{hash:{},inverse:u.noop,fn:u.program(2,c,t),data:t}),r||r===0?r:""}function c(e,t){return'<div class="os-sg-remove icon-delete bubble-popup tooltip" data-tooltip="Delete Security Group"></div>'}function h(e,t){var r="";return r+='\n    <section class="group">\n        <dl class="dl-vertical">\n            <dt>ID</dt><dd>'+a(n.emptyStr.call(e,e&&e.id,{hash:{},data:t}))+"</dd>\n            <dt>Name</dt><dd>"+a(n.emptyStr.call(e,e&&e.name,{hash:{},data:t}))+"</dd>\n            <dt>Description</dt><dd>"+a(n.emptyStr.call(e,e&&e.description,{hash:{},data:t}))+"</dd>\n        </dl>\n    </section>\n    ",r}function p(e,t){var r="",i;r+='\n    <section class="group required">\n        <label class="name">Name</label>\n        <input data-target="name" class="selection string" value="'+a((i=e&&e.name,typeof i===f?i.apply(e):i))+'" ',i=n["if"].call(e,e&&e.defaultSG,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(i||i===0)r+=i;r+='/>\n    </section>\n    <section class="group required">\n        <label class="name">Description</label>\n        <input data-target="description" class="selection string" ',i=n["if"].call(e,e&&e.modeIsAppEdit,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(i||i===0)r+=i;return r+=' value="'+a((i=e&&e.description,typeof i===f?i.apply(e):i))+'"/>\n    </section>\n    ',r}function d(e,t){return"disabled"}function v(e,t,r){var i="",s;i+='\n                <div class="rule-item" data-id="'+a((s=e&&e.id,typeof s===f?s.apply(e):s))+'">\n                    <select data-target="protocol" class="selection option" value="'+a((s=e&&e.protocol,typeof s===f?s.apply(e):s))+'" ',s=n["if"].call(e,r&&r.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='>\n                        <option value="tcp">TCP</option>\n                        <option value="udp">UDP</option>\n                        <option value="icmp">ICMP</option>\n                        <option value="all">All</option>\n                    </select>\n                    <input class="selection" data-target="port" value="'+a((s=e&&e.port,typeof s===f?s.apply(e):s))+'" ',s=n.ifCond.call(e,e&&e.protocol,"all",{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+=' data-tip="Input single port, port range or port range." ',s=n["if"].call(e,r&&r.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='/>\n                    <select data-target="ip" data-button-tpl="ipTipTpl" class="selection option" value="',s=n["if"].call(e,e&&e.sgId,{hash:{},inverse:u.program(12,g,t),fn:u.program(10,m,t),data:t});if(s||s===0)i+=s;i+='" data-valid-handle="ipValid" ',s=n["if"].call(e,r&&r.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='>\n                        <option value="',s=n["if"].call(e,e&&e.sgId,{hash:{},inverse:u.program(12,g,t),fn:u.program(10,m,t),data:t});if(s||s===0)i+=s;i+='">'+a((s=e&&e.ip,typeof s===f?s.apply(e):s))+"</option>\n                    </select>\n                    ",s=n.unless.call(e,r&&r.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(14,y,t),data:t});if(s||s===0)i+=s;return i+="\n                </div>\n                ",i}function m(e,t){var n;return a((n=e&&e.sgId,typeof n===f?n.apply(e):n))}function g(e,t){var n;return a((n=e&&e.ip,typeof n===f?n.apply(e):n))}function y(e,t){return'<div class="rule-item-remove icon-delete tooltip" data-tooltip="Delete Rule"></div>'}function b(e,t,r){var i="",s;i+='\n                <div class="rule-item" data-id="'+a((s=e&&e.id,typeof s===f?s.apply(e):s))+'">\n                    <select data-target="protocol" class="selection option" value="'+a((s=e&&e.protocol,typeof s===f?s.apply(e):s))+'" ',s=n["if"].call(e,r&&r.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='>\n                        <option value="tcp">TCP</option>\n                        <option value="udp">UDP</option>\n                        <option value="icmp">ICMP</option>\n                        <option value="all">All</option>\n                    </select>\n                    <input class="selection" data-target="port" value="'+a((s=e&&e.port,typeof s===f?s.apply(e):s))+'" ',s=n.ifCond.call(e,e&&e.protocol,"all",{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+=' data-tip="Input single port, port range or a common protocol" ',s=n["if"].call(e,r&&r.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='/>\n                    <select data-target="ip" data-button-tpl="ipTipTpl" class="selection option" value="',s=n["if"].call(e,e&&e.sgId,{hash:{},inverse:u.program(12,g,t),fn:u.program(10,m,t),data:t});if(s||s===0)i+=s;i+='" data-valid-handle="ipValid" ',s=n["if"].call(e,r&&r.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='>\n                        <option value="',s=n["if"].call(e,e&&e.sgId,{hash:{},inverse:u.program(12,g,t),fn:u.program(10,m,t),data:t});if(s||s===0)i+=s;i+='">'+a((s=e&&e.ip,typeof s===f?s.apply(e):s))+"</option>\n                    </select>\n                    ",s=n.unless.call(e,r&&r.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(14,y,t),data:t});if(s||s===0)i+=s;return i+="\n                </div>\n                ",i}function w(e,t){var n="",r;return n+='\n        <li class="member-item">'+a((r=e&&e.name,typeof r===f?r.apply(e):r))+"</li>\n        ",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a=this.escapeExpression,f="function";s+='<h1 class="title">'+a((o=t&&t.name,typeof o===f?o.apply(t):o))+"</h1>\n",o=n.unless.call(t,t&&t.modeIsApp,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\n\n<div class="option-group-head expand">\n    Security Group\n</div>\n<div class="option-group">\n    ',o=n["if"].call(t,t&&t.modeIsApp,{hash:{},inverse:u.program(6,p,i),fn:u.program(4,h,i),data:i});if(o||o===0)s+=o;s+='\n</div>\n<div class="option-group-head expand">Rule (<span class="sg-rule-count"></span>)</div>\n<div class="direction-switch btn-group">\n    <button class="icon-unknown t-m-btn ingress active">Ingress (<span class="sg-ingress-count"></span>)</button>\n    <button class="icon-unknown t-m-btn egress">Egress (<span class="sg-egress-count"></span>)</button>\n\n    <div class="os-sg-rule-list-container">\n        <div class="rule-container ingress">\n            <ul class="head-list clearfix">\n                <li class="head">Protocol</li>\n                <li class="head">Port/Code</li>\n                <li class="head">Source</li>\n            </ul>\n            <div class="rule-list ingress clearfix">\n                ',o=n.each.call(t,t&&t.ingressRules,{hash:{},inverse:u.noop,fn:u.programWithDepth(9,v,i,t),data:i});if(o||o===0)s+=o;s+='\n            </div>\n        </div>\n        <div class="rule-container egress hide">\n            <ul class="head-list clearfix">\n                <li class="head">Protocol</li>\n                <li class="head">Port/Code</li>\n                <li class="head">Target</li>\n            </ul>\n            <div class="rule-list egress clearfix">\n                ',o=n.each.call(t,t&&t.egressRules,{hash:{},inverse:u.noop,fn:u.programWithDepth(16,b,i,t),data:i});if(o||o===0)s+=o;s+='\n            </div>\n        </div>\n    </div>\n</div>\n<div class="option-group-head expand">\n    Member (<span class="sg-member-count"></span>)\n</div>\n<div class="option-group">\n    <ul class="os-sg-member-list">\n        ',o=n.each.call(t,t&&t.memberList,{hash:{},inverse:u.noop,fn:u.program(18,w,i),data:i});if(o||o===0)s+=o;return s+="\n    </ul>\n</div>",s},n.stack=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="rule-item">\n    <select data-target="protocol" class="selection option" value="" >\n        <option value="tcp">TCP</option>\n        <option value="udp">UDP</option>\n        <option value="icmp">ICMP</option>\n        <option value="all">All</option>\n    </select>\n    <input class="selection" data-target="port" value="" data-tip="Input single port, port range or a common protocol" />\n    <select data-target="ip" class="selection option" data-button-tpl="ipTipTpl" value="" data-valid-handle="ipValid" ></select>\n    <div class="rule-item-remove icon-delete tooltip" data-tooltip="Delete Rule"></div>\n</div>'},n.newItem=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="info">Confirm to delete this security group?</div>\n<div class="operate">\n    <button class="confirm btn btn-red">Delete</li>\n    <button class="cancel btn btn-silver">Cancel</li>\n</div>'},n.sgRemovePopup=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<input class="input os-sg-new-input" placeholder="Add new rule..." />'},n.sgNewInput=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="os-sg-rule-ip-tip"><i class="icon-info"></i>Input CIDR / Security Group</div>'},n.sgIPInputTip=e.template(t),n}),function(){define("workspaces/oseditor/property/validation/ValidationBase",["constant","backbone","i18n!/nls/lang.js"],function(e,t,n){var r,i;return i={},r=t.Model.extend({initialize:function(e){return _.extend(this,e)},init:function(){},limits:{name:"^[a-zA-Z0-9][a-zA-Z0-9-]*$"},name:function(e){var t,r,i,s;s=this.model;if(!s)return;return i=s.get("name"),r=e,r===""?"":(t=!1,i!==r&&Design.instance().eachComponent(function(e){return e!==s&&e.get("name")===r&&(t=!0),null}),t===!0?sprintf(n.PARSLEY.TYPE_NAME_CONFLICT,"The",r):r==="self"||r==="this"||r==="global"||r==="meta"||r==="madeira"?sprintf(n.PARSLEY.TYPE_NAME_CONFLICT,"The",r):null)},port:function(e){return 1<=+e&&+e<=65535?null:r.commonTip("port")}},{extend:function(e,n){var r,i;return r=t.Model.extend.apply(this,arguments),delete r.register,delete r.getClass,n&&(i=n.handleTypes,this.register(i,r)),e.limits&&(r.prototype.limits=_.extend(e.limits,this.prototype.limits)),r},register:function(e,t){var n,r,s;for(r=0,s=e.length;r<s;r++)n=e[r],i[n]=t;return null},getClass:function(e){return i[e]},commonTip:function(e){return sprintf(n.PARSLEY.THIS_VALUE_SHOULD_BE_A_VALID_XXX,e)},greaterTip:function(e){return sprintf(n.PARSLEY.THIS_VALUE_SHOULD_BE_GREATER_THAN_XXX,e)},lowerTip:function(e){return sprintf(n.PARSLEY.THIS_VALUE_SHOULD_BE_LOWER_THAN_XXX,e)},geTip:function(e){return sprintf(n.PARSLEY.THIS_VALUE_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO_XXX,e)},leTip:function(e){return sprintf(n.PARSLEY.THIS_VALUE_SHOULD_BE_LOWER_THAN_OR_EQUAL_TO_XXX,e)},rangeTip:function(e,t){return sprintf(n.PARSLEY.THIS_VALUE_MUST_BETWEEN_XXX_XXX(e,t))},validation:{range4G:function(e){return r.validation.range(null,2147483647,e)},range:function(e,t,n){if(_.isNumber(e)&&_.isNumber(t))return function(i){return i<e||i>t?r.rangeTip(e,t):!n&&i===""?"":null};if(_.isNumber(e))return function(t){return t<e?r.greaterTip(e-1):!n&&t===""?"":null};if(_.isNumber(t))return function(e){return e>t?r.lowerTip(t+1):!n&&e===""?"":null}}},limit:{positive:"^[1-9]+[0-9]*$",nonnegative:"^[0-9]*$",portRange:"^[0-9-]*$",portICMPRange:"^[0-9/-]*$",ipv4:"^[0-9.]*$",cidrv4:"^[0-9/.]*$",number:"^-?[0-9]*$|^-?[0-9]+\\.[0-9]*$",osname:"^[a-zA-Z0-9][a-zA-Z0-9-]*$"}}),r})}.call(this),function(){define("workspaces/oseditor/property/ossg/view",["constant","../OsPropertyView","./template","CloudResources","UI.selection","UI.bubblepopup","../validation/ValidationBase"],function(e,t,n,r,i,s,o){return t.extend({events:{"change .selection[data-target]":"updateAttribute","click .direction-switch .t-m-btn":"switchDirection","click .rule-item-remove":"removeRule","click .os-sg-remove":"removeSG","focus .os-sg-new-input":"focusNewInput"},className:"float-panel-sg",initialize:function(e){var t;return t=this,t.sgModel=e.sgModel,t.listView=e.listView,this.selectTpl={ipValid:function(e){return MC.validate("cidr",e)?!0:Design.instance().component(e)?!0:!1},portValid:function(e){var n,r;if(!e||!e[0])return!1;e=e[0],n=t.getRuleValue(this);if((r=n.protocol)==="tcp"||r==="udp"||r==="all"){if(t.getPortRange(e))return!0}else if(t.getICMPRange(e))return!0;return!1},ipTipTpl:function(){return n.sgIPInputTip()}}},render:function(){var t,r,s,u,a,f,l,c,h,p;return p=this,t=o.getClass(e.RESTYPE.OSSG),i(this.$el,this.selectTpl,new t({view:this,model:p.sgModel})),u=[],s=[],h=p.sgModel.get("rules"),_.each(h,function(e){var t;t=p.getRuleStr(e);if(t.direction==="ingress")return u.push(t);if(t.direction==="egress")return s.push(t)}),f=this.sgModel.getMemberList(),a=_.map(f,function(e){return e.isEmbedded&&e.isEmbedded()&&(e=e.owner()),{name:e.get("name")}}),r=Design.instance().mode(),this.sgModel.get("appId")||(r="stack"),c=r==="appedit",l=r==="app",this.$el.html(n.stack({id:this.sgModel.get("appId"),name:this.sgModel.get("name"),description:this.sgModel.get("description"),defaultSG:this.sgModel.isDefault(),ingressRules:u,egressRules:s,memberList:a,modeIsAppEdit:c,modeIsApp:l})),_.delay(function(){return p.$el.find(".rule-item").each(function(){return p.initSGList($(this))})}),l||this.addNewItem(this.$el.find(".rule-list")),this.setTitle(this.sgModel.get("name")),this.updateCount(),this},nullStr:"N/A",initSGList:function(t){var n,r,i,s;r=Design.modelClassForType(e.RESTYPE.OSSG).allObjects(),i=_.map(r,function(e){return{text:e.get("name"),value:e.id}}),n=t.find('select.selection[data-target="ip"]'),s=n[0];if(s&&s.selectize)return s.selectize.addOption(i)},switchDirection:function(e){var t;return t=$(e.currentTarget),this.$el.find(".direction-switch .t-m-btn").removeClass("active"),t.addClass("active"),this.$el.find(".rule-container").addClass("hide"),t.hasClass("ingress")?this.$el.find(".rule-container.ingress").removeClass("hide"):this.$el.find(".rule-container.egress").removeClass("hide")},setTitle:function(e){return this.$("h1").text(e)},updateAttribute:function(e){var t,n,r,i,s,o,u;n=$(e.currentTarget),r=n.data("target"),u=n.getValue();if("protocol|port|ip".indexOf(r)>=0){s=this.getRuleValue(n);if(!s)return;r==="protocol"&&this.setDefaultPort(s,n),t=n.parents(".rule-item"),o=this.sgModel.getRule(t.data("id")),o?(s.appId="",o.set(s)):(s&&(i=this.sgModel.addRule(s)),this.addNewItem(t),t.data("id",i),this.updateCount(),this.listView.refreshList())}return r==="name"&&(this.sgModel.set("name",u),this.setTitle(u),this.listView.refreshList()),r==="description"&&this.sgModel.set("description",u),this.refreshDeleteState()},refreshDeleteState:function(){return this.$el.find(".rule-item").each(function(){return $(this).data("id")?$(this).find(".icon-delete").removeClass("hide"):$(this).find(".icon-delete").addClass("hide")})},addNewItem:function(e){var t,r;r=this;if(this.$el.find("input.os-sg-new-input").length<=1)return e.hasClass("rule-item")?t=$(n.sgNewInput()).insertAfter(e):t=$(n.sgNewInput()).appendTo(e)},removeRule:function(e){var t,n,r;n=$(e.currentTarget),t=n.parents(".rule-item"),r=t.data("id");if(r)return this.sgModel.removeRule(r),t.remove(),this.updateCount(),this.listView.refreshList()},setDefaultPort:function(e,t){var n,r,i;r=t.parents(".rule-item"),n=r.find('input[data-target="port"]'),n.removeAttr("disabled");if((i=e.protocol)==="tcp"||i==="udp")return n.val("1-65535");if(e.protocol==="icmp")return n.val("-1/-1");if(e.protocol===null)return n.val(this.nullStr),n.attr("disabled","disabled")},getPortStr:function(e,t){return e===null||t===null?"1-65535":e===t?e+"":e+"-"+t},getICMPStr:function(e,t){return e===null&&(e=-1),t===null&&(t=-1),e+"/"+t},getPortRange:function(e){var t;return e==="1-65535"?[null,null]:(t=MC.validate.portRange(e),t&&MC.validate.portValidRange(t)?t[0]===0?null:(t.length===1&&(t[1]=t[0]),t):null)},getICMPRange:function(e){var t,n,r;t=e.split("/");if(t&&t.length===2){r=Number(t[0]),n=Number(t[1]);if(!isNaN(r)&&!isNaN(n)&&_.isNumber(r)&&_.isNumber(n))return r<-1||r>255?null:n<-1||n>255?null:(r===-1&&(r=null),n===-1&&(n=null),t[0]=r,t[1]=n,t)}return null},getRuleValue:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;s=e.parents(".rule-item"),i=s.parents(".rule-container"),r=s.find('select[data-target="protocol"]'),n=s.find('input[data-target="port"]'),t=s.find('select[data-target="ip"]'),c=r.getValue(),a=n.getValue(),u=t.getValue();if(u==="0.0.0.0/0"||!u)u=null;return h=null,p=Design.instance().component(u),p&&(h=p,u=null),o="ingress",i.hasClass("egress")&&(o="egress"),c==="all"?(c=null,l=null,f=null):c==="icmp"?(a=this.getICMPRange(a),a===null?(l=null,f=null):(l=a[0],f=a[1])):(a=this.getPortRange(a),a===null?(l=null,f=null):(l=a[0],f=a[1])),{direction:o,protocol:c,portMin:l,portMax:f,ip:u,sg:h}},getRuleStr:function(e){var t,n,r,i,s,o,u,a,f,l;return s=e.toJSON(),t=s.direction,n=s.remote_ip_prefix,i=s.protocol,n===null&&(n="0.0.0.0/0"),a=e.get("sg"),a&&(n=a.get("name"),u=a.id),(f=s.protocol)==="tcp"||f==="udp"?r=this.getPortStr(s.port_range_min,s.port_range_max):(l=s.protocol)==="icmp"?r=this.getICMPStr(s.port_range_min,s.port_range_max):(i="all",r=this.nullStr),o={id:e.id,direction:t,protocol:i,port:r,ip:n,sgId:u}},removeSG:function(e){var t;return t=this,s($(e.currentTarget),n.sgRemovePopup(),{".confirm":function(){return t.sgModel.remove(),t.listView.refreshList(),t.listView.hideFloatPanel()}})},updateCount:function(){var e,t;return t=this.sgModel.get("rules"),e=_.filter(t,function(e){return e.get("direction")==="ingress"}),this.$el.find(".sg-rule-count").text(t.length),this.$el.find(".sg-ingress-count").text(e.length),this.$el.find(".sg-egress-count").text(t.length-e.length),this.$el.find(".sg-member-count").text(this.sgModel.getMemberList().length)},focusNewInput:function(e){var t,r,i;return i=this,t=$(e.currentTarget),r=$(n.newItem()).insertAfter(t),r&&i.initSGList(r),_.delay(function(){return r.find('.selection[data-target="port"]').focus()}),t.remove()}},{handleTypes:["ossg"],handleModes:["stack","appedit","app"]})})}.call(this),function(){define("workspaces/oseditor/property/ossglist/view",["constant","../OsPropertyView","./template","CloudResources","../ossg/view","UI.selection","../validation/ValidationBase"],function(e,t,n,r,i,s,o){return t.extend({events:{"change .selection[data-target]":"updateAttribute","select_dropdown_button_click .item-list":"addItem","click .item-list .item":"editItem","click .item-readable-list .item":"editItem","select_item_add .item-list":"attachItem","select_item_remove .item-list":"unAttachItem","click .item-list .item .item-remove":"unAttachItemClick","mousedown .item-list .item .item-remove":"unAttachItemMousedown"},initialize:function(e){var t;return t=this,this.targetModel=e.targetModel,this.panel=e.panel,this.selectTpl={button:function(){return n.addButton()},sgItem:function(e){return n.item({name:e.text})},sgOption:function(e){var t;return t=Design.instance().component(e.value),n.option({name:e.text,ruleCount:t.get("rules").length,memberCount:t.getMemberList().length,description:t.get("description")})}}},render:function(){var t;return t=o.getClass(e.RESTYPE.OSSG),s(this.$el,this.selectTpl,new t({view:this})),this.refreshList(),this},refreshList:function(){var t,r,i,s,o,u;return o=Design.instance().mode(),this.targetModel&&!this.targetModel.get("appId")&&(o="stack"),t=Design.modelClassForType(e.RESTYPE.OSSG),r=t.allObjects(),u=[],_.each(r,function(e){var t,n;return t=e.get("name"),n=e.get("id"),u.push({name:t,uid:n,id:e.id,name:e.get("name"),ruleCount:e.get("rules").length,memberCount:e.getMemberList().length,description:e.get("description")})}),o==="stack"||o==="appedit"?(this.targetModel?(s=this.targetModel.connectionTargets("OsSgAsso"),i=[],_.each(s,function(e){var t;return t=e.get("id"),i.push(t)}),this.$el.html(n.stack({sgList:u,attachedSGList:i.join(",")}))):this.$el.html(n.app({attachedSGList:u})),this.refreshRemoveState()):this.targetModel?(s=this.targetModel.connectionTargets("OsSgAsso"),i=[],_.each(s,function(e){return i.push({id:e.id,name:e.get("name"),ruleCount:e.get("rules").length,memberCount:e.getMemberList().length,description:e.get("description")})}),this.$el.html(n.app({attachedSGList:i}))):this.$el.html(n.app({attachedSGList:u}))},refreshRemoveState:function(){var e;if(this.targetModel)return e=this.targetModel.connectionTargets("OsSgAsso"),e.length<=1?this.$el.find(".item-list .item-remove").addClass("hide"):this.$el.find(".item-list .item-remove").removeClass("hide")},getSelectItemModel:function(e){var t,n;return t=e.data("value")||e.data("id"),n=Design.instance().component(t),n},updateAttribute:function(e){var t,n,r;return t=$(e.currentTarget),n=t.data("target"),r=t.getValue()},addItem:function(t,n){var r,i,s,o;return i=Design.modelClassForType(e.RESTYPE.OSSG),n?s=new i({name:n}):s=new i({}),o=s.get("id"),this.attachItem(null,o),this.refreshList(),r=this.$el.find('.item-list .item[data-value="'+o+'"]'),r.click(),!1},editItem:function(e){var t,n,r,s;return t=$(e.currentTarget),r=this.getSelectItemModel(t),s=new i({sgModel:r,listView:this}),n=t.parents(".item-readable-list").length,n&&(t.parents(".item-readable-list").find(".item").removeClass("active"),t.addClass("active")),this.showFloatPanel(s.render().el,function(){if(n)return t.removeClass("active")}),!1},attachItem:function(e,t){var n;return n=Design.instance().component(t),n.attachSG(this.targetModel),this.refreshRemoveState()},unAttachItem:function(e,t){var n;return n=Design.instance().component(t),n.unAttachSG(this.targetModel),this.refreshRemoveState()},unAttachItemClick:function(e){var t,n,r;return n=$(e.currentTarget),t=n.parents(".item"),r=this.getSelectItemModel(t),r.unAttachSG(this.targetModel),this.refreshList(),!1}},{handleTypes:["ossglist"],handleModes:["stack","appedit","app"]})})}.call(this),function(){define("workspaces/oseditor/property/globalconfig/view",["constant","../OsPropertyView","./stack","./app","../ossglist/view"],function(e,t,n,r,i){return t.extend({events:{"change .selection[data-target]":"updateAttribute"},initialize:function(){return this.sgListView=this.reg(new i({targetModel:null}))},render:function(){var e;return e=function(){switch(!1){case this.mode()!=="app":return r;default:return n}}.call(this),this.$el.html(e(this.getRenderData())),this.$el.append(this.sgListView.render().el),this},mode:function(){var e;return e=Design.instance().mode(),e},getTitle:function(){var e;return(e=this.mode())==="app"||e==="appedit"?"App Property":"Stack Property"}},{handleTypes:["globalconfig"],handleModes:["stack","app","appedit"]})})}.call(this),define("workspaces/oseditor/property/ossubnet/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n<section class="group">\n    <dl class="dl-vertical">\n        <dt>ID</dt><dd>'+u(n.emptyStr.call(e,(i=e&&e.app,i==null||i===!1?i:i.id),{hash:{},data:t}))+"</dd>\n        <dt>Gateway IP</dt><dd>"+u(n.emptyStr.call(e,(i=e&&e.app,i==null||i===!1?i:i.gateway_ip),{hash:{},data:t}))+"</dd>\n        <dt>DNS Name Server</dt>\n        ",i=n.each.call(e,(i=e&&e.app,i==null||i===!1?i:i.dns_nameservers),{hash:{},inverse:a.noop,fn:a.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n    </dl>\n</section>\n",r}function c(e,t){var r="";return r+="\n        <dd>"+u(n.emptyStr.call(e,e,{hash:{},data:t}))+"</dd>\n        ",r}function h(e,t){return"disabled"}function p(e,t){var n="";return n+='\n        <option value="'+u(typeof e===f?e.apply(e):e)+'">'+u(typeof e===f?e.apply(e):e)+"</option>\n        ",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a=this,f="function";o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:a.noop,fn:a.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\n<section class="group required" data-bind="true">\n    <label class="name">Subnet Name</label>\n    <input class="selection string" value="'+u((o=t&&t.name,typeof o===f?o.apply(t):o))+'" data-target="name" data-required-rollback="true" data-ignore="true" />\n</section>\n<section class="group required">\n    <label class="name">Cidr</label>\n    <input class="selection string" value="'+u((o=t&&t.cidr,typeof o===f?o.apply(t):o))+'" data-target="cidr" ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:a.noop,fn:a.program(4,h,i),data:i});if(o||o===0)s+=o;s+='/>\n</section>\n<section class="group">\n    <label class="name">DNS Nameservers</label>\n    <select data-target="iplist" ',o=n.unless.call(t,t&&t.modeIsStack,{hash:{},inverse:a.noop,fn:a.program(4,h,i),data:i});if(o||o===0)s+=o;s+=' class="selection option mutil show-input item-list" value="'+u((o=t&&t.nameServerList,typeof o===f?o.apply(t):o))+'" data-button-tpl="button" data-option-tpl="sgOption" data-item-tpl="sgItem">\n        ',o=n.each.call(t,t&&t.nameServers,{hash:{},inverse:a.noop,fn:a.program(6,p,i),data:i});if(o||o===0)s+=o;return s+="\n    </select>\n</section>",s},n.stack=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="item">\n    <span class="item-name" data-value="'+a((o=t&&t.value,typeof o===u?o.apply(t):o))+'">'+a((o=t&&t.value,typeof o===u?o.apply(t):o))+'</span>\n    <div class="item-remove icon-del"></div>\n</div>',s},n.item=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="option">\n    <div class="name">'+a((o=t&&t.value,typeof o===u?o.apply(t):o))+"</div>\n</div>",s},n.option=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div>Add <span class="default">by inputing IP Address...</span><span class="new"></span></div>'},n.addButton=e.template(t),t=function(e,t,n,r,i){function f(e,t){return"true"}function l(e,t){return"false"}function c(e,t){var r="",i;r+="\n        ",i=n.each.call(e,e&&e.dns_nameservers,{hash:{},inverse:a.noop,fn:a.program(6,h,t),data:t});if(i||i===0)r+=i;return r+="\n        ",r}function h(e,t){var r="";return r+="\n        <dd>"+u(n.emptyStr.call(e,e,{hash:{},data:t}))+"</dd>\n        ",r}function p(e,t){return"-"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a=this;s+='<section class="group">\n    <dl class="dl-vertical">\n        <dt>Name</dt><dd>'+u(n.emptyStr.call(t,t&&t.name,{hash:{},data:i}))+"</dd>\n        <dt>ID</dt><dd>"+u(n.emptyStr.call(t,t&&t.id,{hash:{},data:i}))+"</dd>\n        <dt>CIDR</dt><dd>"+u(n.emptyStr.call(t,t&&t.cidr,{hash:{},data:i}))+"</dd>\n        <dt>Gateway IP</dt><dd>"+u(n.emptyStr.call(t,t&&t.gateway_ip,{hash:{},data:i}))+"</dd>\n        <dt>Enable DHCP</dt><dd>",o=n["if"].call(t,t&&t.enable_dhcp,{hash:{},inverse:a.program(3,l,i),fn:a.program(1,f,i),data:i});if(o||o===0)s+=o;s+="</dd>\n        <dt>DNS Name Server</dt>\n        ",o=n["if"].call(t,(o=t&&t.dns_nameservers,o==null||o===!1?o:o.length),{hash:{},inverse:a.program(8,p,i),fn:a.program(5,c,i),data:i});if(o||o===0)s+=o;return s+="\n    </dl>\n</section>",s},n.app=e.template(t),n}),function(){define("workspaces/oseditor/property/ossubnet/view",["constant","../OsPropertyView","./template"],function(e,t,n){return t.extend({events:{"change .selection[data-target]":"updateAttribute","select_dropdown_button_click .item-list":"addItem","click .item-list .item .item-remove":"removeItemClicked","select_item_remove .item-list":"removeItem"},initialize:function(){return this.selectTpl={button:function(){return n.addButton()},sgItem:function(e){return n.item({value:e.text})},sgOption:function(e){return n.option({value:e.text})}}},render:function(){var e,t,r,i;return(i=this.mode())==="stack"||i==="appedit"?(e=this.model.toJSON(),t=[],r=[],_.each(this.model.get("nameservers"),function(e){return r.push(e),t.push(e)}),t=t.join(","),e=_.extend(e,{nameServerList:t,nameServers:r}),e=_.extend(e,this.getRenderData()),this.$el.html(n.stack(e))):this.$el.html(n.app(this.getRenderData())),this},addItem:function(e,t){var n,r;return n=$.trim(t),MC.validate("ipv4",n)&&(r=this.model.get("nameservers"),r.push(n),this.model.set("nameservers",_.uniq(r))),this.render()},removeItemClicked:function(e){var t,n,r;return t=$(e.currentTarget),r=t.parents(".item").find(".item-name").attr("data-value"),n=this.model.get("nameservers").indexOf(r),n>-1&&this.model.get("nameservers").splice(n,1),this.render()},removeItem:function(e,t){var n;n=this.model.get("nameservers").indexOf(t);if(n>-1)return this.model.get("nameservers").splice(n,1)},updateAttribute:function(e){var t,n,r;t=$(e.currentTarget),n=t.data("target"),r=t.getValue(),this.model.set(n,r),n==="cidr"&&this.model.resetAllChildIP();if(n==="name")return this.setTitle(r)}},{handleTypes:[e.RESTYPE.OSSUBNET],handleModes:["stack","app","appedit"]})})}.call(this),define("workspaces/oseditor/property/osserver/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){return'disabled="disabled"'}function c(e,t,r){var i="",s;i+="\n                <option value='"+a((s=e&&e.id,typeof s===u?s.apply(e):s))+"' ",s=n.ifCond.call(e,e&&e.id,r&&r.imageId,{hash:{},inverse:f.noop,fn:f.program(4,h,t),data:t});if(s||s===0)i+=s;return i+=">"+a((s=e&&e.name,typeof s===u?s.apply(e):s))+"</option>\n            ",i}function h(e,t){return"selected='selected'"}function p(e,t){return'selected="selected"'}function d(e,t){var n="";return n}function v(e,t){return'style="display: none"'}function m(e,t){return'disabled="disabled" placeholder="User Data is disabled to allow installing OpsAgent for VisualOps."'}function g(e,t){return"true"}function y(e,t){return"false"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="option-group-head expand">\n    Server Details\n</div>\n<div class="option-group">\n    <section class="group required">\n        <label for="property-os-server-name" class="name">Server Name</label>\n        <input id="property-os-server-name" data-target="name" class="selection string" value="'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'"/>\n    </section>\n    <section class="group required">\n        <label for="property-os-server-image" class="name">Server Image</label>\n        <select class="selection option" value="'+a((o=t&&t.imageId,typeof o===u?o.apply(t):o))+'" data-target="imageId" id="property-os-server-image" data-option-tpl="imageSelect" data-item-tpl="imageValue" ',o=n["if"].call(t,t&&t.isAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+=">\n            ",o=n.each.call(t,t&&t.imageList,{hash:{},inverse:f.noop,fn:f.programWithDepth(3,c,i,t),data:i});if(o||o===0)s+=o;s+='\n        </select>\n    </section>\n    <section class="group required">\n        <label for="property-os-server-volsize" class="name">Volume Size (GB)</label>\n        <input id="property-os-server-volsize" data-target="volumeSize" class="selection number" type="text" value="'+a((o=t&&t.volumeSize,typeof o===u?o.apply(t):o))+'"/>\n    </section>\n    <section class="group required">\n        <label for="property-os-server-CPU" class="name">CPU</label>\n        <select class="selection option"  data-target="CPU" id="property-os-server-CPU"></select>\n    </section>\n    <section class="group required">\n        <label for="property-os-server-RAM" class="name">RAM</label>\n        <select class="selection option required" data-target="RAM" id="property-os-server-RAM"></select>\n    </section>\n    <section class="group">\n        <label for="property-os-server-credential" class="name">Credential</label>\n        <select id="property-os-server-credential" data-target="credential" class="selection option" ',o=n["if"].call(t,t&&t.isAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='>\n            <option value="keypair" ',o=n.ifCond.call(t,t&&t.credential,"keypair",{hash:{},inverse:f.noop,fn:f.program(6,p,i),data:i});if(o||o===0)s+=o;s+='>KeyPair</option>\n            <option value="adminPass" ',o=n.ifCond.call(t,t&&t.credential,"keypair",{hash:{},inverse:f.program(6,p,i),fn:f.program(8,d,i),data:i});if(o||o===0)s+=o;s+='>Password</option>\n        </select>\n    </section>\n    <section class="group required"  ',o=n.ifCond.call(t,t&&t.credential,"keypair",{hash:{},inverse:f.noop,fn:f.program(10,v,i),data:i});if(o||o===0)s+=o;s+='>\n        <label class="name">Admin Password</label>\n        <input id="property-os-server-adminPass" data-target="adminPass" type="password" class="selection string" value="'+a((o=t&&t.adminPass,typeof o===u?o.apply(t):o))+'" placeholder="Password of the Image" ',o=n["if"].call(t,t&&t.isAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='/>\n    </section>\n    <section class="group required" ',o=n.ifCond.call(t,t&&t.credential,"keypair",{hash:{},inverse:f.program(10,v,i),fn:f.program(8,d,i),data:i});if(o||o===0)s+=o;s+='>\n        <label class="name">Key Pair</label>\n        <div id="property-os-server-keypair">\n        </div>\n    </section>\n    <section class="group">\n        <label class="name">User Data</label>\n        <textarea id="property-os-server-userdata" data-target="userData" type="text" class="selection string" ',o=n["if"].call(t,t&&t.isAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+=" ",o=n["if"].call(t,t&&t.agentEnabled,{hash:{},inverse:f.noop,fn:f.program(12,m,i),data:i});if(o||o===0)s+=o;s+=">"+a((o=t&&t.userData,typeof o===u?o.apply(t):o))+'</textarea>\n    </section>\n</div>\n<div class="option-group-head expand">\n    Port Details\n</div>\n<div class="option-group">\n    <section class="group required">\n        <label class="name">Fixed IP</label>\n        <input class="selection" id="property-os-server-fip" data-target="fixedIp" value="'+a((o=t&&t.fixedIp,typeof o===u?o.apply(t):o))+'"/>\n    </section>\n    <section class="group required">\n        <label class="name tooltip">Associate Floating IP</label>\n        <select class="selection bool" id="property-os-server-aip" data-target="associateFip" value="',o=n["if"].call(t,t&&t.floatingIp,{hash:{},inverse:f.program(16,y,i),fn:f.program(14,g,i),data:i});if(o||o===0)s+=o;return s+='"></select>\n    </section>\n</div>',s},n.stackTemplate=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div><img class="property-os-image-icon" width="30" height="30" src="/assets/images/ide/ami-os/'+a((o=t&&t.distro,typeof o===u?o.apply(t):o))+'@2x.png" alt=""/><p class="property-os-image-text">'+a(n.or.call(t,t&&t.name,t&&t.text,{hash:{},data:i}))+'<span class="uid">'+a(n.or.call(t,t&&t.id,t&&t.value,{hash:{},data:i}))+"</span></p></div>",s},n.imageListKey=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div><img class="property-os-image-icon" width="30" height="30" src="/assets/images/ide/ami-os/'+a((o=t&&t.distro,typeof o===u?o.apply(t):o))+'@2x.png" alt=""/>'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+"</div>",s},n.imageValue=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<button class="btn btn-primary dropdown-list-btn">Manage KeyPairs</button>'},n.kpButton=e.template(t),t=function(e,t,n,r,i){function a(e,t){return'disabled="disabled"'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this;s+='<select class="selection option" name="kpDropdown" data-button-tpl="kpButton" ',o=n["if"].call(t,t&&t.isAppEdit,{hash:{},inverse:u.noop,fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;return s+="></select>",s},n.kpSelection=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<div class="option-group-head expand">\n    Server Details<a href="#" class="icon-syslog tooltip property-btn-get-system-log action-link" data-tooltip="Get System Log"></a>\n</div>\n<div class="option-group">\n    <dl class="dl-vertical">\n        <dt>Name</dt><dd>'+u(n.emptyStr.call(t,t&&t.name,{hash:{},data:i}))+"</dd>\n        <dt>ID</dt><dd>"+u(n.emptyStr.call(t,t&&t.id,{hash:{},data:i}))+'</dd>\n        <dt>Status</dt><dd class="os-status os-status-'+u((o=t&&t.status,typeof o===a?o.apply(t):o))+'">'+u(n.emptyStr.call(t,t&&t.status,{hash:{},data:i}))+'</dd>\n        <dt>Image</dt><dd>\n            <div class="os-server-image-info">\n                <img class="property-os-image-icon" src="/assets/images/ide/ami-os/'+u((o=(o=t&&t.system_metadata,o==null||o===!1?o:o.image_os_distro),typeof o===a?o.apply(t):o))+"."+u((o=(o=t&&t.system_metadata,o==null||o===!1?o:o.image_architecture),typeof o===a?o.apply(t):o))+'@2x.png" alt=""/>\n                <p class="property-os-image-text">'+u(n.emptyStr.call(t,t&&t.image_name,{hash:{},data:i}))+'<span class="uid">'+u(n.emptyStr.call(t,t&&t.image_id,{hash:{},data:i}))+"</span></p>\n            </div>\n        </dd>\n        <dt>Volume Size</dt><dd>"+u(n.emptyStr.call(t,t&&t.volumeSize,{hash:{},data:i}))+"</dd>\n        <dt>Fixed IP</dt><dd>"+u(n.emptyStr.call(t,t&&t.fixedIp,{hash:{},data:i}))+"</dd>\n        <dt>MAC Address</dt><dd>"+u(n.emptyStr.call(t,t&&t.macAddress,{hash:{},data:i}))+"</dd>\n        <dt>Floating IP</dt><dd>"+u(n.emptyStr.call(t,t&&t.floatingIp,{hash:{},data:i}))+"</dd>\n        <dt>Flavor</dt><dd>"+u(n.emptyStr.call(t,t&&t.flavor_id,{hash:{},data:i}))+" (CPU: "+u(n.emptyStr.call(t,t&&t.vcpus,{hash:{},data:i}))+", RAM: "+u(n.emptyStr.call(t,t&&t.ram,{hash:{},data:i}))+"G)</dd>\n        <dt>Availability Zone</dt><dd>"+u(n.emptyStr.call(t,t&&t.availability_zone,{hash:{},data:i}))+"</dd>\n        <dt>Key Name</dt><dd>"+u(n.emptyStr.call(t,t&&t.key_name,{hash:{},data:i}))+"</dd>\n        <dt>Launched at</dt><dd>"+u(n.timeStr.call(t,t&&t.launch_at,{hash:{},data:i}))+"</dd>\n    </dl>\n</div>",s},n.appTemplate=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<section class="group">\n    <dl class="dl-vertical">\n        <dt>ID</dt><dd>'+o(n.emptyStr.call(t,t&&t.image_id,{hash:{},data:i}))+"</dd>\n        <dt>Distro</dt><dd>"+o(n.emptyStr.call(t,t&&t.image_os_distro,{hash:{},data:i}))+"</dd>\n        <dt>Version</dt><dd>"+o(n.emptyStr.call(t,t&&t.image_os_version,{hash:{},data:i}))+"</dd>\n        <dt>Arichitecture</dt><dd>"+o(n.emptyStr.call(t,t&&t.image_architecture,{hash:{},data:i}))+"</dd>\n        <dt>Volume Size</dt><dd>"+o(n.emptyStr.call(t,t&&t.image_vol_size,{hash:{},data:i}))+" GB</dd>\n        <dt>Size</dt><dd>"+o(n.emptyStr.call(t,t&&t.size,{hash:{},data:i}))+"</dd>\n        <dt>Created</dt><dd>"+o(n.emptyStr.call(t,t&&t.created_at,{hash:{},data:i}))+"</dd>\n    </dl>\n</section>",s},n.imageTemplate=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<section class="group">\n    <dl class="dl-vertical">\n        <dt>Device Name</dt><dd>'+o(n.emptyStr.call(t,t&&t.device_name,{hash:{},data:i}))+"</dd>\n        <dt>ID</dt><dd>"+o(n.emptyStr.call(t,t&&t.id,{hash:{},data:i}))+"</dd>\n        <dt>Status</dt><dd>"+o(n.emptyStr.call(t,t&&t.status,{hash:{},data:i}))+"</dd>\n        <dt>Description</dt><dd>"+o(n.emptyStr.call(t,t&&t.description,{hash:{},data:i}))+"</dd>\n        <dt>Size</dt><dd>"+o(n.emptyStr.call(t,t&&t.size,{hash:{},data:i}))+"</dd>\n        <dt>Bootable</dt><dd>"+o(n.emptyStr.call(t,t&&t.bootable,{hash:{},data:i}))+"</dd>\n        <dt>Created at</dt><dd>"+o(n.emptyStr.call(t,t&&t.created,{hash:{},data:i}))+"</dd>\n    </dl>\n</section>",s},n.volumeTemplate=e.template(t),n}),function(){define("workspaces/oseditor/property/osserver/view",["constant","../OsPropertyView","./template","CloudResources","underscore","OsKp","../ossglist/view"],function(e,t,n,r,i,s,o){return t.extend({events:{"change #property-os-server-credential":"onChangeCredential","change #property-os-server-name":"updateServerAttr","change #property-os-server-image":"updateServerAttr","change #property-os-server-CPU":"updateServerAttr","change #property-os-server-RAM":"updateServerAttr","change #property-os-server-keypair":"updateServerAttr","change #property-os-server-adminPass":"updateServerAttr","change #property-os-server-userdata":"updateServerAttr","change #property-os-server-fip":"updateServerAttr","change #property-os-server-aip":"updateServerAttr","change #property-os-server-volsize":"updateServerAttr","select_initialize #property-os-server-image":"initImage","select_initialize #property-os-server-credential":"initCredential","select_initialize #property-os-server-RAM":"initRAM","select_initialize #property-os-server-CPU":"initCPU"},initialize:function(){return this.listenTo(this.model,"change:fip",this.render)},render:function(){var t,i,u,a;return this.$el.empty(),i=this.model.toJSON(),t=r(e.RESTYPE.OSIMAGE,Design.instance().region()).get(this.model.get("imageId")),this.flavorList=App.model.getOpenstackFlavors(Design.instance().get("provider"),Design.instance().region()),i.imageList=r(e.RESTYPE.OSIMAGE,Design.instance().region()).toJSON(),i.floatingIp=!!this.model.embedPort().getFloatingIp(),i.fixedIp=this.model.embedPort().get("ip"),i.isAppEdit=this.modeIsAppEdit(),i.agentEnabled=Design.instance().get("agent").enabled,i.volumeSize|=t.get("vol_size"),this.$el.html(n.stackTemplate(i)),u=new s(this.model,n.kpSelection({isAppEdit:this.modeIsAppEdit()})),this.$el.find("#property-os-server-keypair").html(u.render().$el),this.stopListening(this.workspace.design),this.listenTo(this.workspace.design,"change:agent",this.render),this.sgListView=this.reg(new o({targetModel:(a=this.model)!=null?a.embedPort():void 0})),this.$el.append(this.sgListView.render().el),this},initImage:function(e){return $(e.target)[0].selectize.setValue(this.model.get("imageId"))},initCredential:function(e){return this.checkWindowsDistro(this.model.get("imageId"))},initRAM:function(e){var t,n,r;return r=i.groupBy(this.flavorList.toJSON(),"vcpus"),n=this.flavorList.get(this.model.get("flavorId")),t=i.map(i.pluck(r[n.get("vcpus")],"ram"),function(e){return{text:e/1024+" G",value:e}}),$(e.target)[0].selectize.addOption(t),$(e.target)[0].selectize.setValue(n.get("ram"))},initCPU:function(e){var t,n,r;return r=i.groupBy(this.flavorList.toJSON(),"vcpus"),n=this.flavorList.get(this.model.get("flavorId")),t=i.map(r,function(e,t){return{text:t+" Core",value:t}}),$(e.target)[0].selectize.addOption(t),$(e.target)[0].selectize.setValue(n.get("vcpus"))},onChangeCredential:function(e,t){var n;return n=e?$(e.currentTarget).getValue():t,this.model.set("credential",n),n==="keypair"?(this.$el.find("#property-os-server-keypair").parent().show(),this.$el.find("#property-os-server-adminPass").parent().hide()):(this.$el.find("#property-os-server-keypair").parent().hide(),this.$el.find("#property-os-server-adminPass").parent().show())},checkWindowsDistro:function(t){var n,i,s,o,u,a;o=r(e.RESTYPE.OSIMAGE,Design.instance().region()).get(t),i=o.get("os_distro"),u=o.get("vol_size"),void 0,this.model.set("volumeSize",u),$("#property-os-server-volsize").val(this.model.get("volumeSize")||o.get("vol_size")),s=i==="windows",n=this.$el.find("#property-os-server-credential"),n.parents(".group").toggle(!s);if(s)return this.model.set("credential","adminPass"),(a=n[0].selectize)!=null&&a.setValue("adminPass"),this.onChangeCredential(null,"adminPass")},updateServerAttr:function(e){var t,n,r,s,o,u,a,f,l,c,h,p;h=$(e.currentTarget),t=h.data("target"),l=h[0].selectize;switch(t){case"imageId":this.checkWindowsDistro(h.val()),this.model.setImage(h.val());break;case"name":this.setTitle(h.val());break;case"CPU":o=i.groupBy(this.flavorList.models,function(e){return e.get("vcpus")}),n=o[h.val()];if(n!=null?!n.length:!void 0)return!1;a=this.$el.find("#property-os-server-RAM")[0].selectize;if(!a)return!1;return f=a.getValue(),r=i.map(i.pluck(i.map(n,function(e){return e.toJSON()}),"ram"),function(e){return{text:e/1024+" G",value:e}}),s=i.find(n,function(e){return e.get("ram")===+f}),s||(f=i.min(i.pluck(r,"value")),s=i.find(n,function(e){return e.get("ram")===+f})),this.model.set("flavorId",s.get("id")),this.updateRamOptions(r,f),!1;case"RAM":return u=this.flavorList.get(this.model.get("flavorId")),o=i.groupBy(this.flavorList.models,function(e){return e.get("vcpus")}),n=o[u.get("vcpus")],p=i.find(n,function(e){return e.get("ram")===+l.getValue()}),this.model.set("flavorId",p.get("id")),!1;case"fixedIp":return c=this.model.embedPort(),c.setIp(h.val()),!1;case"associateFip":return c=this.model.embedPort(),c.setFloatingIp(h.getValue()),!1}if(t)return this.model.set(t,h.val())},updateRamOptions:function(e,t){var n;return n=this.$el.find("#property-os-server-RAM")[0].selectize,n.clearOptions(),n.load(function(r){return r(e),n.refreshOptions(!1),n.setValue(t)})},selectTpl:{imageSelect:function(t){var i,s,o;return i=r(e.RESTYPE.OSIMAGE,Design.instance().region()),s=(o=i.get(t.value))!=null?o.toJSON():void 0,s?(s.distro=s.os_type+"."+s.architecture,n.imageListKey(s)):(t.distro="ami-unknown",n.imageListKey(t))},imageValue:function(t){var i,s,o;return i=r(e.RESTYPE.OSIMAGE,Design.instance().region()),s=(o=i.get(t.value))!=null?o.toJSON():void 0,s?(s.distro=s.os_type+"."+s.architecture,n.imageValue(s)):(t.distro="ami-unknown",t.text=t.text||"Unknow",n.imageValue(t))},kpButton:function(){return n.kpButton()}}},{handleTypes:[e.RESTYPE.OSSERVER],handleModes:["stack","appedit"]})})}.call(this),function(){define("workspaces/oseditor/property/osserver/appView",["constant","../OsPropertyView","./template","CloudResources","underscore","OsKp","../ossglist/view","ApiRequestOs"],function(e,t,n,r,i,s,o,u){return t.extend({events:{"click .os-server-image-info":"openImageInfoPanel","click .property-btn-get-system-log":"openSysLogModal"},initialize:function(){return this.sgListView=new o({panel:this.panel,targetModel:this.model.embedPort()})},render:function(){var e,t,r,s,o,u,a;return r=this.getRenderData(),e={},t=r!=null?(o=r.address)!=null?o.addresses:void 0:void 0,t&&i.each(t,function(t){return i.each(t,function(t){return t.type==="fixed"&&(e.fixedIp=t.addr,e.macAddress=t.mac_addr),t.type==="floating"&&(e.floatingIp=t.addr),null}),null}),this.flavorList=App.model.getOpenstackFlavors(Design.instance().get("provider"),Design.instance().region()),s=this.flavorList.get(r.flavor_id),r.vcpus=s.get("vcpus"),r.ram=Math.round(s.get("ram")/1024),r.image_name=(u=this.model.getImage())!=null?u.name:void 0,r.image_id=(a=this.model.getImage())!=null?a.id:void 0,this.$el.html(n.appTemplate(i.extend(r,e))),this.$el.append(this.sgListView.render().el),this},openSysLogModal:function(){var e,t,n;return t=this.model.get("appId"),n=this,e=Design.instance().region(),u("os_server_GetConsoleOutput",{region:e,server_id:t}).then(this.refreshSysLog,this.refreshSysLog),modal(MC.template.modalInstanceSysLog({instance_id:t,log_content:""},!0)),!1},refreshSysLog:function(e){var t,n;return $("#modal-instance-sys-log .instance-sys-log-loading").hide(),e&&e.output?(n=e.output,t=$("#modal-instance-sys-log .instance-sys-log-content"),t.html(MC.template.convertBreaklines({content:n})),t.show()):$("#modal-instance-sys-log .instance-sys-log-info").show(),modal.position()},openImageInfoPanel:function(){var e,t,r,i;return e=(t=this.getRenderData())!=null?t.system_metadata:void 0,e.image_name=(r=this.model.getImage())!=null?r.name:void 0,e.image_id=(i=this.model.getImage())!=null?i.id:void 0,this.showFloatPanel(n.imageTemplate(e))}},{handleTypes:[e.RESTYPE.OSSERVER],handleModes:["app"]})})}.call(this),define("workspaces/oseditor/property/osvol/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n<section class="group">\n    <dl class="dl-vertical">\n        <dt>ID</dt><dd>'+u(n.emptyStr.call(e,(i=e&&e.app,i==null||i===!1?i:i.id),{hash:{},data:t}))+"</dd>\n        <dt>Status</dt><dd>"+u(n.emptyStr.call(e,(i=e&&e.app,i==null||i===!1?i:i.status),{hash:{},data:t}))+"</dd>\n    </dl>\n</section>\n",r}function c(e,t){return'disabled="disabled"'}function h(e,t){var r="",i;r+='\n        <section class="group">\n            <label class="name">Snapshot ID</label>\n            <select id="property-os-volume-snapshot" data-target="snapshot" class="selection option" data-option-tpl="snapshotOption" ',i=n["if"].call(e,e&&e.modeIsAppEdit,{hash:{},inverse:a.noop,fn:a.program(3,c,t),data:t});if(i||i===0)r+=i;return r+="></select>\n        </section>\n    ",r}function p(e,t){return"true"}function d(e,t){return"false"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a=this,f="function";o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:a.noop,fn:a.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\n<div class="option-group-head expand">\n    Volume Details\n</div>\n<div class="option-group">\n    <section class="group required">\n        <label class="name">Volume Name</label>\n        <input data-target="name" class="selection string" value="'+u((o=t&&t.name,typeof o===f?o.apply(t):o))+'"/>\n    </section>\n    <section class="group">\n        <label class="name">Description</label>\n        <input data-target="description" class="selection string" value="'+u((o=t&&t.description,typeof o===f?o.apply(t):o))+'"/>\n    </section>\n    <section class="group required">\n        <label class="name">Mount Point</label>\n        <input data-target="mountPoint" class="selection string" value="'+u((o=t&&t.mountPoint,typeof o===f?o.apply(t):o))+'" ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:a.noop,fn:a.program(3,c,i),data:i});if(o||o===0)s+=o;s+='/>\n    </section>\n    <section class="group required">\n        <label class="name">Volume Size</label>\n        <input data-target="size" class="selection string" id="property-os-volume-size" value="'+u((o=t&&t.size,typeof o===f?o.apply(t):o))+'" ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:a.noop,fn:a.program(3,c,i),data:i});if(o||o===0)s+=o;s+="/>\n    </section>\n    ",o=n["if"].call(t,t&&t.snapshot,{hash:{},inverse:a.noop,fn:a.program(5,h,i),data:i});if(o||o===0)s+=o;s+='\n    <section class="group">\n        <label class="name">Bootable</label>\n        <select class="selection bool" data-target="bootable" value="',o=n["if"].call(t,t&&t.bootable,{hash:{},inverse:a.program(9,d,i),fn:a.program(7,p,i),data:i});if(o||o===0)s+=o;s+='" ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:a.noop,fn:a.program(3,c,i),data:i});if(o||o===0)s+=o;return s+="></select>\n    </section>\n</div>",s},n.stackTemplate=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div>\n    <div class="manager-content-main">'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'</div>\n    <div class="manager-content-sub" title="'+a((o=t&&t.id,typeof o===u?o.apply(t):o))+'">'+a((o=t&&t.size,typeof o===u?o.apply(t):o))+"G | "+a((o=t&&t.id,typeof o===u?o.apply(t):o))+"</div>\n</div>",s},n.snapshotOption=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<section class="group">\n    <dl class="dl-vertical">\n        <dt>ID</dt><dd>'+o(n.emptyStr.call(t,t&&t.id,{hash:{},data:i}))+"</dd>\n        <dt>Name</dt><dd>"+o(n.emptyStr.call(t,t&&t.display_name,{hash:{},data:i}))+"</dd>\n        <dt>Status</dt><dd>"+o(n.emptyStr.call(t,t&&t.status,{hash:{},data:i}))+"</dd>\n        <dt>Size</dt><dd>"+o(n.emptyStr.call(t,t&&t.size,{hash:{},data:i}))+"</dd>\n        <dt>Snapshot ID</dt><dd>"+o(n.emptyStr.call(t,t&&t.snapshot_id,{hash:{},data:i}))+"</dd>\n        <dt>Description</dt><dd>"+o(n.emptyStr.call(t,t&&t.description,{hash:{},data:i}))+"</dd>\n        <dt>Bootable</dt><dd>"+o(n.emptyStr.call(t,t&&t.bootable,{hash:{},data:i}))+"</dd>\n        <dt>Created at</dt><dd>"+o(n.emptyStr.call(t,t&&t.created_at,{hash:{},data:i}))+"</dd>\n    </dl>\n</section>",s},n.appTemplate=e.template(t),n}),function(){define("workspaces/oseditor/property/osvol/view",["constant","../OsPropertyView","./template","CloudResources"],function(e,t,n,r){return t.extend({events:{"change .selection[data-target]":"updateAttribute"},render:function(){var e;return this.$el.html(n.stackTemplate(this.getRenderData())),((e=this.model)!=null?e.get("snapshot"):void 0)&&this.bindSelectizeEvent(),this},bindSelectizeEvent:function(){var t,n,i,s;return s=this,this.snapshots||(this.snapshots=r(e.RESTYPE.OSSNAP,Design.instance().region())),n=_.map(this.snapshots.models,function(e){var t,n;return t=e.get("name"),n=e.get("id"),{text:t,value:n}}),i=this.$el.find("#property-os-volume-snapshot"),i.on("select_initialize",function(){return this.selectize.addOption(n),this.selectize.setValue(s.model.get("snapshot"))}),t=this.$el.find("#property-os-volume-size"),i.on("change",function(){return _.defer(function(){return t.val(s.model.get("size"))})})},updateAttribute:function(e){var n,r;t.prototype.updateAttribute.apply(this,arguments),n=e.currentTarget||e.target;if($(n).data("target")==="snapshot")return r=this.snapshots.get($(n).val()).get("size"),this.model.set("size",r)},selectTpl:{snapshotOption:function(t){var i,s;return s=r(e.RESTYPE.OSSNAP,Design.instance().region()),i=s.get(t.value),n.snapshotOption(i!=null?i.toJSON():void 0)}}},{handleTypes:[e.RESTYPE.OSVOL],handleModes:["stack","appedit"]})})}.call(this),function(){define("workspaces/oseditor/property/osvol/appView",["constant","../OsPropertyView","./template","CloudResources"],function(e,t,n,r){return t.extend({render:function(){return this.$el.html(n.appTemplate(this.getRenderData())),this}},{handleTypes:[e.RESTYPE.OSVOL],handleModes:["app"]})})}.call(this),define("workspaces/oseditor/property/oslistener-asso/template",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="os-property-message">\n    This is a connection of '+a((o=t&&t.namePort1,typeof o===u?o.apply(t):o))+" and "+a((o=t&&t.namePort2,typeof o===u?o.apply(t):o))+", working as load balancer.\n</div>",s};return e.template(t)}),function(){define("workspaces/oseditor/property/oslistener-asso/view",["constant","../OsPropertyView","./template"],function(e,t,n){return t.extend({render:function(){var t,r;return t=this.model.getTarget(e.RESTYPE.OSPOOL).get("name"),r=this.model.getTarget(e.RESTYPE.OSLISTENER).get("name"),this.$el.html(n({namePort1:t,namePort2:r})),this}},{handleTypes:["OsListenerAsso"],handleModes:["stack","app","appedit"]})})}.call(this),define("workspaces/oseditor/property/ospool-membership/template",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="os-property-message">\n    This is a connection of '+a((o=t&&t.poolName,typeof o===u?o.apply(t):o))+" and "+a((o=t&&t.memberName,typeof o===u?o.apply(t):o))+", registering "+a((o=t&&t.memberName,typeof o===u?o.apply(t):o))+" as member of load balancer.\n</div>",s};return e.template(t)}),function(){define("workspaces/oseditor/property/ospool-membership/view",["constant","../OsPropertyView","./template"],function(e,t,n){return t.extend({render:function(){var t,r;return r=this.model.getTarget(e.RESTYPE.OSPOOL).get("name"),t=this.model.getOtherTarget(e.RESTYPE.OSPOOL).get("name"),this.$el.html(n({poolName:r,memberName:t})),this}},{handleTypes:["OsPoolMembership"],handleModes:["stack","app","appedit"]})})}.call(this),define("workspaces/oseditor/property/osport/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\n    <section class="group">\n        <dl class="dl-vertical">\n            <dt>ID</dt><dd>'+a((r=e&&e.appId,typeof r===u?r.apply(e):r))+'</dd>\n            <dt>Status</dt><dd class="os-status os-status-'+a((r=(r=e&&e.app,r==null||r===!1?r:r.status),typeof r===u?r.apply(e):r))+'">'+a((r=(r=e&&e.app,r==null||r===!1?r:r.status),typeof r===u?r.apply(e):r))+"</dd>\n            <dt>Mac Address</dt><dd>"+a((r=(r=e&&e.app,r==null||r===!1?r:r.mac_address),typeof r===u?r.apply(e):r))+"</dd>\n        </dl>\n    </section>\n    ",n}function c(e,t){var n="",r;return n+='\n    <section class="group required">\n        <label class="name">Name</label>\n        <input data-target="name" class="selection string" value="'+a((r=e&&e.name,typeof r===u?r.apply(e):r))+'"/>\n    </section>\n    ',n}function h(e,t){var r;return r=n["if"].call(e,e&&e.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(6,p,t),data:t}),r||r===0?r:""}function p(e,t){return"disabled"}function d(e,t){return"true"}function v(e,t){return"false"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="option-group-head expand">\n    Port Details\n</div>\n<div class="option-group">\n    ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+="\n    ",o=n["if"].call(t,t&&t.isPurePort,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;s+='\n    <section class="group required">\n        <label class="name">Fixed IP</label>\n        <input data-target="ip" class="selection string" value="'+a((o=t&&t.ip,typeof o===u?o.apply(t):o))+'" ',o=n.unless.call(t,t&&t.isPurePort,{hash:{},inverse:f.noop,fn:f.program(5,h,i),data:i});if(o||o===0)s+=o;s+='/>\n    </section>\n    <section class="group required">\n        <label class="name">Associate Floating IP</label>\n        <select data-target="float_ip" class="selection bool" value="',o=n["if"].call(t,t&&t.hasFloatIP,{hash:{},inverse:f.program(10,v,i),fn:f.program(8,d,i),data:i});if(o||o===0)s+=o;return s+='" ></select>\n    </section>\n</div>',s},n.stack=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="text-center">Attach the port to a server</div>'},n.unattached=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<section class="group">\n    <dl class="dl-vertical">\n        <dt>Name</dt><dd>'+u(n.emptyStr.call(t,t&&t.name,{hash:{},data:i}))+"</dd>\n        <dt>ID</dt><dd>"+u(n.emptyStr.call(t,t&&t.id,{hash:{},data:i}))+'</dd>\n    </dl>\n    <dl class="dl-vertical">\n        <dt>Status</dt><dd class="os-status os-status-'+u((o=t&&t.status,typeof o===a?o.apply(t):o))+'">'+u(n.emptyStr.call(t,t&&t.status,{hash:{},data:i}))+"</dd>\n        <dt>Mac Address</dt><dd>"+u(n.emptyStr.call(t,t&&t.mac_address,{hash:{},data:i}))+"</dd>\n        <dt>Fixed IP</dt><dd>"+u(n.emptyStr.call(t,(o=(o=t&&t.fixed_ips,o==null||o===!1?o:o[0]),o==null||o===!1?o:o.ip_address),{hash:{},data:i}))+"</dd>\n        <dt>Floating IP</dt><dd>"+u(n.emptyStr.call(t,t&&t.float_ip,{hash:{},data:i}))+"</dd>\n    </dl>\n</section>",s},n.app=e.template(t),n}),function(){define("workspaces/oseditor/property/osport/view",["constant","../OsPropertyView","./template","CloudResources","../ossglist/view"],function(e,t,n,r,i){return t.extend({events:{"change .selection[data-target]":"updateAttribute"},initialize:function(){return this.sgListView=this.reg(new i({targetModel:this.model})),this.listenTo(this.model,"change:fip",this.render)},render:function(){var t,i,s,o,u,a;return(a=this.mode())==="stack"||a==="appedit"?this.model.isAttached()?(u=_.extend({hasFloatIP:this.model.getFloatingIp(),isPurePort:this.model.type===e.RESTYPE.OSPORT},this.model.toJSON()),this.mode()==="appedit"&&(u=_.extend(u,this.getRenderData())),this.$el.html(n.stack(u))):this.$el.html(n.unattached(u)):(t={},s=this.model.getFloatingIp(),s&&(i=r(e.RESTYPE.OSFIP,Design.instance().region()).get(s.get("appId")),i&&(o=i.get("floating_ip_address")),t.float_ip=o),this.$el.html(n.app(_.extend(this.getRenderData(),t)))),this.model.isAttached()&&this.$el.append(this.sgListView.render().el),this},updateAttribute:function(e){var t,n,r;t=$(e.currentTarget),n=t.data("target"),r=t.getValue(),n==="float_ip"?this.model.setFloatingIp(r):this.model.set(n,r);if(n==="name")return this.setTitle(r)}},{handleTypes:[e.RESTYPE.OSPORT],handleModes:["stack","app","appedit"]})})}.call(this),define("workspaces/oseditor/property/oslistener/template/stack",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){var r="",i;r+="\n",i=n["if"].call(e,e&&e.appId,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function c(e,t){var n="",r;return n+='\n    <dl class="dl-vertical"><dt>ID</dt><dd>'+a((r=e&&e.appId,typeof r===u?r.apply(e):r))+'</dd>\n        <dt>Status</dt><dd class="os-status os-status-'+a((r=(r=e&&e.app,r==null||r===!1?r:r.status),typeof r===u?r.apply(e):r))+'">'+a((r=(r=e&&e.app,r==null||r===!1?r:r.status),typeof r===u?r.apply(e):r))+"</dd>\n        <dt>Subnet ID</dt><dd>"+a((r=(r=e&&e.app,r==null||r===!1?r:r.subnet_id),typeof r===u?r.apply(e):r))+"</dd></dl>\n",n}function h(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\n<div class="option-group-head expand">\n    Listener Details\n</div>\n<div class="option-group" data-model="listener">\n    <section class="group required">\n        <label class="name">Name</label>\n        <input data-id="listener-name" data-target="name" class="selection string" value="'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'"/>\n    </section>\n\n    <section class="group required">\n        <label class="name">Connection Limit</label>\n        <input data-id="listener-limit" data-target="limit" class="selection string" value="'+a((o=t&&t.limit,typeof o===u?o.apply(t):o))+'"/>\n    </section>\n\n    <section class="group required">\n        <label class="name">Protocol</label>\n        <select class="selection option" value="'+a((o=t&&t.protocol,typeof o===u?o.apply(t):o))+'" data-target="protocol" data-id="listener-protocol" ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(4,h,i),data:i});if(o||o===0)s+=o;s+='>\n            <option value=\'HTTP\'>HTTP</option>\n            <option value=\'HTTPS\'>HTTPS</option>\n            <option value=\'TCP\'>TCP</option>\n        </select>\n    </section>\n\n    <section class="group required">\n        <label class="name">Protocol Port</label>\n        <input data-id="listener-port" data-target="port" class="selection string" value="'+a((o=t&&t.port,typeof o===u?o.apply(t):o))+'"  ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(4,h,i),data:i});if(o||o===0)s+=o;return s+="/>\n    </section>\n</div>",s};return e.template(t)}),function(){define("workspaces/oseditor/property/oslistener/view",["constant","../OsPropertyView","../osport/view","./template/stack","CloudResources"],function(e,t,n,r,i){return t.extend({events:{"change .selection[data-target]":"updateAttribute"},render:function(){var t;return this.$el.html(r(this.getRenderData())),t=Design.instance().region(),this.$el.append(this.reg(new n({model:this.model,appModel:i(e.RESTYPE.OSPORT,t).get(this.model.get("portId"))})).render().el),this},getModelForUpdateAttr:function(e){var t,n;return t=$(e.currentTarget),n=t.closest("[data-model]").data("model"),n==="listener"?this.model:null}},{handleTypes:[e.RESTYPE.OSLISTENER],handleModes:["stack","appedit"]})})}.call(this),define("workspaces/oseditor/property/oslistener/template/app",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="option-group-head expand">\n    Listener Details\n</div>\n<div class="option-group">\n    <dl class="dl-vertical">\n        <dt>Name</dt><dd>'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>ID</dt><dd>"+a((o=t&&t.id,typeof o===u?o.apply(t):o))+'</dd>\n        <dt>Status</dt><dd class="os-status os-status-'+a((o=t&&t.status,typeof o===u?o.apply(t):o))+'">'+a((o=t&&t.status,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Subnet ID</dt><dd>"+a((o=t&&t.subnet_id,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Address</dt><dd>"+a((o=t&&t.address,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Connection Limit</dt><dd>"+a((o=t&&t.connection_limit,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Protocol</dt><dd>"+a((o=t&&t.protocol,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Protocol Port</dt><dd>"+a((o=t&&t.protocol_port,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Pool ID</dt><dd>"+a((o=t&&t.pool_id,typeof o===u?o.apply(t):o))+'</dd>\n    </dl>\n</div>\n\n<div class="option-group-head expand">\n    Port Details\n</div>\n<div class="option-group">\n\n</div>',s};return e.template(t)}),function(){define("workspaces/oseditor/property/oslistener/appView",["constant","../OsPropertyView","../osport/view","./template/app","CloudResources"],function(e,t,n,r,i){return t.extend({render:function(){return this.$el.html(r(this.getRenderData())),this.$el.append(this.reg(new n({model:this.model,appModel:this.genModelForPort()})).render().el),this},genModelForPort:function(){var t,n;return n=Design.instance().region(),t=this.appModel.get("port_id"),i(e.RESTYPE.OSPORT,n).get(t)}},{handleTypes:[e.RESTYPE.OSLISTENER],handleModes:["app"]})})}.call(this),define("workspaces/oseditor/property/ospool/template/stack",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\n<dl class="dl-vertical">ID<dt></dt><dd>'+a((r=(r=e&&e.app,r==null||r===!1?r:r.id),typeof r===u?r.apply(e):r))+'</dd>\n    Status<dt></dt><dd class="os-status os-status-'+a((r=(r=e&&e.app,r==null||r===!1?r:r.status),typeof r===u?r.apply(e):r))+'">'+a((r=(r=e&&e.app,r==null||r===!1?r:r.status),typeof r===u?r.apply(e):r))+"</dd>\n    <dt>Subnet ID</dt><dd>"+a((r=(r=e&&e.app,r==null||r===!1?r:r.subnet_id),typeof r===u?r.apply(e):r))+"</dd></dl>\n",n}function c(e,t){return"disabled"}function h(e,t){var n="",r;return n+="\n    <header>"+a((r=(r=e&&e.osport,r==null||r===!1?r:r.name),typeof r===u?r.apply(e):r))+'</header>\n    <section class="group required">\n        <label class="name">Weight</label>\n        <input data-id="mem-weight" data-index="'+a((r=t==null||t===!1?t:t.index,typeof r===u?r.apply(e):r))+'" data-target="weight" class="selection string" value="'+a((r=e&&e.weight,typeof r===u?r.apply(e):r))+'"/>\n    </section>\n\n    <section class="group required">\n        <label class="name">Protocol Port</label>\n        <input data-id="mem-port" data-target="port" data-index="'+a((r=t==null||t===!1?t:t.index,typeof r===u?r.apply(e):r))+'" class="selection string" value="'+a((r=e&&e.port,typeof r===u?r.apply(e):r))+'"/>\n    </section>\n    ',n}function p(e,t){return'\n    <div class="os-property-message">\n        <h5>No Member</h5>\n        Connect Pool with Port or Server to register as Member\n    </div>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\n\n<div class="option-group-head expand">\n    Pool\n</div>\n<div class="option-group pool-details">\n    <section class="group required">\n        <label class="name">Name</label>\n        <input data-id="pool-name" data-target="name" class="selection string" value="'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'"/>\n    </section>\n\n    <section class="group">\n        <label class="name">Description</label>\n        <input data-target="description" class="selection string" value="'+a((o=t&&t.description,typeof o===u?o.apply(t):o))+'"/>\n    </section>\n\n    <section class="group required">\n        <label class="name">Protocol</label>\n        <select class="selection option" value="'+a((o=t&&t.protocol,typeof o===u?o.apply(t):o))+'" data-target="protocol" data-id="pool-protocol" ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;s+='>\n            <option value=\'HTTP\'>HTTP</option>\n            <option value=\'HTTPS\'>HTTPS</option>\n            <option value=\'TCP\'>TCP</option>\n        </select>\n    </section>\n\n    <section class="group required">\n        <label class="name">Load Balancing Method</label>\n        <select class="selection option" value="'+a((o=t&&t.method,typeof o===u?o.apply(t):o))+'" data-target="method" data-id="listener-method">\n            <option value=\'ROUND_ROBIN\'>Round Robin</option>\n            <option value=\'LEAST_CONNECTIONS\'>Least Connections</option>\n            <option value=\'SOURCE_IP\'>Source IP</option>\n        </select>\n    </section>\n</div>\n\n<div class="option-group-head expand">\n    Member('+a((o=(o=t&&t.mems,o==null||o===!1?o:o.length),typeof o===u?o.apply(t):o))+')\n</div>\n<div class="option-group" data-model="mem">\n    ',o=n.each.call(t,t&&t.mems,{hash:{},inverse:f.program(7,p,i),fn:f.program(5,h,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s};return e.template(t)}),define("workspaces/oseditor/property/oshmlist/stack",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n        <select placeholder="add health monitor..." class="selection option mutil show-input item-list" data-target="hmlist" value="'+a((i=e&&e.activeList,typeof i===u?i.apply(e):i))+'" data-button-tpl="button" data-item-tpl="getItem" ',i=n["if"].call(e,e&&e.isApp,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;r+=">\n            ",i=n.each.call(e,e&&e.list,{hash:{},inverse:f.noop,fn:f.program(4,h,t),data:t});if(i||i===0)r+=i;return r+="\n        </select>\n        ",r}function c(e,t){return"disabled"}function h(e,t){var n="",r;return n+='\n            <option value="'+a((r=e&&e.id,typeof r===u?r.apply(e):r))+'">'+a((r=e&&e.name,typeof r===u?r.apply(e):r))+"</option>\n            ",n}function p(e,t){return'\n        <div class="os-property-message">\n            No Health Monitor\n        </div>\n        '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="option-group-head expand">\n    Health Monitor('+a((o=(o=t&&t.list,o==null||o===!1?o:o.length),typeof o===u?o.apply(t):o))+')\n</div>\n<div class="option-group">\n    <section class="group">\n        ',o=n.ifLogic.call(t,t&&t.list,"or",t&&t.mustShowList,{hash:{},inverse:f.program(6,p,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n    </section>\n</div>",s},n.stack=e.template(t),t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+=" | "+a((r=e&&e.urlPath,typeof r===u?r.apply(e):r)),n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="item hm-item">\n    <div class="item-name">'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'</div>\n    <div class="item-info">'+a((o=t&&t.type,typeof o===u?o.apply(t):o)),o=n["if"].call(t,t&&t.urlPath,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='</div>\n    <div class="item-remove icon-del tooltip" data-tooltip="Unassotiate Health Monitor"></div>\n</div>',s},n.item=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div>Create <span class="default">New Health Monitor...</span><span class="new"></span></div>'},n.addButton=e.template(t),n}),define("workspaces/oseditor/property/oshmlist/app",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n        <ul class="item-readable-list">\n        ',i=n.each.call(e,e&&e.list,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n    </ul>\n    ",r}function c(e,t){var r="",i;r+='\n        <li class="item hm-item" data-id="'+a((i=e&&e.id,typeof i===u?i.apply(e):i))+'">\n            <div class="item-name">'+a((i=e&&e.name,typeof i===u?i.apply(e):i))+'</div>\n            <div class="item-info">'+a((i=e&&e.type,typeof i===u?i.apply(e):i)),i=n["if"].call(e,e&&e.url_path,{hash:{},inverse:f.noop,fn:f.program(3,h,t),data:t});if(i||i===0)r+=i;return r+="</div>\n        </li>\n        ",r}function h(e,t){var n="",r;return n+=" | "+a((r=e&&e.url_path,typeof r===u?r.apply(e):r)),n}function p(e,t){return'\n        <div class="os-property-message">No Health Monitor</div>\n    '}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="option-group-head expand">\n    Health Monitor('+a((o=(o=t&&t.list,o==null||o===!1?o:o.length),typeof o===u?o.apply(t):o))+')\n</div>\n<div class="option-group">\n    ',o=n["if"].call(t,t&&t.list,{hash:{},inverse:f.program(5,p,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s},n.stack=e.template(t),n}),define("workspaces/oseditor/property/oshm/stack",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<h1 class="title">'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'</h1>\n<section class="group required">\n    <label class="name">Name</label>\n    <input data-id="hm-name" data-target="name" class="selection string" value="'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'"/>\n</section>\n<section class="group required">\n    <label class="name">Type</label>\n    <select class="selection option" value="'+a((o=t&&t.type,typeof o===u?o.apply(t):o))+'" data-target="type" data-id="hm-method" ',o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='>\n        <option value=\'PING\'>PING</option>\n        <option value=\'HTTP\'>HTTP</option>\n        <option value=\'HTTPS\'>HTTPS</option>\n        <option value=\'TCP\'>TCP</option>\n    </select>\n</section>\n\n<section class="group required">\n    <label class="name">Delay</label>\n    <input data-id="hm-delay" data-target="delay" class="selection string" value="'+a((o=t&&t.delay,typeof o===u?o.apply(t):o))+'"/>\n</section>\n\n<section class="group required">\n    <label class="name">Timeout</label>\n    <input data-id="hm-timeout" data-target="timeout" class="selection string" value="'+a((o=t&&t.timeout,typeof o===u?o.apply(t):o))+'"/>\n</section>\n\n<section class="group required">\n    <label class="name">Max Retries</label>\n    <input data-id="hm-maxretries" data-target="maxRetries" class="selection string" value="'+a((o=t&&t.maxRetries,typeof o===u?o.apply(t):o))+'"/>\n</section>\n\n<section class="group required">\n    <label class="name">URL Path</label>\n    <input data-id="hm-urlpath" data-target="urlPath" class="selection string" value="'+a((o=t&&t.urlPath,typeof o===u?o.apply(t):o))+'"/>\n</section>\n\n<section class="group required">\n    <label class="name">Expected Codes</label>\n    <input data-id="hm-expectedcodes" data-target="expectedCodes" class="selection string" value="'+a((o=t&&t.expectedCodes,typeof o===u?o.apply(t):o))+'"/>\n</section>',s};return e.template(t)}),define("workspaces/oseditor/property/oshm/app",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+="\n        <dt>URL Path</dt><dd>"+a((r=e&&e.url_path,typeof r===u?r.apply(e):r))+"</dd>\n    ",n}function c(e,t){var n="",r;return n+="\n        <dt>Expected Codes</dt><dd>"+a((r=e&&e.expected_codes,typeof r===u?r.apply(e):r))+"</dd></dl>\n    ",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<h1 class="title">'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'</h1>\n<section class="group">\n    <dl class="dl-vertical">\n        <dt>Name</dt><dd>'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>ID</dt><dd>"+a((o=t&&t.id,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Type</dt><dd>"+a((o=t&&t.type,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Delay</dt><dd>"+a((o=t&&t.delay,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Timeout</dt><dd>"+a((o=t&&t.timeout,typeof o===u?o.apply(t):o))+"</dd>\n        <dt>Max Retries</dt><dd>"+a((o=t&&t.max_retries,typeof o===u?o.apply(t):o))+"</dd>\n    ",o=n["if"].call(t,t&&t.url_path,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+="\n    ",o=n["if"].call(t,t&&t.expected_codes,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+="\n</section>",s};return e.template(t)}),function(){define("workspaces/oseditor/property/oshm/view",["constant","../OsPropertyView","./stack","./app","CloudResources","UI.selection","../validation/ValidationBase"],function(e,t,n,r,i,s,o){return t.extend({events:{"change .selection[data-target]":"updateAttribute"},initialize:function(e){this.isApp=e.isApp;if(this.isApp)return this.modelData=e.modelData},setTitle:function(e){return this.$("h1").text(e)},toggleUrlAndCodes:function(){var e,t,n;return e=(n=this.model)!=null?n.get("type"):void 0,t=e==="PING"||e==="TCP"?!1:!0,this.$('[data-id="hm-urlpath"]').closest("section").toggle(t),this.$('[data-id="hm-expectedcodes"]').closest("section").toggle(t)},updateAttribute:function(e){var n,r;n=$(e.currentTarget),r=n.data("target"),t.prototype.updateAttribute.call(this,e);if(r==="type")return this.toggleUrlAndCodes()},render:function(){var t;return this.isApp?this.$el.html(r(this.modelData)):(t=o.getClass(e.RESTYPE.OSHM),s(this.$el,this.selectTpl,new t({model:this.model})),this.$el.html(n(this.getRenderData()))),this.isApp||this.toggleUrlAndCodes(),this}},{handleTypes:[e.RESTYPE.OSHM],handleModes:["stack","appedit"]})})}.call(this),function(){define("workspaces/oseditor/property/oshmlist/view",["constant","../OsPropertyView","./stack","./app","CloudResources","../oshm/view","UI.selection","../validation/ValidationBase"],function(e,t,n,r,i,s,o,u){return t.extend({events:{"change .selection[data-target]":"updateAttribute","select_dropdown_button_click .item-list":"addItem","click .item-list .item":"editItem","click .item-readable-list .item":"viewItem","click .item-list .item .item-remove":"removeItem"},initialize:function(e){var t;return this.targetModel=e.targetModel,this.isApp=e.isApp,this.isApp&&(this.appModelList=this.targetModel,delete this.targetModel),t=this,this.selectTpl={button:function(){return t.getTpl().addButton()},getItem:function(e){return t.getTpl().item(t.getItemData(e))}}},getModelForMode:function(){return this.targetModel},getItemData:function(e){return Design.instance().component(e.value).toJSON()},getAppData:function(){var t;return t=Design.modelClassForType(e.RESTYPE.OSHM),_.map(this.appModelList,function(e){var n,r;return n=e.toJSON(),r=t.find(function(e){return e.get("appId")===n.id}),n.name=r!=null?r.get("name"):void 0,n})},getSingleAppData:function(e){return _.findWhere(this.getAppData(),{id:e})},getTpl:function(){return this.isApp?r:n},render:function(){var t;return t=u.getClass(e.RESTYPE.OSHM),o(this.$el,this.selectTpl,new t({view:this})),this.isApp?this.renderApp():this.refreshList(),this},refreshList:function(){var e;return e=this.targetModel.get("healthMonitors").map(function(e){return e.toJSON()}),this.$el.html(this.getTpl().stack({activeList:this.targetModel.get("healthMonitors").map(function(e){return e.id}).join(","),list:e,mustShowList:!this.isApp}))},renderApp:function(){return this.$el.html(this.getTpl().stack({list:this.getAppData()}))},getSelectItemModel:function(e){var t;return t=e.data("value"),Design.instance().component(t)},updateAttribute:function(e){var t,n,r;return t=$(e.currentTarget),n=t.data("target"),r=t.getValue()},addItem:function(e,t){var n,r;return r=this.targetModel.addNewHm(t),this.refreshList(),n=this.$el.find('.item-list .item[data-value="'+r.get("id")+'"]'),n.click()},editItem:function(e){var t,n,r;return t=$(e.currentTarget),n=this.getSelectItemModel(t),r=this.reg(new s({model:n,isApp:this.isApp})),this.listenTo(n,"change",this.refreshList),this.showFloatPanel(r.render().el)},viewItem:function(e){var t,n,r,i;return t=$(e.currentTarget),$(".item-readable-list .item").removeClass("focus"),t.addClass("focus"),n=t.data("id"),r=this.getSingleAppData(n),i=this.reg(new s({modelData:r,isApp:this.isApp})),this.showFloatPanel(i.render().el)},removeItem:function(e){var t,n;return t=$(e.currentTarget),n=t.closest(".item").data("value"),this.targetModel.removeHm(n),this.refreshList(),this.hideFloatPanel(),!1}},{handleTypes:["ossglist"],handleModes:["stack","appedit"]})})}.call(this),function(){define("workspaces/oseditor/property/ospool/view",["constant","../OsPropertyView","./template/stack","../oshmlist/view"],function(e,t,n,r){return t.extend({events:{"change .selection[data-target]":"updateAttribute"},initialize:function(){return this.memConn=this.model.connections("OsPoolMembership"),this.hmlistView=this.reg(new r({targetModel:this.model}))},render:function(){return this.$el.html(n(this.getRenderData())),this.renderHmlist(),this},getModelJson:function(){var e;return e=t.prototype.getModelJson.call(this),e.mems=_.map(this.memConn,function(e){var t,n;return n=e.getPort(),t=e.toJSON(),t.osport=e.getPort().toJSON(),n.isEmbedded()&&(t.osport.name=n.owner().get("name")),t}),e},renderHmlist:function(){return this.$(".pool-details").after(this.hmlistView.render().el)},getModelForUpdateAttr:function(e){var t,n;t=$(e.currentTarget),n=t.data("model"),n||(n=t.closest("[data-model]").data("model"));switch(n){case"hm":return this.hm;case"mem":return this.memConn[t.data("index")];default:return this.model}},updateAttribute:function(e){var t,n,r,i;r=this.getModelForUpdateAttr(e),t=$(e.currentTarget),n=t.data("target"),i=t.getValue(),(n==="weight"||n==="port")&&r.set("appId",""),r.set(n,i);if(n==="name")return this.setTitle(i)}},{handleTypes:[e.RESTYPE.OSPOOL],handleModes:["stack","appedit"]})})}.call(this),define("workspaces/oseditor/property/ospool/template/app",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){var r="",i;return r+="\n    <header>"+a((i=e&&e.name,typeof i===u?i.apply(e):i))+" ("+a((i=e&&e.address,typeof i===u?i.apply(e):i))+')</header>\n    <section class="group">\n        <dl class="dl-vertical">\n            <dt>Status</dt><dd class="os-status os-status-'+a((i=e&&e.status,typeof i===u?i.apply(e):i))+'">'+a(n.emptyStr.call(e,e&&e.status,{hash:{},data:t}))+"</dd>\n            <dt>Weight</dt><dd>"+a(n.emptyStr.call(e,e&&e.weight,{hash:{},data:t}))+"</dd>\n        </dl>\n    </section>\n",r}function c(e,t){return'\n    <div class="os-property-message">\n        No Member\n    </div>\n'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="option-group-head expand">\n    Pool Details\n</div>\n<div class="option-group pool-details">\n    <dl class="dl-vertical">\n        <dt>Name</dt><dd>'+a(n.emptyStr.call(t,t&&t.name,{hash:{},data:i}))+"</dd>\n        <dt>Description</dt><dd>"+a(n.emptyStr.call(t,t&&t.description,{hash:{},data:i}))+"</dd>\n        <dt>ID</dt><dd>"+a(n.emptyStr.call(t,t&&t.id,{hash:{},data:i}))+'</dd>\n        <dt>Status</dt><dd class="os-status os-status-'+a((o=t&&t.status,typeof o===u?o.apply(t):o))+'">'+a(n.emptyStr.call(t,t&&t.status,{hash:{},data:i}))+"</dd>\n        <dt>Subnet ID</dt><dd>"+a(n.emptyStr.call(t,t&&t.subnet_id,{hash:{},data:i}))+"</dd>\n        <dt>Protocol</dt><dd>"+a(n.emptyStr.call(t,t&&t.protocol,{hash:{},data:i}))+"</dd>\n        <dt>LB Method</dt><dd>"+a(n.emptyStr.call(t,t&&t.lb_method,{hash:{},data:i}))+"</dd>\n        <dt>Provider</dt><dd>"+a(n.emptyStr.call(t,t&&t.provider,{hash:{},data:i}))+'</dd>\n    </dl>\n</div>\n\n<div class="option-group-head expand">\n    Member('+a((o=(o=t&&t.members,o==null||o===!1?o:o.length),typeof o===u?o.apply(t):o))+')\n</div>\n<div class="option-group ">\n',o=n.each.call(t,t&&t.members,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s};return e.template(t)}),function(){define("workspaces/oseditor/property/ospool/appView",["constant","../OsPropertyView","../osport/view","../oshmlist/view","./template/app","CloudResources"],function(e,t,n,r,i,s){return t.extend({initialize:function(){var t,n;return t=Design.instance().region(),this.hmList=_.map((n=this.appModel)!=null?n.get("health_monitors"):void 0,function(n){return s(e.RESTYPE.OSHM,t).get(n)}),this.hmlistView=this.reg(new r({targetModel:this.hmList,isApp:!0}))},render:function(){return this.$el.html(i(this.getRenderData())),this.renderHmlist(),this},getModelJson:function(){var t,n,r;return n=((r=this.appModel)!=null?r.toJSON():void 0)||{},n=$.extend(!0,{},n),t=Design.modelClassForType(e.RESTYPE.OSPORT),_.each(n.members,function(e){var n;n=t.find(function(t){return t.get("ip")===e.address});if(!n)return;return e.name=n.isEmbedded()?n.owner().get("name"):n.get("name"),null}),n},renderHmlist:function(){return this.$(".pool-details").after(this.hmlistView.render().el)}},{handleTypes:[e.RESTYPE.OSPOOL],handleModes:["app"]})})}.call(this),define("workspaces/oseditor/property/osrouter/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n<section class="group">\n    <dl class="dl-vertical">\n        <dt>ID</dt><dd>'+u(n.emptyStr.call(e,e&&e.appId,{hash:{},data:t}))+'</dd>\n        <dt>Status</dt><dd class="os-status os-status-'+u((i=e&&e.status,typeof i===a?i.apply(e):i))+'">'+u(n.emptyStr.call(e,(i=e&&e.app,i==null||i===!1?i:i.status),{hash:{},data:t}))+"</dd>\n    </dl>\n</section>\n",r}function c(e,t){var n="";return n+='<option value="'+u(typeof e===a?e.apply(e):e)+'">'+u(typeof e===a?e.apply(e):e)+"</option>",n}function h(e,t){return"hide"}function p(e,t){var n="",r;return n+='\n    <section class="group">\n        <div class="main">'+u((r=e&&e.name,typeof r===a?r.apply(e):r))+'</div>\n        <div class="sub">('+u((r=e&&e.cidr,typeof r===a?r.apply(e):r))+")</div>\n    </section>\n    ",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;o=n["if"].call(t,t&&t.modeIsAppEdit,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\n<div class="option-group-head expand">\n    Router Detail\n</div>\n<div class="option-group">\n    <section class="group required">\n        <label class="name">Router Name</label>\n        <input data-target="name" class="selection string" value="'+u((o=t&&t.name,typeof o===a?o.apply(t):o))+'"/>\n    </section>\n    <section class="group required os-property-router-extnetwork">\n        <label class="name">External Network</label>\n        <select data-target="extNetworkId" class="selection option" value="'+u((o=t&&t.extNetworkId,typeof o===a?o.apply(t):o))+'">\n            <option value="none">Disable Public Network</option>\n            ',o=n.each.call(t,t&&t.extnetworks,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;s+='\n        </select>\n    </section>\n    <section class="group required os-property-router-nat ',o=n.unless.call(t,t&&t.extNetworkId,{hash:{},inverse:f.noop,fn:f.program(5,h,i),data:i});if(o||o===0)s+=o;s+='">\n        <label class="name">Enable NAT</label>\n        <select data-target="nat" class="selection bool" value="true" disabled></select>\n    </section>\n    <!-- <section class="group required">\n        <label class="name">Total Bandwidth</label>\n        <select data-target="totalBandwidth" class="selection option" value="'+u((o=t&&t.totalBandwidth,typeof o===a?o.apply(t):o))+'">\n            <option value="1">1</option>\n            <option value="2">2</option>\n            <option value="3">3</option>\n            <option value="4">4</option>\n            <option value="5">5</option>\n            <option value="6">6</option>\n            <option value="7">7</option>\n            <option value="8">8</option>\n            <option value="9">9</option>\n            <option value="10">10</option>\n        </select>\n    </section> -->\n</div>\n<div class="option-group-head expand">\n    Connected Subnet\n</div>\n<div class="option-group">\n    ',o=n.each.call(t,t&&t.subnets,{hash:{},inverse:f.noop,fn:f.program(7,p,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s},n.stackTemplate=e.template(t),t=function(e,t,n,r,i){function l(e,t){return"true"}function c(e,t){return"false"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<section class="group">\n    <dl class="dl-vertical">\n        <dt>Name</dt><dd>'+u(n.emptyStr.call(t,t&&t.name,{hash:{},data:i}))+"</dd>\n        <dt>ID</dt><dd>"+u(n.emptyStr.call(t,t&&t.id,{hash:{},data:i}))+'</dd>\n        <dt>Status</dt><dd class="os-status os-status-'+u((o=t&&t.status,typeof o===a?o.apply(t):o))+'">'+u(n.emptyStr.call(t,t&&t.status,{hash:{},data:i}))+"</dd>\n        <dt>Enable NAT</dt><dd>",o=n["if"].call(t,(o=t&&t.external_gateway_info,o==null||o===!1?o:o.enable_snat),{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="</dd>\n    </dl>\n</section>",s},n.appTemplate=e.template(t),n}),function(){define("workspaces/oseditor/property/osrouter/view",["constant","../OsPropertyView","./template","CloudResources"],function(e,t,n,r){return t.extend({events:{"change .selection[data-target]":"updateAttribute"},render:function(){var t,i,s,o,u;return(o=this.mode())==="stack"||o==="appedit"?(void 0,s=this.model.connectionTargets("OsRouterAsso"),t=this.model.toJSON(),t.subnets=_.map(s,function(e){return e.toJSON()}),this.mode()==="appedit"&&(i=this.getRenderData(),i&&_.extend(t,i),t.status=i!=null?(u=i.app)!=null?u.status:void 0:void 0),void 0,t.extnetworks=r(e.RESTYPE.OSNETWORK,Design.instance().region()).getExtNetworks().map(function(e){return e.id}),this.$el.html(n.stackTemplate(t))):this.$el.html(n.appTemplate(this.getRenderData())),this},updateAttribute:function(e){var t,n,r,i;t=$(e.currentTarget),n=t.data("target"),i=t.getValue(),n==="extNetworkId"&&(i==="none"&&(i=""),r=this.$el.find('.selection[data-target="nat"]'),i?this.model.get(n)||r.setValue(!0):r.setValue(!1),this.$el.find(".os-property-router-nat").toggleClass("hide",!i)),this.model.set(n,i);if(n==="name")return this.setTitle(i)}},{handleTypes:[e.RESTYPE.OSRT],handleModes:["stack","appedit","app"]})})}.call(this),define("workspaces/oseditor/property/osnetwork/template",["handlebars"],function(e){var t=function(e,t,n,r,i){function f(e,t){var r="",i;r+="\n",i=n["if"].call(e,e&&e.modeIsAppEdit,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;return r+='\n<section class="group required">\n    <label class="name">Name</label>\n    <input data-target="name" class="selection string" value="'+u((i=e&&e.name,typeof i===o?i.apply(e):i))+'"/>\n</section>\n',r}function l(e,t){var n="",r;return n+='\n<dl class="dl-vertical"><dt>ID</dt><dd>'+u((r=(r=e&&e.app,r==null||r===!1?r:r.id),typeof r===o?r.apply(e):r))+"</dd></dl>\n",n}function c(e,t){var n="",r;return n+='\n<dl class="dl-vertical"><dt>Name</dt><dd>'+u((r=e&&e.name,typeof r===o?r.apply(e):r))+"</dd><dt>ID</dt><dd>"+u((r=e&&e.id,typeof r===o?r.apply(e):r))+"</dd></dl>\n",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.unless.call(t,t&&t.modeIsApp,{hash:{},inverse:a.program(4,c,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""};return e.template(t)}),function(){define("workspaces/oseditor/property/osnetwork/view",["constant","../OsPropertyView","./template"],function(e,t,n){return t.extend({render:function(){return this.$el.html(n(this.getRenderData())),this}},{handleTypes:[e.RESTYPE.OSNETWORK],handleModes:["stack","app","appedit"]})})}.call(this),define("workspaces/oseditor/property/osrouter-asso/template",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="os-property-message">\n    This is a connection of '+a((o=t&&t.namePort1,typeof o===u?o.apply(t):o))+" and "+a((o=t&&t.namePort2,typeof o===u?o.apply(t):o))+".\n</div>",s};return e.template(t)}),function(){define("workspaces/oseditor/property/osrouter-asso/view",["constant","../OsPropertyView","./template"],function(e,t,n){return t.extend({render:function(){var t,r;return t=this.model.getTarget(e.RESTYPE.OSSUBNET).get("name"),r=this.model.getTarget(e.RESTYPE.OSRT).get("name"),this.$el.html(n({namePort1:t,namePort2:r})),this}},{handleTypes:["OsRouterAsso"],handleModes:["stack","app","appedit"]})})}.call(this),define("workspaces/oseditor/property/osport-usage/template",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="os-property-message">\n    This is an association of '+a((o=t&&t.namePort1,typeof o===u?o.apply(t):o))+" and "+a((o=t&&t.namePort2,typeof o===u?o.apply(t):o))+".\n</div>",s};return e.template(t)}),function(){define("workspaces/oseditor/property/osport-usage/view",["constant","../OsPropertyView","./template"],function(e,t,n){return t.extend({render:function(){var t,r;return t=this.model.getTarget(e.RESTYPE.OSSERVER).get("name"),r=this.model.getTarget(e.RESTYPE.OSPORT).get("name"),this.$el.html(n({namePort1:t,namePort2:r})),this}},{handleTypes:["OsPortUsage"],handleModes:["stack","app","appedit"]})})}.call(this),function(){define("workspaces/oseditor/property/OsPropertyBundle",["./default/view","./globalconfig/view","./ossubnet/view","./osserver/view","./osserver/appView","./osvol/view","./osvol/appView","./oslistener-asso/view","./ospool-membership/view","./oslistener/view","./oslistener/appView","./ospool/view","./ospool/appView","./osport/view","./osrouter/view","./osnetwork/view","./osrouter-asso/view","./osrouter-asso/view","./osport-usage/view"],function(){})}.call(this),function(){define("workspaces/oseditor/property/validation/osport",["constant","./ValidationBase","i18n!/nls/lang.js"],function(e,t,n){return t.extend({limits:{ip:t.limit.ipv4},ip:function(t){var r,i,s,o,u,a;if(!MC.validate("ipv4",t))return"Invalid IP Address";u=this.model.parent();if(u.type===e.RESTYPE.OSSUBNET){o=u.get("cidr"),a=Design.modelClassForType(e.RESTYPE.SUBNET).isIPInSubnet(t,o,[0,1,2]);if(!a.isValid)return a.isReserved?n.IDE.VALIDATION_IP_IN_SUBNET_REVERSED_RANGE:n.IDE.VALIDATION_IP_CONFLICTS_WITH_SUBNET_IP_RANGE}return s=this.model,this.model.type===e.RESTYPE.OSSERVER&&this.model.embedPort&&(s=this.model.embedPort()),i=Design.modelClassForType(e.RESTYPE.OSPORT).allObjects(),i=i.concat(Design.modelClassForType(e.RESTYPE.OSLISTENER).allObjects()),r=!1,_.each(i,function(e){if(e===s)return;return t===e.get("ip")&&(r=!0),null}),r?n.IDE.VALIDATION_IP_CONFLICTS_WITH_OTHER_IP:null}},{handleTypes:[e.RESTYPE.OSPORT]})})}.call(this),function(){define("workspaces/oseditor/property/validation/oselb",["constant","./ValidationBase","./osport"],function(e,t,n){return t.extend({limits:{weight:t.limit.positive,port:t.limit.positive},weight:t.validation.range(null,256)},{handleTypes:[e.RESTYPE.OSPOOL]}),t.extend({limits:{delay:t.limit.positive,timeout:t.limit.positive,maxRetries:t.limit.positive,hmlist:t.limit.osname},delay:t.validation.range4G(),timeout:t.validation.range4G(),maxRetries:t.validation.range(null,3)},{handleTypes:[e.RESTYPE.OSHM]}),t.extend({limits:{ip:t.limit.ipv4,port:t.limit.positive,limit:t.limit.positive},limit:t.validation.range4G(),ip:(new n).ip},{handleTypes:[e.RESTYPE.OSLISTENER]})})}.call(this),function(){define("workspaces/oseditor/property/validation/ossg",["constant","./ValidationBase"],function(e,t){return t.extend({limits:{port:t.limit.portICMPRange,sglist:t.limit.osname},port:function(e,t){var n,r,i;n=e,r=t.prevAll('.selection[data-target="protocol"]').getValue(),i="Port/Type/Code range invalid";if(r==="icmp"){n=this.view.getICMPRange(n);if(n===null)return i}else if(r==="tcp"||r==="udp"){n=this.view.getPortRange(n);if(n===null)return i}}},{handleTypes:[e.RESTYPE.OSSG]})})}.call(this),function(){define("workspaces/oseditor/property/validation/osserver",["constant","./ValidationBase","./osport"],function(e,t,n){return t.extend({limits:{fixedIp:t.limit.ipv4},fixedIp:(new n).ip},{handleTypes:[e.RESTYPE.OSSERVER]})})}.call(this),function(){define("workspaces/oseditor/property/validation/ossubnet",["constant","./ValidationBase"],function(e,t){return t.extend({limits:{cidr:t.limit.cidrv4,iplist:t.limit.ipv4},cidr:function(e){return MC.validate("cidr",e)?null:"Invalid CIDR Address"}},{handleTypes:[e.RESTYPE.OSSUBNET]})})}.call(this),function(){define("workspaces/oseditor/property/validation/osrouter",["constant","./ValidationBase"],function(e,t){return t.extend({},{handleTypes:[e.RESTYPE.OSRT]})})}.call(this),function(){define("workspaces/oseditor/property/validation/osnetwork",["constant","./ValidationBase"],function(e,t){return t.extend({},{handleTypes:[e.RESTYPE.OSNETWORK]})})}.call(this),function(){define("workspaces/oseditor/property/validation/volume",["constant","./ValidationBase","i18n!/nls/lang.js"],function(e,t,n){return t.extend({mountPoint:function(e){var t;return!e.indexOf(!1)||e.length!==8||(t=e.split("").pop())!=="f"&&t!=="g"&&t!=="h"&&t!=="i"&&t!=="j"&&t!=="k"&&t!=="l"&&t!=="m"&&t!=="n"&&t!=="o"&&t!=="p"&&t!=="q"&&t!=="r"&&t!=="s"&&t!=="t"&&t!=="u"&&t!=="v"&&t!=="w"&&t!=="x"&&t!=="y"&&t!=="z"?sprintf(n.PARSLEY.THIS_VALUE_SHOULD_BE_A_VALID_XXX,"mount point"):null},size:function(e){return e&&(new RegExp(t.limit.positive)).test(e)?null:sprintf(n.PARSLEY.THIS_VALUE_SHOULD_BE_A_VALID_XXX,"number")}},{handleTypes:[e.RESTYPE.OSVOL]})})}.call(this),function(){define("workspaces/oseditor/property/validation/ValidationBundle",["./oselb","./ossg","./osport","./osserver","./ossubnet","./osrouter","./osnetwork","./volume"],function(){})}.call(this),define("workspaces/oseditor/subviews/panels/template/TplPropertyPanel",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<h1 class="title">'+a((o=t&&t.title,typeof o===u?o.apply(t):o))+"</h1>",s},n.title=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="os-property-res-inexist">Select a resource on canvas to view property</div>'},n.empty=e.template(t),n}),function(){define("workspaces/oseditor/subviews/panels/PropertyPanel",["backbone","constant","Design","CloudResources","../../property/OsPropertyView","../../property/OsPropertyBundle","../../property/validation/ValidationBase","../../property/validation/ValidationBundle","./template/TplPropertyPanel","UI.selection","ConnectionModel"],function(e,t,n,r,i,s,o,u,a,f,l){return e.View.extend({initialize:function(e){var t,s,u,a,f,l;return t=e.workspace.design.region(),this.options=e,this.uid=e.uid,this.type=e.type,this.panel=e.panel,this.model=n.instance().component(this.uid),this.mode=e.workspace.design.mode(),this.mode==="appedit"&&((s=this.model)!=null?!s.get("appId"):!void 0)&&(this.mode="stack"),this.model&&((u=this.mode)==="app"||u==="appedit")&&((a=this.model)!=null?a.get("appId"):void 0)&&(this.appModel=(f=r(this.type,t))!=null?f.get((l=this.model)!=null?l.get("appId"):void 0):void 0),this.model&&(this.viewClass=i.getClass(this.mode,this.type)),this.viewClass==null&&(this.viewClass=i.getClass(this.mode,"default")),this.validationClass=o.getClass(this.type)},resourceInexist:function(){return this.mode==="stack"?!1:this.appModel?!1:this.model instanceof l?!1:!0},render:function(){var e,t,n,r,i;return t=this.options.workspace.design,e={model:this.model,appModel:this.appModel||null,propertyPanel:this,panel:this.panel,workspace:this.options.workspace},n=this.propertyView=new this.viewClass(e),this.validationClass?r=new this.validationClass(e):r=null,f(this.$el,n.selectTpl,_.extend({view:n},r)),this.setTitle(),this.resourceInexist()?this.$el.append(a.empty()):this.$el.append(n.render().el),(i=this.panel.parent)!=null&&i.$el.attr("data-mode",this.mode),this},setTitle:function(e){var t;e==null&&(e=this.propertyView.getTitle());if(!e)return;return t=this.$("h1.title"),t.size()?t.eq(0).text(e):this.$el.html(a.title({title:e}))},showFloatPanel:function(){return this.panel.showFloatPanel.apply(this.panel,arguments)},hideFloatPanel:function(){return this.panel.hideFloatPanel.apply(this.panel,arguments)},remove:function(){var t;return this.propertyView&&this.propertyView.selectTpl&&f.unbind(this.$el,this.propertyView.selectTpl),(t=this.propertyView)!=null&&t.remove(),e.View.prototype.remove.apply(this,arguments)}})})}.call(this),function(){define("workspaces/oseditor/subviews/panels/ConfigPanel",["backbone","constant","./PropertyPanel","../../property/OsPropertyView"],function(e,t,n,r){return n.extend({initialize:function(e){return n.prototype.initialize.call(this,e),this.type="globalconfig",this.model=this.appModel=Design.instance(),this.viewClass=r.getClass(this.mode,this.type)}})})}.call(this),function(){define("workspaces/oseditor/subviews/Panel",["backbone","constant","../template/TplPanel","./panels/ResourcePanel","./panels/ConfigPanel","./panels/PropertyPanel","StateEditorView"],function(e,t,n,r,i,s,o){var u,a;return u={resource:r,config:i,property:s,state:o},a={uid:"",type:"default"},e.View.extend({events:{"click .anchor li":"__scrollTo","click .option-group-head":"__updateRightPanelOption"},__openArgs:a,__currentPanel:"resource",initialize:function(e){return _.extend(this,e),this.workspace.design.mode()==="app"&&(this.__currentPanel="config"),this.render()},render:function(){return this.setElement(this.parent.$el.find(".OEPanelRight")),this.$el.html(n({})),this.open(this.__currentPanel),this},renderSubPanel:function(e,t){var n;return t=_.extend({workspace:this.workspace,panel:this},t),$(document.activeElement).filter("input, textarea").blur(),(n=this.subPanel)!=null&&n.remove(),this.subPanel=new e(t),this.$(".panel-body").html(this.subPanel.render().el),this.renderStateCount(t),this.__restoreAccordion()},renderStateCount:function(e){var n,r,i,s;return n=this.parent.$el.find(".sidebar-title a.state .state-count"),e&&e.type===t.RESTYPE.OSSERVER?(n.show(),r=Design.instance().component(e.uid),s=r.get("state"),i=0,s&&_.isArray(s)&&(i=s.length),n.text(i)):n.hide()},scrollTo:function(e){var t,n,r,i;return t=this.$(".panel-body"),n=$("section."+e),i=t.offset().top,r=n.offset().top-i+t.scrollTop(),t.animate({scrollTop:r})},open:function(e,t){var n,r,i;t==null&&(t=this.__openArgs),r=this.__currentPanel,n=_.extend({},this.__openArgs),this.__openArgs=t,this.__currentPanel=e,i=u[e];if(!i)return;if(this.hidden())return;return this.$el.removeClass("hide"),this.hideFloatPanel(),this.$el.prop("class","OEPanelRight "+e),this.$el.closest("#OpsEditor").find(".sidebar-title").prop("class","sidebar-title "+e),this.renderSubPanel(i,t),this},floatPanelShowCount:0,showFloatPanel:function(e,t){return this.floatPanelShowCount++,e&&this.$(".panel-float").html(e),this.$(".panel-float").removeClass("hidden"),_.defer(function(e){return function(){return e.$(".panel-body").one("click",e.__hideFloatPanel(e.floatPanelShowCount,t))}}(this))},__hideFloatPanel:function(e,t){var n;return n=this,function(){if(e===n.floatPanelShowCount)return n.hideFloatPanel(),typeof t=="function"?t():void 0}},hideFloatPanel:function(){return this.$(".panel-float").addClass("hidden")},show:function(){return this.$el.removeClass("hidden"),this},hide:function(){return this.$el.addClass("hidden"),$(".sidebar-title").prop("class","sidebar-title"),this},shown:function(){return!this.$el.hasClass("hidden")},hidden:function(){return!this.shown()},openResource:function(e){return this.open("resource",e)},openState:function(e){return this.open("state",e)},openProperty:function(e){return this.open("property",e)},openConfig:function(e){return this.open("config",e)},openCurrent:function(e){return this.workspace.design.mode()==="app"&&this.__currentPanel==="resource"&&(this.__currentPanel="config"),this.open(this.__currentPanel,e)},__openOrHidePanel:function(e){var t;return t=$(e.currentTarget).attr("data-target"),this.__currentPanel===t&&this.shown()?this.hide():(this.show(),this.open(t,this.__openArgs))},__scrollTo:function(e){var t;return t=$(e.currentTarget).data("scrollTo"),this.scrollTo(t)},__updateRightPanelOption:function(e){var t,n,r,i,s,o;n=$(e.currentTarget);if(n.is("button")||n.is("a"))return;r=n.hasClass("expand"),t=n.next(),r?t.css("display","block").slideUp(200):t.slideDown(200),n.toggleClass("expand"),this.__optionStates==null&&(this.__optionStates={});if(!n.closest(".panel-body").size())return;return i=""+this.__currentPanel+"_"+this.workspace.design.mode()+"_"+((o=this.__openArgs)!=null?o.uid:void 0),s=_.map(this.$el.find(".panel-body").find(".option-group-head"),function(e){return $(e).hasClass("expand")}),this.__optionStates[i]=s,!1},__restoreAccordion:function(){var e,t,n,r;e=""+this.__currentPanel+"_"+this.workspace.design.mode()+"_"+((n=this.__openArgs)!=null?n.uid:void 0);if(!(t=(r=this.__optionStates)!=null?r[e]:void 0))return;return this.$(".option-group-head").each(function(e){return $(this).toggleClass("expand",t[e])})}})})}.call(this),define("workspaces/oseditor/template/TplToolbar",["handlebars"],function(e){var t,n={confirm:{},modal:{},"export":{}};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-zoom-in tooltip" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.TIP_ZOOM_IN",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-zoom-out seperator tooltip\" data-tooltip='"+o(n.i18n.call(t,"TOOLBAR.TIP_ZOOM_OUT",{hash:{},data:i}))+"'></button>",s},n.BtnZoom=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-play tooltip toolbar-btn-primary runApp" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.TIP_BTN_RUN_STACK",{hash:{},data:i}))+"'>"+o(n.i18n.call(t,"TOOLBAR.BTN_RUN_STACK",{hash:{},data:i}))+"</button>",s},n.BtnRunStack=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar tooltip icon-save" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.TIP_SAVE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-delete tooltip seperator\" data-tooltip='"+o(n.i18n.call(t,"TOOLBAR.TIP_DELETE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar tooltip icon-duplicate\" data-tooltip='"+o(n.i18n.call(t,"TOOLBAR.TIP_DUPLICATE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-new-stack tooltip seperator\" data-tooltip='"+o(n.i18n.call(t,"TOOLBAR.TIP_CREATE_STACK",{hash:{},data:i}))+"'></button>",s},n.BtnStackOps=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="selectbox btn-toolbar seperator">\n  <button class="selection tooltip icon-send" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.EXPORT",{hash:{},data:i}))+'\'></button>\n  <ul class="dropdown">\n    <li data-analytics-plus="export_png" class="icon-export-png">'+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_PNG",{hash:{},data:i}))+'</li>\n    <li data-analytics-plus="export_json" class="icon-export-json">'+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_JSON",{hash:{},data:i}))+"</li>\n  </ul>\n</div>",s},n.BtnExport=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="tooltip btn-toolbar icon-update-app toolbar-btn-primary" data-tooltip="'+o(n.i18n.call(t,"TOOLBAR.TIP_UPDATE_APP",{hash:{},data:i}))+'">'+o(n.i18n.call(t,"TOOLBAR.EDIT_APP",{hash:{},data:i}))+'</button>\n<button class="tooltip btn-toolbar icon-apply-app toolbar-btn-primary" data-tooltip="'+o(n.i18n.call(t,"TOOLBAR.TIP_SAVE_UPDATE_APP",{hash:{},data:i}))+'">'+o(n.i18n.call(t,"TOOLBAR.APPLY_EDIT",{hash:{},data:i}))+'</button>\n<button class="tooltip btn-toolbar icon-cancel-update-app seperator" data-tooltip="'+o(n.i18n.call(t,"TOOLBAR.TIP_CANCEL_UPDATE_APP",{hash:{},data:i}))+'"></button>',s},n.BtnEditApp=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression;s+='<button class="tooltip btn-toolbar icon-stop" data-tooltip="'+u(n.i18n.call(t,"TOOLBAR.TIP_STOP_APP",{hash:{},data:i}))+'"></button>\n<button class="tooltip btn-toolbar icon-play startApp" data-tooltip="'+u(n.i18n.call(t,"TOOLBAR.TIP_START_APP",{hash:{},data:i}))+'"><span style="display: none">'+u(n.i18n.call(t,"TOOLBAR.START_APP",{hash:{},data:i}))+'</span></button>\n<button class="btn-toolbar tooltip icon-terminate seperator" data-tooltip="',o=n.i18n.call(t,"TOOLBAR.TIP_TERMINATE_APP",{hash:{},data:i});if(o||o===0)s+=o;return s+='"></button>\n<button class="btn-toolbar tooltip icon-save-app seperator" data-tooltip=\''+u(n.i18n.call(t,"TOOLBAR.TIP_SAVE_APP_TO_STACK",{hash:{},data:i}))+"'></button>",s},n.BtnAppOps=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-export-png tooltip seperator" data-analytics-plus="export_png" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_PNG",{hash:{},data:i}))+"'></button>",s},n.BtnPng=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar tooltip icon-refresh seperator" data-tooltip="'+o(n.i18n.call(t,"TOOLBAR.TIP_REFRESH_REOURCES",{hash:{},data:i}))+'"></button>',s},n.BtnReloadRes=e.template(t),t=function(e,t,n,r,i){function f(e,t){return" on"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a=this.escapeExpression;s+='<label class="switch toolbar-visual-ops-switch tooltip',o=n["if"].call(t,t&&t.stateOn,{hash:{},inverse:u.noop,fn:u.program(1,f,i),data:i});if(o||o===0)s+=o;return s+='" data-tooltip="'+a(n.i18n.call(t,"TOOLBAR.TIP_CUSTOM_USER_DATA",{hash:{},data:i}))+'">\n    <span class="switch-label" data-on="'+a(n.i18n.call(t,"TOOLBAR.TOGGLE_VISUALOPS_ON",{hash:{},data:i}))+'" data-off="'+a(n.i18n.call(t,"TOOLBAR.TOGGLE_VISUALOPS_OFF",{hash:{},data:i}))+'"></span>\n    <span class="switch-handle"></span>\n</label>',s},n.BtnSwitchStates=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="icon-reload tooltip btn btn-blue reload-states" data-original="Reload States" data-disabled="Initiating…"  data-tooltip="Instantly rerun all states in this app.">'+o(n.i18n.call(t,"TOOLBAR.RELOAD_STATES",{hash:{},data:i}))+"</button>",s},n.BtnReloadStates=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<header class="sidebar-title resource">\n    <a class="resource tooltip icon-resource" data-target="resource" data-tooltip="Resource (R)"></a>\n    <a class="config tooltip icon-config" data-target="config" data-tooltip="Stack Property (A)"></a>\n    <a class="property tooltip icon-property" data-target="property" data-tooltip="Property (P)"></a>\n    <a class="state tooltip icon-gear" data-target="state" data-tooltip="Instance State (S)">\n        <span class="state-count">99</span>\n    </a>\n</header>'},n.PanelHeaderStack=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<header class="sidebar-title resource" data-mode="app">\n    <a class="resource tooltip icon-resource" data-target="resource" data-tooltip="Resource (R)"></a>\n    <a class="config tooltip icon-config" data-target="config" data-tooltip="App Property (A)"></a>\n    <a class="property tooltip icon-property" data-target="property" data-tooltip="Property (P)"></a>\n    <a class="state tooltip icon-gear" data-target="state" data-tooltip="Instance State (S)">\n        <span class="state-count">99</span>\n    </a>\n</header>'},n.PanelHeaderApp=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="modal-text-wraper">\n    <div class="modal-center-align-helper">\n        <div class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.CONFIRM_ENABLE_STATE",{hash:{},data:i}))+"</div>\n    </div>\n</div>",s},n.confirm.enableState=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="modal-text-wraper">\n    <div class="modal-center-align-helper">\n        <div class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.CANCEL_UPDATE_CONFIRM",{hash:{},data:i}))+'</div>\n        <div class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.DISCARD_UPDATE_CHANGE",{hash:{},data:i}))+"</div>\n    </div>\n</div>",s},n.modal.cancelUpdate=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<div class="modal-text-wraper">\n    <div class="modal-center-align-helper" style="padding:40px 20px;">\n        <div class="modal-text-major"></div>\n        <div class="modal-text-minor">'+u(n.i18n.call(t,"TOOLBAR.POP_BODY_EXPORT_AS_JSON",{hash:{},data:i}))+'</div>\n    </div>\n</div>\n<div class="modal-footer">\n    <a class="btn btn-blue" href="'+u((o=t&&t.data,typeof o===a?o.apply(t):o))+'" target="_blank">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_DOWNLOAD",{hash:{},data:i}))+'</a>\n    <button id="tpl-cancel" class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.export.JSON=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="loading-spinner"></div>\n<section style="margin:10px 10px 0;max-height:420px;overflow:hidden;text-align:center;display:none;"></section>\n<div class="modal-footer">\n    <a class="btn btn-blue" style="display: inline-block;">'+o(n.i18n.call(t,"TOOLBAR.LBL_DOWNLOAD",{hash:{},data:i}))+'</a>\n    <button class="btn modal-close btn-silver">'+o(n.i18n.call(t,"TOOLBAR.LBL_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.export.PNG=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n            <div id="replace_stack" style="padding: 10px 0">\n                <div class="radio">\n                    <input id="radio-replace-stack" type="radio" name="save-stack-type" value="replace" checked>\n                    <label for="radio-replace-stack"></label>\n                </div>\n                <label class="modal-text-minor" for="radio-replace-stack">'+u(n.i18n.call(e,"TOOLBAR.POP_REPLACE_STACK",{hash:{},data:t}))+'</label>\n                <div style="padding: 10px 22px" class="radio-instruction">\n                    '+u(n.i18n.call(e,"TOOLBAR.POP_REPLACE_STACK_INTRO",{hash:{},data:t}))+' "'+u((i=e&&e.input,typeof i===a?i.apply(e):i))+'" '+u(n.i18n.call(e,"TOOLBAR.POP_REPLACE_STACK_INTRO_END",{hash:{},data:t}))+'\n                </div>\n            </div>\n            <div id="save_new_stack">\n                <div class="radio">\n                    <input id="radio-new-stack" type="radio" name="save-stack-type">\n                    <label for="radio-new-stack"></label>\n                </div>\n                <label class="modal-text-minor" for="radio-new-stack">'+u(n.i18n.call(e,"TOOLBAR.POP_SAVE_NEW_STACK",{hash:{},data:t}))+'</label>\n                <div style="padding: 10px 22px" class="radio-instruction hide">\n                    <p>'+u(n.i18n.call(e,"TOOLBAR.POP_SAVE_STACK_INSTRUCTION",{hash:{},data:t}))+'</p>\n                    <input class="input" id="modal-input-value" value="'+u((i=e&&e.stackName,typeof i===a?i.apply(e):i))+'" type="text" style="width: 400px"/>\n                    <div id="stack-name-exist" class="hide" style="color: #ec3c38">\n                        '+u(n.i18n.call(e,"TOOLBAR.POP_STACK_NAME_ERROR",{hash:{},data:t}))+"</div>\n                </div>\n            </div>\n        ",r}function c(e,t){var r="",i;return r+='\n            <div id="name_new_stack">\n                <input id="radio-new-stack" type="hidden" name="save-stack-type" checked>\n                <div style="padding: 10px 22px" class="radio-instruction">\n                    <p>'+u(n.i18n.call(e,"TOOLBAR.POP_SAVE_STACK_INSTRUCTION",{hash:{},data:t}))+'</p>\n                    <input class="input" id="modal-input-value" value="'+u((i=e&&e.stackName,typeof i===a?i.apply(e):i))+'" type="text" style="width: 400px"/>\n                    <div id="stack-name-exist" class="hide" style="color: #ec3c38">'+u(n.i18n.call(e,"TOOLBAR.POP_STACK_NAME_ERROR",{hash:{},data:t}))+"</div>\n                </div>\n            </div>\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<p class="modal-text-minor">'+u(n.i18n.call(t,"TOOLBAR.POP_INTRO_1",{hash:{},data:i}))+'</p>\n<p class="modal-text-minor">'+u(n.i18n.call(t,"TOOLBAR.POP_INTRO_2",{hash:{},data:i}))+'</p>\n<div class="modal-center-align-helper">\n    <div class="modal-control-group">\n        ',o=n["if"].call(t,t&&t.originStackExist,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n    </div>\n</div>",s},n.saveAppToStack=e.template(t),n}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/oseditor/subviews/Toolbar",["OpsModel","../template/TplToolbar","ThumbnailUtil","JsonExporter","ApiRequest","i18n!/nls/lang.js","UI.modalplus","kp_dropdown","ResDiff","constant","event","TaGui","CloudResources","AppAction","UI.notification","backbone"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){return Backbone.View.extend({events:{"click .icon-save":"saveStack","click .icon-delete":"deleteStack","click .icon-duplicate":"duplicateStack","click .icon-new-stack":"createStack","click .icon-zoom-in":"zoomIn","click .icon-zoom-out":"zoomOut","click .icon-export-png":"exportPNG","click .icon-export-json":"exportJson","click .runApp":"runStack","click .icon-stop":"stopApp","click .startApp":"startApp","click .icon-terminate":"terminateApp","click .icon-forget-app":"forgetApp","click .icon-refresh":"refreshResource","click .icon-update-app":"switchToAppEdit","click .icon-apply-app":"applyAppEdit","click .icon-cancel-update-app":"cancelAppEdit","click .toolbar-visual-ops-switch":"opsOptionChanged","click .reload-states":"reloadState","click .icon-save-app":"appToStack","click .sidebar-title a":"openOrHidePanel"},initialize:function(e){var t,r,i,s,o,u,a;_.extend(this,e),s=this.workspace.opsModel,s.isStack()?i=["BtnRunStack","BtnStackOps","BtnZoom","BtnExport","PanelHeaderStack","BtnSwitchStates"]:i=["BtnEditApp","BtnAppOps","BtnZoom","BtnPng","BtnReloadRes","PanelHeaderApp"],o="";for(u=0,a=i.length;u<a;u++)r=i[u],t={stateOn:this.workspace.design.get("agent").enabled},o+=n[r](t);this.workspace.opsModel.isApp()&&this.workspace.design.get("agent").enabled&&(o+=n.BtnReloadStates()),this.setElement(this.parent.$el.find(".OEPanelTop").html(o)),this.updateZoomButtons(),this.updateTbBtns()},openOrHidePanel:function(e){return this.parent.propertyPanel.__openOrHidePanel.call(this.parent.propertyPanel,e)},updateTbBtns:function(){var e,n,r,i,s,o;i=this.workspace.opsModel,i.isApp()&&(void 0,r=this.workspace.isAppEditMode&&this.workspace.isAppEditMode(),this.$el.children(".icon-update-app").toggle(!r),this.$el.children(".icon-apply-app, .icon-cancel-update-app").toggle(r),r?(this.$el.children(".icon-terminate, .icon-forget-app, .icon-stop, .icon-play, .icon-refresh, .icon-save-app, .icon-reload").hide(),this.$el.find(".icon-refresh").hide(),this.$(".sidebar-title").attr("data-mode","stack")):(s=i.testState(t.State.Running),o=i.testState(t.State.Stopped),this.$(".sidebar-title").attr("data-mode","app"),this.$el.children(".icon-terminate, .icon-forget-app, .icon-refresh, .icon-save-app, .icon-reload").show(),this.$el.children(".icon-stop").toggle(i.get("stoppable")&&s),this.$el.children(".icon-play").toggle(o).toggleClass("toolbar-btn-primary seperator",i.testState(t.State.Stopped)).find("span").toggle(o),this.$el.children(".icon-update-app").toggle(!o),this.$el.find(".icon-refresh").toggle(s),e=[].concat(this.workspace.design.componentsOfType(l.RESTYPE.INSTANCE),this.workspace.design.componentsOfType(l.RESTYPE.LC)),n=_.find(e,function(e){var t;return e&&((t=e.attributes.state)!=null?t.length:void 0)>0}),this.$el.find(".reload-states").toggle(!!n))),this.__saving?this.$el.children(".icon-save").attr("disabled","disabled"):this.$el.children(".icon-save").removeAttr("disabled"),this.updateZoomButtons()},saveStack:function(e){var t,n;return $(e.currentTarget).attr("disabled","disabled"),n=this,this.__saving=!0,t=this.workspace.design.serialize(),r.generate(this.parent.getSvgElement())["catch"](function(){return null}).then(function(r){n.workspace.opsModel.save(t,r).then(function(){return n.__saving=!1,$(e.currentTarget).removeAttr("disabled"),notification("info",sprintf(o.NOTIFY.ERR_SAVE_SUCCESS,t.name))},function(){return n.__saving=!1,$(e.currentTarget).removeAttr("disabled"),notification("error",sprintf(o.NOTIFY.ERR_SAVE_FAILED,t.name))})})},deleteStack:function(){return d.deleteStack(this.workspace.opsModel.cid,this.workspace.design.get("name"))},createStack:function(){var e;e=this.workspace.opsModel,App.createOps(e.get("region"),"openstack",e.get("provider"))},duplicateStack:function(){var e;e=App.model.createStackByJson(this.workspace.design.serialize()),App.openOps(e)},zoomIn:function(){return this.parent.canvas.zoomIn(),this.updateZoomButtons()},zoomOut:function(){return this.parent.canvas.zoomOut(),this.updateZoomButtons()},updateZoomButtons:function(){var e;e=this.parent.canvas?this.parent.canvas.scale():1,e<=1?this.$el.find(".icon-zoom-in").attr("disabled","disabled"):this.$el.find(".icon-zoom-in").removeAttr("disabled"),e>=1.6?this.$el.find(".icon-zoom-out").attr("disabled","disabled"):this.$el.find(".icon-zoom-out").removeAttr("disabled")},exportPNG:function(){var e,t,s;t=new u({title:"Export PNG",template:n["export"].PNG(),width:"470",disableFooter:!0,compact:!0,onClose:function(){t=null}}),e=this.workspace.design,s=e.get("name"),r.exportPNG(this.parent.getSvgElement(),{isExport:!0,createBlob:!0,name:s,id:e.get("id"),onFinish:function(e){var n;if(!t)return;t.tpl.find(".loading-spinner").remove(),t.tpl.find("section").show().prepend("<img style='max-height:100%;display:inline-block;' src='"+e.image+"' />"),n=t.tpl.find("a.btn-blue").click(function(){return t.close()}),e.blob?n.click(function(){return i.download(e.blob,""+s+".png"),!1}):n.attr({href:e.image,download:""+s+".png"}),t.resize()}})},exportJson:function(){var e,t,r,s,a;r=this.workspace.design,a=App.user.get("username"),t=MC.dateFormat(new Date,"yyyy-MM-dd"),s=[r.get("name"),a,t].join("-"),e=i.exportJson(r.serialize(),""+s+".json");if(e)return new u({title:o.TOOLBAR.EXPORT_AS_JSON,template:n["export"].JSON(e),width:"470",disableFooter:!0,compact:!0})},reloadState:function(e){var t,n,r;return t=$(e.currentTarget),t.hasClass("disabled")?!1:(t.toggleClass("disabled").html(t.attr("data-disabled")),n=Design.instance().get("id"),r={encoded_user:App.user.get("usercode"),token:App.user.get("defaultToken")},$.ajax({url:API_URL+n,method:"POST",data:JSON.stringify(r),dataType:"json",statusCode:{200:function(){return notification("info",o.NOTIFY.RELOAD_STATE_SUCCESS),c.trigger(c.REFRESH_PROPERTY)},401:function(){return notification("error",o.NOTIFY.RELOAD_STATE_INVALID_REQUEST)},404:function(){return notification("error",o.NOTIFY.RELOAD_STATE_NETWORKERROR)},429:function(){return notification("error",o.NOTIFY.RELOAD_STATE_NOT_READY)},500:function(){return notification("error",o.NOTIFY.RELOAD_STATE_INTERNAL_SERVER_ERROR)}},error:function(){return void 0},success:function(){return void 0}}).always(function(){return window.setTimeout(function(){return t.removeClass("disabled").html(t.attr("data-original"))})}))},runStack:function(e){return d.runStack(e,this.workspace),!1},appToStack:function(){var e,t,r,i,s,a;return t=this.workspace.design.attributes.name,r=this.getStackNameFromApp(t),a=App.model.stackList().get(this.workspace.design.attributes.stack_id),i=function(t){return function(){var n,r,i;MC.Analytics.increase("app_to_stack"),n=e.tpl.find("input[name='save-stack-type']:checked").val()!=="replace";if(!n)return r=Design.instance().serializeAsStack(),r.id=t.workspace.design.attributes.stack_id,e.close(),r.name=a.get("name"),a.save(r).then(function(){return notification("info",sprintf(o.NOTIFY.INFO_HDL_SUCCESS,o.IDE.TOOLBAR_HANDLE_SAVE_STACK,r.name)),App.openOps(a,!0)},function(){return notification("error",sprintf(o.NOTIFY.ERR_SAVE_FAILED,r.name))});i=App.model.createStackByJson(t.workspace.design.serializeAsStack(e.tpl.find("#modal-input-value").val())),e.close(),App.openOps(i)}}(this),s=!!a,e=new u({title:o.TOOLBAR.POP_TIT_APP_TO_STACK,template:n.saveAppToStack({input:t,stackName:r,originStackExist:s}),confirm:{text:o.TOOLBAR.POP_BTN_SAVE_TO_STACK},onConfirm:i}),e.tpl.find("input[name='save-stack-type']").change(function(){return e.tpl.find(".radio-instruction").toggleClass("hide")})},getStackNameFromApp:function(e){var t,n,r,i,s,o;e||(e="untitled"),n=0,s=/.*-\d+$/,s.test(e)?(i=e.substr(0,e.lastIndexOf("-")),n=Number(e.substr(e.lastIndexOf("-")+1)),t=i):e.charAt(e.length-1)==="-"?t=e.substr(0,e.length-1):t=e,o=/.-stack+$/,o.test(t)?t=t:t+="-stack",r=App.model.stackList().pluck("name")||[],n++;while(n<=r.length){if($.inArray(t+"-"+n,r)===-1)break;n++}return t+"-"+n},checkAppNameRepeat:function(e){return App.model.appList().findWhere({name:e})?(this.showError("appname",o.PROP.MSG_WARN_REPEATED_APP_NAME),!0):e?(this.hideError("appname"),!1):(this.showError("appname",o.PROP.MSG_WARN_NO_APP_NAME),!0)},renderKpDropdown:function(e){var t,n;if(a.hasResourceWithDefaultKp()){n=new a;if(!e)return!1;e.tpl.find("#kp-runtime-placeholder").html(n.render().el),t=this.hideError.bind(this),n.dropdown.on("change",function(){return t("kp")}),e.tpl.find(".default-kp-group").show(),this.modal&&this.modal.on("close",function(){return n.remove()}),this.updateModal&&this.updateModal.on("close",function(){return n.remove()})}return null},hideDefaultKpError:function(e){return e.hideError("kp")},hideError:function(e){var t;return t=e?$("#runtime-error-"+e):$(".runtime-error"),t.hide()},showError:function(e,t){return $("#runtime-error-"+e).text(t).show()},defaultKpIsSet:function(){var e,t;return a.hasResourceWithDefaultKp()?(t=Design.modelClassForType(l.RESTYPE.KP),e=t.getDefaultKP(),!e.get("isSet")||!this.modal&&!this.updateModal||!(this.modal||this.updateModal).tpl.find("#kp-runtime-placeholder .item.selected").size()?(this.showError("kp",o.IDE.RUN_STACK_MODAL_KP_WARNNING),!1):!0):!0},startApp:function(){return d.startApp(this.workspace.opsModel.id),!1},stopApp:function(){return d.stopApp(this.workspace.opsModel.id),!1},terminateApp:function(){return d.terminateApp(this.workspace.opsModel.id),!1},forgetApp:function(){return d.forgetApp(this.workspace.opsModel.id),!1},refreshResource:function(){return this.workspace.reloadAppData(),!1},switchToAppEdit:function(){return this.workspace.switchToEditMode(),!1},checkDBinstance:function(e){var t,n;return n=new Q.defer,e.length?(t=p(l.RESTYPE.DBINSTANCE,Design.instance().get("region")),t.fetchForce().then(function(){return n.resolve(t)})):n.resolve([]),n.promise},applyOpenstackAppEdit:function(){var e,n,r,i,s,a,c,p,v,m,g;return g=this,v=this.workspace.opsModel.getJsonData(),c=this.workspace.design.serialize({usage:"updateApp"}),i=new f({old:v,"new":c}),m=i.getDiffInfo(),!m.compChange&&!m.layoutChange&&!m.stateChange?this.workspace.applyAppEdit():(p=[],n=[],_.each(i.modifiedComps,function(e,t){var r;if(((r=c.component[t])!=null?r.type:void 0)===l.RESTYPE.OSSERVER&&e.resource.flavor)return n.push(c.component[t].name)}),n.length&&p.push("Server "+n.join(", ")+" will be restarted to change flavor."),a=!1,_.each(i.removedComps,function(e,t){if(v.component[t])return a=!0}),!a||p.push("Note: deleted resources cannot be restored."),s=!1,_.each(i.addedComps,function(e){if(e.type===l.RESTYPE.OSSERVER)return s=!0}),this.updateModal=new u({title:o.IDE.UPDATE_APP_MODAL_TITLE,template:MC.template.updateApp({isRunning:g.workspace.opsModel.testState(t.State.Running),notification:p}),disableClose:!0,hasScroll:!0,maxHeight:"450px",cancel:"Close"}),r=g.workspace.opsModel.get("cloudType"),g.updateModal.tpl.find(".modal-confirm").prop("disabled",!0).text(App.user.hasCredential()?o.IDE.UPDATE_APP_CONFIRM_BTN:o.IDE.UPDATE_APP_MODAL_NEED_CREDENTIAL),s&&d.renderKpDropdown(g.updateModal,r),g.updateModal.on("confirm",function(){var e;return App.user.hasCredential()?d.defaultKpIsSet(r)?(c=g.workspace.design.serialize({usage:"updateApp"}),g.workspace.applyAppEdit(c,!m.compChange),(e=g.updateModal)!=null?e.close():void 0):!1:(App.showSettings(App.showSettings.TAB.Credential),!1)}),m.compChange&&(e=i.renderAppUpdateView(),$("#app-update-summary-table").html(e)),g.renderKpDropdown(g.updateModal),h.loadModule("stack").then(function(){var e;return g.updateModal&&g.updateModal.toggleConfirm(!1),(e=g.updateModal)!=null?e.resize():void 0},function(e){var t;return void 0,g.updateModal&&g.updateModal.toggleConfirm(!0),g.updateModal&&g.updateModal.tpl.find("#take-rds-snapshot").off("change"),(t=g.updateModal)!=null?t.resize():void 0}))},applyAppEdit:function(){var n,r,i,s,a,c,p,d,v;return Design.instance().get("cloud_type")==="openstack"?(this.applyOpenstackAppEdit(),!1):(v=this,c=this.workspace.opsModel.getJsonData(),s=this.workspace.design.serialize({usage:"updateApp"}),i=new f({old:c,"new":s}),d=i.getDiffInfo(),!d.compChange&&!d.layoutChange&&!d.stateChange?this.workspace.applyAppEdit():(p=i.removedComps,void 0,r=[],void 0,n=s.component,_.each(n,function(e){if(e.type===l.RESTYPE.DBINSTANCE)return r.push(e.resource.DBInstanceIdentifier)}),this.updateModal=new u({title:o.IDE.HEAD_INFO_LOADING,template:MC.template.loadingSpiner,disableClose:!0,hasScroll:!0,maxHeight:"450px",cancel:"Close"}),this.updateModal.tpl.find(".modal-footer").hide(),a=[],_.each(c.component,function(e){if(e.type===l.RESTYPE.DBINSTANCE)return a.push(e.resource.DBInstanceIdentifier)}),this.checkDBinstance(a).then(function(n){var u,a,f,c;a=n.filter(function(t){var n;return(n=t.attributes.DBInstanceIdentifier,e.call(r,n)>=0)&&t.attributes.DBInstanceStatus!=="available"});if(a.length)return v.updateModal.find(".modal-footer").show().find(".modal-confirm").hide(),v.updateModal.setContent(MC.template.cantUpdateApp({data:a})),v.updateModal.setTitle(o.IDE.UPDATE_APP_MODAL_TITLE),!1;f=[],_.each(p,function(e){var t;if(e.type===l.RESTYPE.DBINSTANCE){t=n.get(e.resource.DBInstanceIdentifier);if(t)return f.push(n.get(e.resource.DBInstanceIdentifier))}}),c=_.filter(f,function(e){return e.attributes.DBInstanceStatus!=="available"}),v.updateModal.tpl.children().css("width","450px").find(".modal-footer").show(),v.updateModal.setContent(MC.template.updateApp({isRunning:v.workspace.opsModel.testState(t.State.Running),notReadyDB:c,removeList:f})),v.updateModal.setTitle(o.IDE.UPDATE_APP_MODAL_TITLE),v.updateModal.tpl.find(".modal-confirm").prop("disabled",!0).text(App.user.hasCredential()?o.IDE.UPDATE_APP_CONFIRM_BTN:o.IDE.UPDATE_APP_MODAL_NEED_CREDENTIAL),v.updateModal.resize(),window.setTimeout(function(){return v.updateModal.resize()},100),(c!=null?c.length:void 0)&&v.updateModal.tpl.find("#take-rds-snapshot").attr("checked",!1).on("change",function(){return v.updateModal.tpl.find(".modal-confirm").prop("disabled",$(this).is(":checked"))}),v.updateModal.on("confirm",function(){var e;return App.user.hasCredential()?v.defaultKpIsSet()?(s=v.workspace.design.serialize({usage:"updateApp"}),v.workspace.applyAppEdit(s,!d.compChange),(e=v.updateModal)!=null?e.close():void 0):!1:(App.showSettings(App.showSettings.TAB.Credential),!1)}),d.compChange&&(u=i.renderAppUpdateView(),$("#app-update-summary-table").html(u)),v.renderKpDropdown(v.updateModal),h.loadModule("stack").then(function(){var e;return v.updateModal&&v.updateModal.toggleConfirm(!1),(e=v.updateModal)!=null?e.resize():void 0},function(e){var t;return void 0,v.updateModal&&v.updateModal.toggleConfirm(!0),v.updateModal&&v.updateModal.tpl.find("#take-rds-snapshot").off("change"),(t=v.updateModal)!=null?t.resize():void 0})})))},opsOptionChanged:function(){var e,t,r,i,s,o,a;return o=this,e=this.$(".toolbar-visual-ops-switch").toggleClass("on"),s=e.hasClass("on"),t=this.workspace.design.get("agent"),s?(i=this.workspace.design.instancesNoUserData(),a=this.workspace,i?(t.enabled=!0,this.workspace.design.set("agent",t),c.trigger(c.REFRESH_PROPERTY)):(e.removeClass("on"),r=new u({title:"Confirm to Enable VisualOps",width:"420px",template:n.confirm.enableState(),confirm:{text:"Enable VisualOps"},onConfirm:function(){return o.clearUserData(),t.enabled=!0,r.close(),e.addClass("on"),a.design.set("agent",t),c.trigger(c.FORCE_OPEN_PROPERTY)}}),null)):(t.enabled=!1,this.workspace.design.set("agent",t),c.trigger(c.FORCE_OPEN_PROPERTY))},clearUserData:function(){var e;return e=Design.modelClassForType(l.RESTYPE.OSSERVER),_.each(e.allObjects(),function(e){return e.set("userData",void 0)})},cancelAppEdit:function(){var e,t;return this.workspace.cancelEditMode()||(t=this,e=new u({title:"Changes not applied",template:n.modal.cancelUpdate(),width:"400",confirm:{text:"Discard",color:"red"},onConfirm:function(){e.close(),t.workspace.cancelEditMode(!0)}})),!1}})})}.call(this),define("workspaces/oseditor/template/TplStatusbar",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<ul class="status-bar"></ul>\n<div class="status-bar-modal" style="display: none;"></div>'},n.frame=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'Last saved: <span class="stack-save-time">-<span>'},n.lastSaved=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<span class="state-success"><i class="status status-green icon-label"></i><b>'+a((o=t&&t.successCount,typeof o===u?o.apply(t):o))+'</b></span>\n<span class="state-failed"><i class="status status-red icon-label"></i><b>'+a((o=t&&t.failCount,typeof o===u?o.apply(t):o))+"</b></span>",s},n.state=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"Validate"},n.ta=e.template(t),n}),function(){define("workspaces/oseditor/subviews/Statusbar",["OpsModel","Design","../template/TplStatusbar","constant","backbone","event","state_status"],function(e,t,n,r,i,s,o){var u,a;return a=[{name:"lastSaved",className:"info",visible:!0,events:{update:function(){return[{obj:null,event:"jsonDataSaved"}]}},update:function(e,t){var n;return n=jQuery.now()/1e3,this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){var t,r;t=e(".stack-save-time"),r=MC.intervalDate(n);if(t.text()!==r)return t.text(r)},1e3),null},click:function(e){return null},remove:function(){return clearInterval(this.timer)}},{name:"ta",className:"status-bar-btn",visible:function(e,t){var n,r;return r=t.design.mode(),r==="app"||r==="appview"?n=!1:n=!0,typeof e=="function"&&e(n),n},changeVisible:!0,click:function(e){var t,n;return t=$(e.currentTarget),n="Validate",t.text("Validating..."),setTimeout(function(){return MC.ta.validAll(),t.text(n),require(["TaGui"],function(e){return e.loadModule("statusbar",null)})},50)}},{name:"state",className:"status-bar-btn",visible:function(t,n){var r,i,s;return s=n.design.mode(),r=_.every([e.State.Updating,e.State.Running,e.State.Saving],function(e){return!n.opsModel.testState(e)}),i=!1,s==="app"||s==="appedit"?i=!r:s==="appview"&&(i=!1),typeof t=="function"&&t(i),i},events:{update:[{obj:s,event:s.UPDATE_STATE_STATUS_DATA}]},changeVisible:!0,update:function(e,t){var n;return n=this.renderData(!0,t),e(".state-success b").text(n.successCount),e(".state-failed b").text(n.failCount)},renderData:function(e,t){var n,r,i,s,o,u,a,f,l,c;this.workspace=t;if(!e)return{};i=App.WS.collection.status.find().fetch(),o=n=0,_.isArray(i)||(i=[i]);for(u=0,f=i.length;u<f;u++){r=i[u];if(r.app_id!==t.opsModel.get("id"))continue;if(r.status){c=r.status;for(a=0,l=c.length;a<l;a++)s=c[a],s.result==="success"?o++:s.result==="failure"&&n++}}return{successCount:o,failCount:n}},click:function(e){return o.loadModule()}}],u=i.View.extend({tagName:"li",initialize:function(){return _.bindAll(this,"render","toggle"),this.clearGarbage=[],this.needUpdate=[]},render:function(){return this.$el.html(this.template(this.data)),this},toggle:function(e){return this.$el.toggle(e)},remove:function(){var e,t,n,r;this.$el.remove(),this.stopListening(),r=this.clearGarbage;for(t=0,n=r.length;t<n;t++)e=r[t],_.isArray(e)?e[1].apply(e[0],e.slice(2)):e();return this.clearGarbage=[],this.needUpdate=[],this},update:function(){var e,t,n,r;r=this.needUpdate;for(t=0,n=r.length;t<n;t++)e=r[t],e();return this}}),i.View.extend({initialize:function(e){var t;return _.extend(this,e),t=this.workspace,this.itemViews=[],this.setElement(this.parent.$el.find(".OEPanelBottom").html(n.frame())),this.renderItem()},ready:!1,bindItem:function(){var e,t,r,i,o,f,l,c,h,p,d,v,m,g,y,b,w;b=jQuery.extend(!0,[],a).reverse();for(r=v=0,g=b.length;v<g;r=++v){o=b[r],l=new u,l.delegateEvents({click:o.click}),l.template=n[o.name],l.$el.addClass(o.className),c=_.bind(l.$,l),h=_.bind(l.toggle,l),_.isFunction(o.visible)&&(d=_.bind(o.visible,o,h,this.workspace)),_.isFunction(o.update)&&(p=_.bind(o.update,o,c,this.workspace)),w=o.events;for(f in w){t=w[f],_.isFunction(t)&&(t=t());if(!_.isArray(t))continue;for(m=0,y=t.length;m<y;m++)e=t[m],f==="update"&&(e.obj===s?(s.onLongListen(e.event,p),l.clearGarbage.push([s,s.offListen,e.event,p])):l.listenTo(e.obj||this.workspace.opsModel,e.event,p))}o.changeVisible&&(o.visible&&l.needUpdate.push(d),o.update&&l.needUpdate.push(p)),_.isFunction(o.visible)?i=o.visible(l.toggle,this.workspace):(l.toggle(o.visible),i=o.visible),l.data=(typeof o.renderData=="function"?o.renderData(i,this.workspace):void 0)||{},o.remove&&l.clearGarbage.push(_.bind(o.remove,o)),this.itemViews.push(l)}return null},renderItem:function(){var e,t,n,r,i;e=this,this.ready||(this.bindItem(),this.ready=!0),i=this.itemViews;for(n=0,r=i.length;n<r;n++)t=i[n],this.$("ul").append(t.render().el);return this},update:function(){var e,t,n,r,i;r=this.itemViews,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.update());return i},remove:function(){var e,t,n,r;this.$el.remove(),this.stopListening(),r=this.itemViews;for(t=0,n=r.length;t<n;t++)e=r[t],e.remove();return this}})})}.call(this),define("workspaces/oseditor/canvas/TplPopup",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function f(e,t){var r="",i;r+='\n<header class="volume-pph">'+u(n.i18n.call(e,"CANVAS.CVS_POP_ATTACHED_VOLUMES",{hash:{},data:t}))+" <span>("+u((i=e&&e.length,typeof i===o?i.apply(e):i))+')</span></header>\n<ul class="popup-content popup-volume">\n\n    ',i=n.each.call(e,e,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;return r+="\n</ul>\n",r}function l(e,t){var r="",i;r+='\n    <li data-id="'+u((i=e&&e.id,typeof i===o?i.apply(e):i))+'" class="',i=n["if"].call(e,e&&e.snapshot,{hash:{},inverse:a.program(5,h,t),fn:a.program(3,c,t),data:t});if(i||i===0)r+=i;r+='">\n        <div class="vpp-name">'+u((i=e&&e.name,typeof i===o?i.apply(e):i))+'</div>\n        <div class="vpp-size">'+u((i=e&&e.size,typeof i===o?i.apply(e):i))+"GB</div>\n        ",i=n["if"].call(e,e&&e.appId,{hash:{},inverse:a.noop,fn:a.program(7,p,t),data:t});if(i||i===0)r+=i;return r+="\n    </li>\n",r}function c(e,t){return"vpp-snapshot"}function h(e,t){return"vpp-volume"}function p(e,t){var n="",r;return n+='<i class="status res-state tooltip status-'+u((r=e&&e.state,typeof r===o?r.apply(e):r))+'" data-tooltip="'+u((r=e&&e.state,typeof r===o?r.apply(e):r))+'"></i>',n}function d(e,t){var r="";return r+='\n<div class="volume-pp-empty">'+u(n.i18n.call(e,"CANVAS.CVS_POP_NO_ATTACHED_VOLUME",{hash:{},data:t}))+"</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n["if"].call(t,t&&t.length,{hash:{},inverse:a.program(9,d,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.volume=e.template(t),n}),function(){define("workspaces/oseditor/canvas/CpVolume",["CanvasPopup","./TplPopup","constant","CloudResources"],function(e,t,n,r){return e.extend({type:"VolumePopup",events:{"mousedown li":"clickVolume"},closeOnBlur:!0,initialize:function(){var t,n,r,i,s;e.prototype.initialize.apply(this,arguments),this.host&&this.listenTo(this.host,"change:volume",this.render),t=this.models||[];if(t[0]&&t[0].get){s=this.models;for(r=0,i=s.length;r<i;r++)n=s[r],this.listenTo(n,"change:name",this.updateVolume),this.listenTo(n,"change:size",this.updateVolume)}this.selectAtBegin&&this.clickVolume({currentTarget:this.$el.find("[data-id="+this.selectAtBegin.id+"]")[0]})},migrate:function(e){var t;t=e.$el.find(".selected").attr("data-id"),this.$el.find('[data-id="'+t+'"]').addClass("selected")},updateVolume:function(e){var t;t=this.$el.find("[data-id="+e.id+"]"),t.children(".vpp-name").text(e.get("name")),t.children(".vpp-size").text(e.get("size")+"GB")},render:function(){var t;e.prototype.render.apply(this,arguments),this.selected&&(t=this.selected.getAttribute("data-id"),this.clickVolume({currentTarget:this.$el.find("[data-id="+t+"]")[0]}))},content:function(){var e,n,i,s,o,u,a;i=this.models||[];if(i[0]&&i[0].get){i=[],a=this.host.volumes();for(o=0,u=a.length;o<u;o++)s=a[o],n=s.get("appId"),i.push({id:s.get("id"),appId:n,name:s.get("name"),size:s.get("size"),snapshot:s.get("snapshot")}),n&&(e=r(s.type,s.design().region()).get(n),_.last(i).state=(e!=null?e.get("status"):void 0)||"unknown")}return t.volume(i)},clickVolume:function(e){var t,n;if(this.selected===e.currentTarget)return;return t=$(e.currentTarget).addClass("selected"),n=t.attr("data-id"),this.canvas.selectVolume(n),this.selected&&$(this.selected).removeClass("selected"),this.selected=e.currentTarget,!this.canvas.design.modeIsApp()&&e.which===1&&t.dnd(e,{dropTargets:this.canvas.$el,dataTransfer:{id:n},eventPrefix:"addVol_"}),!1},remove:function(){this.canvas.selectVolume(null),e.prototype.remove.call(this)}})})}.call(this),function(){define("workspaces/oseditor/canvas/CanvasViewOs",["CanvasView","constant","i18n!/nls/lang.js","CanvasManager","Design","./CpVolume"],function(e,t,n,r,i,s){var o,u;return u=function(e,t){return t.x1<=e.x&&t.y1<=e.y&&t.x2>=e.x&&t.y2>=e.y},o=e.extend({events:function(){return $.extend({addVol_dragover:"__addVolDragOver",addVol_dragleave:"__addVolDragLeave",addVol_drop:"__addVolDrop"},e.prototype.events)},recreateStructure:function(){this.svg.clear().add([this.svg.group().classes("layer_network"),this.svg.group().classes("layer_groupLine"),this.svg.group().classes("layer_subnet"),this.svg.group().classes("layer_line"),this.svg.group().classes("layer_node")])},appendNetwork:function(e){return this.__appendSvg(e,".layer_network")},appendSubnet:function(e){return this.__appendSvg(e,".layer_subnet")},appendGroupLine:function(e){return this.__appendSvg(e,".layer_groupLine")},fixConnection:function(e,t,n){},errorMessageForDrop:function(e){switch(e){case t.RESTYPE.OSSUBNET:return n.CANVAS.WARN_NOTMATCH_OSSUBNET;case t.RESTYPE.OSLISTENER:return n.CANVAS.WARN_NOTMATCH_LISTENER;case t.RESTYPE.OSPOOL:return n.CANVAS.WARN_NOTMATCH_POOL;case t.RESTYPE.OSELB:return n.CANVAS.WARN_NOTMATCH_LB;case t.RESTYPE.OSRT:return n.CANVAS.WARN_NOTMATCH_ROUTER;case t.RESTYPE.OSRT:return n.CANVAS.WARN_NOTMATCH_ROUTER;case t.RESTYPE.OSVOL:return n.CANVAS.WARN_NOTMATCH_OSVOL;case t.RESTYPE.OSSERVER:return n.CANVAS.WARN_NOTMATCH_SERVER}},selectVolume:function(e){return this.deselectItem(!0),e&&this.triggerSelected(t.RESTYPE.OSVOL,e),this.__selectedVolume=e,!1},isReadOnly:function(){return this.design.modeIsApp()},delSelectedItem:function(){var t,n,r,i;if(this.isReadOnly())return!1;if(this.__selectedVolume){i=this.design.component(this.__selectedVolume),n=i.isRemovable();if(_.isString(n)){notification("error",n);return}r=this.__selectedVolume,this.__selectedVolume=null,i.remove(),t=$(".canvas-pp .popup-volume").children().eq(0),t.length?t.trigger("mousedown"):this.deselectItem();return}return e.prototype.delSelectedItem.apply(this,arguments)},__addVolDragOver:function(e,n){var i,o,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;this.__scrollOnDrag(n);if(!n.volDropTargets){n.hoverItem=null,n.volDropTargets=i=[],E=this.design.componentsOfType(t.RESTYPE.OSSERVER);for(p=0,g=E.length;p<g;p++){h=E[p],h=this.getItem(h.id),S=h.$el;for(d=0,y=S.length;d<y;d++)o=S[d],c=h.rect(o),c.tgt=h,c.el=o,i.push(c)}}if(!n.effect){n.effect=!0,x=n.volDropTargets||[];for(v=0,b=x.length;v<b;v++)h=x[v],r.addClass(h.tgt.$el,"droppable")}l=this.__localToCanvasCoor(n.pageX-n.zoneDimension.x1,n.pageY-n.zoneDimension.y1),a=null,T=n.volDropTargets;for(m=0,w=T.length;m<w;m++){h=T[m];if(u(l,h)){a=h;break}}a!==n.hoverItem&&(n.popup&&n.popup.remove(),n.hoverItem=a,a&&(f=a.tgt.model,n.popup=new s({attachment:a.el,host:f,models:f.volumes(),canvas:this})))},__addVolDragLeave:function(e,t){var n,i,s,o;this.__clearDragScroll(),o=t.volDropTargets||[];for(i=0,s=o.length;i<s;i++)n=o[i],r.removeClass(n.tgt.$el,"droppable");t.effect=!1,t.popup&&t.popup.remove()},__addVolDrop:function(e,n){var r,o,u,a,f,l,c;if(!n.hoverItem)return;o=n.dataTransfer||{},f=n.hoverItem.tgt.model;if(o.id){c=this.design.component(o.id),a=c.getOwner(),u=c.isReparentable(f);if(_.isString(u))return notification("error",u);u&&(c.attachTo(f),this.selectItem(n.hoverItem.el));return}o.owner=f,r=i.modelClassForType(t.RESTYPE.OSVOL),l=new r(o),n.popup&&n.popup.remove(),new s({attachment:n.hoverItem.el,host:f,models:f.volumes(),canvas:this,selectAtBegin:l})}}),o})}.call(this),function(){define("workspaces/oseditor/OsViewStack",["CoreEditorView","./template/TplOsEditor","./subviews/Panel","./subviews/Toolbar","./subviews/Statusbar","./canvas/CanvasViewOs"],function(e,t,n,r,i,s){return e.extend({template:t,constructor:function(t){return _.extend(t,{TopPanel:r,RightPanel:n,BottomPanel:i,CanvasView:s}),e.apply(this,arguments)},initialize:function(){this.panel=this.propertyPanel,this.$el.addClass("openstack").find(".OEPanelLeft").addClass("force-hidden")},showProperty:function(){return this.panel.show().openProperty(),!1},showResource:function(){return this.panel.show().openResource(),!1},showGlobal:function(){return this.panel.show().openConfig(),!1},showStateEditor:function(){return this.panel.show().openState(),!1},onCanvasDoubleClick:function(){return this.panel.show().openCurrent()},onItemSelected:function(e,t){if(!t&&!e){this.panel.openConfig({uid:"",type:"default"});return}return this.panel.openProperty({uid:t,type:e})}})})}.call(this),function(){define("workspaces/oseditor/model/DesignOs",["Design","constant"],function(e,t){var n;return n=e.extend({instancesNoUserData:function(){var n,r;return r=!0,n=e.modelClassForType(t.RESTYPE.OSSERVER).allObjects(),_.each(n,function(e){return r=e.get("userData")?!1:!0,null}),r}}),n})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/oseditor/OsEditorStack",["CoreEditor","./OsViewStack","./model/DesignOs","CloudResources","constant"],function(e,n,r,i,s){var o;return o=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return t(o,e),o.prototype.viewClass=n,o.prototype.designClass=r,o.prototype.title=function(){return(this.design||this.opsModel).get("name")+" - stack"},o.prototype.isReady=function(){var e,t;return this.__hasAdditionalData?!0:!this.opsModel.hasJsonData()||!this.opsModel.isPersisted()?!1:(e=this.opsModel.get("region"),t=this.opsModel.getJsonData().agent.module,i(s.RESTYPE.OSFLAVOR,e).isReady()&&i(s.RESTYPE.OSIMAGE,e).isReady()&&i(s.RESTYPE.OSKP,e).isReady()&&i(s.RESTYPE.OSNETWORK,e).isReady()&&i(s.RESTYPE.OSSNAP,e).isReady()&&!!App.model.getStateModule(t.repo,t.tag))},o.prototype.fetchAdditionalData=function(){var e,t,n;return t=this.opsModel.get("region"),n=this.opsModel.getJsonData().agent.module,e=[App.model.fetchStateModule(n.repo,n.tag),i(s.RESTYPE.OSFLAVOR,t).fetch(),i(s.RESTYPE.OSIMAGE,t).fetch(),i(s.RESTYPE.OSKP,t).fetch(),i(s.RESTYPE.OSSNAP,t).fetch(),i(s.RESTYPE.OSNETWORK,t).fetch()],this.opsModel.isPersisted()||e.unshift(this.opsModel.save()),Q.all(e)},o.prototype.isModified=function(){return this.opsModel.isPersisted()?this.design&&this.design.isModified():!0},o}(e),o})}.call(this),function(){define("workspaces/oseditor/OsViewApp",["CoreEditorViewApp","./template/TplOsEditor","./subviews/Panel","./subviews/Toolbar","./subviews/Statusbar","./canvas/CanvasViewOs"],function(e,t,n,r,i,s){return e.extend({template:t,constructor:function(t){return _.extend(t,{TopPanel:r,RightPanel:n,BottomPanel:i,CanvasView:s}),e.apply(this,arguments)},initialize:function(){this.panel=this.propertyPanel,this.$el.addClass("openstack").find(".OEPanelLeft").addClass("force-hidden"),e.prototype.initialize.apply(this,arguments)},switchMode:function(e){this.toolbar.updateTbBtns(),this.statusbar.update(),this.propertyPanel.openCurrent()},showProperty:function(){return this.panel.show().openProperty(),!1},showResource:function(){return this.workspace.design.modeIsAppEdit()&&this.panel.show().openResource(),!1},showGlobal:function(){return this.panel.show().openConfig(),!1},showStateEditor:function(){return this.panel.show().openState(),!1},onCanvasDoubleClick:function(){return this.panel.show().openCurrent()},onItemSelected:function(e,t){if(!t&&!e){this.panel.openConfig({uid:"",type:"default"});return}return this.panel.openProperty({uid:t,type:e})}})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/oseditor/OsEditorApp",["CoreEditorApp","./OsViewApp","./model/DesignOs","OpsModel","CloudResources","constant"],function(e,n,r,i,s,o){var u;return u=function(e){function i(){return i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.viewClass=n,i.prototype.designClass=r,i.prototype.fetchAdditionalData=function(){var e,t,n;return t=this,e=this.opsModel.get("region"),n=this.opsModel.getJsonData().agent.module,Q.all([App.model.fetchStateModule(n.repo,n.tag),s(o.RESTYPE.OSFLAVOR,e).fetch(),s(o.RESTYPE.OSIMAGE,e).fetch(),s(o.RESTYPE.OSKP,e).fetch(),s(o.RESTYPE.OSIMAGE,e).fetch(),s(o.RESTYPE.OSNETWORK,e).fetch(),s(o.RESTYPE.OSVOL,e).fetch(),this.loadVpcResource()])},i}(e),u})}.call(this),function(){define("workspaces/oseditor/model/OsModelFloatIp",["ComplexResModel","constant","Design"],function(e,t,n){var r;return r=e.extend({type:t.RESTYPE.OSFIP,newNameTmpl:"float-ip",serialize:function(){var e,n,r,i,s;r=this.connectionTargets("OsFloatIpUsage")[0];if(!r)return;return s=r.getRouter(),e=s?s.get("extNetworkId"):"",i=r.createRef(r.type===t.RESTYPE.OSLISTENER?"port_id":"id"),n=r.createRef(r.type===t.RESTYPE.OSLISTENER?"address":"fixed_ips.0.ip_address"),{component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),fixed_ip_address:n,floating_ip_address:this.get("address")||"",port_id:i,floating_network_id:e}}}}},{handleTypes:t.RESTYPE.OSFIP,deserialize:function(e,t,i){var s,o,u;o=new r({id:e.uid,name:e.resource.name,appId:e.resource.id,address:e.resource.floating_ip_address}),u=i(MC.extractID(e.resource.port_id)),u&&(s=n.modelClassForType("OsFloatIpUsage"),new s(o,u))}}),r})}.call(this),function(){define("workspaces/oseditor/model/OsModelHealthMonitor",["ComplexResModel","constant"],function(e,t){var n;return n=e.extend({type:t.RESTYPE.OSHM,newNameTmpl:"health-monitor",defaults:function(){return{type:"PING",delay:30,timeout:30,maxRetries:3,urlPath:"/index.html",expectedCodes:"200-299"}},get:function(e){var t;return e!=="urlPath"&&e!=="expectedCodes"||(t=this.attributes.type)==="HTTP"||t==="HTTPS"?this.attributes[e]:void 0},serialize:function(){var e;return e={name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),type:this.get("type"),delay:Number(this.get("delay")),timeout:Number(this.get("timeout")),max_retries:Number(this.get("maxRetries")),url_path:this.get("urlPath")||"",expected_codes:this.get("expectedCodes")||""}},{component:e}}},{handleTypes:t.RESTYPE.OSHM,deserialize:function(e,t,r){new n({id:e.uid,name:e.resource.name,appId:e.resource.id,type:e.resource.type,delay:Number(e.resource.delay),timeout:Number(e.resource.timeout),maxRetries:Number(e.resource.max_retries),urlPath:e.resource.url_path,expectedCodes:e.resource.expected_codes})}}),n})}.call(this),function(){define("workspaces/oseditor/model/OsModelPort",["ComplexResModel","constant","Design"],function(e,t,n){var r;return r=e.extend({type:t.RESTYPE.OSPORT,newNameTmpl:"port",defaults:function(){return{ip:"",macAddress:"",deviceIndex:0}},initialize:function(e,r){if(r.createByUser)return n.modelClassForType(t.RESTYPE.OSSG).attachDefaultSG(this),this.assignIP()},assignIP:function(){var e,t;t=this.parent(),this.isEmbedded()&&(t=this.owner().parent()),e=r.getAvailableIP(t);if(e)return this.set("ip",e)},onParentChanged:function(e){if(e&&!this.isEmbedded())return this.assignIP()},owner:function(){return this.connectionTargets("OsPortUsage")[0]},isAttached:function(){return!!this.owner()},isVisual:function(){return!this.isEmbedded()},isEmbedded:function(){return this.parent()?this.owner()&&this.owner().embedPort()===this:!0},setFloatingIp:function(e){var t,r;r=this.connections("OsFloatIpUsage")[0],e?r||(t=n.modelClassForType("OsFloatIpUsage"),new t(this)):r&&r.remove(),(this.isEmbedded()?this.owner():this).trigger("change:fip")},getFloatingIp:function(){return this.connectionTargets("OsFloatIpUsage")[0]},getRouter:function(){var e,t,n;return e=this.owner()||this,t=e.parent(),t&&(n=t.connectionTargets("OsRouterAsso")[0]),n||null},serialize:function(){var e,t,n,r,i;return this.isEmbedded()?r=this.owner().parent():r=this.parent(),i=this,e=0,this.owner()&&!this.isEmbedded()&&(n=this.owner().connectionTargets("OsPortUsage"),_.each(n,function(t,n){return i===t&&(e=n),null})),t={component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),mac_address:this.get("macAddress"),security_groups:this.connectionTargets("OsSgAsso").map(function(e){return e.createRef("id")}),network_id:r.parent().createRef("id"),device_id:this.owner()?this.owner().createRef("id"):"",device_index:e,fixed_ips:[{subnet_id:r.createRef("id"),ip_address:this.get("ip")}]}}},this.isEmbedded()||(t.layout=this.generateLayout()),t},setIp:function(e){return this.set("ip",e)}},{handleTypes:t.RESTYPE.OSPORT,deserialize:function(e,t,i){var s,o,u,a,f,l;o=new r({id:e.uid,name:e.resource.name,appId:e.resource.id,parent:i(MC.extractID(e.resource.fixed_ips[0].subnet_id)),ip:e.resource.fixed_ips[0].ip_address,macAddress:e.resource.mac_address,x:t.coordinate[0],y:t.coordinate[1]}),s=n.modelClassForType("OsSgAsso"),l=e.resource.security_groups;for(a=0,f=l.length;a<f;a++)u=l[a],new s(o,i(MC.extractID(u)))},getAvailableIP:function(e){var r,i,s,o,u,a,f;f=e.get("cidr"),o=[],i=n.modelClassForType(t.RESTYPE.OSPORT).allObjects(),r=n.modelClassForType(t.RESTYPE.OSLISTENER).allObjects(),a=i.concat(r),_.each(a,function(t){var n;return t.isEmbedded&&t.isEmbedded()?n=t.owner().parent():n=t.parent(),n===e&&o.push(t.get("ip")),null}),s=n.modelClassForType(t.RESTYPE.ENI).getAvailableIPInCIDR(f,o,0,[0,1,2]);if(s&&s[s.length-1]){u=s[s.length-1];if(u.available)return u.ip}return null}}),r})}.call(this),function(){define("workspaces/oseditor/model/OsModelListener",["./OsModelPort","constant","Design"],function(e,t,n){var r;return r=e.extend({type:t.RESTYPE.OSLISTENER,newNameTmpl:"listener",defaults:function(){return{protocol:"HTTP",port:80,limit:1e3,ip:"",portId:""}},initialize:function(e,r){var i;r.pool&&(i=n.modelClassForType("OsListenerAsso"),new i(this,r.pool)),r.createByUser&&(n.modelClassForType(t.RESTYPE.OSSG).attachDefaultSG(this),this.assignIP()),this.listenTo(this,"change:protocol",function(){var e;return(e=this.connectionTargets("OsListenerAsso")[0])!=null?e.set("protocol",this.get("protocol"),{silent:!0}):void 0})},assignIP:function(){var e;e=n.modelClassForType(t.RESTYPE.OSPORT).getAvailableIP(this.parent());if(e)return this.set("ip",e)},onParentChanged:function(e){if(e)return this.assignIP()},isAttached:function(){return!0},isVisual:function(){return!0},isEmbedded:function(){return!1},getFloatingIp:function(){return this.connectionTargets("OsFloatIpUsage")[0]},serialize:function(){var e;return{layout:this.generateLayout(),component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),pool_id:((e=this.connectionTargets("OsListenerAsso")[0])!=null?e.createRef("id"):void 0)||"",subnet_id:this.parent().createRef("id"),connection_limit:this.get("limit"),protocol:this.get("protocol"),protocol_port:this.get("port"),port_id:this.get("portId"),address:this.get("ip"),security_groups:this.connectionTargets("OsSgAsso").map(function(e){return e.createRef("id")})}}}}},{handleTypes:t.RESTYPE.OSLISTENER,deserialize:function(e,t,i){var s,o,u,a,f,l;o=new r({id:e.uid,name:e.resource.name,appId:e.resource.id,limit:e.resource.connection_limit,port:e.resource.protocol_port,protocol:e.resource.protocol,parent:i(MC.extractID(e.resource.subnet_id)),x:t.coordinate[0],y:t.coordinate[1],portId:e.resource.port_id,ip:e.resource.address},{pool:i(MC.extractID(e.resource.pool_id))}),s=n.modelClassForType("OsSgAsso"),l=e.resource.security_groups||[];for(a=0,f=l.length;a<f;a++)u=l[a],new s(o,i(MC.extractID(u)))}}),r})}.call(this),function(){define("workspaces/oseditor/model/OsModelNetwork",["GroupModel","constant"],function(e,t){var n;return n=e.extend({type:t.RESTYPE.OSNETWORK,newNameTmpl:"network",isRemovable:function(){return!1},serialize:function(){return{layout:this.generateLayout(),component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name")}}}}},{handleTypes:t.RESTYPE.OSNETWORK,deserialize:function(e,t,r){new n({id:e.uid,name:e.resource.name,appId:e.resource.id,x:t.coordinate[0],y:t.coordinate[1],width:t.size[0],height:t.size[1]})}}),n})}.call(this),function(){define("workspaces/oseditor/model/OsModelElb",["ComplexResModel","constant"],function(e,t){return e.extend({type:t.RESTYPE.OSELB,serialize:function(){}},{handleTypes:t.RESTYPE.OSELB,deserialize:function(){}})})}.call(this),function(){define("workspaces/oseditor/model/OsModelPool",["ComplexResModel","constant","Design"],function(e,t,n){var r;return r=e.extend({type:t.RESTYPE.OSPOOL,newNameTmpl:"pool",defaults:function(){return{protocol:"HTTP",method:"ROUND_ROBIN"}},initialize:function(e,r){var i;e.healthMonitors||(i=n.modelClassForType(t.RESTYPE.OSHM),this.attributes.healthMonitors=[new i]),this.listenTo(this,"change:protocol",function(){var e;return(e=this.connectionTargets("OsListenerAsso")[0])!=null?e.set("protocol",this.get("protocol"),{silent:!0}):void 0})},ports:function(){var e,n,r,i,s;n=[],s=this.connectionTargets("OsPoolMembership");for(r=0,i=s.length;r<i;r++)e=s[r],e.type===t.RESTYPE.OSSERVER?n.push(e.embedPort()):n.push(e);return n},addNewHm:function(e){var r,i;return r=n.modelClassForType(t.RESTYPE.OSHM),e?i=new r({name:e}):i=new r,this.get("healthMonitors").push(i),i},getHm:function(e){var t,n,r,i;i=this.get("healthMonitors");for(n=0,r=i.length;n<r;n++){t=i[n];if(t.id===e)return t}return null},removeHm:function(e){var t,n,r,i,s;s=this.get("healthMonitors");for(n=r=0,i=s.length;r<i;n=++r){t=s[n];if(t===e||t.id===e){this.get("healthMonitors").splice(n,1),t.remove();break}}},remove:function(){var t,n,r,i;i=this.get("healthMonitors");for(n=0,r=i.length;n<r;n++)t=i[n],t.remove();return e.prototype.remove.apply(this,arguments)},serialize:function(){var e;return e=_.map(this.connections("OsPoolMembership"),function(e){var n;return n=e.getOtherTarget(t.RESTYPE.OSPOOL),n.type===t.RESTYPE.OSSERVER&&(n=n.embedPort()),{protocol_port:e.get("port"),address:n.createRef("fixed_ips.0.ip_address"),weight:e.get("weight"),id:e.get("appId")}}),{layout:this.generateLayout(),component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),description:this.get("description"),protocol:this.get("protocol"),lb_method:this.get("method"),subnet_id:this.parent().createRef("id"),healthmonitors:this.get("healthMonitors").map(function(e){return e.createRef("id")}),member:e}}}}},{handleTypes:t.RESTYPE.OSPOOL,deserialize:function(e,t,n){new r({id:e.uid,name:e.resource.name,description:e.resource.description,appId:e.resource.id,protocol:e.resource.protocol,method:e.resource.lb_method,parent:n(MC.extractID(e.resource.subnet_id)),x:t.coordinate[0],y:t.coordinate[1],healthMonitors:(e.resource.healthmonitors||[]).map(function(e){return n(MC.extractID(e))})})},postDeserialize:function(e,t){var r,i,s,o,u,a,f;i=n.instance(),o=i.component(e.uid),r=n.modelClassForType("OsPoolMembership"),f=e.resource.member;for(u=0,a=f.length;u<a;u++)s=f[u],new r(o,i.component(MC.extractID(s.address)),{appId:s.id,weight:s.weight,port:s.protocol_port})}}),r})}.call(this),function(){define("workspaces/oseditor/model/OsModelRt",["ComplexResModel","constant","Design"],function(e,t,n){var r;return r=e.extend({type:t.RESTYPE.OSRT,newNameTmpl:"router",defaults:{nat:!1,extNetworkId:"",publicip:""},isPublic:function(){return!!this.get("extNetworkId")},serialize:function(){var e;return this.get("extNetworkId")?e={network_id:this.get("extNetworkId")}:e={},{layout:this.generateLayout(),component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),nat:this.get("extNetworkId")?this.get("nat"):!1,external_gateway_info:e,router_interface:this.connectionTargets("OsRouterAsso").map(function(e){return{subnet_id:e.createRef("id")}}),public_ip:this.get("publicip")}}}}},{handleTypes:t.RESTYPE.OSRT,deserialize:function(e,t,i){var s,o,u,a,f,l;o=new r({id:e.uid,name:e.resource.name,appId:e.resource.id,nat:e.resource.nat,extNetworkId:e.resource.external_gateway_info.network_id||"",publicip:e.resource.public_ip,x:t.coordinate[0],y:t.coordinate[1]}),s=n.modelClassForType("OsRouterAsso"),l=e.resource.router_interface;for(a=0,f=l.length;a<f;a++)u=l[a],new s(o,i(MC.extractID(u.subnet_id)))}}),r})}.call(this),function(){define("workspaces/oseditor/model/OsModelKeypair",["constant","ComplexResModel","ConnectionModel"],function(e,t,n){var r,i;return i=n.extend({type:"KeypairUsage",oneToMany:e.RESTYPE.OSKP,serialize:function(t){var n,r,i,s,o,u,a,f;r=this.getTarget(e.RESTYPE.OSKP);if(r){s=this.getOtherTarget(r),o=t[s.id];if(!o)return;u=r.createRef("keyName"),o.resource.keyName=u,n=s.groupMembers?s.groupMembers():[];for(a=0,f=n.length;a<f;a++)i=n[a],t[i.id]&&(t[i.id].resource.keyName=u)}return null}}),r=t.extend({type:e.RESTYPE.OSKP,defaults:{fingerprint:"",isSet:!1},isVisual:function(){return!1},isDefault:function(){return this.get("name")==="DefaultKP"},remove:function(){var e,n,s,o,u;e=r.getDefaultKP(),u=this.connectionTargets("KeypairUsage");for(s=0,o=u.length;s<o;s++)n=u[s],new i(e,n);return t.prototype.remove.call(this),null},assignTo:function(e){return new i(this,e)},dissociate:function(t){var n;return n=this.connections(),_.each(n,function(n){if(n.getOtherTarget(e.RESTYPE.OSKP)===t)return n.remove()})},isSet:function(){return this.get("appId")&&this.get("fingerprint")},getKPList:function(){var e,t,n,i,s;t=[],s=r.allObjects();for(n=0,i=s.length;n<i;n++)e=s[n],t.push({id:e.id,name:e.get("name"),selected:e===this,using:e.connections("KeypairUsage").length>1});return _.sortBy(t,function(e,t){if(e.name==="DefaultKP")return-1;if(t.name==="DefaultKP")return 1;if(e.name>t.name)return 1;if(e.name===t.name)return 0;if(e.name<t.name)return-1})},serialize:function(){return{component:{name:this.get("name"),type:this.type,uid:this.id,resource:{fingerprint:this.get("fingerprint")||"",keyName:this.get("keyName")||""}}}}},{getDefaultKP:function(){return _.find(r.allObjects(),function(e){return e.get("name")==="DefaultKP"})},setDefaultKP:function(e,t){var n;return n=_.find(r.allObjects(),function(e){return e.get("name")==="DefaultKP"}),n.set("appId",e||""),n.set("fingerprint",t||""),n.set("isSet",!0)},diffJson:function(){},handleTypes:e.RESTYPE.OSKP,deserialize:function(e,t,n){return new r({id:e.uid,name:e.name,keyName:e.resource.keyName,fingerprint:e.resource.fingerprint}),null}}),r})}.call(this),function(){define("workspaces/oseditor/model/OsModelServer",["ComplexResModel","constant","Design","CloudResources"],function(e,t,n,r){var i;return i=e.extend({type:t.RESTYPE.OSSERVER,newNameTmpl:"host",defaults:function(){return{userData:"",meta:"",adminPass:"12345678",keypair:"$DefaultKeyPair",flavorId:"6",availabilityZone:"",imageId:"",credential:"keypair",state:[],volumeSize:""}},initialize:function(e,r){var i,s,o;return r=r||{},void 0,this.setImage(e.imageId),this.setCredential(e),r.createByUser&&(i=n.modelClassForType(t.RESTYPE.OSPORT),s=n.modelClassForType("OsPortUsage"),o=new i({name:this.get("name")+"-port"}),new s(this,o),n.modelClassForType(t.RESTYPE.OSSG).attachDefaultSG(o),this.assignIP()),null},assignIP:function(){var e;e=n.modelClassForType(t.RESTYPE.OSPORT).getAvailableIP(this.parent());if(this.embedPort()&&e)return this.embedPort().set("ip",e)},onParentChanged:function(e){if(e)return this.assignIP()},embedPort:function(){return this.connectionTargets("OsPortUsage")[0]},volumes:function(){return this.connectionTargets("OsVolumeUsage")},setCredential:function(e){if(e.keypair)return this.set("credential","keypair");if(e.adminPass)return this.set("credential","adminPass")},setImage:function(e){var t,n;return this.set("imageId",e),n=this.getImage(),t=this.get("cachedAmi"),n&&t&&(t.os_distro=n.os_distro,t.architecture=n.architecture),null},getImage:function(){var e;return e=r(t.RESTYPE.OSIMAGE,this.design().region()).get(this.get("imageId")),e?e.toJSON():null},getStateData:function(){return this.get("state")},setStateData:function(e){return this.set("state",e)},serialize:function(){var e,r,i;return r={name:this.get("name"),type:this.type,uid:this.id,state:this.get("state"),resource:{id:this.get("appId"),name:this.get("name"),flavor:this.get("flavorId"),image:"",meta:this.get("meta"),NICS:this.connectionTargets("OsPortUsage").map(function(e){return{"port-id":e.createRef("id")}}),userdata:this.get("userData"),availabilityZone:this.get("availabilityZone"),blockDeviceMappingV2:[{bootIndex:0,sourceType:"image",volumeSize:this.get("volumeSize"),deviceName:"",uuid:this.get("imageId"),destinationType:"volume",deleteOnTermination:!0}]}},e=n.modelClassForType(t.RESTYPE.OSKP),i=_.find(e.allObjects(),function(e){return e.get("name")==="DefaultKP"}),this.get("credential")==="keypair"?(r.resource.key_name=this.get("keypair")==="$DefaultKeyPair"?MC.genResRef(i.id,"resource.keyName"):this.get("keypair"),r.resource.adminPass=""):(r.resource.key_name="",r.resource.adminPass=this.get("adminPass")),{component:r,layout:this.generateLayout()}}},{handleTypes:t.RESTYPE.OSSERVER,deserialize:function(e,t,r){var s,o,u,a,f,l,c,h;a=new i({id:e.uid,name:e.resource.name,appId:e.resource.id,flavorId:e.resource.flavor,imageId:e.resource.image||e.resource.blockDeviceMappingV2[0].uuid,adminPass:e.resource.adminPass,volumeSize:(c=e.resource.blockDeviceMappingV2)!=null?c[0].volumeSize:void 0,keypair:e.resource.key_name.split("{")[0]==="@"?"$DefaultKeyPair":e.resource.key_name,state:e.state,x:t.coordinate[0],y:t.coordinate[1]}),s=n.modelClassForType("OsPortUsage"),h=e.resource.NICS||[];for(o=f=0,l=h.length;f<l;o=++f)u=h[o],u=r(MC.extractID(u["port-id"])),o===0&&(u.parent().addChild(a),u.parent().removeChild(u)),new s(a,u)}}),i})}.call(this),function(){define("workspaces/oseditor/model/OsModelSg",["ComplexResModel","constant"],function(e,t){var n;return n=e.extend({type:t.RESTYPE.OSSG,newNameTmpl:"security-group",initialize:function(){var e;e=Design.modelClassForType(t.RESTYPE.OSSGRULE),this.get("rules").push(new e)},defaults:function(){return{description:"custom security group",rules:[]}},attachSG:function(e){var t;return t=Design.modelClassForType("OsSgAsso"),new t(e,this)},unAttachSG:function(e){var t;return t=Design.modelClassForType("OsSgAsso"),(new t(e,this)).remove()},addRule:function(e){var n,r,i,s,o;o=this.get("rules");for(i=0,s=o.length;i<s;i++){r=o[i];if(r.isEqualToData(e))return!1}return n=Design.modelClassForType(t.RESTYPE.OSSGRULE),r=new n(e),this.get("rules").push(r),r.id},getRule:function(e){var t,n,r,i;i=this.get("rules");for(n=0,r=i.length;n<r;n++){t=i[n];if(t.id===e)return t}return null},removeRule:function(e){var t,n,r,i,s;s=this.get("rules");for(t=r=0,i=s.length;r<i;t=++r){n=s[t];if(n===e||n.id===e){this.get("rules").splice(t,1);break}}},getMemberList:function(){return _.filter(this.connectionTargets("OsSgAsso"),function(e){return!0})},isDefault:function(){return this.get("name")==="DefaultSG"},remove:function(){var t,n,r,i;i=this.get("rules");for(n=0,r=i.length;n<r;n++)t=i[n],t.remove();return e.prototype.remove.apply(this,arguments)},serialize:function(){var e,t;return this.getMemberList().length?(t=this.get("rules"),e=t.length,t=_.filter(t,function(n,r){var i,s,o;for(i=s=o=r+1;o<=e?s<e:s>e;i=o<=e?++s:--s)if(_.isEqual(n.toJSON(),t[i].toJSON()))return!1;return!0}),{component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),description:this.get("description"),rules:t!=null?t.map(function(e){return e.toJSON()}):void 0}}}):null}},{handleTypes:t.RESTYPE.OSSG,deserialize:function(e,r,i){var s,o,u,a,f,l,c;s=Design.modelClassForType(t.RESTYPE.OSSGRULE),a=new n({id:e.uid,name:e.resource.name,appId:e.resource.id,description:e.resource.description}),u=e.resource.rules.map(function(e){var t;return e.remote_group_id&&(e.remote_group_id=i(MC.extractID(e.remote_group_id))),t=new s,t.fromJSON(e),t});if(u.length){c=a.get("rules");for(f=0,l=c.length;f<l;f++)o=c[f],o.remove();a.set("rules",u)}},getDefaultSg:function(){return _.find(n.allObjects(),function(e){return e.isDefault()})},attachDefaultSG:function(e){var t,r;r=n.getDefaultSg(),r&&(t=Design.modelClassForType("OsSgAsso"),new t(r,e))}}),n})}.call(this),function(){define("workspaces/oseditor/model/OsModelSgRule",["ComplexResModel","constant"],function(e,t){return e.extend({type:t.RESTYPE.OSSGRULE,newNameTmpl:"sg-rule",defaults:{direction:"egress",portMin:null,portMax:null,protocol:null,sg:null,ip:null,appId:""},setTarget:function(e){var t;typeof ip=="string"?t={ip:e,sg:null}:t={ip:null,sg:e},this.set(t)},toJSON:function(){var e;return e=this.get("sg"),{direction:this.get("direction"),port_range_min:this.get("portMin"),port_range_max:this.get("portMax"),protocol:this.get("protocol"),remote_group_id:e?e.createRef("id"):null,remote_ip_prefix:this.get("ip"),id:this.get("appId")}},fromJSON:function(e){var t;t=this.attributes,t.direction=e.direction||"egress",t.portMin=e.port_range_min||null,t.portMax=e.port_range_max||null,t.protocol=e.protocol||null,t.appId=e.id||"",t.sg=e.remote_group_id?e.remote_group_id:null,t.ip=e.remote_ip_prefix?e.remote_ip_prefix:null},isEqualToData:function(e){var t;return t=this.attributes,t.direction!==e.direction?!1:t.portMin!==e.portMin?!1:t.portMax!==e.portMax?!1:t.protocol!==e.protocol?!1:t.sg!==e.sg?!1:t.ip!==e.ip?!1:!0},serialize:function(){}})})}.call(this),function(){define("workspaces/oseditor/model/OsModelSubnet",["GroupModel","constant"],function(e,t){var n;return n=e.extend({type:t.RESTYPE.OSSUBNET,newNameTmpl:"subnet",defaults:function(){return{"public":!1,cidr:"",dhcp:!0,nameservers:[]}},initialize:function(e,t){if(t.createByUser)return this.set("cidr",this.generateCidr())},generateCidr:function(){var e,t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;r="10.0.0.0/8",c=r.split("/"),h=c[0],p=h.split("."),d=Number(c[1]),i=-1,g=n.allObjects();for(v=0,m=g.length;v<m;v++)e=g[v],o=e.get("cidr"),u=o.split("/"),f=u[0],l=Number(u[1]),a=f.split("."),t=Number(a[1]),i<t&&(i=t);return s=i+1,s>255?"":(p[1]=String(s),p.join(".")+"/16")},resetAllChildIP:function(){var e,n,r;return n=Design.modelClassForType(t.RESTYPE.OSPORT).allObjects(),e=Design.modelClassForType(t.RESTYPE.OSLISTENER).allObjects(),r=n.concat(e),_.each(r,function(e){return e.assignIP(),null})},serialize:function(){return{layout:this.generateLayout(),component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),cidr:this.get("cidr"),enable_dhcp:this.get("dhcp"),dns_nameservers:this.get("nameservers"),network_id:this.parent().createRef("id"),gateway_ip:"",ip_version:"4",allocation_pools:{}}}}}},{handleTypes:t.RESTYPE.OSSUBNET,deserialize:function(e,t,r){new n({id:e.uid,name:e.resource.name,appId:e.resource.id,parent:r(MC.extractID(e.resource.network_id)),cidr:e.resource.cidr,dhcp:e.resource.enable_dhcp,x:t.coordinate[0],y:t.coordinate[1],width:t.size[0],height:t.size[1],nameservers:_.isArray(e.resource.dns_nameservers)?e.resource.dns_nameservers:[]})}}),n})}.call(this),function(){define("workspaces/oseditor/model/OsModelVolume",["ComplexResModel","constant","Design","i18n!/nls/lang.js"],function(e,t,n,r){var i;return i=e.extend({type:t.RESTYPE.OSVOL,newNameTmpl:"volume",defaults:{size:1,bootable:!1},constructor:function(t,n){var r;t.owner&&(r=t.owner,delete t.owner),e.call(this,t,n),this.attachTo(r,t.mountPoint)},getOwner:function(){return this.connectionTargets("OsVolumeUsage")[0]},attachTo:function(e,t){var r,i;if(e){t?i=t:i=this.getMountPoint(e);if(!i)return!1;this.set("mountPoint",i),r=n.modelClassForType("OsVolumeUsage"),new r(this,e)}},getMountPoint:function(e){var t,n,i;return t=e.getImage(),i=e.volumes(),t?(void 0,n=null,t.os_distro!=="windows"?n=["f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]:n=["f","g","h","i","j","k","l","m","n","o","p"],$.each(i||[],function(e,t){var r,i;if(t.get("mountPoint").slice(0,5)==="/dev/"){i=t.get("mountPoint").slice(-1),r=n.indexOf(i);if(r>=0)return n.splice(r,1)}}),n.length===0?(notification("warning",r.NOTIFY.WARN_ATTACH_VOLUME_REACH_INSTANCE_LIMIT,!1),null):(t.os_distro!=="windows"?n="/dev/sd"+n[0]:n="xvd"+n[0],n)):(ami_info||notification("warning",sprintf(r.NOTIFY.WARN_AMI_NOT_EXIST_TRY_USE_OTHER,imageId),!1),null)},serialize:function(){return{component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),snapshot_id:this.get("snapshot"),size:this.get("size"),mount_point:this.get("mountPoint"),bootable:this.get("bootable"),server_id:this.connectionTargets("OsVolumeUsage")[0].createRef("id"),display_description:this.get("description"),display_name:this.get("name")}}}}},{handleTypes:t.RESTYPE.OSVOL,deserialize:function(e,t,n){new i({id:e.uid,name:e.resource.display_name,appId:e.resource.id,snapshot:e.resource.snapshot_id,size:e.resource.size,mountPoint:e.resource.mount_point,bootable:e.resource.bootable,owner:n(MC.extractID(e.resource.server_id)),description:e.resource.display_description})}}),i})}.call(this),function(){define("workspaces/oseditor/model/connection/OsFloatIpUsage",["ConnectionModel","constant","Design"],function(e,t,n){return e.extend({type:"OsFloatIpUsage",constructor:function(r,i,s,o){var u;return!i&&r.type!==t.RESTYPE.OSFIP&&(u=n.modelClassForType(t.RESTYPE.OSFIP),i=new u),e.call(this,r,i,s,o)}})})}.call(this),function(){define("workspaces/oseditor/model/connection/OsListenerAsso",["ConnectionModel","constant"],function(e,t){return e.extend({type:"OsListenerAsso",portDefs:[{port1:{name:"elb",type:t.RESTYPE.OSLISTENER},port2:{name:"elb",type:t.RESTYPE.OSPOOL}}],constructor:function(t,n){var r,i;return i={reason:this},r=t.connections("OsListenerAsso")[0],r&&r.remove(i),r=n.connections("OsListenerAsso")[0],r&&r.remove(i),e.apply(this,arguments)},isRemovable:function(){return{error:"Listener must keep connected to Pool"}},remove:function(n){var r,i;e.prototype.remove.apply(this,arguments);if(n&&n.reason&&n.reason.type==="OsListenerAsso")return;r=this.getTarget(t.RESTYPE.OSLISTENER),i=this.getTarget(t.RESTYPE.OSPOOL),r.isRemoved()&&!i.isRemoved()&&i.remove(),i.isRemoved()&&!r.isRemoved()&&r.remove()}})})}.call(this),function(){define("workspaces/oseditor/model/connection/OsPoolMembership",["ConnectionModel","constant"],function(e,t){return e.extend({type:"OsPoolMembership",defaults:function(){return{port:80,weight:1,appId:""}},getPort:function(){var e;return e=this.getOtherTarget(t.RESTYPE.OSPOOL),e.type===t.RESTYPE.OSSERVER&&(e=e.embedPort()),e},portDefs:[{port1:{name:"pool",type:t.RESTYPE.OSPOOL},port2:{name:"pool",type:t.RESTYPE.OSPORT}},{port1:{name:"pool",type:t.RESTYPE.OSPOOL},port2:{name:"pool",type:t.RESTYPE.OSSERVER}}],constructor:function(n,r,i,s){var o,u;return n.type===t.RESTYPE.OSPORT?(u=n,o=r):r.type===t.RESTYPE.OSPORT&&(u=r,o=n),u&&u.isEmbedded()&&(n=u.owner(),r=o),e.call(this,n,r,i,s)}})})}.call(this),function(){define("workspaces/oseditor/model/connection/OsPortUsage",["ConnectionModel","constant"],function(e,t){return e.extend({type:"OsPortUsage",portDefs:[{port1:{name:"server",type:t.RESTYPE.OSSERVER},port2:{name:"server",type:t.RESTYPE.OSPORT}},{port1:{name:"listener",type:t.RESTYPE.OSLISTENER},port2:{name:"listener",type:t.RESTYPE.OSPORT}}],isVisual:function(){var e;return e=this.getTarget(t.RESTYPE.OSSERVER),e&&e.embedPort()!==this.getTarget(t.RESTYPE.OSPORT)},remove:function(n){var r,i;e.prototype.remove.call(this,n),i=this.getTarget(t.RESTYPE.OSSERVER),r=this.getTarget(t.RESTYPE.OSPORT),i.isRemoved()&&i.embedPort()===r&&r.remove()}})})}.call(this),function(){define("workspaces/oseditor/model/connection/OsRouterAsso",["ConnectionModel","constant"],function(e,t){return e.extend({type:"OsRouterAsso",oneToMany:t.RESTYPE.OSRT,portDefs:[{port1:{name:"route",type:t.RESTYPE.OSRT},port2:{name:"route",type:t.RESTYPE.OSSUBNET}}],initialize:function(){var e;e=this.getTarget(t.RESTYPE.OSRT),this.listenTo(e,"change:extNetworkId",this.onRtPublicityChanged),this.getTarget(t.RESTYPE.OSSUBNET).set("public",e.isPublic())},remove:function(){var n,r;return r=this.getTarget(t.RESTYPE.OSSUBNET),n=e.prototype.remove.apply(this,arguments),r.set("public",!1),n},onRtPublicityChanged:function(){this.getTarget(t.RESTYPE.OSSUBNET).set("public",this.getTarget(t.RESTYPE.OSRT).isPublic())}})})}.call(this),function(){define("workspaces/oseditor/model/connection/OsSgAsso",["ConnectionModel","constant"],function(e,t){return e.extend({type:"OsSgAsso"})})}.call(this),function(){define("workspaces/oseditor/model/connection/OsVolumeUsage",["ConnectionModel","constant"],function(e,t){return e.extend({type:"OsVolumeUsage",initialize:function(){var e,n,r,i,s,o;r=this.getTarget(t.RESTYPE.OSVOL),o=r.connections("OsVolumeUsage");for(i=0,s=o.length;i<s;i++)n=o[i],n!==this&&n.remove();e=this.getTarget(t.RESTYPE.OSSERVER),_.defer(function(){if(!e.isRemoved())return e.trigger("change:volume")})},remove:function(n){e.prototype.remove.call(this,n),this.getTarget(t.RESTYPE.OSSERVER).isRemoved()?this.getTarget(t.RESTYPE.OSVOL).remove():this.getTarget(t.RESTYPE.OSSERVER).trigger("change:volume")}})})}.call(this),function(){define("workspaces/oseditor/model/seVisitors/AppToStack",["../DesignOs","constant"],function(e,t){e.registerSerializeVisitor(function(e,n,r){var i,s,o,u,a,f,l,c,h,p;if(!r||!r.toStack)return;for(u in e){i=e[u],i.resource.hasOwnProperty("id")&&(i.resource.id="");switch(i.type){case t.RESTYPE.OSPOOL:h=i.resource.member||[];for(a=0,l=h.length;a<l;a++)s=h[a],s.id="";break;case t.RESTYPE.OSSG:p=i.resource.rules||[];for(f=0,c=p.length;f<c;f++)o=p[f],o.id="";break;case t.RESTYPE.OSLISTENER:i.resource.port_id="";break;case t.RESTYPE.OSFIP:i.resource.floating_ip_address="";break;case t.RESTYPE.OSRT:i.resource.public_ip=""}}})})}.call(this),function(){define("workspaces/oseditor/canvas/CeNetwork",["CanvasElement","constant","CanvasManager","CanvasView"],function(e,t,n,r){return e.extend({type:t.RESTYPE.OSNETWORK,parentType:["SVG"],defaultSize:[60,60],create:function(){return this.canvas.appendNetwork(this.createGroup())},render:function(){var e;return e=this.model,n.setLabel(this,this.$el.children("text")),this.$el[0].instance.move(e.x()*r.GRID_WIDTH,e.y()*r.GRID_WIDTH)}})})}.call(this),function(){define("workspaces/oseditor/canvas/CeSubnet",["CanvasElement","constant","CanvasManager","CanvasView","i18n!/nls/lang.js"],function(e,t,n,r,i){return e.extend({type:t.RESTYPE.OSSUBNET,parentType:[t.RESTYPE.OSNETWORK],defaultSize:[19,19],portDirMap:{route:"vertical"},listenModelEvents:function(){this.listenTo(this.model,"change:public",this.render),this.listenTo(this.model,"change:cidr",this.render)},portPosition:function(t,n){var i,s;return i=this.model,s=i.width()*r.GRID_WIDTH/2,t==="route-top"?[s,-5,e.constant.PORT_UP_ANGLE]:[s,i.height()*r.GRID_HEIGHT+5,e.constant.PORT_DOWN_ANGLE]},create:function(){var e,t,n;return t=this.canvas.svg,n=this.canvas.appendSubnet(this.createGroup()),n.add([this.createPortElement().attr({"class":"port port-gray tooltip","data-name":"route","data-alias":"route-top","data-tooltip":i.IDE.PORT_TIP_T}),this.createPortElement().attr({"class":"port port-gray tooltip","data-name":"route","data-alias":"route-bottom","data-tooltip":i.IDE.PORT_TIP_T}),t.image(MC.IMG_URL+"ide/icon-os/cvs-subnet.png",12,12).move(5,5).classes("public tooltip").attr({"data-tooltip":"Public subnet"})]),e=this.model,this.initNode(n,e.x(),e.y()),n},label:function(){return""+this.model.get("name")+" ("+this.model.get("cidr")+")"},labelWidth:function(t){var n;return n=e.prototype.labelWidth.call(this,t),this.model.get("public")&&(n-=16),n},render:function(){var e;return e=this.model,n.setLabel(this,this.$el.children("text")),this.$el[0].instance.move(e.x()*r.GRID_WIDTH,e.y()*r.GRID_WIDTH),this.$el.children("text")[0].setAttribute("x",e.get("public")?21:5),n.toggle(this.$el.children(".public"),e.get("public"))}})})}.call(this),function(){define("workspaces/oseditor/canvas/CeRt",["CanvasElement","constant","CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r){return e.extend({type:t.RESTYPE.OSRT,parentType:["SVG"],defaultSize:[8,8],portPosMap:{"route-left":[0,40,e.constant.PORT_LEFT_ANGLE],"route-right":[80,40,e.constant.PORT_RIGHT_ANGLE]},portDirMap:{route:"horizontal"},isPortSignificant:function(){return!0},labelWidth:function(){return 100},iconUrl:function(){return"ide/icon/openstack/cvs-router.png"},create:function(){var e,t,n;return e=this.model,n=this.canvas.svg,t=this.createRawNode().add([n.use("os_router"),this.createPortElement().attr({"class":"port port-gray tooltip","data-name":"route","data-alias":"route-left","data-tooltip":r.IDE.PORT_TIP_S}),this.createPortElement().attr({"class":"port port-gray tooltip","data-name":"route","data-alias":"route-right","data-tooltip":r.IDE.PORT_TIP_S})]),this.canvas.appendNode(t),this.initNode(t,e.x(),e.y()),t},render:function(){return n.setLabel(this,this.$el.children(".node-label"))}})})}.call(this),function(){define("workspaces/oseditor/canvas/CePool",["CanvasElement","constant","CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r){return e.extend({type:t.RESTYPE.OSPOOL,parentType:[t.RESTYPE.OSSUBNET],defaultSize:[8,8],portPosMap:{"pool-left":[0,40,e.constant.PORT_LEFT_ANGLE],"pool-right":[80,40,e.constant.PORT_RIGHT_ANGLE],"elb-left":[0,60,e.constant.PORT_LEFT_ANGLE],"elb-right":[80,60,e.constant.PORT_RIGHT_ANGLE]},portDirMap:{elb:"horizontal",pool:"horizontal"},isPortSignificant:function(){return!0},labelWidth:function(){return 100},create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createRawNode().add([t.use("os_pool"),this.createPortElement().attr({"class":"port port-blue tooltip","data-name":"pool","data-alias":"pool-left","data-tooltip":r.IDE.PORT_TIP_R}),this.createPortElement().attr({"class":"port port-blue tooltip","data-name":"pool","data-alias":"pool-right","data-tooltip":r.IDE.PORT_TIP_R}),this.createPortElement().attr({"class":"port port-green tooltip","data-name":"elb","data-alias":"elb-left","data-tooltip":r.IDE.PORT_TIP_Q}),this.createPortElement().attr({"class":"port port-green tooltip","data-name":"elb","data-alias":"elb-right","data-tooltip":r.IDE.PORT_TIP_Q})]),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n},render:function(){return n.setLabel(this,this.$el.children(".node-label"))}})})}.call(this),function(){define("workspaces/oseditor/canvas/CeListener",["CanvasElement","constant","CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r){return e.extend({type:t.RESTYPE.OSLISTENER,parentType:[t.RESTYPE.OSSUBNET],defaultSize:[8,8],portPosMap:{"elb-left":[0,60,e.constant.PORT_LEFT_ANGLE],"elb-right":[80,60,e.constant.PORT_RIGHT_ANGLE]},portDirMap:{elb:"horizontal"},events:{"mousedown .fip-status":"toggleFip","click .fip-status":"suppressEvent"},suppressEvent:function(){return!1},listenModelEvents:function(){this.listenTo(this.model,"change:fip",this.render)},labelWidth:function(){return 100},toggleFip:function(){var e;return this.canvas.design.modeIsApp()?!1:(e=!!this.model.getFloatingIp(),this.model.setFloatingIp(!e),n.updateFip(this.$el.children(".fip-status"),this.model),!1)},create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createRawNode().add([t.use("os_listener"),t.group().move(29,42).classes("fip-status cvs-hover tooltip").add([t.image("").size(26,21).classes("normal"),t.image("").size(26,21).classes("hover")]),this.createPortElement().attr({"class":"port port-green tooltip","data-name":"elb","data-alias":"elb-left","data-tooltip":r.IDE.PORT_TIP_P}),this.createPortElement().attr({"class":"port port-green tooltip","data-name":"elb","data-alias":"elb-right","data-tooltip":r.IDE.PORT_TIP_P})]),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n},render:function(){var e;return e=this.model,n.setLabel(this,this.$el.children(".node-label")),n.updateFip(this.$el.children(".fip-status"),e),null}})})}.call(this),function(){define("workspaces/oseditor/canvas/CeElb",["CanvasElement","constant","CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r){return e.extend({type:t.RESTYPE.OSELB,parentType:[t.RESTYPE.OSSUBNET],defaultSize:[17,8]},{createResource:function(e,n,r){var i,s,o,u;n.width=8,s=Design.modelClassForType(t.RESTYPE.OSPOOL),u=new s($.extend({},n,{x:n.x+9}),r),i=Design.modelClassForType(t.RESTYPE.OSLISTENER),o=new i(n,$.extend({pool:u},r))}})})}.call(this),function(){define("workspaces/oseditor/canvas/CeServer",["CanvasElement","constant","CanvasManager","i18n!/nls/lang.js","CloudResources","./CpVolume"],function(e,t,n,r,i,s){return e.extend({type:t.RESTYPE.OSSERVER,parentType:[t.RESTYPE.OSSUBNET],defaultSize:[8,8],portPosMap:{"pool-left":[0,40,e.constant.PORT_LEFT_ANGLE],"pool-right":[80,40,e.constant.PORT_RIGHT_ANGLE],"server-left":[0,60,e.constant.PORT_LEFT_ANGLE],"server-right":[80,60,e.constant.PORT_RIGHT_ANGLE]},portDirMap:{pool:"horizontal",server:"horizontal"},events:{"mousedown .fip-status":"toggleFip","mousedown .vol-image":"showVolume","click .fip-status":"suppressEvent","click .vol-image":"suppressEvent"},suppressEvent:function(){return!1},labelWidth:function(){return 100},iconUrl:function(){var e,t,n,r;return e=this.model.getImage()||this.model.get("cachedAmi"),e?r="ide/ami-os/"+e.os_type+"."+e.architecture+"@2x.png":(t=this.model,n=i(t.type,t.design().region()).get(t.get("appId")),n?(n=n.attributes,n.platform&&n.platform==="windows"?r="ide/ami-os/windows."+n.architecture+"@2x.png":r="ide/ami-os/linux."+n.architecture+"@2x.png"):r="ide/ami-os/image-not-available.png"),r},listenModelEvents:function(){this.listenTo(this.model,"change:imageId",this.render),this.listenTo(this.model,"change:fip",this.render),this.listenTo(this.canvas,"change:externalData",this.updateState)},updateState:function(){var e,t,n,r;t=this.model,r=this.$el.children(".res-state");if(r)return e=i(t.type,t.design().region()).get(t.get("appId")),n=(e!=null?e.get("status"):void 0)||"unknown",r.data("tooltip",n).attr("data-tooltip",n).attr("class","res-state tooltip "+n)},toggleFip:function(){var e,t;return this.canvas.design.modeIsApp()?!1:(e=this.model.embedPort(),t=!!e.getFloatingIp(),e.setFloatingIp(!t),n.updateFip(this.$el.children(".fip-status"),this.model),!1)},create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createRawNode().add([t.use("os_server"),t.image(MC.IMG_URL+this.iconUrl(),30,30).move(25,10).classes("ami-image tooltip").attr({"data-tooltip":this.model.getImage().name}),t.group().move(43,50).classes("fip-status cvs-hover tooltip").add([t.image("").size(26,21).classes("normal"),t.image("").size(26,21).classes("hover")]),t.group().move(15,46).classes("vol-image cvs-hover tooltip").add([t.image("").size(22,26).classes("normal"),t.image("").size(22,26).classes("hover")]),t.plain("").move(26,60).classes("volume-number"),this.createPortElement().attr({"class":"port port-blue tooltip","data-name":"pool","data-alias":"pool-left","data-tooltip":r.IDE.PORT_TIP_O}),this.createPortElement().attr({"class":"port port-blue tooltip","data-name":"pool","data-alias":"pool-right","data-tooltip":r.IDE.PORT_TIP_O}),this.createPortElement().attr({"class":"port port-green tooltip","data-name":"server","data-alias":"server-left","data-tooltip":r.IDE.PORT_TIP_N}),this.createPortElement().attr({"class":"port port-green tooltip","data-name":"server","data-alias":"server-right","data-tooltip":r.IDE.PORT_TIP_N})]),!e.design().modeIsStack()&&e.get("appId")&&n.add(t.circle(8).move(63,11).classes("res-state unknown")),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),this.listenTo(this.model,"change:volume",this.updateVolume),n},render:function(){var e;return e=this.model,n.setLabel(this,this.$el.children(".node-label")),n.update(this.$el.children(".ami-image"),this.iconUrl(),"href"),n.updateFip(this.$el.children(".fip-status"),e),this.updateVolume(),this.updateState(),null},updateVolume:function(){var e,t,r,i,s;i=this.model,s=i.volumes(),this.$el.children(".volume-number").text(s.length||0),s.length===0?(t="ide/icon-os/cvs-vol-e-n.png",r="ide/icon-os/cvs-vol-e-h.png"):(t="ide/icon-os/cvs-vol-ne-n.png",r="ide/icon-os/cvs-vol-ne-h.png"),e=this.$el.children(".vol-image"),n.update(e.find(".normal"),t,"href"),n.update(e.find(".hover"),r,"href")},showVolume:function(){var e,t,n,r;n=this.model,r=n.volumes()[0],e=this.$el[0],t=this.canvas,new s({attachment:e,host:n,models:n.volumes(),canvas:t,selectAtBegin:r})}})})}.call(this),function(){define("workspaces/oseditor/canvas/CePort",["CanvasElement","constant","CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r){return e.extend({type:t.RESTYPE.OSPORT,parentType:[t.RESTYPE.OSSUBNET],defaultSize:[8,8],portPosMap:{"pool-left":[0,40,e.constant.PORT_LEFT_ANGLE],"pool-right":[80,40,e.constant.PORT_RIGHT_ANGLE],"server-left":[0,60,e.constant.PORT_LEFT_ANGLE],"server-right":[80,60,e.constant.PORT_RIGHT_ANGLE]},portDirMap:{pool:"horizontal",server:"horizontal"},events:{"mousedown .fip-status":"toggleFip","click .fip-status":"suppressEvent"},suppressEvent:function(){return!1},labelWidth:function(){return 100},listenModelEvents:function(){this.listenTo(this.model,"change:fip",this.render),this.listenTo(this.model,"change:connections",this.render)},toggleFip:function(){var e;return this.canvas.design.modeIsApp()?!1:(e=!!this.model.getFloatingIp(),this.model.setFloatingIp(!e),!1)},create:function(){var e,t,n;return e=this.model,void 0,t=this.canvas.svg,n=this.createRawNode().add([t.use("os_port"),t.group().move(33,29).classes("fip-status cvs-hover tooltip").add([t.image("").size(26,21).classes("normal"),t.image("").size(26,21).classes("hover")]),this.createPortElement().attr({"class":"port port-blue tooltip","data-name":"pool","data-alias":"pool-left","data-tooltip":r.IDE.PORT_TIP_P}),this.createPortElement().attr({"class":"port port-blue tooltip","data-name":"pool","data-alias":"pool-right","data-tooltip":r.IDE.PORT_TIP_P}),this.createPortElement().attr({"class":"port port-green tooltip","data-name":"server","data-alias":"server-left","data-tooltip":r.IDE.PORT_TIP_R}),this.createPortElement().attr({"class":"port port-green tooltip","data-name":"server","data-alias":"server-right","data-tooltip":r.IDE.PORT_TIP_R})]),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n},render:function(){var e,t;return t=this.model,n.setLabel(this,this.$el.children(".node-label")),e=this.$el.children(".fip-status"),t.connections("OsPortUsage").length?(e.show(),n.updateFip(e,t)):e.hide(),null}})})}.call(this),function(){define("workspaces/oseditor/canvas/CeOsLine",["CanvasLine","constant"],function(e,t){return e.extend({type:"OsListenerAsso"}),e.extend({type:"OsPortUsage"}),e.extend({type:"OsRouterAsso",appendLineToCanvas:function(e){return this.canvas.appendGroupLine(e)}}),e.extend({type:"OsPoolMembership"})})}.call(this),function(){define("workspaces/oseditor/EditorOs",["OpsEditor","./OsEditorStack","./OsEditorApp","./model/OsModelFloatIp","./model/OsModelHealthMonitor","./model/OsModelListener","./model/OsModelNetwork","./model/OsModelElb","./model/OsModelPool","./model/OsModelPort","./model/OsModelRt","./model/OsModelKeypair","./model/OsModelServer","./model/OsModelSg","./model/OsModelSgRule","./model/OsModelSubnet","./model/OsModelVolume","./model/connection/OsFloatIpUsage","./model/connection/OsListenerAsso","./model/connection/OsPoolMembership","./model/connection/OsPortUsage","./model/connection/OsRouterAsso","./model/connection/OsSgAsso","./model/connection/OsVolumeUsage","./model/seVisitors/AppToStack","./canvas/CeNetwork","./canvas/CeSubnet","./canvas/CeRt","./canvas/CePool","./canvas/CeListener","./canvas/CeElb","./canvas/CeServer","./canvas/CePort","./canvas/CeOsLine"],function(e,t,n){var r;return r=function(e){return e.isStack()?new t(e):new n(e)},e.registerEditors(r,function(e){return e.type==="OpenstackOps"}),r})}.call(this);