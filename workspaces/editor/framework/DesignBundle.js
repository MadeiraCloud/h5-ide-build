(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("Design",["constant","OpsModel","CloudResources"],function(t,n,r){var i,s,o,u;return o=function(){return o.o||(o.o={check:function(){}})},u=function(){},i=function(e){var t,n;return t=(new s(e)).use(),n=e.getJsonData(),t.deserialize($.extend(!0,{},n.component),$.extend(!0,{},n.layout)),t},_.extend(i,Backbone.Events),i.__modelClassMap={},i.__resolveFirstMap={},i.__serializeVisitors=[],i.__deserializeVisitors=[],i.__instance=null,s=function(e){var t,r,s;return this.__componentMap={},this.__classCache={},this.__usedUidCache={},this.__opsModel=e,this.__initializing=!1,t=e.getJsonData(),e.testState(n.State.UnRun)?this.__mode=i.MODE.Stack:this.__mode=i.MODE.App,r=t.component,s=t.layout,delete t.component,delete t.layout,this.attributes=$.extend(!0,{canvasSize:s.size},t),t.component=r,t.layout=s,null},i.TYPE={Classic:"ec2-classic",Vpc:"ec2-vpc",DefaultVpc:"default-vpc",CustomVpc:"custom-vpc"},i.MODE={Stack:"stack",App:"app",AppEdit:"appedit"},i.EVENT={ChangeResource:"CHANGE_RESOURCE",AddResource:"ADD_RESOURCE",RemoveResource:"REMOVE_RESOURCE",Deserialized:"DESERIALIZED"},s.prototype.refreshAppUpdate=function(){var n;return n=[t.RESTYPE.ASG],this.eachComponent(function(t){var r;if(r=t.type,e.call(n,r)>=0)return t.draw()}),null},s.prototype.deserialize=function(e,t){var n,r,s,a,f,l,c,h,p,d,v,m,g;void 0,void 0,p=this.get("version"),g=i.__deserializeVisitors;for(d=0,v=g.length;d<v;d++)a=g[d],a(e,t,p);this.trigger=i.trigger=u,this.__initializing=!0,s={coordinate:[0,0],size:[0,0]},c=this,l=function(n){var r,o,u;if(!n)return null;u=c.__componentMap[n];if(u)return u;f.check(n),o=e[n];if(!o){void 0;return}r=i.modelClassForType(o.type);if(!r){void 0;return}return r.deserialize(o,t[n]||s,l),i.__instance.__componentMap[n]},m=this.component,this.component=null;for(h in e){r=e[h],this.__usedUidCache[h]=!0;if(i.__resolveFirstMap[r.type]===!0){n=i.modelClassForType(r.type);if(!n){void 0;continue}if(!n.preDeserialize){void 0;continue}n.preDeserialize(r,t[h]||s)}}this.component=l;for(h in e)r=e[h],i.__resolveFirstMap[r.type]===!0?(f=o(h),i.modelClassForType(r.type).deserialize(r,t[h]||s,l)):(f=o(),l(h));this.component=m;for(h in e)r=e[h],n=i.modelClassForType(r.type),n&&n.postDeserialize&&n.postDeserialize(r,t[h]||s);return this.__initializing=!1,this.trigger=i.trigger=Backbone.Events.trigger,i.trigger(i.EVENT.Deserialized),this.trigger(i.EVENT.Deserialized),null},s.prototype.reload=function(){var e,t;t=i.instance(),this.use(),s.call(this,this.__opsModel),e=this.__opsModel.getJsonData(),this.deserialize($.extend(!0,{},e.component),$.extend(!0,{},e.layout)),t&&t.use()},i.registerModelClass=function(e,t,n){return this.__modelClassMap[e]=t,n&&(this.__resolveFirstMap[e]=n),null},s.prototype.classCacheForCid=function(e){var t;return this.__classCache[e]?this.__classCache[e]:(t=this.__classCache[e]=[],t)},s.prototype.cacheComponent=function(e,t){return t?this.__componentMap[e]=t:(t=this.__componentMap,delete this.__componentMap[e],this.modeIsAppEdit()&&this.reclaimGuid(e)),null},i.registerSerializeVisitor=function(e){return this.__serializeVisitors.push(e),null},i.registerDeserializeVisitor=function(e){return this.__deserializeVisitors.push(e),null},i.instance=function(){return this.__instance},i.modelClassForType=function(e){return this.__modelClassMap[e]},i.modelClassForPorts=function(e,t){var n;return e<t?n=e+">"+t:n=t+">"+e,this.__modelClassMap[n]},i.lineModelClasses=function(){var e,t,n,r;if(this.__lineModelClasses)return this.__lineModelClasses;this.__lineModelClasses=e=[],r=this.__modelClassMap;for(n in r)t=r[n],t.__isLineClass&&n.indexOf(">")===-1&&e.push(t);return this.__lineModelClasses},s.prototype.reclaimGuid=function(e){return delete this.__usedUidCache[e]},s.prototype.guid=function(){var e;e=MC.guid();while(this.__usedUidCache[e])void 0,e=MC.guid();return this.__usedUidCache[e]=!0,e},s.prototype.set=function(e,t){this.attributes[e]=t,this.trigger("change:"+e),this.trigger("change")},s.prototype.get=function(e){return e==="id"?this.__opsModel.get("id"):e==="state"?this.__opsModel.getStateDesc():this.attributes[e]},s.prototype.type=function(){return i.TYPE.Vpc},s.prototype.region=function(){return this.attributes.region},s.prototype.modeIsStack=function(){return this.__mode===i.MODE.Stack},s.prototype.modeIsApp=function(){return this.__mode===i.MODE.App},s.prototype.modeIsAppView=function(){return!1},s.prototype.modeIsAppEdit=function(){return this.__mode===i.MODE.AppEdit},s.prototype.mode=function(){return this.__mode},s.prototype.setMode=function(e){if(this.__mode===e)return;this.__mode=e,this.preserveName(),this.trigger("change:mode",e)},s.prototype.initializing=function(){return this.__initializing},s.prototype.use=function(){return i.__instance=this,this},s.prototype.unuse=function(){i.__instance===this&&(i.__instance=null)},s.prototype.component=function(e){return this.__componentMap[e]},s.prototype.componentsOfType=function(e){return this.classCacheForCid(i.modelClassForType(e).prototype.classId).slice(0)},s.prototype.eachComponent=function(e,t){var n,r,i;void 0,t=t||this,i=this.__componentMap;for(r in i){n=i[r];if(e.call(t,n)===!1)break}return null},s.prototype.isModified=function(){var e,t;return this.modeIsApp()?(void 0,!1):(e=this.__opsModel.getJsonData(),this.attributes.name!==e.name?!0:(t=this.serialize(),_.isEqual(e.component,t.component)&&_.isEqual(e.layout,t.layout)?!1:!0))},s.prototype.serialize=function(e){var t,n,r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;o=i.instance(),this.use(),void 0,r={},c={},s=[],h=[],x=this.__componentMap;for(v in x){n=x[v];if(n.isRemoved()){void 0;continue}if(n.node_line){s.push(n);continue}try{l=n.serialize(e)}catch(N){a=N,void 0}finally{}if(!l)continue;_.isArray(l)||(h[0]=l,l=h);for(g=0,w=l.length;g<w;g++)f=l[g],f.component&&(void 0,void 0,r[f.component.uid]=f.component),f.layout&&(c[f.layout.uid]=f.layout)}for(y=0,E=s.length;y<E;y++){t=s[y],p=t.port1Comp(),d=t.port2Comp();if(p&&d&&!p.isRemoved()&&!d.isRemoved())try{t.serialize(r,c)}catch(N){a=N,void 0}finally{}else void 0}u=$.extend(!0,{},this.attributes),u.component=r,u.layout=c,T=i.__serializeVisitors;for(b=0,S=T.length;b<S;b++)m=T[b],m(r,c,e);return u.layout.size=u.canvasSize,delete u.canvasSize,u.property=this.attributes.property||{},u.property.stoppable=this.isStoppable(),u.version="2014-02-17",u.state=this.__opsModel.getStateDesc()||"Enabled",u.id=this.__opsModel.get("id"),o&&o.use(),u},s.prototype.serializeAsStack=function(e){var t;return t=this.serialize({toStack:!0}),t.name=e||t.name,t.state="Enabled",t.id="",t.owner="",t.usage="",delete t.history,delete t.stack_id,t},s.prototype.preserveName=function(){var e,n,r,i;if(!this.modeIsAppEdit())return;this.__preservedNames={},i=this.__componentMap;for(r in i){e=i[r];switch(e.type){case t.RESTYPE.ELB:case t.RESTYPE.ASG:case t.RESTYPE.LC:case t.RESTYPE.DBINSTANCE:n=this.__preservedNames[e.type]||(this.__preservedNames[e.type]={}),n[e.get("name")]=!0}}},s.prototype.isPreservedName=function(e,t){var n;return this.modeIsAppEdit()?this.__preservedNames?(n=this.__preservedNames[e],n&&n[t]):!1:!1},s.prototype.getCost=function(e){var n,r,i,s,o,u,a,f,l,c,h,p;s=[],a=0,u=App.model.getPriceData(this.region());if(u){o=u.currency||"USD",h=this.__componentMap;for(f in h){r=h[f];if(e&&(p=r.type)!==t.RESTYPE.EIP&&p!==t.RESTYPE.VOL&&p!==t.RESTYPE.ELB&&p!==t.RESTYPE.CW)continue;if(r.getCost){i=r.getCost(u,o);if(!i)continue;if(i.length)for(l=0,c=i.length;l<c;l++)n=i[l],a+=n.fee,s.push(n);else a+=i.fee,s.push(i)}}s=_.sortBy(s,"resource")}return{costList:s,totalFee:Math.round(a*100)/100}},s.prototype.isStoppable=function(){var e,n,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;e=i.modelClassForType(t.RESTYPE.INSTANCE),n=i.modelClassForType(t.RESTYPE.LC),s=e.allObjects(this).concat(n.allObjects(this));for(p=0,m=s.length;p<m;p++){a=s[p],o=a.getAmi()||a.get("cachedAmi");if(o&&o.rootDeviceType==="instance-store")return!1}c=i.modelClassForType(t.RESTYPE.VPC).allObjects(this);if(c.length>0){h=c[0].get("appId"),l=r(t.RESTYPE.INSTANCE,this.region()).filter(function(e){return e.RES_TAG===h});for(d=0,g=l.length;d<g;d++){f=l[d],f=f.attributes,b=f.blockDeviceMapping||[];for(v=0,y=b.length;v<y;v++){u=b[v];if(u.ebs===null&&u.VirtualName)return!1}}}return!0},s.prototype.instancesNoUserData=function(){var e,n,r;return r=!0,e=i.modelClassForType(t.RESTYPE.INSTANCE).allObjects(),_.each(e,function(e){return r=e.get("userData")?!1:!0,null}),n=i.modelClassForType(t.RESTYPE.LC).allObjects(),_.each(n,function(e){return r=e.get("userData")?!1:!0,null}),r},_.extend(s.prototype,Backbone.Events),i})}).call(this),function(){define("workspaces/editor/framework/ResourceModel",["Design","event","backbone","CloudResources","constant"],function(e,t,n,r,i){var s,o,u,a;return o=function(e){var t,n,r,i,s,u,a;if(e===null||!_.isObject(e))return e;if(_.isArray(e)){i=[];for(n=u=0,a=e.length;u<a;n=++u)t=e[n],i[n]=o(t);return i}i={};for(r in e)s=e[r],s!==null&&_.isObject(s)?i[r]=o(s):i[r]=s;return i},u=n.Model.extend,a={},s=n.Model.extend({classId:_.uniqueId("dfc_"),type:"Framework_R",constructor:function(t,r){var i;i=e.instance(),this.__design=i,t||(t={}),t.id||(t.id=i.guid());if(!t.name||!this.isNameAvailable(t.name))t.name=this.getNewName(void 0,t.name),t.name||delete t.name;return i.classCacheForCid(this.classId).push(this),i.cacheComponent(t.id,this),n.Model.call(this,t,r||a),this.attributes.name||(this.attributes.name=""),this.attributes.appId||(this.attributes.appId=""),this.attributes.description||(this.attributes.description=""),e.trigger(e.EVENT.AddResource,this),i.trigger(e.EVENT.AddResource,this),this.listenTo(this,"change",this.__triggerChangeInDesign),this},__triggerChangeInDesign:function(){this.design().trigger(e.EVENT.ChangeResource,this)},isNameAvailable:function(e){var t,n,r,i;if(this.design().isPreservedName(this.type,e))return!1;i=this.getAllObjects();for(n=0,r=i.length;n<r;n++){t=i[n];if(t.get("name")===e)return!1}return!0},getNewName:function(e,t){var n,r;t=t||this.newNameTmpl;if(!t)return r=this.defaults?this.defaults.name:void 0,r||"";e===void 0&&(e=this.getAllObjects().length),n={},this.design().eachComponent(function(e){return e.get("name")&&(n[e.get("name")]=!0),null});for(;;){r=t+e;if(!n[r]&&!this.design().isPreservedName(this.type,r))break;e+=1}return r},hasAppResource:function(){return!e.instance().modeIsStack()&&this.get("appId")?!!this.get("appId")&&r(this.type,this.design().region()).get(this.get("appId")):!0},isDesignAwake:function(){return e.instance()===this.__design},design:function(){return this.__design},getAllObjects:function(t){return this.design().classCacheForCid(e.modelClassForType(t||this.type).prototype.classId).slice(0)},markAsRemoved:function(e){return e===void 0?this.__isRemoved=!0:this.__isRemoved=!!e,null},isVisual:function(){return!1},isRemoved:function(){return this.__isRemoved===!0},isRemovable:function(){return!0},isReparentable:function(){return!0},serialize:function(){return void 0,null},destroy:function(){return this.remove()},remove:function(){var t,n;if(this.isRemoved()){void 0;return}return this.__isRemoved=!0,void 0,n=e.instance(),t=n.classCacheForCid(this.classId),t.splice(t.indexOf(this),1),n.cacheComponent(this.id),this.stopListening(),this.trigger("destroy",this),this.trigger("__remove"),this.off(),this.__design=null,e.trigger(e.EVENT.RemoveResource,this),n.trigger(e.EVENT.RemoveResource,this),null},createRef:function(e,t,n){return _.isString(t)&&(n=t,t=!0),n=n||this.id,n?t!==!1?MC.genResRef(n,"resource."+e):MC.genResRef(n,""+e):""},listenTo:function(t,r,i){var s,o;return s=e.modelClassForType(t.type),s&&(!this._listeners||!this._listeners[t._listenerId])&&(o=this,t.once("__remove",function(){return o.stopListening(this)})),n.Events.listenTo.call(this,t,r,i)},clone:null,cloneAttributes:function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m;void 0,n=n||{},u=n.reserve||"",a="id|appId|x|y|width|height|name",o=n.copyConnection||[],v=t.attributes;for(i in v){l=v[i];if(i.indexOf("__")===0||a.indexOf(i)!==-1||u.indexOf(i)!==-1)continue;l!==null&&_.isObject(l)&&(l=this.cloneObjectAttributes(i,l)),this.attributes[i]=l}for(c=0,p=o.length;c<p;c++){s=o[c],r=e.modelClassForType(s),m=t.connectionTargets(s);for(h=0,d=m.length;h<d;h++)f=m[h],new r(f,this)}return null},cloneObjectAttributes:function(e,t){return o(t)}},{allObjects:function(t){var n;return n=e.instance(),t&&t.prototype===n.prototype&&(n=t),n.classCacheForCid(this.prototype.classId).slice(0)},deserialize:function(){return void 0,null},extend:function(t,n){var r,i,s,o,a,f;void 0,n&&(r=n.handleTypes,i=n.resolveFirst,delete n.handleTypes,delete n.resolveFirst),t.classId=_.uniqueId("dfc_"),s=u.call(this,t,n),r||(r=t.type);if(r){_.isString(r)&&(r=[r]);for(a=0,f=r.length;a<f;a++)o=r[a],e.registerModelClass(o,s,i)}return s}}),e.registerModelClass(s.prototype.type,s),_.each(["forEach","each","map","reduce","find","filter","reject","every","some","contains","invoke","max","min","size","first","without","isEmpty","chain","sample"],function(e){return s[e]=function(){var t;return t=[].slice.call(arguments),t.unshift(this.allObjects()),_[e].apply(_,t)}}),s.where=function(e,t){return _.isEmpty(e)?t!=null?t:{"null":[]}:this[t&&"find"||"filter"](function(t){var n;for(n in e)if(e[n]!==t.get(n))return!1;return!0})},s.findWhere=function(e){return this.where(e,!0)},s})}.call(this),function(){define("workspaces/editor/framework/ConnectionModel",["./ResourceModel","Design"],function(e,t){var n;return n=e.extend({node_line:!0,type:"Framework_CN",constructor:function(n,r,i,s){var o,u,a,f,l,c;if(!n||!r){void 0;return}if(!s||s.detectDuplicate!==!1){u=t.modelClassForType(this.type).allObjects(),o=t.modelClassForType(this.type).findExisting(n,r);if(o)return void 0,i&&o.set(i),o}if(!this.assignCompsToPorts(n,r)){void 0;return}e.call(this,i,s);if(this.__destroyAfterInit)return this.remove(this),this.id="",this;this.__port1Comp.connect_base(this),this.__port1Comp!==this.__port2Comp&&this.__port2Comp.connect_base(this);if(this.oneToMany){void 0,a=this.getOtherTarget(this.oneToMany),c=a.connections(this.type);for(f=0,l=c.length;f<l;f++)o=c[f],o!==this&&o.remove(this)}return this},setDestroyAfterInit:function(){return this.__destroyAfterInit=!0,null},assignCompsToPorts:function(e,t){var n,r,i,s;if(this.portDefs){s=this.portDefs;for(r=0,i=s.length;r<i;r++){n=s[r];if(n.port1.type===e.type&&n.port2.type===t.type){this.__portDef=n,this.__port1Comp=e,this.__port2Comp=t;break}if(n.port1.type===t.type&&n.port2.type===e.type){this.__portDef=n,this.__port1Comp=t,this.__port2Comp=e;break}}return!!this.__portDef}return this.__port1Comp=e,this.__port2Comp=t,!0},port:function(e,t){return this.__portDef?this.__port1Comp===e||this.__port1Comp.id===e?this.__portDef.port1[t]:this.__port2Comp===e||this.__port2Comp.id===e?this.__portDef.port2[t]:"":""},port1:function(e){return this.__portDef?this.__portDef.port1[e]:""},port2:function(e){return this.__portDef?this.__portDef.port2[e]:""},connectsTo:function(e){return this.__port1Comp&&this.__port1Comp.id===e||this.__port2Comp&&this.__port2Comp.id===e},port1Comp:function(){return this.__port1Comp},port2Comp:function(){return this.__port2Comp},getOtherTarget:function(e){return _.isString(e)?this.__port1Comp.type===e?this.__port2Comp:this.__port1Comp:this.__port1Comp===e?this.__port2Comp:this.__port1Comp},getTarget:function(e){return this.__port1Comp.type===e?this.__port1Comp:this.__port2Comp.type===e?this.__port2Comp:null},remove:function(t){var n,r;return void 0,n=!this.__port1Comp.isRemoved(),r=!this.__port2Comp.isRemoved(),n&&this.__port1Comp.attach_connection(this,!0),r&&this.__port2Comp.attach_connection(this,!0),n&&this.__port1Comp.disconnect_base(this,t),r&&this.__port2Comp.disconnect_base(this,t),e.prototype.remove.call(this),null},serialize:function(){return null},isVisual:function(){return!!this.portDefs},draw:function(){return void 0}},{findExisting:function(e,t){var n,r,i,s;s=this.allObjects();for(r=0,i=s.length;r<i;r++){n=s[r];if(n.port1Comp()===e&&n.port2Comp()===t&&!n.isRemoved())return n;if(n.port2Comp()===e&&n.port1Comp()===t&&!n.isRemoved())return n}return null},extend:function(n,r){var i,s,o,u,a,f,l,c,h,p;u=[];if(n.portDefs){_.isArray(n.portDefs)||(n.portDefs=[n.portDefs]),p=n.portDefs;for(f=0,c=p.length;f<c;f++)s=p[f],s.port1.name>s.port2.name&&(a=s.port1,s.port1=s.port2,s.port2=a),u.push(s.port1.name+">"+s.port2.name);n.type||(n.type=u[0])}i=e.extend.call(this,n,r);for(l=0,h=u.length;l<h;l++)o=u[l],t.registerModelClass(o,i);return t.registerModelClass(n.type,i),i.__isLineClass=!0,i},isConnectable:function(e,t){return!0},connectionData:function(e,n){var r,i,s,o,u,a,f,l,c,h,p,d;i={},p=t.lineModelClasses();for(f=0,c=p.length;f<c;f++){r=p[f];if(!r.prototype.portDefs)continue;d=r.prototype.portDefs;for(l=0,h=d.length;l<h;l++){o=d[l];if(o.port1.type===e)a=o.port1,u=o.port2;else{if(o.port2.type!==e)continue;a=o.port2,u=o.port1}if(!n||n===a.name)s=i[u.type]||(i[u.type]=[]),s.push(u.name)}}return i}}),n})}.call(this),function(){define("workspaces/editor/framework/connection/EniAttachment",["constant","../ConnectionModel","i18n!/nls/lang.js"],function(e,t,n){var r;return r=t.extend({type:"EniAttachment",defaults:{index:1},initialize:function(t){var n;return n=this.getTarget(e.RESTYPE.INSTANCE),t&&t.index?this.ensureAttachmentOrder():this.attributes.index=n.connectionTargets("EniAttachment").length+1,null},ensureAttachmentOrder:function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;t=this.getTarget(e.RESTYPE.INSTANCE),i=t.connections("EniAttachment");for(a=0,c=i.length;a<c;a++){r=i[a];if(r!==this&&r.attributes.index===this.attributes.index){for(o=f=0,h=i.length;f<h;o=++f)r=i[o],r.attributes.index=o+1,r.getOtherTarget(t).updateName();return}}u=i.sort(function(e,t){return e.attributes.index-t.attributes.index});if(i.indexOf(this)!==u.indexOf(this)){n=[],d=t.get("__connections");for(l=0,p=d.length;l<p;l++)s=d[l],s.type!=="EniAttachment"&&n.push(s);t.attributes.__connections=n.concat(u)}return null},remove:function(){var n,r,i,s,o,u;t.prototype.remove.apply(this,arguments),r=this.getTarget(e.RESTYPE.INSTANCE),o=this.getTarget(e.RESTYPE.ENI);if(!r.isRemoved()){s=r.connections("EniAttachment"),u=1;while(u<=s.length)i=s[u-1],i.attributes.index!==u&&(i.attributes.index=u,i.getTarget(e.RESTYPE.ENI).updateName()),++u}return!r.isRemoved()&&!o.isRemoved()&&(n=Design.modelClassForType(e.RESTYPE.SG),n.tryDrawLine(r,o)),null},portDefs:{port1:{name:"instance-attach",type:e.RESTYPE.INSTANCE},port2:{name:"eni-attach",type:e.RESTYPE.ENI}}},{isConnectable:function(t,r){var i,s,o,u,a;return u=t.parent(),a=r.parent(),!u||!a?!1:(u.type===e.RESTYPE.SUBNET&&(u=u.parent(),a=a.parent()),u!==a?!1:(t.type===e.RESTYPE.INSTANCE?(s=t,i=r):(s=r,i=t),i.connections("EniAttachment").length>0?!1:(o=s.getMaxEniCount(),s.connections("EniAttachment").length+1>=o?sprintf(n.ide.CVS_WARN_EXCEED_ENI_LIMIT,s.get("name"),s.get("instanceType"),o):s.getEmbedEni().get("assoPublicIp")===!0?{confirm:!0,title:"Attach Network Interface to Instance",action:"Attach and Remove Public IP",template:MC.template.modalAttachingEni({host:s.get("name"),eni:i.get("name")})}:!0)))}}),r})}.call(this),function(){define("workspaces/editor/framework/connection/VPNConnection",["constant","../ConnectionModel"],function(e,t){var n;return n=t.extend({type:e.RESTYPE.VPN,defaults:function(){return{routes:[]}},portDefs:{port1:{name:"vgw-vpn",type:e.RESTYPE.VGW},port2:{name:"cgw-vpn",type:e.RESTYPE.CGW}},serialize:function(t){var n,r,i;return i=this.getTarget(e.RESTYPE.VGW),n=this.getTarget(e.RESTYPE.CGW),n.isDynamic()?r=[]:r=_.map(this.get("routes"),function(e){return{DestinationCidrBlock:e}}),t[this.id]={name:"vpn:"+n.get("name"),type:this.type,uid:this.id,resource:{CustomerGatewayId:n.createRef("CustomerGatewayId"),Options:{StaticRoutesOnly:!n.isDynamic()},Type:"ipsec.1",Routes:r,VpnConnectionId:this.get("appId"),VpnGatewayId:i.createRef("VpnGatewayId")}},null}},{handleTypes:e.RESTYPE.VPN,deserialize:function(e,t,r){var i,s;i=r(MC.extractID(e.resource.CustomerGatewayId)),s=r(MC.extractID(e.resource.VpnGatewayId));if(!i||!s)return;return new n(i,s,{id:e.uid,appId:e.resource.VpnConnectionId,routes:_.map(e.resource.Routes,function(e){return e.DestinationCidrBlock})})}}),n})}.call(this),function(){define("workspaces/editor/framework/connection/DbReplication",["constant","../ConnectionModel"],function(e,t){return t.extend({type:"DbReplication",portDefs:{port1:{name:"replica",type:e.RESTYPE.DBINSTANCE},port2:{name:"replica",type:e.RESTYPE.DBINSTANCE}},master:function(){return this.__port1Comp},slave:function(){return this.__port2Comp},isRemovable:function(){return!1}})})}.call(this),function(){define("workspaces/editor/framework/ComplexResModel",["Design","./ResourceModel","constant"],function(e,t,n){var r,i;return i=[],r=t.extend({type:"Framework_CR",constructor:function(e,n){return e&&e.parent&&(e.__parent=e.parent,delete e.parent),t.call(this,e,n),e&&e.__parent&&(this.set("__parent",null),e.__parent.addChild(this)),null},setName:function(e){if(this.get("name")===e)return;return this.set("name",e),null},remove:function(){var e,n;this.markAsRemoved(),e=this.attributes.__connections;if(e){n=e.length;while(n)--n,e[n].remove()}return this.markAsRemoved(!1),t.prototype.remove.call(this),null},attach_connection:function(e,t){var n,r;return n=this.get("__connections")||[],r=n.indexOf(e),t?r!==-1&&n.splice(r,1):r===-1&&(n.push(e),this.attributes.__connections=n),this.trigger("change:connections",e),null},connect_base:function(e){return this.attach_connection(e),this.connect&&this.connect(e),null},disconnect_base:function(e,t){return this.attach_connection(e,!0),this.disconnect&&this.disconnect(e,t),null},isVisual:function(){return!0},draw:function(){return void 0},connections:function(e){var t;return t=this.get("__connections"),t&&_.isString(e)&&(t=_.filter(t,function(t){return t.type===e})),t||i},connectionTargets:function(e){var t,n,r,i,s;r=[],n=this.get("__connections");if(n)for(i=0,s=n.length;i<s;i++)t=n[i],(!e||t.type===e)&&r.push(t.getOtherTarget(this));return r},getSubnetRef:function(){var e;e=this;while(e){if(e.type===n.RESTYPE.SUBNET)break;e=e.parent()}return e?e.createRef("SubnetId"):""},getVpcRef:function(){var t,r;r=this;while(r){if(r.type===n.RESTYPE.VPC)break;r=r.parent()}return r||(t=e.modelClassForType(n.RESTYPE.VPC),r=t.theVPC()),r?r.createRef("VpcId"):""},generateLayout:function(){var e;return e={coordinate:[this.x(),this.y()],uid:this.id},this.parent()&&(e.groupUId=this.parent().id),e},parent:function(){return this.get("__parent")||null},x:function(){return this.get("x")||0},y:function(){return this.get("y")||0},width:function(){return this.get("width")||0},height:function(){return this.get("height")||0}}),r})}.call(this),function(){define("workspaces/editor/framework/resource/InstanceModel",["../ComplexResModel","Design","constant","i18n!/nls/lang.js","CloudResources"],function(e,t,n,r,i){var s,o;return o=[],s=e.extend({type:n.RESTYPE.INSTANCE,newNameTmpl:"host-",defaults:{count:1,imageId:"",tenancy:"default",ebsOptimized:!1,instanceType:"m1.small",monitoring:!1,userData:"",rdSize:0,rdIops:0,rdType:"gp2",cachedAmi:null,state:null},initialize:function(e,r){var i,s,o,u,a,f,l,c,h;r=r||{},r.cloneSource&&(e.imageId=r.cloneSource.get("imageId")),void 0,this.setAmi(e.imageId);if(r.createByUser||r.cloneSource)i=t.modelClassForType(n.RESTYPE.ENI),this.setEmbedEni(new i({name:"eni0",assoPublicIp:!1},{instance:this}));return r.cloneSource?this.clone(r.cloneSource):r.createByUser&&this.initInstanceType(),this.get("rdSize")||(c=this.getAmiRootDeviceVolumeSize(),c>0&&this.set("rdSize",c)),r.createByUser&&!r.cloneSource&&(s=t.modelClassForType(n.RESTYPE.KP),a=s.getDefaultKP(),a?a.assignTo(this):void 0,u=t.modelClassForType(n.RESTYPE.SG),f=u.getDefaultSg(),f?(o=t.modelClassForType("SgAsso"),new o(this,f)):void 0),l=this.get("tenancy"),h=t.modelClassForType(n.RESTYPE.VPC).theVPC(),h&&!h.isDefaultTenancy()&&(l="dedicated"),this.setTenancy(l),null},groupMembers:function(){return this.__groupMembers||(this.__groupMembers=[]),this.__groupMembers},getAvailabilityZone:function(){var e;return e=this.parent(),e.type===n.RESTYPE.SUBNET?e.parent():e},getOSFamily:function(){var e;return e=this.getAmi()||this.get("cachedAmi"),!e||!e.osType||!e.osFamily?(void 0,"linux"):e.osFamily?e.osFamily:i(n.RESTYPE.AMI,this.design.region()).getOSFamily(e.id)},initInstanceType:function(){var e,t,n,r,i;i=this.getInstanceTypeList();for(n=0,r=i.length;n<r;n++){e=i[n];if(e.name!=="t1.micro"){t=e.name;break}}this.attributes.instanceType=t||"m1.small"},getCost:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;if(!e.instance)return null;n=this.getAmi()||this.get("cachedAmi"),l=n?n.osType:"linux-other",f=this.getOSFamily(),u=this.get("instanceType").split("."),p=e.instance.unit,s=e.instance[u[0]][u[1]],s=s?s.onDemand:void 0,s&&(s[f]===void 0&&f.indexOf("mswin")===0&&(f="mswin"),s=s[f]),s=s?s[t]:void 0;if(!s)return null;p==="perhr"?(o=s+"/hr",s*=720):o=s+"/mo",r=this.get("count")||1,a=this.get("name"),r>1&&(a+=" (x"+r+")",s*=r),c={resource:a,type:this.get("instanceType"),fee:s,formatedFee:o};if(this.get("monitoring")){m=e.cloudwatch.types;for(d=0,v=m.length;d<v;d++){h=m[d];if(h.ec2Monitoring)return s=h.ec2Monitoring[t],i={resource:this.get("name")+"-monitoring",type:"CloudWatch",fee:s*r,formatedFee:s+"/mo"},[c,i]}}return c},isReparentable:function(e){var t;return e.type===n.RESTYPE.ASG||e.type==="ExpandedAsg"?!1:(e.type===n.RESTYPE.SUBNET?e.parent()!==this.parent().parent()&&(t=!0):t=!0,t&&this.connectionTargets("EniAttachment").length>0?r.ide.CVS_MSG_ERR_MOVE_ATTACHED_ENI:!0)},connect:function(e){var t;if(e.type==="EniAttachment"){t=this.getEmbedEni();if(t)return t.set("assoPublicIp",!1)}},setPrimaryEip:function(e){var t;t=this.getEmbedEni(),t?t.setPrimaryEip(e):(this.set("hasEip",e),e&&(this.attributes.eipData||(this.attributes.eipData={}),this.attributes.eipData.id||(this.attributes.eipData.id=MC.guid())))},hasPrimaryEip:function(){var e;return e=this.getEmbedEni(),e?e.hasPrimaryEip():this.get("hasEip")},hasAutoAssignPublicIp:function(){return this.getEmbedEni().get("assoPublicIp")},setCount:function(e){var t,n,r,i,s,o,u,a,f;this.set("count",e),e>1&&(r=this.connections("RTB_Route")[0],r&&r.remove()),a=this.connectionTargets("EniAttachment");for(i=0,o=a.length;i<o;i++){n=a[i];if(e>1){f=n.connections("RTB_Route");for(s=0,u=f.length;s<u;s++)t=f[s],t.remove()}}return null},isDefaultTenancy:function(){var e,r;return e=t.modelClassForType(n.RESTYPE.VPC),r=e.allObjects()[0],r&&!r.isDefaultTenancy()?!1:this.get("tenancy")!=="dedicated"},setAmi:function(e){var t,n,r,i,s;return this.set("imageId",e),t=this.getAmi(),n=this.get("cachedAmi"),t&&n&&(n.osType=t.osType,n.architecture=t.architecture,n.rootDeviceType=t.rootDeviceType),t&&t.blockDeviceMapping&&!$.isEmptyObject(t.blockDeviceMapping)&&(s=t.rootDeviceName,i=t.blockDeviceMapping[s],i||_.each(t.blockDeviceMapping,function(e,t){return s.indexOf(t)!==-1&&!i&&(i=e),null}),r=i?parseInt(i.volumeSize,10):10,this.get("rdSize")<r&&this.set("rdSize",r)),null},getAmi:function(){var e;return e=i(n.RESTYPE.AMI,this.design().region()).get(this.get("imageId")),e?e.toJSON():null},getBlockDeviceMapping:function(){var e,t,n,r;return e=this.getAmi()||this.get("cachedAmi"),e&&e.rootDeviceType==="ebs"&&e.blockDeviceMapping&&!$.isEmptyObject(e.blockDeviceMapping)&&(r=e.rootDeviceName,n=e.blockDeviceMapping[r],n||_.each(e.blockDeviceMapping,function(e,t){return r.indexOf(t)!==-1&&!n&&(n=e,r=t),null}),t=[{DeviceName:r,Ebs:{SnapshotId:n.snapshotId,VolumeSize:this.get("rdSize")||n.volumeSize,VolumeType:this.get("rdType")}}],this.get("rdIops")&&parseInt(this.get("rdSize"),10)>=10&&(t[0].Ebs.Iops=this.get("rdIops"))),t||[]},getAmiRootDevice:function(){var e,t,n,r;return e=this.getAmi()||this.get("cachedAmi"),t=null,e&&e.rootDeviceType==="ebs"&&e.blockDeviceMapping&&(r=e.rootDeviceName,n=e.blockDeviceMapping[r],r&&!n&&_.each(e.blockDeviceMapping,function(e,t){return r.indexOf(t)!==-1&&!n&&(n=e,r=t),null}),r&&n?(t={DeviceName:r,Ebs:{VolumeSize:Number(n.volumeSize),SnapshotId:n.snapshotId,VolumeType:n.volumeType}},n.volumeType==="io1"&&(t.Ebs.Iops=n.iops)):void 0),t},getAmiRootDeviceVolumeSize:function(){var e,t,n,r;return n=0,e=this.getAmi(),e?(e.osType==="windows"?r=30:r=10,t=this.getAmiRootDevice(),t?n=t.Ebs.VolumeSize:void 0):void 0,n},getAmiRootDeviceName:function(){var e;return e=this.getAmiRootDevice(),e&&e.DeviceName?e.DeviceName:""},getInstanceTypeConfig:function(e){var t;return t=App.model.getInstanceTypeConfig(this.design().region()),t?t[e||this.get("instanceType")]:null},getMaxEniCount:function(){var e;return e=this.getInstanceTypeConfig(),e&&(e=e.eni),e||16},isEbsOptimizedEnabled:function(){var e,t,n;return t=this.getAmi()||this.get("cachedAmi"),t&&t.rootDeviceType==="instance-store"?!1:(n=this.getInstanceTypeConfig(),n&&n.ebs_optimized?n.ebs_optimized==="Yes":(e={"m1.large":!0,"m1.xlarge":!0,"m2.2xlarge":!0,"m2.4xlarge":!0,"m3.xlarge":!0,"m3.2xlarge":!0,"c1.xlarge":!0,"c3.xlarge":!0,"c3.2xlarge":!0,"c3.4xlarge":!0,"g2.2xlarge":!0,"i2.xlarge":!0,"i2.2xlarge":!0,"i2.4xlarge":!0},!!e[this.get("instanceType")]))},setInstanceType:function(e){var t,n,r,i,s;e==="t1.micro"&&!this.isDefaultTenancy()&&(e="m1.small"),this.set("instanceType",e),this.isEbsOptimizedEnabled()||this.set("ebsOptimized",!1),r=this.get("volumeList"),r&&_.each(r,function(e){return e.isSupportEncrypted()||e.set("encrypted",!1),null});if(this.getEmbedEni){n=this.connectionTargets("EniAttachment"),n.push(this.getEmbedEni());for(i=0,s=n.length;i<s;i++)t=n[i],t.limitIpAddress()}return null},setTenancy:function(e){return this.set("tenancy",e),e==="dedicated"&&this.get("instanceType")==="t1.micro"&&this.initInstanceType(),null},getInstanceType:function(){return s.getInstanceType(this.getAmi(),this.design().region())},getInstanceTypeList:function(){var e,t,n;return n=this.isDefaultTenancy(),e=this.get("instanceType"),t=this.design().region(),_.map(this.getInstanceType(),function(r){var i;return i=App.model.getInstanceTypeConfig(t),i?(i=i[r].formated_desc,{main:i[0],ecu:i[1],core:i[2],mem:i[3],name:r,selected:e===r,hide:!n&&r==="t1.micro"}):{}})},remove:function(){var n,r,i,s,u,a,f,l;this.__mainEni&&this.__mainEni.remove(),f=(this.get("volumeList")||o).slice(0);for(i=0,u=f.length;i<u;i++)r=f[i],r.remove();if(t.instance().modeIsAppEdit()){l=this.connectionTargets("EniAttachment");for(s=0,a=l.length;s<a;s++)n=l[s],n.remove()}return e.prototype.remove.call(this),null},isRemovable:function(){var e;return e=this.get("state"),e&&_.isArray(e)&&e.length>0||$("#state-editor-model").is(":visible")&&$("#state-editor-model .state-list .state-item").length>=1?MC.template.NodeStateRemoveConfirmation({name:this.get("name")}):!0},clone:function(e){var r,i,s,o,u,a,f,l,c;this.cloneAttributes(e,{reserve:"volumeList",copyConnection:["KeypairUsage","SgAsso","ElbAmiAsso"]}),l=this.get("state")||[];for(o=0,a=l.length;o<a;o++)i=l[o],i.id="state-"+this.design().guid();r=t.modelClassForType(n.RESTYPE.VOL),c=e.get("volumeList")||[];for(u=0,f=c.length;u<f;u++)s=c[u],new r({owner:this},{cloneSource:s});return this.getEmbedEni().clone(e.getEmbedEni()),null},setEmbedEni:function(e){return this.__mainEni=e,null},getEmbedEni:function(){return this.__mainEni},getRealGroupMemberIds:function(){var e,t,n,r,i,s;this.ensureEnoughMember(),e=this.get("count"),n=[this.id],s=this.groupMembers();for(r=0,i=s.length;r<i;r++){t=s[r];if(n.length>=e)break;n.push(t.id)}return n},ensureEnoughMember:function(){var e;e=this.get("count")-1;while(this.groupMembers().length<e)this.groupMembers().push({id:MC.guid(),appId:"",eipData:{id:MC.guid()}});return null},onParentChanged:function(){var e;e=this.getEmbedEni();if(e)return e.onParentChanged()},generateJSON:function(){var e,t,r,i,s,o;return s=this.get("tenancy"),i=this.parent(),i.type===n.RESTYPE.SUBNET&&(o=i.parent().parent(),o.isDefaultTenancy()||(s="dedicated")),r=this.get("name"),this.get("count")>1&&(r+="-0"),e=this.getBlockDeviceMapping(),t={type:this.type,uid:this.id,name:r,index:0,number:this.get("count"),serverGroupUid:this.id,serverGroupName:this.get("name"),state:this.get("state"),resource:{UserData:{Base64Encoded:!1,Data:this.get("userData")},BlockDeviceMapping:e,Placement:{Tenancy:s==="dedicated"?"dedicated":"",AvailabilityZone:this.getAvailabilityZone().createRef()},InstanceId:this.get("appId"),ImageId:this.get("imageId"),KeyName:this.get("keyName"),EbsOptimized:this.isEbsOptimizedEnabled()?this.get("ebsOptimized"):!1,VpcId:this.getVpcRef(),SubnetId:this.getSubnetRef(),Monitoring:this.get("monitoring")?"enabled":"disabled",NetworkInterface:[],InstanceType:this.get("instanceType"),DisableApiTermination:!1,ShutdownBehavior:"terminate",SecurityGroup:[],SecurityGroupId:[]}},t},createEipJson:function(e,t){return t=t||this.id,{uid:e.id,type:n.RESTYPE.EIP,index:0,name:"EIP",resource:{Domain:"standard",InstanceId:this.createRef("InstanceId",t),AllocationId:e.allocationId||"",NetworkInterfaceId:"",PublicIp:e.publicIp||""}}},getStateData:function(){return this.get("state")},setStateData:function(e){return this.set("state",e)},setKey:function(e,r){var i,s,o;return i=t.modelClassForType(n.RESTYPE.KP),s=i.getDefaultKP(),r?s?s.assignTo(this):void 0:(o=this.connectionTargets("KeypairUsage")[0],o&&o.dissociate(this),this.set("keyName",e))},getKeyName:function(){var e;return e=this.connectionTargets("KeypairUsage")[0],e?e.isDefault()?"$DefaultKeyPair":e.get("name"):this.get("keyName")||"No Key Pair"},isDefaultKey:function(){var e;return e=this.connectionTargets("KeypairUsage")[0],e&&e.isDefault()},isNoKey:function(){var e;return e=this.connectionTargets("KeypairUsage")[0],!e&&!this.get("keyName")},serialize:function(){var e,t,n,r,i,s,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;e=[],t=this.getAmi()||this.get("cachedAmi"),h=this.generateLayout(),t&&(h.osType=t.osType,h.architecture=t.architecture,h.rootDeviceType=t.rootDeviceType),e.push({layout:h}),c=[this.generateJSON()],a=c.length,this.ensureEnoughMember();while(a<this.get("count"))p=$.extend(!0,{},c[0]),p.name=this.get("name")+"-"+a,p.index=a,d=this.groupMembers()[c.length-1],p.uid=d.id,p.resource.InstanceId=d.appId,++a,c.push(p);m={number:c.length,instanceId:""},b=this.get("volumeList")||o,s=this.getEmbedEni()?[this.getEmbedEni()]:[],M=this.connections("EniAttachment");for(E=0,N=M.length;E<N;E++)n=M[E],s[n.get("index")]=n.getOtherTarget(this);w=[],u=[];for(f=S=0,C=c.length;S<C;f=++S){l=c[f],m.instanceId=l.uid,m.instanceName=l.name+"-";for(x=0,k=b.length;x<k;x++)y=b[x],g=y.generateJSON(f,m),w.push(g);for(i=T=0,L=s.length;T<L;i=++T)r=s[i],u=u.concat(r.generateJSON(f,m,i))}_=c.concat(w).concat(u);for(O=0,A=_.length;O<A;O++)v=_[O],e.push({component:v});return e}},{handleTypes:n.RESTYPE.INSTANCE,getInstanceType:function(e,t){var r,i;if(!e||!t)return[];r=App.model.getOsFamilyConfig(t);try{r=r[e.osFamily]||r[n.OS_TYPE_MAPPING[e.osType]],r=e.rootDeviceType==="ebs"?r.ebs:r["instance store"],r=r[e.architecture],r=r[e.virtualizationType||"paravirtual"]}catch(s){i=s,void 0,r=[]}return r||[]},getEffectiveId:function(e){var r,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;o=t.instance();if(o.component(e))return{uid:e,mid:null};w=this.allObjects();for(h=0,m=w.length;h<m;h++){a=w[h];if(a.get("appId")===e)return{uid:a.id,mid:""+a.id+"_0"};if(a.groupMembers){E=a.groupMembers();for(u=p=0,g=E.length;p<g;u=++p){f=E[u];if(f&&f.appId===e)return{uid:a.id,mid:""+f.id+"_"+(u+1)}}}}c=i(n.RESTYPE.ASG,t.instance().region()),S=t.modelClassForType(n.RESTYPE.ASG).allObjects();for(d=0,y=S.length;d<y;d++){r=S[d],s=(x=c.get(r.get("appId")))!=null?x.toJSON():void 0;if(!s||!s.Instances)continue;s=s.Instances,T=s.member||s;for(v=0,b=T.length;v<b;v++){l=T[v];if(l===e||l.InstanceId===e)return{uid:r.getLc().id,mid:e}}}return{uid:null,mid:null}},deserialize:function(e,t,n){var r,i,o,u,a,f,l,c,h;if(e.serverGroupUid&&e.serverGroupUid!==e.uid){a=n(e.serverGroupUid).groupMembers();for(c=0,h=a.length;c<h;c++){u=a[c];if(u&&u.id===e.uid){void 0;return}}e.resource.EipResource&&(o={id:e.resource.EipResource.uid,allocationId:e.resource.EipResource.resource.AllocationId,publicIp:e.resource.EipResource.resource.PublicIp}),a[e.index-1]={id:e.uid,appId:e.resource.InstanceId,eipData:o||{id:MC.guid()}};return}l=e.resource.BlockDeviceMapping[0];if(!l||_.isString(l))l={Ebs:{VolumeSize:0,Iops:""}};if(!_.isArray(e.state)||!e.state.length)e.state=null;return i={id:e.uid,name:e.serverGroupName||e.name,appId:e.resource.InstanceId,count:e.number,imageId:e.resource.ImageId,tenancy:e.resource.Placement.Tenancy,ebsOptimized:e.resource.EbsOptimized,instanceType:e.resource.InstanceType,monitoring:e.resource.Monitoring!=="disabled",userData:e.resource.UserData.Data||"",rdSize:l.Ebs.VolumeSize,rdIops:l.Ebs.Iops,rdType:l.Ebs.VolumeType,parent:n(t.groupUId),x:t.coordinate[0],y:t.coordinate[1],state:e.state},e.resource.EipResource&&(i.hasEip=!0,i.eipData={id:e.resource.EipResource.uid,allocationId:e.resource.EipResource.resource.AllocationId}),t.osType&&t.architecture&&t.rootDeviceType&&(t.osType==="win"&&(t.osType="windows"),i.cachedAmi={osType:t.osType,architecture:t.architecture,rootDeviceType:t.rootDeviceType}),f=new s(i),r=n(MC.extractID(e.resource.KeyName)),r?r.assignTo(f):f.set("keyName",e.resource.KeyName),null}}),s})}.call(this),function(){define("workspaces/editor/framework/connection/SgAsso",["constant","../ConnectionModel","Design"],function(e,t,n){var r;return r=t.extend({type:"SgAsso",isVisual:function(){return!0},assignCompsToPorts:function(t,n){if(t.type===e.RESTYPE.SG)this.__port1Comp=t,this.__port2Comp=n;else{if(n.type!==e.RESTYPE.SG)return!1;this.__port1Comp=n,this.__port2Comp=t}return!0},remove:function(){var i,s;t.prototype.remove.apply(this,arguments),s=this.getOtherTarget(e.RESTYPE.SG);if(s.isRemoved())return;return s=this.getOtherTarget(e.RESTYPE.SG),s.connections("SgAsso").length===0&&(i=n.modelClassForType(e.RESTYPE.SG).getDefaultSg(),i&&new r(s,i)),null},sortedSgList:function(){var t,n,r;return t=this.getOtherTarget(e.RESTYPE.SG),n=t.connections("SgAsso"),r=_.map(n,function(t){return t.getTarget(e.RESTYPE.SG)}),r.sort(function(e,t){var n,r;if(e.isDefault())return-1;if(t.isDefault())return 1;n=e.get("name"),r=t.get("name");if(n<r)return-1;if(n===r)return 0;if(n>r)return 1})}}),r})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/editor/framework/resource/EniModel",["../ComplexResModel","Design","../connection/SgAsso","../connection/EniAttachment","constant","i18n!/nls/lang.js"],function(t,n,r,i,s,o){var u,a;return u=function(e){e||(e={}),e.ip=e.ip||"";if(e.ip.split(".").length!==4||e.ip[e.ip.length-1]===".")e.ip="";return this.hasEip=e.hasEip||!1,this.autoAssign=e.autoAssign!==void 0?e.autoAssign:!0,this.ip=e.ip||"x.x.x.x",this.eipData=e.eipData||{id:MC.guid()},this.fixedIpInApp=e.fixedIpInApp||!1,null},a=t.extend({defaults:function(){return{sourceDestCheck:!0,description:"",ips:[],assoPublicIp:!1,name:"eni"}},type:s.RESTYPE.ENI,constructor:function(e,n){return n&&n.instance&&(this.__embedInstance=n.instance),e.ips||(e.ips=[]),e.ips.length===0&&e.ips.push(new u),t.call(this,e,n)},initialize:function(e,t){var i;return t=t||{},t.createByUser&&!t.instance&&(i=n.modelClassForType(s.RESTYPE.SG).getDefaultSg(),r=n.modelClassForType("SgAsso"),new r(i,this)),t.cloneSource&&this.clone(t.cloneSource),null},clone:function(e){var t,n,r,i;this.cloneAttributes(e),i=this.get("ips");for(n=0,r=i.length;n<r;n++)t=i[n],t.ip="x.x.x.x",t.autoAssign=!0,t.eipData.id=this.design().guid();return null},groupMembers:function(){return this.__groupMembers||(this.__groupMembers=[]),this.__groupMembers},updateName:function(){var e,t,n;return t=this.__embedInstance,t?n="eni0":(e=this.connections("EniAttachment")[0],e?n="eni"+e.get("index"):n="eni"),this.set("name",n),null},isReparentable:function(e){var t;return e.type===s.RESTYPE.SUBNET?e.parent()!==this.parent().parent()&&(t=!0):t=!0,t&&this.connectionTargets("EniAttachment").length>0?o.ide.CVS_MSG_ERR_MOVE_ATTACHED_ENI:!0},isVisual:function(){return!this.__embedInstance},embedInstance:function(){return this.__embedInstance},attachedInstance:function(){var e,t;return e=this.__embedInstance,e||(t=this.connectionTargets("EniAttachment"),t.length&&(e=t[0])),e},serverGroupCount:function(){var e,t;return t=this.attachedInstance(),t&&(e=t.get("count")),e||1},maxIpCount:function(){var e,t;t=this.attachedInstance();if(t){e=t.getInstanceTypeConfig();if(e)return e.ip_per_eni}return 1},limitIpAddress:function(){var e,t;return e=this.attachedInstance(),e&&e.getInstanceTypeConfig()&&(t=this.maxIpCount(),this.get("ips").length>t&&(this.get("ips").length=t)),null},setPrimaryEip:function(e){if(!this.attachedInstance())return;return this.get("ips")[0].hasEip=e,null},hasPrimaryEip:function(){return this.get("ips")[0].hasEip},hasEip:function(){return this.get("ips").some(function(e){return e.hasEip})},subnetCidr:function(){var e;return e=this.parent()||this.__embedInstance.parent(),void 0,e.get("cidr")||"10.0.0.1"},getIpArray:function(){var e,t,r,i,o,u,a,f,l,c,h;e=this.subnetCidr(),u=this.serverGroupCount()>1,f=n.modelClassForType(s.RESTYPE.SUBNET).genCIDRPrefixSuffix(e),o=[],h=this.get("ips");for(t=l=0,c=h.length;l<c;t=++l)r=h[t],a={hasEip:r.hasEip,autoAssign:r.autoAssign,editable:!u&&!r.fixedIpInApp,prefix:f[0]},a.autoAssign||u?a.suffix=f[1]:(i=r.ip.split("."),f[1]==="x.x"?a.suffix=i[2]+"."+i[3]:a.suffix=i[3]),a.ip=a.prefix+a.suffix,o.push(a);return o},getRealIp:function(e,t){var r,i,o;return e==="x.x.x.x"?e:(t||(t=this.subnetCidr()),t?(i=n.modelClassForType(s.RESTYPE.SUBNET).genCIDRPrefixSuffix(t),r=e.split("."),i[1]==="x.x"?o=i[0]+r[2]+"."+r[3]:o=i[0]+r[3],o):e)},isValidIp:function(e){var t,r,i,o,u,f,l,c,h,p,d,v;if(e.indexOf("x")!==-1)return!0;t=this.subnetCidr(),f=n.modelClassForType(s.RESTYPE.SUBNET).isIPInSubnet(e,t);if(!f.isValid)return f.isReserved?"This IP address is in subnet’s reserved address range":"This IP address conflicts with subnet’s IP range";u=this.getRealIp(e,t),d=a.allObjects();for(l=0,h=d.length;l<h;l++){r=d[l];if(!r.attachedInstance())continue;v=r.attributes.ips;for(c=0,p=v.length;c<p;c++){i=v[c];if(i.autoAssign)continue;o=r.getRealIp(i.ip);if(o===u&&r!==this)return r===this?"This IP address conflicts with other IP":"This IP address conflicts with other network interface’s IP"}}return!0},addIp:function(e,t,n,r){var i;return i=this.get("ips"),this.maxIpCount()<=i.length?!1:(t=new u({hasEip:!1,ip:"x.x.x.x",autoAssign:!0}),i=i.slice(0),i.push(t),this.set("ips",i),!0)},setIp:function(e,t,n,r){var i;return i=this.get("ips")[e],t!==void 0&&t!==null&&(i.ip=t),n!==void 0&&n!==null&&(i.autoAssign=n),r!==void 0&&r!==null&&r!==i.hasEip&&(i.hasEip=r,e===0&&(this.__embedInstance||this).trigger("change:primaryEip")),null},removeIp:function(e){var t;t=this.get("ips");if(t.length<=1||e===0)return;return t=t.slice(0),t.splice(e,1),this.set("ips",t),null},canAddIp:function(){var e,t,n,r,i;return e=this.attachedInstance(),e?(n=this.maxIpCount(),t=this.get("ips"),t.length>=n?sprintf(o.ide.PROP_MSG_WARN_ENI_IP_EXTEND,e.get("instanceType"),n):(i=this.__embedInstance?this.__embedInstance.parent():this.parent(),r=!0,t.push({ip:"fake"}),i.getAvailableIPCountInSubnet()<=0&&(r="Ip count limit has reached in "+i.get("name")),t.length=t.length-1,r)):!1},connect:function(e){var t;if(e.type!=="EniAttachment")return;return this.limitIpAddress(),this.updateName(),t=n.modelClassForType(s.RESTYPE.SG),t.tryDrawLine(this),null},disconnect:function(e){var t,n,r,i,s;if(e.type!=="EniAttachment")return;this.attributes.name="eni",t={reason:e},s=this.connections("SgRuleLine");for(r=0,i=s.length;r<i;r++)n=s[r],n.remove(t);return null},ensureEnoughMember:function(){var e,t,n,r,i,s,o,u,a,f,l,c;n=this.attachedInstance();if(!n)return;e=n.get("count")-1,i=this.get("ips"),c=this.groupMembers();for(u=0,f=c.length;u<f;u++){o=c[u];while(o.ips.length<i.length)o.ips.push({autoAssign:!0,ip:"x.x.x.x",eipData:{id:MC.guid()}})}while(this.groupMembers().length<e){s=[];for(t=a=0,l=i.length;a<l;t=++a)r=i[t],s.push({autoAssign:!0,ip:"x.x.x.x",eipData:{id:MC.guid()}});this.groupMembers().push({id:MC.guid(),appId:"",forceAutoAssign:!0,ips:s})}return null},onParentChanged:function(){var e,t,n,r,i,s;i=this.get("ips"),s=[];for(e=n=0,r=i.length;n<r;e=++n)t=i[e],s.push(this.setIp(e,null,!0,t.hasEip));return s},generateJSON:function(e,t,n){var r,i,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;m=[{}],this.ensureEnoughMember(),a=(t.instanceName||"")+this.get("name"),p=[],e===0?d={id:this.id,appId:this.get("appId"),ips:this.get("ips"),attachmentId:this.get("attachmentId")}:d=this.groupMembers()[e-1],x=this.get("ips");for(l=E=0,S=x.length;E<S;l=++E)h=x[l],f=h.hasEip,h=d.ips[l],void 0,t.number>1?r=!0:r=h.autoAssign,h.fixedIpInApp&&(r=!1),p.push({PrivateIpAddress:this.getRealIp(h.ip),AutoAssign:r,Primary:!1}),f&&(u=h.eipData,m.push({uid:u.id||MC.guid(),type:s.RESTYPE.EIP,name:""+a+"-eip"+l,index:e,resource:{Domain:"vpc",InstanceId:"",AllocationId:u.allocationId||"",NetworkInterfaceId:this.createRef("NetworkInterfaceId",d.id),PrivateIpAddress:this.createRef("PrivateIpAddressSet."+l+".PrivateIpAddress",d.id),PublicIp:u.publicIp||""}}));return p[0].Primary=!0,y=this.__embedInstance?this.__embedInstance:this,g=_.map(y.connectionTargets("SgAsso"),function(e){return{GroupName:e.createRef("GroupName"),GroupId:e.createRef("GroupId")}}),t.instanceId?c=this.createRef("InstanceId",t.instanceId):c="",i="",this.__embedInstance?v=this.__embedInstance.parent():v=this.parent(),v.type===s.RESTYPE.SUBNET?(b=v.createRef("SubnetId"),w=v.parent().parent().createRef("VpcId"),i=v.parent()):i=v,o={index:e,uid:d.id,type:this.type,name:a,serverGroupUid:this.id,serverGroupName:this.get("name"),number:t.number||1,resource:{SourceDestCheck:this.get("sourceDestCheck"),Description:this.get("description"),NetworkInterfaceId:d.appId,AvailabilityZone:i.createRef(),VpcId:v.getVpcRef(),SubnetId:v.getSubnetRef(),AssociatePublicIpAddress:this.get("assoPublicIp"),PrivateIpAddressSet:p,GroupSet:g,Attachment:{InstanceId:c,DeviceIndex:n===void 0?"1":""+n,AttachmentId:d.attachmentId||""}}},m[0]=o,m},serialize:function(){var e,t,n,r;return r=[],this.__embedInstance||(n=this.generateLayout(),r[0]={layout:n}),this.attachedInstance()||(t=this.__embedInstance?0:1,e=this.generateJSON(0,{number:1},t),r[0]||(r[0]={}),r[0].component=e[0],e[1]&&r.push({component:e[1]})),r}},{handleTypes:[s.RESTYPE.ENI,s.RESTYPE.EIP],getAvailableIPInCIDR:function(t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;return o=t.split("/"),u=o[0],b=Number(o[1]),m=32-b,a=u.split("."),f=a.map(function(e){return MC.leftPadString(parseInt(e).toString(2),8,"0")}),c=f.join(""),l=c.slice(0,b),p=c.slice(b).replace(/1/g,"0"),h=p.replace(/0/g,"1"),v=parseInt(p,2),d=parseInt(h,2),i=[],s=0,g=function(){S=[];for(var e=v,t=d+1;v<=t?e<t:e>t;v<=t?e++:e--)S.push(e);return S}.apply(this),y=g.length,$.each(g,function(t,o){var u,a,f,c,h;f=l+MC.leftPadString(o.toString(2),m,"0"),u=!0;if(t===0||t===1||t===2||t===3)u=!1;return t===y-1&&(u=!1),a=_.map([0,8,16,24],function(e){var t;return t=parseInt(f.slice(e,e+8),2),t}),h=a.join("."),e.call(n,h)>=0&&(u=!1),c={ip:h,available:u},i.push(c),u&&s++,s>r?!1:null}),void 0,i},getAvailableIPCountInCIDR:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;return n=e.split("/"),r=n[0],p=Number(n[1]),h=32-p,i=r.split("."),s=i.map(function(e){return MC.leftPadString(parseInt(e).toString(2),8,"0")}),u=s.join(""),o=u.slice(0,p),f=u.slice(p).replace(/1/g,"0"),a=f.replace(/0/g,"1"),c=parseInt(f,2),l=parseInt(a,2),t=l-c+1-5,t<0&&(t=0),t},createServerGroupMember:function(e){var t,r,i,s,o,a,f;t=e.resource.Attachment||{},s={id:e.uid,appId:e.resource.NetworkInterfaceId,attachmentId:t.AttachmentId||"",ips:[]},f=e.resource.PrivateIpAddressSet||[];for(o=0,a=f.length;o<a;o++)r=f[o],i=new u({autoAssign:r.AutoAssign,ip:r.PrivateIpAddress,fixedIpInApp:n.instance().modeIsApp()||n.instance().modeIsAppView()}),r.EipResource&&(i.eipData={id:r.EipResource.uid,allocationId:r.EipResource.resource.AllocationId,publicIp:r.EipResource.resource.PublicIp}),s.ips.push(i);return s},deserialize:function(e,t,o){var f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;if(e.type===s.RESTYPE.EIP)return;if(e.serverGroupUid&&e.serverGroupUid!==e.uid){w=o(e.serverGroupUid).groupMembers();for(x=0,C=w.length;x<C;x++){b=w[x];if(b&&b.id===e.uid){void 0;return}}w[e.index-1]=this.createServerGroupMember(e);return}f=e.resource.Attachment,h=f&&(f.DeviceIndex==="0"||f.DeviceIndex===0),m=f&&f.InstanceId?o(MC.extractID(f.InstanceId)):null,l={id:e.uid,appId:e.resource.NetworkInterfaceId,description:e.resource.Description,sourceDestCheck:e.resource.SourceDestCheck,assoPublicIp:e.resource.AssociatePublicIpAddress,attachmentId:f?f.AttachmentId:"",ips:[],x:h?0:t.coordinate[0],y:h?0:t.coordinate[1]},A=e.resource.PrivateIpAddressSet||[];for(T=0,k=A.length;T<k;T++)g=A[T],c=n.instance().modeIsStack()?g.AutoAssign:!1,y=new u({autoAssign:c,ip:g.PrivateIpAddress,fixedIpInApp:n.instance().modeIsApp()||n.instance().modeIsAppView()}),g.EipResource&&(y.hasEip=!0,y.eipData={id:g.EipResource.uid,allocationId:g.EipResource.resource.AllocationId,publicIp:g.EipResource.resource.PublicIp}),l.ips.push(y);h?(l.name="eni0",E={instance:m}):l.parent=o(t.groupUId),p=new a(l,E),S=p.embedInstance()||p,O=e.resource.GroupSet||[];for(N=0,L=O.length;N<L;N++)v=O[N],new r(S,o(MC.extractID(v.GroupId)));return m&&(h?m.setEmbedEni(p):(d=f&&f.DeviceIndex?f.DeviceIndex:1,new i(p,m,{index:d*1}))),null},postDeserialize:function(e,t){var r,i,o,u,a,f,l,c,h,p,d,v,m,g,y,b;r=e.resource.Attachment;if(!r)return;o=r.DeviceIndex==="0";if(!o)return;i=n.instance(),h=MC.extractID(r.InstanceId),c=i.component(h);if(c)return;u=i.component(e.uid);if(!u)return;void 0,u.remove(),a=this.createServerGroupMember(e),y=n.modelClassForType(s.RESTYPE.INSTANCE).allObjects();for(d=0,m=y.length;d<m;d++){c=y[d],b=c.groupMembers();for(l=v=0,g=b.length;v<g;l=++v){p=b[l];if(p.id===h){f=!0;break}}}if(!f){void 0;return}return c.getEmbedEni().groupMembers()[l]=a,null}}),a})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/editor/framework/resource/VolumeModel",["i18n!/nls/lang.js","../ComplexResModel","constant"],function(t,n,r){var i;return i=n.extend({defaults:{name:"",owner:null,volumeSize:1,snapshotId:"",appId:"",volumeType:"gp2",iops:"",encrypted:!1},type:r.RESTYPE.VOL,constructor:function(e,t){var r;return r=e.owner,delete e.owner,e.name||(e.name=this.getDeviceName(r)),e.name&&(n.call(this,e),this.attachTo(r,t)),t&&t.cloneSource&&this.clone(t.cloneSource),e.iops&&(e.volumeType="io1"),null},clone:function(e){return this.cloneAttributes(e,{reserve:"owner"}),null},isVisual:function(){return!1},isNameAvailable:function(){return!0},isReparentable:function(e){var n;if(this.design().modeIsAppEdit()){n=this.get("owner");if(n.type!==e.type)return!1;if(!this.get("appId"))return!0;if(n.get("count")>1)return t.ide.CVS_MSG_ERR_SERVERGROUP_VOLUME;if(e.get("count")>1)return t.ide.CVS_MSG_ERR_SERVERGROUP_VOLUME2;while(n&&n.type!==r.RESTYPE.AZ)n=n.parent(),e=e.parent();if(n&&e&&n!==e)return"Cannot move volume across availability zone."}return!0},groupMembers:function(){return this.__groupMembers||(this.__groupMembers=[]),this.__groupMembers},isRemovable:function(){return this.design().modeIsAppEdit()&&(this.get("owner")||{}).type===r.RESTYPE.LC?t.ide.NOTIFY_MSG_WARN_OPERATE_NOT_SUPPORT_YET:!0},remove:function(){var e;return e=this.attributes.owner.get("volumeList"),e.splice(e.indexOf(this),1),this.attributes.owner.trigger("change:volumeList"),n.prototype.remove.call(this),null},genFullName:function(e){return this.get("name")[0]!=="/"?"xvd"+e:"/dev/"+e},getCost:function(e,t,n){var i,s,o,u,a,f,l,c,h,p,d,v,m;if(!e.ebs)return;u=this.get("owner");if(!u){void 0;return}if(!n&&this.get("owner").type!==r.RESTYPE.INSTANCE)return;f=this.get("volumeType")==="standard",m=e.ebs.types;for(h=0,d=m.length;h<d;h++)l=m[h],f?l.ebsVols&&(c=l.ebsVols):l.ebsPIOPSVols&&(c=l.ebsPIOPSVols);if(!c)return;i=this.get("owner").get("count")||1,o=u.get("name")+" - "+this.get("name"),i>1&&(o+=" (x"+i+")");for(p=0,v=c.length;p<v;p++){a=c[p];if(a.unit==="perGBmoProvStorage")return s=a[t],{resource:o,type:this.get("volumeSize")+"G",fee:s*this.get("volumeSize")*i,formatedFee:s+"/GB/mo"}}return null},attachTo:function(e,t){var n,r,i;if(!e)return!1;if(e===this.attributes.owner)return!1;n=this.attributes.owner,n&&(r=n.get("volumeList"),r.splice(r.indexOf(this),1),n.trigger("change:volumeList")),this.attributes.owner=e;if(!t||!t.noNeedGenName){this.attributes.name=this.getDeviceName(e);if(!this.attributes.name)return!1}return this.isSupportEncrypted()||(this.attributes.encrypted=!1),i=e.get("volumeList"),i?i.push(this):e.set("volumeList",[this]),e.trigger("change:volumeList"),!0},isSupportEncrypted:function(){var t,n,r,i;return i=["m3.medium","m3.large","m3.xlarge","m3.2xlarge","c3.large","c3.xlarge","c3.2xlarge","c3.4xlarge","c3.8xlarge","cr1.8xlarge","r3.large","r3.xlarge","r3.2xlarge","r3.4xlarge","r3.8xlarge","i2.xlarge","i2.2xlarge","i2.4xlarge","i2.8xlarge","g2.2xlarge"],n=this.attributes.owner,t=n.get("instanceType"),r=!1,e.call(i,t)>=0&&(r=!0),r},getDeviceName:function(e){var n,r,i,s;return i=e.get("imageId"),n=e.getAmi(),n?(r=null,n.osType!=="windows"?r=["f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]:r=["f","g","h","i","j","k","l","m","n","o","p"],$.each(n.blockDeviceMapping||[],function(e,t){var n,i;if(e.slice(0,4)==="/dev/"){i=e.slice(-1),n=r.indexOf(i);if(n>=0)return r.splice(n,1)}}),s=e.get("volumeList"),s&&s.length>0&&$.each(s,function(e,t){var n,i;i=t.get("name").slice(-1),n=r.indexOf(i);if(n>=0)return r.splice(n,1)}),r.length===0?(notification("warning",t.ide.NOTIFY_MSG_WARN_ATTACH_VOLUME_REACH_INSTANCE_LIMIT,!1),null):(n.osType!=="windows"?r="/dev/sd"+r[0]:r="xvd"+r[0],r)):(n||notification("warning",sprintf(t.ide.NOTIFY_MSG_WARN_AMI_NOT_EXIST_TRY_USE_OTHER,i),!1),null)},ensureEnoughMember:function(){var e;if(!this.get("owner"))return;e=this.get("owner").get("count");if(!e)return;e-=1;while(this.groupMembers().length<e)this.groupMembers().push({id:MC.guid(),appId:""});return null},generateJSON:function(e,t){var n,r,i,s,o;return void 0,this.ensureEnoughMember(),n="",e>0?(i=this.groupMembers()[e-1],o=i.id,n=i.appId):(o=this.id,n=this.get("appId")),r=this.createRef("InstanceId",t.instanceId),s=this.get("owner"),{uid:o,type:this.type,name:this.get("name"),serverGroupUid:this.id,serverGroupName:this.get("name"),index:e,number:t.number||1,resource:{VolumeId:n,Size:this.get("volumeSize"),SnapshotId:this.get("snapshotId"),Iops:this.get("iops"),VolumeType:this.get("volumeType"),AvailabilityZone:s?s.getAvailabilityZone().createRef():"",AttachmentSet:{InstanceId:r,Device:this.get("name")},Encrypted:this.get("encrypted")}}},serialize:function(){if(this.get("owner"))return;return{component:this.generateJSON(0,{number:1})}}},{handleTypes:r.RESTYPE.VOL,deserialize:function(e,t,n){var r,s,o,u,a,f,l,c;if(e.serverGroupUid&&e.serverGroupUid!==e.uid){a=n(e.serverGroupUid).groupMembers();for(l=0,c=a.length;l<c;l++){u=a[l];if(u&&u.id===e.uid){void 0;return}}a[e.index-1]={id:e.uid,appId:e.resource.VolumeId};return}return e.resource.AttachmentSet?(r=e.resource.AttachmentSet,o=r&&r.InstanceId?n(MC.extractID(r.InstanceId)):null,s={id:e.uid,name:e.serverGroupName||e.name,owner:o,volumeSize:e.resource.Size,snapshotId:e.resource.SnapshotId,volumeType:e.resource.VolumeType,iops:e.resource.Iops,appId:e.resource.VolumeId,encrypted:e.resource.Encrypted},f=new i(s,{noNeedGenName:!0}),null):(void 0,null)}}),i})}.call(this),function(){define("workspaces/editor/framework/resource/AclModel",["../ComplexResModel","../ConnectionModel","constant"],function(e,t,n){var r,i,s,o,u;return o={Code:"",Type:""},u={From:"",To:""},r=t.extend({type:"AclAsso",oneToMany:n.RESTYPE.ACL,defaults:{associationId:""},serialize:function(e){var t,r;return r=this.getTarget(n.RESTYPE.SUBNET),t=this.getTarget(n.RESTYPE.ACL),e[t.id].resource.AssociationSet.push({NetworkAclAssociationId:this.get("associationId"),SubnetId:r.createRef("SubnetId")}),null}}),s=function(e){return!e||!e.length?[]:_.map(e,function(e){var t;return t={id:_.uniqueId("aclrule_"),cidr:e.CidrBlock,egress:e.Egress,protocol:parseInt(e.Protocol,10),number:parseInt(e.RuleNumber,10),action:e.RuleAction,port:""},t.protocol===1&&e.IcmpTypeCode&&e.IcmpTypeCode.Code&&e.IcmpTypeCode.Type?t.port=e.IcmpTypeCode.Type+"/"+e.IcmpTypeCode.Code:e.PortRange.From&&e.PortRange.To&&(e.PortRange.From===e.PortRange.To?t.port=e.PortRange.From+"":t.port=e.PortRange.From+"-"+e.PortRange.To),t})},i=e.extend({type:n.RESTYPE.ACL,newNameTmpl:"CustomACL-",defaults:function(){return{rules:[{action:"deny",cidr:"0.0.0.0/0",egress:!0,id:_.uniqueId("aclrule_"),number:32767,port:"",protocol:-1},{action:"deny",cidr:"0.0.0.0/0",egress:!1,id:_.uniqueId("aclrule_"),number:32767,port:"",protocol:-1}]}},isVisual:function(){return!1},isDefault:function(){return this.attributes.name==="DefaultACL"},remove:function(){var t,n,s,o,u;void 0,t=i.getDefaultAcl(),u=this.connectionTargets();for(s=0,o=u.length;s<o;s++)n=u[s],new r(t,n);return e.prototype.remove.call(this),null},addRule:function(e){var t,n,r,i;void 0,e.protocol=parseInt(e.protocol,10),e.number=parseInt(e.number,10),e.cidr=MC.getValidCIDR(e.cidr),t=this.get("rules");for(r=0,i=t.length;r<i;r++){n=t[r];if(n.number===e.number)return!1}return e.id=_.uniqueId("aclrule_"),t=t.slice(0),t.push(e),this.set("rules",t),!0},removeRule:function(e){var t,n,r,i,s,o;r=this.get("rules");for(t=s=0,o=r.length;s<o;t=++s){n=r[t];if(n.id===e){i=n;break}}return i.number===32767?!1:this.isDefault()&&i.number===100?!1:(r=r.slice(0),r.splice(t,1),this.set("rules",r),!0)},getRuleCount:function(){return this.get("rules").length},getAssoCount:function(){return this.connections().length},serialize:function(){var e,t,r,i,s,a,f,l,c;a=Design.modelClassForType(n.RESTYPE.VPC).theVPC(),s=[],e={name:this.get("name"),type:this.type,uid:this.id,resource:{AssociationSet:[],Default:this.isDefault(),EntrySet:s,NetworkAclId:this.get("appId"),VpcId:a.createRef("VpcId")}},c=this.get("rules");for(f=0,l=c.length;f<l;f++)i=c[f],r={Egress:i.egress,Protocol:i.protocol,RuleAction:i.action,RuleNumber:i.number,CidrBlock:i.cidr,IcmpTypeCode:o,PortRange:u},i.protocol===1?(t=i.port.split("/"),r.IcmpTypeCode={Code:t[1],Type:t[0]}):i.port&&(t=(i.port+"-"+i.port).split("-"),r.PortRange={From:t[0],To:t[1]}),s.push(r);return{component:e}}},{handleTypes:n.RESTYPE.ACL,resolveFirst:!0,getDefaultAcl:function(){return _.find(i.allObjects(),function(e){return e.isDefault()})},preDeserialize:function(e,t){return new i({id:e.uid,name:e.resource.Default?"DefaultACL":e.name,appId:e.resource.NetworkAclId,rules:s(e.resource.EntrySet)}),null},deserialize:function(e,t,n){var i,s,o,u,a,f;i=n(e.uid),f=e.resource.AssociationSet||[];for(u=0,a=f.length;u<a;u++)s=f[u],o=new r(i,n(MC.extractID(s.SubnetId))),o.set("associationId",s.NetworkAclAssociationId);return null}}),i})}.call(this),function(){define("workspaces/editor/framework/connection/LcUsage",["../ConnectionModel","constant"],function(e,t){return e.extend({type:"LcUsage",remove:function(){var n;n=this.getTarget(t.RESTYPE.LC),e.prototype.remove.apply(this,arguments),n.connections("LcUsage").length===0&&n.remove()}})})}.call(this),function(){define("workspaces/editor/framework/resource/AsgModel",["../ResourceModel","../ComplexResModel","Design","constant","i18n!/nls/lang.js","../connection/LcUsage"],function(e,t,n,r,i,s){var o,u,a;return a=t.extend({type:r.RESTYPE.NC,isUsed:function(){return this.get("instanceLaunch")||this.get("instanceLaunchError")||this.get("instanceTerminate")||this.get("instanceTerminateError")||this.get("test")},initialize:function(){return n.modelClassForType(r.RESTYPE.TOPIC).ensureExistence(),null},isVisual:function(){return!1},getTopic:function(){return this.connectionTargets("TopicUsage")[0]},removeTopic:function(){var e;return(e=this.connections("TopicUsage")[0])!=null?e.remove():void 0},isEffective:function(){var e;return e=this.toJSON(),e.instanceLaunch||e.instanceLaunchError||e.instanceTerminate||e.instanceTerminateError||e.test},getTopicName:function(){var e;return(e=this.getTopic())!=null?e.get("name"):void 0},setTopic:function(e,t){var i;return i=n.modelClassForType(r.RESTYPE.TOPIC),i.get(e,t).assignTo(this)},serialize:function(){var e,t,n,r,i;if(!this.isUsed()||!this.get("asg"))return;r=this.getTopic(),n=[],i=a.typeMap;for(e in i)t=i[e],this.get(t)&&n.push(e);return{component:{name:"SnsNotification",type:this.type,uid:this.id,resource:{AutoScalingGroupName:this.get("asg").createRef("AutoScalingGroupName"),TopicARN:r&&r.createRef("TopicArn")||"",NotificationType:n}}}}},{handleTypes:r.RESTYPE.NC,typeMap:{"autoscaling:EC2_INSTANCE_LAUNCH":"instanceLaunch","autoscaling:EC2_INSTANCE_LAUNCH_ERROR":"instanceLaunchError","autoscaling:EC2_INSTANCE_TERMINATE":"instanceTerminate","autoscaling:EC2_INSTANCE_TERMINATE_ERROR":"instanceTerminateError","autoscaling:TEST_NOTIFICATION":"test"},deserialize:function(e,t,n){var r,i,s,o,u,f,l,c;i={id:e.uid},l=e.resource.NotificationType;for(u=0,f=l.length;u<f;u++)o=l[u],i[a.typeMap[o]]=!0;return s=new a(i),r=n(MC.extractID(e.resource.AutoScalingGroupName)),r&&(r.set("notification",s),s.set("asg",r)),(c=n(MC.extractID(e.resource.TopicARN)))!=null&&c.assignTo(s),null}}),o=t.extend({type:"ExpandedAsg",defaults:{originalAsg:null},constructor:function(e,n){var r,i,s,o,u;void 0,r=e.originalAsg,u=[r].concat(r.get("expandedList"));for(s=0,o=u.length;s<o;s++){i=u[s];if(e.parent.parent()===i.parent().parent())return}return t.call(this,e,n),null},isReparentable:function(e){var t,n,r,i,s;t=this.attributes.originalAsg,s=[t].concat(t.get("expandedList"));for(r=0,i=s.length;r<i;r++){n=s[r];if(n!==this&&e.parent()===n.parent().parent())return!1}return!0},initialize:function(){var e;return void 0,this.get("originalAsg").get("expandedList").push(this),(e=this.getLc())!=null&&e.trigger("change:expandedList",this),null},remove:function(){var e,n;return e=this.get("originalAsg").get("expandedList"),e.splice(e.indexOf(this),1),(n=this.getLc())!=null&&n.trigger("change:expandedList",this),t.prototype.remove.call(this)},getLc:function(){return this.attributes.originalAsg.getLc()},serialize:function(){var e;return e=this.generateLayout(),e.type="ExpandedAsg",e.originalId=this.get("originalAsg").id,{layout:e}}},{handleTypes:"ExpandedAsg",deserialize:function(e,t,n){var r;r=n(t.originalId);if(!r){void 0;return}return new o({id:e.uid,originalAsg:r,parent:n(t.groupUId),x:t.coordinate[0],y:t.coordinate[1]}),null}}),u=t.extend({defaults:function(){return{cooldown:"300",capacity:"1",minSize:"1",maxSize:"2",healthCheckGracePeriod:"300",healthCheckType:"EC2",terminationPolicies:["Default"],expandedList:[],policies:[]}},type:r.RESTYPE.ASG,newNameTmpl:"asg",isReparentable:function(e){var t,n,r,s;s=this.get("expandedList");for(n=0,r=s.length;n<r;n++){t=s[n];if(e.parent()===t.parent().parent())return sprintf(i.ide.CVS_MSG_ERR_DROP_ASG,this.get("name"),e.parent().get("name"))}return!0},setLc:function(e){if(this.getLc()||!e)return;return _.isString(e)&&(e=this.design().component(e)),new s(this,e)},getLc:function(){return this.connectionTargets("LcUsage")[0]},getCost:function(e,t){var i,s,o,u,a,f,l,c,h;s=this.getLc();if(!s)return null;i=n.modelClassForType(r.RESTYPE.INSTANCE),u=i.prototype.getCost.call(s,e,t);if(!u)return null;u.length&&(u=u[0]),u.resource=this.get("name"),o=u.fee,f=s.get("volumeList");if(f&&f.length)for(c=0,h=f.length;c<h;c++)a=f[c],l=a.getCost(e,t,!0),l&&(o+=l.fee);return u.fee!==o&&(u.resource+=" (& volumes)",u.fee=o),u.type=parseInt(this.get("capacity")||this.get("minSize"),10),u.fee*=u.type,u.fee=Math.round(u.fee*100)/100,u.formatedFee=u.fee+"/mo",u},getNotification:function(){var e;return((e=this.get("notification"))!=null?e.toJSON():void 0)||{}},getNotiObject:function(){return this.get("notification")},setNotification:function(e){var t;return t=this.get("notification"),t?t.set(e):(e.asg=this,t=new a(e),this.set("notification",t)),t},setNotificationTopic:function(e,t){var n;return(n=this.get("notification"))!=null?n.setTopic(e,t):void 0},getNotificationTopicName:function(){var e;return(e=this.get("notification"))!=null?e.getTopicName():void 0},addScalingPolicy:function(e){return e.__asg=this,this.get("policies").push(e),this.listenTo(e,"destroy",this.__removeScalingPolicy),null},__removeScalingPolicy:function(e){return this.stopListening(e),this.get("policies").splice(this.get("policies").indexOf(e),1),null},isEC2HealthCheckType:function(){var e;return e=this.getLc(),e&&e.connections("ElbAmiAsso").length&&this.get("healthCheckType")==="ELB"?!1:!0},remove:function(){var e,n,r,i,s,o,u,a,f;u=this.get("expandedList");for(r=0,s=u.length;r<s;r++)e=u[r],e.remove();a=this.get("policies");for(i=0,o=a.length;i<o;i++)n=a[i],n.off(),n.remove();return(f=this.get("notification"))!=null&&f.remove(),t.prototype.remove.call(this),null},getExpandSubnets:function(){var e,t,n,r,i;t=[this.parent()],i=this.get("expandedList");for(n=0,r=i.length;n<r;n++)e=i[n],t.push(e.parent());return t},getExpandAzs:function(){var e,t,n,r,i;e=[],i=this.getExpandSubnets();for(n=0,r=i.length;n<r;n++)t=i[n],e.push(t.parent());return _.uniq(e)},serialize:function(){var e,t,n,r,i,s,o;return o=this.getExpandSubnets(),e=_.uniq(_.map(o,function(e){return e.parent().createRef()})),o=_.map(o,function(e){return e.createRef("SubnetId")}),s=this.getLc(),s&&(r=s.connectionTargets("ElbAmiAsso"),r.length&&(i=this.get("healthCheckType"),n=_.map(r,function(e){return e.createRef("LoadBalancerName")}))),t={uid:this.id,name:this.get("name"),type:this.type,resource:{AvailabilityZones:e,VPCZoneIdentifier:o.join(" , "),LoadBalancerNames:n||[],AutoScalingGroupARN:this.get("appId"),DefaultCooldown:this.get("cooldown"),MinSize:this.get("minSize"),MaxSize:this.get("maxSize"),HealthCheckType:i||"EC2",HealthCheckGracePeriod:this.get("healthCheckGracePeriod"),TerminationPolicies:this.get("terminationPolicies"),AutoScalingGroupName:this.get("groupName")||this.get("name"),DesiredCapacity:this.get("capacity"),LaunchConfigurationName:(s!=null?s.createRef("LaunchConfigurationName"):void 0)||""}},{component:t,layout:this.generateLayout()}}},{handleTypes:r.RESTYPE.ASG,deserialize:function(e,t,r){var i,o,a,f,l,c,h,p;o=new u({id:e.uid,name:e.name,appId:e.resource.AutoScalingGroupARN,parent:r(MC.extractID(t.groupUId)),cooldown:String(e.resource.DefaultCooldown),capacity:String(e.resource.DesiredCapacity),minSize:String(e.resource.MinSize),maxSize:String(e.resource.MaxSize),healthCheckType:e.resource.HealthCheckType,healthCheckGracePeriod:String(e.resource.HealthCheckGracePeriod),terminationPolicies:e.resource.TerminationPolicies,groupName:e.resource.AutoScalingGroupName,x:t.coordinate[0],y:t.coordinate[1]});if(e.resource.LaunchConfigurationName){l=r(MC.extractID(e.resource.LaunchConfigurationName)),new s(o,l),i=n.modelClassForType("ElbAmiAsso"),p=e.resource.LoadBalancerNames||[];for(c=0,h=p.length;c<h;c++)f=p[c],a=r(MC.extractID(f)),new i(l,a)}return null}}),u})}.call(this),function(){define("workspaces/editor/framework/GroupModel",["Design","./ComplexResModel"],function(e,t){var n;return n=t.extend({node_group:!0,type:"Framework_G",remove:function(){var e,n,r,i;if(this.attributes.__children){i=this.attributes.__children.splice(0);for(n=0,r=i.length;n<r;n++)e=i[n],e.off("destroy",this.removeChild,this),e.remove()}return t.prototype.remove.call(this),null},addChild:function(e){var t,n;void 0,n=e.parent();if(n===this)return;n&&n.removeChild(e),t=this.attributes.__children;if(!t)t=[];else if(t.indexOf(e)!==-1)return;return t.push(e),this.set("__children",t),e.set("__parent",this),e.once("destroy",this.removeChild,this),e.onParentChanged&&e.onParentChanged(),null},removeChild:function(e){var t,n;t=this.get("__children");if(!t||t.length===0){void 0;return}n=t.indexOf(e);if(n===-1){void 0;return}return t.splice(n,1),this.set("__children",t),e.off("destroy",this.removeChild,this),null},children:function(){return this.get("__children")||[]},generateLayout:function(){var e;return e=t.prototype.generateLayout.call(this),e.size=[this.width(),this.height()],e}}),n})}.call(this),function(){define("workspaces/editor/framework/resource/DhcpModel",["constant","../ResourceModel","Design"],function(e,t,n){var r;return r=t.extend({type:e.RESTYPE.DHCP,defaults:function(){return{appId:""}},isAuto:function(){return this.attributes.appId===""},isDefault:function(){return this.attributes.appId==="default"},isCustom:function(){return this.attributes.appId!==""&&this.attributes.appId!=="default"},getDhcp:function(){return this.get("appId")},setAuto:function(){return this.set("appId","")},setDefault:function(){return this.set("appId","default")},setDhcp:function(e){if(this.get("appId")!==e)return this.set("appId",e)},serialize:function(){}},{handleTypes:e.RESTYPE.DHCP,deserialize:function(e){var t;return t={},t.id=e.uid,t.appId=e.resource.DhcpOptionsId,new r(t),null}}),r})}.call(this),function(){define("workspaces/editor/framework/resource/VpcModel",["constant","../GroupModel","./DhcpModel"],function(e,t,n){var r;return r=t.extend({type:e.RESTYPE.VPC,defaults:{dnsSupport:!0,dnsHostnames:!1,tenancy:"default",cidr:"10.0.0.0/16"},initialize:function(){return this.attributes.dhcp||(this.attributes.dhcp=new n),null},isRemovable:function(){return!1},isDefaultTenancy:function(){return this.get("tenancy")!=="dedicated"},setTenancy:function(t){var n,r,i,s;this.set("tenancy",t);if(t==="dedicated"){s=Design.modelClassForType(e.RESTYPE.INSTANCE).allObjects();for(r=0,i=s.length;r<i;r++)n=s[r],n.setTenancy(t)}return null},setCidr:function(t){var n,r,i,s,o,u,a,f,l;n=Design.modelClassForType(e.RESTYPE.SUBNET),u=n.allObjects(),s=!1,o=_.map(u,function(e){var r;return r=e.get("cidr"),n.isInVPCCIDR(t,r)||(s=!0),r});if(s){o=this.generateSubnetCidr(t,o);if(!o)return!1;for(r=f=0,l=u.length;f<l;r=++f)i=u[r],i.setCidr(o[r])}return a=MC.getValidCIDR(t),this.set("cidr",a),!0},generateSubnetCidr:function(t,n){var r,i;return r=Design.modelClassForType(e.RESTYPE.SUBNET),i=r.allObjects(),n=r.autoAssignSimpleCIDR(t,n,this.get("cidr")),n.length||(n=r.autoAssignAllCIDR(t,i.length)),n.length!==i.length?null:n},serialize:function(){var e,t,n;return void 0,n=this.get("dhcp"),n.isAuto()?t="":n.isDefault()?t="default":t=n.getDhcp(),e={name:this.get("name"),type:this.type,uid:this.id,resource:{EnableDnsSupport:this.get("dnsSupport"),InstanceTenancy:this.get("tenancy"),EnableDnsHostnames:this.get("dnsHostnames"),DhcpOptionsId:t,VpcId:this.get("appId"),CidrBlock:this.get("cidr")}},{component:e,layout:this.generateLayout()}}},{handleTypes:e.RESTYPE.VPC,resolveFirst:!0,theVPC:function(){return Design.instance().classCacheForCid(this.prototype.classId)[0]},preDeserialize:function(e,t){return new r({id:e.uid,name:e.name,appId:e.resource.VpcId,cidr:e.resource.CidrBlock,dnsHostnames:e.resource.EnableDnsHostnames,dnsSupport:e.resource.EnableDnsSupport,tenancy:e.resource.InstanceTenancy,x:t.coordinate[0],y:t.coordinate[1],width:t.size[0],height:t.size[1]}),null},deserialize:function(e,t,n){var r,i,s;return s=n(e.uid),r=e.resource.DhcpOptionsId,r===void 0?s.get("dhcp").setAuto():r?r==="default"?s.get("dhcp").setDefault():r[0]==="@"?(i=s.get("dhcp"),i&&i.remove(),s.set("dhcp",n(MC.extractID(r)))):s.get("dhcp").setDhcp(r):s.get("dhcp").setAuto(),null}}),r})}.call(this),function(){define("workspaces/editor/framework/resource/AzModel",["../GroupModel","./VpcModel","constant","i18n!/nls/lang.js","Design","CloudResources"],function(e,t,n,r,i,s){var o;return o=e.extend({type:n.RESTYPE.AZ,isRemovable:function(){return _.some(this.children(),function(e){return e.connections("SubnetgAsso").length>0})?{error:r.ide.RDS_MSG_ERR_REMOVE_AZ_FAILED_CAUSEDBY_CHILD_USEDBY_SBG}:this.children().length>0?sprintf(r.ide.CVS_CFM_DEL_GROUP,this.get("name")):!0},createRef:function(){return o.__super__.createRef("ZoneName",!0,this.id)},getAvailableIPCountInSubnet:function(e){var t,r,s,o,u,a,f;if(!e)return!0;s=0,f=this.children();for(u=0,a=f.length;u<a;u++){t=f[u];if(t.type===n.RESTYPE.INSTANCE)r=t.getEmbedEni();else{if(t.type!==n.RESTYPE.ENI)continue;r=t}s+=r.get("ips").length*r.serverGroupCount()}return o=i.modelClassForType(n.RESTYPE.ENI).getAvailableIPCountInCIDR(e),o-s},serialize:function(){var e,t;return t=this.get("name"),e={uid:this.id,name:t,type:this.type,resource:{ZoneName:t,RegionName:t.substring(0,t.length-1)}},{layout:this.generateLayout(),component:e}}},{handleTypes:n.RESTYPE.AZ,deserialize:function(e,t,n){var r;return i.instance().modeIsStack()||(r=e.name),new o({id:e.uid,name:e.name,appId:r,parent:n(t.groupUId),x:t.coordinate[0],y:t.coordinate[1],width:t.size[0],height:t.size[1]}),null},allPossibleAZ:function(){var e,t,r,i,u;t={},u=o.allObjects();for(r=0,i=u.length;r<i;r++)e=u[r],t[e.get("name")]=e.id;return s(n.RESTYPE.AZ,region).where({category:region}).map(function(e){return{name:e.attributes.id,id:t[e.attributes.id]||""}})},getAzByName:function(e){var t,n,r,i;i=o.allObjects();for(n=0,r=i.length;n<r;n++){t=i[n];if(t.get("name")===e)return t}return null}}),o})}.call(this),function(){define("workspaces/editor/framework/resource/CgwModel",["../ComplexResModel","Design","constant"],function(e,t,n){var r;return r=e.extend({defaults:{bgpAsn:""},newNameTmpl:"customer-gateway-",type:n.RESTYPE.CGW,isDynamic:function(){return!!this.get("bgpAsn")},serialize:function(){var e;return e={name:this.get("name"),type:this.type,uid:this.id,resource:{CustomerGatewayId:this.get("appId"),BgpAsn:this.get("bgpAsn"),Type:"ipsec.1",IpAddress:this.get("ip")}},{component:e,layout:this.generateLayout()}}},{handleTypes:n.RESTYPE.CGW,deserialize:function(e,t,n){return new r({id:e.uid,name:e.name,appId:e.resource.CustomerGatewayId,bgpAsn:e.resource.BgpAsn,ip:e.resource.IpAddress,x:t.coordinate[0],y:t.coordinate[1]})}}),r})}.call(this),function(){define("workspaces/editor/framework/connection/SgRuleSet",["constant","../ConnectionModel","Design"],function(e,t,n){var r;return r=t.extend({type:"SgRuleSet","default":{in1:null,out1:null,in2:null,out2:null},initialize:function(){var e;return this.port1Comp().type==="SgIpTarget"&&(e=this.port2Comp(),this.__port2Comp=this.__port1Comp,this.__port1Comp=e),this.attributes.in1=[],this.attributes.out1=[],this.port1Comp()===this.port2Comp()?(this.attributes.in2=this.attributes.in1,this.attributes.out2=this.attributes.out1):(this.attributes.in2=[],this.attributes.out2=[]),null},ruleCount:function(e){return e===this.port1Comp().id||e===this.port1Comp().get("name")?this.attributes.in1.length+this.attributes.out1.length:this.attributes.in2.length+this.attributes.out2.length},toPlainObjects:function(e,t){var n,i,s,o,u,a,f,l,c,h,p;o=[{ary:this.attributes.in1,direction:r.DIRECTION.IN,relation:this.port2Comp(),owner:this.port1Comp()},{ary:this.attributes.out1,direction:r.DIRECTION.OUT,relation:this.port2Comp(),owner:this.port1Comp()}],this.port1Comp()!==this.port2Comp()&&!this.getTarget("SgIpTarget")&&(o.push({ary:this.attributes.in2,direction:r.DIRECTION.IN,relation:this.port1Comp(),owner:this.port2Comp()}),o.push({ary:this.attributes.out2,direction:r.DIRECTION.OUT,relation:this.port1Comp(),owner:this.port2Comp()})),a=[];for(f=0,c=o.length;f<c;f++){s=o[f];if(e)if(_.isString(e)){if(s.owner.id!==e&&s.owner.get("name")!==e)continue}else if(!e(s.owner))continue;p=s.ary;for(l=0,h=p.length;l<h;l++)u=p[l],u.protocol==="icmp"?i=u.fromPort+"/"+u.toPort:u.fromPort===u.toPort||!u.toPort?i=u.fromPort:i=u.fromPort+"-"+u.toPort,n={ruleSetId:this.id,port:i,protocol:u.protocol,direction:s.direction,relation:s.relation.get("name"),color:s.relation.color},t&&(n.relationId=s.relation.id,n.ownerId=s.owner.id),a.push(n)}return a},hasRawRuleTo:function(e){return void 0,e===this.port1Comp()?this.attributes.in1.length>0||this.attributes.out2.length>0:this.attributes.in2.length>0||this.attributes.out1.length>0},addRawRule:function(t,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M;void 0,void 0,void 0,E=this.get("in1").length+this.get("in2").length+this.get("out1").length+this.get("out2").length===0,l=this.get("in1").length,h=this.get("in2").length,c=this.get("out1").length,p=this.get("out2").length,w={protocol:s.protocol,fromPort:""+s.fromPort,toPort:""+s.toPort},""+w.protocol=="-1"||w.protocol==="all"?(w.protocol="all",w.fromPort="0",w.toPort="65535"):parseInt(s.protocol,10)+""===s.protocol&&(w.fromPort="",w.toPort=""),w.fromPort===w.toPort&&w.protocol!=="icmp"&&(w.toPort=""),m=t===this.port1Comp().id||t===this.port1Comp().get("name");if(!m&&this.getTarget("SgIpTarget")){void 0;return}switch(i){case r.DIRECTION.IN:b=[m?"in1":"in2"];break;case r.DIRECTION.OUT:b=[m?"out1":"out2"];break;case r.DIRECTION.BIWAY:b=[m?"in1":"in2",m?"out1":"out2"]}for(S=0,C=b.length;S<C;S++){y=b[S],a=!1,g=this.get(y);for(x=0,k=g.length;x<k;x++){f=g[x];if(f.fromPort===w.fromPort&&f.toPort===w.toPort&&f.protocol===w.protocol){a=!0;break}}a||(g=g.slice(0),g.push(w),this.set(y,g))}if(E)d=this.port1Comp(),v=this.port2Comp(),d!==v&&d.type!=="SgIpTarget"&&v.type!=="SgIpTarget"&&d.vlineAddBatch(v);else{o=n.modelClassForType(e.RESTYPE.SG);if(l+p===0&&this.get("in1").length+this.get("out2").length>0){O=this.port1Comp().connectionTargets("SgAsso");for(T=0,L=O.length;T<L;T++)u=O[T],u.type===e.RESTYPE.ELB&&o.tryDrawLine(u)}if(h+c===0&&this.get("in2").length+this.get("out1").length>0){M=this.port2Comp().connectionTargets("SgAsso");for(N=0,A=M.length;N<A;N++)u=M[N],u.type===e.RESTYPE.ELB&&o.tryDrawLine(u)}}return null},addRule:function(e,t,n){var i;void 0,e===this.port1Comp().id||e===this.port1Comp().get("name")?i=this.port2Comp().id:(e=this.port2Comp().id,i=this.port1Comp().id);if(t===r.DIRECTION.IN||t===r.DIRECTION.BIWAY)this.addRawRule(e,r.DIRECTION.IN,n),this.addRawRule(i,r.DIRECTION.OUT,n);if(t===r.DIRECTION.OUT||t===r.DIRECTION.BIWAY)this.addRawRule(e,r.DIRECTION.OUT,n),this.addRawRule(i,r.DIRECTION.IN,n);return null},removeRawRule:function(t,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H;void 0,void 0,void 0,c=this.get("in1").length,p=this.get("in2").length,h=this.get("out1").length,d=this.get("out2").length,s.protocol==="-1"&&(s.protocol="all"),s.fromPort===s.toPort&&(s.toPort=""),v=t===this.port1Comp().id||t===this.port1Comp().get("name");switch(i){case r.DIRECTION.IN:y=[v?"in1":"in2"];break;case r.DIRECTION.OUT:y=[v?"out1":"out2"];break;case r.DIRECTION.BIWAY:y=[v?"in1":"in2",v?"out1":"out2"]}f=!1;for(w=0,T=y.length;w<T;w++){g=y[w],m=this.get(g);for(l=E=0,N=m.length;E<N;l=++E){a=m[l];if(a.fromPort===s.fromPort&&a.toPort===s.toPort&&a.protocol===s.protocol){m=m.slice(0),m.splice(l,1),f=!0,this.set(g,m);break}}}if(this.get("in1").length+this.get("in2").length+this.get("out1").length+this.get("out2").length===0)this.remove();else{o=n.modelClassForType(e.RESTYPE.SG);if(this.get("in1").length+this.get("out2").length===0&&c+d>0){_=this.port1Comp().connectionTargets("SgAsso");for(S=0,C=_.length;S<C;S++){u=_[S];if(u.type===e.RESTYPE.ELB){D=u.connections("SgRuleLine");for(x=0,k=D.length;x<k;x++)b=D[x],b.validate()}}}if(this.get("in2").length+this.get("out1").length===0&&p+h>0){P=this.port2Comp().connectionTargets("SgAsso");for(O=0,L=P.length;O<L;O++){u=P[O];if(u.type===e.RESTYPE.ELB){H=u.connections("SgRuleLine");for(M=0,A=H.length;M<A;M++)b=H[M],b.validate()}}}}return void 0,null},removeRuleByPlainObj:function(e){var t,n;return void 0,void 0,void 0,e.relation===this.port1Comp().id||e.relation===this.port1Comp().get("name")?t=this.port2Comp().id:t=this.port1Comp().id,n=""+e.port,n.indexOf("/")>=0?n=n.split("/"):n=n.split("-"),e.fromPort=n[0],e.toPort=n[1]||"",this.removeRawRule(t,e.direction,e),null},serialize:function(e){var t,n,r,i,s,o,u,a,f,l,c,h;i=this.port1Comp(),o=this.port2Comp(),s=i.createRef("GroupId"),u=o.type==="SgIpTarget"?o.get("name"):o.createRef("GroupId"),n=[{ary:this.get("in1"),owner:e[i.id].resource.IpPermissions,target:u},{ary:this.get("out1"),owner:e[i.id].resource.IpPermissionsEgress,target:u}],o.type!=="SgIpTarget"&&i!==o&&(n.push({ary:this.get("in2"),owner:e[o.id].resource.IpPermissions,target:s}),n.push({ary:this.get("out2"),owner:e[o.id].resource.IpPermissionsEgress,target:s}));for(a=0,l=n.length;a<l;a++){t=n[a],h=t.ary;for(f=0,c=h.length;f<c;f++)r=h[f],r.protocol==="1"&&(r.protocol="icmp",r.fromPort="0",r.toPort="0"),t.owner.push({FromPort:r.fromPort,ToPort:r.toPort?r.toPort:r.fromPort,IpRanges:t.target,IpProtocol:r.protocol==="all"?"-1":r.protocol})}return null},remove:function(){t.prototype.remove.apply(this,arguments);if(this.getTarget("SgIpTarget"))return;this.port1Comp().isRemoved()?this.port2Comp().vlineRemoveBatch(this.port1Comp(),this):this.port1Comp().vlineRemoveBatch(this.port2Comp(),this)}},{getResourceSgRuleSets:function(e){var t,n,r,i,s,o,u,a,f,l;i={},r=[],f=e.connectionTargets("SgAsso");for(s=0,u=f.length;s<u;s++){n=f[s],l=n.connections("SgRuleSet");for(o=0,a=l.length;o<a;o++){t=l[o];if(i[t.id])continue;i[t.id]=!0,r.push(t)}}return r},getRelatedSgRuleSets:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d;r={},h=e.connectionTargets("SgAsso");for(o=0,f=h.length;o<f;o++)s=h[o],r[s.id]=!0;n=[],p=t.connectionTargets("SgAsso");for(u=0,l=p.length;u<l;u++){s=p[u],d=s.connections("SgRuleSet");for(a=0,c=d.length;a<c;a++)i=d[a],r[i.getOtherTarget(s).id]&&n.push(i)}return _.uniq(n)},getPlainObjFromRuleSets:function(e){var t,n,r,i,s,o;n={},i=[];for(s=0,o=e.length;s<o;s++){t=e[s],r=t.direction+t.target+t.protocol+t.port;if(n[r])continue;n[r]=!0,i.push(t)}return i},getGroupedObjFromRuleSets:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d;a={};for(l=0,h=e.length;l<h;l++){u=e[l],s=u.getTarget("SgIpTarget");if(s&&!s.isClassicElbSg())continue;n=u.port1Comp(),i=n.id,a[i]||(a[i]={ownerId:i,ownerName:n.get("name"),ownerColor:n.color,rules:[]}),n=u.port2Comp(),i=n.id,a[i]||(a[i]={ownerId:i,ownerName:n.get("name"),ownerColor:n.color,rules:[]}),d=u.toPlainObjects(null,!0);for(c=0,p=d.length;c<p;c++)o=d[c],a[o.ownerId].rules.push(o)}t=[];for(f in a)r=a[f],r.rules.length&&t.push(r);return t.sort(function(e,t){return e.ownerName==="DefaultSG"?-1:t.ownerName==="DefaultSG"?1:e.ownerName<t.ownerName?-1:e.ownerName>t.ownerName?1:0})}}),r.DIRECTION={BIWAY:"biway",IN:"inbound",OUT:"outbound"},r})}.call(this),function(){define("workspaces/editor/framework/connection/SgLine",["constant","../ConnectionModel","../ResourceModel","component/sgrule/SGRulePopup"],function(e,t,n,r){var i;return i=t.extend({constructor:function(e,n,i,s){if(s&&s.createByUser){new r(e,n);return}void 0;if(!this.assignCompsToPorts(e,n)||!this.isValid())return;return t.call(this,e,n,i,s)},isValid:function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;l=this.port1Comp(),c=this.port2Comp(),t=e.RESTYPE;if(l.type===c.type&&l.type===t.AWS_ELB)return!1;n=this.getTarget(t.INSTANCE),o=this.getTarget(t.ENI);if(o){r=o.connectionTargets("EniAttachment");if(r.length===0)return!1;if(r.indexOf(n)>=0)return!1}u=this.getTarget("ExpandedAsg"),f=this.getTarget(t.LC);if(u&&f&&u.get("originalAsg").getLc()===f)return!1;i=this.getTarget(t.ELB);if(i){if(!i.get("internal"))return!1;s={},a=!1,E=i.connectionTargets("SgAsso");for(v=0,y=E.length;v<y;v++)p=E[v],s[p.id]=p;S=this.getOtherTarget(i).connectionTargets("SgAsso");for(m=0,b=S.length;m<b;m++){p=S[m],x=p.connections("SgRuleSet");for(g=0,w=x.length;g<w;g++){h=x[g],d=h.getOtherTarget(p);if(!s[d.id])continue;if(h.hasRawRuleTo(s[d.id])){a=!0;break}}if(a)break}if(!a)return!1}return!0},validate:function(){this.isValid()||this.remove({reason:"Validation Failed"})},isRemovable:function(){var e,t,n,r,i,s;e=Design.modelClassForType("SgRuleSet"),t=e.getRelatedSgRuleSets(this.port1Comp(),this.port2Comp()),r=e.getGroupedObjFromRuleSets(t);for(i=0,s=r.length;i<s;i++)n=r[i],n.content=MC.template.sgRuleList(n.rules);return MC.template.groupedSgRuleListDelConfirm(r)},remove:function(e){var n,r,i,s,o;t.prototype.remove.apply(this,arguments);if(e)return;if(this.port1Comp().isRemoved()||this.port2Comp().isRemoved())return;n=Design.modelClassForType("SgRuleSet"),o=n.getRelatedSgRuleSets(this.port1Comp(),this.port2Comp());for(i=0,s=o.length;i<s;i++)r=o[i],r.remove();return null},silentRemove:function(){var e;return e=this.__view,e&&e.detach(),n.prototype.remove.apply(this,arguments),null},type:"SgRuleLine",defaults:{name:"Security Group Rule"},portDefs:[{port1:{name:"instance-sg",type:e.RESTYPE.INSTANCE},port2:{name:"instance-sg",type:e.RESTYPE.INSTANCE}},{port1:{name:"instance-sg",type:e.RESTYPE.INSTANCE},port2:{name:"eni-sg",type:e.RESTYPE.ENI}},{port1:{name:"instance-sg",type:e.RESTYPE.INSTANCE},port2:{name:"launchconfig-sg",type:e.RESTYPE.LC}},{port1:{name:"instance-sg",type:e.RESTYPE.INSTANCE},port2:{name:"launchconfig-sg",type:"ExpandedAsg"}},{port1:{name:"instance-sg",type:e.RESTYPE.INSTANCE},port2:{name:"elb-sg-in",type:e.RESTYPE.ELB}},{port1:{name:"instance-sg",type:e.RESTYPE.INSTANCE},port2:{name:"db-sg",type:e.RESTYPE.DBINSTANCE}},{port1:{name:"eni-sg",type:e.RESTYPE.ENI},port2:{name:"eni-sg",type:e.RESTYPE.ENI}},{port1:{name:"launchconfig-sg",type:e.RESTYPE.LC},port2:{name:"eni-sg",type:e.RESTYPE.ENI}},{port1:{name:"launchconfig-sg",type:"ExpandedAsg"},port2:{name:"eni-sg",type:e.RESTYPE.ENI}},{port1:{name:"elb-sg-in",type:e.RESTYPE.ELB},port2:{name:"eni-sg",type:e.RESTYPE.ENI}},{port1:{name:"launchconfig-sg",type:e.RESTYPE.LC},port2:{name:"launchconfig-sg",type:e.RESTYPE.LC}},{port1:{name:"launchconfig-sg",type:e.RESTYPE.LC},port2:{name:"launchconfig-sg",type:"ExpandedAsg"}},{port1:{name:"launchconfig-sg",type:e.RESTYPE.LC},port2:{name:"elb-sg-in",type:e.RESTYPE.ELB}},{port1:{name:"launchconfig-sg",type:e.RESTYPE.LC},port2:{name:"elb-sg-in",type:e.RESTYPE.ELB}},{port1:{name:"launchconfig-sg",type:"ExpandedAsg"},port2:{name:"elb-sg-in",type:e.RESTYPE.ELB}},{port1:{name:"db-sg",type:e.RESTYPE.DBINSTANCE},port2:{name:"db-sg",type:e.RESTYPE.DBINSTANCE}},{port1:{name:"db-sg",type:e.RESTYPE.DBINSTANCE},port2:{name:"eni-sg",type:e.RESTYPE.ENI}},{port1:{name:"db-sg",type:e.RESTYPE.DBINSTANCE},port2:{name:"launchconfig-sg",type:e.RESTYPE.LC}},{port1:{name:"db-sg",type:e.RESTYPE.DBINSTANCE},port2:{name:"launchconfig-sg",type:"ExpandedAsg"}},{port1:{name:"db-sg",type:e.RESTYPE.DBINSTANCE},port2:{name:"instance-sg",type:e.RESTYPE.INSTANCE}}]},{isConnectable:function(t,n){var r,i,s,o,u;i=t.type+">"+n.type;if(i.indexOf(e.RESTYPE.INSTANCE)!==-1&&i.indexOf(e.RESTYPE.ENI)!==-1){u=t.connectionTargets("EniAttachment");for(s=0,o=u.length;s<o;s++){r=u[s];if(r===n)return"The Network Interface is attached to the instance. No need to connect them by security group rule."}}return!0}}),i})}.call(this),function(){define("workspaces/editor/framework/resource/SgModel",["../ComplexResModel","../ResourceModel","../connection/SgRuleSet","../connection/SgLine","Design","constant"],function(e,t,n,r,i,s){var o,u,a;return u=["#f26c4f","#7dc476","#00bef2","#615ca8","#fcec00","#ff9900","#ffcc00","#ffcc99","#ff99ff","#00cccc","#99cc99","#9999ff","#ffff99","#ff00ff","#663300","#336600","#660066","#003300","#0000ff","#666600"],a=e.extend({type:"SgIpTarget",constructor:function(e){var t,n,r,s;t=i.instance().classCacheForCid(this.classId);for(r=0,s=t.length;r<s;r++){n=t[r];if(n.attributes.name===e)return n}return t.push(this),Backbone.Model.call(this,{id:MC.guid(),name:e}),this},isClassicElbSg:function(){return this.attributes.name==="amazon-elb/amazon-elb-sg"},isVisual:function(){return!1}}),o=e.extend({type:s.RESTYPE.SG,newNameTmpl:"custom-sg-",color:"#f26c4f",defaults:{description:"Custom Security Group",groupName:""},initialize:function(e,t){var r,i;this.color=this.generateColor();if(!t||!t.isDeserialize)this.isElbSg()?(i=n.DIRECTION.IN,r={fromPort:"22",toPort:"",protocol:"tcp"}):(i=n.DIRECTION.OUT,r={fromPort:"0",toPort:"65535",protocol:"-1"}),(new n(this,this.createIpTarget("0.0.0.0/0"))).addRawRule(this.id,i,r);return null},isElbSg:function(){return this.get("isElbSg")},setAsElbSg:function(){return this.set("isElbSg",!0)},isDefault:function(){return this.attributes.name==="DefaultSG"},isVisual:function(){return!1},createIpTarget:function(e){return new a(MC.getValidCIDR(e))},getNewName:function(){var e;return e=i.modelClassForType(this.type).allObjects(),t.prototype.getNewName.call(this,e.length-1)},ruleCount:function(){var e,t,n,r,i;e=0,i=this.connections("SgRuleSet");for(n=0,r=i.length;n<r;n++)t=i[n],e+=t.ruleCount(this.id);return e},getMemberList:function(){return _.filter(this.connectionTargets("SgAsso"),function(e){return e.type!=="ExpandedAsg"})},connect:function(e){return e.type==="SgAsso"&&this.vlineAdd(e.getOtherTarget(this)),null},disconnect:function(e){return e.type==="SgAsso"&&this.vlineRemove(e.getOtherTarget(this),void 0,e),null},vlineAdd:function(e){var t,n,s,o,u,a,f,l,c;if(i.instance().initializing())return;t={},l=this.getVisualConnectedSg();for(o=0,a=l.length;o<a;o++){s=l[o],c=s.connectionTargets("SgAsso");for(u=0,f=c.length;u<f;u++){n=c[u];if(t[n.id])continue;e!==n&&new r(e,n),t[n.id]=!0}}return null},vlineAddBatch:function(e){var t,n,s,o,u,a,f,l;if(i.instance().initializing())return;if(e===this)return;t=this.connectionTargets("SgAsso"),l=e.connectionTargets("SgAsso");for(o=0,a=l.length;o<a;o++){s=l[o];for(u=0,f=t.length;u<f;u++)n=t[u],n!==s&&new r(n,s)}return null},vlineRemove:function(e,t,n){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;if(i.instance().initializing())return;if(!t){t=[],E=this.getVisualConnectedSg();for(c=0,v=E.length;c<v;c++)f=E[c],t=t.concat(f.connectionTargets("SgAsso"))}o={},S=e.connectionTargets("SgAsso");for(h=0,m=S.length;h<m;h++){a=S[h],x=a.getVisualConnectedSg();for(p=0,g=x.length;p<g;p++){f=x[p],T=f.connectionTargets("SgAsso");for(d=0,y=T.length;d<y;d++)l=T[d],o[l.id]=!0}}for(w=0,b=t.length;w<b;w++){u=t[w];if(u===e)continue;s=r.findExisting(e,u),s&&(o[u.id]?s.validate():s.remove(n))}return null},vlineRemoveBatch:function(e,t){var n,r,s,o,u;if(i.instance().initializing())return;n=e.connectionTargets("SgAsso"),u=this.connectionTargets("SgAsso");for(s=0,o=u.length;s<o;s++)r=u[s],this.vlineRemove(r,n,t);return null},getVisualConnectedSg:function(){var e,t,n,r,i;t=[],i=this.get("__connections");for(n=0,r=i.length;n<r;n++)e=i[n],e.type==="SgRuleSet"&&e.port1Comp()!==e.port2Comp()&&!e.getTarget("SgIpTarget")&&t.push(e.getOtherTarget(this));return t},generateColor:function(){var e,t,n,r,i,s,a,f;if(this.isDefault())return u[0];i={},f=o.allObjects();for(s=0,a=f.length;s<a;s++)r=f[s],i[r.color]=!0;n=1;while(n<u.length){e=u[n];if(!i[e]){t=e;break}++n}if(!t){t=Math.floor(Math.random()*16777215).toString(16);while(t.length<6)t="0"+t;t="#"+t}return t},serialize:function(){var e;return e={name:this.get("name"),type:this.type,uid:this.id,resource:{Default:this.isDefault(),GroupId:this.get("appId"),GroupName:this.isDefault()?"default":this.get("groupName")||this.get("name"),GroupDescription:this.get("description"),VpcId:this.getVpcRef(),IpPermissions:[],IpPermissionsEgress:[]}},{component:e}}},{getDefaultSg:function(){return _.find(o.allObjects(),function(e){return e.isDefault()})},tryDrawLine:function(e,t){var n,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;if(t){s={},w=t.connectionTargets("SgAsso");for(a=0,h=w.length;a<h;a++)u=w[a],s[u.id]=!0;E=e.connectionTargets("SgAsso");for(f=0,p=E.length;f<p;f++){u=E[f],S=u.getVisualConnectedSg();for(l=0,d=S.length;l<d;l++){n=S[l];if(s[n.id]){new r(e,t);return}}}}else{o=[],x=e.connectionTargets("SgAsso");for(c=0,v=x.length;c<v;c++){u=x[c],T=u.getVisualConnectedSg();for(y=0,m=T.length;y<m;y++)i=T[y],o=_.union(o,i.connectionTargets("SgAsso"))}for(b=0,g=o.length;b<g;b++)t=o[b],e!==t&&new r(e,t)}return null},updateSgLines:function(){var e,t,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;void 0,t={},b=n.allObjects();for(p=0,m=b.length;p<m;p++){l=b[p],c=l.port1Comp(),h=l.port2Comp();if(c===h||c.type==="SgIpTarget"||h.type==="SgIpTarget")continue;o=c.connectionTargets("SgAsso"),w=h.connectionTargets("SgAsso");for(d=0,g=w.length;d<g;d++){a=w[d];for(v=0,y=o.length;v<y;v++){u=o[v];if(u.id===a.id)continue;u.id<a.id?s=u.id+"|"+a.id:s=a.id+"|"+u.id,e=t[s]||[],e[0]=u,e[1]=a,t[s]=e}}}for(i in t)f=t[i],new r(f[0],f[1],void 0,{detectDuplicate:!1});return null},handleTypes:s.RESTYPE.SG,deserialize:function(e,t,r){var i,s,u,f,l,c,h,p,d,v,m,g,y,b,w;u=new o({name:e.resource.Default?"DefaultSG":e.name,id:e.uid,appId:e.resource.GroupId,groupName:e.resource.Default?"default":e.resource.GroupName,description:e.resource.GroupDescription},{isDeserialize:!0}),h=[];if(e.resource.IpPermissions){b=e.resource.IpPermissions;for(p=0,m=b.length;p<m;p++)f=b[p],h.push({rule:f})}if(e.resource.IpPermissionsEgress){w=e.resource.IpPermissionsEgress;for(d=0,g=w.length;d<g;d++)f=w[d],h.push({rule:f,out:!0})}for(v=0,y=h.length;v<y;v++){l=h[v],f=l.rule,f.IpRanges[0]==="@"?c=r(MC.extractID(f.IpRanges)):c=new a(f.IpRanges);if(!c)continue;i={fromPort:f.FromPort,toPort:f.ToPort,protocol:f.IpProtocol},s=l.out?n.DIRECTION.OUT:n.DIRECTION.IN,(new n(u,c)).addRawRule(u.id,s,i)}return null}}),i.on(i.EVENT.Deserialized,o.updateSgLines),o})}.call(this),function(){define("workspaces/editor/framework/resource/SslCertModel",["constant","../ComplexResModel","../ConnectionModel"],function(e,t,n){var r,i;return i=n.extend({type:"SslCertUsage",oneToMany:e.RESTYPE.IAM}),r=t.extend({type:e.RESTYPE.IAM,defaults:{name:"v",body:"",chain:"",key:"",arn:"",certId:""},isVisual:function(){return!1},assignTo:function(e){return new i(this,e)},serialize:function(){var t,n,r;return n=this,r=!1,t=Design.modelClassForType(e.RESTYPE.ELB).allObjects(),_.each(t,function(e){return _.each(e.get("listeners"),function(e){return e.sslCert===n&&(r=!0),null}),null}),r?{component:{uid:this.id,type:"AWS.IAM.ServerCertificate",name:this.get("name"),resource:{PrivateKey:this.get("key"),CertificateBody:this.get("body"),CertificateChain:this.get("chain"),ServerCertificateMetadata:{ServerCertificateName:this.get("appName")||this.get("name"),Arn:this.get("arn")||"",ServerCertificateId:this.get("certId")||""}}}}:{}},updateValue:function(e){var t,n;for(t in e)n=e[t],this.set(t,n);return null}},{handleTypes:e.RESTYPE.IAM,deserialize:function(e){return new r({id:e.uid,name:e.name,body:e.resource.CertificateBody,chain:e.resource.CertificateChain,key:e.resource.PrivateKey,arn:e.resource.ServerCertificateMetadata.Arn,certId:e.resource.ServerCertificateMetadata.ServerCertificateId,appName:e.resource.ServerCertificateMetadata.ServerCertificateName}),null},createNew:function(t){var n,i,s;return i=null,s=Design.modelClassForType(e.RESTYPE.IAM).allObjects(),n=!0,_.each(s,function(e){return e.get("body")?e.remove():e.get("arn")===t.get("Arn")&&(n=!1,i=e),null}),n&&(i=new r({name:t.get("Name"),body:t.get("CertificateBody"),chain:t.get("CertificateChain"),key:t.get("PrivateKey"),arn:t.get("Arn"),certId:t.get("id")})),i}}),r})}.call(this),function(){define("workspaces/editor/framework/connection/ElbAsso",["constant","../ConnectionModel","i18n!/nls/lang.js","Design","component/sgrule/SGRulePopup"],function(e,t,n,r,i){var s,o;return o=t.extend({type:"ElbSubnetAsso",defaults:{deserialized:!1},portDefs:[{port1:{name:"elb-assoc",type:e.RESTYPE.ELB},port2:{name:"subnet-assoc-in",type:e.RESTYPE.SUBNET}}],initialize:function(){var t,n,r,i,s,o;r=this.getTarget(e.RESTYPE.SUBNET),t=r.parent(),o=this.getTarget(e.RESTYPE.ELB).connections("ElbSubnetAsso");for(i=0,s=o.length;i<s;i++)n=o[i],n.getTarget(e.RESTYPE.SUBNET).parent()===t&&(n.hasAppUpdateRestriction()?this.setDestroyAfterInit():n.remove());return null},hasAppUpdateRestriction:function(){var t,n,r,i,s;n=this.getTarget(e.RESTYPE.ELB);if(this.design().modeIsAppEdit()&&this.get("deserialized")){s=n.connections("ElbSubnetAsso");for(r=0,i=s.length;r<i;r++){t=s[r];if(t!==this&&t.get("deserialized"))return!1}return!0}return!1},isRemovable:function(){var t,r,i,s,o,u,a,f,l,c,h,p,d;if(this.design().modeIsAppEdit()&&this.hasAppUpdateRestriction())return{error:n.ide.CVS_MSG_ERR_DEL_ELB_LINE_2};o=this.getTarget(e.RESTYPE.ELB),a=this.getTarget(e.RESTYPE.SUBNET),t=a.parent(),p=o.connectionTargets("ElbAmiAsso");for(f=0,c=p.length;f<c;f++){r=p[f],i=r.parent();while(i){if(i.type===e.RESTYPE.AZ)break;i=i.parent()}if(!i)continue;if(i===t){s=!0;break}}if(!s)return!0;d=o.connectionTargets("ElbSubnetAsso");for(l=0,h=d.length;l<h;l++){u=d[l];if(u!==a&&u.parent()===t){s=!1;break}}return s?{error:n.ide.CVS_MSG_ERR_DEL_ELB_LINE_2}:!0}},{}),s=t.extend({type:"ElbAmiAsso",portDefs:[{port1:{name:"elb-sg-out",type:e.RESTYPE.ELB},port2:{name:"instance-sg",type:e.RESTYPE.INSTANCE}},{port1:{name:"elb-sg-out",type:e.RESTYPE.ELB},port2:{name:"launchconfig-sg",type:e.RESTYPE.LC}},{port1:{name:"elb-sg-out",type:e.RESTYPE.ELB},port2:{name:"launchconfig-sg",type:"ExpandedAsg"}}],constructor:function(r,i,s,o){if(r.design().modeIsAppEdit()&&(r.type===e.RESTYPE.LC&&r.get("appId")||i.type===e.RESTYPE.LC&&i.get("appId"))){notification("error",n.ide.NOTIFY_MSG_WARN_ASG_CAN_ONLY_CONNECT_TO_ELB_ON_LAUNCH);return}return t.prototype.constructor.apply(this,arguments)},initialize:function(t,n){var r,u,a,f,l,c,h,p,d,v,m,g,y;n&&n.createByUser&&new i(this.id),r=this.getOtherTarget(e.RESTYPE.ELB),f=this.getTarget(e.RESTYPE.ELB),h=r;for(;;){h=h.parent();if(!h)return;if(h.type===e.RESTYPE.SUBNET)break}a=f.connectionTargets("ElbSubnetAsso"),g=h.parent().children();for(p=0,v=g.length;p<v;p++){c=g[p];if(a.indexOf(c)!==-1){l=!0;break}}l||new o(h,f);if(r.type===e.RESTYPE.LC){y=r.parent().get("expandedList");for(d=0,m=y.length;d<m;d++)u=y[d],new s(u,f)}return null},remove:function(n){var r,i,o,u;if(n&&n.reason.type!==e.RESTYPE.LC){t.prototype.remove.apply(this,arguments);return}i=this.getTarget("ExpandedAsg");if(i&&!i.isRemoved()){r=this.getTarget(e.RESTYPE.ELB),o=i.getLc(),(new s(r,o)).remove();return}return o=this.getTarget(e.RESTYPE.LC),o&&(r=this.getTarget(e.RESTYPE.ELB),u={reason:this}),t.prototype.remove.apply(this,arguments),null},serialize:function(t){var n,r,i,s,o,u,a;i=this.getTarget(e.RESTYPE.INSTANCE);if(!i)return;n=this.getTarget(e.RESTYPE.ELB),s=t[n.id].resource.Instances,a=i.getRealGroupMemberIds();for(o=0,u=a.length;o<u;o++)r=a[o],s.push({InstanceId:this.createRef("InstanceId",r)});return null}}),null})}.call(this),function(){define("workspaces/editor/framework/resource/ElbModel",["Design","constant","../ResourceModel","../ComplexResModel","./VpcModel","./SgModel","./SslCertModel","../connection/SgAsso","../connection/ElbAsso"],function(e,t,n,r,i,s,o,u){var a;return a=r.extend({defaults:function(){return{internal:!0,crossZone:!0,healthyThreshold:"9",unHealthyThreshold:"4",healthCheckTarget:"HTTP:80/index.html",healthCheckInterval:"30",healthCheckTimeout:"5",listeners:[{port:"80",protocol:"HTTP",instanceProtocol:"HTTP",instancePort:"80",sslCertName:null}],AvailabilityZones:[],ConnectionDraining:{Enabled:!0,Timeout:300},idleTimeout:60,otherPoliciesMap:{}}},type:t.RESTYPE.ELB,newNameTmpl:"load-balancer-",initialize:function(t,n){var r,i;return n.createByUser&&(i=new s({name:this.getElbSgName(),isElbSg:!0,description:"Automatically created SG for load-balancer"}),this.__elbSg=i,r=e.modelClassForType("SgAsso"),new r(this,i)),null},isRemovable:function(){var e;return e=this.getElbSg(),e&&e.connections("SgAsso").length>1?MC.template.ElbRemoveConfirmation({name:this.get("name"),sg:e.get("name")}):!0},remove:function(){return this.getElbSg()&&this.getElbSg().remove(),r.prototype.remove.call(this),null},getElbSg:function(){return this.__elbSg&&this.__elbSg.isRemoved()&&(this.__elbSg=void 0),this.__elbSg},getElbSgName:function(){return"elbsg-"+this.get("name")},setName:function(e){if(this.get("name")===e)return;return this.set("name",e),this.getElbSg()&&this.getElbSg().set("name",this.getElbSgName()),null},setListener:function(e,t){var n,r;return void 0,n=this.get("listeners"),e>=n.length?n.push(t):(n[e]||(n[e]={}),n[e]=$.extend(n[e],t)),(r=n[e].protocol)!=="HTTPS"&&r!=="SSL"&&(n[e].sslCert=null),null},removeListener:function(e){var t;return t=this.get("listeners"),t.splice(e,1),this.set("listeners",t),null},setSSLCert:function(e,t){var n,r;if(e>=0)return n=this.get("listeners"),r=sslCertCol.get(t),n[e].sslCert=o.createNew(r)},removeSSLCert:function(e){var t;return t=this.get("listeners"),t[e].sslCert=null},getSSLCert:function(e){var t;return t=this.get("listeners"),t[e].sslCert},getHealthCheckTarget:function(){var e,t,n,r,i;return i=this.attributes.healthCheckTarget,r=i.indexOf(":"),n=i.substring(0,r),i=i.substring(r+1),t=parseInt(i,10),isNaN(t)&&(t=80),e=i.replace(/[^\/]+\//,""),[n,t,e]},setHealthCheckTarget:function(e,t,n){var r;return r=this.getHealthCheckTarget(),e&&(r[0]=e),t!==void 0&&(r[1]=t),n!==void 0&&(r[2]=n),this.set("healthCheckTarget",r[0]+":"+r[1]+"/"+r[2]),null},setInternal:function(n){var r,i,o,u;this.set("internal",!!n);if(n)s=e.modelClassForType(t.RESTYPE.SG),s.tryDrawLine(this);else{u=this.connections("SgRuleLine");for(i=0,o=u.length;i<o;i++)r=u[i],r.remove(this)}return null},getCost:function(e,n){var r,i,s,o,u;if(!e.elb||!e.elb.types)return null;u=e.elb.types;for(s=0,o=u.length;s<o;s++){i=u[s];if(i.unit==="perELBHour"){r=parseFloat(i[n],10)||0;break}}if(r)return{resource:this.get("name"),type:t.RESTYPE.ELB,fee:r*24*30,formatedFee:r+"/hr"}},getAvailabilityZones:function(){var e;return e=_.map(this.connectionTargets("ElbSubnetAsso"),function(e){return e.parent().createRef()}),_.uniq(e)},setPolicyProxyProtocol:function(e,t){var n;return n=this.get("otherPoliciesMap"),e?n.EnableProxyProtocol={PolicyName:"EnableProxyProtocol",PolicyTypeName:"ProxyProtocolPolicyType",PolicyAttributes:{ProxyProtocol:!0},InstancePort:t}:delete n.EnableProxyProtocol,this.set("otherPoliciesMap",n)},serialize:function(){var e,t,n,r,i,s,o,u,a,f,l,c;t=this.get("healthCheckTarget");if(t.indexOf("TCP")!==-1||t.indexOf("SSL")!==-1)t=t.split("/")[0];i=[],c=this.get("listeners");for(f=0,l=c.length;f<l;f++)r=c[f],n="",(r.protocol==="SSL"||r.protocol==="HTTPS")&&r.sslCert&&(n=r.sslCert.createRef("ServerCertificateMetadata.Arn")),i.push({PolicyNames:"",Listener:{LoadBalancerPort:r.port,Protocol:r.protocol,InstanceProtocol:r.instanceProtocol,InstancePort:r.instancePort,SSLCertificateId:n}});return u=_.map(this.connectionTargets("SgAsso"),function(e){return e.createRef("GroupId")}),a=_.map(this.connectionTargets("ElbSubnetAsso"),function(e){return e.createRef("SubnetId")}),o=this.get("otherPoliciesMap"),s=_.map(o,function(e){return e}),s||(s=[]),e={type:this.type,uid:this.id,name:this.get("name"),resource:{AvailabilityZones:[],Subnets:a,Instances:[],CrossZoneLoadBalancing:this.get("crossZone"),ConnectionDraining:this.get("ConnectionDraining"),VpcId:this.getVpcRef(),LoadBalancerName:this.get("elbName")||this.get("name"),SecurityGroups:u,Scheme:this.get("internal")?"internal":"internet-facing",ListenerDescriptions:i,HealthCheck:{Interval:String(this.get("healthCheckInterval")),Target:t,Timeout:String(this.get("healthCheckTimeout")),HealthyThreshold:String(this.get("healthyThreshold")),UnhealthyThreshold:String(this.get("unHealthyThreshold"))},DNSName:this.get("dnsName")||"",Policies:{LBCookieStickinessPolicies:[{PolicyName:"",CookieExpirationPeriod:""}],AppCookieStickinessPolicies:[{PolicyName:"",CookieName:""}],OtherPolicies:s},BackendServerDescriptions:[{InstantPort:"",PoliciyNames:""}],ConnectionSettings:{IdleTimeout:this.get("idleTimeout")||60}}},{component:e,layout:this.generateLayout()}}},{handleTypes:t.RESTYPE.ELB,deserialize:function(t,n,r){var i,s,o,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;f={id:t.uid,name:t.name,appId:t.resource.DNSName,parent:r(n.groupUId),internal:t.resource.Scheme==="internal",crossZone:!!t.resource.CrossZoneLoadBalancing,ConnectionDraining:t.resource.ConnectionDraining||{Enabled:!0,Timeout:300},listeners:[],dnsName:t.resource.DNSName,elbName:t.resource.LoadBalancerName,healthyThreshold:String(t.resource.HealthCheck.HealthyThreshold),unHealthyThreshold:String(t.resource.HealthCheck.UnhealthyThreshold),healthCheckTarget:t.resource.HealthCheck.Target,healthCheckInterval:String(t.resource.HealthCheck.Interval),healthCheckTimeout:String(t.resource.HealthCheck.Timeout),x:n.coordinate[0],y:n.coordinate[1],idleTimeout:((N=t.resource)!=null?(C=N.ConnectionSettings)!=null?C.IdleTimeout:void 0:void 0)||60,otherPoliciesMap:{}},t.resource.Policies&&t.resource.Policies.OtherPolicies&&_.each(t.resource.Policies.OtherPolicies,function(e){return f.otherPoliciesMap[e.PolicyName]=e,null}),f.AvailabilityZones=_.map(t.resource.AvailabilityZones||[],function(e){return e[0]==="@"?r(MC.extractID(e)).get("name"):e}),k=t.resource.ListenerDescriptions||[];for(c=g=0,E=k.length;g<E;c=++g)p=k[c],p=p.Listener,f.listeners.push({port:p.LoadBalancerPort,protocol:p.Protocol,instanceProtocol:p.InstanceProtocol,instancePort:p.InstancePort}),p.SSLCertificateId&&(m=r(MC.extractID(p.SSLCertificateId)),m&&(f.listeners[c].sslCert=m));l=new a(f),i=e.modelClassForType("ElbAmiAsso"),s=e.modelClassForType("ElbSubnetAsso"),L=t.resource.SecurityGroups||[];for(y=0,S=L.length;y<S;y++)v=L[y],new u(l,r(MC.extractID(v)));A=t.resource.Subnets||[];for(b=0,x=A.length;b<x;b++)d=A[b],new s(l,r(MC.extractID(d)),{deserialized:!0});O=t.resource.Instances||[];for(w=0,T=O.length;w<T;w++)o=O[w],h=r(MC.extractID(o.InstanceId)),h&&new i(l,h);return null},postDeserialize:function(t,n){var r,i,o,u,a,f;r=e.instance().component(t.uid),o=r.getElbSgName(),f=s.allObjects();for(u=0,a=f.length;u<a;u++){i=f[u];if(i.get("name")===o){r.__elbSg=i,i.setAsElbSg();return}}}}),a})}.call(this),function(){define("workspaces/editor/framework/resource/LcModel",["../ComplexResModel","./InstanceModel","Design","constant","./VolumeModel","i18n!/nls/lang.js","CloudResources"],function(e,t,n,r,i,s,o){var u,a;return a=[],u=e.extend({defaults:function(){return{imageId:"",ebsOptimized:!1,instanceType:"m1.small",monitoring:!1,userData:"",publicIp:!1,state:null,rdSize:0,rdIops:"",rdType:"gp2"}},type:r.RESTYPE.LC,newNameTmpl:"launch-config-",initialize:function(e,t){var i;return t&&t.createByUser&&(this.initInstanceType(),n.modelClassForType(r.RESTYPE.KP).getDefaultKP().assignTo(this),i=n.modelClassForType("SgAsso"),new i(n.modelClassForType(r.RESTYPE.SG).getDefaultSg(),this)),this.get("rdSize")||this.set("rdSize",this.getAmiRootDeviceVolumeSize()),null},getNewName:function(e){var t,i,s,u,a;if(!this.newNameTmpl)return s=this.defaults?this.defaults.name:void 0,s||"";e===void 0&&(e=this.getAllObjects().length),i={},this.design().eachComponent(function(e){return e.get("name")&&(i[e.get("name")]=!0),null});if(n.instance().modeIsAppEdit()){u=o(r.RESTYPE.LC,n.instance().region()).toJSON();for(t in u)a=u[t],a.LaunchConfigurationName&&(i[_.first(a.LaunchConfigurationName.split("---"))]=!0)}for(;;){s=this.newNameTmpl+e;if(!i[s])break;e+=1}return s},isRemovable:function(){var e;return this.design().modeIsAppEdit()&&this.get("appId")?{error:s.ide.CVS_MSG_ERR_DEL_LC}:(e=this.get("state"),e&&e.length>0?MC.template.NodeStateRemoveConfirmation({name:this.get("name")}):!0)},isDefaultTenancy:function(){return!0},groupMembers:function(){var e,t,i,s,u,a,f,l;s=o(r.RESTYPE.ASG,n.instance().region());if(!s)return[];i=(f=s.get(this.connectionTargets("LcUsage")[0].get("appId")))!=null?f.toJSON():void 0;if(i&&i.Instances&&i.Instances.length){e=[],l=i.Instances;for(u=0,a=l.length;u<a;u++)t=l[u],e.push({id:t.InstanceId,appId:t.InstanceId,state:t.HealthStatus})}return e||[]},remove:function(){var t,n,r,i;i=(this.get("volumeList")||a).slice(0);for(n=0,r=i.length;n<r;n++)t=i[n],t.remove();return e.prototype.remove.call(this),null},getStateData:t.prototype.getStateData,setStateData:t.prototype.setStateData,setKey:t.prototype.setKey,getKeyName:t.prototype.getKeyName,isDefaultKey:t.prototype.isDefaultKey,isNoKey:t.prototype.isNoKey,setAmi:t.prototype.setAmi,getAmi:t.prototype.getAmi,getOSFamily:t.prototype.getOSFamily,setInstanceType:t.prototype.setInstanceType,initInstanceType:t.prototype.initInstanceType,isEbsOptimizedEnabled:t.prototype.isEbsOptimizedEnabled,getBlockDeviceMapping:t.prototype.getBlockDeviceMapping,getAmiRootDevice:t.prototype.getAmiRootDevice,getAmiRootDeviceName:t.prototype.getAmiRootDeviceName,getAmiRootDeviceVolumeSize:t.prototype.getAmiRootDeviceVolumeSize,getInstanceType:t.prototype.getInstanceType,getInstanceTypeConfig:t.prototype.getInstanceTypeConfig,getInstanceTypeList:t.prototype.getInstanceTypeList,serialize:function(){var e,t,n,r,i,s,o,u,f;e=this.getAmi()||this.get("cachedAmi"),r=this.generateLayout(),e&&(r.osType=e.osType,r.architecture=e.architecture,r.rootDeviceType=e.rootDeviceType),t=this.getBlockDeviceMapping(),f=this.get("volumeList")||a;for(o=0,u=f.length;o<u;o++)s=f[o],i={DeviceName:s.get("name"),Ebs:{VolumeSize:s.get("volumeSize"),VolumeType:s.get("volumeType")}},s.get("volumeType")==="io1"&&(i.Ebs.Iops=s.get("iops")),s.get("snapshotId")&&(i.Ebs.SnapshotId=s.get("snapshotId")),t.push(i);return n={type:this.type,uid:this.id,name:this.get("name"),state:this.get("state"),resource:{UserData:this.get("userData"),LaunchConfigurationARN:this.get("appId"),InstanceMonitoring:this.get("monitoring"),ImageId:this.get("imageId"),KeyName:this.get("keyName"),EbsOptimized:this.isEbsOptimizedEnabled()?this.get("ebsOptimized"):!1,BlockDeviceMapping:t,SecurityGroups:_.map(this.connectionTargets("SgAsso"),function(e){return e.createRef("GroupId")}),LaunchConfigurationName:this.get("configName")||this.get("name"),InstanceType:this.get("instanceType"),AssociatePublicIpAddress:this.get("publicIp")}},{component:n,layout:r}}},{handleTypes:r.RESTYPE.LC,resolveFirst:!0,preDeserialize:function(e,t){var n;if(!_.isArray(e.state)||!e.state.length)e.state=null;return n={id:e.uid,name:e.name,state:e.state,appId:e.resource.LaunchConfigurationARN,imageId:e.resource.ImageId,ebsOptimized:e.resource.EbsOptimized,instanceType:e.resource.InstanceType,monitoring:e.resource.InstanceMonitoring,userData:e.resource.UserData,publicIp:e.resource.AssociatePublicIpAddress,configName:e.resource.LaunchConfigurationName},t.osType&&t.architecture&&t.rootDeviceType&&(n.cachedAmi={osType:t.osType,architecture:t.architecture,rootDeviceType:t.rootDeviceType}),new u(n),null},deserialize:function(e,t,r){var s,o,u,a,f,l,c,h,p,d,v,m,g;u=r(e.uid),a=u.getAmiRootDevice(),m=e.resource.BlockDeviceMapping||[];for(h=0,d=m.length;h<d;h++)l=m[h],a&&l.DeviceName===a.DeviceName?(u.set("rdSize",l.Ebs.VolumeSize),u.set("rdIops",l.Ebs.Iops),u.set("rdType",l.Ebs.VolumeType)):(c={name:l.DeviceName,snapshotId:l.Ebs.SnapshotId,volumeSize:l.Ebs.VolumeSize,volumeType:l.Ebs.VolumeType,iops:l.Ebs.Iops,owner:u},new i(c,{noNeedGenName:!0}));o=n.modelClassForType("SgAsso"),g=e.resource.SecurityGroups||[];for(p=0,v=g.length;p<v;p++)f=g[p],new o(u,r(MC.extractID(f)));return s=r(MC.extractID(e.resource.KeyName)),s?s.assignTo(u):u.set("keyName",e.resource.KeyName),null}}),u})}.call(this),function(){define("workspaces/editor/framework/resource/KeypairModel",["constant","../ComplexResModel","../ConnectionModel"],function(e,t,n){var r,i;return i=n.extend({type:"KeypairUsage",oneToMany:e.RESTYPE.KP,serialize:function(t){var n,r,i,s,o,u,a,f;r=this.getTarget(e.RESTYPE.KP);if(r){s=this.getOtherTarget(r),o=t[s.id];if(!o)return;u=r.createRef("KeyName"),o.resource.KeyName=u,n=s.groupMembers?s.groupMembers():[];for(a=0,f=n.length;a<f;a++)i=n[a],t[i.id]&&(t[i.id].resource.KeyName=u)}return null}}),r=t.extend({type:e.RESTYPE.KP,defaults:{fingerprint:"",isSet:!1},isVisual:function(){return!1},isDefault:function(){return this.get("name")==="DefaultKP"},remove:function(){var e,n,s,o,u;e=r.getDefaultKP(),u=this.connectionTargets("KeypairUsage");for(s=0,o=u.length;s<o;s++)n=u[s],new i(e,n);return t.prototype.remove.call(this),null},assignTo:function(e){return new i(this,e)},dissociate:function(t){var n;return n=this.connections(),_.each(n,function(n){if(n.getOtherTarget(e.RESTYPE.KP)===t)return n.remove()})},isSet:function(){return this.get("appId")&&this.get("fingerprint")},getKPList:function(){var e,t,n,i,s;t=[],s=r.allObjects();for(n=0,i=s.length;n<i;n++)e=s[n],t.push({id:e.id,name:e.get("name"),selected:e===this,using:e.connections("KeypairUsage").length>1});return _.sortBy(t,function(e,t){if(e.name==="DefaultKP")return-1;if(t.name==="DefaultKP")return 1;if(e.name>t.name)return 1;if(e.name===t.name)return 0;if(e.name<t.name)return-1})},serialize:function(){return{component:{name:this.get("name"),type:this.type,uid:this.id,resource:{KeyFingerprint:this.get("fingerprint")||"",KeyName:this.get("appId")}}}}},{getDefaultKP:function(){return _.find(r.allObjects(),function(e){return e.get("name")==="DefaultKP"})},setDefaultKP:function(e,t){var n;return n=_.find(r.allObjects(),function(e){return e.get("name")==="DefaultKP"}),n.set("appId",e||""),n.set("fingerprint",t||""),n.set("isSet",!0)},handleTypes:e.RESTYPE.KP,deserialize:function(e,t,n){return new r({id:e.uid,name:e.name,appId:e.resource.KeyName,fingerprint:e.resource.KeyFingerprint}),null}}),r})}.call(this),function(){define("workspaces/editor/framework/connection/Route",["constant","../ConnectionModel"],function(e,t){var n;return n=t.extend({type:"RTB_Route",defaults:function(){return{routes:[]}},initialize:function(t,n){var r;return r=this.getTarget(e.RESTYPE.IGW),r&&!t.routes&&this.get("routes").push("0.0.0.0/0"),null},addRoute:function(e){var t,n;return n=this.get("routes"),t=_.indexOf(n,e),t!==-1?!1:(n.push(e),this.set("routes",n),!0)},removeRoute:function(e){var t,n;return n=this.get("routes"),t=_.indexOf(n,e),t!==-1?!1:(n.splice(t,1),this.set("routes",n),!0)},setPropagate:function(e){return void 0,this.set("propagate",e)},serialize:function(t){var n,r,i,s,o,u,a,f,l,c;u=this.getTarget(e.RESTYPE.RT),i=this.getOtherTarget(u),a=t[u.id],this.get("propagate")&&a.resource.PropagatingVgwSet.push(i.createRef("VpnGatewayId")),o={Origin:"",InstanceId:"",NetworkInterfaceId:"",GatewayId:""},n=e.RESTYPE;switch(i.type){case n.ENI:o.NetworkInterfaceId=i.createRef("NetworkInterfaceId");break;case n.IGW:o.GatewayId=i.createRef("InternetGatewayId");break;case n.VGW:o.GatewayId=i.createRef("VpnGatewayId");break;case n.INSTANCE:o.NetworkInterfaceId=i.getEmbedEni().createRef("NetworkInterfaceId")}c=this.get("routes");for(f=0,l=c.length;f<l;f++)s=c[f],r={DestinationCidrBlock:s},a.resource.RouteSet.push($.extend(r,o));return null},portDefs:[{port1:{name:"igw-tgt",type:e.RESTYPE.IGW},port2:{name:"rtb-tgt",type:e.RESTYPE.RT}},{port1:{name:"instance-rtb",type:e.RESTYPE.INSTANCE},port2:{name:"rtb-tgt",type:e.RESTYPE.RT}},{port1:{name:"eni-rtb",type:e.RESTYPE.ENI},port2:{name:"rtb-tgt",type:e.RESTYPE.RT}},{port1:{name:"vgw-tgt",type:e.RESTYPE.VGW},port2:{name:"rtb-tgt",type:e.RESTYPE.RT}}]},{isConnectable:function(t,n){var r;return t.type===e.RESTYPE.INSTANCE?r=t:n.type===e.RESTYPE.INSTANCE&&(r=n),r&&r.get("count")>1?!1:!0}}),n})}.call(this),function(){define("workspaces/editor/framework/connection/RtbAsso",["constant","../ConnectionModel"],function(e,t){var n;return n=t.extend({type:"RTB_Asso",oneToMany:e.RESTYPE.RT,defaults:{implicit:!1},portDefs:{port1:{name:"subnet-assoc-out",type:e.RESTYPE.SUBNET},port2:{name:"rtb-src",type:e.RESTYPE.RT}},serialize:function(t){var n,r,i;if(this.get("implicit"))return;return i=this.getTarget(e.RESTYPE.SUBNET),n=this.getTarget(e.RESTYPE.RT),r=t[n.id],r.resource.AssociationSet.push({SubnetId:i.createRef("SubnetId"),RouteTableAssociationId:this.get("assoId")||"",Main:!1}),null},remove:function(){var r,i,s,o,u;o=this.getTarget(e.RESTYPE.SUBNET);if(!o.isRemoved()){u=o.connections("RTB_Asso");if(u.length===0||u.length===1&&u[0]===this){s=this.getTarget(e.RESTYPE.RT);if(s.get("main")){this.set("implicit",!0);return}t.prototype.remove.apply(this,arguments),r=Design.modelClassForType(e.RESTYPE.RT),i=r.getMainRouteTable(),new n(o,i,{implicit:!0});return}}return t.prototype.remove.apply(this,arguments),null}}),n})}.call(this),function(){define("workspaces/editor/framework/resource/RtbModel",["../ComplexResModel","Design","../connection/Route","../connection/RtbAsso","./VpcModel","constant","i18n!/nls/lang.js"],function(e,t,n,r,i,s,o){var u;return u=e.extend({defaults:{main:!1,implicit:!1},type:s.RESTYPE.RT,newNameTmpl:"RT-",isRemovable:function(){return this.get("main")?{error:sprintf(o.ide.CVS_MSG_ERR_DEL_MAIN_RT,this.get("name"))}:!0},setMain:function(){var e,n,i,o,a,f;if(this.get("main"))return;u.getMainRouteTable().set("main",!1),this.set("main",!0),i=t.modelClassForType(s.RESTYPE.SUBNET).allObjects(),f=[];for(o=0,a=i.length;o<a;o++)n=i[o],e=n.connections("RTB_Asso")[0],void 0,e.get("implicit")?f.push(new r(this,n,{implicit:!0})):f.push(void 0);return f},addRoute:function(e,r,i){var o,u;o=t.instance().component(e);if(!o)return;return o.type===s.RESTYPE.ENI&&o.embedInstance()&&(o=o.embedInstance()),u=new n(this,o),u.addRoute(r),i!==void 0&&u.setPropagate(i),null},serialize:function(){var e;return e={name:this.get("name"),type:this.type,uid:this.id,resource:{PropagatingVgwSet:[],RouteTableId:this.get("appId"),VpcId:this.parent().createRef("VpcId"),AssociationSet:[],RouteSet:[{Origin:"CreateRouteTable",DestinationCidrBlock:this.parent().get("cidr"),InstanceId:"",NetworkInterfaceId:"",GatewayId:"local"}]}},this.get("main")&&e.resource.AssociationSet.push({Main:"true",RouteTableAssociationId:"",SubnetId:""}),{component:e,layout:this.generateLayout()}}},{getMainRouteTable:function(){return _.find(u.allObjects(),function(e){return e.get("main")})},handleTypes:s.RESTYPE.RT,resolveFirst:!0,preDeserialize:function(e,t){var n,r,i,s,o,a,f,l,c;if(e.resource.AssociationSet){i=-1,c=e.resource.AssociationSet;for(s=f=0,l=c.length;f<l;s=++f)r=c[s],r.Main&&i===-1&&(i=s);i>0&&(o=e.resource.AssociationSet.splice(i,1),e.resource.AssociationSet.splice(0,0,o[0])),e.resource.AssociationSet[0]&&(n=""+e.resource.AssociationSet[0].Main=="true")}return a=new u({id:e.uid,appId:e.resource.RouteTableId,name:e.name,main:!!n,x:t.coordinate[0],y:t.coordinate[1]}),null},deserialize:function(e,t,n){var r,s;return r=n(e.uid),s=n(t.groupUId),s||(s=i.theVPC()),s.addChild(r),null},postDeserialize:function(e,n){var i,s,o,u,a,f,l,c,h,p,d,v,m,g;i=t.instance(),c=i.component(e.uid),m=e.resource.AssociationSet||[];for(h=0,d=m.length;h<d;h++)a=m[h],!a.Main&&a.SubnetId&&new r(c,i.component(MC.extractID(a.SubnetId)),{implicit:!1,assoId:a.RouteTableAssociationId});l=e.resource.RouteSet;if(l&&l.length>1){u={},g=e.resource.PropagatingVgwSet||[];for(p=0,v=g.length;p<v;p++)f=g[p],u[MC.extractID(f)]=!0;s=0;while(s<l.length)a=l[s],a.GatewayId!=="local"&&(o=MC.extractID(a.GatewayId||a.InstanceId||a.NetworkInterfaceId),c.addRoute(o,a.DestinationCidrBlock,u[o])),++s}return null}}),u})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/editor/framework/resource/SubnetModel",["constant","Design","../GroupModel","../connection/RtbAsso","i18n!/nls/lang.js"],function(t,n,r,i,s){var o;return o=r.extend({type:t.RESTYPE.SUBNET,newNameTmpl:"subnet",defaults:{cidr:""},initialize:function(e,r){var s,o,u,a;return this.attributes.cidr||(this.attributes.cidr=this.generateCidr()),u=n.modelClassForType(t.RESTYPE.RT),new i(this,u.getMainRouteTable(),{implicit:!0}),s=n.modelClassForType(t.RESTYPE.ACL),a=s.getDefaultAcl(),a&&(o=n.modelClassForType("AclAsso"),new o(this,a)),null},setCidr:function(e){var t;return t=MC.getValidCIDR(e),this.set("cidr",t),null},setAcl:function(e){var t;return t=n.modelClassForType("AclAsso"),new t(this,n.instance().component(e)),null},isReparentable:function(e){var n,r,i,o,u,a,f,l;f=this.children();for(i=0,u=f.length;i<u;i++){r=f[i];if(r.type===t.RESTYPE.INSTANCE||r.type===t.RESTYPE.ENI){l=r.connectionTargets("EniAttachment");for(o=0,a=l.length;o<a;o++){n=l[o];if(n.parent()!==this)return s.ide.CVS_MSG_ERR_MOVE_ATTACHED_ENI}}if(r.type===t.RESTYPE.ASG||r.type==="ExpandedAsg"){r.type==="ExpandedAsg"&&(r=r.get("originalAsg"));if(r.getExpandAzs().indexOf(e)!==-1)return sprintf(s.ide.CVS_MSG_ERR_DROP_ASG,r.get("name"),e.get("name"))}}return!0},isRemovable:function(){var e,t,n,r,i,o,u,a,f,l,c;n=this.parent(),e=this.connectionTargets("SubnetgAsso");if(e.length>0)return{error:sprintf(s.ide.RDS_MSG_ERR_REMOVE_SUBNET_FAILED_CAUSEDBY_USEDBY_SBG,this.get("name"),e[0].get("name"))};l=this.connections("ElbSubnetAsso");for(o=0,a=l.length;o<a;o++){i=l[o];if(i.isRemovable()!==!0){if(!this.design().modeIsStack())return{error:s.ide.CVS_MSG_ERR_DEL_LINKED_ELB};c=i.getOtherTarget(this).connectionTargets("ElbAmiAsso");for(u=0,f=c.length;u<f;u++){t=c[u];if(t.parent()===this||t.parent().parent()===this)continue;r=t.parent();while(r){if(r===n)return{error:s.ide.CVS_MSG_ERR_DEL_LINKED_ELB};r=r.parent()}}}}return!0},onParentChanged:function(){var e,n,r,i,s;e=this.connections("ElbSubnetAsso")[0];if(!e)return;s=e.getTarget(t.RESTYPE.ELB).connectionTargets("ElbSubnetAsso");for(r=0,i=s.length;r<i;r++){n=s[r];if(n.parent()===this.parent()){e.remove();return}}return null},isValidCidr:function(e){return o.isInVPCCIDR(this.parent().parent().get("cidr"),e)?this.isCidrConfilctWithSubnets(e)?{error:""+e+" conflicts with other subnet.",detail:"Please choose a CIDR block not conflicting with existing subnet."}:this.getAvailableIPCountInSubnet(e)<=0?{error:""+e+" has not enough IP for the ENIs in this subnet."}:!0:{error:""+e+" conflicts with VPC CIDR.",detail:"Subnet CIDR block should be a subset of VPC's."}},isCidrConfilctWithSubnets:function(e){var t,n,r,i,s;e=e||this.get("cidr"),s=o.allObjects();for(r=0,i=s.length;r<i;r++){n=s[r];if(n!==this){t=o.isCidrConflict(n.get("cidr"),e);if(t)return!0}}return!1},getAvailableIPCountInSubnet:function(e){var r,i,s,o,u,a,f;e=e||this.get("cidr"),s=0,f=this.children();for(u=0,a=f.length;u<a;u++){r=f[u];if(r.type===t.RESTYPE.INSTANCE)i=r.getEmbedEni();else{if(r.type!==t.RESTYPE.ENI)continue;i=r}s+=i.get("ips").length*i.serverGroupCount()}return o=n.modelClassForType(t.RESTYPE.ENI).getAvailableIPCountInCIDR(e),o-s},generateCidr:function(){var e,t,n,r,i,s,u,a,f,l,c,h,p,d,v,m,g;n=this.parent().parent().get("cidr"),c=n.split("/"),h=c[0],p=h.split("."),d=Number(c[1]);if(d!==16)return"";r=-1,g=o.allObjects();for(v=0,m=g.length;v<m;v++)e=g[v],s=e.get("cidr"),u=s.split("/"),f=u[0],l=Number(u[1]),a=f.split("."),t=Number(a[2]),r<t&&(r=t);return i=r+1,i>255?"":(p[2]=String(i),p.join(".")+"/24")},serialize:function(){var e;return e={name:this.get("name"),type:this.type,uid:this.id,resource:{AvailabilityZone:this.parent().createRef(),VpcId:this.parent().parent().createRef("VpcId"),SubnetId:this.get("appId"),CidrBlock:this.get("cidr")}},{component:e,layout:this.generateLayout()}}},{handleTypes:t.RESTYPE.SUBNET,genCIDRPrefixSuffix:function(e){var t,n,r,i,s,o;return t=e.split("/"),n=t[0],o=Number(t[1]),r=n.split("."),i="",s="",o>23?(i=r[0]+"."+r[1]+"."+r[2]+".",s="x"):(i=r[0]+"."+r[1]+".",s="x.x"),[i,s]},isIPInSubnet:function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;return u=!0,h=n.split("/"),v=Number(h[1]),c=h[0].split("."),p=MC.getCidrBinStr(h[0]),d=p.slice(0,v),i=MC.getCidrBinStr(t),s=i.slice(0,v),o=i.slice(v),m=32-v,b=_.map(function(){C=[];for(var e=1,t=m+1;1<=t?e<t:e>t;1<=t?e++:e--)C.push(e);return C}.apply(this),function(){return"0"}),w=b.join(""),g=w.replace(/0/g,"1"),E=parseInt(w,2),y=parseInt(g,2),a=function(){k=[];for(var e=E,t=y+1;E<=t?e<t:e>t;E<=t?e++:e--)k.push(e);return k}.apply(this),f=a.length,l=!1,r=[],_.each(a,function(e,t){var n;return n=MC.leftPadString(e.toString(2),m,"0"),(t===0||t===1||t===2||t===3||t===f-1)&&r.push(n),null}),e.call(r,o)>=0?{isValid:!1,isReserved:!0}:(u=d===s,{isValid:u,isReserved:!1})},isCidrConflict:function(e,t){var n,r,i,s,o;return n=MC.getCidrBinStr(e),i=MC.getCidrBinStr(t),r=Number(e.split("/")[1]),s=Number(t.split("/")[1]),r===0&&r===s?!0:(o=r,r>s&&(o=s),n.slice(0,o)===i.slice(0,o)&&o!==0?!0:!1)},isInVPCCIDR:function(e,t){return this.isCidrConflict(e,t)?Number(t.split("/")[1])>=Number(e.split("/")[1]):!1},isValidSubnetCIDR:function(e){var t,n,r,i;return t=MC.getCidrBinStr(e),n=Number(e.split("/")[1]),r=t.slice(n),i=parseInt(r),i===0||r===""?!0:!1},autoAssignAllCIDR:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;i=Math.ceil(Math.log(t)/Math.log(2)),p=Number(e.split("/")[1]),h=MC.getCidrBinStr(e),c=h.slice(0,p),l=p+i,u=[],r=0;while(r<t)n=MC.leftPadString(r.toString(2),i,"0"),a=MC.rightPadString(c+n,32,"0"),s=_.map([0,8,16,24],function(e){return parseInt(a.slice(e,e+8),2)}),o=s.join("."),f=o+"/"+l,u.push(f),++r;return u},autoAssignSimpleCIDR:function(e,t,n){var r,i,s,o,u,a,f,l,c;r=[],s=e.split("/"),o=s[0],u=Number(s[1]),c=o.split("."),i=Number(n.split("/")[1]);if(u===16||u===24&&i===u)a=c[0],f=c[1],l=c[2],_.each(t,function(e){var t,n,i,s,o;return n=e.split("/"),i=n[0],s=Number(n[1]),o=i.split("."),o[0]=a,o[1]=f,u===24&&(o[2]=l),t=o.join(".")+"/"+s,r.push(t),null});return r},deserialize:function(e,t,n){return new o({id:e.uid,name:e.name,appId:e.resource.SubnetId,cidr:e.resource.CidrBlock,x:t.coordinate[0],y:t.coordinate[1],width:t.size[0],height:t.size[1],parent:n(t.groupUId)}),null}}),o})}.call(this),function(){define("workspaces/editor/framework/resource/IgwModel",["../ComplexResModel","./VpcModel","Design","constant","i18n!/nls/lang.js"],function(e,t,n,r,i){var s;return s=e.extend({defaults:{name:"Internet-gateway"},type:r.RESTYPE.IGW,isRemovable:function(){var e,t,s,o;return e=n.modelClassForType(r.RESTYPE.ELB),o=e.allObjects().some(function(e){return!e.get("internal")}),o||(t=n.modelClassForType(r.RESTYPE.ENI),o=t.allObjects().some(function(e){return e.hasEip()||e.get("assoPublicIp")})),o||(s=n.modelClassForType(r.RESTYPE.LC),o=s.allObjects().some(function(e){return e.get("publicIp")})),o?{error:i.ide.CVS_CFM_DEL_IGW}:!0},serialize:function(){var e;return e={name:this.get("name"),type:this.type,uid:this.id,resource:{InternetGatewayId:this.get("appId"),AttachmentSet:[{VpcId:this.parent().createRef("VpcId")}]}},{component:e,layout:this.generateLayout()}}},{tryCreateIgw:function(){var e;if(s.allObjects().length>0)return;return notification("info",i.ide.CVS_CFM_ADD_IGW_MSG),e=n.modelClassForType(r.RESTYPE.VPC).theVPC(),new s({x:-1,y:-1,parent:e}),null},handleTypes:r.RESTYPE.IGW,deserialize:function(e,t,n){return new s({id:e.uid,name:e.name,appId:e.resource.InternetGatewayId,parent:n(t.groupUId),x:t.coordinate[0],y:t.coordinate[1]})}}),s})}.call(this),function(){define("workspaces/editor/framework/resource/VgwModel",["../ComplexResModel","./VpcModel","Design","constant"],function(e,t,n,r){var i;return i=e.extend({defaults:{name:"VPN-gateway"},type:r.RESTYPE.VGW,serialize:function(){var e;return e={name:this.get("name"),type:this.type,uid:this.id,resource:{Type:"ipsec.1",VpnGatewayId:this.get("appId"),Attachments:[{VpcId:this.parent().createRef("VpcId")}]}},{component:e,layout:this.generateLayout()}}},{handleTypes:r.RESTYPE.VGW,deserialize:function(e,t,n){return new i({id:e.uid,name:e.name,appId:e.resource.VpnGatewayId,parent:n(t.groupUId),x:t.coordinate[0],y:t.coordinate[1]}),null}}),i})}.call(this),function(){define("workspaces/editor/framework/resource/SnsModel",["../ResourceModel","../ComplexResModel","constant","../ConnectionModel"],function(e,t,n,r){var i,s;return s=r.extend({type:"TopicUsage",oneToMany:n.RESTYPE.TOPIC}),i=t.extend({type:n.RESTYPE.TOPIC,isVisual:function(){return!1},serialize:function(){var e;e=!!this.connections().length;if(!e){void 0;return}return{component:{name:this.get("name"),type:this.type,uid:this.id,resource:{TopicArn:this.get("appId")}}}},assignTo:function(e){if(this.get("appId"))return new s(this,e)}},{handleTypes:n.RESTYPE.TOPIC,resolveFirst:!0,isTopicNeeded:function(){var e,t,r,i,s,o,u,a,f,l;e=Design.modelClassForType(n.RESTYPE.SP),f=e.allObjects();for(s=0,u=f.length;s<u;s++){r=f[s];if(r.get("sendNotification")){i=!0;break}}if(!i){l=Design.modelClassForType(n.RESTYPE.NC).allObjects();for(o=0,a=l.length;o<a;o++){t=l[o];if(t.isUsed()){i=!0;break}}}return i},ensureExistence:function(){return this.allObjects().length===0&&new i,this.allObjects()[0]},get:function(e,t){var n;return n=_.first(_.filter(this.allObjects(),function(t){return t.get("appId")===e})),n||new i({appId:e,name:t})},preDeserialize:function(e,t){return new i({id:e.uid,appId:e.resource.TopicArn,name:e.resource.Name||e.name}),null},deserialize:function(){return null}}),null})}.call(this),function(){define("workspaces/editor/framework/resource/StorageModel",["Design","../ResourceModel"],function(e,t){var n;return n=t.extend({type:"AWS.Tag",serialize:function(){return{component:$.extend(!0,{},this.get("data"))}}},{handleTypes:["AWS.EC2.Tag","AWS.AutoScaling.Tag"],deserialize:function(e){return new n({id:e.uid,data:e}),null}}),n})}.call(this),function(){define("workspaces/editor/framework/resource/ScalingPolicyModel",["../ResourceModel","../ComplexResModel","constant"],function(e,t,n){var r;return r=t.extend({type:n.RESTYPE.SP,defaults:function(){return{cooldown:"",minAdjustStep:"",adjustment:"-1",adjustmentType:"ChangeInCapacity",state:"ALARM",sendNotification:!1,alarmData:{id:MC.guid(),alarmName:"",namespace:"AWS/AutoScaling",metricName:"CPUUtilization",comparisonOperator:">=",evaluationPeriods:"2",period:"300",statistic:"Average",threshold:"10",unit:"",appId:""}}},isVisual:function(){return!1},constructor:function(t,n){var r;return r=this.defaults(),t.alarmData=$.extend(r.alarmData,t.alarmData),e.call(this,t,n)},setAlarm:function(e){return this.set("alarmData",$.extend({id:this.attributes.alarmData.id,namespace:"AWS/AutoScaling",unit:"",appId:this.attributes.alarmData.appId,alarmName:this.attributes.alarmData.alarmName},e)),null},isNotificate:function(){return this.get("sendNotification")},getCost:function(e,t){var n,r,i,s,o,u,a,f;n=this.get("alarmData"),o=parseInt(n.period,10);if(o<=300&&n.namespace==="AWS/AutoScaling"){f=e.cloudwatch.types;for(u=0,a=f.length;u<a;u++){s=f[u];if(s.ec2Monitoring){i=parseFloat(s.ec2Monitoring[t],10)||0;break}}return i&&this.__asg?(r=Design.instance().modeIsStack()?this.__asg.get("minSize"):this.__asg.get("capacity"),i=Math.round(i/7*1e3)/1e3,{resource:this.get("name")+"-alarm",type:"CloudWatch",fee:i,formatedFee:i+"/mo"}):null}return null},setTopic:function(e,t){var r;return r=Design.modelClassForType(n.RESTYPE.TOPIC),r.get(e,t).assignTo(this)},removeTopic:function(){var e;return(e=this.connections("TopicUsage")[0])!=null?e.remove():void 0},getTopic:function(){return this.connectionTargets("TopicUsage")[0]},getTopicName:function(){var e;return(e=this.getTopic())!=null?e.get("name"):void 0},serialize:function(){var e,t,r,i,s,o,u,a;if(!this.__asg){void 0;return}return u={name:this.get("name"),type:this.type,uid:this.id,resource:{ScalingAdjustment:this.get("adjustment"),PolicyName:this.get("name"),PolicyARN:this.get("appId"),Cooldown:this.get("cooldown"),AutoScalingGroupName:this.__asg.createRef("AutoScalingGroupName"),AdjustmentType:this.get("adjustmentType"),MinAdjustmentStep:this.get("adjustmentType")==="PercentChangeInCapacity"?this.get("minAdjustStep"):""}},o=this.get("alarmData"),e=t=r=[],i=[this.createRef("PolicyARN")],this.get("sendNotification")&&(a=this.getTopic(),a&&i.push(a.createRef("TopicArn"))),this.get("state")==="ALARM"?e=i:this.get("state")==="INSUFFICIANT_DATA"?t=i:r=i,s={name:this.get("name")+"-alarm",type:n.RESTYPE.CW,uid:o.id,resource:{AlarmArn:o.appId,AlarmName:o.alarmName||this.get("name")+"-alarm",ComparisonOperator:o.comparisonOperator,EvaluationPeriods:o.evaluationPeriods,MetricName:o.metricName,Namespace:o.namespace,Period:Math.round(o.period/60)*60,Statistic:o.statistic,Threshold:o.threshold,Unit:o.unit,Dimensions:[{name:"AutoScalingGroupName",value:this.__asg.createRef("AutoScalingGroupName")}],AlarmActions:e,InsufficientDataActions:t,OKAction:r}},[{component:u},{component:s}]}},{handleTypes:[n.RESTYPE.SP,n.RESTYPE.CW],deserialize:function(e,t,i){var s,o,u,a,f,l,c,h,p,d;if(e.type===n.RESTYPE.CW){s={id:e.uid,name:e.name,alarmName:e.resource.AlarmName,appId:e.resource.AlarmArn,comparisonOperator:e.resource.ComparisonOperator,evaluationPeriods:e.resource.EvaluationPeriods,metricName:e.resource.MetricName,period:e.resource.Period,statistic:e.resource.Statistic,threshold:e.resource.Threshold,namespace:e.resource.Namespace,unit:e.resource.Unit},f=[],e.resource.AlarmActions.length&&(c="ALARM",f.push(e.resource.AlarmActions[0]),f.push(e.resource.AlarmActions[1])),e.resource.OKAction.length&&(c="OK",f.push(e.resource.OKAction[0]),f.push(e.resource.OKAction[1])),e.resource.InsufficientDataActions.length&&(c="INSUFFICIANT_DATA",f.push(e.resource.InsufficientDataActions[0]),f.push(e.resource.InsufficientDataActions[1])),l=!1;for(p=0,d=f.length;p<d;p++){u=f[p];if(!u)continue;u.indexOf("PolicyARN")!==-1?a=i(MC.extractID(u))||new Backbone.Model:u.indexOf("TopicArn")!==-1&&(h=i(MC.extractID(u)),l=!0)}h!=null&&h.assignTo(a),a&&a.set({alarmData:s,sendNotification:l,state:c})}else a=new r({id:e.uid,name:e.resource.PolicyName||e.name,appId:e.resource.PolicyARN,cooldown:e.resource.Cooldown,minAdjustStep:e.resource.MinAdjustmentStep,adjustment:e.resource.ScalingAdjustment,adjustmentType:e.resource.AdjustmentType}),o=i(MC.extractID(e.resource.AutoScalingGroupName)),o&&o.addScalingPolicy(a);return null}}),r})}.call(this),function(){define("workspaces/editor/framework/resource/DBSbgModel",["constant","../GroupModel","../ConnectionModel"],function(e,t,n){var r,i;return i=n.extend({type:"SubnetgAsso"}),r=t.extend({type:e.RESTYPE.DBSBG,newNameTmpl:"subnet-group",defaults:{x:2,y:2,width:17,height:17,createdBy:""},constructor:function(n,r){var i,s,o,u,a,f;if(r&&r.createByUser){s=Design.instance(),i={},f=s.componentsOfType(e.RESTYPE.SUBNET);for(u=0,a=f.length;u<a;u++)o=f[u],i[o.parent().get("name")]=!0;if(_.keys(i).length<2)return this}return t.apply(this,arguments)},initialize:function(e,t){return this.get("description")||this.set("description",""+this.get("name")+" default description"),null},serialize:function(){var e,t;return t=_.map(this.connectionTargets("SubnetgAsso"),function(e){return e.createRef("SubnetId")}),e={name:this.get("name"),type:this.type,uid:this.id,resource:{CreatedBy:this.get("createdBy"),DBSubnetGroupName:this.get("appId"),SubnetIds:t,DBSubnetGroupDescription:this.get("description")}},{component:e,layout:this.generateLayout()}}},{handleTypes:e.RESTYPE.DBSBG,deserialize:function(e,t,n){var s,o,u,a,f;s=new r({id:e.uid,name:e.name||e.resource.DBSubnetGroupName,appId:e.resource.DBSubnetGroupName,createdBy:e.resource.CreatedBy,description:e.resource.DBSubnetGroupDescription,x:t.coordinate[0],y:t.coordinate[1],width:t.size[0],height:t.size[1],parent:n(t.groupUId)}),f=e.resource.SubnetIds||[];for(u=0,a=f.length;u<a;u++)o=f[u],new i(s,n(MC.extractID(o)));return null}}),r})}.call(this),function(){define("workspaces/editor/framework/resource/DBOgModel",["../ComplexResModel","Design","constant"],function(e,t,n){var r;return r=e.extend({newNameTmpl:"-og-",type:n.RESTYPE.DBOG,isDefault:function(){return!!this.get("default")},isVisual:function(){return!1},initialize:function(e,t){var n,r;if(this.isDefault())return;return this.get("description")||(r=this.engineType(),n=this.get("engineVersion").replace(/\./g,"-"),this.set("name",r+n+this.get("name")),this.set("description","custom option group for "+this.get("engineName")+" "+this.get("engineVersion"))),null},defaults:function(){return{engineName:"",engineVersion:"",options:[],applyImmediately:!0}},engineType:function(){var e;e=this.get("engineName");switch(!1){case e!=="mysql":return"mysql";case e!=="postgresql":return"postgresql";case e!=="oracle-ee"&&e!=="oracle-se"&&e!=="oracle-se1":return"oracle";case e!=="sqlserver-ee"&&e!=="sqlserver-ex"&&e!=="sqlserver-se"&&e!=="sqlserver-web":return"sqlserver"}},remove:function(){return _.invoke(this.connectionTargets("OgUsage"),"setDefaultOptionGroup"),e.prototype.remove.apply(this,arguments)},createRef:function(){return this.isDefault()?this.get("name"):e.prototype.createRef.apply(this,arguments)},serialize:function(e){var r,i;if(this.isDefault())return;return i=t.modelClassForType(n.RESTYPE.VPC).theVPC(),r={name:this.get("name"),type:this.type,uid:this.id,resource:{CreatedBy:this.get("createdBy")||"",EngineName:this.get("engineName"),MajorEngineVersion:this.get("engineVersion"),OptionGroupDescription:this.get("description"),OptionGroupName:this.get("appId")||"",Options:this.get("options"),ApplyImmediately:this.get("applyImmediately"),VpcId:this.getVpcRef()}},{component:r}}},{handleTypes:n.RESTYPE.DBOG,deserialize:function(e,t,n){return new r({id:e.uid,name:e.name,appId:e.resource.OptionGroupName,createdBy:e.resource.CreatedBy,engineName:e.resource.EngineName,engineVersion:e.resource.MajorEngineVersion,options:e.resource.Options,description:e.resource.OptionGroupDescription,applyImmediately:e.resource.ApplyImmediately})}}),r})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/editor/framework/resource/DBInstanceModel",["../ComplexResModel","../ConnectionModel","./DBOgModel","Design","constant","i18n!/nls/lang.js","CloudResources"],function(t,n,r,i,s,o,u){var a,f;return f=n.extend({type:"OgUsage",oneToMany:s.RESTYPE.DBOG}),a=t.extend({defaults:{newInstanceId:"",instanceId:"",snapshotId:"",createdBy:"",accessible:!1,username:"root",password:"12345678",multiAz:!0,iops:0,autoMinorVersionUpgrade:!0,allowMajorVersionUpgrade:"",backupRetentionPeriod:1,allocatedStorage:10,backupWindow:"",maintenanceWindow:"",characterSetName:"",dbName:"",port:"",pending:"",az:"",ogName:"",pgName:"",applyImmediately:!1},type:s.RESTYPE.DBINSTANCE,newNameTmpl:"db",__cachedSpecifications:null,source:function(){return u(s.RESTYPE.DBSNAP,this.design().region()).get(this.get("snapshotId"))},slaveIndependentAttr:"id|appId|x|y|width|height|name|accessible|createdBy|instanceId|instanceClass|autoMinorVersionUpgrade|accessible|backupRetentionPeriod|multiAz|password|__connections|__parent",slaves:function(){return this.master()?[]:this.connectionTargets("DbReplication")},master:function(){var e;return e=this.connections("DbReplication")[0],e&&e.master()!==this?e.master():null},copyMaster:function(e){this.clone(e);if(!this.get("appId"))return this.set({backupRetentionPeriod:0,multiAz:!1,createdBy:"",instanceId:"",snapshotId:"",password:"****"})},setMaster:function(e){var t,n;return(n=this.connections("DbReplication")[0])!=null&&n.remove(),t=i.modelClassForType("DbReplication"),new t(e,this),this.listenTo(e,"change",this.syncMasterAttr),null},syncMasterAttr:function(e){var t,n,r,i;if(this.get("appId"))return!1;n={},i=e.changedAttributes();for(t in i)r=i[t],this.slaveIndependentAttr.indexOf(t)<0&&(n[t]=r);return n.iops&&delete n.iops,this.set(n)},needSyncMasterConn:function(t){var n,r;return this.master()?!1:(this.get("appId")?n=[]:n=["SgAsso","OgUsage"],(r=t.type,e.call(n,r)<0)?!1:!0)},connect:function(e){var t,n,r,s,o,u;if(!this.needSyncMasterConn(e))return;n=e.getOtherTarget(this),t=i.modelClassForType(e.type),u=this.slaves();for(s=0,o=u.length;s<o;s++)r=u[s],new t(r,n)},disconnect:function(e){var t,n,r,s,o,u;if(!this.needSyncMasterConn(e))return;if(e.oneToMany)return;n=e.getOtherTarget(this),t=i.modelClassForType(e.type),u=this.slaves();for(s=0,o=u.length;s<o;s++)r=u[s],(new t(r,n)).remove()},constructor:function(e,n){var r;return n&&!n.master&&n.createByUser&&e.snapshotId&&(r=this.getSnapshotModel(e.snapshotId),_.extend(e,{engine:r.get("Engine"),engineVersion:r.get("EngineVersion"),snapshotId:r.get("DBSnapshotIdentifier"),allocatedStorage:r.get("AllocatedStorage"),port:r.get("Port"),iops:r.get("Iops")||"",multiAz:r.get("MultiAZ"),ogName:r.get("OptionGroupName"),license:r.get("LicenseModel"),az:r.get("AvailabilityZone"),username:r.get("MasterUsername")})),t.call(this,e,n)},initialize:function(e,t){var n,r;t=t||{};if(t.cloneSource){this.clone(t.cloneSource);return}t.master?(this.copyMaster(t.master),this.setMaster(t.master)):t.createByUser&&(n=i.modelClassForType("SgAsso"),r=i.modelClassForType(s.RESTYPE.SG).getDefaultSg(),new n(r,this),this.set(_.defaults(e,{license:this.getDefaultLicense(),engineVersion:this.getDefaultVersion(),instanceClass:this.getDefaultInstanceClass(),port:this.getDefaultPort(),dbName:this.getDefaultDBName(),characterSetName:this.getDefaultCharSet(),allocatedStorage:this.getDefaultAllocatedStorage(),snapshotId:"",multiAz:!!e.multiAz})),this.setDefaultOptionGroup(),this.setDefaultParameterGroup())},clone:function(e){this.cloneAttributes(e,{reserve:"newInstanceId|instanceId",copyConnection:["SgAsso","OgUsage"]}),this.set("snapshotId","")},setDefaultOptionGroup:function(e){var t,n,r,o,a;return a=i.instance().region(),r=u(s.RESTYPE.DBENGINE,a),t=r.getDefaultByNameVersion(a,this.get("engine"),this.get("engineVersion")),e&&(o=r.getDefaultByNameVersion(a,this.get("engine"),e)),o&&o.family&&t&&t.family&&o.family===t.family?null:(t&&t.defaultOGName?n=t.defaultOGName:(n="default:"+this.get("engine")+"-"+this.getMajorVersion().replace(".","-"),void 0),new f(this,this.getDefaultOgInstance(n)),null)},getDefaultOgInstance:function(e){return r.findWhere({name:e,"default":!0})||new r({name:e,"default":!0})},setDefaultParameterGroup:function(e){var t,n,r,o;return o=i.instance().region(),r=u(s.RESTYPE.DBENGINE,o),t=r.getDefaultByNameVersion(o,this.get("engine"),this.get("engineVersion")),t&&t.defaultPGName?n=t.defaultPGName:(n="default."+this.get("engine")+this.getMajorVersion(),void 0),this.set("pgName",n||""),n},getAllocatedRange:function(){var e,t,n,r;n=this.get("engine"),this.isMysql()&&(r={min:5,max:3072}),this.isPostgresql()&&(r={min:5,max:3072}),this.isOracle()&&(r={min:10,max:3072});if(this.isSqlserver()){n=this.get("engine");if(n==="sqlserver-ee"||n==="sqlserver-se")r={min:200,max:1024};if(n==="sqlserver-ex"||n==="sqlserver-web")r={min:30,max:1024}}return e=this.getInstanceClassDict(),t=s.DB_DEFAULTSETTING[this.get("engine")].allocatedStorage,e&&e.ebs&&t<100&&(r.min=100),r},getLicenseObj:function(e){var t,n;return t=this.get("license"),t&&(n=_.findWhere(this.getSpecifications(),{license:t})),!n&&e&&(n=this.getSpecifications()[0]),n},getVersionObj:function(e){var t,n,r;return r=this.getLicenseObj(!0).versions,t=this.get("engineVersion"),t&&(n=_.findWhere(r,{version:t})),!n&&e&&(n=r[0]),n},getInstanceClassObj:function(e){var t,n,r,i;return r=this.getVersionObj(!0).instanceClasses,n=this.get("instanceClass"),n&&(i=_.findWhere(r,{instanceClass:n})),!i&&e&&(t="db.t1.micro",i=_.find(r,function(e){return e.instanceClass===t}),i||(i=r[0])),i},setIops:function(e){return this.set("iops",e)},getIops:function(){return this.get("iops")},getDefaultLicense:function(){return this.getLicenseObj(!0).license},getDefaultVersion:function(){return this.getVersionObj(!0).version},getDefaultInstanceClass:function(){return this.getInstanceClassObj(!0).instanceClass},getMajorVersion:function(){var e;return(e=this.get("engineVersion"))!=null?e.split(".").slice(0,2).join("."):void 0},getMinorVersion:function(){var e;return(e=this.get("engineVersion"))!=null?e.split(".").slice(2).join("."):void 0},getRdsInstances:function(){var e;return(e=App.model.getRdsData(this.design().region()))!=null?e.instance[this.get("engine")]:void 0},getDefaultPort:function(){return s.DB_DEFAULTSETTING[this.get("engine")].port},getDefaultDBName:function(){return s.DB_DEFAULTSETTING[this.get("engine")].dbname},getDefaultCharSet:function(){return s.DB_DEFAULTSETTING[this.get("engine")].charset},getInstanceClassDict:function(){return _.find(s.DB_INSTANCECLASS,function(e){return function(t){return t.instanceClass===e.get("instanceClass")}}(this))},getDefaultAllocatedStorage:function(){var e,t;return e=this.getInstanceClassDict(),t=s.DB_DEFAULTSETTING[this.get("engine")].allocatedStorage,e&&e.ebs&&t<100?100:t},getOptionGroup:function(){return this.connectionTargets("OgUsage")[0]},getOptionGroupName:function(){var e;return(e=this.getOptionGroup())!=null?e.get("name"):void 0},setOptionGroup:function(e){var t;return t=r.findWhere({name:e})||new r({name:e,"default":!0}),new f(this,t)},isMysql:function(){return this.engineType()==="mysql"},isOracle:function(){return this.engineType()==="oracle"},isSqlserver:function(){return this.engineType()==="sqlserver"},isPostgresql:function(){return this.engineType()==="postgresql"},engineType:function(){var e;return e=this.get("engine"),s.DB_ENGINTYPE[e]||e},getSpecifications:function(){var e,t,n,r,i,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;if(this.__cachedSpecifications)return this.__cachedSpecifications;h=this,u=this.getRdsInstances();if(!u)return null;l={},c=[];for(m=0,y=u.length;m<y;m++)i=u[m],l[i.LicenseModel]||(l[i.LicenseModel]={}),l[i.LicenseModel][i.EngineVersion]||(l[i.LicenseModel][i.EngineVersion]={}),l[i.LicenseModel][i.EngineVersion][i.DBInstanceClass]={multiAZCapable:i.MultiAZCapable,availabilityZones:i.AvailabilityZones};for(f in l){v=l[f],a={license:f,versions:[]};for(d in v){r=v[d],p={version:d,instanceClasses:[]},o={};for(t in r)e=r[t],o[t]={multiAZCapable:e.multiAZCapable,availabilityZones:e.availabilityZones};w=s.DB_INSTANCECLASS;for(g=0,b=w.length;g<b;g++)n=w[g],_.has(o,n.instanceClass)&&p.instanceClasses.push(_.extend(o[n.instanceClass],n));a.versions.push(p)}a.versions.sort(function(e,t){return MC.versionCompare(t.version,e.version)}),c.push(a)}return this.__cachedSpecifications=c,c},getLVIA:function(e){var t,n,r,i,s,o,u,a,f,l;if(!e)return[];n=this.get("license"),r=this.get("engineVersion"),t=this.get("instanceClass"),o=_.first(_.filter(e,function(e){return e.license===n?(e.selected=!0,!0):(delete e.selected,!1)})),a=_.first(_.filter(o.versions,function(e){return e.version===r?(e.selected=!0,!0):(delete e.selected,!1)})),a||(a=this.getVersionObj(!0),this.set("engineVersion",a.version),(f=_.findWhere(o.versions,{version:a.version}))!=null&&(f.selected=!0)),s=_.first(_.filter(a.instanceClasses,function(e){return e.instanceClass===t?(e.selected=!0,!0):(delete e.selected,!1)})),s||(s=this.getInstanceClassObj(!0),this.set("instanceClass",s.instanceClass),(l=_.where(a.instanceClasses,{instanceClass:s.instanceClass}))!=null&&(l.selected=!0)),u=s.multiAZCapable,u||this.set("multiAz",""),i=this.get("engine");if(i==="sqlserver-ee"||i==="sqlserver-se")u=!0;return[e,o.versions,a.instanceClasses,u,s.availabilityZones]},getCost:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d;if(!e.database)return null;i=this.engineType(),i==="sqlserver"&&(c=this.get("engine").split("-")[1]),n=this.attributes.instanceClass.split("."),r=this.attributes.multiAz?"multiAZ":"standard";if(!i||!r)return null;h=e.database.rds.unit;try{o=e.database.rds[i][n[0]][n[1]][n[2]],a=null,this.attributes.license==="license-included"?a="li":this.attributes.license==="bring-your-own-license"&&(a="byol"),a==="li"&&i==="sqlserver"&&(a=a+"-"+c);for(p=0,d=o.length;p<d;p++){f=o[p];if(f.deploy!==r)continue;if(a&&a!==f.license)continue;o=f[t];break}return!o||typeof o!="number"?null:(h==="pricePerHour"?(u=o+"/hr",o*=720):u=o+"/mo",l={resource:this.attributes.name,type:this.attributes.instanceClass,fee:o,formatedFee:u},l)}catch(v){s=v}finally{}},category:function(e){switch(e){case"instance":return!this.get("snapshotId")&&!this.master();case"replica":return!!this.master();case"snapshot":return!!this.get("snapshotId")}return this.get("snapshotId")?"snapshot":this.master()?"replica":"instance"},getSnapshotModel:function(e){return u(s.RESTYPE.DBSNAP,i.instance().region()).findWhere({id:e||this.get("snapshotId")})},autobackup:function(e){if(e!==void 0){this.set("backupRetentionPeriod",e);return}return this.get("backupRetentionPeriod")||0},getNewName:function(){var e;return e=[].slice.call(arguments,0),e[0]=a.getInstances().length,t.prototype.getNewName.apply(this,e)},isRemovable:function(){var e;return this.slaves().length>0?(this.get("appId")?(e=sprintf(o.ide.CVS_CFM_DEL_EXISTENT_DBINSTANCE,this.get("name")),e="<div class='modal-text-major'>"+e+"</div>"):(e=sprintf(o.ide.CVS_CFM_DEL_NONEXISTENT_DBINSTANCE,this.get("name")),e="<div class='modal-text-major'>"+e+"</div>"),e):!0},remove:function(){var e,n,r,i;i=this.slaves();for(n=0,r=i.length;n<r;n++)e=i[n],e.get("appId")||e.remove();return t.prototype.remove.call(this),null},serialize:function(){var e,t,n;return t=this.master(),e={name:this.get("name"),type:this.type,uid:this.id,resource:{CreatedBy:this.get("createdBy"),DBInstanceIdentifier:this.get("instanceId"),NewDBInstanceIdentifier:this.get("newInstanceId"),DBSnapshotIdentifier:this.get("snapshotId"),AllocatedStorage:this.get("allocatedStorage"),AutoMinorVersionUpgrade:this.get("autoMinorVersionUpgrade"),AllowMajorVersionUpgrade:this.get("allowMajorVersionUpgrade"),AvailabilityZone:this.get("az"),MultiAZ:this.get("multiAz"),Iops:this.getIops(),BackupRetentionPeriod:this.get("backupRetentionPeriod"),CharacterSetName:this.get("characterSetName"),DBInstanceClass:this.get("instanceClass"),DBName:this.get("dbName"),Endpoint:{Port:this.get("port")},Engine:this.get("engine"),EngineVersion:this.get("engineVersion"),LicenseModel:this.get("license"),MasterUsername:this.get("username"),MasterUserPassword:this.get("password"),OptionGroupMembership:{OptionGroupName:(n=this.connectionTargets("OgUsage")[0])!=null?n.createRef("OptionGroupName"):void 0},DBParameterGroups:{DBParameterGroupName:this.get("pgName")},ApplyImmediately:this.get("applyImmediately"),PendingModifiedValues:this.get("pending"),PreferredBackupWindow:this.get("backupWindow"),PreferredMaintenanceWindow:this.get("maintenanceWindow"),PubliclyAccessible:this.get("accessible"),DBSubnetGroup:{DBSubnetGroupName:this.parent().createRef("DBSubnetGroupName")},VpcSecurityGroupIds:_.map(this.connectionTargets("SgAsso"),function(e){return e.createRef("GroupId")}),ReadReplicaSourceDBInstanceIdentifier:(t!=null?t.createRef("DBInstanceIdentifier"):void 0)||""}},{component:e,layout:this.generateLayout()}}},{handleTypes:s.RESTYPE.DBINSTANCE,oracleCharset:["AL32UTF8","JA16EUC","JA16EUCTILDE","JA16SJIS","JA16SJISTILDE","KO16MSWIN949","TH8TISASCII","VN8MSWIN1258","ZHS16GBK","ZHT16HKSCS","ZHT16MSWIN950","ZHT32EUC","BLT8ISO8859P13","BLT8MSWIN1257","CL8ISO8859P5","CL8MSWIN1251","EE8ISO8859P2","EL8ISO8859P7","EL8MSWIN1253","EE8MSWIN1250","NE8ISO8859P10","NEE8ISO8859P4","WE8ISO8859P15","WE8MSWIN1252","AR8ISO8859P6","AR8MSWIN1256","IW8ISO8859P8","IW8MSWIN1255","TR8MSWIN1254","WE8ISO8859P9","US7ASCII","UTF8","WE8ISO8859P1"],getInstances:function(){return this.reject(function(e){return e.master()||e.get("snapshotId")})},getReplicas:function(){return this.filter(function(e){return!!e.master()})},getSnapShots:function(){return this.filter(function(e){return!!e.get("snapshotId")})},getDefaultOgInstance:function(e){return r.findWhere({name:e,"default":!0})||new r({name:e,"default":!0})},deserialize:function(e,t,n){var r,s,o,u,l,c,h,p,d,v,m,g,y;h=this,l=e.resource,s=new a({id:e.uid,name:e.name,createdBy:l.CreatedBy,appId:l.DBInstanceIdentifier,instanceId:l.DBInstanceIdentifier,newInstanceId:l.NewDBInstanceIdentifier,snapshotId:l.DBSnapshotIdentifier,allocatedStorage:l.AllocatedStorage,autoMinorVersionUpgrade:l.AutoMinorVersionUpgrade,allowMajorVersionUpgrade:l.AllowMajorVersionUpgrade,az:l.AvailabilityZone,multiAz:l.MultiAZ,iops:l.Iops,backupRetentionPeriod:l.BackupRetentionPeriod,characterSetName:l.CharacterSetName,dbName:l.DBName,port:(v=l.Endpoint)!=null?v.Port:void 0,engine:l.Engine,license:l.LicenseModel,engineVersion:l.EngineVersion,instanceClass:l.DBInstanceClass,username:l.MasterUsername,password:l.MasterUserPassword,pending:l.PendingModifiedValues,backupWindow:l.PreferredBackupWindow,maintenanceWindow:l.PreferredMaintenanceWindow,accessible:l.PubliclyAccessible,pgName:(m=l.DBParameterGroups)!=null?m.DBParameterGroupName:void 0,applyImmediately:l.ApplyImmediately,x:t.coordinate[0],y:t.coordinate[1],parent:n(t.groupUId)}),e.resource.ReadReplicaSourceDBInstanceIdentifier&&s.setMaster(n(MC.extractID(e.resource.ReadReplicaSourceDBInstanceIdentifier))),r=i.modelClassForType("SgAsso"),g=e.resource.VpcSecurityGroupIds||[];for(p=0,d=g.length;p<d;p++)c=g[p],new r(s,n(MC.extractID(c)));u=(y=e.resource.OptionGroupMembership)!=null?y.OptionGroupName:void 0;if(u)return o=n(MC.extractID(u)),new f(s,o||s.getDefaultOgInstance(u))}}),a})}.call(this),function(){define("workspaces/editor/framework/util/deserializeVisitor/JsonFixer",["Design"],function(e){return e.registerDeserializeVisitor(function(e,t,n){var r,i,s,o,u,a,f,l;if(n>="2014-01-25")return;s={},i=[];for(a in t)u=t[a],u.type==="AWS.EC2.AvailabilityZone"?(u.groupUId==="Canvas"&&delete u.groupUId,i.push({uid:a,type:"AWS.EC2.AvailabilityZone",name:u.name}),s[u.name]=MC.genResRef(a,"name")):u.type==="AWS.AutoScaling.Group"&&u.originalId&&(e[a]={type:"ExpandedAsg",uid:a});o=function(e){var t,n,r,i,u,a;for(t in e){n=e[t];if(_.isString(n))n==="true"?e[t]=!0:n==="false"?e[t]=!1:s[n]&&(e[t]=s[n]);else if(_.isArray(n))for(i=u=0,a=n.length;u<a;i=++u)r=n[i],_.isObject(r)&&o(r),_.isString(r)&&(n==="true"?n[i]=!0:n==="false"?n[i]=!1:s[n]&&(n[i]=s[n]));else _.isObject(n)&&o(n)}return null};for(a in e)u=e[a],o(u);for(f=0,l=i.length;f<l;f++)r=i[f],e[r.uid]=r;return null}),null})}.call(this),function(){define("workspaces/editor/framework/util/deserializeVisitor/EipMerge",["Design"],function(e){return e.registerDeserializeVisitor(function(e,t){var n,r,i,s,o,u;for(u in e){n=e[u];if(n.type==="AWS.EC2.EIP")if(n.resource.NetworkInterfaceId){o=n.resource.PrivateIpAddress.split("."),r=e[MC.extractID(o[0])];if(!r)continue;s=r.resource.PrivateIpAddressSet[o[3]*1];if(!s)continue;s.EipResource=n}else i=e[MC.extractID(n.resource.InstanceId)],i&&(i.resource.EipResource=n)}return null}),null})}.call(this),function(){define("workspaces/editor/framework/util/deserializeVisitor/FixOldStack",["Design","constant"],function(e,t){return e.registerDeserializeVisitor(function(n,r,i){var s,o,u,a;if(i>="2014-01-15")return;if(!e.instance().modeIsStack())return;for(a in n){s=n[a];if(s.type===t.RESTYPE.KP){if(s.name==="DefaultKP"){o=!0;if(u)break}}else if(s.type===t.RESTYPE.SG&&s.name==="DefaultSG"){u=!0;if(o)break}}return o||(a=MC.guid(),n[a]={uid:a,type:t.RESTYPE.KP,name:"DefaultKP",resource:{KeyName:"DefaultKP"}}),u||(a=MC.guid(),n[a]={uid:a,type:t.RESTYPE.SG,name:"DefaultSG",resource:{IpPermissions:[{IpProtocol:"tcp",IpRanges:"0.0.0.0/0",FromPort:"22",ToPort:"22",Groups:[{GroupId:"",UserId:"",GroupName:""}]}],IpPermissionsEgress:[],Default:"true",GroupName:"DefaultSG",GroupDescription:"default VPC security group"}}),null}),null})}.call(this),function(){define("workspaces/editor/framework/util/deserializeVisitor/AsgExpandor",["Design"],function(e){return e.registerDeserializeVisitor(function(e,t,n){var r,i,s;if(n<"2014-01-25")return;s=[];for(i in t)r=t[i],r.type==="ExpandedAsg"?s.push(e[i]={type:"ExpandedAsg",uid:i}):s.push(void 0);return s}),null})}.call(this),function(){define("workspaces/editor/framework/util/deserializeVisitor/ElbSgNamePatch",["Design","constant"],function(e,t){return e.registerDeserializeVisitor(function(e,n,r){var i,s,o,u,a,f,l,c,h,p,d,v;if(r>="2014-02-11")return;i=t.RESTYPE,u=[],l=[];for(c in e)s=e[c],s.type===i.ELB?u.push(s):s.type===i.SG&&l.push(s);for(h=0,d=u.length;h<d;h++){o=u[h],f=o.name+"-sg";for(p=0,v=l.length;p<v;p++){a=l[p];if(a.name===f){a.name="elbsg-"+o.name,a.resource.GroupName===f&&(a.resource.GroupName=a.name);break}}}return null}),null})}.call(this),function(){define("workspaces/editor/framework/util/serializeVisitor/EniIpAssigner",["Design","constant"],function(e,t){var n,r;return r=function(n,r){var i,s,o,u,a,f,l,c,h,p,d,v;f=e.instance().component(n),i=e.modelClassForType(t.RESTYPE.AZ),void 0,l=f.get("cidr");if(!l){void 0;return}u=[],a=[];for(c=0,p=r.length;c<p;c++){s=r[c],v=s.resource.PrivateIpAddressSet;for(h=0,d=v.length;h<d;h++)o=v[h],o.AutoAssign===!0?u.push(o):a.push(o.PrivateIpAddress)}return{subnetCid:l,ipSet:u,reserveIpSet:a}},n=function(n){var r,i,s,o,u,a;s=e.modelClassForType(t.RESTYPE.ENI).getAvailableIPInCIDR(n.subnetCid,n.reserveIpSet,n.ipSet.length),s=_.filter(s,function(e){return e.available}),a=n.ipSet;for(r=o=0,u=a.length;o<u;r=++o)i=a[r],s[r]?i.PrivateIpAddress=s[r].ip:i.PrivateIpAddress="";return null},e.registerSerializeVisitor(function(i){var s,o,u,a,f,l,c;if(e.instance().modeIsApp())return;l={};for(c in i)o=i[c],o.type===t.RESTYPE.ENI&&(o.resource.SubnetId&&o.resource.SubnetId[0]==="@"?f=o.resource.SubnetId:f=o.resource.AvailabilityZone,s=l[f],s||(s=l[f]=[]),s.splice(_.sortedIndex(s,o,"name"),0,o));for(c in l)a=l[c],c=MC.extractID(c),u=r(c,a),u&&n(u);return null}),null})}.call(this),function(){define("workspaces/editor/framework/util/serializeVisitor/AppToStack",["Design"],function(e){return e.registerSerializeVisitor(function(e,t,n){var r,i,s;if(!n||!n.toStack)return;s=[];for(r in e){i=e[r];switch(i.type){case"AWS.VPC.VPC":s.push(i.resource.VpcId="");break;case"AWS.VPC.NetworkInterface":i.resource.NetworkInterfaceId="",s.push(i.resource.Attachment.AttachmentId="");break;case"AWS.EC2.Instance":i.resource.InstanceId="",s.push(_.each(i.resource.BlockDeviceMapping,function(e){var t;if(((t=e.Ebs)!=null?t.VolumeType:void 0)&&e.Ebs.VolumeType!=="io1"&&e.Ebs.Iops)return i.Ebs.Iops=""}));break;case"AWS.VPC.Subnet":s.push(i.resource.SubnetId="");break;case"AWS.EC2.EIP":i.resource.AllocationId="",s.push(i.resource.PublicIp="");break;case"AWS.VPC.RouteTable":i.resource.RouteTableId="",s.push(i.resource.AssociationSet.forEach(function(e){e.RouteTableAssociationId=""}));break;case"AWS.EC2.SecurityGroup":i.resource.GroupId="",s.push(i.resource.GroupName=i.name);break;case"AWS.VPC.InternetGateway":s.push(i.resource.InternetGatewayId="");break;case"AWS.VPC.NetworkAcl":i.resource.NetworkAclId="",s.push(i.resource.AssociationSet.forEach(function(e){e.NetworkAclAssociationId=""}));break;case"AWS.VPC.VPNGateway":s.push(i.resource.VpnGatewayId="");break;case"AWS.VPC.VPNConnection":s.push(i.resource.VpnConnectionId="");break;case"AWS.VPC.CustomerGateway":s.push(i.resource.CustomerGatewayId="");break;case"AWS.EC2.EBS.Volume":i.resource.VolumeId="",i.resource.VolumeType&&i.resource.VolumeType!=="io1"&&i.resource.Iops?(i.resource.Iops="",s.push(null)):s.push(void 0);break;case"AWS.EC2.Tag":s.push(delete e[r]);break;case"AWS.AutoScaling.Tag":s.push(delete e[r]);break;case"AWS.ELB":i.resource.DNSName="",s.push(i.resource.LoadBalancerName=i.name);break;case"AWS.AutoScaling.LaunchConfiguration":i.resource.LaunchConfigurationARN="",i.resource.LaunchConfigurationName=i.name,s.push(_.each(i.resource.BlockDeviceMapping,function(e){var t;if(((t=e.Ebs)!=null?t.VolumeType:void 0)&&e.Ebs.VolumeType!=="io1"&&e.Ebs.Iops)return e.Ebs.Iops="",null}));break;case"AWS.AutoScaling.Group":i.resource.AutoScalingGroupARN="",s.push(i.resource.AutoScalingGroupName=i.name);break;case"AWS.AutoScaling.NotificationConfiguration":s.push(void 0);break;case"AWS.SNS.Subscription":s.push(void 0);break;case"AWS.AutoScaling.ScalingPolicy":s.push(i.resource.PolicyARN="");break;case"AWS.CloudWatch.CloudWatch":i.resource.AlarmArn="",s.push(i.resource.AlarmName=i.name);break;case"AWS.RDS.DBInstance":i.resource.CreatedBy="",i.resource.DBInstanceIdentifier="",i.resource.Endpoint.Address="",i.resource.PreferredBackupWindow="",i.resource.PreferredMaintenanceWindow="",s.push(i.resource.MasterUserPassword="");break;case"AWS.RDS.DBSubnetGroup":i.resource.CreatedBy="",s.push(i.resource.DBSubnetGroupName="");break;case"AWS.RDS.OptionGroup":s.push(i.resource.OptionGroupName="")}}return s}),null})}.call(this),function(){define("workspaces/editor/framework/DesignBundle",["Design","./connection/EniAttachment","./connection/VPNConnection","./connection/DbReplication","./resource/InstanceModel","./resource/EniModel","./resource/VolumeModel","./resource/AclModel","./resource/AsgModel","./resource/AzModel","./resource/AzModel","./resource/CgwModel","./resource/ElbModel","./resource/LcModel","./resource/KeypairModel","./resource/SslCertModel","./resource/RtbModel","./resource/SgModel","./resource/SubnetModel","./resource/VpcModel","./resource/IgwModel","./resource/VgwModel","./resource/SnsModel","./resource/StorageModel","./resource/ScalingPolicyModel","./resource/DBSbgModel","./resource/DBInstanceModel","./resource/DBOgModel","./util/deserializeVisitor/JsonFixer","./util/deserializeVisitor/EipMerge","./util/deserializeVisitor/FixOldStack","./util/deserializeVisitor/AsgExpandor","./util/deserializeVisitor/ElbSgNamePatch","./util/serializeVisitor/EniIpAssigner","./util/serializeVisitor/AppToStack"],function(e){return window.Design=e,e})}.call(this);