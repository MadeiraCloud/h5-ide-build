define("workspaces/editor/template/TplProgress",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){return"has-progess"}function c(e,t){var n;return a((n=e&&e.title,typeof n===u?n.apply(e):n))}function h(e,t){return a(n.i18n.call(e,"PROC_TITLE",{hash:{},data:t}))}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+="<div class='ops-process ",o=n["if"].call(t,t&&t.progress,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\'>\n  <section class="processing-wrap">\n    <header class="processing">',o=n["if"].call(t,t&&t.title,{hash:{},inverse:f.program(5,h,i),fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='<span class="process-info">'+a((o=t&&t.progress,typeof o===u?o.apply(t):o))+'%</span></header>\n    <header class="processing rolling-back-content">'+a(n.i18n.call(t,"PROP.ROLLING_BACK",{hash:{},data:i}))+'</header>\n    <section class="loading-spinner"></section>\n    <section class="progress">\n        <div class="bar" style="width:'+a((o=t&&t.progress,typeof o===u?o.apply(t):o))+'%;"></div>\n    </section>\n  </section>\n\n  <section class="success hide">\n    <p class="title">'+a(n.i18n.call(t,"PROC_RLT_DONE_TITLE",{hash:{},data:i}))+'</p>\n    <p class="sub-title">'+a(n.i18n.call(t,"PROC_RLT_DONE_SUB_TITLE",{hash:{},data:i}))+'</p>\n  </section>\n\n  <section class="fail hide error-info-block">\n    <header>'+a(n.i18n.call(t,"PROC_FAILED_TITLE",{hash:{},data:i}))+'</header>\n    <p class="sub-title">'+a(n.i18n.call(t,"PROC_RLT_FAILED_SUB_TITLE",{hash:{},data:i}))+'</p>\n    <div class="result-error-info">\n      <p class="title">'+a(n.i18n.call(t,"PROC_ERR_INFO",{hash:{},data:i}))+'</p>\n      <p class="detail"></p>\n    </div>\n    <button class="btn btn-silver btn-close-process right">'+a(n.i18n.call(t,"PROC_CLOSE_TAB",{hash:{},data:i}))+"</button>\n  </section>\n</div>",s};return e.template(t)}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/editor/ProgressViewer",["OpsModel","Workspace","./template/TplProgress","backbone"],function(e,n,r){var i,s;return s=Backbone.View.extend({events:{"click .btn-close-process":"close"},initialize:function(){var t;this.listenTo(this.model,"destroy",this.updateState),this.listenTo(this.model,"change:state",this.updateState),this.listenTo(this.model,"change:progress",this.updateProgress),t={progress:this.model.get("progress")},this.model.testState(e.State.Initializing)||(t.title=this.model.getStateDesc()+" your app..."),this.setElement($(r(t)).appendTo("#main")),this.__progress=0},switchToDone:function(){var e;this.$el.find(".success").show(),e=this,setTimeout(function(){e.$el.find(".processing-wrap").addClass("fadeout"),e.$el.find(".success").addClass("fadein")},10),setTimeout(function(){return e.trigger("done")},2e3)},updateState:function(){switch(this.model.get("state")){case e.State.Running:case e.State.Stopped:this.__awake?this.switchToDone():this.done=!0;break;case e.State.Destroyed:if(this.done){this.close();return}this.$el.children().hide(),this.$el.find(".fail").show(),this.$el.find(".detail").html(this.model.get("opsActionError").replace(/\n/g,"<br/>"));break;default:void 0}},updateProgress:function(){var e,t;e=this.model.get("progress"),this.$el.toggleClass("has-progess",!0),this.__progress>e&&this.$el.toggleClass("rolling-back",!0),this.__progress=e,t=""+e+"%",this.$el.find(".process-info").text(t),this.$el.find(".bar").css({width:t})},close:function(){return this.trigger("close")},awake:function(){this.$el.show(),this.__awake=!0,this.done&&(this.done=!1,this.switchToDone())},sleep:function(){this.$el.hide(),this.__awake=!1}}),i=function(r){function i(t){if(!t)throw this.remove(),new Error("Cannot find opsmodel while openning workspace.");if(t.testState(e.State.Saving)||t.testState(e.State.Terminating)){void 0,this.remove();return}return this.opsModel=t,n.apply(this,arguments)}return t(i,r),i.prototype.isWorkingOn=function(e){return this.opsModel===e},i.prototype.tabClass=function(){return"icon-app-pending"},i.prototype.title=function(){return this.opsModel.get("name")+" - app"},i.prototype.url=function(){return this.opsModel.url()},i.prototype.initialize=function(){var e;this.view=new s({model:this.opsModel}),this.view.workspace=this,this.listenTo(this.opsModel,"change:id",function(){this.updateUrl()}),e=this,this.view.on("close",function(){return e.remove()}),this.view.on("done",function(){var t,n;t=e.index(),e.remove(),n=App.openOps(e.opsModel),n.setIndex(t)})},i.prototype.awake=function(){return this.view.awake()},i.prototype.sleep=function(){return this.view.sleep()},i}(n),i})}.call(this),define("workspaces/editor/template/TplOpsEditor",["handlebars"],function(e){var t,n={toolbar:{},confirm:{},"export":{},modal:{}};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o;s+='<div id="OpsEditor" class="pos-r">\n  <aside class="OEPanelLeft"></aside>\n  <aside class="OEPanelRight" id="OEPanelRight"></aside>\n\n<div class="OEMiddleWrap">\n  <nav class="OEPanelTop"></nav>\n  <div class="OEPanelBottom"></div>\n\n    <section class="OEPanelCenter nano">\n        <div class="nano-content">\n            <div class="canvas-view">\n                <button class="svg_resizer icon-resize-down tooltip"\n                        data-tooltip=\'',o=n.i18n.call(t,"CANVAS.CVS_TIP_EXPAND_H",{hash:{},data:i});if(o||o===0)s+=o;s+="'></button>\n                <button class=\"svg_resizer icon-resize-up tooltip\"\n                        data-tooltip='",o=n.i18n.call(t,"CANVAS.CVS_TIP_SHRINK_H",{hash:{},data:i});if(o||o===0)s+=o;s+="'></button>\n                <button class=\"svg_resizer icon-resize-right tooltip\"\n                        data-tooltip='",o=n.i18n.call(t,"CANVAS.CVS_TIP_EXPAND_W",{hash:{},data:i});if(o||o===0)s+=o;s+="'></button>\n                <button class=\"svg_resizer icon-resize-left tooltip\"\n                        data-tooltip='",o=n.i18n.call(t,"CANVAS.CVS_TIP_SHRINK_W",{hash:{},data:i});if(o||o===0)s+=o;return s+='\'></button>\n                <svg width="100%" height="100%"></svg>\n            </div>\n        </div>\n    </section>\n</div>\n</div>',s},n.frame=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="ops-process">\n  <header class="processing">'+o(n.i18n.call(t,"TOOLBAR.LOADING_DATA",{hash:{},data:i}))+'</header>\n  <section class="loading-spinner"></section>\n</div>',s},n.loading=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o="function",u=this.escapeExpression;return s+='<div class="ops-process">\n    <header class="processing">'+u(typeof t===o?t.apply(t):t)+'<span class="process-info">0%</span></header>\n    <header class="processing rolling-back-content">'+u(n.i18n.call(t,"TOOLBAR.ROLLING_BACK",{hash:{},data:i}))+'</header>\n    <section class="loading-spinner"></section>\n    <section class="progress">\n        <div class="bar" style="width:0%;"></div>\n    </section>\n</div>',s},n.appProcessing=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="";return r+='\n  <header class="processing">'+u(n.i18n.call(e,"TOOLBAR.RELOADING_DATA",{hash:{},data:t}))+'</header>\n  <section class="loading-spinner"></section>\n',r}function c(e,t){var r="",i;r+='\n  <header class="processing">',i=n.unless.call(e,e&&e.error,{hash:{},inverse:f.program(6,p,t),fn:f.program(4,h,t),data:t});if(i||i===0)r+=i;r+="</header>\n  ",i=n["if"].call(e,e&&e.error,{hash:{},inverse:f.noop,fn:f.program(8,d,t),data:t});if(i||i===0)r+=i;return r+='\n  <button class="btn btn-silver" id="processDoneBtn">'+u(n.i18n.call(e,"TOOLBAR.LBL_DONE",{hash:{},data:t}))+"</button>\n",r}function h(e,t){return u(n.i18n.call(e,"TOOLBAR.APP_UPDATE_SUCCESSFULLY_TITLE",{hash:{},data:t}))}function p(e,t){return u(n.i18n.call(e,"TOOLBAR.APP_UPDATE_FAILED_TITLE",{hash:{},data:t}))}function d(e,t){var r="",i;r+='\n  <div class="error-info-block">\n    <div class="result-sub-title">'+u(n.i18n.call(e,"PROC_RLT_FAILED_SUB_TITLE",{hash:{},data:t}))+'</div>\n    <div class="result-error-info">\n      <p class="title">'+u(n.i18n.call(e,"PROC_ERR_INFO",{hash:{},data:t}))+'</p>\n      <p class="detail">',i=(i=e&&e.error,typeof i===a?i.apply(e):i);if(i||i===0)r+=i;return r+='</p>\n    </div>\n    <div class="result-error-notice">'+u(n.i18n.call(e,"TOOLBAR.APP_ROllBACK_DESC",{hash:{},data:t}))+"</div>\n  </div>\n  ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<div class="ops-process">\n',o=n["if"].call(t,t&&t.loading,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s},n.appUpdateStatus=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar tooltip icon-export-png toolbar-btn-primary" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_PNG",{hash:{},data:i}))+'\' data-analytics-plus="export_vis_png">'+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_PNG",{hash:{},data:i}))+"</button>",s},n.toolbar.BtnActionPng=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-zoom-in tooltip" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.TIP_ZOOM_IN",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-zoom-out seperator tooltip\" data-tooltip='"+o(n.i18n.call(t,"TOOLBAR.TIP_ZOOM_OUT",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnZoom=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="selectbox btn-toolbar toolbar-line-style seperator">\n  <button class="selection tooltip" data-tooltip="SecurityGroup Line Style"></button>\n  <ul class="dropdown">\n    <li class=\'item\' data-id="0"><span class="icon-straight">'+o(n.i18n.call(t,"TOOLBAR.LBL_LINESTYLE_STRAIGHT",{hash:{},data:i}))+'</span></li>\n    <li class=\'item\' data-id="1"><span class="icon-elbow">'+o(n.i18n.call(t,"TOOLBAR.LBL_LINESTYLE_ELBOW",{hash:{},data:i}))+'</span></li>\n    <li class=\'item\' data-id="2"><span class="icon-bezier-q">'+o(n.i18n.call(t,"TOOLBAR.LBL_LINESTYLE_CURVE",{hash:{},data:i}))+'</span></li>\n  </ul>\n</div>\n<button class="btn-toolbar icon-hide-sg tooltip" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.LBL_LINESTYLE_HIDE_SG",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnLinestyle=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-play tooltip toolbar-btn-primary runApp" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.TIP_BTN_RUN_STACK",{hash:{},data:i}))+"'>"+o(n.i18n.call(t,"TOOLBAR.BTN_RUN_STACK",{hash:{},data:i}))+"</button>",s},n.toolbar.BtnRunStack=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar tooltip icon-save" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.TIP_SAVE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-delete tooltip seperator\" data-tooltip='"+o(n.i18n.call(t,"TOOLBAR.TIP_DELETE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar tooltip icon-duplicate\" data-tooltip='"+o(n.i18n.call(t,"TOOLBAR.TIP_DUPLICATE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-new-stack tooltip seperator\" data-tooltip='"+o(n.i18n.call(t,"TOOLBAR.TIP_CREATE_STACK",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnStackOps=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="selectbox btn-toolbar seperator">\n  <button class="selection tooltip icon-send" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.EXPORT",{hash:{},data:i}))+'\'></button>\n  <ul class="dropdown">\n    <li data-analytics-plus="export_png" class="icon-export-png">'+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_PNG",{hash:{},data:i}))+'</li>\n    <li data-analytics-plus="export_json" class="icon-export-json">'+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_JSON",{hash:{},data:i}))+'</li>\n    <li data-analytics-plus="cloudformation" class="icon-toolbar-cloudformation">'+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_CF",{hash:{},data:i}))+"</li>\n  </ul>\n</div>",s},n.toolbar.BtnExport=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="tooltip btn-toolbar icon-update-app toolbar-btn-primary" data-tooltip="'+o(n.i18n.call(t,"TOOLBAR.TIP_UPDATE_APP",{hash:{},data:i}))+'">'+o(n.i18n.call(t,"TOOLBAR.EDIT_APP",{hash:{},data:i}))+'</button>\n<button class="tooltip btn-toolbar icon-apply-app toolbar-btn-primary" data-tooltip="'+o(n.i18n.call(t,"TOOLBAR.TIP_SAVE_UPDATE_APP",{hash:{},data:i}))+'">'+o(n.i18n.call(t,"TOOLBAR.APPLY_EDIT",{hash:{},data:i}))+'</button>\n<button class="tooltip btn-toolbar icon-cancel-update-app seperator" data-tooltip="'+o(n.i18n.call(t,"TOOLBAR.TIP_CANCEL_UPDATE_APP",{hash:{},data:i}))+'"></button>',s},n.toolbar.BtnEditApp=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression;s+='<button class="tooltip btn-toolbar icon-stop" data-tooltip="'+u(n.i18n.call(t,"TOOLBAR.TIP_STOP_APP",{hash:{},data:i}))+'"></button>\n<button class="tooltip btn-toolbar icon-play startApp" data-tooltip="'+u(n.i18n.call(t,"TOOLBAR.TIP_START_APP",{hash:{},data:i}))+'"><span style="display: none">'+u(n.i18n.call(t,"TOOLBAR.START_APP",{hash:{},data:i}))+'</span></button>\n<button class="btn-toolbar tooltip icon-terminate seperator" data-tooltip="',o=n.i18n.call(t,"TOOLBAR.TIP_TERMINATE_APP",{hash:{},data:i});if(o||o===0)s+=o;return s+='"></button>\n<button class="btn-toolbar tooltip icon-forget-app seperator" data-tooltip="Forget the App, but keep all Resources"></button>\n<button class="btn-toolbar tooltip icon-save-app seperator" data-tooltip=\''+u(n.i18n.call(t,"TOOLBAR.TIP_SAVE_APP_TO_STACK",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnAppOps=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-export-png tooltip seperator" data-analytics-plus="export_png" data-tooltip=\''+o(n.i18n.call(t,"TOOLBAR.EXPORT_AS_PNG",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnPng=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar tooltip icon-refresh seperator" data-tooltip="'+o(n.i18n.call(t,"TOOLBAR.TIP_REFRESH_REOURCES",{hash:{},data:i}))+'"></button>',s},n.toolbar.BtnReloadRes=e.template(t),t=function(e,t,n,r,i){function f(e,t){return" on"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a=this.escapeExpression;s+='<label class="switch toolbar-visual-ops-switch tooltip',o=n["if"].call(t,t&&t.stateOn,{hash:{},inverse:u.noop,fn:u.program(1,f,i),data:i});if(o||o===0)s+=o;return s+='" data-tooltip="'+a(n.i18n.call(t,"TOOLBAR.TIP_CUSTOM_USER_DATA",{hash:{},data:i}))+'">\n    <span class="switch-label" data-on="'+a(n.i18n.call(t,"TOOLBAR.TOGGLE_VISUALOPS_ON",{hash:{},data:i}))+'" data-off="'+a(n.i18n.call(t,"TOOLBAR.TOGGLE_VISUALOPS_OFF",{hash:{},data:i}))+'"></span>\n    <span class="switch-handle"></span>\n</label>',s},n.toolbar.BtnSwitchStates=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="icon-reload tooltip btn btn-blue reload-states" data-original="Reload States" data-disabled="Initiatingâ€¦"  data-tooltip="Instantly rerun all states in this app.">'+o(n.i18n.call(t,"TOOLBAR.RELOAD_STATES",{hash:{},data:i}))+"</button>",s},n.toolbar.BtnReloadStates=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="modal-text-wraper">\n    <div class="modal-center-align-helper">\n        <div class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.CONFIRM_ENABLE_STATE",{hash:{},data:i}))+"</div>\n    </div>\n</div>",s},n.confirm.enableState=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r="";return r+='\n            <div class="modal-text-highlight">'+u(n.i18n.call(e,"TOOLBAR.EXPORT_CLOUDFORMATION_WARNNING",{hash:{},data:t}))+"</div>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a=this;s+='<div class="modal-text-wraper">\n    <div class="modal-center-align-helper">\n        ',o=n["if"].call(t,t&&t.hasCustomOG,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i});if(o||o===0)s+=o;return s+='\n        <div class="modal-text-minor">'+u(n.i18n.call(t,"TOOLBAR.POP_EXPORT_CF_INFO",{hash:{},data:i}))+'</div>\n    </div>\n</div>\n<div class="stack-validation">\n    <details open style="display:none;">\n        <summary>'+u(n.i18n.call(t,"TOOLBAR.STACK_VALIDATION",{hash:{},data:i}))+'</summary>\n        <div id="stack-run-validation-container"></div>\n    </details>\n    <div class="nutshell">:<label></label></div>\n    <div class="validating">\n        <div class="loading-spinner loading-spinner-small"></div>\n        <p>'+u(n.i18n.call(t,"TOOLBAR.VALIDATING_STACK",{hash:{},data:i}))+'</p>\n    </div>\n</div>\n<div style="padding-top:20px;text-align:right;">\n    <a class="btn btn-blue disabled">'+u(n.i18n.call(t,"HEAD_INFO_LOADING",{hash:{},data:i}))+'</a>\n    <button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.export.CF=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<div class="modal-text-wraper">\n    <div class="modal-center-align-helper" style="padding:40px 20px;">\n        <div class="modal-text-major"></div>\n        <div class="modal-text-minor">'+u(n.i18n.call(t,"TOOLBAR.POP_BODY_EXPORT_AS_JSON",{hash:{},data:i}))+'</div>\n    </div>\n</div>\n<div class="modal-footer">\n    <a class="btn btn-blue" href="'+u((o=t&&t.data,typeof o===a?o.apply(t):o))+'" target="_blank">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_DOWNLOAD",{hash:{},data:i}))+'</a>\n    <button id="tpl-cancel" class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.export.JSON=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="loading-spinner"></div>\n<section style="margin:10px 10px 0;max-height:420px;overflow:hidden;text-align:center;display:none;"></section>\n<div class="modal-footer">\n    <a class="btn btn-blue" style="display: inline-block;">'+o(n.i18n.call(t,"TOOLBAR.LBL_DOWNLOAD",{hash:{},data:i}))+'</a>\n    <button class="btn modal-close btn-silver">'+o(n.i18n.call(t,"TOOLBAR.LBL_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.export.PNG=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o="function",u=this.escapeExpression;return s+='<div class="modal-text-wraper">\n    <div class="modal-center-align-helper">\n        <div class="modal-text-major">'+u(typeof t===o?t.apply(t):t)+" "+u(n.i18n.call(t,"TOOLBAR.HAS_UNSAVED_CHANGES",{hash:{},data:i}))+'</div>\n        <div class="modal-text-major">'+u(n.i18n.call(t,"TOOLBAR.CLOSE_CONFIRM",{hash:{},data:i}))+"</div>\n    </div>\n</div>",s},n.modal.onClose=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="modal-text-wraper">\n    <div class="modal-center-align-helper">\n        <div class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.CANCEL_UPDATE_CONFIRM",{hash:{},data:i}))+'</div>\n        <div class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.DISCARD_UPDATE_CHANGE",{hash:{},data:i}))+"</div>\n    </div>\n</div>",s},n.modal.cancelUpdate=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<p class="modal-text-major">'+u(n.i18n.call(t,"TOOLBAR.IMPORT_SUCCESSFULLY_WELL_DONE",t&&t.name,{hash:{},data:i}))+'</p>\n<p class="modal-text-major">'+u(n.i18n.call(t,"TOOLBAR.NAME_IMPORTED_APP",{hash:{},data:i}))+'</p>\n<div class="modal-control-group">\n    <label for="ImportSaveAppName">'+u(n.i18n.call(t,"TOOLBAR.APP_NAME",{hash:{},data:i}))+'</label>\n    <input id="ImportSaveAppName" class="input" value="'+u((o=t&&t.name,typeof o===a?o.apply(t):o))+'" type="string" autofocus>\n</div>\n<div class="modal-control-group app-usage-group clearfix">\n    <label for="">'+u(n.i18n.call(t,"TOOLBAR.APP_USAGE",{hash:{},data:i}))+'</label>\n    <div id="app-usage-selectbox" class="selectbox">\n        <div class="selection"><i class="icon-app-type-testing"></i>Testing</div>\n        <ul class="dropdown" tabindex="-1">\n            <li class="selected item" data-value="testing"><i class="icon-app-type-testing"></i>Testing</li>\n            <li class="item" data-value="development"><i class="icon-app-type-development"></i>Development</li>\n            <li class="item" data-value="production"><i class="icon-app-type-production"></i>Production</li>\n            <li class="item" data-value="others"><i class="icon-app-type-others" data-value="testing"></i>Others</li>\n        </ul>\n    </div>\n</div>\n\n<section style="margin:5px 5px 20px 8px;">\n  <div class="checkbox"><input id="MonitorImportApp" type="checkbox" checked="checked"><label for="MonitorImportApp"></label></div>\n  <label for="MonitorImportApp">Monitor and report external resource change of this app</label>\n  <i class="icon-info tooltip" data-tooltip="If resource has been changed outside VisualOps, an email notification will be sent to you." style="color:#148BE6;vertical-align:-3px;"></i>\n</section>\n\n<p>Now you can easily manage the resources and lifecycle of the app within VisualOps.</p>',s},n.modal.confirmImport=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<p class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.VPC_REMOVED_OUTSIDE_VISUALOPS",{hash:{},data:i}))+'</p>\n<p class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.CONFIRM_REMOVE_APP",{hash:{},data:i}))+"</p>",s},n.modal.confirmRemoveApp=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n        <div id="replace_stack" style="padding: 10px 0">\n            <div class="radio">\n                <input id="radio-replace-stack" type="radio" name="save-stack-type" value="replace" checked>\n                <label for="radio-replace-stack"></label>\n            </div>\n            <label class="modal-text-minor" for="radio-replace-stack">'+u(n.i18n.call(e,"TOOLBAR.POP_REPLACE_STACK",{hash:{},data:t}))+'</label>\n            <div style="padding: 10px 22px" class="radio-instruction">\n                '+u(n.i18n.call(e,"TOOLBAR.POP_REPLACE_STACK_INTRO",{hash:{},data:t}))+' "'+u((i=e&&e.input,typeof i===a?i.apply(e):i))+'" '+u(n.i18n.call(e,"TOOLBAR.POP_REPLACE_STACK_INTRO_END",{hash:{},data:t}))+'\n            </div>\n        </div>\n        <div id="save_new_stack">\n            <div class="radio">\n                <input id="radio-new-stack" type="radio" name="save-stack-type">\n                <label for="radio-new-stack"></label>\n            </div>\n            <label class="modal-text-minor" for="radio-new-stack">'+u(n.i18n.call(e,"TOOLBAR.POP_SAVE_NEW_STACK",{hash:{},data:t}))+'</label>\n            <div style="padding: 10px 22px" class="radio-instruction hide">\n                <p>'+u(n.i18n.call(e,"TOOLBAR.POP_SAVE_STACK_INSTRUCTION",{hash:{},data:t}))+'</p>\n                <input class="input" id="modal-input-value" value="'+u((i=e&&e.stackName,typeof i===a?i.apply(e):i))+'" type="text" style="width: 400px"/>\n                <div id="stack-name-exist" class="hide" style="color: #ec3c38">\n                  '+u(n.i18n.call(e,"TOOLBAR.POP_STACK_NAME_ERROR",{hash:{},data:t}))+"</div>\n            </div>\n        </div>\n        ",r}function c(e,t){var r="",i;return r+='\n        <div id="name_new_stack">\n            <input id="radio-new-stack" type="hidden" name="save-stack-type" checked>\n            <div style="padding: 10px 22px" class="radio-instruction">\n                <p>'+u(n.i18n.call(e,"TOOLBAR.POP_SAVE_STACK_INSTRUCTION",{hash:{},data:t}))+'</p>\n                <input class="input" id="modal-input-value" value="'+u((i=e&&e.stackName,typeof i===a?i.apply(e):i))+'" type="text" style="width: 400px"/>\n                <div id="stack-name-exist" class="hide" style="color: #ec3c38">'+u(n.i18n.call(e,"TOOLBAR.POP_STACK_NAME_ERROR",{hash:{},data:t}))+"</div>\n            </div>\n        </div>\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<p class="modal-text-minor">'+u(n.i18n.call(t,"TOOLBAR.POP_INTRO_1",{hash:{},data:i}))+'</p>\n<p class="modal-text-minor">'+u(n.i18n.call(t,"TOOLBAR.POP_INTRO_2",{hash:{},data:i}))+'</p>\n<div class="modal-center-align-helper">\n    <div class="modal-control-group">\n        ',o=n["if"].call(t,t&&t.originStackExist,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n    </div>\n</div>",s},n.saveAppToStack=e.template(t),n}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/editor/subviews/Toolbar",["OpsModel","../template/TplOpsEditor","ThumbnailUtil","JsonExporter","ApiRequest","i18n!/nls/lang.js","UI.modalplus","kp_dropdown","ResDiff","constant","event","component/trustedadvisor/gui/main","CloudResources","appAction","UI.notification","backbone"],function(t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v,m,g,y;y=window.location;if(/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/.exec(y.hostname)){void 0;return}return g=y.hostname.split("."),g.length>=3?v=g[g.length-2]+"."+g[g.length-1]:v=y.hostname,m="https://api."+v+"/v1/apps/",Backbone.View.extend({events:{"click .icon-save":"saveStack","click .icon-delete":"deleteStack","click .icon-duplicate":"duplicateStack","click .icon-new-stack":"createStack","click .icon-zoom-in":"zoomIn","click .icon-zoom-out":"zoomOut","click .icon-export-png":"exportPNG","click .icon-export-json":"exportJson","click .icon-toolbar-cloudformation":"exportCF","click .runApp":"runStack","OPTION_CHANGE .toolbar-line-style":"setTbLineStyle","click .icon-hide-sg":"toggleSgLine","click .icon-stop":"stopApp","click .startApp":"startApp","click .icon-terminate":"terminateApp","click .icon-forget-app":"forgetApp","click .icon-refresh":"refreshResource","click .icon-update-app":"switchToAppEdit","click .icon-apply-app":"applyAppEdit","click .icon-cancel-update-app":"cancelAppEdit","click .toolbar-visual-ops-switch":"opsOptionChanged","click .reload-states":"reloadState","click .icon-save-app":"appToStack"},initialize:function(e){var t,r,i,s,o,u,a,f;_.extend(this,e),s=this.workspace.opsModel,s.isStack()?i=["BtnRunStack","BtnStackOps","BtnZoom","BtnExport","BtnLinestyle","BtnSwitchStates"]:i=["BtnEditApp","BtnAppOps","BtnZoom","BtnPng","BtnLinestyle","BtnReloadRes"],u="";for(a=0,f=i.length;a<f;a++)r=i[a],t={stateOn:this.workspace.design.get("agent").enabled},u+=n.toolbar[r](t);this.workspace.opsModel.isApp()&&this.workspace.design.attributes.agent.enabled&&(u+=n.toolbar.BtnReloadStates()),this.setElement(this.parent.$el.find(".OEPanelTop").html(u)),o=this,setTimeout(function(){return o.updateTbBtns()},1e3),this.updateZoomButtons()},updateTbBtns:function(){var e,n,r,i,s,o;i=this.workspace.opsModel,this.$el.children(".toolbar-line-style").children(".dropdown").children().eq(parseInt(localStorage.getItem("canvas/lineStyle"),10)||2).click(),i.isApp()&&(r=this.workspace.isAppEditMode&&this.workspace.isAppEditMode(),this.$el.children(".icon-update-app").toggle(!r),this.$el.children(".icon-apply-app, .icon-cancel-update-app").toggle(r),r?(this.$el.children(".icon-terminate, .icon-forget-app, .icon-stop, .icon-play, .icon-refresh, .icon-save-app, .icon-reload").hide(),this.$el.find(".icon-refresh").hide()):(s=i.testState(t.State.Running),o=i.testState(t.State.Stopped),this.$el.children(".icon-terminate, .icon-forget-app, .icon-refresh, .icon-save-app, .icon-reload").show(),this.$el.children(".icon-stop").toggle(i.get("stoppable")&&s),this.$el.children(".icon-play").toggle(o).toggleClass("toolbar-btn-primary seperator",i.testState(t.State.Stopped)).find("span").toggle(o),this.$el.children(".icon-update-app").toggle(!o),this.$el.find(".icon-refresh").toggle(s),e=[].concat(this.workspace.design.componentsOfType(l.RESTYPE.INSTANCE),this.workspace.design.componentsOfType(l.RESTYPE.LC)),n=_.find(e,function(e){var t;return e&&((t=e.attributes.state)!=null?t.length:void 0)>0}),this.$el.find(".reload-states").toggle(!!n))),this.__saving?this.$el.children(".icon-save").attr("disabled","disabled"):this.$el.children(".icon-save").removeAttr("disabled"),this.updateZoomButtons()},setTbLineStyle:function(e,t){localStorage.setItem("canvas/lineStyle",t),this.parent.canvas&&this.parent.canvas.updateLineStyle()},toggleSgLine:function(){var e,t;e=$(".icon-hide-sg"),t=e.hasClass("selected"),t?e.data("tooltip",o.TOOLBAR.LBL_LINESTYLE_HIDE_SG).removeClass("selected"):e.data("tooltip",o.TOOLBAR.LBL_LINESTYLE_SHOW_SG).addClass("selected"),this.parent.canvas.toggleSgLine(t)},saveStack:function(e){var t,n;return $(e.currentTarget).attr("disabled","disabled"),n=this,this.__saving=!0,t=this.workspace.design.serialize(),r.generate(this.parent.getSvgElement())["catch"](function(){return null}).then(function(r){n.workspace.opsModel.save(t,r).then(function(){return n.__saving=!1,$(e.currentTarget).removeAttr("disabled"),notification("info",sprintf(o.NOTIFY.ERR_SAVE_SUCCESS,t.name))},function(r){var i;return n.__saving=!1,$(e.currentTarget).removeAttr("disabled"),r.error===252?i=o.NOTIFY.ERR_SAVE_FAILED_NAME:i=sprintf(o.NOTIFY.ERR_SAVE_FAILED,t.name),notification("error",i)})})},deleteStack:function(){return d.deleteStack(this.workspace.opsModel.cid,this.workspace.design.get("name"))},createStack:function(){return App.createOps(this.workspace.opsModel.get("region"))},duplicateStack:function(){var e;e=App.model.createStackByJson(this.workspace.design.serialize({duplicateStack:!0})),App.openOps(e)},zoomIn:function(){return this.parent.canvas.zoomIn(),this.updateZoomButtons()},zoomOut:function(){return this.parent.canvas.zoomOut(),this.updateZoomButtons()},updateZoomButtons:function(){var e;e=this.parent.canvas?this.parent.canvas.scale():1,e<=1?this.$el.find(".icon-zoom-in").attr("disabled","disabled"):this.$el.find(".icon-zoom-in").removeAttr("disabled"),e>=1.6?this.$el.find(".icon-zoom-out").attr("disabled","disabled"):this.$el.find(".icon-zoom-out").removeAttr("disabled")},exportPNG:function(){var e,t,s;t=new u({title:"Export PNG",template:n["export"].PNG(),width:"470",disableFooter:!0,compact:!0,onClose:function(){t=null}}),e=this.workspace.design,s=e.get("name"),r.exportPNG(this.parent.getSvgElement(),{isExport:!0,createBlob:!0,name:s,id:e.get("id"),onFinish:function(e){var n;if(!t)return;t.tpl.find(".loading-spinner").remove(),t.tpl.find("section").show().prepend("<img style='max-height:100%;display:inline-block;' src='"+e.image+"' />"),n=t.tpl.find("a.btn-blue").click(function(){return t.close()}),e.blob?n.click(function(){return i.download(e.blob,""+s+".png"),!1}):n.attr({href:e.image,download:""+s+".png"}),t.resize()}})},exportJson:function(){var e,t,r,s,a;r=this.workspace.design,a=App.user.get("username"),t=MC.dateFormat(new Date,"yyyy-MM-dd"),s=[r.get("name"),a,t].join("-"),e=i.exportJson(r.serialize(),""+s+".json");if(e)return new u({title:o.TOOLBAR.EXPORT_AS_JSON,template:n["export"].JSON(e),width:"470",disableFooter:!0,compact:!0})},exportCF:function(){var e,t,r,a,f,c,p;return a=this.workspace.design,f=!1,r=a.serialize({usage:"runStack"}).component,_.each(r,function(e){if(e.type===l.RESTYPE.DBOG)return f=!0}),c=new u({title:o.TOOLBAR.POP_EXPORT_CF,template:n["export"].CF({hasCustomOG:f}),width:"470",disableFooter:!0}),p=a.get("name"),t=h.loadModule("stack"),e=s("stack_export_cloudformation",{region:a.get("region"),stack:a.serialize()}),Q.spread([t,e],function(e,t){var n;c!=null&&c.resize(),n=c.tpl.find("a.btn-blue").text(o.TOOLBAR.POP_BTN_EXPORT_CF).removeClass("disabled"),i.genericExport(n,t,""+p+".json"),n.click(function(){return c.close()})},function(e){c!=null&&c.resize(),c.tpl.find("a.btn-blue").text(o.TOOLBAR.POP_BTN_EXPORT_CF),e.error&&notification("error",sprintf(o.NOTIFY.FAIL_TO_EXPORT_TO_CLOUDFORMATION,e.error))})},reloadState:function(e){var t,n,r;return t=$(e.currentTarget),t.hasClass("disabled")?!1:(t.toggleClass("disabled").html(t.attr("data-disabled")),n=Design.instance().get("id"),r={encoded_user:App.user.get("usercode"),token:App.user.get("defaultToken")},$.ajax({url:m+n,method:"POST",data:JSON.stringify(r),dataType:"json",statusCode:{200:function(){return notification("info",o.NOTIFY.RELOAD_STATE_SUCCESS),c.trigger(c.REFRESH_PROPERTY)},401:function(){return notification("error",o.NOTIFY.RELOAD_STATE_INVALID_REQUEST)},404:function(){return notification("error",o.NOTIFY.RELOAD_STATE_NETWORKERROR)},429:function(){return notification("error",o.NOTIFY.RELOAD_STATE_NOT_READY)},500:function(){return notification("error",o.NOTIFY.RELOAD_STATE_INTERNAL_SERVER_ERROR)}},error:function(){return void 0},success:function(){return void 0}}).always(function(){return window.setTimeout(function(){return t.removeClass("disabled").html(t.attr("data-original"))})}))},runStack:function(e){var t;return t=this,$(e.currentTarget).attr("disabled")?!1:d.showPayment().then(function(e){var n,r;return r=e.result,n=e.modal,t.__runStack(r,n)})},__runStack:function(e,t){var n,r,i,s,a,f;return f=this,s=App.user.get("paymentState"),t?(this.modal=t,this.modal.setTitle(o.IDE.RUN_STACK_MODAL_TITLE).setWidth("665px").setContent(MC.template.modalRunStack({paymentState:s,paymentUpdate:e})).compact().find(".modal-footer").show()):this.modal=new u({title:o.IDE.RUN_STACK_MODAL_TITLE,template:MC.template.modalRunStack({paymentState:s}),disableClose:!0,width:"665px",compact:!0,confirm:{text:App.user.hasCredential()?o.IDE.RUN_STACK_MODAL_CONFIRM_BTN:o.IDE.RUN_STACK_MODAL_NEED_CREDENTIAL,disabled:!0}}),this.renderKpDropdown(this.modal),i=Design.instance().getCost(),this.modal.find(".modal-input-value").val(this.workspace.opsModel.get("name")),this.modal.find("#label-total-fee").find("b").text("$"+i.totalFee),this.modal.find("#label-visualops-fee").find("b").text("$"+i.visualOpsFee),h.loadModule("stack").then(function(e){return function(){var t;return e.modal.resize(),(t=e.modal)!=null?t.toggleConfirm(!1):void 0}}(this)),n=this.modal.tpl.find("#app-name"),r=this.checkAppNameRepeat.bind(this),n.keyup(function(){return r(n.val())}),a=this,this.modal.on("confirm",function(e){return function(){var t;return e.hideError(),App.user.hasCredential()?(t=e.checkAppNameRepeat(n.val()),!e.defaultKpIsSet()||t?!1:(e.modal.tpl.find(".btn.modal-confirm").attr("disabled","disabled"),e.json=e.workspace.design.serialize({usage:"runStack"}),e.json.usage=$("#app-usage-selectbox").find(".dropdown .item.selected").data("value"),e.json.name=n.val(),e.workspace.opsModel.run(e.json,n.val()).then(function(e){return a.modal.close(),App.openOps(e)},function(e){var t;return a.modal.close(),t=e.awsError?e.error+"."+e.awsError:" "+e.error+" : "+(e.result||e.msg),notification("error",sprintf(o.NOTIFY.FAILA_TO_RUN_STACK_BECAUSE_OF_XXX,a.workspace.opsModel.get("name"),t))}))):(App.showSettings(App.showSettings.TAB.Credential),!1)}}(this)),this.modal.listenTo(App.user,"change:credential",function(){void 0;if(App.user.hasCredential()&&f.modal.isOpen())return f.modal.find(".modal-confirm").text(o.IDE.RUN_STACK_MODAL_CONFIRM_BTN)}),this.modal.on("close",function(){return f.modal.stopListening(App.user)})},appToStack:function(){var e,t,r,i,s,a;return t=this.workspace.design.attributes.name,r=this.getStackNameFromApp(t),a=App.model.stackList().get(this.workspace.design.attributes.stack_id),i=function(t){return function(){var n,r,i;MC.Analytics.increase("app_to_stack"),n=e.tpl.find("input[name='save-stack-type']:checked").val()!=="replace";if(!n)return r=Design.instance().serializeAsStack(),r.id=t.workspace.design.attributes.stack_id,e.close(),r.name=a.get("name"),a.save(r).then(function(){return notification("info",sprintf(o.NOTIFY.INFO_HDL_SUCCESS,o.TOOLBAR.TOOLBAR_HANDLE_SAVE_STACK,r.name)),App.openOps(a,!0)},function(){return notification("error",sprintf(o.NOTIFY.ERR_SAVE_FAILED,r.name))});i=App.model.createStackByJson(t.workspace.design.serializeAsStack(e.tpl.find("#modal-input-value").val())),e.close(),App.openOps(i)}}(this),s=!!a,e=new u({title:o.TOOLBAR.POP_TIT_APP_TO_STACK,template:n.saveAppToStack({input:t,stackName:r,originStackExist:s}),confirm:{text:o.TOOLBAR.POP_BTN_SAVE_TO_STACK},onConfirm:i}),e.tpl.find("input[name='save-stack-type']").change(function(){return e.tpl.find(".radio-instruction").toggleClass("hide")})},getStackNameFromApp:function(e){var t,n,r,i,s,o;e||(e="untitled"),n=0,s=/.*-\d+$/,s.test(e)?(i=e.substr(0,e.lastIndexOf("-")),n=Number(e.substr(e.lastIndexOf("-")+1)),t=i):e.charAt(e.length-1)==="-"?t=e.substr(0,e.length-1):t=e,o=/.-stack+$/,o.test(t)?t=t:t+="-stack",r=App.model.stackList().pluck("name")||[],n++;while(n<=r.length){if($.inArray(t+"-"+n,r)===-1)break;n++}return t+"-"+n},checkAppNameRepeat:function(e){return App.model.appList().findWhere({name:e})?(this.showError("appname",o.PROP.MSG_WARN_REPEATED_APP_NAME),!0):e?(this.hideError("appname"),!1):(this.showError("appname",o.PROP.MSG_WARN_NO_APP_NAME),!0)},renderKpDropdown:function(e){var t,n;if(a.hasResourceWithDefaultKp()){n=new a;if(!e)return!1;e.tpl.find("#kp-runtime-placeholder").html(n.render().el),t=this.hideError.bind(this),n.dropdown.on("change",function(){return t("kp")}),e.tpl.find(".default-kp-group").show(),this.modal&&this.modal.on("close",function(){return n.remove()}),this.updateModal&&this.updateModal.on("close",function(){return n.remove()})}return null},hideDefaultKpError:function(e){return e.hideError("kp")},hideError:function(e){var t;return t=e?$("#runtime-error-"+e):$(".runtime-error"),t.hide()},showError:function(e,t){return $("#runtime-error-"+e).text(t).show()},defaultKpIsSet:function(){var e,t;return a.hasResourceWithDefaultKp()?(t=Design.modelClassForType(l.RESTYPE.KP),e=t.getDefaultKP(),!e.get("isSet")||!this.modal&&!this.updateModal||!(this.modal||this.updateModal).tpl.find("#kp-runtime-placeholder .item.selected").size()?(this.showError("kp",o.IDE.RUN_STACK_MODAL_KP_WARNNING),!1):!0):!0},startApp:function(){return d.startApp(this.workspace.opsModel.id),!1},stopApp:function(){return d.stopApp(this.workspace.opsModel.id),!1},terminateApp:function(){return d.terminateApp(this.workspace.opsModel.id),!1},forgetApp:function(){return d.forgetApp(this.workspace.opsModel.id),!1},refreshResource:function(){return this.workspace.reloadAppData(),!1},switchToAppEdit:function(){return this.workspace.switchToEditMode(),!1},checkDBinstance:function(e){var t,n;return n=new Q.defer,e.length?(t=p(l.RESTYPE.DBINSTANCE,Design.instance().get("region")),t.fetchForce().then(function(){return n.resolve(t)})):n.resolve([]),n.promise},applyAppEdit:function(){var n,r,i,s,a,c,d,v,m,g;return g=this,d=this.workspace.opsModel.getJsonData(),a=this.workspace.design.serialize({usage:"updateApp"}),s=new f({old:d,"new":a}),m=s.getDiffInfo(),!m.compChange&&!m.layoutChange&&!m.stateChange?this.workspace.applyAppEdit():(v=s.removedComps,void 0,i=[],void 0,r=a.component,_.each(r,function(e){if(e.type===l.RESTYPE.DBINSTANCE)return i.push(e.resource.DBInstanceIdentifier)}),n=p(l.RESTYPE.DBINSTANCE,Design.instance().get("region")),this.updateModal=new u({title:o.IDE.HEAD_INFO_LOADING,template:MC.template.loadingSpiner,disableClose:!0,cancel:"Close"}),this.updateModal.tpl.find(".modal-footer").hide(),c=[],_.each(d.component,function(e){if(e.type===l.RESTYPE.DBINSTANCE)return c.push(e.resource.DBInstanceIdentifier)}),this.checkDBinstance(c).then(function(n){var r,u,f,c,p;f=n.filter(function(t){var n;return(n=t.attributes.DBInstanceIdentifier,e.call(i,n)>=0)&&t.attributes.DBInstanceStatus!=="available"});if(f.length)return g.updateModal.find(".modal-footer").show().find(".modal-confirm").hide(),g.updateModal.setContent(MC.template.cantUpdateApp({data:f})),g.updateModal.setTitle(o.IDE.UPDATE_APP_MODAL_TITLE),!1;c=[],_.each(v,function(e){var t;if(e.type===l.RESTYPE.DBINSTANCE){t=n.get(e.resource.DBInstanceIdentifier);if(t)return c.push(n.get(e.resource.DBInstanceIdentifier))}}),p=_.filter(c,function(e){return e.attributes.DBInstanceStatus!=="available"}),g.updateModal.tpl.children().css("width","450px").find(".modal-footer").show(),g.updateModal.find(".modal-wrapper-fix").width(665).find(".modal-body").css("padding",0),g.updateModal.setContent(MC.template.updateApp({isRunning:g.workspace.opsModel.testState(t.State.Running),notReadyDB:p,removeList:c})),g.updateModal.tpl.find(".modal-header").find("h3").text(o.IDE.UPDATE_APP_MODAL_TITLE),g.updateModal.tpl.find(".modal-confirm").prop("disabled",!0).text(App.user.hasCredential()?o.IDE.UPDATE_APP_CONFIRM_BTN:o.IDE.UPDATE_APP_MODAL_NEED_CREDENTIAL),g.updateModal.resize(),u=Design.instance().getCost(),g.updateModal.find("#label-total-fee").find("b").text("$"+u.totalFee),g.updateModal.find("#label-visualops-fee").find("b").text("$"+u.visualOpsFee),window.setTimeout(function(){return g.updateModal.resize()},100),(p!=null?p.length:void 0)&&g.updateModal.tpl.find("#take-rds-snapshot").attr("checked",!1).on("change",function(){return g.updateModal.tpl.find(".modal-confirm").prop("disabled",$(this).is(":checked"))}),g.updateModal.on("confirm",function(){var e;return App.user.hasCredential()?g.defaultKpIsSet()?(a=g.workspace.design.serialize({usage:"updateApp"}),g.workspace.applyAppEdit(a,!m.compChange),(e=g.updateModal)!=null?e.close():void 0):!1:(App.showSettings(App.showSettings.TAB.Credential),!1)}),m.compChange&&(r=s.renderAppUpdateView(),$("#app-update-summary-table .scroll-content").html(r)),g.renderKpDropdown(g.updateModal),h.loadModule("stack").then(function(){var e;return g.updateModal&&g.updateModal.toggleConfirm(!1),(e=g.updateModal)!=null?e.resize():void 0},function(e){var t;return void 0,g.updateModal&&g.updateModal.toggleConfirm(!0),g.updateModal&&g.updateModal.tpl.find("#take-rds-snapshot").off("change"),(t=g.updateModal)!=null?t.resize():void 0})}))},opsOptionChanged:function(){var e,t,r,i,s,o;return e=$(".toolbar-visual-ops-switch").toggleClass("on"),s=e.hasClass("on"),t=this.workspace.design.get("agent"),s?(i=this.workspace.design.instancesNoUserData(),o=this.workspace,i?(t.enabled=!0,this.workspace.design.set("agent",t),c.trigger(c.REFRESH_PROPERTY)):(e.removeClass("on"),r=new u({title:"Confirm to Enable VisualOps",width:"420px",template:n.confirm.enableState(),confirm:{text:"Enable VisualOps"},onConfirm:function(){return t.enabled=!0,r.close(),e.addClass("on"),o.design.set("agent",t),c.trigger(c.FORCE_OPEN_PROPERTY)}}),null)):(t.enabled=!1,this.workspace.design.set("agent",t),c.trigger(c.FORCE_OPEN_PROPERTY))},cancelAppEdit:function(){var e,t;return this.workspace.cancelEditMode()||(t=this,e=new u({title:"Changes not applied",template:n.modal.cancelUpdate(),width:"400",confirm:{text:"Discard",color:"red"},onConfirm:function(){e.close(),t.workspace.cancelEditMode(!0)}})),!1}})})}.call(this),define("workspaces/editor/template/TplLeftPanel",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){return"disabled"}function c(e,t){return"disableRds"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a=this,f="function";s+='<button class="tooltip sidebar-hider icon-caret-left HideOEPanelLeft" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_TOGGLE_RESOURCE_PANEL",{hash:{},data:i}))+'\'></button>\n\n<header class="sidebar-title"> '+u(n.i18n.call(t,"RES_TIT_RESOURCES",{hash:{},data:i}))+'\n  <i class="icon-resources js-toggle-dropdown menu-manage-shard-res tooltip" data-tooltip="'+u(n.i18n.call(t,"RES_TIP_SHARED_RESOURCES",{hash:{},data:i}))+'"></i>\n  <ul class="dropdown-menu resources-dropdown-wrapper">\n    <li data-action="keypair" class="icon-kp"><span>'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_KEY_PAIR",{hash:{},data:i}))+'</span></li>\n    <li data-action="snapshot" class="icon-ebs-snap"><span>'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_EBS_SNAPSHOT",{hash:{},data:i}))+'</span></li>\n    <li data-action="sns" class="icon-sns"><span>'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SNS_SUBSCRIPTION",{hash:{},data:i}))+'</span></li>\n    <li data-action="sslcert" class="icon-cert"><span>'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SERVER_CERTIFICATE",{hash:{},data:i}))+'</span></li>\n    <li data-action="dhcp" class="icon-dhcp"><span>'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_DHCP_OPTION_SETS",{hash:{},data:i}))+'</span></li>\n    <li data-action="rdspg" class="icon-pg ',o=n["if"].call(t,t&&t.rdsDisabled,{hash:{},inverse:a.noop,fn:a.program(1,l,i),data:i});if(o||o===0)s+=o;s+='"><span>'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_DB_PARAMETER_GROUPS",{hash:{},data:i}))+'</span></li>\n    <li data-action="rdssnapshot" class="icon-rds-snap ',o=n["if"].call(t,t&&t.rdsDisabled,{hash:{},inverse:a.noop,fn:a.program(1,l,i),data:i});if(o||o===0)s+=o;s+='"><span>'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_DB_SNAPSHOT",{hash:{},data:i}))+'</span></li>\n  </ul>\n  <i class="refresh-resource-panel icon-refresh tooltip" data-tooltip="'+u(n.i18n.call(t,"RES_TIP_REFRESH_RESOURCE_LIST",{hash:{},data:i}))+'"></i>\n</header>\n\n<div class="fixedaccordion accordion-default">\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+u(n.i18n.call(t,"RES_TIT_AZ",{hash:{},data:i}))+'</header>\n    <ul class="resource-list-az clearfix accordion-body">\n      <li class="tooltip resource-item az" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_AZ",{hash:{},data:i}))+'\' data-type="AZ">\n        <div class="resource-count">'+u((o=t&&t.count,typeof o===f?o.apply(t):o))+'</div>\n        <div class="res-name">'+u(n.i18n.call(t,"PROP.AZ_AND_SUBNET",{hash:{},data:i}))+'</div>\n      </li>\n      <li class="tooltip resource-item subnet" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_SUBNET",{hash:{},data:i}))+'\' data-type="SUBNET">'+u(n.i18n.call(t,"RES_LBL_NEW_SUBNET",{hash:{},data:i}))+'</li>\n      <li class="tooltip resource-item subnetgroup" data-type="DBSBG">'+u(n.i18n.call(t,"RES_LBL_NEW_SUBNET_GROUP",{hash:{},data:i}))+'</li>\n    </ul>\n  </section>\n\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+u(n.i18n.call(t,"RES_TIT_AMI",{hash:{},data:i}))+'\n      <nav class="selectbox resource-select AmiTypeSelect js-toggle-dropdown">\n        <div class="selection">'+u(n.i18n.call(t,"RES_LBL_QUICK_START_AMI",{hash:{},data:i}))+'</div>\n        <ul class="dropdown">\n          <li class="item selected" data-id="QuickStartAmi">'+u(n.i18n.call(t,"RES_LBL_QUICK_START_AMI",{hash:{},data:i}))+'</li>\n          <li class="item" data-id="MyAmi">'+u(n.i18n.call(t,"RES_LBL_MY_AMI",{hash:{},data:i}))+'</li>\n          <li class="item" data-id="FavoriteAmi">'+u(n.i18n.call(t,"RES_LBL_FAVORITE_AMI",{hash:{},data:i}))+'</li>\n        </ul>\n      </nav>\n    </header>\n    <div class="accordion-body nano">\n      <button class="btn btn-primary BrowseCommunityAmi">'+u(n.i18n.call(t,"RES_BTN_BROWSE_COMMUNITY_AMI",{hash:{},data:i}))+'</button>\n      <ul class="nano-content resource-list-ami"></ul>\n    </div>\n  </section>\n\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+u(n.i18n.call(t,"RES_TIT_VOL",{hash:{},data:i}))+'</header>\n    <div class="accordion-body nano">\n      <button class="btn btn-primary ManageSnapshot ManageEbsSnapshot">'+u(n.i18n.call(t,"RES_TIT_SNAPSHOT_MANAGE",{hash:{},data:i}))+'</button>\n      <div class="nano-content">\n        <div class="resource-list-head">'+u(n.i18n.call(t,"RES_LBL_NEW_BLANK_VOL",{hash:{},data:i}))+'</div>\n        <ul class="clearfix"><li class="tooltip resource-item volume" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_VOLUME",{hash:{},data:i}))+'\' data-type="VOL">'+u(n.i18n.call(t,"RES_LBL_NEW_VOL",{hash:{},data:i}))+'</li></ul>\n        <div class="resource-list-head">\n          '+u(n.i18n.call(t,"RES_LBL_NEW_VOL_FROM_SNAPSHOT",{hash:{},data:i}))+'\n          <div class="selectbox resource-list-sort-select dark" id="resource-list-sort-select-snapshot">\n            <div class="selection">'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SORT_BY_DATE",{hash:{},data:i}))+'</div>\n            <ul class="dropdown">\n              <li class="item selected focused" data-id="date">'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SORT_BY_DATE",{hash:{},data:i}))+'</li>\n              <li class="item" data-id="storge">'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SORT_BY_STORAGE",{hash:{},data:i}))+'</li>\n            </ul>\n          </div>\n        </div>\n        <ul class="resource-list-snapshot"></ul>\n      </div>\n    </div>\n  </section>\n\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+u(n.i18n.call(t,"RES_TIT_RDS",{hash:{},data:i}))+'</header>\n    <div class="accordion-body nano ',o=n["if"].call(t,t&&t.rdsDisabled,{hash:{},inverse:a.noop,fn:a.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='">\n      <div class="disableRds-content">'+u(n.i18n.call(t,"RES_MSG_RDS_DISABLED",{hash:{},data:i}))+'</div>\n      <button class="btn btn-primary ManageSnapshot ManageRdsSnapshot">'+u(n.i18n.call(t,"RES_TIT_RDS_SNAPSHOT_MANAGE",{hash:{},data:i}))+'</button>\n      <div class="nano-content">\n        <div class="resource-list-head">'+u(n.i18n.call(t,"RES_LBL_NEW_RDS_INSTANCE",{hash:{},data:i}))+'</div>\n        <ul class="resource-list-rds"></ul>\n        <div class="resource-list-head">\n          '+u(n.i18n.call(t,"RES_LBL_NEW_RDS_INSTANCE_FROM_SNAPSHOT",{hash:{},data:i}))+'\n          <div class="selectbox resource-list-sort-select dark" id="resource-list-sort-select-rds-snapshot">\n            <div class="selection">'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SORT_BY_DATE",{hash:{},data:i}))+'</div>\n            <ul class="dropdown">\n              <li class="item selected focused" data-id="date">'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SORT_BY_DATE",{hash:{},data:i}))+'</li>\n              <li class="item" data-id="engine">'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SORT_BY_ENGINE",{hash:{},data:i}))+'</li>\n              <li class="item" data-id="storge">'+u(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_SORT_BY_STORAGE",{hash:{},data:i}))+'</li>\n            </ul>\n          </div>\n        </div>\n        <ul class="resource-list-rds-snapshot"></ul>\n      </div>\n    </div>\n  </section>\n\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+u(n.i18n.call(t,"RES_TIT_ELB_ASG",{hash:{},data:i}))+'</header>\n    <ul class="resource-list-asg clearfix accordion-body">\n      <li class="tooltip resource-item elb" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_ELB",{hash:{},data:i}))+'\' data-type="ELB">'+u(n.i18n.call(t,"RES_LBL_NEW_ELB",{hash:{},data:i}))+'</li>\n      <li class="tooltip resource-item asg" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_ASG",{hash:{},data:i}))+'\' data-type="ASG">'+u(n.i18n.call(t,"RES_LBL_NEW_ASG",{hash:{},data:i}))+"</li>\n    </ul>\n  </section>\n\n  <section class='accordion-group'>\n    <header class=\"fixedaccordion-head\">"+u(n.i18n.call(t,"RES_TIT_VPC",{hash:{},data:i}))+'</header>\n    <ul class="accordion-body">\n      <li class="tooltip resource-item rtb" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_RTB",{hash:{},data:i}))+'\' data-type="RT">'+u(n.i18n.call(t,"RES_LBL_NEW_RTB",{hash:{},data:i}))+'</li>\n\n      <li class="tooltip resource-item igw" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_IGW",{hash:{},data:i}))+'\' data-type="IGW">'+u(n.i18n.call(t,"RES_LBL_NEW_IGW",{hash:{},data:i}))+'</li>\n\n      <li class="tooltip resource-item vgw" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_VGW",{hash:{},data:i}))+'\' data-type="VGW">'+u(n.i18n.call(t,"RES_LBL_NEW_VGW",{hash:{},data:i}))+'</li>\n\n      <li class="tooltip resource-item cgw" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_CGW",{hash:{},data:i}))+'\' data-type="CGW">'+u(n.i18n.call(t,"RES_LBL_NEW_CGW",{hash:{},data:i}))+'</li>\n\n      <li class="tooltip resource-item eni" data-tooltip=\''+u(n.i18n.call(t,"RES_TIP_DRAG_NEW_ENI",{hash:{},data:i}))+'\' data-type="ENI">'+u(n.i18n.call(t,"RES_LBL_NEW_ENI",{hash:{},data:i}))+"</li>\n    </ul>\n  </section>\n</div>",s},n.panel=e.template(t),t=function(e,t,n,r,i){function f(e,t,r){var i;return i=n["with"].call(e,e&&e.attributes,{hash:{},inverse:a.noop,fn:a.programWithDepth(2,l,t,r),data:t}),i||i===0?i:""}function l(e,t,r){var i="",s;i+='\n<li class="resource-item bubble snapshot" data-date="'+u((s=e&&e.startTime,typeof s===o?s.apply(e):s))+'" data-storge="'+u((s=e&&e.volumeSize,typeof s===o?s.apply(e):s))+'" data-bubble-template="resPanelSnapshot" data-bubble-data=\'{"id":"'+u((s=e&&e.id,typeof s===o?s.apply(e):s))+'", "region":"'+u((s=r&&r.region,typeof s===o?s.apply(e):s))+'"}\' data-type="VOL" data-option=\'{"volumeSize":'+u((s=e&&e.volumeSize,typeof s===o?s.apply(e):s))+', "snapshotId": "'+u((s=e&&e.id,typeof s===o?s.apply(e):s))+'", "encrypted": "',s=n["if"].call(e,e&&e.encrypted,{hash:{},inverse:a.program(5,h,t),fn:a.program(3,c,t),data:t});if(s||s===0)i+=s;return i+='"}\'>\n  <div class="ebs-size">'+u((s=e&&e.volumeSize,typeof s===o?s.apply(e):s))+" GB</div>"+u((s=e&&e.id,typeof s===o?s.apply(e):s))+"\n</li>",i}function c(e,t){return"true"}function h(e,t){return"false"}function p(e,t){var r="";return r+='\n<div style="padding-bottom:15px;">'+u(n.i18n.call(e,"TOOLBAR.CLOUD_RESOURCE_NO_EBS_SNAPSHOT",e&&e.region,{hash:{},data:t}))+"</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.program(7,p,i),fn:a.programWithDepth(1,f,i,t),data:i}),s||s===0?s:""},n.snapshot=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r="",i;i=n["with"].call(e,(i=e&&e[0],i==null||i===!1?i:i.attributes),{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;return r+="\n",r}function l(e,t){var r="",i;return r+='\n<li class="resource-item dbinstance tooltip" data-tooltip="'+u((i=t==null||t===!1?t:t.key,typeof i===o?i.apply(e):i))+'" data-type="DBINSTANCE" data-option=\'{"engine":"'+u((i=e&&e.Engine,typeof i===o?i.apply(e):i))+'"}\'>\n<div class="resource-icon-dbinstance"><img src="/assets/images/ide/icon/rds-'+u(n.firstOfSplit.call(e,e&&e.Engine,"-",{hash:{},data:t}))+'.png" width="42" height="30"></div>\n'+u((i=t==null||t===!1?t:t.key,typeof i===o?i.apply(e):i))+"\n</li>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.rds=e.template(t),t=function(e,t,n,r,i){function f(e,t,r){var i="",s;return i+='\n<li class="resource-item dbsnapshot bubble" data-date="'+u((s=e&&e.SnapshotCreateTime,typeof s===o?s.apply(e):s))+'" data-engine="'+u((s=e&&e.EngineVersion,typeof s===o?s.apply(e):s))+'" data-storge="'+u((s=e&&e.AllocatedStorage,typeof s===o?s.apply(e):s))+'" data-type="DBINSTANCE" data-option=\'{"engine":"'+u((s=e&&e.Engine,typeof s===o?s.apply(e):s))+'", "snapshotId": "'+u((s=e&&e.DBSnapshotIdentifier,typeof s===o?s.apply(e):s))+'","allocatedStorage": "'+u((s=e&&e.AllocatedStorage,typeof s===o?s.apply(e):s))+'" }\' data-bubble-template="resPanelDbSnapshot" data-bubble-data=\'{"id":"'+u((s=e&&e.DBSnapshotIdentifier,typeof s===o?s.apply(e):s))+'","region":"'+u((s=r&&r.region,typeof s===o?s.apply(e):s))+'"}\'>\n  <div class="resource-icon-dbsnapshot"><img src="/assets/images/ide/icon/rds-'+u(n.firstOfSplit.call(e,e&&e.Engine,"-",{hash:{},data:t}))+'.png" width="32" height="23">\n  <div class="rds-snapshot-size">'+u((s=e&&e.AllocatedStorage,typeof s===o?s.apply(e):s))+" GB</div></div>"+u((s=e&&e.DBInstanceIdentifier,typeof s===o?s.apply(e):s))+"\n</li>\n",i}function l(e,t){var r="";return r+='\n<div style="padding-bottom:15px;">'+u(n.i18n.call(e,"TOOLBAR.CLOUD_RESOURCE_NO_DB_SNAPSHOT",e&&e.region,{hash:{},data:t}))+"</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.program(3,l,i),fn:a.programWithDepth(1,f,i,t),data:i}),s||s===0?s:""},n.rds_snapshot=e.template(t),t=function(e,t,n,r,i){function f(e,t,r){var i="",s;s=n["with"].call(e,e&&e.attributes,{hash:{},inverse:a.noop,fn:a.programWithDepth(2,l,t,r),data:t});if(s||s===0)i+=s;return i+="\n",i}function l(e,t,r){var i="",s;i+='\n<li class="bubble resource-item instance" data-bubble-template="resPanelAmiInfo" data-bubble-data=\'{"region":"'+o((s=r&&r.region,typeof s===u?s.apply(e):s))+'","imageId":"'+o((s=e&&e.id,typeof s===u?s.apply(e):s))+'"}\' data-type="INSTANCE" data-option=\'{"imageId":"'+o((s=e&&e.id,typeof s===u?s.apply(e):s))+"\"}'>\n  ",s=n["if"].call(e,r&&r.fav,{hash:{},inverse:a.noop,fn:a.program(3,c,t),data:t});if(s||s===0)i+=s;return i+='\n  <div class="resource-icon-instance"><img src="/assets/images/ide/ami/'+o((s=e&&e.osType,typeof s===u?s.apply(e):s))+"."+o((s=e&&e.architecture,typeof s===u?s.apply(e):s))+"."+o((s=e&&e.rootDeviceType,typeof s===u?s.apply(e):s))+".png\" width='39' height='27' /></div>\n  "+o((s=e&&e.name,typeof s===u?s.apply(e):s))+"\n</li>",i}function c(e,t){var r="",i;return r+='<button class="btn-fav-ami fav tooltip" data-tooltip="'+o(n.i18n.call(e,"RES_TIT_TOGGLE_FAVORITE",{hash:{},data:t}))+'" data-id="'+o((i=e&&e.id,typeof i===u?i.apply(e):i))+'"></button>',r}function h(e,t){var r;return r=n["if"].call(e,e&&e.fav,{hash:{},inverse:a.noop,fn:a.program(6,p,t),data:t}),r||r===0?r:""}function p(e,t){var r="";return r+='<p class="blank-slate">'+o(n.i18n.call(e,"TOOLBAR.CLOUD_RESOURCE_BROWSE_COMMUNITY_AMI",{hash:{},data:t}))+"</p>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=this.escapeExpression,u="function",a=this;return s=n.each.call(t,t,{hash:{},inverse:a.program(5,h,i),fn:a.programWithDepth(1,f,i,t),data:i}),s||s===0?s:""},n.ami=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="resource-icon resource-icon-instance" >\n  <img src="/assets/images/ide/ami/'+a((o=(o=t&&t.cachedAmi,o==null||o===!1?o:o.osType),typeof o===u?o.apply(t):o))+"."+a((o=(o=t&&t.cachedAmi,o==null||o===!1?o:o.architecture),typeof o===u?o.apply(t):o))+"."+a((o=(o=t&&t.cachedAmi,o==null||o===!1?o:o.rootDeviceType),typeof o===u?o.apply(t):o))+'.png"/>\n</div>'+a(n.i18n.call(t,"TOOLBAR.CLOUD_RESOURCE_AUTO_SCALING_GROUP",{hash:{},data:i}))+" ("+a((o=t&&t.name,typeof o===u?o.apply(t):o))+")",s},n.reuse_lc=e.template(t),t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+="<dt>"+a((r=t==null||t===!1?t:t.key,typeof r===u?r.apply(e):r))+"</dt><dd>"+a(typeof e===u?e.apply(e):e)+"</dd>",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="bubble-head">'+a((o=t&&t.id,typeof o===u?o.apply(t):o))+'</div>\n<dl class="bubble-content dl-horizontal">',o=n.each.call(t,t,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="</dl>",s},n.resourcePanelBubble=e.template(t),n}),define("workspaces/editor/template/TplAmiBrowser",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression;s+='<div class="content-wrap" style="position:relative;">\n  <div id="ami-search-option">\n    <div>\n      <input id="community-ami-input" class="input" type="text" placeholder="',o=n.i18n.call(t,"AMI_LBL_ALL_SEARCH_AMI_BY_NAME_OR_ID",{hash:{},data:i});if(o||o===0)s+=o;return s+='" />\n    </div>\n\n    <div id="selectbox-ami-platform" class="selectbox">\n      <div class="selection">'+u(n.i18n.call(t,"AMI_LBL_ALL_PLATFORMS",{hash:{},data:i}))+'</div>\n      <ul class="dropdown" tabindex="-1">\n        <li class="item selected" data-id="">'+u(n.i18n.call(t,"AMI_LBL_ALL_PLATFORMS",{hash:{},data:i}))+'</li>\n        <li class="item" data-id="amazonlinux"> <span class="icon-ami-os amz-linux">Amazon Linux</span> </li>\n        <li class="item" data-id="centos"> <span class="icon-ami-os centos">Cent OS</span> </li>\n        <li class="item" data-id="debian"> <span class="icon-ami-os debian">Debian</span> </li>\n        <li class="item" data-id="fedora"> <span class="icon-ami-os fedora">Fedora</span> </li>\n        <li class="item" data-id="gentoo"> <span class="icon-ami-os gentoo">Gentoo</span> </li>\n        <li class="item" data-id="opensuse"><span class="icon-ami-os opensuse">OpenSUSE</span> </li>\n        <li class="item" data-id="ubuntu"> <span class="icon-ami-os ubuntu">Ubuntu</span> </li>\n        <li class="item" data-id="redhat"> <span class="icon-ami-os redhat">Red Hat</span> </li>\n        <li class="item" data-id="windows"><span class="icon-ami-os windows">Windows</span> </li>\n        <li class="item" data-id="otherlinux"> <span class="icon-ami-os linux-other">Other Linux</span> </li>\n      </ul>\n    </div>\n\n    <div class="ami-option-group">\n      <h5>'+u(n.i18n.call(t,"AMI_LBL_VISIBILITY",{hash:{},data:i}))+'</h5>\n      <div class="ami-option-wrap" id="filter-ami-type">\n        <button type="button" class="btn active">'+u(n.i18n.call(t,"AMI_LBL_PUBLIC",{hash:{},data:i}))+'</button>\n        <button type="button" class="btn">'+u(n.i18n.call(t,"AMI_LBL_PRIVATE",{hash:{},data:i}))+'</button>\n      </div>\n    </div>\n\n    <div class="ami-option-group">\n      <h5>'+u(n.i18n.call(t,"AMI_LBL_ARCHITECTURE",{hash:{},data:i}))+'</h5>\n      <div class="ami-option-wrap" id="filter-ami-32bit-64bit">\n        <button type="button" class="btn active">'+u(n.i18n.call(t,"AMI_LBL_32_BIT",{hash:{},data:i}))+'</button>\n        <button type="button" class="btn">'+u(n.i18n.call(t,"AMI_LBL_64_BIT",{hash:{},data:i}))+'</button>\n      </div>\n    </div>\n\n    <div class="ami-option-group">\n      <h5>'+u(n.i18n.call(t,"AMI_LBL_ROOT_DEVICE_TYPE",{hash:{},data:i}))+'</h5>\n      <div class="ami-option-wrap" id="filter-ami-EBS-Instance">\n        <button type="button" class="btn active">'+u(n.i18n.call(t,"AMI_LBL_EBS",{hash:{},data:i}))+'</button>\n        <button type="button" class="btn">'+u(n.i18n.call(t,"AMI_LBL_INSTANCE_STORE",{hash:{},data:i}))+'</button>\n      </div>\n    </div>\n\n    <div id="btn-search-ami" class="btn btn-blue" disabled>'+u(n.i18n.call(t,"AMI_LBL_SEARCHING",{hash:{},data:i}))+'</div>\n  </div>\n\n  <div id="ami-data-wrap">\n    <div id="ami-table-wrap" class="table-head-fix">\n      <table class="table-head">\n        <thead>\n        <tr>\n          <th style="width: 44px;"></th>\n          <th style="width: 104px;">'+u(n.i18n.call(t,"AMI_LBL_AMI_ID",{hash:{},data:i}))+"</th>\n          <th>"+u(n.i18n.call(t,"AMI_LBL_AMI_NAME",{hash:{},data:i}))+'</th>\n          <th style="width: 62px;padding-left:4px;text-align:left;" class="sortable">'+u(n.i18n.call(t,"AMI_LBL_SIZE",{hash:{},data:i}))+'</th>\n        </tr>\n        </thead>\n      </table>\n      <div class="scroll-wrap">\n        <div class="scrollbar-veritical-wrap" style="display: block;"><div class="scrollbar-veritical-thumb"></div></div>\n        <div class="show-loading">\n          <div class="loading-spinner"></div>\n        </div>\n        <div class="scroll-content" style="display:block;">\n          <table class="table">\n            <thead>\n            <tr>\n              <th style="width: 16px;"><div class="th-inner"></div></th>\n              <th style="width: 80px;"><div class="th-inner"></div></th>\n              <th><div class="th-inner"></div></th>\n              <th style="width: 42px;"><div class="th-inner"></div></th>\n            </tr>\n            </thead>\n            <tbody id="community_ami_table"></tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n\n    <div id="community-ami-page">\n      <div class="page-tip" style="display: none;"></div>\n      <div class="pagination" style="display: none;">\n        <a href="#" class="previous" data-action="previous">&lsaquo;</a>\n        <input type="text" readonly="readonly" data-max-page="40" />\n        <a href="#" class="next" data-action="next">&rsaquo;</a>\n      </div>\n    </div>\n  </div>\n</div>',s},n.dialog=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r="",i;r+='<tr class="item" data-id="'+o((i=t==null||t===!1?t:t.key,typeof i===u?i.apply(e):i))+'">\n  <td><div class="toggle-fav ',i=n["if"].call(e,e&&e.faved,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;r+=' tooltip" data-tooltip="'+o(n.i18n.call(e,"RES_TIT_TOGGLE_FAVORITE",{hash:{},data:t}))+'"></div></td>\n  <td>'+o((i=t==null||t===!1?t:t.key,typeof i===u?i.apply(e):i))+'</td>\n  <td>\n    <span class="ami-table-name">'+o((i=e&&e.name,typeof i===u?i.apply(e):i))+'</span>\n    <div class="ami-meta '+o((i=e&&e.osType,typeof i===u?i.apply(e):i))+' icon-ami-os"> ',i=n.ifCond.call(e,e&&e.isPublic,"true",{hash:{},inverse:a.program(6,h,t),fn:a.program(4,c,t),data:t});if(i||i===0)r+=i;return r+=" | "+o((i=e&&e.architecture,typeof i===u?i.apply(e):i))+" | "+o((i=e&&e.rootDeviceType,typeof i===u?i.apply(e):i))+"</div>\n  </td>\n  <td>"+o((i=e&&e.imageSize,typeof i===u?i.apply(e):i))+"</td>\n</tr>\n",r}function l(e,t){return"fav"}function c(e,t){return o(n.i18n.call(e,"AMI_TYPE_PUBLIC",{hash:{},data:t}))}function h(e,t){return o(n.i18n.call(e,"AMI_TYPE_PRIVATE",{hash:{},data:t}))}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=this.escapeExpression,u="function",a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.amiItem=e.template(t),n}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/editor/subviews/AmiBrowser",["../template/TplAmiBrowser","i18n!/nls/lang.js","UI.modalplus","ApiRequest","CloudResources","backbone","jqpagination"],function(t,n,r,i,s){return Backbone.View.extend({events:{"click .ami-option-group .ami-option-wrap .btn":"clickOptionBtn","keypress #community-ami-input":"search","click    #btn-search-ami":"search","click    .toggle-fav":"toggleFav"},initialize:function(e){var i,s;$.extend(this,e),i=new r({title:n.IDE.AMI_LBL_COMMUNITY_AMIS,width:"855px",template:t.dialog(),disableFooter:!0,compact:!0}),s=this,i.on("close",function(){s.onClose&&s.onClose()}),this.setElement(i.tpl),this.doSearch()},clickOptionBtn:function(e){var t;if($(e.target).hasClass("active")){t=$(e.target).parent().find(".active");if(t.length===1&&t[0]===e.target)return;$(e.target).removeClass("active")}else $(e.target).addClass("active");return null},toggleFav:function(e){var t,n,r,i,o,u;return t=$(e.target),u=this,r=s("FavoriteAmi",this.region),o=null,i=t.closest("tr").attr("data-id"),t.hasClass("fav")?o=r.unfav(i):(n=$.extend({id:i},this.communityAmiData[i]),o=r.fav(n)),o.then(function(){return t.toggleClass("fav")})},doSearch:function(e,t){var r,o,u,a,f,l,c,h,p,d,v,m;return e=e||1,this.renderAmiLoading(),f=$("#community-ami-input").val(),c=$("#selectbox-ami-platform").find(".selected").data("id"),a="true",u="32-bit",d="EBS",$("#filter-ami-type").find(".active").length===1?(m=radiobuttons.data($("#filter-ami-type")),a=m==="Private"?"false":"true"):$("#filter-ami-type").find(".active").length===2&&(a=null),$("#filter-ami-32bit-64bit").find(".active").length===1?u=radiobuttons.data($("#filter-ami-32bit-64bit")):$("#filter-ami-32bit-64bit").find(".active").length===2&&(u=null),$("#filter-ami-EBS-Instance").find(".active").length===1?d=radiobuttons.data($("#filter-ami-EBS-Instance")):$("#filter-ami-EBS-Instance").find(".active").length===2&&(d=null),l=parseInt(t||50,10),p=parseInt(e,10),v=this,h=/ami-[a-zA-Z0-9]{8}$/,r=f.trim(),r&&h.test(r)?(o=s("AWS.EC2.AMI",v.region),o.fetchAmis([r]).then(function(){var e,t,n;return e=o.where({id:r}),t={ami:{curPageNum:1,result:{},totalNum:0,totalPageNum:1}},e.length>0&&(t.ami.result[r]=e[0].toJSON(),t.ami.totalNum=1),t=v.addFavStar(t),v.communityAmiData=((n=t.ami)!=null?n.result:void 0)||{},v.communityAmiRender(t)})):i("aws_public",{region_name:this.region,filters:{ami:{name:f,platform:c,isPublic:a,architecture:u,rootDeviceType:d,perPageNum:l,returnPage:p}}}).then(function(e){var t;return e=v.addFavStar(e),v.communityAmiData=((t=e.ami)!=null?t.result:void 0)||{},v.communityAmiRender(e)},function(e){return notification("error",n.NOTIFY.UNABLE_TO_LOAD_COMMUNITY_AMIS),v.communityAmiRender({ami:[]})})},searchPrev:function(){var e;return e=parseInt($("#community_ami_page_current").attr("page"),10),this.doSearch(e+1)},searchNext:function(){var e;return e=parseInt($("#community_ami_page_current").attr("page"),10),this.doSearch(e-1)},search:function(e){if(e.keyCode&&e.keyCode!==13)return;return this.doSearch()},addFavStar:function(t){var n,r,i;return r=s("FavoriteAmi",this.region).getModels()||[],n=_.clone(t.ami.result),i=_.pluck(_.pluck(r,"attributes"),"id"),_.each(n,function(t,n){if(e.call(i,n)>=0)return t.faved=!0}),t.ami.result=n,t},communityAmiRender:function(e){var n;this.communityShowContent(),n=0;if(!e.ami)return;return e=e.ami,$("#community_ami_table").html(t.amiItem(e.result)),this.communityPagerRender(e.curPageNum,e.totalPageNum,e.totalNum)},communityPagerRender:function(e,t,r){var i,s,o,u,a;return a=this,o=r>50?50:r,i=(e-1)*50+1,s=i+o-1,s>r&&(s=r),$(".page-tip").text(sprintf(n.IDE.AMI_LBL_PAGEINFO,i,s,r)),u=$(".pagination"),t===0?u.hide():u.show(),u.data("jqPagination")&&(u.jqPagination("destroy"),u.find("input").data("current-page",e)),u.jqPagination({current_page:e,max_page:t,page_string:"{current_page} / {max_page}",paged:function(e,t){return function(n){if(n!==e&&t>=n&&n>0)return a.doSearch(n)}}(e,t)})},communityShowContent:function(){return $(".show-loading").hide(),$("#ami-table-wrap .scroll-content").show(),$("#btn-search-ami").text(n.IDE.AMI_LBL_SEARCH).removeAttr("disabled"),$("#community-ami-page>div").show()},renderAmiLoading:function(){return $("#ami-table-wrap .scroll-content").hide(),$(".show-loading").show(),$("#btn-search-ami").text(n.IDE.AMI_LBL_SEARCHING).attr("disabled",""),$("#community-ami-page>div").hide()}})})}.call(this),function(){define("workspaces/editor/subviews/ResourcePanel",["CloudResources","Design","../template/TplLeftPanel","constant","dhcp","snapshotManager","rds_snapshot","sslcert_manage","sns_manage","kp_manage","rds_pg","rds_snapshot","./AmiBrowser","i18n!/nls/lang.js","ApiRequest","backbone","UI.radiobuttons","UI.nanoscroller","UI.dnd"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){var v,m;return m=null,$(window).on("resize",function(){m&&clearTimeout(m),m=setTimeout(function(){return $("#OpsEditor").filter(":visible").children(".OEPanelLeft").trigger("RECALC")},150)}),MC.template.resPanelAmiInfo=function(t){var n,i,s,o;if(!t.region||!t.imageId)return;n=e(r.RESTYPE.AMI,t.region).get(t.imageId);if(!n)return;n=n.toJSON(),n.imageSize=n.imageSize||((o=n.blockDeviceMapping[n.rootDeviceName])!=null?o.volumeSize:void 0);try{i=App.model.getOsFamilyConfig(t.region),i=i[n.osFamily]||i[r.OS_TYPE_MAPPING[n.osType]],i=n.rootDeviceType==="ebs"?i.ebs:i["instance store"],i=i[n.architecture],i=i[n.virtualizationType||"paravirtual"],n.instanceType=i.join(", ")}catch(u){s=u}return MC.template.bubbleAMIInfo(n)},MC.template.resPanelDbSnapshot=function(t){var i;if(!t.region||!t.id)return;i=e(r.RESTYPE.DBSNAP,t.region).get(t.id);if(!i)return;return n.resourcePanelBubble(i.toJSON())},MC.template.resPanelSnapshot=function(t){var i;if(!t.region||!t.id)return;i=e(r.RESTYPE.SNAP,t.region).get(t.id);if(!i)return;return n.resourcePanelBubble(i.toJSON())},v=Backbone.View.extend({tagName:"li",className:"resource-item asg",initialize:function(e){this.parent=e.parent,(this.parent||this).$el.find(".resource-list-asg").append(this.$el),this.listenTo(this.model,"change:name",this.render),this.listenTo(this.model,"change:imageId",this.render),this.listenTo(this.model,"destroy",this.remove),this.render(),this.$el.attr({"data-type":"ASG","data-option":'{"lcId":"'+this.model.id+'"}'})},render:function(){return this.$el.html(n.reuse_lc({name:this.model.get("name"),cachedAmi:this.model.getAmi()||this.model.get("cachedAmi")}))}}),Backbone.View.extend({events:{"click .btn-fav-ami":"toggleFav","OPTION_CHANGE .AmiTypeSelect":"changeAmiType","click .BrowseCommunityAmi":"browseCommunityAmi","click .ManageEbsSnapshot":"manageEbsSnapshot","click .ManageRdsSnapshot":"manageRdsSnapshot","click .fixedaccordion-head":"updateAccordion",RECALC:"recalcAccordion","mousedown .resource-item":"startDrag","click .refresh-resource-panel":"refreshPanelData","click .resources-dropdown-wrapper li":"resourcesMenuClick","OPTION_CHANGE #resource-list-sort-select-snapshot":"resourceListSortSelectSnapshotEvent","OPTION_CHANGE #resource-list-sort-select-rds-snapshot":"resourceListSortSelectRdsEvent"},initialize:function(n){var i,s;return _.extend(this,n),this.subViews=[],s=this.workspace.opsModel.get("region"),this.listenTo(e("MyAmi",s),"update",this.updateMyAmiList),this.listenTo(e(r.RESTYPE.AZ,s),"update",this.updateAZ),this.listenTo(e(r.RESTYPE.SNAP,s),"update",this.updateSnapshot),this.listenTo(e(r.RESTYPE.DBSNAP,s),"update",this.updateRDSSnapshotList),i=this.workspace.design,this.listenTo(i,t.EVENT.ChangeResource,this.onResChanged),this.listenTo(i,t.EVENT.AddResource,this.updateDisableItems),this.listenTo(i,t.EVENT.RemoveResource,this.updateDisableItems),this.listenTo(i,t.EVENT.AddResource,this.updateLc),this.listenTo(this.workspace,"toggleRdsFeature",this.toggleRdsFeature),this.__amiType="QuickStartAmi",this.setElement(this.parent.$el.find(".OEPanelLeft")),$(document).off("keydown",this.bindKey.bind(this)).on("keydown",this.bindKey.bind(this)),this.render()},render:function(){this.$el.html(n.panel({rdsDisabled:this.workspace.isRdsDisabled()})),this.$el.toggleClass("hidden",this.__leftPanelHidden||!1),this.recalcAccordion(),this.updateAZ(),this.updateSnapshot(),this.updateAmi(),this.updateRDSList(),this.updateRDSSnapshotList(),this.updateDisableItems(),this.renderReuse(),this.$el.find(".nano").nanoScroller()},resourceListSortSelectRdsEvent:function(e){var t,n,r;r="date",e&&(t=$(e.currentTarget),r=t.find(".selected").data("id")),n=[],r==="date"&&(n=this.$el.find(".resource-list-rds-snapshot li").sort(function(e,t){return new Date($(t).data("date"))-new Date($(e).data("date"))})),r==="engine"&&(n=this.$el.find(".resource-list-rds-snapshot li").sort(function(e,t){return $(e).data("engine")-$(t).data("engine")})),r==="storge"&&(n=this.$el.find(".resource-list-rds-snapshot li").sort(function(e,t){return Number($(t).data("storge"))-Number($(e).data("storge"))}));if(n.length)return this.$el.find(".resource-list-rds-snapshot").html(n)},resourceListSortSelectSnapshotEvent:function(e){var t,n,r;r="date",e&&(t=$(e.currentTarget),r=t.find(".selected").data("id")),n=[],r==="date"&&(n=this.$el.find(".resource-list-snapshot li").sort(function(e,t){return new Date($(t).data("date"))-new Date($(e).data("date"))})),r==="storge"&&(n=this.$el.find(".resource-list-snapshot li").sort(function(e,t){return Number($(e).data("storge"))-Number($(t).data("storge"))}));if(n.length)return this.$el.find(".resource-list-snapshot").html(n)},bindKey:function(e){var t,n,r,i,s,o;o=this,n=e.which,r=e.ctrlKey||e.metaKey,i=e.shiftKey,s=e.target.tagName.toLowerCase(),t=s==="input"||s==="textarea";if(r===!1&&i===!1&&n===82&&t===!1)return o.toggleResourcePanel(),!1},renderReuse:function(){var e,t,n,i;i=this.workspace.design.componentsOfType(r.RESTYPE.LC);for(t=0,n=i.length;t<n;t++)e=i[t],e.get("appId")||new v({model:e,parent:this});return this},updateLc:function(e){if(e.type===r.RESTYPE.LC&&!e.get("appId"))return new v({model:e,parent:this})},onResChanged:function(e){if(!e)return;if(e.type!==r.RESTYPE.AZ)return;this.updateAZ()},updateAZ:function(t){var n,i,s,o,u,a,f;if(!this.workspace.isAwake())return;if(t&&t.type!==r.RESTYPE.AZ)return;s=this.workspace.opsModel.get("region"),o=function(){var e,t,n,s;n=this.workspace.design.componentsOfType(r.RESTYPE.AZ)||[],s=[];for(e=0,t=n.length;e<t;e++)i=n[e],s.push(i.get("name"));return s}.call(this),n=[],f=e(r.RESTYPE.AZ,s).where({category:s})||[];for(u=0,a=f.length;u<a;u++)i=f[u],o.indexOf(i.id)===-1&&n.push(i.id);this.$el.find(".az").toggleClass("disabled",n.length===0).data("option",{name:n[0]}).children(".resource-count").text(n.length)},updateSnapshot:function(){var t,i;return i=this.workspace.opsModel.get("region"),t=e(r.RESTYPE.SNAP,i).where({category:i})||[],t.region=t.length?i:r.REGION_SHORT_LABEL[i],this.$el.find(".resource-list-snapshot").html(n.snapshot(t))},toggleRdsFeature:function(){this.$el.find(".ManageRdsSnapshot").parent().toggleClass("disableRds",this.workspace.isRdsDisabled()),this.workspace.isRdsDisabled()||(this.updateRDSList(),this.updateRDSSnapshotList()),this.updateDisableItems(),this.$el.children(".sidebar-title").find(".icon-rds-snap,.icon-pg").toggleClass("disabled",this.workspace.isRdsDisabled())},updateRDSList:function(){var t;return t=e(r.RESTYPE.DBENGINE,this.workspace.opsModel.get("region")).groupBy("DBEngineDescription"),this.$el.find(".resource-list-rds").html(n.rds(t))},updateRDSSnapshotList:function(){var t,i;return i=this.workspace.opsModel.get("region"),t=e(r.RESTYPE.DBSNAP,i).toJSON(),t.region=t.length?i:r.REGION_SHORT_LABEL[i],this.$el.find(".resource-list-rds-snapshot").html(n.rds_snapshot(t))},changeAmiType:function(e,t){this.__amiType=t||"QuickStartAmi",this.updateAmi(),$(e.currentTarget).parent().hasClass(".open")||$(e.currentTarget).parent().click()},updateAmi:function(){var t,r;return r=e(this.__amiType,this.workspace.opsModel.get("region")).getModels().sort(function(e,t){var n,r;return e=e.attributes,t=t.attributes,e.osType==="windows"&&t.osType!=="windows"?1:e.osType!=="windows"&&t.osType==="windows"?-1:(n=e.osType,r=t.osType,n===r&&(n=e.architecture,r=t.architecture,n===r&&(n=e.name,r=t.name)),n>r?1:-1)}),r.fav=this.__amiType==="FavoriteAmi",r.region=this.workspace.opsModel.get("region"),t=n.ami(r),this.$el.find(".resource-list-ami").html(t).parent().nanoScroller("reset")},updateDisableItems:function(e){var t,n,i,s,o,u,a,f,l,c;if(!this.workspace.isAwake())return;this.updateAZ(e),s=this.workspace.design,n=r.RESTYPE,t=this.$el.find(".resource-item.igw").parent(),t.children(".resource-item.igw").toggleClass("disabled",s.componentsOfType(n.IGW).length>0),t.children(".resource-item.vgw").toggleClass("disabled",s.componentsOfType(n.VGW).length>0),i={},c=s.componentsOfType(n.SUBNET);for(f=0,l=c.length;f<l;f++)u=c[f],i[u.parent().get("name")]=!0;this.sbg=this.$el.find(".resource-item.subnetgroup"),_.keys(i).length<2?(o=!0,a="To create subnet group, there must to be subnets from at least 2 different availability zones on canvas.",this.sbg.toggleClass("disabled",!0).attr("data-tooltip")):(o=!1,a=p.IDE.RES_TIP_DRAG_NEW_SUBNET_GROUP),this.workspace.isRdsDisabled()&&(o=!0,a=p.IDE.RES_MSG_RDS_DISABLED),this.sbg.toggleClass("disabled",o).attr("data-tooltip",a)},updateFavList:function(){if(this.__amiType==="FavoriteAmi")return this.updateAmi()},updateMyAmiList:function(){if(this.__amiType==="MyAmi")return this.updateAmi()},toggleFav:function(t){var n,r;return n=$(t.currentTarget).toggleClass("fav"),r=e("FavoriteAmi",this.workspace.opsModel.get("region")),n.hasClass("fav")?r.fav(n.attr("data-id")):r.unfav(n.attr("data-id")),!1},toggleLeftPanel:function(){return this.__leftPanelHidden=this.$el.toggleClass("hidden").hasClass("hidden"),null},toggleResourcePanel:function(){return this.toggleLeftPanel()},updateAccordion:function(e,t){var n,r,i,s,o,u,a,f;u=$(e.currentTarget),n=u.closest(".accordion-group");if(e.target&&!$(e.target).hasClass("fixedaccordion-head"))return;return n.hasClass("expanded")?!1:(this.__openedAccordion=n.index(),o=n.siblings(".expanded"),s=n.children(".accordion-body"),i=n.closest(".fixedaccordion"),r=i.parent(),a=i.children().filter(function(){return $(this).css("display")!=="none"}),f=r.outerHeight()-39-a.length*u.outerHeight(),s.outerHeight(f),t?(n.addClass("expanded").children(".nano").nanoScroller("reset"),o.removeClass("expanded"),!1):(s.slideDown(200,function(){return n.addClass("expanded").children(".nano").nanoScroller("reset")}),o.children(".accordion-body").slideUp(200,function(){return o.closest(".accordion-group").removeClass("expanded")}),!1))},recalcAccordion:function(){var e,t,n,r;r=this.$el;if(!r.length)return;return t=r.children(".fixedaccordion").children(),e=t.filter(".expanded"),e.length===0&&(e=t.eq(this.__openedAccordion||0)),n=e.removeClass("expanded").children(".fixedaccordion-head"),this.updateAccordion({currentTarget:n[0]},!0)},browseCommunityAmi:function(){var t,n;return n=this.workspace.opsModel.get("region"),this.listenTo(e("FavoriteAmi",n),"update",this.updateFavList),t=new h({region:n}),t.onClose=function(t){return function(){return t.stopListening(e("FavoriteAmi",n),"update",t.updateFavList)}}(this),!1},manageEbsSnapshot:function(){return(new s).render()},manageRdsSnapshot:function(){return(new o).render()},refreshPanelData:function(t){var n,i,s;n=$(t.currentTarget);if(n.hasClass("reloading"))return;n.addClass("reloading"),s=this.workspace.opsModel.get("region"),i=[e("MyAmi",s).fetchForce(),e(r.RESTYPE.SNAP,s).fetchForce()],this.workspace.isRdsDisabled()?i.push(this.workspace.fetchRdsData()):i.push(e(r.RESTYPE.DBSNAP,s).fetchForce()),Q.all(i).done(function(){return n.removeClass("reloading")})},resourcesMenuClick:function(e){var t,n;t=$(e.currentTarget),n=t.data("action");switch(n){case"keypair":return(new f).render();case"snapshot":return(new s).render();case"sns":return(new a).render();case"sslcert":return(new u).render();case"dhcp":return(new i).manageDhcp();case"rdspg":return(new l).render();case"rdssnapshot":return(new c).render()}},startDrag:function(e){var t,n,i,s;if(e.button!==0)return!1;t=$(e.currentTarget);if(t.hasClass("disabled"))return!1;if(e.target&&$(e.target).hasClass("btn-fav-ami"))return;return s=r.RESTYPE[t.attr("data-type")],n="#OpsEditor .OEPanelCenter",s===r.RESTYPE.INSTANCE&&(n+=",#changeAmiDropZone"),i=$.extend(!0,{},t.data("option")||{}),i.type=s,t.dnd(e,{dropTargets:$(n),dataTransfer:i,eventPrefix:s===r.RESTYPE.VOL?"addVol_":"addItem_",onDragStart:function(e){if(s===r.RESTYPE.AZ)return e.shadow.children(".res-name").text(t.data("option").name);if(s===r.RESTYPE.ASG)return e.shadow.text("ASG")}}),!1},remove:function(){_.invoke(this.subViews,"remove"),this.subViews=null,Backbone.View.prototype.remove.call(this)}})})}.call(this),define("workspaces/editor/template/TplStatusbar",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<ul class="status-bar"></ul>\n<div class="status-bar-modal" style="display: none;"></div>'},n.frame=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'Last saved: <span class="stack-save-time">-<span>'},n.lastSaved=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<span class="state-success"><i class="status status-green icon-label"></i><b>'+a((o=t&&t.successCount,typeof o===u?o.apply(t):o))+'</b></span>\n<span class="state-failed"><i class="status status-red icon-label"></i><b>'+a((o=t&&t.failCount,typeof o===u?o.apply(t):o))+"</b></span>",s},n.state=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"Validate"},n.ta=e.template(t),n}),function(){define("workspaces/editor/subviews/Statusbar",["OpsModel","Design","../template/TplStatusbar","constant","backbone","event","state_status"],function(e,t,n,r,i,s,o){var u,a;return a=[{name:"lastSaved",className:"info",visible:!0,events:{update:function(){return[{obj:null,event:"jsonDataSaved"}]}},update:function(e,t){var n;return n=jQuery.now()/1e3,this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){var t,r;t=e(".stack-save-time"),r=MC.intervalDate(n);if(t.text()!==r)return t.text(r)},1e3),null},click:function(e){return null},remove:function(){return clearInterval(this.timer)}},{name:"ta",className:"status-bar-btn",visible:function(e,t){var n,r;return r=t.design.mode(),r==="app"||r==="appview"?n=!1:n=!0,typeof e=="function"&&e(n),n},changeVisible:!0,click:function(e){var t,n;return t=$(e.currentTarget),n="Validate",t.text("Validating..."),setTimeout(function(){return MC.ta.validAll(),t.text(n),require(["component/trustedadvisor/gui/main"],function(e){return e.loadModule("statusbar",null)})},50)}},{name:"state",className:"status-bar-btn",visible:function(t,n){var r,i,s;return s=n.design.mode(),r=_.every([e.State.Updating,e.State.Running,e.State.Saving],function(e){return!n.opsModel.testState(e)}),i=!1,s==="app"||s==="appedit"?i=!r:s==="appview"&&(i=!1),typeof t=="function"&&t(i),i},events:{update:[{obj:s,event:s.UPDATE_STATE_STATUS_DATA}]},changeVisible:!0,update:function(e,t){var n;return n=this.renderData(!0,t),e(".state-success b").text(n.successCount),e(".state-failed b").text(n.failCount)},renderData:function(e,t){var n,r,i,s,o,u,a,f,l,c;this.workspace=t;if(!e)return{};i=App.WS.collection.status.find().fetch(),o=n=0,_.isArray(i)||(i=[i]);for(u=0,f=i.length;u<f;u++){r=i[u];if(r.app_id!==t.opsModel.get("id"))continue;if(r.status){c=r.status;for(a=0,l=c.length;a<l;a++)s=c[a],s.result==="success"?o++:s.result==="failure"&&n++}}return{successCount:o,failCount:n}},click:function(e){return o.loadModule()}}],u=i.View.extend({tagName:"li",initialize:function(){return _.bindAll(this,"render","toggle"),this.clearGarbage=[],this.needUpdate=[]},render:function(){return this.$el.html(this.template(this.data)),this},toggle:function(e){return this.$el.toggle(e)},remove:function(){var e,t,n,r;this.$el.remove(),this.stopListening(),r=this.clearGarbage;for(t=0,n=r.length;t<n;t++)e=r[t],_.isArray(e)?e[1].apply(e[0],e.slice(2)):e();return this.clearGarbage=[],this.needUpdate=[],this},update:function(){var e,t,n,r;r=this.needUpdate;for(t=0,n=r.length;t<n;t++)e=r[t],e();return this}}),i.View.extend({initialize:function(e){var t;return _.extend(this,e),t=this.workspace,this.itemViews=[],this.setElement(this.parent.$el.find(".OEPanelBottom").html(n.frame())),this.renderItem()},ready:!1,bindItem:function(){var e,t,r,i,o,f,l,c,h,p,d,v,m,g,y,b,w;b=jQuery.extend(!0,[],a).reverse();for(r=v=0,g=b.length;v<g;r=++v){o=b[r],l=new u,l.delegateEvents({click:o.click}),l.template=n[o.name],l.$el.addClass(o.className),c=_.bind(l.$,l),h=_.bind(l.toggle,l),_.isFunction(o.visible)&&(d=_.bind(o.visible,o,h,this.workspace)),_.isFunction(o.update)&&(p=_.bind(o.update,o,c,this.workspace)),w=o.events;for(f in w){t=w[f],_.isFunction(t)&&(t=t());if(!_.isArray(t))continue;for(m=0,y=t.length;m<y;m++)e=t[m],f==="update"&&(e.obj===s?(s.onLongListen(e.event,p),l.clearGarbage.push([s,s.offListen,e.event,p])):l.listenTo(e.obj||this.workspace.opsModel,e.event,p))}o.changeVisible&&(o.visible&&l.needUpdate.push(d),o.update&&l.needUpdate.push(p)),_.isFunction(o.visible)?i=o.visible(l.toggle,this.workspace):(l.toggle(o.visible),i=o.visible),l.data=(typeof o.renderData=="function"?o.renderData(i,this.workspace):void 0)||{},o.remove&&l.clearGarbage.push(_.bind(o.remove,o)),this.itemViews.push(l)}return null},renderItem:function(){var e,t,n,r,i;e=this,this.ready||(this.bindItem(),this.ready=!0),i=this.itemViews;for(n=0,r=i.length;n<r;n++)t=i[n],this.$("ul").append(t.render().el);return this},update:function(){var e,t,n,r,i;r=this.itemViews,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.update());return i},remove:function(){var e,t,n,r;this.$el.remove(),this.stopListening(),r=this.itemViews;for(t=0,n=r.length;t<n;t++)e=r[t],e.remove();return this}})})}.call(this),define("workspaces/editor/canvas/TplSvgDef",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<svg style="display:none;" id="svgDefs"><defs>\n  <path d="M-5 0.5l5.5 -5.5l5.5 5.5 l-5.5 5.5z" id="port_diamond"></path>\n  <path d="M8 0.5l-6 -5.5l-2 0 l0 11 l2 0z" id="port_right"></path>\n  <path d="M-8 0.5l6 -5.5l2 0 l0 11 l-2 0z" id="port_left"></path>\n  <path d="M0.5 0l5.5 0l0 -2l-5.5 -6l-5.5 6l0 2z" id="port_top"></path>\n  <path d="M0.5 0l5.5 0l0 2l-5.5 6l-5.5 -6l0 -2z" id="port_bottom"></path>\n  <path d="M0 74h90v11a5 5 0 0 1 -5 5h-80a5 5 0 0 1 -5 -5z" id="label_path" data-readonly="true"></path>\n\n  <g id="asg_frame">\n    <rect class="group-asg" rx="5" ry="5" height="129" x="1" y="1" width="129"></rect>\n    <path d="M0 21l0 -16a5 5 0 0 1 5 -5l121 0a5 5 0 0 1 5 5l0 16z" class="asg-title"></path>\n  </g>\n  <text id="asg_prompt">\n    <tspan x="25" y="47">'+o(n.i18n.call(t,"CANVAS.CVS_ASG_DROP_LC_1",{hash:{},data:i}))+'</tspan>\n    <tspan x="20" y="67">'+o(n.i18n.call(t,"CANVAS.CVS_ASG_DROP_LC_2",{hash:{},data:i}))+'</tspan>\n    <tspan x="30" y="87">'+o(n.i18n.call(t,"CANVAS.CVS_ASG_DROP_LC_3",{hash:{},data:i}))+'</tspan>\n    <tspan x="30" y="107">'+o(n.i18n.call(t,"CANVAS.CVS_ASG_DROP_LC_4",{hash:{},data:i}))+'</tspan>\n  </text>\n\n  <g id="asg_dragger">\n    <rect height="14" width="14" fill="transparent" x="114" y="3"/>\n    <path d="M114.26 11.447 c-0.44 2.83 -0.252 5.113 -0.12 5.313 c0.204 0.398 4.473 0.24 5.512 -0.133 c0.86 -0.604 -0.623 -1.15 -1.094 -1.962 c0.471 -0.611 1.976 -2.352 2.324 -2.865 c-0.28 -1.65 -1.649 -1.818 -1.78 -1.76 c -0.13 0.06 -2.809 2.411 -2.809 2.411 c0 0 -0.925 -0.997 -1.292 -1.259 c-0.465 -0.322 -0.742 0.18 -0.742 0.254 l0 0z m13.482 -2.895 c0.437 -2.83 0.25 -5.115 0.118 -5.315 c-0.204 -0.396 -4.473 -0.227 -5.514 0.135 c-0.856 0.604 0.626 1.15 1.096 1.962 c-0.47 0.611 -1.976 2.352 -2.323 2.868 c0.293 1.648 1.648 1.815 1.778 1.758 c0.13 -0.06 2.805 -2.41 2.805 -2.41 c0.004 0 0.93 0.994 1.3 1.26 c0.461 0.32 0.74 -0.184 0.74 -0.26 l0 0Z"/>\n  </g>\n\n  <g id="clone_indicator" data-readonly="true">\n    <rect fill="#000" width="23" height="23" rx="4" ry="4"></rect>\n    <path d="M8 7c0-1.112.895-2 2-2h6c1.112 0 2 .895 2 2v6c0 1.112-.895 2-2 2v-6c0-1.103-.898-2-2-2h-6zm-1 1c-1.1 0-2 .887-2 2v6c0 1.1.887 2 2 2h6c1.1 0 2-.887 2-2v-6c0-1.1-.887-2-2-2h-6zm1 2c-.547 0-1 .451 -1 1v4c0 .547.45 1 1 1h4c.547 0 1 -.45 1-1v-4c0-.547-.45-1-1-1h-4z" fill-rule="evenodd" fill="#FFF"></path>\n  </g>\n\n  <g id="replica_dragger">\n    <rect x="34" y="53" width="22" height="22" rx="3" class="replica-bg"/>\n    <path d="M44.5 57c3.038 0 5.5 1.119 5.5 2.5s-2.462 2.5-5.5 2.5-5.5-1.119-5.5-2.5 2.462-2.5 5.5-2.5zm5.5 9h-3v2h3v2l4-3-4-3v2zm-1 3h-2c-.552 0-1-.448-1-1v-2c0-.552.448-1 1-1h2c0-.552.448-1 1-1v-3h-.11c-.51 1.141-2.729 2-5.39 2-2.661 0-4.88-.859-5.39-2h-.11v8h.11c.51 1.141 2.729 2 5.39 2 2.069 0 3.859-.522 4.798-1.29-.184-.181-.298-.432-.298-.71z"/>\n  </g>\n\n  <g id="restore_dragger">\n    <rect x="34" y="0" width="22" height="22" rx="3" class="restore-bg"/>\n    <path d="M53.131,0C30.902,0,12.832,17.806,12.287,39.976H0l18.393,20.5l18.391-20.5H22.506C23.045,23.468,36.545,10.25,53.131,10.25  c16.93,0,30.652,13.767,30.652,30.75S70.061,71.75,53.131,71.75c-6.789,0-13.059-2.218-18.137-5.966l-7.029,7.521  C34.904,78.751,43.639,82,53.131,82C75.703,82,94,63.645,94,41S75.703,0,53.131,0z M49.498,19v23.45l15.027,15.024l4.949-4.949  L56.5,39.55V19H49.498z" transform="scale(0.17) translate(215,28) rotate(0 822.5 296)" stroke-width="0" style="position: relative;" />\n  </g>\n\n  <g id="sbg_info" data-readonly="true">\n    <circle cx="10" cy="10" r="6"></circle>\n    <path fill="#fff" d="M9,9 L9,14 L11,14 L11,9 L9,9 Z M10,8 C10.55,8 11,7.55 11,7 C11,6.448 10.55,6 10,6 C9.448,6 9,6.448 9,7 C9,7.55 9.448,8 10,8 Z"></path>\n  </g>\n\n</defs></svg>',s};return e.template(t)}),function(){define("workspaces/editor/canvas/CanvasManager",["CloudResources"],function(e){var t;return t={hasClass:function(e,t){var n,r,i,s;if(!e)return!1;!e.length&&e.length!==0&&(e=[e]);for(i=0,s=e.length;i<s;i++){n=e[i],r=" "+(n.getAttribute("class")||"")+" ";if(r.indexOf(" "+t+" ")>=0)return!0}return!1},removeClass:function(e,t){var n,r,i,s,o;if(!e)return this;!e.length&&e.length!==0&&(e=[e]);for(s=0,o=e.length;s<o;s++)n=e[s],r=n.getAttribute("class")||"",i=r.replace(new RegExp("\\b"+t+"\\b","g"),""),r!==i&&n.setAttribute("class",i);return this},addClass:function(e,t){var n,r,i,s;if(!e)return this;!e.length&&e.length!==0&&(e=[e]);for(i=0,s=e.length;i<s;i++)n=e[i],r=n.getAttribute("class")||"",r.match(new RegExp("\\b"+t+"\\b"))||(r=$.trim(r)+" "+t,n.setAttribute("class",r));return this},toggle:function(e,t){e.hasOwnProperty("length")&&(e=e[0]);if(!e)return this;if(t===null||t===void 0)t=e.getAttribute("display")==="none";return t?(e.setAttribute("display",""),e.getAttribute("data-tooltip")&&this.addClass(e,"tooltip")):(e.setAttribute("display","none"),this.removeClass(e,"tooltip")),this},updateEip:function(e,t){var n,r,i,s,o;return e.length&&(e=e[0]),i=t.hasPrimaryEip(),i?(s="Detach Elastic IP from primary IP",n="ide/icon/icn-eipon.png"):(s="Associate Elastic IP to primary IP",n="ide/icon/icn-eipoff.png"),t.design().modeIsApp()&&(t.getEmbedEni&&(t=t.getEmbedEni()),t?(r=(t.get("ips")||[])[0],s=(r!=null?(o=r.eipData)!=null?o.publicIp:void 0:void 0)||""):void 0),e.setAttribute("data-tooltip",s),$(e).data("tooltip",s),this.update(e,n,"href"),null},update:function(e,n,r){var i,s,o,u,a,f,l,c;_.isString(e)&&(e=document.getElementById(e)),e=$(e);if(!r)return e.text(MC.truncate(n,17));if(r==="href"||r==="image"){n=MC.IMG_URL+n,l=[];for(o=0,a=e.length;o<a;o++)i=e[o],s=i.getAttributeNS("http://www.w3.org/1999/xlink","href"),s!==n?l.push(i.setAttributeNS("http://www.w3.org/1999/xlink","href",n)):l.push(void 0);return l}if(r==="tooltip"){e.data("tooltip",n).attr("data-tooltip",n),c=[];for(u=0,f=e.length;u<f;u++)i=e[u],n?c.push(t.addClass(i,"tooltip")):c.push(t.removeClass(i,"tooltip"));return c}return r==="color"?e.attr("style","fill:"+n):e.attr(r,n)},setLabel:function(e,t){var n,r,i,s,o,u,a,f;u=e.label(),o=e.labelWidth(),_.isString(t)&&(t=document.getElementById(t)),!t.length&&t.length!==0&&(t=[t]);if(!u.length){$(t).text(u);return}$(t[0]).text(u);try{n=t[0].getSubStringLength(0,u.length)}catch(l){r=l,n=0}if(n>o){s=u.length-1;while(s>0){if(t[0].getSubStringLength(0,s)+8<=o){u=u.substr(0,s)+"...";break}--s}}for(a=0,f=t.length;a<f;a++)i=t[a],$(i).text(u)}},t})}.call(this),function(){define("workspaces/editor/canvas/CanvasElement",["Design","./CanvasManager","i18n!/nls/lang.js","UI.modalplus","event","backbone","svg"],function(e,t,n,r,i){var s,o,u,a;return o=null,a=Backbone.Model.extend,u={},s=Backbone.View.extend({_ensureElement:function(){this.$el||(this.$el=$())},initialize:function(e){this.canvas=e.canvas,this.addView(this.create()),this.render(),this.listenTo(this.model,"change:name",this.render),this.listenModelEvents(),this.ensureStickyPos()},listenModelEvents:function(){},addView:function(e){return e?(this.$el=this.$el.add(e.node?e.node:e),this.delegateEvents(),this):this},removeView:function(e){return e?(e.node&&(e=e.node),this.undelegateEvents(),this.$el=this.$el.not(e),$(e).remove(),this.delegateEvents(),this):this},portDirection:function(e){return this.portDirMap?this.portDirMap[e]:null},portPosition:function(e,t){var n;return this.portPosMap?(n=this.portPosMap[e],t&&n.length>=5?[n[3],n[4],n[2]]:n):null},hover:function(e){var n,r,i,s;s=this.connections();for(r=0,i=s.length;r<i;r++)n=s[r],t.addClass(n.$el,"hover")},hoverOut:function(e){var n,r,i,s;s=this.connections();for(r=0,i=s.length;r<i;r++)n=s[r],t.removeClass(n.$el,"hover")},create:function(){},render:function(){},size:function(){var e;return this.model.width&&this.model.width()?{width:this.model.width(),height:this.model.height()}:this.defaultSize?{width:this.defaultSize[0],height:this.defaultSize[1]}:(e=this.$el[0].getBBox(),void 0,{width:e.width,height:e.height})},pos:function(e){var t,n,r,i;r=this.model.x(),i=this.model.y();if(e){e=e.parentNode;while(e){t=e.getAttribute("data-id"),n=this.canvas.getItem(t);if(!n)break;r+=n.model.x(),i+=n.model.y(),e=e.parentNode}}return{x:r,y:i}},containPoint:function(e,t,n){var r,i,s,o,u,a,f,l;s=[this.rect()];if(n){l=this.children(!0);for(o=0,a=l.length;o<a;o++)r=l[o],r.sticky&&s.push(r.rect())}for(u=0,f=s.length;u<f;u++){i=s[u];if(i.x1<=e&&i.y1<=t&&i.x2>=e&&i.y2>=t)return!0}return!1},rect:function(e){var t,n;return n=this.size(),t=this.pos(e),{x1:t.x,y1:t.y,x2:t.x+n.width,y2:t.y+n.height}},effectiveRect:function(){var e;return e=this.rect(),this.isGroup()&&(e.x1-=1,e.y1-=1,e.x2+=1,e.y2+=1),e},ensureStickyPos:function(e,t){var n,r,i,s,u;if(!this.sticky)return;i=this.size(),r=this.parent().rect(),n=function(e,t,n){return e<=t?t:e>=n?n:e},s=e||this.model.x(),u=t||this.model.y(),s<0&&(s=Math.round((r.x2-r.x1-i.width)/2)),u<0&&(u=Math.round((r.y2-r.y1-i.height)/2)),s=n(s,r.x1,r.x2-i.width),u=n(u,r.y1,r.y2-i.height);switch(this.sticky){case"left":s=r.x1-Math.round(i.width/2);break;case"right":s=r.x2-Math.round(i.width/2);break;case"top":u=r.y1-Math.round(i.height/2);break;case"bottom":u=r.y2-Math.round(i.height/2)}if(this.model.attributes.x===s&&this.model.attributes.y===u)return;this.model.attributes.x=s,this.model.attributes.y=u,this.$el[0].instance.move(s*o.GRID_WIDTH,u*o.GRID_HEIGHT),this.updateConnections()},initNode:function(e,t,n){var r,i,s,u,a,f,l;e.move(t*o.GRID_WIDTH,n*o.GRID_HEIGHT),l=e.children();for(a=0,f=l.length;a<f;a++){i=l[a],r=i.node;if(r.tagName.toLowerCase()!=="path")continue;s=i.attr("data-alias")||i.attr("data-name"),s&&(u=this.portPosition(s),u&&i.move(u[0],u[1]))}return null},createNode:function(e){var t,n,r,i,s,u,a,f;return r=this.model,i=this.size(),a=r.x(),f=r.y(),u=i.width*o.GRID_WIDTH,n=i.height*o.GRID_HEIGHT,s=this.canvas.svg,t=s.group(),t.add([s.rect(u-1,n-1).move(.5,.5).radius(5).classes("node-background"),s.image(MC.IMG_URL+e.image,e.imageW,e.imageH).move(e.imageX,e.imageY)]).attr({"data-id":this.cid}).classes("canvasel "+this.type.replace(/\./g,"-")),e.labelBg&&t.add(s.use("label_path").classes("node-label-name-bg")),e.label&&t.add(s.plain(e.label).move(u/2,n-4).classes("node-label")),e.sg&&t.add(s.group().add([s.rect(7,5).move(10,6).classes("node-sg-color-border tooltip"),s.rect(7,5).move(20,6).classes("node-sg-color-border tooltip"),s.rect(7,5).move(30,6).classes("node-sg-color-border tooltip"),s.rect(7,5).move(40,6).classes("node-sg-color-border tooltip"),s.rect(7,5).move(50,6).classes("node-sg-color-border tooltip")]).classes("node-sg-color-group").move(8,63)),t},createGroup:function(){var e,t,n,r,i,s,u,a;return n=this.model,u=n.x(),a=n.y(),s=n.width()*o.GRID_WIDTH,t=n.height()*o.GRID_HEIGHT,r=10,i=this.canvas.svg,e=i.group(),e.add([i.rect(s,t).radius(5).classes("group"),i.rect(s-2*r,r).x(r).classes("group-resizer top"),i.rect(r,t-2*r).y(r).classes("group-resizer left"),i.rect(r,t-2*r).move(s-r,r).classes("group-resizer right"),i.rect(s-2*r,r).move(r,t-r).classes("group-resizer bottom"),i.rect(r,r).classes("group-resizer top-left"),i.rect(r,r).x(s-r).classes("group-resizer top-right"),i.rect(r,r).y(t-r).classes("group-resizer bottom-left"),i.rect(r,r).move(s-r,t-r).classes("group-resizer bottom-right"),i.text("").move(5,15).classes("group-label")]).attr({"data-id":this.cid}).classes("canvasel group "+this.type.replace(/\./g,"-"))},label:function(){return this.model.type==="ExpandedAsg"&&this.model.get("originalAsg")?this.model.get("originalAsg").get("groupName"):this.model.get("name")},labelWidth:function(e){return(e||this.size().width*o.GRID_WIDTH)-8},isGroup:function(){return!!this.model.node_group},isTopLevel:function(){return this.model.parent?this.model.parent()?!1:!0:!1},parent:function(){var e;return e=this.model.parent(),e?this.canvas.getItem(e.id):null},children:function(e){var t,n,r,i,s,o,u;if(!this.model.node_group)return[];t=this.canvas,i=[],u=this.model.children();for(s=0,o=u.length;s<o;s++){n=u[s],r=t.getItem(n.id);if(!r)continue;if(r.sticky&&!e)continue;i.push(r)}return i},siblings:function(e){var t,n;return n=this.parent().children(e),t=n.indexOf(this),t>=0&&n.splice(t,1),n},connections:function(){var e,t,n,r,i;t=[],i=this.model.connections();for(n=0,r=i.length;n<r;n++)e=i[n],e=this.canvas.getItem(e.id),e&&e.node_line&&t.push(e);return t},isConnectable:function(t,n,r){var i,s,o,u,a,f,l;i=e.modelClassForPorts(t,r);if(!i)return!1;s=this.model,o=this.model.design().component(n),l=s.connectionTargets(i.prototype.type);for(a=0,f=l.length;a<f;a++){u=l[a];if(u===o)return!1}return i.isConnectable(s,o)!==!1},select:function(e){i.trigger(i.OPEN_PROPERTY,this.type,this.model.id)},destroy:function(e){var t,i,s,o,u,a;if(this.model.isRemoved()){this.$el.remove(),this.$el=$();return}t=this.canvas,u=this.isDestroyable(),s=this.model,o=s.get("name"),u===!0&&s.node_group&&s.children().length>0&&(u=sprintf(n.CANVAS.CVS_CFM_DEL_GROUP,o)),_.isString(u)?(a=this,i=new r({title:sprintf(n.CANVAS.CVS_CFM_DEL,o),template:u,confirm:{text:n.IDE.CFM_BTN_DELETE,color:"red"},onConfirm:function(){a.doDestroyModel(),i.close()}})):u.error?notification("error",u.error):u===!0&&this.doDestroyModel()},doDestroyModel:function(){return this.model.remove()},isDestroyable:function(e){var t,n,r,i,s;n=this.model.isRemovable();if(n!==!0)return n;if(this.model.node_group){s=this.children();for(r=0,i=s.length;r<i;r++){t=s[r],n=t.isDestroyable();if(n!==!0)break}}return n},isClonable:function(){return!!this.model.clone},cloneTo:function(e,t,n){var r,i,o,u;if(!this.model.clone)return;i=this.model.get("name"),o=i.match(/(.+-copy)(\d*)$/),o?i=o[1]+((parseInt(o[2],10)||0)+1):i+="-copy",r=s.getClassByType(this.type).createResource(this.type,{parent:e.model,name:i,x:t,y:n},{cloneSource:this.model}),r&&r.id&&(u=this,_.defer(function(){return u.canvas.selectItem(r.id)}))},changeParent:function(e,t,r){var i,s;if((this.parent()||null)===e){if(this.model.x()===t&&this.model.y()===r)return;this.moveBy(t-this.model.x(),r-this.model.y());return}if(this.model.get("appId")){notification("error",n.NOTIFY.WARN_OPERATE_NOT_SUPPORT_YET);return}if(!this.parent()&&e)return;i=e.model,s=this.model.isReparentable(i);if(_.isString(s)){notification("error",s);return}s===!0&&(i.addChild(this.model),this.moveBy(t-this.model.x(),r-this.model.y()))},moveBy:function(e,t){var n,r,i,s;if(this.isGroup()){s=this.children(!0);for(r=0,i=s.length;r<i;r++)n=s[r],n.moveBy(e,t)}e+=this.model.x(),t+=this.model.y(),this.model.set({x:e,y:t}),this.$el[0].instance.move(e*o.GRID_WIDTH,t*o.GRID_HEIGHT),this.updateConnections()},updateConnections:function(){var e,t,n,r;r=this.connections();for(t=0,n=r.length;t<n;t++)e=r[t],e.update()},applyGeometry:function(e,n,r,i,s){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;s==null&&(s=!0);if(e!==void 0||n!==void 0)this.model.set({x:e,y:n}),this.$el[0].instance.move(e*o.GRID_WIDTH,n*o.GRID_HEIGHT);if(this.isGroup()&&r!==void 0&&i!==void 0){this.model.set({width:r,height:i}),T=this.children(!0);for(m=0,w=T.length;m<w;m++)u=T[m],u.sticky&&u.ensureStickyPos()}r=(r||this.model.get("width"))*o.GRID_WIDTH,i=(i||this.model.get("height"))*o.GRID_HEIGHT,h=10,p=20,d=[],N=this.$el[0].instance.children();for(g=0,E=N.length;g<E;g++)u=N[g],a=u.classes(),a.indexOf("group")>=0?u.size(r,i):a.indexOf("top")>=0?u.size(r-p,h).x(h):a.indexOf("left")>=0?u.size(h,i-p).y(h):a.indexOf("right")>=0?u.size(h,i-p).move(r-h,h):a.indexOf("bottom")>=0?u.size(r-p,h).move(h,i-h):a.indexOf("top-right")>=0?u.x(r-h):a.indexOf("bottom-left")>=0?u.y(i-h):a.indexOf("bottom-right")>=0?u.move(r-h,i-h):a.indexOf("port")>=0?d.push(u):a.indexOf("group-label")>=0&&t.setLabel(this,u.node);for(y=0,S=d.length;y<S;y++)c=d[y],l=c.attr("data-alias")||c.attr("data-name"),l&&(v=this.portPosition(l),v&&c.move(v[0],v[1]));if(s){C=this.connections();for(b=0,x=C.length;b<x;b++)f=C[b],f.update()}}},{isDirectParentType:function(e){return!0},createResource:function(t,n,r){var i;return i=e.modelClassForType(t),new i(n,r)},getClassByType:function(e){return u[e]},extend:function(e,t){var n;return void 0,t=t||{},t.type=e.type,n=a.call(this,e,t),u[e.type]=n,n}}),s.constant={PORT_4D_ANGLE:-1,PORT_2D_H_ANGLE:-2,PORT_2D_V_ANGLE:-3,PORT_RIGHT_ANGLE:0,PORT_UP_ANGLE:90,PORT_LEFT_ANGLE:180,PORT_DOWN_ANGLE:270},s.setCanvasViewClass=function(e){o=e},s})}.call(this),function(){define("workspaces/editor/canvas/CanvasView",["./TplSvgDef","./CanvasElement","./CanvasManager","Design","i18n!/nls/lang.js","UI.modalplus","event","backbone","UI.nanoscroller","svg"],function(e,t,n,r,i,s,o){var u;return $(e()).appendTo("body"),u=Backbone.View.extend({events:{"click .icon-resize-down":"expandHeight","click .icon-resize-up":"shrinkHeight","click .icon-resize-right":"expandWidth","click .icon-resize-left":"shrinkWidth","click .canvasel":"selectItemByClick","click .line":"selectItemByClick","click svg":"deselectItem",addItem_dragover:"__addItemDragOver",addItem_dragleave:"__addItemDragLeave",addItem_drop:"__addItemDrop","mousedown .canvasel":"__moveItemMouseDown","mousedown .group-label":"__moveItemMouseDown","mousedown .group-resizer":"__resizeGroupDown","mousedown .port":"__drawLineDown","mouseenter .canvasel":"__hoverEl","mouseleave .canvasel":"__hoverOutEl","mousedown svg":"__dragCanvasMouseDown"},initialize:function(e){var t;this.workspace=e.workspace,this.design=this.workspace.design,this.parent=e.parent,this.listenTo(this.design,r.EVENT.Deserialized,this.reload),this.listenTo(this.design,r.EVENT.AddResource,this.addItem),this.listenTo(this.design,r.EVENT.RemoveResource,this.removeItem),this.listenTo(this.design,"change:mode",this.switchMode),this.setElement(this.parent.$el.find(".OEPanelCenter"),!1),this.svg=SVG(this.$el.find("svg")[0]),t=this.size(),this.__getCanvasView().css({width:t[0]*u.GRID_WIDTH,height:t[1]*u.GRID_HEIGHT}),this.$el.nanoScroller(),this.__popupCache={},this.__itemMap={},this.__scale=1,this.__linestyle=parseInt(localStorage.getItem("canvas/lineStyle"))||0,this.switchMode(this.design.mode()),this.reload()},isReadOnly:function(){return!1},remove:function(){var e,t,n,r,i,s;i=this.__popupCache;for(r in i)n=i[r],n&&n.remove();s=this.__itemMap;for(e in s)t=s[e],t.remove();return Backbone.View.prototype.remove.apply(this,arguments)},updateSize:function(){var e;return e=this,setTimeout(function(){return e.$el.nanoScroller()},150)},__appendSvg:function(e,t){return e.parent&&e.parent.removeElement(e),t=$(this.svg.node).children(t),t.append(e.node),e.parent=t[0].instance,e},__getCanvasView:function(){return this.$el.children().children(".canvas-view")},appendLine:function(e){return this.__appendSvg(e,".layer_line")},appendNode:function(e){return this.__appendSvg(e,".layer_node")},switchMode:function(e){void 0,this.__getCanvasView().attr("data-mode",e),this.clearPopups(),this.trigger("switchMode",e)},registerPopup:function(e,t,n){var r;r=this.__popupCache[e],n?r===t&&delete this.__popupCache[e]:(r&&r!==t&&r.remove(),this.__popupCache[e]=t)},clearPopups:function(){var e,t,n;n=this.__popupCache;for(t in n)e=n[t],e.remove();this.__popupCache={}},canvasRect:function(){var e;return e=this.size(),{x1:3,y1:1,x2:e[0]-3,y2:e[1]-1}},isRectAvailableForItem:function(e,t){var n,r,i,s,o;t.parent()?(i=t.parent().rect(),r=t.parent().children()):(i=this.canvasRect(),r=this.__itemTopLevel),i.x1+=1,i.y1+=1,i.x2-=1,i.y2-=1;if(i.x1>e.x1||i.y1>e.y1||i.x2<e.x2||i.y2<e.y2)return!1;for(s=0,o=r.length;s<o;s++){n=r[s];if(n===t)continue;t.isGroup()?i=n.rect():i=n.effectiveRect();if(!(i.x1>=e.x2||i.x2<=e.x1||i.y1>=e.y2||i.y2<=e.y1))return!1}return!0},moveSelectedItem:function(e,t){var n,r;if(this.isReadOnly())return;n=this.getSelectedItem();if(!n)return;r=n.effectiveRect(),r.x1+=e,r.y1+=t,r.x2+=e,r.y2+=t,n.sticky?n.ensureStickyPos(r.x1,r.y1):this.isRectAvailableForItem(r,n)&&n.moveBy(e,t)},getSelectedItem:function(){return this.__selected?this.getItem(this.__selected.getAttribute("data-id")):null},getSelectedComp:function(){var e;return(e=this.getSelectedItem())!=null?e.model:void 0},delSelectedItem:function(){if(this.isReadOnly()||!this.__selected)return;return this.getItem(this.__selected.getAttribute("data-id")).destroy(this.__selected)},deleteItem:function(e){_.isString(e)&&(e=this.getItem(e));if(!e)return;return e.destroy()},selectPrevItem:function(){var e,t;t=$(this.svg.node).find(".canvasel:not(.group)"),e=this.__selected?[].indexOf.call(t,this.__selected)-1:null;if(e===null||e<0)e=t.length-1;return this.selectItem(t[e])},selectNextItem:function(){var e,t;t=$(this.svg.node).find(".canvasel:not(.group)"),e=this.__selected?[].indexOf.call(t,this.__selected)+1:null;if(e===null||e>=t.length)e=0;return this.selectItem(t[e])},selectItem:function(e){var t;_.isString(e)&&(e=this.getItem(e).$el[0]);if(!e)return;this.__selected&&(n.removeClass(this.__selected,"selected"),this.__selected=null),this.__selected=e,n.addClass(this.__selected,"selected"),t=this.getItem(this.__selected.getAttribute("data-id")),t.select(this.__selected)},selectItemByClick:function(e){return this.selectItem(e.currentTarget),!1},deselectItem:function(e){this.__selected&&(n.removeClass(this.__selected,"selected"),this.__selected=null),e!==!0&&o.trigger(o.OPEN_PROPERTY)},clearItems:function(){var e,t,n;n=this.__itemMap;for(e in n)t=n[e],t.remove();this.__itemMap={}},lineStyle:function(){return this.__linestyle},updateLineStyle:function(){var e,t,n,r;t=parseInt(localStorage.getItem("canvas/lineStyle"))||0;if(this.__linestyle===t)return;this.__linestyle=t,r=this.__itemLineMap;for(n in r)e=r[n],e.update()},toggleSgLine:function(e){return n.toggle($(this.svg.node).children(".layer_sgline"),e)},zoomOut:function(){return this.zoom(.2)},zoomIn:function(){return this.zoom(-0.2)},zoom:function(e){var t,n,r,i;r=Math.round((this.__scale+e)*10)/10;if(r<1||r>1.6)return;this.__scale=r,i=this.size(),n=i[0]*u.GRID_WIDTH,t=i[1]*u.GRID_HEIGHT,this.__getCanvasView().css({width:i[0]*u.GRID_WIDTH/r,height:i[1]*u.GRID_HEIGHT/r}).attr("data-scale",r).children("svg")[0].setAttribute("viewBox","0 0 "+n+" "+t),this.$el.nanoScroller()},size:function(){return this.design.get("canvasSize")},scale:function(){return this.__scale},expandHeight:function(){return this.resize("height",60)},shrinkHeight:function(){return this.resize("height",-60)},expandWidth:function(){return this.resize("width",60)},shrinkWidth:function(){return this.resize("width",-60)},resize:function(e,t){var n,r,i,s,o,a;o=this.size(),s=this.scale(),o[e==="width"?0:1]+=t,a=this.__getCanvasView(),i=o[0]*u.GRID_WIDTH,r=o[1]*u.GRID_HEIGHT,t>0?a.children(".icon-resize-up, .icon-resize-left").show():(n=a.children("svg")[0].getBBox(),n.width+n.x+20>=i&&(i=n.width+n.x+20,o[0]=i/u.GRID_WIDTH,a.children(".icon-resize-left").hide()),n.height+n.y+20>=r&&(r=n.height+n.y+20,o[1]=r/u.GRID_HEIGHT,a.children(".icon-resize-up").hide())),this.design.set("canvasSize",o),a.css({width:i/s,height:r/s}).children("svg")[0].setAttribute("viewBox","0 0 "+i+" "+r),this.$el.nanoScroller()},update:function(){return this.trigger("change:externalData")},reload:function(){var e,n,r,i,s,o,u;void 0,this.clearPopups(),this.clearItems(),this.initializing=!0,this.recreateStructure(),this.__itemLineMap={},this.__itemNodeMap={},this.__itemTopLevel=[],r=[],s={},this.design.eachComponent(function(e){e.node_line?r.push(e):this.addItem(e),s[e.type]=!0},this);for(i in s)e=t.getClassByType(i),e&&e.render&&e.render(this);for(o=0,u=r.length;o<u;o++)n=r[o],this.addItem(n,!0);this.initializing=!1},__batchAddLines:function(){var e,t,n,r,i;i=this.__toAddLines;for(n=0,r=i.length;n<r;n++){t=i[n];try{this.addItem(t,!0)}catch(s){e=s,void 0}}this.__toAddLines=null},addItem:function(e,n){var r,i,s;r=t.getClassByType(e.type);if(!r)return;if(!e.isVisual())return;if(e.node_line&&!n){this.__toAddLines?this.__toAddLines.push(e):(this.__toAddLines=[e],s=this,_.defer(function(){return s.__batchAddLines()}));return}i=new r({model:e,canvas:this});if(!i.cid)return;this.__itemMap[e.id]=i,this.__itemMap[i.cid]=i,i.isTopLevel()&&this.__itemTopLevel[i.isGroup()?"push":"unshift"](i),e.node_line?this.__itemLineMap[i.cid]=i:e.node_group||(this.__itemNodeMap[i.cid]=i)},removeItem:function(e){var t,n;n=this.getItem(e.id);if(!n)return;this.getSelectedItem()===n&&this.deselectItem(),delete this.__itemMap[e.id],delete this.__itemMap[n.cid],delete this.__itemLineMap[n.cid],delete this.__itemNodeMap[n.cid],t=this.__itemTopLevel.indexOf(n),t>=0&&this.__itemTopLevel.splice(t,1),n.remove(),n.canvas=null},getItem:function(e){return this.__itemMap[e]},autoLayout:function(e){return this.autoLayoutFully()},__hoverEl:function(e){var t;return(t=this.getItem(e.currentTarget.getAttribute("data-id")))!=null?t.hover(e):void 0},__hoverOutEl:function(e){var t;return(t=this.getItem(e.currentTarget.getAttribute("data-id")))!=null?t.hoverOut(e):void 0},__localToCanvasCoor:function(e,t){var n;return n=this.$el.children(":first-child")[0],{x:Math.round((e+n.scrollLeft)/u.GRID_WIDTH*this.__scale),y:Math.round((t+n.scrollTop)/u.GRID_HEIGHT*this.__scale)}},__itemAtPos:function(e){var t,n,r,i,s,o;n=this.__itemTopLevel,i=null;while(n){r=n,n=null;for(s=0,o=r.length;s<o;s++){t=r[s];if(!t.containPoint(e.x,e.y,!0))continue;if(!t.isGroup())return t;i=t,n=t.children(!0);break}}return i},__groupAtCoor:function(e,t){var n,r,i,s,o,u;r=this.__itemTopLevel,s=null;while(r){i=r,r=null;for(o=0,u=i.length;o<u;o++){n=i[o];if(!n.isGroup())continue;if(n===t)continue;if(!n.containPoint(e.x,e.y))continue;s=n,r=n.children();break}}return s},__clearDragScroll:function(){this.__dragScrollInt&&(void 0,clearInterval(this.__dragScrollInt),this.__dragScrollInt=null)},__scrollOnDrag:function(e){var t,n,r,i,s,o,u,a,f,l;i=e.zoneDimension;if(!i)return;s=this.$el.children(":first-child")[0],o=s.scrollLeft,u=s.scrollTop,t=50,n=10,e.pageX-i.x1<=t?o>n?(r=!0,a=o-n):o>0&&(a="0"):i.x2-e.pageX<=t&&(r=!0,a=o+n),e.pageY-i.y1<=t?u>n?(r=!0,f=u-n):u>0&&(f="0"):i.y2-e.pageY<=t&&(r=!0,f=u+n),a!==void 0&&this.$el.nanoScroller({scrollLeft:a}),f!==void 0&&this.$el.nanoScroller({scrollTop:f}),r?this.__dragScrollInt||(l=this,void 0,this.__dragScrollInt=setInterval(function(){return l.__scrollOnDrag(e)},50)):this.__clearDragScroll()}},{GRID_WIDTH:10,GRID_HEIGHT:10}),t.setCanvasViewClass(u),u})}.call(this),function(){define("workspaces/editor/canvas/CanvasPopup",["backbone"],function(){return Backbone.View.extend({type:"CanvasPopup",attachType:"float",closeOnBlur:!1,className:"canvas-pp",initialize:function(e){var t,n,r,i;void 0,void 0,void 0,$.extend(this,e),this.$el.appendTo(this.canvas.__getCanvasView().parent()),this.render(),this.closeOnBlur&&(i=this,t=function(e){i.autoclose(e)&&i.canvas.$el[0].removeEventListener("mousedown",t,!0)},this.canvas.$el[0].addEventListener("mousedown",t,!0)),n=this.canvas.getItem($(this.attachment).closest(".canvasel").attr("data-id"))||this.attachment,n.__popupCache||(n.__popupCache={}),r=n.__popupCache[this.type],n.__popupCache[this.type]=this,r&&(this.migrate(r),r.remove()),this.canvas.registerPopup(this.type,this)},migrate:function(e){},autoclose:function(e){var t;return t=$(e.target).closest(".canvas-pp"),t.length&&t[0]===this.$el[0]?!1:(this.remove(),!0)},render:function(){this.$el.html(this.content()),this.attachType==="float"?this.attachFloat():this.attachOverlay()},attachFloat:function(){var e,t,n,r,i,s;e=this.attachment.getBoundingClientRect(),n=this.canvas.$el[0].getBoundingClientRect(),t=this.canvas.__getCanvasView()[0].getBoundingClientRect(),r=e.left-n.left,i=this.$el.outerWidth(!0),r>i+20?(this.$el.addClass("pp-left"),s=e.left-t.left-i):(this.$el.addClass("pp-right"),s=e.right-t.left),this.$el.css({left:s,top:e.top-t.top+(e.height-this.$el.outerHeight(!0))/2})},attachOverlay:function(){var e,t;e=this.attachment.getBoundingClientRect(),t=this.canvas.__getCanvasView()[0].getBoundingClientRect(),this.$el.css({left:e.left-t.left,top:e.top-t.top})},remove:function(){var e,t;return this.canvas.registerPopup(this.type,this,!1),e=this.canvas.getItem($(this.attachment).closest(".canvasel").attr("data-id"))||this.attachment,t=(e.__popupCache||{})[this.type],t===this&&delete e.__popupCache[this.type],this.onRemove&&this.onRemove(),Backbone.View.prototype.remove.call(this)},content:function(){}})})}.call(this),define("workspaces/editor/canvas/TplPopup",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function f(e,t){var r="",i;r+='\n<header class="volume-pph">'+u(n.i18n.call(e,"CANVAS.CVS_POP_ATTACHED_VOLUMES",{hash:{},data:t}))+" <span>("+u((i=e&&e.length,typeof i===o?i.apply(e):i))+')</span></header>\n<ul class="popup-content popup-volume">\n\n    ',i=n.each.call(e,e,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;return r+="\n</ul>\n",r}function l(e,t){var r="",i;r+='\n    <li data-id="'+u((i=e&&e.id,typeof i===o?i.apply(e):i))+'" class="',i=n["if"].call(e,e&&e.snapshot,{hash:{},inverse:a.program(5,h,t),fn:a.program(3,c,t),data:t});if(i||i===0)r+=i;r+='">\n        <div class="vpp-name">'+u((i=e&&e.name,typeof i===o?i.apply(e):i))+'</div>\n        <div class="vpp-size">'+u((i=e&&e.size,typeof i===o?i.apply(e):i))+"GB</div>\n        ",i=n["if"].call(e,e&&e.appId,{hash:{},inverse:a.noop,fn:a.program(7,p,t),data:t});if(i||i===0)r+=i;return r+="\n    </li>\n",r}function c(e,t){return"vpp-snapshot"}function h(e,t){return"vpp-volume"}function p(e,t){var n="",r;return n+='<i class="status res-state tooltip '+u((r=e&&e.state,typeof r===o?r.apply(e):r))+'" data-tooltip="'+u((r=e&&e.state,typeof r===o?r.apply(e):r))+'"></i>',n}function d(e,t){var r="";return r+='\n<div class="volume-pp-empty">'+u(n.i18n.call(e,"CANVAS.CVS_POP_NO_ATTACHED_VOLUME",{hash:{},data:t}))+"</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n["if"].call(t,t&&t.length,{hash:{},inverse:a.program(9,d,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.volume=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n<ul class="popup-content popup-instance">\n  ',i=n.each.call(e,e&&e.items,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n</ul>\n",r}function c(e,t){var n="",r;return n+='<li data-id="'+a((r=e&&e.id,typeof r===u?r.apply(e):r))+'" class="vpp-instance">\n    <i class="vpp-ins-state tooltip status-'+a((r=e&&e.state,typeof r===u?r.apply(e):r))+'" data-tooltip="'+a((r=e&&e.state,typeof r===u?r.apply(e):r))+'"></i>\n    <img src="/assets/images/'+a((r=e&&e.icon,typeof r===u?r.apply(e):r))+'" width="39" height="27">\n    <div class="vpp-ins-vol">'+a((r=e&&e.volume,typeof r===u?r.apply(e):r))+'</div>\n    <div class="vpp-ins-name">'+a((r=e&&e.id,typeof r===u?r.apply(e):r))+"</div></li>",n}function h(e,t){var r="";return r+='\n<div class="instance-pp-empty">'+a(n.i18n.call(e,"CANVAS.CVS_POP_NO_INSTANCES",{hash:{},data:t}))+"</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<header class="instance-pph">'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+' <span class="instance-pph-close">Ã—</span></header>\n',o=n["if"].call(t,(o=t&&t.items,o==null||o===!1?o:o.length),{hash:{},inverse:f.program(4,h,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s},n.instance=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n<ul class="popup-content popup-instance">\n  ',i=n.each.call(e,e&&e.items,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;return r+="\n</ul>\n",r}function c(e,t){var r="",i;r+='<li data-id="'+a((i=e&&e.id,typeof i===u?i.apply(e):i))+'" class="vpp-instance vpp-eni">\n  ',i=n["if"].call(e,e&&e.eip,{hash:{},inverse:f.noop,fn:f.program(3,h,t),data:t});if(i||i===0)r+=i;return r+="\n  "+a((i=e&&e.id,typeof i===u?i.apply(e):i))+"</li>",r}function h(e,t){var n="",r;return n+='<div class="vpp-eip tooltip" data-tooltip="'+a((r=e&&e.eip,typeof r===u?r.apply(e):r))+'"></div>',n}function p(e,t){var r="";return r+='\n<div class="instance-pp-empty">'+a(n.i18n.call(e,"CANVAS.CVS_POP_NO_NETWORK_INTERFACE",{hash:{},data:t}))+"</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<header class="instance-pph">'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+' <span class="instance-pph-close">Ã—</span></header>\n',o=n["if"].call(t,(o=t&&t.items,o==null||o===!1?o:o.length),{hash:{},inverse:f.program(5,p,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s},n.eni=e.template(t),n}),function(){define("workspaces/editor/canvas/CpVolume",["./CanvasPopup","./TplPopup","event","constant","CloudResources"],function(e,t,n,r,i){return e.extend({type:"VolumePopup",events:{"mousedown li":"clickVolume"},closeOnBlur:!0,initialize:function(){var t,n,r,i,s;e.prototype.initialize.apply(this,arguments),this.host&&this.listenTo(this.host,"change:volumeList",this.render),t=this.models||[];if(t[0]&&t[0].get){s=this.models;for(r=0,i=s.length;r<i;r++)n=s[r],this.listenTo(n,"change:name",this.updateVolume),this.listenTo(n,"change:volumeSize",this.updateVolume)}this.selectAtBegin&&this.clickVolume({currentTarget:this.$el.find("[data-id="+this.selectAtBegin.id+"]")[0]})},migrate:function(e){var t;t=e.$el.find(".selected").attr("data-id"),this.$el.find('[data-id="'+t+'"]').addClass("selected")},updateVolume:function(e){var t;t=this.$el.find("[data-id="+e.id+"]"),t.children(".vpp-name").text(e.get("name")),t.children(".vpp-size").text(e.get("volumeSize")+"GB")},content:function(){var e,n,r,s,o,u,a;r=this.models||[];if(r[0]&&r[0].get){r=[],a=this.models;for(o=0,u=a.length;o<u;o++)s=a[o],n=s.get("appId"),r.push({id:s.get("id"),appId:n,name:s.get("name"),size:s.get("volumeSize"),snapshot:s.get("snapshotId")}),n&&(e=i(s.type,s.design().region()).get(n),_.last(r).state=(e!=null?e.get("state"):void 0)||"unknown")}return t.volume(r)},clickVolume:function(e){var t,i;return t=$(e.currentTarget).addClass("selected"),i=t.attr("data-id"),this.canvas.selectVolume(i),this.selected&&$(this.selected).removeClass("selected"),this.selected=e.currentTarget,n.trigger(n.OPEN_PROPERTY,r.RESTYPE.VOL,i),!this.canvas.design.modeIsApp()&&e.which===1&&t.dnd(e,{dropTargets:this.canvas.$el,dataTransfer:{id:i},eventPrefix:"addVol_"}),!1},remove:function(){this.canvas.selectVolume(null),e.prototype.remove.call(this)}})})}.call(this),function(){define("workspaces/editor/canvas/CanvasViewAws",["./CanvasView","constant","i18n!/nls/lang.js","./CpVolume","./CanvasManager","Design"],function(e,t,n,r,i,s){var o,u;return u=function(e,t){return t.x1<=e.x&&t.y1<=e.y&&t.x2>=e.x&&t.y2>=e.y},o=e.extend({events:function(){return $.extend({addVol_dragover:"__addVolDragOver",addVol_dragleave:"__addVolDragLeave",addVol_drop:"__addVolDrop"},e.prototype.events)},recreateStructure:function(){this.svg.clear().add([this.svg.group().classes("layer_vpc"),this.svg.group().classes("layer_az"),this.svg.group().classes("layer_subnet"),this.svg.group().classes("layer_asg"),this.svg.group().classes("layer_line"),this.svg.group().classes("layer_sgline"),this.svg.group().classes("layer_node")])},appendVpc:function(e){return this.__appendSvg(e,".layer_vpc")},appendAz:function(e){return this.__appendSvg(e,".layer_az")},appendSubnet:function(e){return this.__appendSvg(e,".layer_subnet")},appendAsg:function(e){return this.__appendSvg(e,".layer_asg")},appendSgline:function(e){return this.__appendSvg(e,".layer_sgline")},fixConnection:function(e,n,r){var i;if(r.type!==t.RESTYPE.ELB||n.type!==t.RESTYPE.INSTANCE&&n.type!==t.RESTYPE.LC){if(r.type===t.RESTYPE.ASG||r.type==="ExpandedAsg")r=r.getLc(),r&&(r=this.getItem(r.id))}else e.x>r.pos().x+r.size().width/2?i="elb-sg-out":i="elb-sg-in";return{toPort:i,target:r}},errorMessageForDrop:function(e){switch(e){case t.RESTYPE.VOL:return n.CANVAS.WARN_NOTMATCH_VOLUME;case t.RESTYPE.SUBNET:return n.CANVAS.WARN_NOTMATCH_SUBNET;case t.RESTYPE.INSTANCE:return n.CANVAS.WARN_NOTMATCH_INSTANCE_SUBNET;case t.RESTYPE.ENI:return n.CANVAS.WARN_NOTMATCH_ENI;case t.RESTYPE.RT:return n.CANVAS.WARN_NOTMATCH_RTB;case t.RESTYPE.ELB:return n.CANVAS.WARN_NOTMATCH_ELB;case t.RESTYPE.CGW:return n.CANVAS.WARN_NOTMATCH_CGW;case t.RESTYPE.ASG:return n.CANVAS.WARN_NOTMATCH_ASG;case t.RESTYPE.IGW:return n.CANVAS.WARN_NOTMATCH_IGW;case t.RESTYPE.VGW:return n.CANVAS.WARN_NOTMATCH_VGW;case t.RESTYPE.DBSBG:return n.CANVAS.WARN_NOTMATCH_SGP_VPC;case t.RESTYPE.DBINSTANCE:return n.CANVAS.WARN_NOTMATCH_DBINSTANCE_SGP}},selectVolume:function(e){return this.deselectItem(!0),this.__selectedVolume=e,!1},isReadOnly:function(){return this.design.modeIsApp()},delSelectedItem:function(){var t,n,r,i;if(this.isReadOnly())return!1;if(this.__selectedVolume){i=this.design.component(this.__selectedVolume),n=i.isRemovable();if(_.isString(n)){notification("error",n);return}r=this.__selectedVolume,this.__selectedVolume=null,i.remove(),t=$(".canvas-pp .popup-volume").children().eq(0),t.length?t.trigger("mousedown"):this.deselectItem();return}return e.prototype.delSelectedItem.apply(this,arguments)},__addVolDragOver:function(e,n){var s,o,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;this.__scrollOnDrag(n);if(!n.volDropTargets){n.hoverItem=null,s=t.RESTYPE,p=this.design.componentsOfType(s.INSTANCE).concat(this.design.componentsOfType(s.LC)),n.volDropTargets=o=[];for(v=0,b=p.length;v<b;v++){d=p[v],d=this.getItem(d.id),x=d.$el;for(m=0,w=x.length;m<w;m++)a=x[m],h=d.rect(a),h.tgt=d,h.el=a,o.push(h)}}if(!n.effect){n.effect=!0,T=n.volDropTargets||[];for(g=0,E=T.length;g<E;g++)d=T[g],i.addClass(d.tgt.$el,"droppable")}c=this.__localToCanvasCoor(n.pageX-n.zoneDimension.x1,n.pageY-n.zoneDimension.y1),f=null,N=n.volDropTargets;for(y=0,S=N.length;y<S;y++){d=N[y];if(u(c,d)){f=d;break}}f!==n.hoverItem&&(n.popup&&n.popup.remove(),n.hoverItem=f,f&&(l=f.tgt.model,n.popup=new r({attachment:f.el,host:l,models:l.get("volumeList"),canvas:this})))},__addVolDragLeave:function(e,t){var n,r,s,o;this.__clearDragScroll(),o=t.volDropTargets||[];for(r=0,s=o.length;r<s;r++)n=o[r],i.removeClass(n.tgt.$el,"droppable");t.effect=!1,t.popup&&t.popup.remove()},__addVolDrop:function(e,i){var o,u,a,f,l,c;if(!i.hoverItem)return;u=i.dataTransfer||{},f=i.hoverItem.tgt.model;if(u.id){c=this.design.component(u.id),a=c.isReparentable(f);if(_.isString(a))return notification("error",a);a&&(c.attachTo(f),this.selectItem(i.hoverItem.el));return}if(f.type===t.RESTYPE.LC&&f.get("appId")){notification("error",n.NOTIFY.WARN_OPERATE_NOT_SUPPORT_YET);return}u.owner=f,_.isString(u.encrypted)&&(u.encrypted=u.encrypted==="true"),o=s.modelClassForType(t.RESTYPE.VOL),l=new o(u),new r({attachment:i.hoverItem.el,host:f,models:f.get("volumeList"),canvas:this,selectAtBegin:l})}}),o})}.call(this),function(){define("workspaces/editor/canvas/CanvasViewDnd",["./CanvasView","./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N;return u=function(){},o=function(){},s=e.prototype,s.__addItemDragOver=function(e,n){var i,s,o;this.__scrollOnDrag(n),s=this.__groupAtCoor(this.__localToCanvasCoor(n.pageX-n.zoneDimension.x1,n.pageY-n.zoneDimension.y1));if(s){i=t.getClassByType(n.dataTransfer.type),o=i.prototype.parentType;if(!o||o.indexOf(s.type)===-1)s=null}s!==this.__dragHoverGroup&&(this.__dragHoverGroup&&r.removeClass(this.__dragHoverGroup.$el,"droppable"),s&&r.addClass(s.$el,"droppable"),this.__dragHoverGroup=s,n.shadow.toggleClass("autoparent",!!s&&!i.isDirectParentType(s.type))),u.call(this,n)},s.__addItemDragLeave=function(){this.__clearDragScroll();if(this.__dragHoverGroup)return r.removeClass(this.__dragHoverGroup.$el,"droppable"),this.__dragHoverGroup=null},s.__handleDropData=function(e,n,r){var s,o,u,a,f,l;if(!e.zoneDimension)return"";s=t.getClassByType(e.dataTransfer.type),o=s.prototype,f=this.__groupAtCoor(this.__localToCanvasCoor(e.pageX-e.zoneDimension.x1,e.pageY-e.zoneDimension.y1),n),l=f?f.type:"SVG";if(r&&!s.isDirectParentType(l)||(o.parentType||[]).indexOf(l)===-1)return this.errorMessageForDrop(o.type)||"";u=this.__localToCanvasCoor(e.pageX-e.offsetX-e.zoneDimension.x1,e.pageY-e.offsetY-e.zoneDimension.y1),a={x1:u.x,y1:u.y,x2:u.x+e.itemWidth,y2:u.y+e.itemHeight},f&&!s.isDirectParentType(f.type)&&(a.x1-=2,a.y1-=2,a.x2+=2,a.y2+=2);if(!o.sticky){a=this.__bestFitRect(a,f,n);if(!a)return i.CANVAS.WARN_NO_ENOUGH_SPACE}return{group:f,dropRect:a}},s.__addItemDrop=function(e,n){var r,i,s,o,u,a;r=t.getClassByType(n.dataTransfer.type),i=r.prototype,n.itemWidth=i.defaultSize[0],n.itemHeight=i.defaultSize[1],u=this.__handleDropData(n);if(_.isString(u)){notification("warning",u,!1);return}s=$.extend({x:u.dropRect.x1,y:u.dropRect.y1,width:i.defaultSize[0],height:i.defaultSize[1]},n.dataTransfer),Design.modelClassForType(s.type).prototype.node_group&&(s.x+=1,s.y+=1,s.width-=2,s.height-=2),delete s.type,u.group&&(s.parent=u.group.model),o=r.createResource(i.type,s,{createByUser:!0}),o&&o.id&&(a=this,_.defer(function(){return a.selectItem(o.id)}))},x=function(e,t){var n;return n=$.extend({},e),e.x1<=t.x1?(n.x2-=e.x1-t.x1-1,n.x1=t.x1+1):e.x2>=t.x2&&(n.x1+=t.x2-1-e.x2,n.x2=t.x2-1),e.y1<=t.y1?(n.y2-=e.y1-t.y1-1,n.y1=t.y1+1):e.y2>=t.y2&&(n.y1+=t.y2-1-e.y2,n.y2=t.y2-1),n},p=function(e,t){return!(e.x1>=t.x2||e.x2<=t.x1||e.y1>=t.y2||e.y2<=t.y1)},d=function(e,t){var n,r,i;for(r=0,i=t.length;r<i;r++){n=t[r];if(!(e.x1>=n.x2||e.x2<=n.x1||e.y1>=n.y2||e.y2<=n.y1))return!1}return!0},h=function(e,t){return t.x1<=e.x1&&t.y1<=e.y1&&t.x2>=e.x2&&t.y2>=e.y2},N=function(e){return e.x2-e.x1},T=function(e){return e.y2-e.y1},l=function(e,t,n){return e.x1-=t,e.x2+=t,e.y1-=n,e.y2+=n,e},c=function(e,t,n,r){var i,s,o,u,a,f,l,c;i=[],l=n.y1;for(o=0,a=l.length;o<a;o++)s=l[o],e.y1=s,e.y2=s+t,d(e,r)&&i.push($.extend({},e));c=n.y2;for(u=0,f=c.length;u<f;u++)s=c[u],e.y2=s,e.y1=s-t,d(e,r)&&i.push($.extend({},e));return i},s.__bestFitRect=function(e,t,n){var r,i,s,u,a,f,d,v,m,g,y,b,w,E,S,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V;t?(a=t.children(),O=t.rect()):(a=this.__itemTopLevel.slice(0),O=this.canvasRect()),E=a.indexOf(n),E>=0&&a.splice(E,1),M="rect",n&&(n.isGroup()?(e.x1-=1,e.y1-=1,e.x2+=1,e.y2+=1):M="effectiveRect"),_=N(e),w=T(e),b=Math.round(_/2),y=Math.round(w/2),b>12&&(b=12),y>12&&(y=12),k=x(e,O),e=x(l(e,b,y),O),f=[],v=[];for(H=0,I=a.length;H<I;H++)u=a[H],i=u[M](),p(i,k)?f.push(i):p(i,e)&&v.push(i);if(!f.length)h(k,O)&&(s=k);else{f=f.concat(v),r={x1:[k.x1],x2:[k.x2],y1:[k.y1],y2:[k.y2]};for(B=0,q=f.length;B<q;B++)u=f[B],u.x1-_>=e.x1&&r.x2.push(u.x1),u.y1-w>=e.y1&&r.y2.push(u.y1),u.x2+_<=e.x2&&r.x1.push(u.x2),u.y2+w<=e.y2&&r.y1.push(u.y2);g=[],L=k.x1,A=k.y1,X=r.x1;for(j=0,R=X.length;j<R;j++)D=X[j],k.x1=D,k.x2=D+_,g=g.concat(c(k,w,r,f));V=r.x2;for(F=0,U=V.length;F<U;F++)P=V[F],k.x2=P,k.x1=P-_,g=g.concat(c(k,w,r,f));C=0;for(W=0,z=g.length;W<z;W++){m=g[W];if(!h(m,O))continue;d=Math.pow(m.x1-L,2)+Math.pow(m.y1-A,2);if(!s||S>d)s=m,S=d}}return o.call(this,s,g,f,r,e),s},s.__moveItemMouseDown=function(e){return e.metaKey||e.ctrlKey?this.__dragCanvasMouseDown(e):this.isReadOnly()||this.dragItem(e,{onDrop:m,altState:!0}),!1},s.dragItem=function(e,t){var n,i,s,o;void 0;if(e.which!==1)return!1;i=$(e.currentTarget).closest(".canvasel");if(r.hasClass(i,"fixed"))return;o=this.getItem(i.attr("data-id"));if(!o)return;s=this.$el.offset(),t=$.extend(t,{dropTargets:$("#OpsEditor .OEPanelCenter"),dataTransfer:{type:o.type},item:o,targetSvg:i[0].instance,context:this,eventPrefix:"moveItem_",noShadow:!0,lockToCenter:!1,canvasX:s.left,canvasY:s.top,onDragStart:b,onDrag:g,onDragEnd:y,onDragCancel:v,includeSource:function(e){return e.data.altState&&!!e.altKey}}),o.isClonable()||(t.altState=!1),o.sticky&&(t.onDragStart=S,t.onDrag=w,t.onDragEnd=E),o.isGroup()&&(n=i.children(".group"));if(!n||!n.length)n=i;return n.dnd(e,t),!1},b=function(t){var n,r,i;r=t.context.svg,i=t.targetSvg.attr("id","svgDragTarget"),t.cloneSvg=r.group().add(r.use("svgDragTarget",!0).move(-i.x(),-i.y())).classes("shadow").move(i.x(),i.y()),t.altState&&(n=t.item.size(),t.cloneSvg.add(r.use("clone_indicator").move(n.width*e.GRID_WIDTH-12,n.height*e.GRID_HEIGHT-12).classes("indicator").hide()))},g=function(n){var i,s,o,a,f,l;o=n.data;if(!o.zoneDimension)return;s=o.context,s.__scrollOnDrag(o),a=s.__groupAtCoor(s.__localToCanvasCoor(o.pageX-o.zoneDimension.x1,o.pageY-o.zoneDimension.y1),o.item);if(a){i=t.getClassByType(o.dataTransfer.type),l=i.prototype.parentType;if(!l||l.indexOf(a.type)===-1||!i.isDirectParentType(a.type))a=null}a!==s.__dragHoverGroup&&(s.__dragHoverGroup&&r.removeClass(s.__dragHoverGroup.$el,"droppable"),a&&r.addClass(a.$el,"droppable"),s.__dragHoverGroup=a),f=o.context.__localToCanvasCoor(o.pageX-o.canvasX-o.offsetX,o.pageY-o.canvasY-o.offsetY),o.cloneSvg.move(f.x*e.GRID_WIDTH,f.y*e.GRID_HEIGHT),o.altState&&o.cloneSvg.get(1)[n.altKey?"show":"hide"](),u.call(s,o,o.item)},y=function(e){var t,n,r,s;t=e.data,v(e),s=t.item.size(),t.itemWidth=s.width,t.itemHeight=s.height,_.isFunction(t.includeSource)&&t.includeSource(e)||t.includeSource===!0?n=null:n=t.item,r=t.context.__handleDropData(t,n,!0);if(_.isString(r)){r===i.CANVAS.WARN_NO_ENOUGH_SPACE&&notification("warning",r);return}t.dataTransfer.item=t.item,t.dataTransfer.parent=r.group,t.dataTransfer.x=r.dropRect.x1,t.dataTransfer.y=r.dropRect.y1,t.item.isGroup()&&(t.dataTransfer.x+=1,t.dataTransfer.y+=1),t.onDrop(e,t.dataTransfer)},m=function(e,t){var n;t.item.isClonable()&&e.altKey?n="cloneTo":n="changeParent",t.item[n](t.parent,t.x,t.y)},v=function(e){var t;t=e.data,t.context.__addItemDragLeave(),t.targetSvg.attr("id",""),t.cloneSvg&&t.cloneSvg.remove()},S=function(e){},w=function(e){var t,n,r;n=e.data;if(!n.zoneDimension)return;t=n.context,t.__scrollOnDrag(n),r=n.context.__localToCanvasCoor(n.pageX-n.canvasX-n.offsetX,n.pageY-n.canvasY-n.offsetY),n.item.ensureStickyPos(r.x,r.y)},E=function(e){return e.data.context.__clearDragScroll()},s.__dragCanvasMouseDown=function(e){var t;return!e.ctrlKey&&!e.metaKey||e.which!==1?!1:(t=this.$el.children(":first-child")[0],$(document).on({"mousemove.dragcanvas":f,"mousedown.dragcanvas":a,"mouseup.dragcanvas":a,"urlroute.dragcanvas":a},{context:this,startX:e.pageX,startY:e.pageY,scrollLeft:t.scrollLeft,scrollTop:t.scrollTop,overlay:$("<div id='overlayer' class='grabbing'></div>").appendTo("body")}),!1)},f=function(e){var t;return t=e.data,t.context.$el.nanoScroller({scrollLeft:t.scrollLeft-e.pageX+t.startX}),t.context.$el.nanoScroller({scrollTop:t.scrollTop-e.pageY+t.startY}),!1},a=function(e){return $(document).off(".dragcanvas"),e.data.overlay.remove(),!1},null})}.call(this),function(){define("workspaces/editor/canvas/CanvasViewConnect",["./CanvasView","Design","./CanvasManager","./CanvasElement","i18n!/nls/lang.js"],function(e,t,n,r,i){var s,o,u,a,f,l;return s=e.prototype,o=function(e){var t,r,i,s,o;$(document).off(".drawline"),r=e.data,r.context.__clearDragScroll();if(r.marker){r.marker.remove(),r.lineSvg.remove(),r.overlay.remove(),o=r.highlightEls;for(i=0,s=o.length;i<s;i++)t=o[i],n.removeClass(t,"connectable")}},u=function(e){var t;return t=e.data,Math.pow(e.pageX-t.startX,2)+Math.pow(e.pageY-t.startY,2)>=4&&($(document).off("mousemove.drawline").off("mouseup.drawline").on({"mousemove.drawline":f,"mouseup.drawline":l},t),a.call(t.context,t)),!1},a=function(r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;i=r.source,c=r.startItem,v=i.attr("data-name"),d=i.attr("data-alias"),y=c.pos(i.closest("g")[0]),m=c.portPosition(d||v),y.x=y.x*e.GRID_WIDTH+m[0],y.y=y.y*e.GRID_HEIGHT+m[1],L=c.connections();for(S=0,N=L.length;S<N;S++)s=L[S],n.addClass(s.$el,"hover");l=[],A=t.modelClassForType("Framework_CN").connectionData(c.type,v);for(E in A){a=A[E],O=this.design.componentsOfType(E);for(x=0,C=O.length;x<C;x++){u=O[x];for(T=0,k=a.length;T<k;T++)w=a[T],c.isConnectable(v,u.id,w)&&(b=this.getItem(u.id),b&&(g=b.$el.children("[data-name='"+w+"']"),n.addClass(b.$el,"connectable"),n.addClass(g,"connectable"),l.push(g),l.push(b.$el)))}}return p=this.svg.marker(3,3).classes(v).attr("id","draw-line-marker").add(this.svg.path("M1.5,0 L1.5,3 L3,1.5 L1.5,0")),h=this.svg.line(y.x,y.y,y.x,y.y).classes("draw-line "+v).marker("end",p),this.svg.add(h),o=this.$el.offset(),f={x1:o.left,y1:o.top,x2:o.left+this.$el.outerWidth(),y2:o.top+this.$el.outerHeight()},$.extend(r,{marker:p,lineSvg:h,zoneDimension:f,highlightEls:l,portName:v,startPos:y,overlay:$("<div></div>").appendTo(this.$el).css({position:"absolute",left:"0",top:"0",bottom:"0",right:"0"})}),!1},s.__connect=function(e,t,n,i){var s,o,u;u=this,s=r.getClassByType(e.prototype.type),o=s.connect(e,t,n),o&&o.id&&_.defer(function(){return u.selectItem(o.id)}),this.__connectInitItem=i},s.__popLineInitiator=function(){var e;return e=this.__connectInitItem,this.__connectInitItem=null,e},s.__drawLineDown=function(e){var t,n,r,i;return e.which!==1?!1:(t=$(e.currentTarget),n=t.closest("g"),r=this.getItem(n.attr("data-id")),r?(i=this.$el.children(":first-child")[0],$(document).on({"mousemove.drawline":u,"mousedown.drawline":o,"mouseup.drawline":o,"urlroute.drawline":o},{context:this,canvasScale:this.__scale,source:t,startItem:r,scrollContent:i,pageX:e.pageX,pageY:e.pageY,startX:e.pageX+i.scrollLeft,startY:e.pageY+i.scrollTop}),!1):!1)},f=function(e){var t,n,r;return t=e.data,t.pageX=e.pageX,t.pageY=e.pageY,t.context.__scrollOnDrag(t),n=t.startPos.x+(t.pageX+t.scrollContent.scrollLeft-t.startX)*t.canvasScale,r=t.startPos.y+(t.pageY+t.scrollContent.scrollTop-t.startY)*t.canvasScale,t.lineSvg.plot(t.startPos.x,t.startPos.y,n,r),!1},l=function(e){var n,r,i,s,u,a,f,l,c,h,p,d;u=e.data,c=$(u.scrollContent).offset(),s=u.context.__localToCanvasCoor(u.pageX-c.left,u.pageY-c.top),f=u.context.__itemAtPos(s),f&&(a=u.context.fixConnection(s,u.startItem,f),a&&(d=a.toPort,f=a.target)),!d&&f&&(d=f.$el.find(".connectable").attr("data-name")),o(e);if(!f||!d||f===u.startItem)return!1;n=t.modelClassForPorts(u.portName,d),void 0,r=u.startItem.model,i=f.model,h=n.isConnectable(r,i);if(h===!1)return;return _.isString(h)?(notification("error",h),!1):h===!0?(u.context.__connect(n,r,i,u.startItem),!1):(h.confirm&&(p=this,l=new Modal({title:h.title,width:"420",template:h.template,confirm:{text:h.action,color:"blue"},onConfirm:function(){l.close(),u.context.__connect(n,r,i,u.startItem)}})),!1)},null})}.call(this),function(){define("workspaces/editor/canvas/CanvasViewGResizer",["./CanvasView"],function(e){var t,n,r,i,s,o,u,a,f;return n=function(){},t=e.prototype,t.__resizeGroupDown=function(e){var t,i,s,a,l,c,h,p,d,v,m,g,y;i=$(e.currentTarget),t=i.closest("g"),c=this.getItem(t.attr("data-id")),a=i.attr("class").replace("group-resizer ","").split("-"),v=c.rect(),p=c.parent(),p?(p=p.rect(),p.x1+=1,p.y1+=1,p.x2-=1,p.y2-=1):(d=this.size(),p={x1:4,y1:2,x2:d[0]-4,y2:d[1]-2}),h=a.indexOf("left")>=0,m=a.indexOf("top")>=0,s={pageX:e.pageX,pageY:e.pageY,direction:a,context:this,item:c,$resizer:i,$svgel:t,sideX:h?"x1":"x2",sideY:m?"y1":"y2",move:h||m,originalBound:$.extend({},v),innerBound:r(c,v),target:v,parent:p,siblings:c.siblings().map(function(e){return e.rect()}),overlay:$("<div></div>").appendTo(this.$el).css({position:"absolute",left:"0",top:"0",bottom:"0",right:"0",cursor:i.css("cursor")})};for(g=0,y=a.length;g<y;g++)l=a[g],f(l,s);return $(document).on({"mousemove.resizegroup":o,"mouseup.resizegroup":u},s),n(s),!1},f=function(e,t){var n,r,o,u,a,f,l,c,h,p,d,v,m,g,y;c=t.target,u=e==="left",f=e==="right",h=e==="top",r=e==="down",n=[{x1:t.parent.x2,y1:t.parent.y2,x2:t.parent.x1,y2:t.parent.y1}];if(u||f){o="rangeX",g=t.siblings;for(p=0,v=g.length;p<v;p++){l=g[p];if(l.y1>=c.y2||l.y2<=c.y1)continue;if(u){if(l.x1>c.x1)continue}else if(l.x2<c.x2)continue;n.push(l)}}else{o="rangeY",y=t.siblings;for(d=0,m=y.length;d<m;d++){l=y[d];if(l.x1>=c.x2||l.x2<=c.x1)continue;if(h){if(l.y1>c.y1)continue}else if(l.y2<c.y2)continue;n.push(l)}}u?a=[i(n,"x2")+1,t.innerBound.x1]:f?a=[t.innerBound.x2,s(n,"x1")-1]:h?a=[i(n,"y2")+1,t.innerBound.y1]:a=[t.innerBound.y2,s(n,"y1")-1],t[o]=a},r=function(e,t){var n,r,i,s,o;t={x1:t.x2-10,y1:t.y2-10,x2:t.x1+10,y2:t.y1+10},o=e.children();for(i=0,s=o.length;i<s;i++)r=o[i],n=r.effectiveRect(),t.x1>n.x1&&(t.x1=n.x1),t.y1>n.y1&&(t.y1=n.y1),t.x2<n.x2&&(t.x2=n.x2),t.y2<n.y2&&(t.y2=n.y2);return t.x1-=1,t.y1-=1,t.x2+=1,t.y2+=1,t},s=function(e,t){var n,r,i,s;r=e[0][t];for(i=0,s=e.length;i<s;i++)n=e[i],n[t]<r&&(r=n[t]);return r},i=function(e,t){var n,r,i,s;r=e[0][t];for(i=0,s=e.length;i<s;i++)n=e[i],n[t]>r&&(r=n[t]);return r},o=function(t){var r,i,s,o,u;return i=t.data,u=i.context.__scale,i.rangeX&&(s=i.originalBound[i.sideX]+Math.round((t.pageX-i.pageX)*u/e.GRID_WIDTH),s<i.rangeX[0]?s=i.rangeX[0]:s>i.rangeX[1]&&(s=i.rangeX[1]),s!==i.target[i.sideX]&&(i.target[i.sideX]=s,r=!0,i.rangeY&&(f(i.direction[0],i),n(i)))),i.rangeY&&(o=i.originalBound[i.sideY]+Math.round((t.pageY-i.pageY)*u/e.GRID_HEIGHT),o<i.rangeY[0]?o=i.rangeY[0]:o>i.rangeY[1]&&(o=i.rangeY[1]),o!==i.target[i.sideY]&&(i.target[i.sideY]=o,r=!0,i.rangeX&&(f(i.direction[1],i),n(i)))),r&&a(i),!1},a=function(e){var t,n,r,i;e.move&&(r=e.target.x1,i=e.target.y1),n=e.target.x2-e.target.x1,t=e.target.y2-e.target.y1,e.item.applyGeometry(r,i,n,t)},u=function(e){var t;return t=e.data,t.overlay.remove(),$(document).off(".resizegroup"),!1}})}.call(this),function(){define("workspaces/editor/canvas/CanvasViewLayout",["./CanvasView","constant"],function(e,t){var n,r,i,s,o,u,a,f,l;return s=null,o=function(){function e(e,t){this.px=e||0,this.py=t||0}return e.prototype.fit=function(e){var t,n,r,i,s,o;r=e.length,this.root={x:0,y:0,w:r>0?e[0].w+this.px:0,h:r>0?e[0].h+this.py:0},i=0;while(i<r)t=e[i],o=t.w+this.px,n=t.h+this.px,(s=this.findNode(this.root,o,n))?t.fit=this.splitNode(s,o,n):t.fit=this.growNode(o,n),i++},e.prototype.findNode=function(e,t,n){return e.used?this.findNode(e.right,t,n)||this.findNode(e.down,t,n):t<=e.w&&n<=e.h?e:null},e.prototype.splitNode=function(e,t,n){return e.used=!0,e.down={x:e.x,y:e.y+n,w:e.w,h:e.h-n},e.right={x:e.x+t,y:e.y,w:e.w-t,h:n},e},e.prototype.growNode=function(e,t){var n,r,i,s;return n=e<=this.root.w,r=t<=this.root.h,s=r&&this.root.h>=this.root.w+e,i=n&&this.root.w>=this.root.h+t,s?this.growRight(e,t):i?this.growDown(e,t):r?this.growRight(e,t):n?this.growDown(e,t):null},e.prototype.growRight=function(e,t){var n;return this.root={used:!0,x:0,y:0,w:this.root.w+e,h:this.root.h,down:this.root,right:{x:this.root.w,y:0,w:e,h:this.root.h}},(n=this.findNode(this.root,e,t))?this.splitNode(n,e,t):null},e.prototype.growDown=function(e,t){var n;return this.root={used:!0,x:0,y:0,w:this.root.w,h:this.root.h+t,down:{x:0,y:this.root.h,w:this.root.w,h:t},right:this.root},(n=this.findNode(this.root,e,t))?this.splitNode(n,e,t):null},e}(),r=function(e){var t,n,r,i;n=[],i=_.groupBy(e,"type");for(r in i)t=i[r],n.push({type:r+"_group",children:t});return n},n=function(e){var t,n,r,i,o,u,a,f,l,c;o=s[this.type]||{},a=o.space||0,f=0,u=0;for(l=0,c=e.length;l<c;l++)t=e[l],n=s[t.type]||{},i=t.width||n.width||0,r=t.height||n.height||0,t.x=f,t.y=0,i>0&&(f+=i+a),r&&r>u&&(u=r);return e.length&&(f-=a),{width:f||o.width,height:u||o.height}},i={GroupMByType:r,ArrangeHorizontal:n,ArrangeVertical:function(e){var t,n,r,i,o,u,a,f,l,c;o=s[this.type]||{},u=o.space||0,f=0,a=0;for(l=0,c=e.length;l<c;l++)t=e[l],n=s[t.type]||{},i=t.width||n.width||0,r=t.height||n.height||0,t.x=0,t.y=f,r>0&&(f+=r+u),i&&i>a&&(a=i);return e.length&&(f-=u),{width:a||o.width,height:f||o.height}},ArrangeBinPack:function(e){var t,n,r,i,u,a,f,l,c,h,p;if(e.length===0)return{width:0,height:0};if(e.length===1)return e[0].x=e[0].y=0,{width:e[0].width,height:e[0].height};n=e.map(function(e){return{w:e.width,h:e.height,item:e,sign:e.width>e.height?e.width:e.height}}),n.sort(function(e,t){return t.sign-e.sign}),r=s[this.type]||{},u=r.spaceX||r.space||0,a=r.spaceY||r.space||0,(new o(u,a)).fit(n),f=0,i=0;for(l=0,c=n.length;l<c;l++)t=n[l],t.item.x=((h=t.fit)!=null?h.x:void 0)||0,t.item.y=((p=t.fit)!=null?p.y:void 0)||0,f=Math.max(f,t.item.x+t.item.width),i=Math.max(i,t.item.y+t.item.height);return{width:f,height:i}}},l=function(e){return e?_.isFunction(e)?e:i[e]:null},a=function(e){var t,n,r,i,o,u,f,c;r={component:e,type:e.type,x:0,y:0};if(e.children){r.children=[],n=e.children(),i=l((f=s[e.type])!=null?f.sortMethod:void 0),i&&(n=i.call(e,n));for(o=0,u=n.length;o<u;o++){t=n[o];if((c=s[t.type])!=null?c.ignore:void 0)continue;r.children.push(a(t))}}return r},f=function(e){var t,n,i,o,u,a;if(e.children){u=e.children;for(i=0,o=u.length;i<o;i++)t=u[i],f(t)}return n=l((a=s[e.type])!=null?a.groupMethod:void 0)||r,e.children=n.call(e,e.children),e},u=function(e){var t,r,i,o,a,f,c,h,p,d;i=s[e.type]||{};if(e.children){p=e.children;for(a=0,c=p.length;a<c;a++)r=p[a],u(r);t=l(i.arrangeMethod)||n,o=t.call(e,e.children);if(i.margin){o.width+=i.margin*2,o.height+=i.margin*2,d=e.children;for(f=0,h=d.length;f<h;f++)r=d[f],r.x+=i.margin,r.y+=i.margin}e.width=o.width,e.height=o.height}else e.width=i.width||0,e.height=i.height||0;return e},e.prototype.applyGeometry=function(e,t,n){var r,i,o,u,a,f,l,c;o=e.x+t,u=e.y+n;if(e.children){l=e.children;for(a=0,f=l.length;a<f;a++)r=l[a],this.applyGeometry(r,o,u)}if(e.component){i=this.getItem(e.component.id);if(i){if((c=s[e.type])!=null?c.sticky:void 0)o=-1,u=-1;i.applyGeometry(o,u,e.width,e.height,!1)}}},e.prototype.autoLayoutFully=function(){var e,t,n,r,i;s=this.autoLayoutConfig,n=this.__itemTopLevel.map(function(e){return e.model}),e={type:"SVG",children:function(){return n}},e=a(e),f(e),u(e),this.applyGeometry(e,5,3),i=this.__itemLineMap;for(r in i)t=i[r],t.update()},{DefaultGroupMethod:r,DefaultArrangeMethod:n}})}.call(this),function(){define("workspaces/editor/canvas/CanvasViewAwsLayout",["./CanvasViewAws","./CanvasViewLayout","constant"],function(e,t,n){var r,i,s,o,u,a,f,l;return l=function(e){return e.sort(function(e,t){return t.component.connections("ElbAmiAsso").length-e.component.connections("ElbAmiAsso")})},a=function(e){var n,r,i,s,o,u,a,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_;c=t.DefaultGroupMethod.call(this,e),p=null,s=null,n=null,f=null,b=[];for(w=0,T=c.length;w<T;w++)r=c[w],r.type==="AWS.VPC.NetworkInterface_group"?s=r:r.type==="AWS.EC2.Instance_group"?p=r:r.type==="ExpandedAsg_group"?f=r:r.type==="AWS.AutoScaling.Group_group"?n=r:b.push(r);f&&(n?n.children=n.children.concat(f.children):(f.type="AWS.AutoScaling.Group_group",n=f)),n&&b.unshift(n);if(p&&s){v={},d={},y=[],a={},O=s.children;for(E=0,N=O.length;E<N;E++)i=O[E],a[i.component.id]=i;g=[],m=[],M=p.children;for(S=0,C=M.length;S<C;S++){h=M[S],u=h.component.connectionTargets("EniAttachment");if(!u.length)g.push(h);else{o=[h],v[h.component.id]=!0;for(x=0,k=u.length;x<k;x++)i=u[x],d[i.id]=!0,o.push(a[i.id]);y.push({type:"AmiEniPair",children:o})}}_=s.children;for(A=0,L=_.length;A<L;A++)i=_[A],d[i.component.id]||m.push(i);return l(g),b.push({type:"AWS.EC2.Instance_group",children:g}),b.push({type:"AmiEniPari_group",children:y}),b.push({type:"AWS.VPC.NetworkInterface_group",children:m}),b}return p&&(l(p.children),b.push(p)),s&&b.push(s),b},u=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p;a=[],f=[],u={},i=[];for(l=0,h=e.length;l<h;l++)t=e[l],t.component.slaves().length&&(u[t.component.id]=[t]);for(c=0,p=e.length;c<p;c++)t=e[c],s=t.component.master(),s?u[s.id]?u[s.id].push(t):i.push(t):u[t.component.id]||f.push(t);r=[];for(n in u)o=u[n],o.length===1?r.push(o[0]):a.push({type:"MasterSlave",children:o});return r.length&&a.push({type:"MasterSlave",children:r}),t=[],a.length&&t.push({type:"MasterSlave_group",children:a}),i.length&&t.push({type:"AWS.RDS.DBInstance_group",children:i}),f.length&&t.push({type:"AWS.RDS.DBInstance_group",children:f}),t},r=function(e){var t,n,r,i,s,o;if(!e.length)return{width:0,height:0};if(e.length===1)return{width:e[0].width,height:e[0].height};e.sort(function(e,t){return t.height-e.height}),r=0;while(r<e.length)t=e[r],n=e[r+1],n&&n.width*n.height>t.width*t.height&&(e[r]=n,e[r+1]=t),r+=2;o=e[0].height+15,i=0,s=0,r=0;while(r<e.length)t=e[r],n=e[r+1],t.y=0,n?(t.x=i,i+=t.width+4,n.x=s,n.y=o,s+=n.width+4):i>s?(t.x=s,t.y=o,s+=t.width+4):(t.x=i,t.y=0,i+=t.width+4),r+=2;return{width:Math.max(i,s)-4,height:e[1].height+o}},s=function(e){var t,r,i,s,u,a,f,l,c,h,p,d,v,m,g;u=o[n.RESTYPE.VPC],s={};for(d=0,m=e.length;d<m;d++)i=e[d],s[i.type]=i;t=s["AWS.ELB_group"]?18:5,r=4,c=t,i=s["AWS.VPC.RouteTable_group"],i&&(i.x=t,i.y=r,r+=i.height+3),a=r,i=s["AWS.EC2.AvailabilityZone_group"],i&&(i.x=t,i.y=r,c=t+i.width+4,a+=i.children[0].y+i.children[0].height+3),i=s["AWS.ELB_group"],i&&(i.x=5,i.y=a,i.x+i.width>c&&(c=i.x+i.width+4)),i=s["AWS.RDS.DBSubnetGroup_group"],i&&(i.x=c,i.y=r),p=0,l=0;for(v=0,g=e.length;v<g;v++)i=e[v],h=i.x+i.width,h>p&&(p=h),f=i.y+i.height,f>l&&(l=f);return{width:p+5,height:l+4}},i=function(e){var n,r,i,s;r=[];for(i=0,s=e.length;i<s;i++)n=e[i],n.type==="AWS.VPC.VPC_group"?r.unshift(n):r.push(n);return t.DefaultArrangeMethod.call(this,r)},f=function(e){var t,r,i,s,o,u,a;t=[],r=[],o=[];for(u=0,a=e.length;u<a;u++){i=e[u];if(i.type===n.RESTYPE.RT&&i.get("main")){o.unshift(i);continue}if(i.type===n.RESTYPE.ELB){s=i.get("internal")?r:t,i.connections("ElbAmiAsso").length?s.unshift(i):s.push(i);continue}o.push(i)}return o.concat(t,r)},o=e.prototype.autoLayoutConfig={SVG:{arrangeMethod:i,space:6},"AWS.VPC.CustomerGateway_group":{arrangeMethod:"ArrangeVertical",space:2},"AWS.VPC.VPC":{arrangeMethod:s,space:4,sortMethod:f,margin:2,width:60,height:60},"AWS.VPC.VPNGateway":{sticky:!0},"AWS.VPC.InternetGateway":{sticky:!0},"AWS.ELB_group":{space:11},"AWS.ELB":{width:9,height:9},"AWS.VPC.RouteTable_group":{space:4},"AWS.VPC.RouteTable":{width:9,height:9},"AWS.EC2.AvailabilityZone_group":{arrangeMethod:r},"AWS.EC2.AvailabilityZone":{margin:2,width:15,height:15},"AWS.RDS.DBSubnetGroup_group":{arrangeMethod:"ArrangeBinPack",space:4},"AWS.RDS.DBSubnetGroup":{groupMethod:u,margin:2,space:3,width:11,height:11},"AWS.RDS.DBInstance":{width:9,height:9},"AWS.RDS.DBInstance_group":{arrangeMethod:"ArrangeBinPack",space:2},MasterSlave:{arrangeMethod:"ArrangeVertical",space:2},MasterSlave_group:{space:1},"AWS.AutoScaling.LaunchConfiguration":{ignore:!0},"AWS.VPC.NetworkInterface_group":{arrangeMethod:"ArrangeBinPack",space:4},"AWS.VPC.NetworkInterface":{width:9,height:9},"AWS.EC2.Instance_group":{arrangeMethod:"ArrangeBinPack",space:2},"AWS.EC2.Instance":{width:9,height:9},"AWS.AutoScaling.Group_group":{arrangeMethod:"ArrangeBinPack",space:2},"AWS.AutoScaling.Group":{width:13,height:13},ExpandedAsg:{width:13,height:13},"AWS.VPC.Subnet_group":{arrangeMethod:"ArrangeBinPack",space:2},"AWS.VPC.Subnet":{groupMethod:a,margin:2,space:2,width:13,height:13},"AWS.VPC.CustomerGateway":{width:17,height:10},AmiEniPair:{space:1},AmiEniPari_group:{arrangeMethod:"ArrangeVertical",space:1}},null})}.call(this),function(){define("workspaces/editor/canvas/CeVpc",["./CanvasElement","constant","./CanvasManager","./CanvasView"],function(e,t,n,r){return e.extend({type:t.RESTYPE.VPC,parentType:["SVG"],listenModelEvents:function(){this.listenTo(this.model,"change:cidr",this.render)},create:function(){return this.canvas.appendVpc(this.createGroup())},siblings:function(){var e;return e=this.canvas,e.design.componentsOfType(t.RESTYPE.CGW).map(function(t){return e.getItem(t.id)})},label:function(){return""+this.model.get("name")+" ("+this.model.get("cidr")+")"},render:function(){var e;return e=this.model,n.setLabel(this,this.$el.children("text")),this.$el[0].instance.move(e.x()*r.GRID_WIDTH,e.y()*r.GRID_WIDTH)}})})}.call(this),function(){define("workspaces/editor/canvas/CeAz",["./CanvasElement","constant","./CanvasManager","./CanvasView"],function(e,t,n,r){return e.extend({type:t.RESTYPE.AZ,parentType:[t.RESTYPE.VPC],defaultSize:[23,23],create:function(){return this.canvas.appendAz(this.createGroup())},render:function(){var e;return e=this.model,n.update(this.$el.children("text"),e.get("name")),this.$el[0].instance.move(e.x()*r.GRID_WIDTH,e.y()*r.GRID_WIDTH)}},{createResource:function(n,r,i){var s;return r.width=21,r.height=21,s=e.createResource(n,r,i),e.createResource(t.RESTYPE.SUBNET,{x:r.x+2,y:r.y+2,width:r.width-4,height:r.height-4,parent:s},i)}})})}.call(this),function(){define("workspaces/editor/canvas/CeSubnet",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","./CanvasView"],function(e,t,n,r,i){return e.extend({type:t.RESTYPE.SUBNET,parentType:[t.RESTYPE.AZ],defaultSize:[19,19],portPosition:function(t,n){var r,s,o;return r=this.model,s=r.height()*i.GRID_HEIGHT/2-5,t==="subnet-assoc-in"?[-12,s,e.constant.PORT_LEFT_ANGLE]:(o=r.width()*i.GRID_WIDTH+4,n&&(o+=8),[o,s,e.constant.PORT_RIGHT_ANGLE])},listenModelEvents:function(){this.listenTo(this.model,"change:cidr",this.render)},create:function(){var e,t,n;return t=this.canvas.svg,n=this.canvas.appendSubnet(this.createGroup()),n.add([t.use("port_right").attr({"class":"port port-gray tooltip","data-name":"subnet-assoc-in","data-tooltip":r.IDE.PORT_TIP_L}),t.use("port_right").attr({"class":"port port-gray tooltip","data-name":"subnet-assoc-out","data-tooltip":r.IDE.PORT_TIP_M})]),e=this.model,this.initNode(n,e.x(),e.y()),n},label:function(){return""+this.model.get("name")+" ("+this.model.get("cidr")+")"},render:function(){var e;return e=this.model,n.setLabel(this,this.$el.children("text")),this.$el[0].instance.move(e.x()*i.GRID_WIDTH,e.y()*i.GRID_WIDTH)},containPoint:function(e,t){var n,r,i;return r=this.model.x()-2,i=this.model.y(),n=this.size(),r<=e&&i<=t&&r+n.width+4>=e&&i+n.height>=t}})})}.call(this),function(){define("workspaces/editor/canvas/CeRtb",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r){return e.extend({type:t.RESTYPE.RT,parentType:[t.RESTYPE.VPC],defaultSize:[8,8],portPosMap:{"rtb-tgt-left":[10,35,e.constant.PORT_LEFT_ANGLE,8,35],"rtb-tgt-right":[70,35,e.constant.PORT_RIGHT_ANGLE,72,35],"rtb-src-top":[40,3,e.constant.PORT_UP_ANGLE],"rtb-src-bottom":[40,77,e.constant.PORT_DOWN_ANGLE]},portDirMap:{"rtb-tgt":"horizontal","rtb-src":"vertical"},iconUrl:function(){return this.model.get("main")?"ide/icon/cvs-rtb-main.png":"ide/icon/cvs-rtb.png"},listenModelEvents:function(){this.listenTo(this.model,"change:main",this.render)},create:function(){var e,t,n;return e=this.model,n=this.canvas.svg,t=this.createNode({image:this.iconUrl(),imageX:10,imageY:13,imageW:60,imageH:57}).add([n.text("").move(41,27).classes("node-label"),n.use("port_left").attr({"class":"port port-blue tooltip","data-name":"rtb-tgt","data-alias":"rtb-tgt-left","data-tooltip":r.IDE.PORT_TIP_B}),n.use("port_right").attr({"class":"port port-blue tooltip","data-name":"rtb-tgt","data-alias":"rtb-tgt-right","data-tooltip":r.IDE.PORT_TIP_B}),n.use("port_bottom").attr({"class":"port port-gray tooltip","data-name":"rtb-src","data-alias":"rtb-src-top","data-tooltip":r.IDE.PORT_TIP_A}),n.use("port_top").attr({"class":"port port-gray tooltip","data-name":"rtb-src","data-alias":"rtb-src-bottom","data-tooltip":r.IDE.PORT_TIP_A})]),this.canvas.appendNode(t),this.initNode(t,e.x(),e.y()),t},labelWidth:function(t){return e.prototype.labelWidth.call(this,t)-20},render:function(){return n.setLabel(this,this.$el.children(".node-label")),n.update(this.$el.children("image"),this.iconUrl(),"href")}})})}.call(this),function(){define("workspaces/editor/canvas/CeIgw",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","Design","CloudResources"],function(e,t,n,r,i,s){return e.extend({type:t.RESTYPE.IGW,parentType:[t.RESTYPE.VPC],defaultSize:[8,8],portPosMap:{"igw-tgt":[78,35,e.constant.PORT_RIGHT_ANGLE]},sticky:"left",create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createNode({image:"ide/icon/cvs-igw.png",imageX:10,imageY:16,imageW:60,imageH:46,label:e.get("name")}).add(t.use("port_left").attr({"class":"port port-blue tooltip","data-name":"igw-tgt","data-tooltip":r.IDE.PORT_TIP_C})),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n}})})}.call(this),function(){define("workspaces/editor/canvas/CeVgw",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","CloudResources"],function(e,t,n,r,i){return e.extend({type:t.RESTYPE.VGW,parentType:[t.RESTYPE.VPC],defaultSize:[8,8],portPosMap:{"vgw-tgt":[3,35,e.constant.PORT_LEFT_ANGLE],"vgw-vpn":[70,35,e.constant.PORT_RIGHT_ANGLE,72,35]},sticky:"right",create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createNode({image:"ide/icon/cvs-vgw.png",imageX:10,imageY:16,imageW:60,imageH:46,label:e.get("name")}).add([t.use("port_right").attr({"class":"port port-blue tooltip","data-name":"vgw-tgt","data-tooltip":r.IDE.PORT_TIP_C}),t.use("port_right").attr({"class":"port port-purple tooltip","data-name":"vgw-vpn","data-tooltip":r.IDE.PORT_TIP_H})]),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n}},{createResource:function(n,r,i){var s;s=Design.modelClassForType(t.RESTYPE.VPC).theVPC(),r.x=s.x()+s.width()-4;if(r.y<s.y()||r.y+8>s.y()+s.height())r.y=s.y()+Math.round(s.height()/2)-4;return r.parent=s,e.createResource(n,r,i)}})})}.call(this),function(){define("workspaces/editor/canvas/CeCgw",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","CloudResources"],function(e,t,n,r,i){return e.extend({type:t.RESTYPE.CGW,parentType:["SVG"],defaultSize:[17,10],portPosMap:{"cgw-vpn":[6,45,e.constant.PORT_LEFT_ANGLE]},create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createNode({image:"ide/icon/cvs-cgw.png",imageX:13,imageY:8,imageW:151,imageH:76}).add([t.text("").move(90,95).classes("node-label"),t.use("port_right").attr({"class":"port port-purple tooltip","data-name":"cgw-vpn","data-tooltip":r.IDE.PORT_TIP_I})]),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n},labelWidth:function(t){return e.prototype.labelWidth.call(this,t)-4},render:function(){return n.setLabel(this,this.$el.children(".node-label"))}})})}.call(this),function(){define("workspaces/editor/canvas/CeElb",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r){return e.extend({type:t.RESTYPE.ELB,parentType:[t.RESTYPE.VPC],defaultSize:[9,9],portPosMap:{"elb-sg-in":[2,35,e.constant.PORT_LEFT_ANGLE],"elb-assoc":[79,50,e.constant.PORT_RIGHT_ANGLE,81,50],"elb-sg-out":[79,20,e.constant.PORT_RIGHT_ANGLE,81,20]},iconUrl:function(){return this.model.get("internal")?"ide/icon/cvs-elb-int.png":"ide/icon/cvs-elb-ext.png"},listenModelEvents:function(){this.listenTo(this.model,"change:internal",this.render)},create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createNode({image:this.iconUrl(),imageX:9,imageY:11,imageW:70,imageH:53,label:e.get("name"),sg:!0}).add([t.use("port_right").attr({"class":"port port-blue tooltip","data-name":"elb-sg-in","data-tooltip":r.IDE.PORT_TIP_D}),t.use("port_right").attr({"class":"port port-gray tooltip","data-name":"elb-assoc","data-tooltip":r.IDE.PORT_TIP_K}),t.use("port_right").attr({"class":"port port-blue tooltip","data-name":"elb-sg-out","data-tooltip":r.IDE.PORT_TIP_J})]),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n},render:function(){var e;return e=this.model,n.setLabel(this,this.$el.children(".node-label")),n.update(this.$el.children("image"),this.iconUrl(),"href"),n.toggle(this.$el.children('[data-name="elb-sg-in"]'),e.get("internal"))}})})}.call(this),function(){define("workspaces/editor/canvas/CpInstance",["./CanvasPopup","./TplPopup","./CpVolume","event","constant","CloudResources"],function(e,t,n,r,i,s){return e.extend({type:"InstancePopup",attachType:"overlay",className:"canvas-pp instance",events:{"click .instance-pph-close":"remove","click li":"selectItem","click .vpp-ins-vol":"showVolume"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.selectItem({currentTarget:this.$el.find("li")[0]})},content:function(){return t.instance({name:this.host.get("name"),items:this.models||[]})},selectItem:function(e){var t,n;return this.canvas.deselectItem(!0),this.$el.find(".selected").removeClass("selected"),t=$(e.currentTarget).addClass("selected").attr("data-id"),n=i.RESTYPE.INSTANCE,t.indexOf("eni-")===0&&(n=i.RESTYPE.ENI),r.trigger(r.OPEN_PROPERTY,n,$(e.currentTarget).addClass("selected").attr("data-id")),!1},remove:function(){return this.volPopup&&this.volPopup.remove(),e.prototype.remove.apply(this,arguments)},showVolume:function(e){var t,r,o,u,a,f,l,c,h,p,d,v;u=this.canvas.design.region(),t=$(e.currentTarget).closest(".vpp-instance"),o=s(i.RESTYPE.INSTANCE,u).get(t.attr("data-id"));if(!o)return;o=o.attributes,f=s(i.RESTYPE.VOL,u),l=[],d=o.blockDeviceMapping;for(h=0,p=d.length;h<p;h++){r=d[h];if(r.deviceName!==o.rootDeviceName){c=(v=r.ebs)!=null?v.volumeId:void 0;if(!c)continue;a=f.get(c);if(!a)continue;l.push({id:a.id,appId:a.id,name:r.deviceName,snapshot:a.get("snapshotId"),size:a.get("size"),state:a.get("state")||"unknown"})}}return this.volPopup=new n({attachment:t[0],models:l,canvas:this.canvas}),!1}})})}.call(this),function(){define("workspaces/editor/canvas/CpEni",["./CpInstance","./TplPopup","event","constant","CloudResources"],function(e,t,n,r,i){return e.extend({content:function(){return t.eni({name:this.host.get("name"),items:this.models||[]})}})})}.call(this),function(){define("workspaces/editor/canvas/CeEni",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","CloudResources","./CpEni","event"],function(e,t,n,r,i,s,o){return e.extend({type:t.RESTYPE.ENI,parentType:[t.RESTYPE.SUBNET],defaultSize:[9,9],portPosMap:{"eni-sg-left":[10,20,e.constant.PORT_LEFT_ANGLE],"eni-attach":[8,50,e.constant.PORT_LEFT_ANGLE],"eni-sg-right":[80,20,e.constant.PORT_RIGHT_ANGLE],"eni-rtb":[45,2,e.constant.PORT_UP_ANGLE]},portDirMap:{"eni-sg":"horizontal"},events:{"mousedown .eip-status":"toggleEip","mousedown .server-number-group":"showGroup","click .eip-status":function(){return!1}},iconUrl:function(){return this.model.connections("EniAttachment").length?"ide/icon/cvs-eni-att.png":"ide/icon/cvs-eni-unatt.png"},listenModelEvents:function(){this.listenTo(this.model,"change:connections",this.onConnectionChange),this.listenTo(this.model,"change:primaryEip",this.render),this.listenTo(this.canvas,"switchMode",this.render)},onConnectionChange:function(e){if(e.type==="EniAttachment")return this.render()},toggleEip:function(){var e;return this.canvas.design.modeIsApp()?!1:(e=!this.model.hasPrimaryEip(),this.model.setPrimaryEip(e),e&&Design.modelClassForType(t.RESTYPE.IGW).tryCreateIgw(),n.updateEip(this.$el.children(".eip-status"),this.model),o.trigger(o.PROPERTY_REFRESH_ENI_IP_LIST),!1)},create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createNode({image:this.iconUrl(),imageX:16,imageY:15,imageW:59,imageH:49,label:!0,labelBg:!0,sg:!0}).add([t.image("",12,14).move(44,37).classes("eip-status tooltip"),t.use("port_diamond").attr({"class":"port port-blue tooltip","data-name":"eni-sg","data-alias":"eni-sg-left","data-tooltip":r.IDE.PORT_TIP_D}),t.use("port_right").attr({"class":"port port-green tooltip","data-name":"eni-attach","data-tooltip":r.IDE.PORT_TIP_G}),t.use("port_diamond").attr({"class":"port port-blue tooltip","data-name":"eni-sg","data-alias":"eni-sg-right","data-tooltip":r.IDE.PORT_TIP_F}),t.use("port_bottom").attr({"class":"port port-blue tooltip","data-name":"eni-rtb","data-tooltip":r.IDE.PORT_TIP_C}),t.group().add([t.rect(20,14).move(36,2).radius(3).classes("server-number-bg"),t.plain("0").move(46,13).classes("server-number")]).classes("server-number-group")]),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n},render:function(){var e,t,r;return t=this.model,n.setLabel(this,this.$el.children(".node-label")),n.update(this.$el.children("image:not(.eip-status)"),this.iconUrl(),"href"),e=t.serverGroupCount(),r=this.$el.children(".server-number-group"),n.toggle(this.$el.children(".port-eni-rtb"),e<=1),n.toggle(r,e>1),r.children("text").text(e),n.updateEip(this.$el.children(".eip-status"),t)},showGroup:function(){var e,t,n,r,o,u,a,f,l,c,h;if(!this.canvas.design.modeIsApp())return;o=i(this.type,this.model.design().region()),a=(this.model.groupMembers()||[]).slice(0),a.unshift({appId:this.model.get("appId"),ips:this.model.get("ips")}),f=this.model.get("name"),t=[];for(n=l=0,c=a.length;l<c;n=++l){u=a[n],r=o.get(u.appId);if(!r){void 0;continue}r=r.attributes,e=(u.ips||[])[0],t.push({name:""+f+"-"+n,id:u.appId,eip:e!=null?(h=e.eipData)!=null?h.publicIp:void 0:void 0})}new s({attachment:this.$el[0],host:this.model,models:t,canvas:this.canvas})}})})}.call(this),function(){define("workspaces/editor/canvas/CeInstance",["./CanvasElement","constant","./CanvasManager","./CpVolume","./CpInstance","i18n!/nls/lang.js","CloudResources","event","UI.notification"],function(e,t,n,r,i,s,o,u){return e.extend({type:t.RESTYPE.INSTANCE,parentType:[t.RESTYPE.AZ,t.RESTYPE.SUBNET,t.RESTYPE.ASG,"ExpandedAsg"],defaultSize:[9,9],portPosMap:{"instance-sg-left":[10,20,e.constant.PORT_LEFT_ANGLE],"instance-sg-right":[80,20,e.constant.PORT_RIGHT_ANGLE],"instance-attach":[78,50,e.constant.PORT_RIGHT_ANGLE,80,50],"instance-rtb":[45,2,e.constant.PORT_UP_ANGLE]},portDirMap:{"instance-sg":"horizontal"},events:{"mousedown .eip-status":"toggleEip","mousedown .volume-image":"showVolume","mousedown .server-number-group":"showGroup","click .eip-status":"suppressEvent","click .volume-image":"suppressEvent","click .server-number-group":"suppressEvent"},suppressEvent:function(){return!1},iconUrl:function(){var e,t,n,r;return e=this.model.getAmi()||this.model.get("cachedAmi"),e?r="ide/ami/"+e.osType+"."+e.architecture+"."+e.rootDeviceType+".png":(n=this.model,t=o(n.type,n.design().region()).get(n.get("appId")),t?(t=t.attributes,t.platform&&t.platform==="windows"?r="ide/ami/windows."+t.architecture+"."+t.rootDeviceType+".png":r="ide/ami/linux-other."+t.architecture+"."+t.rootDeviceType+".png"):r="ide/ami/ami-not-available.png"),r},listenModelEvents:function(){this.listenTo(this.model,"change:primaryEip",this.render),this.listenTo(this.model,"change:imageId",this.render),this.listenTo(this.model,"change:volumeList",this.render),this.listenTo(this.model,"change:count",this.updateServerCount),this.listenTo(this.canvas,"switchMode",this.render),this.listenTo(this.canvas,"change:externalData",this.render)},updateServerCount:function(){var e,t,n,r,i;this.render(),r=this.model.connectionTargets("EniAttachment");for(t=0,n=r.length;t<n;t++)e=r[t],(i=this.canvas.getItem(e.id))!=null&&i.render()},toggleEip:function(){var e;return this.canvas.design.modeIsApp()?!1:(e=!this.model.hasPrimaryEip(),this.model.setPrimaryEip(e),e&&Design.modelClassForType(t.RESTYPE.IGW).tryCreateIgw(),n.updateEip(this.$el.children(".eip-status"),this.model),u.trigger(u.PROPERTY_REFRESH_ENI_IP_LIST),!1)},select:function(e){var t;t=this.type,this.model.get("appId")&&this.canvas.design.modeIsAppEdit()&&(t="component_server_group"),u.trigger(u.OPEN_PROPERTY,t,this.model.id)},create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=this.createNode({image:"ide/icon/cvs-instance.png",imageX:15,imageY:11,imageW:61,imageH:62,label:!0,labelBg:!0,sg:!0}).add([t.image(MC.IMG_URL+this.iconUrl(),39,27).move(27,15).classes("ami-image"),t.image(MC.IMG_URL+"ide/icon/icn-vol.png",29,24).move(21,46).classes("volume-image"),t.text("").move(35,58).classes("volume-number"),t.image("",12,14).move(53,49).classes("eip-status tooltip"),t.use("port_diamond").attr({"class":"port port-blue tooltip","data-name":"instance-sg","data-alias":"instance-sg-left","data-tooltip":s.IDE.PORT_TIP_D}),t.use("port_right").attr({"class":"port port-green tooltip","data-name":"instance-attach","data-tooltip":s.IDE.PORT_TIP_E}),t.use("port_diamond").attr({"class":"port port-blue tooltip","data-name":"instance-sg","data-alias":"instance-sg-right","data-tooltip":s.IDE.PORT_TIP_D}),t.use("port_bottom").attr({"class":"port port-blue tooltip","data-name":"instance-rtb","data-tooltip":s.IDE.PORT_TIP_C}),t.group().add([t.rect(20,14).move(36,2).radius(3).classes("server-number-bg"),t.plain("0").move(46,13).classes("server-number")]).classes("server-number-group")]),!this.model.design().modeIsStack()&&e.get("appId")&&n.add(t.circle(8).move(63,14).classes("res-state unknown")),this.canvas.appendNode(n),this.initNode(n,e.x(),e.y()),n},render:function(){var e,t,r,i,s,u;return t=this.model,n.setLabel(this,this.$el.children(".node-label")),n.update(this.$el.children(".ami-image"),this.iconUrl(),"href"),r=this.$el.children(".server-number-group"),s=this.$el.children(".res-state"),t.get("count")>1?(n.toggle(s,!1),n.toggle(r,!0),n.update(r.children("text"),t.get("count"))):(n.toggle(s,!0),n.toggle(r,!1),s.length&&(e=o(t.type,t.design().region()).get(t.get("appId")),i=(e!=null?e.get("instanceState").name:void 0)||"unknown",s.data("tooltip",i).attr("data-tooltip",i).attr("class","res-state tooltip "+i))),n.updateEip(this.$el.children(".eip-status"),t),u=t.get("volumeList")?t.get("volumeList").length:0,n.update(this.$el.children(".volume-number"),u)},showVolume:function(){var e;return this.canvas.design.modeIsApp()&&this.model.get("count")>1?!1:this.volPopup?!1:(e=this,this.volPopup=new r({attachment:this.$el[0],host:this.model,models:this.model.get("volumeList"),canvas:this.canvas,onRemove:function(){return _.defer(function(){e.volPopup=null})}}),!1)},showGroup:function(){var e,t,n,r,s,u,a,f,l,c,h,p,d,v,m,g;if(!this.canvas.design.modeIsApp())return;u=o(this.type,this.model.design().region()),f=(this.model.groupMembers()||[]).slice(0),f.unshift({appId:this.model.get("appId")}),l=this.model.get("name"),t=[],n=this.iconUrl();for(r=h=0,d=f.length;h<d;r=++h){a=f[r],s=u.get(a.appId);if(!s){void 0;continue}s=s.attributes,c=s.blockDeviceMapping.length,m=s.blockDeviceMapping;for(p=0,v=m.length;p<v;p++){e=m[p];if(e.deviceName===s.rootDeviceName){--c;break}}t.push({name:""+l+"-"+r,id:a.appId,icon:n,volume:c,state:((g=s.instanceState)!=null?g.name:void 0)||"unknown"})}new i({attachment:this.$el[0],host:this.model,models:t,canvas:this.canvas})}},{isDirectParentType:function(e){return e!==t.RESTYPE.AZ},createResource:function(n,r,i){var o;if(!r.parent)return;switch(r.parent.type){case t.RESTYPE.SUBNET:return e.createResource(n,r,i);case t.RESTYPE.ASG:case"ExpandedAsg":if(i.cloneSource){notification("error",s.CANVAS.LAUNCH_CONFIGURATION_MUST_BE_CREATED_FROM_AMI_IN_RESOURCE_PANEL);return}return o=t.RESTYPE.LC,e.getClassByType(o).createResource(o,r,i);case t.RESTYPE.AZ:return r.parent=e.createResource(t.RESTYPE.SUBNET,{x:r.x+1,y:r.y+1,width:11,height:11,parent:r.parent},i),r.x+=2,r.y+=2,e.createResource(t.RESTYPE.INSTANCE,r,i)}}})})}.call(this),function(){define("workspaces/editor/canvas/CeAsg",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","./CanvasView"],function(e,t,n,r,i){var s;return s=e.extend({type:t.RESTYPE.ASG,parentType:[t.RESTYPE.SUBNET],defaultSize:[15,15],events:{"mousedown .asg-dragger":"dragExpand"},isGroup:function(){return!0},size:function(){return{width:13,height:13}},dragExpand:function(e){return this.canvas.design.modeIsApp()||this.canvas.dragItem(e,{onDrop:this.onDropExpand}),!1},onDropExpand:function(e,t){var n,i,s,o,u;i=t.item,s=i.model,s.type==="ExpandedAsg"&&(s=s.get("originalAsg")),u=t.parent.model,n=Design.modelClassForType("ExpandedAsg"),o=new n({x:t.x,y:t.y,parent:u,originalAsg:s});if(o&&o.id)return;notification("error",sprintf(r.CANVAS.ERR_DROP_ASG,s.get("name"),u.parent().get("name")))},create:function(){var e,t,n;return e=this.model,t=this.canvas.svg,n=t.group().add([t.rect(129,129).move(1,1).radius(5).classes("asg-group"),t.use("asg_frame",!0).classes("asg-frame"),t.use("asg_prompt",!0).classes("asg-prompt"),t.use("asg_dragger").classes("asg-dragger tooltip").attr("data-tooltip",r.CANVAS.CVS_TIP_ASG_DRAGGER),t.plain("").move(4,14).classes("group-label")]).attr({"data-id":this.cid}).classes("canvasel "+this.type.split(".").join("-")),this.canvas.appendAsg(n),this.initNode(n,e.x(),e.y()),n},getLc:function(){return this.model.getLc()},labelWidth:function(e){return(e||this.size().width*i.GRID_WIDTH)-22},render:function(){return n.setLabel(this,this.$el.children("text"))},updateConnections:function(){var e,t,n,r,i;t=this.model.getLc();if(!t)return;i=this.canvas.getItem(t.id).connections();for(n=0,r=i.length;n<r;n++)e=i[n],e.update()},destroy:function(t){var n,r,i;n=this.model.get("expandedList");if(n&&n[0]){n=n[0],n.parent().addChild(this.model),r=n.get("x"),i=n.get("y"),n.remove(),this.moveBy(r-this.model.get("x"),i-this.model.get("y")),this.model.set({x:r,y:i});return}return e.prototype.destroy.apply(this,arguments)}},{createResource:function(t,n,r){var i,s;return n.lcId&&(s=n.lcId,delete n.lcId),n.x+=1,n.y+=1,i=e.createResource(t,n,r),i.setLc(s),i}}),s.extend({type:"ExpandedAsg",render:function(){return n.update(this.$el.children("text"),this.model.get("originalAsg").get("name"))}}),s})}.call(this),function(){define("workspaces/editor/canvas/CeLc",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","./CpVolume","./CpInstance","CloudResources"],function(e,t,n,r,i,s,o){return e.extend({type:t.RESTYPE.LC,portPosMap:{"launchconfig-sg-left":[10,20,e.constant.PORT_LEFT_ANGLE],"launchconfig-sg-right":[80,20,e.constant.PORT_RIGHT_ANGLE]},portDirMap:{"launchconfig-sg":"horizontal"},defaultSize:[9,9],events:{"mousedown .server-number-group":"showGroup","mousedown .volume-image":"showVolume","click .volume-image":"suppressEvent","click .server-number-group":"suppressEvent"},suppressEvent:function(){return!1},listenModelEvents:function(){this.listenTo(this.model,"change:connections",this.render),this.listenTo(this.model,"change:volumeList",this.render),this.listenTo(this.model,"change:imageId",this.render),this.listenTo(this.canvas,"switchMode",this.render),this.listenTo(this.model,"change:expandedList",function(){var e;return e=this,setTimeout(function(){return e.render()},0)})},iconUrl:function(){var e;return e=this.model.getAmi()||this.model.get("cachedAmi"),e?"ide/ami/"+e.osType+"."+e.architecture+"."+e.rootDeviceType+".png":"ide/ami/ami-not-available.png"},pos:function(e){var t,n;return e?n=this.canvas.getItem(e.parentNode.getAttribute("data-id")):(void 0,n=n=this.canvas.getItem(this.model.connectionTargets("LcUsage")[0].id)),n?(t=n.pos(),t.x+=2,t.y+=3,t):{x:0,y:0}},isTopLevel:function(){return!1},ensureLcView:function(){var e,t,n,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;t=!1,s={},S=this.model.connectionTargets("LcUsage");for(d=0,y=S.length;d<y;d++){e=S[d],s[e.id]=e,x=e.get("expandedList");for(v=0,b=x.length;v<b;v++)n=x[v],s[n.id]=n}p=[],T=this.$el;for(m=0,w=T.length;m<w;m++)f=T[m],p.push(f);for(g=0,E=p.length;g<E;g++)f=p[g],o=$(f.parentNode).attr("data-id"),u=this.canvas.getItem(o),u?(a=u.model,s[a.id]?delete s[a.id]:(this.removeView(f),t=!0)):(this.removeView(f),t=!0);l=this.canvas.svg;for(h in s)a=s[h],i=a.type!=="ExpandedAsg",c=this.createNode({image:"ide/icon/cvs-instance.png",imageX:15,imageY:11,imageW:61,imageH:62,label:!0,labelBg:!0,sg:i}).add([l.image(MC.IMG_URL+this.iconUrl(),39,27).move(27,15).classes("ami-image"),l.use("port_diamond").move(10,20).attr({"class":"port port-blue tooltip","data-name":"launchconfig-sg","data-alias":"launchconfig-sg-left","data-tooltip":r.IDE.PORT_TIP_D}),l.use("port_diamond").move(80,20).attr({"class":"port port-blue tooltip","data-name":"launchconfig-sg","data-alias":"launchconfig-sg-right","data-tooltip":r.IDE.PORT_TIP_D}),l.image(MC.IMG_URL+"ide/icon/icn-vol.png",29,24).move(31,46).classes("volume-image"),l.plain("").move(45,58).classes("volume-number"),l.group().add([l.rect(20,14).move(36,2).radius(3).classes("server-number-bg"),l.plain("0").move(46,13).classes("server-number")]).classes("server-number-group")]).classes("canvasel fixed AWS-AutoScaling-LaunchConfiguration").move(20,30),this.addView(c),this.canvas.getItem(h).$el.children().eq(0).after(c.node),t=!0;t&&this.updateConnections()},render:function(e){var r,i,s,u,a,f,l,c,h,p;if(this.canvas.initializing&&!e)return;this.ensureLcView(),u=this.model,n.update(this.$el.children(".node-label"),u.get("name")),n.update(this.$el.children(".ami-image"),this.iconUrl(),"href"),f=u.get("volumeList")?u.get("volumeList").length:0,n.update(this.$el.children(".volume-number"),f),this.$el.children(".server-number-group").hide();if(u.design().modeIsApp()){this.$el.children(".server-number-group").show(),i=o(t.RESTYPE.ASG,u.design().region()),h=this.$el;for(l=0,c=h.length;l<c;l++){s=h[l],r=this.canvas.getItem(s.parentNode.getAttribute("data-id")).model,r=i.get((r.get("originalAsg")||r).get("appId"));if(!r)continue;r=r.attributes;if((p=r.Instances)!=null?p.length:void 0)a=$(s).children(".server-number-group").show(),n.update(a.children("text"),r.Instances.length)}}},destroy:function(t){var n,r,i;if(this.model.connections("LcUsage").length>1){r=this.canvas.getItem(t.parentNode.getAttribute("data-id"));if(!r)return;n=Design.modelClassForType("LcUsage"),i=r.model,i.type==="ExpandedAsg"&&(i=i.get("originalAsg")),(new n(i,this.model)).remove();return}return e.prototype.destroy.apply(this,arguments)},doDestroyModel:function(){var e;return(e=this.model.connections("LcUsage")[0])!=null?e.remove():void 0},showVolume:function(e){var t;return this.volPopup?!1:(t=this,this.canvas.design.modeIsApp()?!1:(this.volPopup=new i({attachment:$(e.currentTarget).closest("g")[0],host:this.model,models:this.model.get("volumeList"),canvas:this.canvas,onRemove:function(){return _.defer(function(){t.volPopup=null})}}),!1))},showGroup:function(e){var n,r,i,u,a,f,l,c,h,p,d,v,m,g,y,b;f=o(t.RESTYPE.INSTANCE,this.model.design().region()),c=this.model.get("name"),r=[],i=this.iconUrl(),g=this.model.groupMembers();for(u=p=0,v=g.length;p<v;u=++p){l=g[u],a=f.get(l.appId);if(!a){void 0;continue}a=a.attributes,h=a.blockDeviceMapping.length,y=a.blockDeviceMapping;for(d=0,m=y.length;d<m;d++){n=y[d];if(n.deviceName===a.rootDeviceName){--h;break}}r.push({name:""+c+"-"+u,id:l.appId,icon:i,volume:h,state:((b=a.instanceState)!=null?b.name:void 0)||"unknown"})}new s({attachment:$(e.currentTarget).closest(".canvasel")[0],host:this.model,models:r,canvas:this.canvas})}},{render:function(e){var n,r,i,s,o;s=e.design.componentsOfType(t.RESTYPE.LC),o=[];for(r=0,i=s.length;r<i;r++)n=s[r],o.push(e.getItem(n.id).render(!0));return o},createResource:function(t,n,r){var i,s;if(!n.parent)return;if(n.parent.getLc())return;return i=n.parent.get("originalAsg")||n.parent,delete n.parent,s=e.createResource(this.type,n,r),i.setLc(s),s}})})}.call(this),function(){define("workspaces/editor/canvas/CeSgAsso",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js"],function(e,t,n,r){return e.extend({type:"SgAsso",initialize:function(n){var r,i,s;this.listenTo(this.model.getTarget(t.RESTYPE.SG),"change:name",this.render),this.canvas=r=n.canvas,this.$el=$(),r.__sgAssoToRender||(r.__sgAssoToRender={}),s=this.model.getOtherTarget(t.RESTYPE.SG).id,r.__sgAssoToRender[s]=this.cid,i=this,_.defer(function(){var e,t;t=r.__sgAssoToRender[s],delete r.__sgAssoToRender[s],e=r.getItem(t),e&&e.render()}),e.prototype.initialize.call(this,n)},remove:function(){this.render(),this.stopListening()},update:function(){},render:function(){var e,r,i,s,o,u,a;if(this.canvas.initializing)return;i=this.model,o=i.getOtherTarget(t.RESTYPE.SG),s=this.canvas.getItem(o.id);if(!s)return;a=i.sortedSgList(),a.length>5&&(a.length=5),e=s.$el.children(".node-sg-color-group").children(":first-child"),r=0;while(r<5)u=a[r],u?(n.update(e,u.color,"color"),n.update(e,u.get("name"),"tooltip")):(n.update(e,"none","color"),n.update(e,"","tooltip")),++r,e=e.next()}})})}.call(this),function(){define("workspaces/editor/canvas/CeLine",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","component/sgrule/SGRulePopup"],function(e,t,n,r,i){var s,o,u,a,f;return o=null,a=function(e,t){var n,r,i,s,o;n=Math.PI/180*t,r=Math.cos(n),i=Math.sin(n),e.y=-e.y,s=Math.round(e.x*r-e.y*i),o=Math.round(e.x*i+e.y*r),e.x=s,e.y=-o},f=function(t,n){var r;r=t[2],r===e.constant.PORT_4D_ANGLE&&(Math.abs(n[0]-t[0])-Math.abs(n[1]-t[1])>0?r=e.constant.PORT_2D_H_ANGLE:r=e.constant.PORT_2D_V_ANGLE),r===e.constant.PORT_2D_H_ANGLE?t[2]=n[0]>=t[0]?e.constant.PORT_RIGHT_ANGLE:e.constant.PORT_LEFT_ANGLE:r===e.constant.PORT_2D_V_ANGLE&&(t[2]=n[1]>=t[1]?e.constant.PORT_DOWN_ANGLE:e.constant.PORT_UP_ANGLE)},u=function(e,t){e[2]<0&&f(e,t),t[2]<0&&f(t,e)},s=e.extend({type:"CeLine",node_line:!0,portName:function(e){return this.model.port(e,"name")},render:function(){var e,t,n,r,i,s,o,u,a,f,l;this.$el.remove(),this.$el=$(),r=this.canvas.getItem(this.model.port1Comp().id),i=this.canvas.getItem(this.model.port2Comp().id),n=this.canvas.__popLineInitiator()||r;if(r.$el.length===1&&i.$el.length===1)this.renderConnection(r,i,void 0,void 0,n);else{f=r.$el;for(s=0,u=f.length;s<u;s++){e=f[s],l=i.$el;for(o=0,a=l.length;o<a;o++)t=l[o],this.renderConnection(r,i,e,t,n)}}},update:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h;r=this.canvas.getItem(this.model.port1Comp().id),i=this.canvas.getItem(this.model.port2Comp().id);if(r.$el.length===1&&i.$el.length===1)this.$el.children().attr("d",this.generatePath(r,i,void 0,void 0));else{s=r.$el.length*i.$el.length;if(this.$el.length<s)while(this.$el.length<s)o=this.createLine("M0 0Z"),this.addView(o);else this.$el.length>s&&(this.$el.slice(s).remove(),this.$el=this.$el.slice(0,s));n=0,c=r.$el;for(u=0,f=c.length;u<f;u++){e=c[u],h=i.$el;for(a=0,l=h.length;a<l;a++)t=h[a],this.$el.eq(n).children().attr("d",this.generatePath(r,i,e,t)),++n}}},createLine:function(e){var t,n;return t=this.canvas.svg,n=t.group().add([t.path(e),t.path(e).classes("fill-line")]).attr({"data-id":this.cid}).classes("line "+this.type.replace(/\./g,"-")),this.canvas.appendLine(n),n},renderConnection:function(e,t,n,r,i){var o,u,a,f,l,c;f=this.generatePath(e,t,n,r),c=this.createLine(f),this.addView(c),!this.canvas.initializing&&i&&(l=this.canvas.svg,a=l.path(f),u=parseFloat(a.node.getTotalLength()).toFixed(2),o=(i===e?1:-1)*(this.__lastDir||1),a.style({"stroke-dasharray":u+" "+u,"stroke-dashoffset":u*o}),setTimeout(function(){return a.classes("mask-line")},20),s.cleanLineMask(c.maskWith(a)))},getConnectPorts:function(e,t,n,r){var i,s,o,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O;i=this.model,g=t.pos(r),m=e.pos(n),g.x*=10,m.x*=10,g.y*=10,m.y*=10,l=i.port1("name"),S=i.port2("name"),o=e.portDirection(l),a=t.portDirection(S),y=[l],b=[S],o&&(y=o==="horizontal"?[l+"-right",l+"-left"]:[l+"-top",l+"-bottom"]),a&&(b=a==="horizontal"?[S+"-right",S+"-left"]:[S+"-top",S+"-bottom"]);for(h=x=0,k=y.length;x<k;h=++x)c=y[h],y[h]={name:c,pos:e.portPosition(c,!0).slice(0)},y[h].pos[0]+=m.x,y[h].pos[1]+=m.y;for(h=T=0,L=b.length;T<L;h=++T)c=b[h],b[h]={name:c,pos:t.portPosition(c,!0).slice(0)},b[h].pos[0]+=g.x,b[h].pos[1]+=g.y;f=-1;for(N=0,A=y.length;N<A;N++){c=y[N];for(C=0,O=b.length;C<O;C++){p=b[C],s=Math.pow(c.pos[0]-p.pos[0],2)+Math.pow(c.pos[1]-p.pos[1],2);if(f===-1||f>s)f=s,d=c,v=p}}return E=t.size(),w=e.size(),u(d.pos,v.pos),{start:{x:d.pos[0],y:d.pos[1],angle:d.pos[2],type:i.port1Comp().type,name:d.name,itemCX:m.x+w.width/2*10,itemCY:m.y+w.height/2*10},end:{x:v.pos[0],y:v.pos[1],angle:v.pos[2],type:i.port2Comp().type,name:v.name,itemCX:g.x+E.width/2*10,itemCY:g.y+E.height/2*10}}},generatePath:function(e,t,n,r){var i,s,o;return s=this.getConnectPorts(e,t,n,r),o=s.start,i=s.end,this.__lastDir=1,this.lineStyle()===0?"M"+o.x+" "+o.y+" L"+i.x+" "+i.y:this.lineStyle()===2||this.lineStyle()===3?this.generateCurvePath(s.start,s.end):o.x===i.x||o.y===i.y?"M"+o.x+" "+o.y+" L"+i.x+" "+i.y:(this.__lastDir=o.y>=i.y?1:-1,MC.canvas._round_corner(MC.canvas.route2(o,i,this.lineStyle())))},lineStyle:function(){return 4},generateCurvePath:function(e,t){var n,r,i,s,o,u,f,l,c;r={x:e.x,y:e.y},i=t.angle,e.x=e.y=0,t.x-=r.x,t.y-=r.y,e.angle!==0&&(a(t,-e.angle),t.angle-=e.angle,t.angle<0&&(t.angle+=360)),n=!1,t.y>0&&(n=!0,t.y=-t.y,t.angle===90?t.angle=270:t.angle===270&&(t.angle=90)),o=this["generateCurvePath"+t.angle](e,t),o.push(t);if(n)for(u=0,l=o.length;u<l;u++)s=o[u],s.y=-s.y;for(f=0,c=o.length;f<c;f++)s=o[f],a(s,e.angle),s.x+=r.x,s.y+=r.y;return o.length===3?"M"+r.x+" "+r.y+"C"+o[0].x+" "+o[0].y+" "+o[1].x+" "+o[1].y+" "+o[2].x+" "+o[2].y:"M"+r.x+" "+r.y+"L"+o[0].x+" "+o[0].y+"C"+o[1].x+" "+o[1].y+" "+o[2].x+" "+o[2].y+" "+o[3].x+" "+o[3].y+"L"+o[4].x+" "+o[4].y},generateCurvePath0:function(e,t){var n,r,i,s,o,u;return o=t.x,u=Math.abs(t.y),r=Math.sqrt(Math.pow(o,2)+Math.pow(u,2))/4,i=Math.PI/180*30,n=r*Math.cos(i),s=r*Math.sin(i),o>0?[{x:n,y:-s},{x:t.x+s,y:t.y+n}]:o===0?[{x:n,y:-s},{x:t.x+n,y:t.y+s}]:[{x:s,y:-n},{x:t.x+n,y:t.y+s}]},generateCurvePath90:function(e,t){var n,r,i,s,o,u;return o=t.x,u=Math.abs(t.y),i=Math.sqrt(Math.pow(o,2)+Math.pow(u,2)),s=Math.PI/180*30,i/=o>0?4:2,n=i*Math.cos(s),r=i*Math.sin(s),o>0?[{x:t.x/2,y:0},{x:t.x-n,y:t.y-r}]:[{x:sin,y:-cos},{x:t.x+cos,y:t.y-sin}]},generateCurvePath180:function(e,t){var n,r,i,s,o,u;return t.x>0?[{x:t.x/2,y:0},{x:t.x/2,y:t.y}]:(o=t.x,u=Math.abs(t.y),r=Math.sqrt(Math.pow(o,2)+Math.pow(u,2))/3,i=Math.PI/180*40,s=r*Math.sin(i),n=r*Math.cos(i),[{x:s,y:-n},{x:t.x-s,y:t.y+n}])},generateCurvePath270:function(e,t){var n,r,i,s,o,u;o=t.x,u=Math.abs(t.y);if(o>0)return Math.abs(o-u)<10?[{x:o,y:0},{x:o,y:t.y}]:o<20?[{x:0,y:0},{x:0,y:0},{x:o,y:0},{x:o,y:-o}]:u<20?[{x:o-u,y:0},{x:o-u,y:0},{x:o,y:0},{x:o,y:t.y}]:o<u?[{x:o,y:0},{x:o,y:t.y/2}]:[{x:o/2,y:0},{x:o,y:0}];return i=Math.sqrt(Math.pow(o,2)+Math.pow(u,2))/4,s=Math.PI/180*30,n=i*Math.cos(s),r=i*Math.sin(s),[{x:n,y:-r},{x:t.x,y:t.y/2}]}},{cleanLineMask:function(e){return o?o.push(e):(o=[e],setTimeout(function(){return s.__cleanLineMask()},340))},__cleanLineMask:function(){var e,t,n;for(t=0,n=o.length;t<n;t++)e=o[t],e.masker&&e.masker.remove();o=null},connect:function(e,t,n){return new e(t,n,void 0,{createByUser:!0})}}),s.extend({type:"EniAttachment"}),s.extend({type:"RTB_Asso"}),s.extend({type:"RTB_Route",lineStyle:function(){return 1},createLine:function(e){var t,n;return t=this.canvas.svg,n=s.prototype.createLine.call(this,e),n.add(t.path(e).classes("dash-line")),n}}),s.extend({type:t.RESTYPE.VPN}),s.extend({type:"ElbSubnetAsso"}),s.extend({type:"ElbAmiAsso"},{connect:function(e,t,n){return new i(t,n),new e(t,n,void 0,{createByUser:!0})}}),s.extend({type:"DbReplication",select:function(){},createLine:function(e){var t,n;return t=this.canvas.svg,n=s.prototype.createLine.call(this,e),n.add(t.path(e).classes("dash-line")),n}}),s})}.call(this),function(){define("workspaces/editor/canvas/CeSgLine",["./CeLine","constant","./CanvasManager","i18n!/nls/lang.js","component/sgrule/SGRulePopup"],function(e,t,n,r,i){return e.extend({type:"SgRuleLine",createLine:function(e){var t,n;return t=this.canvas.svg,n=t.group().add([t.path(e),t.path(e).classes("fill-line")]).attr({"data-id":this.cid}).classes("line "+this.type.replace(/\./g,"-")),this.canvas.appendSgline(n),n},renderConnection:function(t,n,r,i){return e.prototype.renderConnection.call(this,t,n,r,i)},lineStyle:function(){return this.canvas.lineStyle()}},{connect:function(e,t,n){new i(t,n)}})})}.call(this),function(){define("workspaces/editor/canvas/CeDbInstance",["./CanvasElement","constant","./CanvasManager","./CpVolume","./CpInstance","i18n!/nls/lang.js","CloudResources","component/dbsbgroup/DbSubnetGPopup"],function(e,t,n,r,i,s,o,u){return e.extend({type:t.RESTYPE.DBINSTANCE,parentType:[t.RESTYPE.DBSBG,t.RESTYPE.VPC],defaultSize:[9,9],portPosMap:{"db-sg-left":[10,35,e.constant.PORT_LEFT_ANGLE],"db-sg-right":[79,35,e.constant.PORT_RIGHT_ANGLE],replica:[45,45,e.constant.PORT_DOWN_ANGLE]},portDirMap:{"db-sg":"horizontal"},portPosition:function(t,n){var r;return r=this.portPosMap[t],t==="replica"&&(r=r.slice(0),this.model.master()?(r[1]=45,r[2]=e.constant.PORT_2D_V_ANGLE):(r[1]=61,r[2]=e.constant.PORT_DOWN_ANGLE)),r},typeIcon:function(){return"ide/icon/icn-"+this.model.category()+".png"},engineIcon:function(){return"ide/icon/rds-"+(this.model.get("engine")||"").split("-")[0]+".png"},events:{"mousedown .dbreplicate":"replicate","mousedown .dbrestore":"restore"},listenModelEvents:function(){this.listenTo(this.model,"change:backupRetentionPeriod",this.render),this.listenTo(this.model,"change:connections",this.updateReplicaTip),this.listenTo(this.canvas,"change:externalData",this.updateState)},updateState:function(){var e,t,n,r;t=this.model,r=this.$el.children(".res-state");if(r)return e=o(t.type,t.design().region()).get(t.get("appId")),n=(e!=null?e.get("DBInstanceStatus"):void 0)||"unknown",r.data("tooltip",n).attr("data-tooltip",n).attr("class","res-state tooltip "+n)},updateReplicaTip:function(e){e.type==="DbReplication"&&this.render()},replicate:function(e){var t,n,r;if(!this.canvas.design.modeIsApp()&&this.model.slaves().length<5){t=o(this.model.type,this.model.design().region()).get(this.model.get("appId")),t&&(n=(r=t.get("BackupRetentionPeriod"))!==0&&r!=="0");if(this.model.autobackup()&&this.model.get("appId")&&!n)return!1;this.canvas.dragItem(e,{onDrop:this.onDropReplicate})}return!1},restore:function(e){return this.canvas.design.modeIsApp()||this.canvas.dragItem(e,{onDrop:this.onDropRestore}),!1},onDropReplicate:function(e,n){var r,i,o,u,a;a=n.parent.model;if(a!==n.item.model.parent()){notification("error",s.NOTIFY.READ_REPLICA_MUST_BE_DROPPED_IN_THE_SAME_SBG);return}i=n.item.model.get("name"),o=i.match(/(.+-replica)(\d*)$/),o?i=o[1]+((parseInt(o[2],10)||0)+1):i+="-replica",r=Design.modelClassForType(t.RESTYPE.DBINSTANCE),u=new r({x:n.x,y:n.y,name:i,parent:a,sourceId:n.item.model.id},{master:n.item.model}),u.id&&n.item.canvas.selectItem(u.id)},onDropRestore:function(e,n){var r,i,s,o;o=n.parent.model,i=n.item.model.get("name"),r=Design.modelClassForType(t.RESTYPE.DBINSTANCE),s=new r({x:n.x,y:n.y,name:"from-"+i,parent:o},{master:n.item.model,isRestore:!0}),s.id&&n.item.canvas.selectItem(s.id)},create:function(){var e,n,r;return e=this.model,n=this.canvas.svg,r=this.createNode({image:"ide/icon/cvs-rds.png",imageX:14,imageY:8,imageW:62,imageH:66,label:!0,labelBg:!0,sg:!0}).add([n.image(MC.IMG_URL+this.engineIcon(),46,33).move(22,18).classes("engine-image"),n.use("port_diamond").attr({"class":"port port-blue tooltip","data-name":"db-sg","data-alias":"db-sg-left","data-tooltip":s.IDE.PORT_TIP_D}),n.use("port_diamond").attr({"class":"port port-blue tooltip","data-name":"db-sg","data-alias":"db-sg-right","data-tooltip":s.IDE.PORT_TIP_D})]),this.model.get("engine")===t.DB_ENGINE.MYSQL&&(r.add(n.use("port_diamond").attr({"data-name":"replica"}),0),this.model.master()?(r.add(n.plain("REPLICA").move(45,60).classes("replica-text")),r.add(n.use("replica_dragger").attr({"class":"dbreplicate tooltip"}))):(r.add(n.plain("MASTER").move(45,60).classes("master-text")),r.add(n.use("replica_dragger").attr({"class":"dbreplicate tooltip"})))),!e.design().modeIsStack()&&e.get("appId")&&r.add(n.circle(8).move(63,15).classes("res-state unknown")),r.add(n.use("restore_dragger").attr({"class":"dbrestore tooltip"})),this.canvas.appendNode(r),this.initNode(r,e.x(),e.y()),r},render:function(){var e,r,i,s,u,a,f,l,c;s=this.model,n.setLabel(this,this.$el.children(".node-label")),n.update(this.$el.children(".type-image"),this.typeIcon(),"href"),n.update(this.$el.children(".engine-image"),this.engineIcon(),"href"),n.toggle(this.$el.children(".master-text"),s.design().modeIsApp()&&s.slaves().length),s.get("engine")===t.DB_ENGINE.MYSQL&&(e=this.$el.children(".dbreplicate"),r=o(s.type,s.design().region()).get(s.get("appId")),r&&(i=(f=r.get("BackupRetentionPeriod"))!==0&&f!=="0"),s.slaves().length<5?(n.removeClass(e,"disabled"),s.autobackup()?(a="Drag to create a read replica.",s.category()==="replica"&&s.master()&&s.master().master()?n.toggle(e,!1):(n.toggle(e,!0),s.get("appId")&&!i&&(a="Please wait Automatic Backup to be enabled to create read replica.",n.addClass(e,"disabled")))):(a="Drag to create a read replica.",n.toggle(e,!1))):(a="Cannot create more read replica.",n.toggle(e,!0),n.addClass(e,"disabled")),n.update(e,a,"tooltip"),s.getSourceDBForRestore()&&n.toggle(e,!1)),e=this.$el.children(".dbrestore"),n.toggle(e,!!s.get("appId")),n.update(e,"Drag to restore to point in time","tooltip"),r=o(s.type,s.design().region()).get(s.get("appId")),r&&(u=r.get("PendingModifiedValues"),((l=r.get("BackupRetentionPeriod"))===0||l==="0"||u&&((c=u.BackupRetentionPeriod)===0||c==="0"))&&n.toggle(e,!1)),this.updateState()}},{isDirectParentType:function(e){return e!==t.RESTYPE.VPC},createResource:function(n,r,i){var o;if(!r.parent)return;if(i&&((o=i.cloneSource)!=null?o.master():void 0)){if(i.cloneSource.master().slaves().length>5){notification("error",s.NOTIFY.CANNOT_CREATE_MORE_READ_REPLICA);return}i.master=i.cloneSource.master(),delete i.cloneSource}switch(r.parent.type){case t.RESTYPE.DBSBG:return e.createResource(n,r,i);case t.RESTYPE.VPC:r.parent=e.createResource(t.RESTYPE.DBSBG,{x:r.x+1,y:r.y+1,width:11,height:11,parent:r.parent},i);if(!r.parent.id){notification("error",s.NOTIFY.CANNOT_CREATE_SBG_DUE_TO_INSUFFICIENT_SUBNETS);return}return r.x+=2,r.y+=2,new u({model:r.parent}),e.createResource(t.RESTYPE.DBINSTANCE,r,i)}}})})}.call(this),function(){define("workspaces/editor/canvas/CeDbSubnetGroup",["./CanvasElement","constant","./CanvasManager","i18n!/nls/lang.js","./CanvasView","component/dbsbgroup/DbSubnetGPopup"],function(e,t,n,r,i,s){return e.extend({type:t.RESTYPE.DBSBG,parentType:[t.RESTYPE.VPC],defaultSize:[19,19],events:{"mouseenter .tooltip":"hoverLabel","mouseleave .tooltip":"hoverOutLabel"},hoverLabel:function(e){var t,r,i,s,o;o=this.model.connectionTargets("SubnetgAsso");for(i=0,s=o.length;i<s;i++)r=o[i],t=this.canvas.getItem(r.id),t&&n.addClass(t.$el,"highlight")},hoverOutLabel:function(e){var t,r,i,s,o;o=this.model.connectionTargets("SubnetgAsso");for(i=0,s=o.length;i<s;i++)r=o[i],t=this.canvas.getItem(r.id),t&&n.removeClass(t.$el,"highlight")},listenModelEvents:function(){this.listenTo(this.model,"change:connections",this.render)},labelWidth:function(e){return(e||this.model.width()*i.GRID_WIDTH)-20},create:function(){var e,t,n;return t=this.canvas.svg,n=this.canvas.appendSubnet(this.createGroup()),n.add([t.use("sbg_info"),t.rect(16,14).move(4,4).classes("tooltip")]),$(n.node).children(".group-label").attr({"class":"tooltip group-label",x:"17",y:"14"}),e=this.model,this.initNode(n,e.x(),e.y()),n},render:function(){var e,t,s,o,u,a;e=this.model,n.setLabel(this,this.$el.children("text")),this.$el[0].instance.move(e.x()*i.GRID_WIDTH,e.y()*i.GRID_WIDTH),s=[],a=e.connectionTargets("SubnetgAsso");for(o=0,u=a.length;o<u;o++)t=a[o],s.push(t.get("name"));n.update(this.$el.children(".tooltip"),s.join(", ")||r.CANVAS.CVS_NO_SUBNET_ASSIGNED_TO_SG,"tooltip")},doDestroyModel:function(){return this.hoverOut(),e.prototype.doDestroyModel.apply(this,arguments)}},{createResource:function(n,r,i){var o;if(!r.parent)return;o=e.createResource(t.RESTYPE.DBSBG,r,i),new s({model:o})}})})}.call(this),function(){define("workspaces/editor/canvas/CanvasBundle",["./CanvasManager","./CanvasView","./CanvasViewDnd","./CanvasViewConnect","./CanvasViewGResizer","./CanvasViewLayout","./CanvasViewAwsLayout","./CeVpc","./CeAz","./CeSubnet","./CeRtb","./CeIgw","./CeVgw","./CeCgw","./CeElb","./CeEni","./CeInstance","./CeAsg","./CeLc","./CeSgAsso","./CeLine","./CeSgLine","./CeDbInstance","./CeDbSubnetGroup"],function(e,t){return t})}.call(this),function(){define("workspaces/editor/OpsViewBase",["./template/TplOpsEditor","./subviews/PropertyPanel","./subviews/Toolbar","./subviews/ResourcePanel","./subviews/Statusbar","./canvas/CanvasViewAws","UI.modalplus","event","./canvas/CanvasBundle","backbone","UI.selectbox"],function(e,t,n,r,i,s,o,u){return $(window).on("keydown",function(e){var t,n;if($(e.target).is("input, textarea")||e.target.contentEditable==="true"){e.stopPropagation();return}t=$("#OpsEditor");if(!t.length)return;switch(e.keyCode){case 8:case 46:e.which===8&&e.preventDefault(),!e.ctrlKey&&!e.metaKey&&(n="DelSelectItem");break;case 37:case 38:case 39:case 40:n="MoveSelectItem";break;case 83:e.ctrlKey||e.metaKey?n="Save":n="ShowStateEditor";break;case 80:n="ShowProperty";break;case 187:n="ZoomIn";break;case 189:n="ZoomOut";break;case 13:n="ShowStateEditor"}if(n)return t.triggerHandler(n,e.which),!1}),Backbone.View.extend({events:{Save:"saveStack",DelSelectItem:"delSelectedItem",SelectPrevItem:"selectPrevItem",SelectNextItem:"selectNextItem",MoveSelectItem:"moveSelectedItem",ZoomIn:"zoomIn",ZoomOut:"zoomOut",ShowProperty:"showProperty",ShowStateEditor:"showStateEditor","click .HideOEPanelLeft":"toggleLeftPanel","click .HideOEPanelRight":"toggleRightPanel"},constructor:function(o){var u;_.extend(this,o),this.setElement($(e.frame()).appendTo("#main").attr("data-ws",this.workspace.id).show()[0]),u={workspace:this.workspace,parent:this},this.toolbar=new n(u),this.propertyPanel=new t(u),this.resourcePanel=new r(u),this.statusbar=new i(u),this.canvas=new s(u),this.initialize()},toggleLeftPanel:function(){return this.resourcePanel.toggleLeftPanel(),this.canvas.updateSize(),!1},toggleRightPanel:function(){return this.propertyPanel.toggleRightPanel(),this.canvas.updateSize(),!1},saveStack:function(){return this.toolbar.$el.find(".icon-save").trigger("click")},moveSelectedItem:function(e,t){var n,r;switch(t){case 37:n=-1;break;case 38:r=-1;break;case 39:n=1;break;case 40:r=1}return this.canvas.moveSelectedItem(n||0,r||0),!1},delSelectedItem:function(){return this.canvas.delSelectedItem(),!1},selectPrevItem:function(){return this.canvas.selectPrevItem(),!1},selectNextItem:function(){return this.canvas.selectNextItem(),!1},zoomIn:function(){return this.canvas.zoomIn(),this.toolbar.updateZoomButtons(),!1},zoomOut:function(){return this.canvas.zoomOut(),this.toolbar.updateZoomButtons(),!1},backup:function(){this.propertyPanel.backup(),this.$el.attr("id","")},recover:function(){this.$el.show().attr("id","OpsEditor"),this.resourcePanel.recalcAccordion(),this.propertyPanel.recover()},remove:function(){return this.toolbar.remove(),this.propertyPanel.remove(),this.resourcePanel.remove(),this.statusbar.remove(),this.canvas.remove(),Backbone.View.prototype.remove.call(this)},showCloseConfirm:function(){var t,n,r;n=this.workspace.design.get("name"),r=this,t=new o({title:"Confirm to close "+n,width:"420",template:e.modal.onClose(n),confirm:{text:"Close Tab",color:"red"},onConfirm:function(){t.close(),r.workspace.remove()}})},showProperty:function(){u.trigger(u.FORCE_OPEN_PROPERTY)},showStateEditor:function(){var e;e=this.workspace.getSelectedComponent(),e&&u.trigger(u.SHOW_STATE_EDITOR,e.id)},getSvgElement:function(){var e,t;t=this.$el.children(".OEMiddleWrap").children(".OEPanelCenter").children();while(t.length){e=t.filter("svg");if(e.length)return e;t=t.children()}return null}})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/editor/OpsEditorBase",["Workspace","./OpsViewBase","./template/TplOpsEditor","ThumbnailUtil","OpsModel","Design","ApiRequest","UI.modalplus","i18n!/nls/lang.js"],function(e,n,r,i,s,o,u,a,f){var l,c;return l=Backbone.View.extend({isLoadingView:!0,initialize:function(e){return this.setElement($(r.loading()).appendTo("#main").show()[0])},setText:function(e){return this.$el.find(".processing").text(e)},showVpcNotExist:function(e,t){var n,i;i=this,n=new a({title:"Confirm to remove the app "+e+"?",template:r.modal.confirmRemoveApp(),confirm:{text:f.IDE.POP_CONFIRM_TO_REMOVE,color:"red"},disableClose:!0,onConfirm:function(){return t(),n.close()}})}}),c=function(r){function a(t){var n;if(!t)throw this.remove(),new Error("Cannot find opsmodel while openning workspace.");this.opsModel=t,this.listenTo(this.opsModel,"destroy",this.onOpsModelStateChanged),this.listenTo(this.opsModel,"change:state",this.onOpsModelStateChanged),this.listenTo(this.opsModel,"change:name",this.updateTab),this.listenTo(this.opsModel,"change:id",this.onModelIdChange),n=this,this.opsModel.fetchJsonData().then(function(){return n.jsonLoaded()},function(e){return n.jsonLoadFailed(e)}),e.apply(this,arguments)}return t(a,r),a.prototype.title=function(){return this.opsModel.get("name")},a.prototype.tabClass=function(){return"icon-stack-tabbar"},a.prototype.url=function(){return this.opsModel.url()},a.prototype.isWorkingOn=function(e){return this.opsModel===e},a.prototype.viewClass=n,a.prototype.fetchAdditionalData=function(){var e;return e=Q.defer(),e.resolve(),e.promise},a.prototype.isReady=function(){return!!this.__hasAdditionalData},a.prototype.getSelectedComponent=function(){return this.view.canvas?this.view.canvas.getSelectedComp():null},a.prototype.onOpsModelStateChanged=function(){if(this.opsModel.get("state")===s.State.Destroyed)return this.remove()},a.prototype.onModelIdChange=function(){this.updateUrl(),this.design&&this.design.set("id",this.opsModel.get("id"))},a.prototype.jsonLoadFailed=function(e){if(this.isRemoved())return;if(e.error===u.Errors.MissingDataInServer)return;return notification("error",f.NOTIFY.FAILED_TO_LOAD_DATA),this.remove()},a.prototype.jsonLoaded=function(){var e;if(this.isRemoved())return;e=this,this.fetchAdditionalData().then(function(){return e.additionalDataLoaded()},function(){return e.additionalDataLoadFailed()})},a.prototype.additionalDataLoadFailed=function(){if(this.isRemoved())return;return notification("error",f.NOTIFY.FAILED_TO_LOAD_AWS_DATA),this.remove()},a.prototype.additionalDataLoaded=function(){if(this.isRemoved())return;this.__hasAdditionalData=!0,this.view&&this.view.isLoadingView&&(this.view.remove(),this.view=null),this.isAwake()&&!this.__inited&&this.__initEditor()},a.prototype.awake=function(){if(!this.isReady()){this.view?this.view.$el.show():this.view=new l;return}this.__inited?(this.design.use(),this.view.recover()):this.__initEditor()},a.prototype.sleep=function(){return this.view&&this.view.backup&&this.view.backup(),e.prototype.sleep.call(this)},a.prototype.cleanup=function(){this.stopListening(),this.view&&this.view.remove(),this.design&&(this.design.unuse(),this.design=null)},a.prototype.isInited=function(){return!!this.__inited},a.prototype.__initEditor=function(){this.__inited=!0,this.design=new o(this.opsModel),this.listenTo(this.design,"change:name",this.updateTab),this.view=new this.viewClass({workspace:this}),this.initEditor(),this.opsModel.getThumbnail()||this.saveThumbnail(),this.opsModel.__setJsonData(this.design.serialize())},a.prototype.initEditor=function(){},a.prototype.saveThumbnail=function(){if(this.opsModel.isPersisted())return i.generate(this.view.getSvgElement()).then(function(e){return function(t){return e.opsModel.saveThumbnail(t)}}(this))},a.prototype.isRemovable=function(){return!this.__inited||!this.isModified()?!0:(this.view.showCloseConfirm(),!1)},a}(e),c})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/editor/OpsEditorStack",["./OpsEditorBase","Design","CloudResources","constant"],function(e,n,r,i){var s;return s=function(n){function s(){return s.__super__.constructor.apply(this,arguments)}return t(s,n),s.prototype.title=function(){return(this.design||this.opsModel).get("name")+" - stack"},s.prototype.isReady=function(){var e,t;return this.__hasAdditionalData?!0:!this.opsModel.hasJsonData()||!this.opsModel.isPersisted()?!1:(e=this.opsModel.get("region"),t=this.opsModel.getJsonData().agent.module,r(i.RESTYPE.AZ,e).isReady()&&r(i.RESTYPE.SNAP,e).isReady()&&r(i.RESTYPE.DBENGINE,e).isReady()&&r(i.RESTYPE.DBOG,e).isReady()&&r(i.RESTYPE.DBSNAP,e).isReady()&&r("QuickStartAmi",e).isReady()&&r("MyAmi",e).isReady()&&r("FavoriteAmi",e).isReady()&&!!App.model.getStateModule(t.repo,t.tag)&&this.hasAmiData())},s.prototype.fetchAdditionalData=function(){var e,t,n;return t=this.opsModel.get("region"),n=this.opsModel.getJsonData().agent.module,e=[App.model.fetchStateModule(n.repo,n.tag),r(i.RESTYPE.AZ,t).fetch(),r(i.RESTYPE.SNAP,t).fetch(),r("QuickStartAmi",t).fetch(),r("MyAmi",t).fetch(),r("FavoriteAmi",t).fetch(),this.fetchAmiData(),this.fetchRdsData(!1)],this.opsModel.isPersisted()||e.unshift(this.opsModel.save()),Q.all(e)},s.prototype.hasAmiData=function(){var e,t,n,s,o,u;s=this.opsModel.getJsonData(),e=r(i.RESTYPE.AMI,this.opsModel.get("region")),u=s.component;for(o in u){t=u[o];if(t.type===i.RESTYPE.INSTANCE||t.type===i.RESTYPE.LC){n=t.resource.ImageId;if(n&&!e.get(n)&&!e.isInvalidAmiId(n))return!1}}return!0},s.prototype.fetchAmiData=function(){var e,t,n,s,o,u;n=this.opsModel.getJsonData(),s={},u=n.component;for(o in u){e=u[o];if(e.type===i.RESTYPE.INSTANCE||e.type===i.RESTYPE.LC)t=e.resource.ImageId,t&&(s[t]=!0)}return r(i.RESTYPE.AMI,this.opsModel.get("region")).fetchAmis(_.keys(s))},s.prototype.isRdsDisabled=function(){return!!this.__disableRds},s.prototype.fetchRdsData=function(e){var t,n,s;return e==null&&(e=!0),s=this,n=this.opsModel.get("region"),e?t="fetchForce":t="fetch",Q.all([r(i.RESTYPE.DBENGINE,n)[t](),r(i.RESTYPE.DBOG,n)[t](),r(i.RESTYPE.DBSNAP,n)[t]()]).then(function(){if(s.__disableRds!==!1)return s.__disableRds=!1,s.trigger("toggleRdsFeature",!0)},function(e){if(e.awsErrorCode){void 0,s.__disableRds=!0,s.trigger("toggleRdsFeature",!1);return}throw e})},s.prototype.cleanup=function(){e.prototype.cleanup.call(this),this.opsModel.isPersisted()||this.opsModel.remove()},s.prototype.isModified=function(){return this.opsModel.isPersisted()?this.design&&this.design.isModified():!0},s}(e),s})}.call(this),function(){define("workspaces/editor/OpsViewApp",["./OpsViewBase","OpsModel","./template/TplOpsEditor","UI.modalplus","i18n!/nls/lang.js","appAction"],function(e,t,n,r,i,s){return e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.$el.find(".OEPanelLeft").addClass("force-hidden").empty(),this.toggleProcessing(),this.updateProgress(),this.listenTo(this.workspace.design,"change:mode",this.switchMode)},switchMode:function(e){this.toolbar.updateTbBtns(),this.statusbar.update(),e==="appedit"?(this.$el.find(".OEPanelLeft").removeClass("force-hidden"),this.resourcePanel.render()):this.$el.find(".OEPanelLeft").addClass("force-hidden").empty(),this.propertyPanel.openPanel()},confirmImport:function(){var e,t;t=this,e=new r({title:"App Imported",template:n.modal.confirmImport({name:this.workspace.opsModel.get("name")}),confirm:{text:"Done"},disableClose:!0,hideClose:!0,onCancel:function(){t.workspace.remove()},onConfirm:function(){var n,r;n=e.tpl.find("#ImportSaveAppName"),n.parsley("custom",function(e){var n;if(!MC.validate("awsName",e))return i.PARSLEY.SHOULD_BE_A_VALID_STACK_NAME;n=App.model.appList().where({name:e});if(n.length===1&&n[0]===t.workspace.opsModel||n.length===0)return;return sprintf(i.PARSLEY.TYPE_NAME_CONFLICT,"App",e)});if(!n.parsley("validate"))return;return e.tpl.find(".modal-confirm").attr("disabled","disabled"),r=t.workspace.design.serialize(),r.name=n.val(),r.usage=$("#app-usage-selectbox").find(".item.selected").attr("data-value")||"testing",r.resource_diff=$("#MonitorImportApp").is(":checked"),t.workspace.opsModel.saveApp(r).then(function(){var n;return n=t.workspace.design,n.set("name",r.name),n.set("resource_diff",r.resource_diff),n.set("usage",r.usage),$("#OEPanelRight").trigger("REFRESH"),e.close()},function(t){notification("error",t.msg),e.tpl.find(".modal-confirm").removeAttr("disabled")})}})},toggleProcessing:function(){var e,r;if(!this.$el)return;this.toolbar.updateTbBtns(),this.statusbar.update(),this.$el.children(".ops-process").remove(),e=this.workspace.opsModel;if(!e.isProcessing())return;switch(e.get("state")){case t.State.Starting:r="Starting your app...";break;case t.State.Stopping:r="Stopping your app...";break;case t.State.Terminating:r="Terminating your app..";break;case t.State.Updating:r="Applying changes to your app...";break;default:void 0,r="Processing your request..."}this.__progress=0,this.$el.append(n.appProcessing(r))},updateProgress:function(){var e,t,n;t=this.workspace.opsModel.get("progress"),e=this.$el.find(".ops-process"),e.toggleClass("has-progess",!!t),this.__progress>t&&e.toggleClass("rolling-back",!0),this.__progress=t,n=""+t+"%",e.find(".process-info").text(n),e.find(".bar").css({width:n})},showUpdateStatus:function(e,t){var r;this.$el.find(".ops-process").remove(),r=this,$(n.appUpdateStatus({error:e,loading:t})).appendTo(this.$el).find("#processDoneBtn").click(function(){return r.$el.find(".ops-process").remove()})},showUnpayUI:function(){this.statusbar.remove(),this.propertyPanel.remove(),this.toolbar.remove(),this.canvas.updateSize(),s.showPayment($("<div class='ops-apppm-wrapper'></div>").appendTo(this.$el)[0]),notification("error","Your account is limited now.")},listenToPayment:function(){var e;return e=this,this.workspace.listenTo(App.user,"paymentUpdate",function(){if(!$(".ops-apppm-wrapper").size()){if(App.user.shouldPay())return e.showUnpayUI()}else if(!App.user.shouldPay())return e.reopenApp()})},reopenApp:function(){var e,t;return e=this.workspace.opsModel.get("id"),t=this.workspace.index(),this.workspace.remove(),_.defer(function(){return App.openOps(e).setIndex(t),notification("info","User payment status change detected, reloading app resource.")})}})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/editor/OpsEditorApp",["./OpsEditorStack","./OpsViewApp","ResDiff","OpsModel","Design","CloudResources","constant"],function(e,n,r,i,s,o,u){var a;return a=function(e){function a(){return a.__super__.constructor.apply(this,arguments)}return t(a,e),a.prototype.viewClass=n,a.prototype.title=function(){return((this.design||this.opsModel).get("name")||this.opsModel.get("importVpcId"))+" - app"},a.prototype.tabClass=function(){switch(this.opsModel.get("state")){case i.State.Running:return"icon-app-running";case i.State.Stopped:return"icon-app-stopped";default:return"icon-app-pending"}},a.prototype.isReady=function(){return!!this.__hasAdditionalData},a.prototype.isAppEditMode=function(){var e;return(e=this.design)!=null?e.modeIsAppEdit():void 0},a.prototype.isModified=function(){return this.design&&this.design.modeIsAppEdit()&&this.design.isModified()},a.prototype.fetchAdditionalData=function(){var e,t,n;return t=this,e=this.opsModel.get("region"),n=this.opsModel.getJsonData().agent.module,Q.all([App.model.fetchStateModule(n.repo,n.tag),o(u.RESTYPE.AZ,e).fetch(),o(u.RESTYPE.SNAP,e).fetch(),o(u.RESTYPE.DHCP,e).fetch(),o("QuickStartAmi",e).fetch(),o("MyAmi",e).fetch(),o("FavoriteAmi",e).fetch(),this.loadVpcResource(),this.fetchAmiData(),this.fetchRdsData(!1)]).fail(function(e){return t.__handleDataError(e)})},a.prototype.__handleDataError=function(e){if(e.error===286){this.view.showVpcNotExist(this.opsModel.get("name"),function(e){return function(){return e.opsModel.terminate(!0)}}(this)),this.remove();return}throw e},a.prototype.initEditor=function(){if(this.opsModel.isImported()){this.updateTab(),this.view.canvas.autoLayout(),this.view.confirmImport();return}App.user.shouldPay()&&this.opsModel.isPMRestricted()?this.view.showUnpayUI():this.diff(),this.view.listenToPayment()},a.prototype.diff=function(){var e,t,n;if(!this.opsModel.testState(i.State.Running))return;return t=this.opsModel.generateJsonFromRes(),n=this,e=new r({old:this.opsModel.getJsonData(),"new":t,callback:function(r){if(r)return n.applyDiff(t,e.getChangeInfo().needUpdateLayout);n.remove()}}),e.getChangeInfo().hasResChange?(e.render(),!0):!1},a.prototype.applyDiff=function(e,t){var n;try{this.opsModel.__setJsonData(e),this.design.reload(),t&&this.view.canvas.autoLayout()}catch(r){n=r,void 0}return this.opsModel.saveApp(this.design.serialize())},a.prototype.reloadAppData=function(){var e;this.view.showUpdateStatus("",!0),e=this,this.loadVpcResource().then(function(){return e.__onReloadDone()},function(){return e.view.toggleProcessing()})},a.prototype.__onReloadDone=function(){if(this.isRemoved())return;this.view.toggleProcessing(),this.diff()||this.view.canvas.update()},a.prototype.loadVpcResource=function(){return o("OpsResource",this.opsModel.getVpcId()).init(this.opsModel.get("region")).fetchForce()},a.prototype.switchToEditMode=function(){return this.design.setMode(s.MODE.AppEdit)},a.prototype.cancelEditMode=function(e){var t;return t=e||this.design.isModified(),t&&!e?!1:(this.design.setMode(s.MODE.App),t&&this.design.reload(),!0)},a.prototype.applyAppEdit=function(e,t){var n;if(!e){this.design.setMode(s.MODE.App);return}return this.__applyingUpdate=!0,t=t&&!this.opsModel.testState(i.State.Stopped),n=this,this.view.listenTo(this.opsModel,"change:progress",this.view.updateProgress),this.opsModel.update(e,t).then(function(){return t?n.__onAppEditDidDone():n.__onAppEditDone()},function(e){return n.__onAppEditFail(e)}),!0},a.prototype.__onAppEditFail=function(e){var t;if(this.isRemoved())return;this.__applyingUpdate=!1,this.view.stopListening(this.opsModel,"change:progress",this.view.updateProgress),t=e.msg,e.result&&(t+="\n"+e.result),t=t.replace(/\n/g,"<br />"),this.view.showUpdateStatus(t)},a.prototype.__onAppEditDone=function(){var e;if(this.isRemoved())return;e=this,this.view.showUpdateStatus("",!0),this.loadVpcResource().then(function(){return e.__onAppEditDidDone()})},a.prototype.__onAppEditDidDone=function(){if(this.isRemoved())return;this.__applyingUpdate=!1,this.view.stopListening(this.opsModel,"change:progress",this.view.updateProgress),this.view.showUpdateStatus(),this.design.setMode(s.MODE.App),this.design.reload(),this.saveThumbnail()},a.prototype.onOpsModelStateChanged=function(){var e;if(!this.isInited())return;if(this.opsModel.testState(i.State.Saving)||this.opsModel.previous("state")===i.State.Saving)return;this.updateTab(),this.opsModel.isProcessing()?this.view.toggleProcessing():this.opsModel.testState(i.State.Destroyed)?this.remove():this.__applyingUpdate||(e=this,this.view.showUpdateStatus("",!0),this.loadVpcResource().then(function(){return e.__onVpcResLoaded()}))},a.prototype.__onVpcResLoaded=function(){if(this.isRemoved())return;this.view.canvas.update(),this.view.toggleProcessing()},a}(e),a})}.call(this),function(){define("workspaces/OpsEditor",["./editor/ProgressViewer","./editor/OpsEditorStack","./editor/OpsEditorApp","./editor/framework/DesignBundle"],function(e,t,n){var r;return r=function(r){if(!r)throw new Error("Cannot find opsmodel while openning workspace.");return r.isProcessing()?new e(r):r.isStack()?new t(r):new n(r)},r})}.call(this);