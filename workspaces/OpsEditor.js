define("workspaces/editor/template/TplProgress",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){return"has-progess"}function c(e,t){var n;return a((n=e&&e.title,typeof n===u?n.apply(e):n))}function h(e,t){return a(n.i18n.call(e,"PROC_TITLE",{hash:{},data:t}))}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+="<div class='ops-process ",o=n["if"].call(t,t&&t.progress,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\'>\r\n  <section class="processing-wrap">\r\n    <header class="processing">',o=n["if"].call(t,t&&t.title,{hash:{},inverse:f.program(5,h,i),fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='<span class="process-info">'+a((o=t&&t.progress,typeof o===u?o.apply(t):o))+'%</span></header>\r\n    <header class="processing rolling-back-content">Rolling back...</header>\r\n    <section class="loading-spinner"></section>\r\n    <section class="progress"> <div class="bar" style="width:'+a((o=t&&t.progress,typeof o===u?o.apply(t):o))+'%;"></div> </section>\r\n  </section>\r\n\r\n  <section class="success hide">\r\n    <p class="title">'+a(n.i18n.call(t,"PROC_RLT_DONE_TITLE",{hash:{},data:i}))+'</p>\r\n    <p class="sub-title">'+a(n.i18n.call(t,"PROC_RLT_DONE_SUB_TITLE",{hash:{},data:i}))+'</p>\r\n  </section>\r\n\r\n  <section class="fail hide error-info-block">\r\n    <header>'+a(n.i18n.call(t,"PROC_FAILED_TITLE",{hash:{},data:i}))+'</header>\r\n    <p class="sub-title">'+a(n.i18n.call(t,"PROC_RLT_FAILED_SUB_TITLE",{hash:{},data:i}))+'</p>\r\n    <div class="result-error-info">\r\n      <p class="title">'+a(n.i18n.call(t,"PROC_ERR_INFO",{hash:{},data:i}))+'</p>\r\n      <p class="detail"></p>\r\n    </div>\r\n    <button class="btn btn-silver btn-close-process right">'+a(n.i18n.call(t,"PROC_CLOSE_TAB",{hash:{},data:i}))+"</button>\r\n  </section>\r\n</div>",s};return e.template(t)}),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/editor/ProgressViewer",["OpsModel","Workspace","./template/TplProgress","backbone"],function(e,n,r){var i,s;return s=Backbone.View.extend({events:{"click .btn-close-process":"close"},initialize:function(){var t;this.listenTo(this.model,"destroy",this.updateState),this.listenTo(this.model,"change:state",this.updateState),this.listenTo(this.model,"change:progress",this.updateProgress),t={progress:this.model.get("progress")},this.model.testState(e.State.Initializing)||(t.title=this.model.getStateDesc()+" your app..."),this.setElement($(r(t)).appendTo("#main")),this.__progress=0},switchToDone:function(){var e;this.$el.find(".success").show(),e=this,setTimeout(function(){e.$el.find(".processing-wrap").addClass("fadeout"),e.$el.find(".success").addClass("fadein")},10),setTimeout(function(){return e.trigger("done")},2e3)},updateState:function(){switch(this.model.get("state")){case e.State.Running:case e.State.Stopped:this.__awake?this.switchToDone():this.done=!0;break;case e.State.Destroyed:if(this.done){this.close();return}this.$el.children().hide(),this.$el.find(".fail").show(),this.$el.find(".detail").text(this.model.get("opsActionError"));break;default:void 0}},updateProgress:function(){var e,t;e=this.model.get("progress"),this.$el.toggleClass("has-progess",!0),this.__progress>e&&this.$el.toggleClass("rolling-back",!0),this.__progress=e,t=""+e+"%",this.$el.find(".process-info").text(t),this.$el.find(".bar").css({width:t})},close:function(){return this.trigger("close")},awake:function(){this.$el.show(),this.__awake=!0,this.done&&(this.done=!1,this.switchToDone())},sleep:function(){this.$el.hide(),this.__awake=!1}}),i=function(r){function i(t){if(!t)throw this.remove(),new Error("Cannot find opsmodel while openning workspace.");if(t.testState(e.State.Saving)||t.testState(e.State.Terminating)){void 0,this.remove();return}return this.opsModel=t,n.apply(this,arguments)}return t(i,r),i.prototype.isWorkingOn=function(e){return this.opsModel===e},i.prototype.tabClass=function(){return"icon-app-pending"},i.prototype.title=function(){return this.opsModel.get("name")+" - app"},i.prototype.url=function(){return this.opsModel.url()},i.prototype.initialize=function(){var e;this.view=new s({model:this.opsModel}),this.view.workspace=this,this.listenTo(this.opsModel,"change:id",function(){this.updateUrl()}),e=this,this.view.on("close",function(){return e.remove()}),this.view.on("done",function(){var t,n;t=e.index(),e.remove(),n=App.openOps(e.opsModel),n.setIndex(t)})},i.prototype.awake=function(){return this.view.awake()},i.prototype.sleep=function(){return this.view.sleep()},i}(n),i})}.call(this),define("workspaces/editor/template/TplCanvas",["handlebars"],function(e){var t=function(e,t,n,r,i){function a(e,t){return'<aside class="OEPanelLeft"></aside>'}function f(e,t){return'<div class="OEPanelBottom"></div>'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this;s+='<div id="OpsEditor" class="pos-r">\r\n	',o=n.unless.call(t,t&&t.noLeftPane,{hash:{},inverse:u.noop,fn:u.program(1,a,i),data:i});if(o||o===0)s+=o;s+='\r\n	<aside class="OEPanelRight" id="OEPanelRight"></aside>\r\n\r\n<div class="OEMiddleWrap">\r\n	<nav class="OEPanelTop"></nav>\r\n	',o=n.unless.call(t,t&&t.noBottomPane,{hash:{},inverse:u.noop,fn:u.program(3,f,i),data:i});if(o||o===0)s+=o;s+='\r\n\r\n	<section class="OEPanelCenter scroll-wrap">\r\n		<div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\r\n		<div class="scrollbar-horizontal-wrap"><div class="scrollbar-horizontal-thumb"></div></div>\r\n\r\n		<div id="canvas_body" class="canvas-view-normal pos-r scroll-content">\r\n			<button class="svg_resizer icon-resize-down tooltip" data-tooltip=\'',o=n.i18n.call(t,"CVS_TIP_EXPAND_H",{hash:{},data:i});if(o||o===0)s+=o;s+="' onclick=\"MC.canvas.resize('height', 'expand')\"></button>\r\n			<button class=\"svg_resizer icon-resize-up tooltip\" data-tooltip='",o=n.i18n.call(t,"CVS_TIP_SHRINK_H",{hash:{},data:i});if(o||o===0)s+=o;s+="' onclick=\"MC.canvas.resize('height', 'shrink')\"></button>\r\n			<button class=\"svg_resizer icon-resize-right tooltip\" data-tooltip='",o=n.i18n.call(t,"CVS_TIP_EXPAND_W",{hash:{},data:i});if(o||o===0)s+=o;s+="' onclick=\"MC.canvas.resize('width', 'expand')\"></button>\r\n			<button class=\"svg_resizer icon-resize-left tooltip\" data-tooltip='",o=n.i18n.call(t,"CVS_TIP_SHRINK_W",{hash:{},data:i});if(o||o===0)s+=o;return s+='\' onclick="MC.canvas.resize(\'width\', \'shrink\')"></button>\r\n\r\n			<svg id="svg_canvas" xmlns="http://www.w3.org/2000/svg" version="1.2">\r\n				<g id="group_layer">\r\n					<g id="vpc_layer"></g>\r\n					<g id="az_layer"></g>\r\n					<g id="subnet_layer"></g>\r\n					<g id="asg_layer"></g>\r\n				</g>\r\n				<g id="line_layer"></g>\r\n				<g id="node_layer"></g>\r\n			</svg>\r\n		</div>\r\n	</section>\r\n</div>\r\n</div>',s};return e.template(t)}),define("workspaces/editor/template/TplOpsEditor",["handlebars"],function(e){var t,n={toolbar:{},confirm:{},"export":{},modal:{}};return t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="ops-process">\n  <header class="processing">Loading data...</header>\n  <section class="loading-spinner"></section>\n</div>'},n.loading=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o="function",u=this.escapeExpression;return s+='<div class="ops-process">\n  <header class="processing">'+u(typeof t===o?t.apply(t):t)+'<span class="process-info">0%</span></header>\n  <header class="processing rolling-back-content">Rolling back...</header>\n  <section class="loading-spinner"></section>\n  <section class="progress"> <div class="bar" style="width:0%;"></div> </section>\n</div>',s},n.appProcessing=e.template(t),t=function(e,t,n,r,i){function l(e,t){return'\n  <header class="processing">Reloading data...</header>\n  <section class="loading-spinner"></section>\n'}function c(e,t){var r="",i;r+='\n  <header class="processing">',i=n.unless.call(e,e&&e.error,{hash:{},inverse:f.program(6,p,t),fn:f.program(4,h,t),data:t});if(i||i===0)r+=i;r+="</header>\n  ",i=n["if"].call(e,e&&e.error,{hash:{},inverse:f.noop,fn:f.program(8,d,t),data:t});if(i||i===0)r+=i;return r+='\n  <button class="btn btn-silver" id="processDoneBtn">Done</button>\n',r}function h(e,t){return"App has updated successfully."}function p(e,t){return"The app failed to update."}function d(e,t){var r="",i;r+='\n  <div class="error-info-block">\n    <div class="result-sub-title">'+u(n.i18n.call(e,"PROC_RLT_FAILED_SUB_TITLE",{hash:{},data:t}))+'</div>\n    <div class="result-error-info">\n      <p class="title">'+u(n.i18n.call(e,"PROC_ERR_INFO",{hash:{},data:t}))+'</p>\n      <p class="detail">',i=(i=e&&e.error,typeof i===a?i.apply(e):i);if(i||i===0)r+=i;return r+='</p>\n    </div>\n    <div class="result-error-notice">The state of your app has been rolled back, except for the already deleted resources.</div>\n  </div>\n  ',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<div class="ops-process">\n',o=n["if"].call(t,t&&t.loading,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s},n.appUpdateStatus=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar tooltip icon-export-png toolbar-btn-primary" data-tooltip=\''+o(n.i18n.call(t,"TOOL_EXPORT_AS_PNG",{hash:{},data:i}))+'\' data-analytics-plus="export_vis_png">'+o(n.i18n.call(t,"TOOL_EXPORT_AS_PNG",{hash:{},data:i}))+"</button>",s},n.toolbar.BtnActionPng=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-zoom-in tooltip" data-tooltip=\''+o(n.i18n.call(t,"TOOL_TIP_ZOOM_IN",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-zoom-out seperator tooltip\" data-tooltip='"+o(n.i18n.call(t,"TOOL_TIP_ZOOM_OUT",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnZoom=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="selectbox btn-toolbar toolbar-line-style seperator">\n  <button class="selection tooltip" data-tooltip="'+o(n.i18n.call(t,"TOOL_TIP_LINESTYLE",{hash:{},data:i}))+'"></button>\n  <ul class="dropdown">\n    <li class=\'item\' data-id="0"><span class="icon-straight">'+o(n.i18n.call(t,"TOOL_LBL_LINESTYLE_STRAIGHT",{hash:{},data:i}))+'</span></li>\n    <li class=\'item\' data-id="1"><span class="icon-elbow">'+o(n.i18n.call(t,"TOOL_LBL_LINESTYLE_ELBOW",{hash:{},data:i}))+'</span></li>\n    <li class=\'item\' data-id="2"><span class="icon-bezier-q">'+o(n.i18n.call(t,"TOOL_LBL_LINESTYLE_QUADRATIC_BELZIER",{hash:{},data:i}))+'</span></li>\n    <li class=\'item\' data-id="3"><span class="icon-bezier-qt">'+o(n.i18n.call(t,"TOOL_LBL_LINESTYLE_SMOOTH_QUADRATIC_BELZIER",{hash:{},data:i}))+'</span></li>\n    <li class=\'item\' data-id="4"><span class="icon-hide-sg">'+o(n.i18n.call(t,"TOOL_LBL_LINESTYLE_HIDE_SG",{hash:{},data:i}))+"</span></li>\n  </ul>\n</div>",s},n.toolbar.BtnLinestyle=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-play tooltip toolbar-btn-primary runApp" data-tooltip=\''+o(n.i18n.call(t,"TOOL_TIP_BTN_RUN_STACK",{hash:{},data:i}))+"'>"+o(n.i18n.call(t,"TOOL_BTN_RUN_STACK",{hash:{},data:i}))+"</button>",s},n.toolbar.BtnRunStack=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar tooltip icon-save" data-tooltip=\''+o(n.i18n.call(t,"TOOL_TIP_SAVE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-delete tooltip seperator\" data-tooltip='"+o(n.i18n.call(t,"TOOL_TIP_DELETE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar tooltip icon-duplicate\" data-tooltip='"+o(n.i18n.call(t,"TOOL_TIP_DUPLICATE_STACK",{hash:{},data:i}))+"'></button>\n<button class=\"btn-toolbar icon-new-stack tooltip seperator\" data-tooltip='"+o(n.i18n.call(t,"TOOL_TIP_CREATE_STACK",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnStackOps=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="selectbox btn-toolbar seperator">\n  <button class="selection tooltip icon-send" data-tooltip=\''+o(n.i18n.call(t,"TOOL_EXPORT",{hash:{},data:i}))+'\'></button>\n  <ul class="dropdown">\n    <li data-analytics-plus="export_png" class="icon-export-png">'+o(n.i18n.call(t,"TOOL_EXPORT_AS_PNG",{hash:{},data:i}))+'</li>\n    <li data-analytics-plus="export_json" class="icon-export-json">'+o(n.i18n.call(t,"TOOL_EXPORT_AS_JSON",{hash:{},data:i}))+'</li>\n    <li data-analytics-plus="cloudformation" class="icon-toolbar-cloudformation">'+o(n.i18n.call(t,"TOOL_EXPORT_AS_CF",{hash:{},data:i}))+"</li>\n  </ul>\n</div>",s},n.toolbar.BtnExport=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="tooltip btn-toolbar icon-update-app toolbar-btn-primary" data-tooltip="'+o(n.i18n.call(t,"TOOL_TIP_UPDATE_APP",{hash:{},data:i}))+'">'+o(n.i18n.call(t,"TOOL_EDIT_APP",{hash:{},data:i}))+'</button>\n<button class="tooltip btn-toolbar icon-apply-app toolbar-btn-primary" data-tooltip="'+o(n.i18n.call(t,"TOOL_TIP_SAVE_UPDATE_APP",{hash:{},data:i}))+'">'+o(n.i18n.call(t,"TOOL_APPLY_EDIT",{hash:{},data:i}))+'</button>\n<button class="tooltip btn-toolbar icon-cancel-update-app seperator" data-tooltip="'+o(n.i18n.call(t,"TOOL_TIP_CANCEL_UPDATE_APP",{hash:{},data:i}))+'"></button>',s},n.toolbar.BtnEditApp=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression;s+='<button class="tooltip btn-toolbar icon-stop" data-tooltip="'+u(n.i18n.call(t,"TOOL_TIP_STOP_APP",{hash:{},data:i}))+'"></button>\n<button class="tooltip btn-toolbar icon-play startApp" data-tooltip="'+u(n.i18n.call(t,"TOOL_TIP_START_APP",{hash:{},data:i}))+'"></button>\n<button class="btn-toolbar tooltip icon-terminate seperator" data-tooltip="',o=n.i18n.call(t,"TOOL_TIP_TERMINATE_APP",{hash:{},data:i});if(o||o===0)s+=o;return s+='"></button>\n<button class="btn-toolbar tooltip icon-save-app seperator" data-tooltip=\''+u(n.i18n.call(t,"TOOL_TIP_SAVE_APP_TO_STACK",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnAppOps=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar icon-export-png tooltip seperator" data-analytics-plus="export_png" data-tooltip=\''+o(n.i18n.call(t,"TOOL_EXPORT_AS_PNG",{hash:{},data:i}))+"'></button>",s},n.toolbar.BtnPng=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="btn-toolbar tooltip icon-refresh seperator" data-tooltip="'+o(n.i18n.call(t,"TOOL_TIP_REFRESH_REOURCES",{hash:{},data:i}))+'"></button>',s},n.toolbar.BtnReloadRes=e.template(t),t=function(e,t,n,r,i){function f(e,t){return" on"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a=this.escapeExpression;s+='<label class="switch toolbar-visual-ops-switch tooltip',o=n["if"].call(t,t&&t.stateOn,{hash:{},inverse:u.noop,fn:u.program(1,f,i),data:i});if(o||o===0)s+=o;return s+='" data-tooltip="'+a(n.i18n.call(t,"TOOL_TIP_CUSTOM_USER_DATA",{hash:{},data:i}))+'">\n    <span class="switch-label" data-on="'+a(n.i18n.call(t,"TOOL_TOGGLE_VISUALOPS_ON",{hash:{},data:i}))+'" data-off="'+a(n.i18n.call(t,"TOOL_TOGGLE_VISUALOPS_OFF",{hash:{},data:i}))+'"></span>\n    <span class="switch-handle"></span>\n</label>',s},n.toolbar.BtnSwitchStates=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<button class="icon-reload tooltip btn btn-blue reload-states" data-original="Reload States" data-disabled="Initiatingâ€¦"  data-tooltip="Instantly rerun all states in this app.">Reload States</button>'},n.toolbar.BtnReloadStates=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="modal-text-wraper">\n    <div class="modal-center-align-helper">\n        <div class="modal-text-major">Enable VisualOps will override your custom User Data. Are you sure to continue?</div>\n    </div>\n</div>'},n.confirm.enableState=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="modal-text-wraper"> <div class="modal-center-align-helper">\n  <div class="modal-text-major"></div>\n  <div class="modal-text-minor">'+o(n.i18n.call(t,"TOOL_POP_EXPORT_CF_INFO",{hash:{},data:i}))+'</div>\n</div> </div>\n<div style="padding-top:20px;text-align:right;">\n  <a class="btn btn-blue disabled">'+o(n.i18n.call(t,"HEAD_INFO_LOADING",{hash:{},data:i}))+'</a>\n  <button class="btn modal-close btn-silver">'+o(n.i18n.call(t,"TOOL_POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.export.CF=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<div class="modal-text-wraper"> <div class="modal-center-align-helper" style="padding:40px 20px;">\n  <div class="modal-text-major"></div>\n  <div class="modal-text-minor">'+u(n.i18n.call(t,"TOOL_POP_BODY_EXPORT_AS_JSON",{hash:{},data:i}))+'</div>\n</div> </div>\n<div class="modal-footer">\n  <a class="btn btn-blue modal-close" href="'+u((o=t&&t.data,typeof o===a?o.apply(t):o))+'" target="_blank" download="'+u((o=t&&t.name,typeof o===a?o.apply(t):o))+'">'+u(n.i18n.call(t,"TOOL_POP_BTN_DOWNLOAD",{hash:{},data:i}))+'</a>\n  <button id="tpl-cancel" class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOL_POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.export.JSON=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="loading-spinner"></div>\n<section style="margin:10px 10px 0;max-height:420px;overflow:hidden;text-align:center;display:none;"></section>\n<div class="modal-footer">\n  <a class="btn btn-blue" style="display: inline-block;">Download</a>\n  <button class="btn modal-close btn-silver">Cancel</button>\n</div>'},n.export.PNG=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o="function",u=this.escapeExpression;return s+='<div class="modal-text-wraper"> <div class="modal-center-align-helper">\n  <div class="modal-text-major">'+u(typeof t===o?t.apply(t):t)+' has unsaved changes.</div>\n  <div class="modal-text-major">Do you confirm to close it?</div>\n</div> </div>',s},n.modal.onClose=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="modal-text-wraper"> <div class="modal-center-align-helper">\n  <div class="modal-text-major">This app has been changed.</div>\n  <div class="modal-text-major">Do you confirm to discard the changes?</div>\n</div> </div>'},n.modal.cancelUpdate=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<p class="modal-text-major">Well done! Your VPC '+a((o=t&&t.name,typeof o===u?o.apply(t):o))+' has been successfully imported as VisualOps app.</p>\n<p class="modal-text-major">Give this app an appropriate name.</p>\n<div class="modal-control-group">\n<label for="ImportSaveAppName">App Name</label> <input id="ImportSaveAppName" class="input" value="'+a((o=t&&t.name,typeof o===u?o.apply(t):o))+'" type="string" autofocus> </div>\n<div class="modal-control-group app-usage-group clearfix">\n  <label for="">App Usage</label>\n  <div id="app-usage-selectbox" class="selectbox">\n    <div class="selection"><i class="icon-app-type-testing"></i>Testing</div>\n    <ul class="dropdown" tabindex="-1">\n      <li class="selected item" data-value="testing"><i class="icon-app-type-testing"></i>Testing</li>\n      <li class="item" data-value="development"><i class="icon-app-type-development"></i>Development</li>\n      <li class="item" data-value="production"><i class="icon-app-type-production"></i>Production</li>\n      <li class="item" data-value="others"><i class="icon-app-type-others" data-value="testing"></i>Others</li>\n    </ul>\n  </div>\n</div>\n<p>Now you can easily manage the resources and lifecycle of the app within VisualOps.</p>',s},n.modal.confirmImport=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<p class="modal-text-major">VPC of this app has been deleted outside VisualOps.</p>\n<p class="modal-text-major">Do you want to remove the app?</p>'},n.modal.confirmRemoveApp=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n        <div id="replace_stack" style="padding: 10px 0">\n            <div class="radio">\n                <input id="radio-replace-stack" type="radio" name="save-stack-type" value="replace" checked>\n                <label for="radio-replace-stack"></label>\n            </div>\n            <label class="modal-text-minor" for="radio-replace-stack">'+u(n.i18n.call(e,"TOOL_POP_REPLACE_STACK",{hash:{},data:t}))+'</label>\n            <div style="padding: 10px 22px" class="radio-instruction">\n                '+u(n.i18n.call(e,"TOOL_POP_REPLACE_STACK_INTRO",{hash:{},data:t}))+' "'+u((i=e&&e.input,typeof i===a?i.apply(e):i))+'" '+u(n.i18n.call(e,"TOOL_POP_REPLACE_STACK_INTRO_END",{hash:{},data:t}))+'\n            </div>\n        </div>\n        <div id="save_new_stack">\n            <div class="radio">\n                <input id="radio-new-stack" type="radio" name="save-stack-type">\n                <label for="radio-new-stack"></label>\n            </div>\n            <label class="modal-text-minor" for="radio-new-stack">'+u(n.i18n.call(e,"TOOL_POP_SAVE_NEW_STACK",{hash:{},data:t}))+'</label>\n            <div style="padding: 10px 22px" class="radio-instruction hide">\n                <p>'+u(n.i18n.call(e,"TOOL_POP_SAVE_STACK_INSTRUCTION",{hash:{},data:t}))+'</p>\n                <input class="input" id="modal-input-value" value="'+u((i=e&&e.stackName,typeof i===a?i.apply(e):i))+'" type="text" style="width: 400px"/>\n                <div id="stack-name-exist" class="hide" style="color: #ec3c38">'+u(n.i18n.call(e,"TOOL_POP_STACK_NAME_ERROR",{hash:{},data:t}))+"</div>\n            </div>\n        </div>\n        ",r}function c(e,t){var r="",i;return r+='\n        <div id="name_new_stack">\n            <input id="radio-new-stack" type="hidden" name="save-stack-type" checked>\n            <div style="padding: 10px 22px" class="radio-instruction">\n                <p>'+u(n.i18n.call(e,"TOOL_POP_SAVE_STACK_INSTRUCTION",{hash:{},data:t}))+'</p>\n                <input class="input" id="modal-input-value" value="'+u((i=e&&e.stackName,typeof i===a?i.apply(e):i))+'" type="text" style="width: 400px"/>\n                <div id="stack-name-exist" class="hide" style="color: #ec3c38">'+u(n.i18n.call(e,"TOOL_POP_STACK_NAME_ERROR",{hash:{},data:t}))+"</div>\n            </div>\n        </div>\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<p class="modal-text-minor">'+u(n.i18n.call(t,"TOOL_POP_INTRO_1",{hash:{},data:i}))+'</p>\n<p class="modal-text-minor">'+u(n.i18n.call(t,"TOOL_POP_INTRO_2",{hash:{},data:i}))+'</p>\n<div class="modal-center-align-helper">\n    <div class="modal-control-group">\n        ',o=n["if"].call(t,t&&t.originStackExist,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n    </div>\n</div>",s},n.saveAppToStack=e.template(t),n}),function(){define("workspaces/editor/subviews/Toolbar",["OpsModel","../template/TplOpsEditor","ThumbnailUtil","JsonExporter","ApiRequest","i18n!/nls/lang.js","UI.modalplus","kp_dropdown","ResDiff","constant","event","component/trustedadvisor/main","UI.notification","backbone"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h,p;return h="api.visualops.io",p="https://"+h+"/v1/apps/",Backbone.View.extend({events:{"click .icon-save":"saveStack","click .icon-delete":"deleteStack","click .icon-duplicate":"duplicateStack","click .icon-new-stack":"createStack","click .icon-zoom-in":"zoomIn","click .icon-zoom-out":"zoomOut","click .icon-export-png":"exportPNG","click .icon-export-json":"exportJson","click .icon-toolbar-cloudformation":"exportCF","click .runApp":"runStack","OPTION_CHANGE .toolbar-line-style":"setTbLineStyle","click .icon-stop":"stopApp","click .startApp":"startApp","click .icon-terminate":"terminateApp","click .icon-refresh":"refreshResource","click .icon-update-app":"switchToAppEdit","click .icon-apply-app":"applyAppEdit","click .icon-cancel-update-app":"cancelAppEdit","click .toolbar-visual-ops-switch":"opsOptionChanged","click .reload-states":"reloadState","click .icon-save-app":"appToStack"},render:function(){var e,n,r,i,s,o,u,a;s=this.workspace.opsModel,s.isStack()?i=["BtnRunStack","BtnStackOps","BtnZoom","BtnExport","BtnLinestyle","BtnSwitchStates"]:i=["BtnEditApp","BtnAppOps","BtnZoom","BtnPng","BtnLinestyle"],o="";for(u=0,a=i.length;u<a;u++)r=i[u],n={stateOn:this.workspace.design.get("agent").enabled},o+=t.toolbar[r](n);this.workspace.opsModel.isApp()&&(e=[].concat(this.workspace.design.componentsOfType(f.RESTYPE.INSTANCE),this.workspace.design.componentsOfType(f.RESTYPE.LC)),_.find(e,function(e){var t;return e&&((t=e.attributes.state)!=null?t.length:void 0)>0})&&(o+=t.toolbar.BtnReloadStates())),this.setElement(this.workspace.view.$el.find(".OEPanelTop").html(o)),this.updateTbBtns(),this.updateZoomButtons()},updateTbBtns:function(){var t,n;n=this.workspace.opsModel,this.$el.children(".toolbar-line-style").children(".dropdown").children().eq(parseInt(localStorage.getItem("canvas/lineStyle"),10)||2).click(),n.isApp()&&(t=this.workspace.isAppEditMode&&this.workspace.isAppEditMode(),this.$el.children(".icon-update-app").toggle(!t),this.$el.children(".icon-apply-app, .icon-cancel-update-app").toggle(t),t?this.$el.children(".icon-terminate, .icon-stop, .icon-play, .icon-refresh, .icon-save-app, .icon-reload").hide():(this.$el.children(".icon-terminate, .icon-refresh, .icon-save-app, .icon-reload").show(),this.$el.children(".icon-stop").toggle(n.get("stoppable")&&n.testState(e.State.Running)),this.$el.children(".icon-play").toggle(n.testState(e.State.Stopped)))),this.__saving?this.$el.children(".icon-save").attr("disabled","disabled"):this.$el.children(".icon-save").removeAttr("disabled"),this.updateZoomButtons()},setTbLineStyle:function(e,t){return $canvas.setLineStyle(t[0])},saveStack:function(e){var t,r;return $(e.currentTarget).attr("disabled","disabled"),r=this,this.__saving=!0,t=this.workspace.design.serialize(),n.generate($("#svg_canvas"))["catch"](function(){return null}).then(function(n){r.workspace.opsModel.save(t,n).then(function(){return r.__saving=!1,$(e.currentTarget).removeAttr("disabled"),notification("info",sprintf(s.ide.TOOL_MSG_ERR_SAVE_SUCCESS,t.name))},function(){return r.__saving=!1,$(e.currentTarget).removeAttr("disabled"),notification("error",sprintf(s.ide.TOOL_MSG_ERR_SAVE_FAILED,t.name))})})},deleteStack:function(){return App.deleteStack(this.workspace.opsModel.cid,this.workspace.design.get("name"))},createStack:function(){return App.createOps(this.workspace.opsModel.get("region"))},duplicateStack:function(){var e;e=App.model.createStackByJson(this.workspace.design.serialize()),App.openOps(e)},zoomIn:function(){return MC.canvas.zoomIn(),this.updateZoomButtons()},zoomOut:function(){return MC.canvas.zoomOut(),this.updateZoomButtons()},updateZoomButtons:function(){var e;e=$canvas.scale(),e<=1?this.$el.find(".icon-zoom-in").attr("disabled","disabled"):this.$el.find(".icon-zoom-in").removeAttr("disabled"),e>=1.6?this.$el.find(".icon-zoom-out").attr("disabled","disabled"):this.$el.find(".icon-zoom-out").removeAttr("disabled")},exportPNG:function(){var e,i,s;i=new o({title:"Export PNG",template:t["export"].PNG(),width:"470",disableFooter:!0,compact:!0,onClose:function(){i=null}}),e=this.workspace.design,s=e.get("name"),n.exportPNG($("#svg_canvas"),{isExport:!0,createBlob:!0,name:s,id:e.get("id"),onFinish:function(e){var t;if(!i)return;i.tpl.find(".loading-spinner").remove(),i.tpl.find("section").show().prepend("<img style='max-height:100%;display:inline-block;' src='"+e.image+"' />"),t=i.tpl.find("a.btn-blue"),e.blob?t.click(function(){return r.download(e.blob,""+s+".png"),!1}):t.attr({href:e.image,download:""+s+".png"}),i.resize()}})},exportJson:function(){var e,n,i,u,a;i=this.workspace.design,a=App.user.get("username"),n=MC.dateFormat(new Date,"yyyy-MM-dd"),u=[i.get("name"),a,n].join("-"),e=r.exportJson(i.serialize(),""+u+".json");if(e)return new o({title:s.ide.TOOL_EXPORT_AS_JSON,template:t["export"].JSON(e),width:"470",disableFooter:!0,compact:!0})},exportCF:function(){var e,n,u;return n=new o({title:s.ide.TOOL_POP_EXPORT_CF,template:t["export"].CF(),width:"470",disableFooter:!0}),e=this.workspace.design,u=e.get("name"),i("stack_export_cloudformation",{region:e.get("region"),stack:e.serialize()}).then(function(e){var t;t=n.tpl.find("a.btn-blue").text(s.ide.TOOL_POP_BTN_EXPORT_CF).removeClass("disabled"),r.genericExport(t,e,""+u+".json"),t.click(function(){return n.close()})},function(e){n.tpl.find("a.btn-blue").text("Fail to export..."),notification("error","Fail to export to AWS CloudFormation Template, Error code:"+e.error)})},reloadState:function(e){var t,n,r;return t=$(e.currentTarget),t.hasClass("disabled")?!1:(t.toggleClass("disabled").html(t.attr("data-disabled")),n=Design.instance().get("id"),r={encoded_user:App.user.get("usercode"),token:App.user.get("defaultToken")},$.ajax({url:p+n,method:"POST",data:JSON.stringify(r),dataType:"json",statusCode:{200:function(){return notification("info",s.ide.RELOAD_STATE_SUCCESS),l.trigger(l.REFRESH_PROPERTY)},401:function(){return notification("error",s.ide.RELOAD_STATE_INVALID_REQUEST)},404:function(){return notification("error",s.ide.RELOAD_STATE_NETWORKERROR)},429:function(){return notification("error",s.ide.RELOAD_STATE_NOT_READY)},500:function(){return notification("error",s.ide.RELOAD_STATE_INTERNAL_SERVER_ERROR)}},error:function(){return void 0},success:function(){return void 0}}).always(function(){return window.setTimeout(function(){return t.removeClass("disabled").html(t.attr("data-original"))})}))},runStack:function(e){var t,n,r,i;return $(e.currentTarget).attr("disabled")?!1:(this.modal=new o({title:s.ide.RUN_STACK_MODAL_TITLE,template:MC.template.modalRunStack,disableClose:!0,width:"450px",height:"620px",confirm:{text:App.user.hasCredential()?s.ide.RUN_STACK_MODAL_CONFIRM_BTN:s.ide.RUN_STACK_MODAL_NEED_CREDENTIAL,disabled:!0}}),this.renderKpDropdown(this.modal),r=Design.instance().getCost(),this.modal.tpl.find(".modal-input-value").val(this.workspace.opsModel.get("name")),this.modal.tpl.find("#label-total-fee").find("b").text("$"+r.totalFee),c.loadModule("stack").then(function(e){return function(){var t;return e.modal.resize(),(t=e.modal)!=null?t.toggleConfirm(!1):void 0}}(this)),t=this.modal.tpl.find("#app-name"),n=this.checkAppNameRepeat.bind(this),t.keyup(function(){return n(t.val())}),i=this,this.modal.on("confirm",function(e){return function(){var n;return e.hideError(),App.user.hasCredential()?(n=e.checkAppNameRepeat(t.val()),!e.defaultKpIsSet()||n?!1:(e.modal.tpl.find(".btn.modal-confirm").attr("disabled","disabled"),e.json=e.workspace.design.serialize(),e.json.usage=$("#app-usage-selectbox").find(".dropdown .item.selected").data("value"),e.json.name=t.val(),e.workspace.opsModel.run(e.json,t.val()).then(function(e){return i.modal.close(),App.openOps(e)},function(e){var t;return i.modal.close(),t=e.awsError?e.error+"."+e.awsError:" "+e.error+" : "+(e.result||e.msg),notification("error",sprintf(s.ide.PROP_MSG_WARN_FAILA_TO_RUN_BECAUSE,i.workspace.opsModel.get("name"),t))}))):(App.showSettings(App.showSettings.TAB.Credential),!1)}}(this)))},appToStack:function(){var e,n,r,i,u,a;return n=this.workspace.design.attributes.name,r=this.getStackNameFromApp(n),a=App.model.stackList().get(this.workspace.design.attributes.stack_id),i=function(t){return function(){var n,r,i;MC.Analytics.increase("app_to_stack"),n=e.tpl.find("input[name='save-stack-type']:checked").val()!=="replace";if(!n)return r=Design.instance().serializeAsStack(),r.id=t.workspace.design.attributes.stack_id,e.close(),r.name=a.get("name"),a.save(r).then(function(){return notification("info",sprintf(s.ide.TOOL_MSG_INFO_HDL_SUCCESS,s.ide.TOOLBAR_HANDLE_SAVE_STACK,r.name)),App.openOps(a,!0)},function(){return notification("error",sprintf(s.ide.TOOL_MSG_ERR_SAVE_FAILED,r.name))});i=App.model.createStackByJson(t.workspace.design.serializeAsStack(e.tpl.find("#modal-input-value").val())),e.close(),App.openOps(i)}}(this),u=!!a,e=new o({title:s.ide.TOOL_POP_TIT_APP_TO_STACK,template:t.saveAppToStack({input:n,stackName:r,originStackExist:u}),confirm:{text:s.ide.TOOL_POP_BTN_SAVE_TO_STACK},onConfirm:i}),e.tpl.find("input[name='save-stack-type']").change(function(){return e.tpl.find(".radio-instruction").toggleClass("hide")})},getStackNameFromApp:function(e){var t,n,r,i,s,o;e||(e="untitled"),n=0,s=/.*-\d+$/,s.test(e)?(i=e.substr(0,e.lastIndexOf("-")),n=Number(e.substr(e.lastIndexOf("-")+1)),t=i):e.charAt(e.length-1)==="-"?t=e.substr(0,e.length-1):t=e,o=/.-stack+$/,o.test(t)?t=t:t+="-stack",r=App.model.stackList().pluck("name")||[],n++;while(n<=r.length){if($.inArray(t+"-"+n,r)===-1)break;n++}return t+"-"+n},checkAppNameRepeat:function(e){return App.model.appList().findWhere({name:e})?(this.showError("appname",s.ide.PROP_MSG_WARN_REPEATED_APP_NAME),!0):e?(this.hideError("appname"),!1):(this.showError("appname",s.ide.PROP_MSG_WARN_NO_APP_NAME),!0)},renderKpDropdown:function(e){var t,n;if(u.hasResourceWithDefaultKp()){n=new u;if(!e)return!1;e.tpl.find("#kp-runtime-placeholder").html(n.render().el),t=this.hideError.bind(this),n.dropdown.on("change",function(){return t("kp")}),e.tpl.find(".default-kp-group").show(),this.modal&&this.modal.on("close",function(){return n.remove()}),this.updateModal&&this.updateModal.on("close",function(){return n.remove()})}return null},hideDefaultKpError:function(e){return e.hideError("kp")},hideError:function(e){var t;return t=e?$("#runtime-error-"+e):$(".runtime-error"),t.hide()},showError:function(e,t){return $("#runtime-error-"+e).text(t).show()},defaultKpIsSet:function(){var e,t;return u.hasResourceWithDefaultKp()?(t=Design.modelClassForType(f.RESTYPE.KP),e=t.getDefaultKP(),!e.get("isSet")||!this.modal&&!this.updateModal||!(this.modal||this.updateModal).tpl.find("#kp-runtime-placeholder .item.selected").size()?(this.showError("kp",s.ide.RUN_STACK_MODAL_KP_WARNNING),!1):!0):!0},startApp:function(){return App.startApp(this.workspace.opsModel.id),!1},stopApp:function(){return App.stopApp(this.workspace.opsModel.id),!1},terminateApp:function(){return App.terminateApp(this.workspace.opsModel.id),!1},refreshResource:function(){return this.workspace.refreshResource(),!1},switchToAppEdit:function(){return this.workspace.switchToEditMode(),!1},applyAppEdit:function(){var t,n,r,i,u;i=this.workspace.opsModel.getJsonData(),r=this.workspace.design.serialize(),n=new a({old:i,"new":r}),u=n.getDiffInfo();if(!u.compChange&&!u.layoutChange&&!u.stateChange)return this.workspace.applyAppEdit();this.updateModal=new o({title:s.ide.UPDATE_APP_MODAL_TITLE,template:MC.template.updateApp({isRunning:this.workspace.opsModel.testState(e.State.Running)}),disableClose:!0,width:"450px",height:"515px",confirm:{disabled:!0,text:App.user.hasCredential()?s.ide.UPDATE_APP_CONFIRM_BTN:s.ide.UPDATE_APP_MODAL_NEED_CREDENTIAL}}),this.updateModal.on("confirm",function(e){return function(){var t;return App.user.hasCredential()?e.defaultKpIsSet()?(e.workspace.applyAppEdit(r,!u.compChange),(t=e.updateModal)!=null?t.close():void 0):!1:(App.showSettings(App.showSettings.TAB.Credential),!1)}}(this)),u.compChange&&(t=n.renderAppUpdateView(),$("#app-update-summary-table").html(t)),this.renderKpDropdown(this.updateModal),c.loadModule("stack").then(function(e){return function(){return e.updateModal&&e.updateModal.toggleConfirm(!1)}}(this))},opsOptionChanged:function(){var e,n,r,i,s,u;return e=$(".toolbar-visual-ops-switch").toggleClass("on"),s=e.hasClass("on"),n=this.workspace.design.get("agent"),s?(i=this.workspace.design.instancesNoUserData(),u=this.workspace,i?(n.enabled=!0,this.workspace.design.set("agent",n),l.trigger(l.REFRESH_PROPERTY)):(e.removeClass("on"),r=new o({title:"Confirm to Enable VisualOps",width:"420px",template:t.confirm.enableState(),confirm:{text:"Enable VisualOps"},onConfirm:function(){return n.enabled=!0,r.close(),e.addClass("on"),u.design.set("agent",n),l.trigger(l.FORCE_OPEN_PROPERTY)}}),null)):(n.enabled=!1,this.workspace.design.set("agent",n),l.trigger(l.FORCE_OPEN_PROPERTY))},cancelAppEdit:function(){var e,n;return this.workspace.cancelEditMode()||(n=this,e=new o({title:"Changes not applied",template:t.modal.cancelUpdate(),width:"400",confirm:{text:"Discard",color:"red"},onConfirm:function(){e.close(),n.workspace.cancelEditMode(!0)}})),!1}})})}.call(this),function(){define("workspaces/editor/OpsViewBase",["./template/TplCanvas","./template/TplOpsEditor","./subviews/PropertyPanel","./subviews/Toolbar","UI.modalplus","backbone","UI.selectbox","MC.canvas"],function(e,t,n,r,i){return $(document).on("keydown",MC.canvas.event.keyEvent),$("#header, #navigation, #tab-bar").on("click",MC.canvas.volume.close),$(document.body).on("mousedown","#instance_volume_list a",MC.canvas.volume.mousedown),Backbone.View.extend({constructor:function(e){_.extend(this,e),this.propertyPanel=new n,this.propertyPanel.workspace=this.workspace,this.toolbar=new r,this.toolbar.workspace=this.workspace,this.initialize()},render:function(){void 0,this.setElement($(this.createTpl()).appendTo("#main").show()[0]),this.$el.attr("data-workspace",this.workspace.id),this.bindUserEvent(),this.toolbar.render(),this.propertyPanel.render(),this.renderSubviews(),this.workspace.design.canvas.init()},backup:function(){var e;e=this.$el.find(".OEPanelCenter"),this.__backupSvg=e.html(),e.empty(),this.propertyPanel.backup(),this.backupSubviews(),this.$el.attr("id","")},recover:function(){this.$el.find(".OEPanelCenter").html(this.__backupSvg),this.__backupSvg=null,this.recoverSubviews(),this.$el.attr("id","OpsEditor"),this.propertyPanel.recover()},remove:function(){this.toolbar.remove(),this.propertyPanel.remove(),Backbone.View.prototype.remove.call(this)},showCloseConfirm:function(){var e,n,r;n=this.workspace.design.get("name"),r=this,e=new i({title:"Confirm to close "+n,width:"420",template:t.modal.onClose(n),confirm:{text:"Close Tab",color:"red"},onConfirm:function(){e.close(),r.workspace.remove()}})},saveOps:function(){return App.saveOps(this.workspace.opsModel)},createTpl:function(){return e({})},bindUserEvent:function(){},renderSubviews:function(){},recoverSubviews:function(){},backupSubviews:function(){}})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/editor/OpsEditorBase",["Workspace","./OpsViewBase","./template/TplOpsEditor","ThumbnailUtil","OpsModel","Design","ApiRequest","UI.modalplus"],function(e,n,r,i,s,o,u,a){var f,l;return f=Backbone.View.extend({isLoadingView:!0,initialize:function(e){return this.setElement($(r.loading()).appendTo("#main").show()[0])},setText:function(e){return this.$el.find(".processing").text(e)},showVpcNotExist:function(e,t){var n,i;i=this,n=new a({title:"Confirm to remove the app "+e+"?",template:r.modal.confirmRemoveApp(),confirm:{text:"Confirm to Remove",color:"red"},disableClose:!0,onConfirm:function(){return t(),n.close()}})}}),l=function(r){function a(t){var n;if(!t)throw this.remove(),new Error("Cannot find opsmodel while openning workspace.");return this.opsModel=t,this.listenTo(this.opsModel,"destroy",this.onOpsModelStateChanged),this.listenTo(this.opsModel,"change:state",this.onOpsModelStateChanged),this.listenTo(this.opsModel,"change:name",this.updateTab),this.listenTo(this.opsModel,"change:id",function(){this.updateUrl(),this.design&&this.design.set("id",this.opsModel.get("id"))}),n=this,this.opsModel.fetchJsonData().then(function(){return n.jsonLoaded()},function(e){if(e.error===u.Errors.MissingDataInServer)return;return notification("error","Failed to load data, please retry."),n.remove()}),e.apply(this,arguments)}return t(a,r),a.prototype.title=function(){return this.opsModel.get("name")},a.prototype.tabClass=function(){return"icon-stack-tabbar"},a.prototype.url=function(){return this.opsModel.url()},a.prototype.fetchAdditionalData=function(){var e;return e=Q.defer(),e.resolve(),e.promise},a.prototype.createView=function(){return new n({workspace:this})},a.prototype.initDesign=function(){return this.design.finishDeserialization()},a.prototype.isReady=function(){return!!this.__hasAdditionalData},a.prototype.onOpsModelStateChanged=function(){switch(this.opsModel.get("state")){case s.State.Destroyed:this.remove()}},a.prototype.isWorkingOn=function(e){return this.opsModel===e},a.prototype.jsonLoaded=function(){var e;if(this.isRemoved())return;e=this,this.fetchAdditionalData().then(function(){if(e.isRemoved())return;return e.__hasAdditionalData=!0,e.switchToReady()},function(){return notification("error","Failed to load aws data, please retry."),e.remove()})},a.prototype.switchToReady=function(){this.view&&this.view.isLoadingView&&(this.view.remove(),this.view=null),this.isAwake()&&!this.__inited&&this.__initEditor()},a.prototype.awake=function(){if(!this.isReady()){this.view?this.view.$el.show():this.view=new f;return}this.__inited?(this.design.use(),this.showEditor()):this.__initEditor()},a.prototype.sleep=function(){return MC.canvas.volume.close(),e.prototype.sleep.call(this)},a.prototype.cleanup=function(){MC.canvas.volume.close(),this.stopListening(),this.view&&this.view.remove(),this.design&&(this.design.unuse(),this.design=null)},a.prototype.isInited=function(){return!!this.__inited},a.prototype.__initEditor=function(){this.__inited=!0,this.design=new o(this.opsModel),this.listenTo(this.design,"change:name",this.updateTab),this.view=this.createView(),this.view.opsModel=this.opsModel,this.view.workspace=this,this.hideOtherEditor(),this.view.render(),this.initDesign(),this.initEditor(),this.opsModel.getThumbnail()||this.saveThumbnail(),this.opsModel.__setJsonData(this.design.serialize())},a.prototype.initEditor=function(){},a.prototype.saveThumbnail=function(){if(this.opsModel.isPersisted())return i.generate($("#svg_canvas")).then(function(e){return function(t){return e.opsModel.saveThumbnail(t)}}(this))},a.prototype.showEditor=function(){this.hideOtherEditor()?(this.view.$el.show(),this.view.recover()):(void 0,this.view.$el.show())},a.prototype.hideOtherEditor=function(){var e,t;return e=$("#OpsEditor"),t=e.attr("data-workspace"),void 0,t&&t!==this.id?(App.workspaces.get(t).view.backup(),!0):t!==this.id},a.prototype.isRemovable=function(){return!this.__inited||!this.isModified()?!0:(this.view.showCloseConfirm(),!1)},a}(e),l})}.call(this),define("workspaces/editor/template/TplLeftPanel",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<button class="tooltip sidebar-hider icon-caret-left HideOEPanelLeft" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_TOGGLE_RESOURCE_PANEL",{hash:{},data:i}))+'\'></button>\n\n<header class="sidebar-title"> '+o(n.i18n.call(t,"RES_TIT_RESOURCES",{hash:{},data:i}))+'\n  <i class="icon-resources js-toggle-dropdown menu-manage-shard-res"></i>\n  <ul class="dropdown-menu resources-dropdown-wrapper">\n    <li data-action="keypair">Manage Key Pairs...</li>\n    <li data-action="snapshot">Manage EBS Snapshots...</li>\n    <li data-action="sns">Manage SNS Topic & Subscriptions...</li>\n    <li data-action="sslcert">Manage Server Certificates...</li>\n    <li data-action="dhcp">Manage DHCP Option Sets...</li>\n  </ul>\n  <i class="refresh-resource-panel icon-refresh tooltip" data-tooltip="Refresh resource list"></i>\n</header>\n\n<div class="fixedaccordion accordion-default">\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+o(n.i18n.call(t,"RES_TIT_AZ",{hash:{},data:i}))+'</header>\n    <ul class="resource-list-az clearfix accordion-body"></ul>\n  </section>\n\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+o(n.i18n.call(t,"RES_TIT_AMI",{hash:{},data:i}))+'\n      <nav class="selectbox resource-select AmiTypeSelect js-toggle-dropdown">\n        <div class="selection">'+o(n.i18n.call(t,"RES_LBL_QUICK_START_AMI",{hash:{},data:i}))+'</div>\n        <ul class="dropdown">\n          <li class="item selected" data-id="QuickStartAmi">'+o(n.i18n.call(t,"RES_LBL_QUICK_START_AMI",{hash:{},data:i}))+'</li>\n          <li class="item" data-id="MyAmi">'+o(n.i18n.call(t,"RES_LBL_MY_AMI",{hash:{},data:i}))+'</li>\n          <li class="item" data-id="FavoriteAmi">'+o(n.i18n.call(t,"RES_LBL_FAVORITE_AMI",{hash:{},data:i}))+'</li>\n        </ul>\n      </nav>\n    </header>\n    <div class="accordion-body scroll-wrap scrollbar-auto-hide">\n      <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\n      <button class="btn btn-primary BrowseCommunityAmi">'+o(n.i18n.call(t,"RES_BTN_BROWSE_COMMUNITY_AMI",{hash:{},data:i}))+'</button>\n      <ul class="scroll-content resource-list-ami"></ul>\n    </div>\n  </section>\n\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+o(n.i18n.call(t,"RES_TIT_VOL",{hash:{},data:i}))+'</header>\n    <div class="accordion-body scroll-wrap scrollbar-auto-hide">\n      <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\n      <button class="btn btn-primary ManageSnapshot">'+o(n.i18n.call(t,"RES_TIT_SNAPSHOT_MANAGE",{hash:{},data:i}))+'</button>\n      <ul class="resource-list-snapshot scroll-content"></ul>\n    </div>\n  </section>\n\n  <section class="accordion-group">\n    <header class="fixedaccordion-head">'+o(n.i18n.call(t,"RES_TIT_ELB_ASG",{hash:{},data:i}))+'</header>\n    <ul class="resource-list-asg clearfix accordion-body">\n      <li class="tooltip resource-item resource-icon-elb" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_DRAG_NEW_ELB",{hash:{},data:i}))+'\' data-type="ELB">'+o(n.i18n.call(t,"RES_LBL_NEW_ELB",{hash:{},data:i}))+'</li>\n      <li class="tooltip resource-item resource-icon-asg" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_DRAG_NEW_ASG",{hash:{},data:i}))+'\' data-type="ASG">'+o(n.i18n.call(t,"RES_LBL_NEW_ASG",{hash:{},data:i}))+"</li>\n    </ul>\n  </section>\n\n  <section class='accordion-group'>\n    <header class=\"fixedaccordion-head\">"+o(n.i18n.call(t,"RES_TIT_VPC",{hash:{},data:i}))+'</header>\n    <article class="accordion-body scroll-wrap scrollbar-auto-hide">\n      <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\n      <ul class="scroll-content">\n        <li class="tooltip resource-item resource-icon-subnet" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_DRAG_NEW_SUBNET",{hash:{},data:i}))+'\' data-type="SUBNET">'+o(n.i18n.call(t,"RES_LBL_NEW_SUBNET",{hash:{},data:i}))+'</li>\n\n        <li class="tooltip resource-item resource-icon-rt" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_DRAG_NEW_RTB",{hash:{},data:i}))+'\' data-type="RT">'+o(n.i18n.call(t,"RES_LBL_NEW_RTB",{hash:{},data:i}))+'</li>\n\n        <li class="tooltip resource-item resource-icon-igw" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_DRAG_NEW_IGW",{hash:{},data:i}))+'\' data-type="IGW">'+o(n.i18n.call(t,"RES_LBL_NEW_IGW",{hash:{},data:i}))+'</li>\n\n        <li class="tooltip resource-item resource-icon-vgw" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_DRAG_NEW_VGW",{hash:{},data:i}))+'\' data-type="VGW">'+o(n.i18n.call(t,"RES_LBL_NEW_VGW",{hash:{},data:i}))+'</li>\n\n        <li class="tooltip resource-item resource-icon-cgw" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_DRAG_NEW_CGW",{hash:{},data:i}))+'\' data-type="CGW">'+o(n.i18n.call(t,"RES_LBL_NEW_CGW",{hash:{},data:i}))+'</li>\n\n        <li class="tooltip resource-item resource-icon-eni" data-tooltip=\''+o(n.i18n.call(t,"RES_TIP_DRAG_NEW_ENI",{hash:{},data:i}))+'\' data-type="ENI">'+o(n.i18n.call(t,"RES_LBL_NEW_ENI",{hash:{},data:i}))+"</li>\n      </ul>\n    </article>\n  </section>\n</div>",s},n.panel=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r;return r=n["with"].call(e,e&&e.attributes,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t}),r||r===0?r:""}function l(e,t){var r="",i;return r+='\n<li class="tooltip resource-item resource-icon-az" data-tooltip=\''+o(n.i18n.call(e,"RES_TIP_DRAG_AZ",{hash:{},data:t}))+'\' data-type="AZ" data-option=\'{"name":"'+o((i=e&&e.id,typeof i===u?i.apply(e):i))+'"}\'><div class="az-name">'+o(n.lastChar.call(e,e&&e.id,{hash:{},data:t}))+"</div>"+o((i=e&&e.id,typeof i===u?i.apply(e):i))+"</li>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=this.escapeExpression,u="function",a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.az=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r;return r=n["with"].call(e,e&&e.attributes,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t}),r||r===0?r:""}function c(e,t){var r="",i;r+='\n<li class="resource-item bubble resource-icon-ebs-snapshot" data-bubble-template="bubbleSnapshotInfo" data-bubble-data=\'{"snapshotId":"'+a((i=e&&e.id,typeof i===u?i.apply(e):i))+'", "startTime":"'+a((i=e&&e.startTime,typeof i===u?i.apply(e):i))+'","status":"'+a((i=e&&e.status,typeof i===u?i.apply(e):i))+'","size":"'+a((i=e&&e.volumeSize,typeof i===u?i.apply(e):i))+'","encrypted":"',i=n["if"].call(e,e&&e.encrypted,{hash:{},inverse:f.program(5,p,t),fn:f.program(3,h,t),data:t});if(i||i===0)r+=i;r+='"}\' data-type="VOL" data-option=\'{"volumeSize":'+a((i=e&&e.volumeSize,typeof i===u?i.apply(e):i))+', "snapshotId": "'+a((i=e&&e.id,typeof i===u?i.apply(e):i))+'", "encrypted": "',i=n["if"].call(e,e&&e.encrypted,{hash:{},inverse:f.program(5,p,t),fn:f.program(3,h,t),data:t});if(i||i===0)r+=i;return r+='"}\'><div class="ebs-size">'+a((i=e&&e.volumeSize,typeof i===u?i.apply(e):i))+" GB</div>"+a((i=e&&e.id,typeof i===u?i.apply(e):i))+"</li>",r}function h(e,t){return"true"}function p(e,t){return"false"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<li class="tooltip resource-item resource-icon-volume" data-tooltip=\''+a(n.i18n.call(t,"RES_TIP_DRAG_NEW_VOLUME",{hash:{},data:i}))+'\' data-type="VOL">'+a(n.i18n.call(t,"RES_LBL_NEW_VOL",{hash:{},data:i}))+"</li>\n",o=n.each.call(t,t,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s},n.snapshot=e.template(t),t=function(e,t,n,r,i){function f(e,t,r){var i;return i=n["with"].call(e,e&&e.attributes,{hash:{},inverse:a.noop,fn:a.programWithDepth(2,l,t,r),data:t}),i||i===0?i:""}function l(e,t,r){var i="",s;i+='\n<li class="bubble resource-item instance" data-bubble-template="resPanelAmiInfo" data-bubble-data=\'{"region":"'+o((s=r&&r.region,typeof s===u?s.apply(e):s))+'","imageId":"'+o((s=e&&e.id,typeof s===u?s.apply(e):s))+'"}\' data-type="INSTANCE" data-option=\'{"imageId":"'+o((s=e&&e.id,typeof s===u?s.apply(e):s))+"\"}'>\n  ",s=n["if"].call(e,r&&r.fav,{hash:{},inverse:a.noop,fn:a.program(3,c,t),data:t});if(s||s===0)i+=s;return i+='\n  <div class="resource-icon-instance"><img src="/assets/images/ide/ami/'+o((s=e&&e.osType,typeof s===u?s.apply(e):s))+"."+o((s=e&&e.architecture,typeof s===u?s.apply(e):s))+"."+o((s=e&&e.rootDeviceType,typeof s===u?s.apply(e):s))+".png\" width='39' height='27' /></div>\n  "+o((s=e&&e.name,typeof s===u?s.apply(e):s))+"\n</li>",i}function c(e,t){var r="",i;return r+='<button class="btn-fav-ami fav tooltip" data-tooltip="'+o(n.i18n.call(e,"RES_TIT_TOGGLE_FAVORITE",{hash:{},data:t}))+'" data-id="'+o((i=e&&e.id,typeof i===u?i.apply(e):i))+'"></button>',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=this.escapeExpression,u="function",a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.programWithDepth(1,f,i,t),data:i}),s||s===0?s:""},n.ami=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="resource-icon resource-icon-instance" >\n    <img src="/assets/images/ide/ami/'+a((o=(o=t&&t.cachedAmi,o==null||o===!1?o:o.osType),typeof o===u?o.apply(t):o))+"."+a((o=(o=t&&t.cachedAmi,o==null||o===!1?o:o.architecture),typeof o===u?o.apply(t):o))+"."+a((o=(o=t&&t.cachedAmi,o==null||o===!1?o:o.rootDeviceType),typeof o===u?o.apply(t):o))+'.png"/>\n  </div>\n<div class="resource-label instance-label">Auto Scaling Group ('+a((o=t&&t.name,typeof o===u?o.apply(t):o))+")</div>",s},n.reuse_lc=e.template(t),n}),define("workspaces/editor/template/TplAmiBrowser",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression;s+='<div class="content-wrap" style="position:relative;">\n  <div id="ami-search-option">\n    <div>\n      <input id="community-ami-input" class="input" type="text" placeholder="',o=n.i18n.call(t,"AMI_LBL_ALL_SEARCH_AMI_BY_NAME_OR_ID",{hash:{},data:i});if(o||o===0)s+=o;return s+='" />\n    </div>\n\n    <div id="selectbox-ami-platform" class="selectbox">\n      <div class="selection">'+u(n.i18n.call(t,"AMI_LBL_ALL_PLATFORMS",{hash:{},data:i}))+'</div>\n      <ul class="dropdown" tabindex="-1">\n        <li class="item selected" data-id="">'+u(n.i18n.call(t,"AMI_LBL_ALL_PLATFORMS",{hash:{},data:i}))+'</li>\n        <li class="item" data-id="amazonlinux"> <span class="icon-ami-os amz-linux">Amazon Linux</span> </li>\n        <li class="item" data-id="centos"> <span class="icon-ami-os centos">Cent OS</span> </li>\n        <li class="item" data-id="debian"> <span class="icon-ami-os debian">Debian</span> </li>\n        <li class="item" data-id="fedora"> <span class="icon-ami-os fedora">Fedora</span> </li>\n        <li class="item" data-id="gentoo"> <span class="icon-ami-os gentoo">Gentoo</span> </li>\n        <li class="item" data-id="opensuse"><span class="icon-ami-os opensuse">OpenSUSE</span> </li>\n        <li class="item" data-id="ubuntu"> <span class="icon-ami-os ubuntu">Ubuntu</span> </li>\n        <li class="item" data-id="redhat"> <span class="icon-ami-os redhat">Red Hat</span> </li>\n        <li class="item" data-id="windows"><span class="icon-ami-os windows">Windows</span> </li>\n        <li class="item" data-id="otherlinux"> <span class="icon-ami-os linux-other">Other Linux</span> </li>\n      </ul>\n    </div>\n\n    <div class="ami-option-group">\n      <h5>'+u(n.i18n.call(t,"AMI_LBL_VISIBILITY",{hash:{},data:i}))+'</h5>\n      <div class="ami-option-wrap" id="filter-ami-type">\n        <button type="button" class="btn active">'+u(n.i18n.call(t,"AMI_LBL_PUBLIC",{hash:{},data:i}))+'</button>\n        <button type="button" class="btn">'+u(n.i18n.call(t,"AMI_LBL_PRIVATE",{hash:{},data:i}))+'</button>\n      </div>\n    </div>\n\n    <div class="ami-option-group">\n      <h5>'+u(n.i18n.call(t,"AMI_LBL_ARCHITECTURE",{hash:{},data:i}))+'</h5>\n      <div class="ami-option-wrap" id="filter-ami-32bit-64bit">\n        <button type="button" class="btn active">'+u(n.i18n.call(t,"AMI_LBL_32_BIT",{hash:{},data:i}))+'</button>\n        <button type="button" class="btn">'+u(n.i18n.call(t,"AMI_LBL_64_BIT",{hash:{},data:i}))+'</button>\n      </div>\n    </div>\n\n    <div class="ami-option-group">\n      <h5>'+u(n.i18n.call(t,"AMI_LBL_ROOT_DEVICE_TYPE",{hash:{},data:i}))+'</h5>\n      <div class="ami-option-wrap" id="filter-ami-EBS-Instance">\n        <button type="button" class="btn active">'+u(n.i18n.call(t,"AMI_LBL_EBS",{hash:{},data:i}))+'</button>\n        <button type="button" class="btn">'+u(n.i18n.call(t,"AMI_LBL_INSTANCE_STORE",{hash:{},data:i}))+'</button>\n      </div>\n    </div>\n\n    <div id="btn-search-ami" class="btn btn-blue" disabled>'+u(n.i18n.call(t,"AMI_LBL_SEARCHING",{hash:{},data:i}))+'</div>\n  </div>\n\n  <div id="ami-data-wrap">\n    <div id="ami-table-wrap" class="table-head-fix">\n      <table class="table-head">\n        <thead>\n        <tr>\n          <th style="width: 44px;"></th>\n          <th style="width: 104px;">'+u(n.i18n.call(t,"AMI_LBL_AMI_ID",{hash:{},data:i}))+"</th>\n          <th>"+u(n.i18n.call(t,"AMI_LBL_AMI_NAME",{hash:{},data:i}))+'</th>\n          <th style="width: 62px;padding-left:4px;text-align:left;" class="sortable">'+u(n.i18n.call(t,"AMI_LBL_SIZE",{hash:{},data:i}))+'</th>\n        </tr>\n        </thead>\n      </table>\n      <div class="scroll-wrap">\n        <div class="scrollbar-veritical-wrap" style="display: block;"><div class="scrollbar-veritical-thumb"></div></div>\n        <div class="show-loading">\n          <div class="loading-spinner"></div>\n        </div>\n        <div class="scroll-content" style="display:block;">\n          <table class="table">\n            <thead>\n            <tr>\n              <th style="width: 16px;"><div class="th-inner"></div></th>\n              <th style="width: 80px;"><div class="th-inner"></div></th>\n              <th><div class="th-inner"></div></th>\n              <th style="width: 42px;"><div class="th-inner"></div></th>\n            </tr>\n            </thead>\n            <tbody id="community_ami_table"></tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n\n    <div id="community-ami-page">\n      <div class="page-tip" style="display: none;"></div>\n      <div class="pagination" style="display: none;">\n        <a href="#" class="previous" data-action="previous">&lsaquo;</a>\n        <input type="text" readonly="readonly" data-max-page="40" />\n        <a href="#" class="next" data-action="next">&rsaquo;</a>\n      </div>\n    </div>\n  </div>\n</div>',s},n.dialog=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r="",i;r+='<tr class="item" data-id="'+u((i=t==null||t===!1?t:t.key,typeof i===o?i.apply(e):i))+'">\n  <td><div class="toggle-fav ',i=n["if"].call(e,e&&e.faved,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;r+=' tooltip" data-tooltip="'+u(n.i18n.call(e,"RES_TIT_TOGGLE_FAVORITE",{hash:{},data:t}))+'"></div></td>\n  <td>'+u((i=t==null||t===!1?t:t.key,typeof i===o?i.apply(e):i))+'</td>\n  <td>\n    <span class="ami-table-name">'+u((i=e&&e.name,typeof i===o?i.apply(e):i))+'</span>\n    <div class="ami-meta '+u((i=e&&e.osType,typeof i===o?i.apply(e):i))+' icon-ami-os"> ',i=n.ifCond.call(e,e&&e.isPublic,"true",{hash:{},inverse:a.program(6,h,t),fn:a.program(4,c,t),data:t});if(i||i===0)r+=i;return r+=" | "+u((i=e&&e.architecture,typeof i===o?i.apply(e):i))+" | "+u((i=e&&e.rootDeviceType,typeof i===o?i.apply(e):i))+"</div>\n  </td>\n  <td>"+u((i=e&&e.imageSize,typeof i===o?i.apply(e):i))+"</td>\n</tr>\n",r}function l(e,t){return"fav"}function c(e,t){return"public"}function h(e,t){return"private"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.amiItem=e.template(t),n}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("workspaces/editor/subviews/AmiBrowser",["../template/TplAmiBrowser","i18n!/nls/lang.js","UI.modalplus","ApiRequest","CloudResources","backbone","jqpagination"],function(t,n,r,i,s){return Backbone.View.extend({events:{"click .ami-option-group .ami-option-wrap .btn":"clickOptionBtn","keypress #community-ami-input":"search","click    #btn-search-ami":"search","click    .toggle-fav":"toggleFav"},initialize:function(e){var i,s;$.extend(this,e),i=new r({title:n.ide.AMI_LBL_COMMUNITY_AMIS,width:"855px",template:t.dialog(),disableFooter:!0,compact:!0}),s=this,i.on("close",function(){s.onClose&&s.onClose()}),this.setElement(i.tpl),this.doSearch()},clickOptionBtn:function(e){var t;if($(e.target).hasClass("active")){t=$(e.target).parent().find(".active");if(t.length===1&&t[0]===e.target)return;$(e.target).removeClass("active")}else $(e.target).addClass("active");return null},toggleFav:function(e){var t,n,r,i,o,u;return t=$(e.target),u=this,r=s("FavoriteAmi",this.region),o=null,i=t.closest("tr").attr("data-id"),t.hasClass("fav")?o=r.unfav(i):(n=$.extend({id:i},this.communityAmiData[i]),o=r.fav(n)),o.then(function(){return t.toggleClass("fav")})},doSearch:function(e,t){var r,s,o,u,a,f,l,c,h;return e=e||1,this.renderAmiLoading(),o=$("#community-ami-input").val(),a=$("#selectbox-ami-platform").find(".selected").data("id"),s="true",r="32-bit",l="EBS",$("#filter-ami-type").find(".active").length===1?(h=radiobuttons.data($("#filter-ami-type")),s=h==="Private"?"false":"true"):$("#filter-ami-type").find(".active").length===2&&(s=null),$("#filter-ami-32bit-64bit").find(".active").length===1?r=radiobuttons.data($("#filter-ami-32bit-64bit")):$("#filter-ami-32bit-64bit").find(".active").length===2&&(r=null),$("#filter-ami-EBS-Instance").find(".active").length===1?l=radiobuttons.data($("#filter-ami-EBS-Instance")):$("#filter-ami-EBS-Instance").find(".active").length===2&&(l=null),u=parseInt(t||50,10),f=parseInt(e,10),c=this,i("aws_public",{region_name:this.region,filters:{ami:{name:o,platform:a,isPublic:s,architecture:r,rootDeviceType:l,perPageNum:u,returnPage:f}}}).then(function(e){var t;return e=c.addFavStar(e),c.communityAmiData=((t=e.ami)!=null?t.result:void 0)||{},c.communityAmiRender(e)},function(e){return notification("error",n.ide.RES_MSG_WARN_GET_COMMUNITY_AMI_FAILED),c.communityAmiRender({ami:[]})})},searchPrev:function(){var e;return e=parseInt($("#community_ami_page_current").attr("page"),10),this.doSearch(e+1)},searchNext:function(){var e;return e=parseInt($("#community_ami_page_current").attr("page"),10),this.doSearch(e-1)},search:function(e){if(e.keyCode&&e.keyCode!==13)return;return this.doSearch()},addFavStar:function(t){var n,r,i;return r=s("FavoriteAmi",this.region).getModels()||[],n=_.clone(t.ami.result),i=_.pluck(_.pluck(r,"attributes"),"id"),_.each(n,function(t,n){if(e.call(i,n)>=0)return t.faved=!0}),t.ami.result=n,t},communityAmiRender:function(e){var n;this.communityShowContent(),n=0;if(!e.ami)return;return e=e.ami,$("#community_ami_table").html(t.amiItem(e.result)),this.communityPagerRender(e.curPageNum,e.totalPageNum,e.totalNum)},communityPagerRender:function(e,t,r){var i,s,o,u,a;return a=this,o=r>50?50:r,i=(e-1)*50+1,s=i+o-1,s>r&&(s=r),$(".page-tip").text(sprintf(n.ide.AMI_LBL_PAGEINFO,i,s,r)),u=$(".pagination"),t===0?u.hide():u.show(),u.data("jqPagination")&&(u.jqPagination("destroy"),u.find("input").data("current-page",e)),u.jqPagination({current_page:e,max_page:t,page_string:"{current_page} / {max_page}",paged:function(e,t){return function(n){if(n!==e&&t>=n&&n>0)return a.doSearch(n)}}(e,t)})},communityShowContent:function(){return $(".show-loading").hide(),$("#ami-table-wrap .scroll-content").show(),$("#btn-search-ami").text(n.ide.AMI_LBL_SEARCH).removeAttr("disabled"),$("#community-ami-page>div").show()},renderAmiLoading:function(){return $("#ami-table-wrap .scroll-content").hide(),$(".show-loading").show(),$("#btn-search-ami").text(n.ide.AMI_LBL_SEARCHING).attr("disabled",""),$("#community-ami-page>div").hide()}})})}.call(this),function(){define("workspaces/editor/subviews/ResourcePanel",["CloudResources","Design","../template/TplLeftPanel","constant","dhcp","snapshotManager","sslcert_manage","sns_manage","kp_manage","./AmiBrowser","i18n!/nls/lang.js","ApiRequest","backbone","UI.radiobuttons"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h;return h=null,$(window).on("resize",function(){h&&clearTimeout(h),h=setTimeout(function(){return $("#OpsEditor").filter(":visible").children(".OEPanelLeft").trigger("RECALC")},150)}),MC.template.resPanelAmiInfo=function(t){var n,i,s,o;if(!t.region||!t.imageId)return;n=e(r.RESTYPE.AMI,t.region).get(t.imageId);if(!n)return;n=n.toJSON(),n.imageSize=n.imageSize||((o=n.blockDeviceMapping[n.rootDeviceName])!=null?o.volumeSize:void 0);try{i=App.model.getOsFamilyConfig(t.region),i=i[n.osFamily]||i[r.OS_TYPE_MAPPING[n.osType]],i=n.rootDeviceType==="ebs"?i.ebs:i["instance store"],i=i[n.architecture],i=i[n.virtualizationType||"paravirtual"],n.instanceType=i.join(", ")}catch(u){s=u}return MC.template.bubbleAMIInfo(n)},Backbone.View.extend({events:{"click .btn-fav-ami":"toggleFav","click .HideOEPanelLeft":"toggleLeftPanel","OPTION_CHANGE .AmiTypeSelect":"changeAmiType","click .BrowseCommunityAmi":"browseCommunityAmi","click .ManageSnapshot":"manageSnapshot","click .fixedaccordion-head":"updateAccordion",RECALC:"recalcAccordion","mousedown .resource-item":"startDrag","click .refresh-resource-panel":"refreshPanelData","click .resources-dropdown-wrapper li":"resourcesMenuClick"},initialize:function(n){var i,s;this.workspace=n.workspace,this.subViews=[],s=this.workspace.opsModel.get("region"),this.listenTo(e("MyAmi",s),"update",this.updateMyAmiList),this.listenTo(e(r.RESTYPE.AZ,s),"update",this.updateAZ),this.listenTo(e(r.RESTYPE.SNAP,s),"update",this.updateSnapshot),i=this.workspace.design,this.listenTo(i,t.EVENT.ChangeResource,this.onResChanged),this.listenTo(i,t.EVENT.AddResource,this.updateDisableItems),this.listenTo(i,t.EVENT.RemoveResource,this.updateDisableItems),this.subEventForUpdateReuse(),this.__amiType="QuickStartAmi"},render:function(){var e;e=this,this.setElement(this.workspace.view.$el.find(".OEPanelLeft").html(n.panel({}))),this.$el.toggleClass("hidden",this.__leftPanelHidden||!1),this.recalcAccordion(),this.updateAZ(),this.updateSnapshot(),this.updateAmi(),$(document).off("keydown",e.bindKey.bind(this)).on("keydown",e.bindKey.bind(this)),this.updateDisableItems(),this.renderReuse()},reuseLc:Backbone.View.extend({tagName:"li",className:"tooltip resource-item resource-icon-asg resource-reuse",inDom:!1,defaultAttr:function(){return{"data-type":"ASG"}},defaultData:function(){var e;return e=this,{option:{lcId:e.model.id}}},initialize:function(e){return e||(e={}),this.parent=e.parent,this.settleElement(e),this.bindEvent(this.model)},bindEvent:function(e){return this.listenTo(e,"change",this.render),this.listenTo(e,"destroy",function(e){return e.__brothers.length?(this.model=e.__brothers[0],this.stopListening(),this.bindEvent(this.model),this.settleElement({})):this.remove()})},settleElement:function(e){return this.$el.attr(_.extend({},e.attr,this.defaultAttr())),this.$el.data(_.extend({},e.data,this.defaultData()))},render:function(){var e;return e=this.model.toJSON(),e.cachedAmi||(e.cachedAmi=this.model.getAmi()),this.$el.html(n.reuse_lc(e)),this.inDom||(this.inDom=!0,(this.parent||this).$el.find(".resource-list-asg").append(this.el)),this}}),bindKey:function(e){var t,n,r,i,s,o;o=this,n=e.which,r=e.ctrlKey||e.metaKey,i=e.shiftKey,s=e.target.tagName.toLowerCase(),t=s==="input"||s==="textarea";if(r===!1&&i===!1&&n===82&&t===!1)return o.toggleResourcePanel(),!1},renderReuse:function(){var e,t,n,i;e=this.workspace.design.componentsOfType(r.RESTYPE.LC);for(n=0,i=e.length;n<i;n++)t=e[n],!t.isClone()&&!t.get("appId")&&this.subViews.push((new this.reuseLc({model:t,parent:this})).render());return this},subEventForUpdateReuse:function(){return this.listenTo(this.workspace.design,t.EVENT.AddResource,function(e){if(e.type===r.RESTYPE.LC&&!e.isClone()&&!e.get("appId"))return this.subViews.push((new this.reuseLc({model:e,parent:this})).render())},this)},onResChanged:function(e){if(!e)return;if(e.type!==r.RESTYPE.AZ)return;this.updateAZ()},updateAZ:function(){var t;if(!this.workspace.isAwake())return;t=this.workspace.opsModel.get("region"),this.$el.find(".resource-list-az").html(n.az(e(r.RESTYPE.AZ,t).where({category:t})||[])),this.updateDisabledAz()},updateSnapshot:function(){var t;if(!this.workspace.isAwake())return;t=this.workspace.opsModel.get("region"),this.$el.find(".resource-list-snapshot").html(n.snapshot(e(r.RESTYPE.SNAP,t).where({category:t})||[]))},changeAmiType:function(e,t){return this.__amiType=t||"QuickStartAmi",this.updateAmi()},updateAmi:function(){var t,r;return r=e(this.__amiType,this.workspace.opsModel.get("region")).getModels().sort(function(e,t){var n,r;return e=e.attributes,t=t.attributes,e.osType==="windows"&&t.osType!=="windows"?1:e.osType!=="windows"&&t.osType==="windows"?-1:(n=e.osType,r=t.osType,n===r&&(n=e.architecture,r=t.architecture,n===r&&(n=e.name,r=t.name)),n>r?1:-1)}),r.fav=this.__amiType==="FavoriteAmi",r.region=this.workspace.opsModel.get("region"),t=n.ami(r),this.$el.find(".resource-list-ami").html(t)},updateDisableItems:function(){if(!this.workspace.isAwake())return;this.updateDisabledAz(),this.updateDisabledVpcRes()},updateDisabledAz:function(){var e,t,n,i,s,o,u,a,f;e=this.$el.find(".resource-list-az").children().removeClass("resource-disabled"),f=this.workspace.design.componentsOfType(r.RESTYPE.AZ);for(s=0,u=f.length;s<u;s++){t=f[s],n=t.get("name");for(o=0,a=e.length;o<a;o++){i=e[o];if($(i).text().indexOf(n)!==-1){$(i).addClass("resource-disabled");break}}}},updateDisabledVpcRes:function(){var e,t;e=this.$el.find(".resource-icon-igw").parent(),t=this.workspace.design,e.children(".resource-icon-igw").toggleClass("resource-disabled",t.componentsOfType(r.RESTYPE.IGW).length>0),e.children(".resource-icon-vgw").toggleClass("resource-disabled",t.componentsOfType(r.RESTYPE.VGW).length>0)},updateFavList:function(){if(this.__amiType==="FavoriteAmi")return this.updateAmi()},updateMyAmiList:function(){if(this.__amiType==="MyAmi")return this.updateAmi()},toggleFav:function(t){var n,r;return n=$(t.currentTarget).toggleClass("fav"),r=e("FavoriteAmi",this.workspace.opsModel.get("region")),n.hasClass("fav")?r.fav(n.attr("data-id")):r.unfav(n.attr("data-id")),!1},toggleLeftPanel:function(){return this.__leftPanelHidden=this.$el.toggleClass("hidden").hasClass("hidden"),!1},toggleResourcePanel:function(){return this.toggleLeftPanel()},updateAccordion:function(e,t){var n,r,i,s,o,u,a,f;u=$(e.currentTarget),n=u.closest(".accordion-group");if(e.target&&!$(e.target).hasClass("fixedaccordion-head"))return;return n.hasClass("expanded")?!1:(this.__openedAccordion=n.index(),o=n.siblings(".expanded"),s=n.children(".accordion-body"),i=n.closest(".fixedaccordion"),r=i.parent(),a=i.children().filter(function(){return $(this).css("display")!=="none"}),f=r.outerHeight()-39-a.length*u.outerHeight(),s.outerHeight(f),t?(n.addClass("expanded"),o.removeClass("expanded"),!1):(s.slideDown(200,function(){return n.addClass("expanded")}),o.children(".accordion-body").slideUp(200,function(){return o.closest(".accordion-group").removeClass("expanded")}),!1))},recalcAccordion:function(){var e,t,n,r;r=this.$el;if(!r.length)return;return t=r.children(".fixedaccordion").children(),e=t.filter(".expanded"),e.length===0&&(e=t.eq(this.__openedAccordion||0)),n=e.removeClass("expanded").children(".fixedaccordion-head"),this.updateAccordion({currentTarget:n[0]},!0)},browseCommunityAmi:function(){var t,n;return n=this.workspace.opsModel.get("region"),this.listenTo(e("FavoriteAmi",n),"update",this.updateFavList),t=new f({region:n}),t.onClose=function(t){return function(){return t.stopListening(e("FavoriteAmi",n),"update",t.updateFavList)}}(this),!1},manageSnapshot:function(){return(new s).render()},refreshPanelData:function(t){var n,i;n=$(t.currentTarget);if(n.hasClass("reloading"))return;n.addClass("reloading"),i=this.workspace.opsModel.get("region"),Q.all([e("MyAmi",i).fetchForce(),e(r.RESTYPE.SNAP,i).fetchForce()]).done(function(){return n.removeClass("reloading")})},resourcesMenuClick:function(e){var t,n;t=$(e.currentTarget),n=t.data("action");switch(n){case"keypair":return(new a).render();case"snapshot":return(new s).render();case"sns":return(new u).render();case"sslcert":return(new o).render();case"dhcp":return(new i).manageDhcp()}},startDrag:function(e){var t,n,i,s,o,u,a,f,l,c,h,p;if(e.button!==0)return!1;i=$(e.currentTarget);if(i.hasClass("resource-disabled"))return!1;if(e.target&&$(e.target).hasClass("btn-fav-ami"))return;return p=r.RESTYPE[i.attr("data-type")],void 0,$("<div id='ResourceDragItem'></div><div id='overlayer' class='grabbing'></div>").appendTo(document.body),h=i.offset(),n=$("#ResourceDragItem").html(i.html()).attr("class",i.attr("class").replace("bubble","")).css({top:h.top,left:h.left}),setTimeout(function(){return n.addClass("add-to-dom")},10),p===r.RESTYPE.VOL?(Canvon(".AWS-EC2-Instance, .AWS-AutoScaling-LaunchConfiguration").addClass("attachable"),$(document).on({mousemove:MC.canvas.volume.mousemove,mouseup:MC.canvas.volume.mouseup},{target:i,canvas_offset:$canvas.offset(),canvas_body:$("#canvas_body"),shadow:n,action:"add"})):(c=MC.canvas.MATCH_PLACEMENT[p],c&&Canvon("."+c.join(",").replace(/\./ig,"-").replace(/,/ig,",.")).addClass("dropable-group"),p===r.RESTYPE.INSTANCE&&(t=$("#changeAmiDropZone"),t.is(":visible")&&(u=t.offset(),o={x1:u.left,x2:u.left+t.width(),y1:u.top,y2:u.top+t.height()})),s=MC.canvas.GROUP_DEFAULT_SIZE[p],a="group",f=0,l=0,s||(s=MC.canvas.COMPONENT_SIZE[p],a="node",f=8,l=8),p===r.RESTYPE.INSTANCE&&(l=0),p===r.RESTYPE.ASG&&(f=-8),$(document).on({"mousemove.SidebarDrag":this.onDragMove,"mouseup.SidebarDrag":this.onDragStop},{target_type:p,canvas_offset:$canvas.offset(),drop_zone:t,drop_zone_data:o,comp_size:s,node_type:a,offsetX:e.pageX-h.left,offsetY:e.pageY-h.top,placeOffsetY:l,placeOffsetX:f,target:i,scale:$canvas.scale()}),$("#canvas_body").addClass("node-dragging")),MC.canvas.volume.close(),MC.canvas.event.clearSelected(),!1},onDragMove:function(e){var t,n,r,i;return Canvon(".match-dropable-group").removeClass("match-dropable-group"),n=e.data,t=n.canvas_offset,i=MC.canvas.isMatchPlace(null,n.target_type,n.node_type,(e.pageX-n.offsetX-n.placeOffsetX-t.left)/10*n.scale,(e.pageY-n.offsetY-n.placeOffsetY-t.top)/10*n.scale,n.comp_size[0],n.comp_size[1]),i.is_matched&&Canvon("#"+i.target).addClass("match-dropable-group"),n.drop_zone_data&&(r=event.pageX>n.drop_zone_data.x1&&event.pageX<n.drop_zone_data.x2&&event.pageY>n.drop_zone_data.y1&&event.pageY<n.drop_zone_data.y2,n.drop_zone.toggleClass("hover",r)),$("#ResourceDragItem").css({top:e.pageY-n.offsetY,left:e.pageX-n.offsetX}),!1},onDragStop:function(e){var t,n,i,s,o,u,a,f,l,c,h,p,d,v,m;$("#overlayer").remove(),t=$("#ResourceDragItem"),Canvon(".dropable-group").removeClass("dropable-group"),Canvon(".match-dropable-group").removeClass("match-dropable-group"),$("#canvas_body").removeClass("node-dragging"),$(document).off("mousemove.SidebarDrag").off("mouseup.SidebarDrag"),u=e.data;if(u.drop_zone_data&&e.pageX>u.drop_zone_data.x1&&e.pageX<u.drop_zone_data.x2&&e.pageY>u.drop_zone_data.y1&&e.pageY<u.drop_zone_data.y2)return u.drop_zone.removeClass("hover").trigger("drop",$(e.data.target).data("option").imageId),t.remove(),!1;c=u.node_type,h=u.target_type,i=u.canvas_offset,l=u.target.data("option")||{},s=u.comp_size,o={x:(e.pageX-u.offsetX-u.placeOffsetX-i.left)/10*u.scale,y:(e.pageY-u.offsetY-u.placeOffsetY-i.top)/10*u.scale};if(o.x<0||o.y<0){t.remove();return}return c==="node"?h===r.RESTYPE.IGW||h===r.RESTYPE.VGW?(d=$(".AWS-VPC-VPC").attr("id"),v=$canvas(d),p=v.position(),m=v.size(),l.groupUId=d,o.y>p[1]+m[1]-s[1]&&(o.y=p[1]+m[1]-s[1]),o.y<p[1]&&(o.y=p[1]),h===r.RESTYPE.IGW?o.x=p[0]-s[1]/2:o.x=p[0]+m[0]-s[1]/2,$canvas.add(h,l,o)):(a=MC.canvas.isMatchPlace(null,h,c,o.x,o.y,s[0],s[1]),a.is_matched?(l.groupUId=a.target,f=$canvas.add(h,l,o),f&&MC.canvas.select(f)):$canvas.trigger("CANVAS_PLACE_NOT_MATCH",{type:h})):(a=MC.canvas.isMatchPlace(null,h,c,o.x,o.y,s[0],s[1]),n=MC.canvas.areaChild(null,h,o.x,o.y,o.x+s[0],o.y+s[1]),a.is_matched?n.length===0&&MC.canvas.isBlank("",h,"group",o.x-1,o.y-1,s[0]+2,s[1]+2)?(l.groupUId=a.target,f=$canvas.add(h,l,o),(!$canvas.hasVPC()||h!==r.RESTYPE.AZ)&&MC.canvas.select(f)):$canvas.trigger("CANVAS_PLACE_OVERLAP"):$canvas.trigger("CANVAS_PLACE_NOT_MATCH",{type:h})),h===r.RESTYPE.IGW||h===r.RESTYPE.VGW?t.animate({left:o.x*10+i.left,top:o.y*10+i.top,opacity:0},function(){return t.remove()}):t.remove(),!1},remove:function(){_.invoke(this.subViews,"remove"),this.subViews=null,Backbone.View.prototype.remove.call(this)}})})}.call(this),define("workspaces/editor/template/TplStatusbar",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<ul class="status-bar"></ul>\n<div class="status-bar-modal" style="display: none;"></div>'},n.frame=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'Last saved: <span class="stack-save-time">-<span>'},n.lastSaved=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<span class="state-success"><i class="status status-green icon-label"></i><b>'+a((o=t&&t.successCount,typeof o===u?o.apply(t):o))+'</b></span>\n<span class="state-failed"><i class="status status-red icon-label"></i><b>'+a((o=t&&t.failCount,typeof o===u?o.apply(t):o))+"</b></span>",s},n.state=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},"Validate"},n.ta=e.template(t),n}),function(){define("workspaces/editor/subviews/Statusbar",["OpsModel","Design","../template/TplStatusbar","constant","backbone","event","state_status"],function(e,t,n,r,i,s,o){var u,a;return a=[{name:"lastSaved",className:"info",visible:!0,events:{update:function(){return[{obj:null,event:"jsonDataSaved"}]}},update:function(e,t){var n;return n=jQuery.now()/1e3,this.timer=setInterval(function(){var t,r;t=e(".stack-save-time"),r=MC.intervalDate(n);if(t.text()!==r)return t.text(r)},1e3),null},click:function(e){return null},remove:function(){return clearInterval(this.timer)}},{name:"ta",className:"status-bar-btn",visible:function(e,t){var n,r;return r=t.design.mode(),r==="app"||r==="appview"?n=!1:n=!0,typeof e=="function"&&e(n),n},changeVisible:!0,click:function(e){var t,n;return t=$(e.currentTarget),n="Validate",t.text("Validating..."),setTimeout(function(){return MC.ta.validAll(),t.text(n),require(["component/trustedadvisor/main"],function(e){return e.loadModule("statusbar",null)})},50)}},{name:"state",className:"status-bar-btn",visible:function(t,n){var r,i,s;return s=n.design.mode(),r=_.every([e.State.Updating,e.State.Running,e.State.Saving],function(e){return!n.opsModel.testState(e)}),i=!1,s==="app"||s==="appedit"?i=!r:s==="appview"&&(i=!1),typeof t=="function"&&t(i),i},events:{update:[{obj:s,event:s.UPDATE_STATE_STATUS_DATA}]},changeVisible:!0,update:function(e,t){var n;return n=this.renderData(!0,t),e(".state-success b").text(n.successCount),e(".state-failed b").text(n.failCount)},renderData:function(e,t){var n,r,i,s,o,u,a,f,l,c;this.workspace=t;if(!e)return{};i=App.WS.collection.status.find().fetch(),o=n=0,_.isArray(i)||(i=[i]);for(u=0,f=i.length;u<f;u++){r=i[u];if(r.app_id!==t.opsModel.get("id"))continue;if(r.status){c=r.status;for(a=0,l=c.length;a<l;a++)s=c[a],s.result==="success"?o++:s.result==="failure"&&n++}}return{successCount:o,failCount:n}},click:function(e){return o.loadModule()}}],u=i.View.extend({tagName:"li",initialize:function(){return _.bindAll(this,"render","toggle"),this.clearGarbage=[],this.needUpdate=[]},render:function(){return this.$el.html(this.template(this.data)),this},toggle:function(e){return this.$el.toggle(e)},remove:function(){var e,t,n,r;this.$el.remove(),this.stopListening(),r=this.clearGarbage;for(t=0,n=r.length;t<n;t++)e=r[t],_.isArray(e)?e[1].apply(e[0],e.slice(2)):e();return this.clearGarbage=[],this.needUpdate=[],this},update:function(){var e,t,n,r;r=this.needUpdate;for(t=0,n=r.length;t<n;t++)e=r[t],e();return this}}),i.View.extend({initialize:function(e){var t;return t=this.workspace=e.workspace,this.itemViews=[],null},ready:!1,render:function(){return this.setElement(this.workspace.view.$el.find(".OEPanelBottom").html(n.frame())),this.renderItem(),this},bindItem:function(){var e,t,r,i,o,f,l,c,h,p,d,v,m,g,y,b,w;b=jQuery.extend(!0,[],a).reverse();for(r=v=0,g=b.length;v<g;r=++v){o=b[r],l=new u,l.delegateEvents({click:o.click}),l.template=n[o.name],l.$el.addClass(o.className),c=_.bind(l.$,l),h=_.bind(l.toggle,l),_.isFunction(o.visible)&&(d=_.bind(o.visible,o,h,this.workspace)),_.isFunction(o.update)&&(p=_.bind(o.update,o,c,this.workspace)),w=o.events;for(f in w){t=w[f],_.isFunction(t)&&(t=t());if(!_.isArray(t))continue;for(m=0,y=t.length;m<y;m++)e=t[m],f==="update"&&(e.obj===s?(s.onLongListen(e.event,p),l.clearGarbage.push([s,s.offListen,e.event,p])):l.listenTo(e.obj||this.workspace.opsModel,e.event,p))}o.changeVisible&&(o.visible&&l.needUpdate.push(d),o.update&&l.needUpdate.push(p)),_.isFunction(o.visible)?i=o.visible(l.toggle,this.workspace):(l.toggle(o.visible),i=o.visible),l.data=(typeof o.renderData=="function"?o.renderData(i,this.workspace):void 0)||{},o.remove&&l.clearGarbage.push(_.bind(o.remove,o)),this.itemViews.push(l)}return null},renderItem:function(){var e,t,n,r,i;e=this,this.ready||(this.bindItem(),this.ready=!0),i=this.itemViews;for(n=0,r=i.length;n<r;n++)t=i[n],this.$("ul").append(t.render().el);return this},update:function(){var e,t,n,r,i;r=this.itemViews,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.update());return i},remove:function(){var e,t,n,r;this.$el.remove(),this.stopListening(),r=this.itemViews;for(t=0,n=r.length;t<n;t++)e=r[t],e.remove();return this}})})}.call(this),function(){define("workspaces/editor/StackView",["./OpsViewBase","./subviews/ResourcePanel","./subviews/Statusbar","OpsModel"],function(e,t,n,r){return e.extend({events:{SAVE:"saveStack"},initialize:function(){this.resourcePanel=new t({workspace:this.workspace}),this.statusbar=new n({workspace:this.workspace})},bindUserEvent:function(){this.$el.find(".OEPanelCenter").on("mousedown",".port",MC.canvas.event.drawConnection.mousedown).on("mousedown",".dragable",MC.canvas.event.dragable.mousedown).on("mousedown",".group-resizer",MC.canvas.event.groupResize.mousedown).on("mouseenter mouseleave",".node",MC.canvas.event.nodeHover).on("click",".line",MC.canvas.event.selectLine).on("mousedown","#svg_canvas",MC.canvas.event.clickBlank).on("mousedown","#node-action-wrap",MC.canvas.nodeAction.popup).on("mousedown",MC.canvas.event.ctrlMove.mousedown).on("mousedown",MC.canvas.event.clearSelected).on("selectstart",!1),$("#canvas_body").addClass("canvas_state_stack")},renderSubviews:function(){this.resourcePanel.render(),this.statusbar.render()},recoverSubviews:function(){this.resourcePanel.recalcAccordion()},remove:function(){this.resourcePanel.remove(),this.statusbar.remove(),e.prototype.remove.call(this)},saveStack:function(){return this.toolbar.$el.find(".icon-save").trigger("click")}})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/editor/StackEditor",["./OpsEditorBase","./StackView","Design","CloudResources","constant"],function(e,n,r,i,s){var o;return o=function(r){function o(){return o.__super__.constructor.apply(this,arguments)}return t(o,r),o.prototype.title=function(){return(this.design||this.opsModel).get("name")+" - stack"},o.prototype.tabClass=function(){return"icon-stack-tabbar"},o.prototype.createView=function(){return new n({workspace:this})},o.prototype.isReady=function(){var e,t;return!this.opsModel.hasJsonData()||!this.opsModel.isPersisted()?!1:(e=this.opsModel.get("region"),t=this.opsModel.getJsonData().agent.module,i(s.RESTYPE.AZ,e).isReady()&&i(s.RESTYPE.SNAP,e).isReady()&&i("QuickStartAmi",e).isReady()&&i("MyAmi",e).isReady()&&i("FavoriteAmi",e).isReady()&&!!App.model.getStateModule(t.repo,t.tag)&&this.hasAmiData())},o.prototype.initialize=function(){this.listenTo(this.opsModel,"change:id",this.updateUrl)},o.prototype.fetchAdditionalData=function(){var e,t;return e=this.opsModel.get("region"),t=this.opsModel.getJsonData().agent.module,Q.all([this.opsModel.save(),App.model.fetchStateModule(t.repo,t.tag),i(s.RESTYPE.AZ,e).fetch(),i(s.RESTYPE.SNAP,e).fetch(),i("QuickStartAmi",e).fetch(),i("MyAmi",e).fetch(),i("FavoriteAmi",e).fetch(),this.fetchAmiData()])},o.prototype.hasAmiData=function(){var e,t,n,r,o,u;r=this.opsModel.getJsonData(),e=i(s.RESTYPE.AMI,this.opsModel.get("region")),u=r.component;for(o in u){t=u[o];if(t.type===s.RESTYPE.INSTANCE||t.type===s.RESTYPE.LC){n=t.resource.ImageId;if(n&&!e.get(n))return!1}}return!0},o.prototype.fetchAmiData=function(){var e,t,n,r,o,u;n=this.opsModel.getJsonData(),r={},u=n.component;for(o in u){e=u[o];if(e.type===s.RESTYPE.INSTANCE||e.type===s.RESTYPE.LC)t=e.resource.ImageId,t&&(r[t]=!0)}return i(s.RESTYPE.AMI,this.opsModel.get("region")).fetchAmis(_.keys(r))},o.prototype.cleanup=function(){e.prototype.cleanup.call(this),this.opsModel.isPersisted()||this.opsModel.remove()},o.prototype.isModified=function(){return this.opsModel.isPersisted()?this.design&&this.design.isModified():!0},o}(e),o})}.call(this),function(){define("workspaces/editor/AppView",["./StackView","OpsModel","./template/TplOpsEditor","UI.modalplus","i18n!/nls/lang.js"],function(e,t,n,r,i){return e.extend({bindUserEvent:function(){this.workspace.isAppEditMode()?this.$el.find(".OEPanelCenter").removeClass("canvas_state_app").addClass("canvas_state_appedit").off(".CANVAS_EVENT").on("mousedown.CANVAS_EVENT",".instance-volume, .instanceList-item-volume, .asgList-item-volume",MC.canvas.volume.show).on("mousedown.CANVAS_EVENT",".port",MC.canvas.event.appDrawConnection).on("mousedown.CANVAS_EVENT",".dragable",MC.canvas.event.dragable.mousedown).on("mousedown.CANVAS_EVENT",".group-resizer",MC.canvas.event.groupResize.mousedown).on("click.CANVAS_EVENT",".line",MC.canvas.event.selectLine).on("mousedown.CANVAS_EVENT",MC.canvas.event.clearSelected).on("mousedown.CANVAS_EVENT","#svg_canvas",MC.canvas.event.clickBlank).on("mouseenter.CANVAS_EVENT mouseleave.CANVAS_EVENT",".node",MC.canvas.event.nodeHover).on("selectstart.CANVAS_EVENT",!1).on("mousedown.CANVAS_EVENT",MC.canvas.event.ctrlMove.mousedown).on("mousedown.CANVAS_EVENT","#node-action-wrap",MC.canvas.nodeAction.popup):this.$el.find(".OEPanelCenter").removeClass("canvas_state_appedit").addClass("canvas_state_app").off(".CANVAS_EVENT").on("mousedown.CANVAS_EVENT",".instance-volume, .instanceList-item-volume, .asgList-item-volume",MC.canvas.volume.show).on("click.CANVAS_EVENT",".line",MC.canvas.event.selectLine).on("mousedown.CANVAS_EVENT",MC.canvas.event.clearSelected).on("mousedown.CANVAS_EVENT","#svg_canvas",MC.canvas.event.clickBlank).on("selectstart.CANVAS_EVENT",!1).on("mousedown.CANVAS_EVENT",".dragable",MC.canvas.event.selectNode).on("mousedown.CANVAS_EVENT",".AWS-AutoScaling-LaunchConfiguration .instance-number-group",MC.canvas.asgList.show).on("mousedown.CANVAS_EVENT",".AWS-EC2-Instance .instance-number-group",MC.canvas.instanceList.show).on("mousedown.CANVAS_EVENT",".AWS-VPC-NetworkInterface .eni-number-group",MC.canvas.eniList.show).on("mousedown.CANVAS_EVENT",MC.canvas.event.ctrlMove.mousedown).on("mousedown.CANVAS_EVENT","#node-action-wrap",MC.canvas.nodeAction.popup).on("mouseenter.CANVAS_EVENT mouseleave.CANVAS_EVENT",".node",MC.canvas.event.nodeHover)},confirmImport:function(){var e,t;t=this,e=new r({title:"App Imported",template:n.modal.confirmImport({name:this.workspace.opsModel.get("name")}),confirm:{text:"Done"},disableClose:!0,hideClose:!0,onCancel:function(){t.workspace.remove()},onConfirm:function(){var n,r;n=e.tpl.find("#ImportSaveAppName"),n.parsley("custom",function(e){var n;if(!MC.validate("awsName",e))return i.ide.PARSLEY_SHOULD_BE_A_VALID_STACK_NAME;n=App.model.appList().where({name:e});if(n.length===1&&n[0]===t.workspace.opsModel||n.length===0)return;return sprintf(i.ide.PARSLEY_TYPE_NAME_CONFLICT,"App",e)});if(!n.parsley("validate"))return;return e.tpl.find(".modal-confirm").attr("disabled","disabled"),r=t.workspace.design.serialize(),r.name=n.val(),r.usage=$("#app-usage-selectbox").find(".item.selected").attr("data-value")||"testing",t.workspace.opsModel.saveApp(r).then(function(){return t.workspace.design.set("name",r.name),e.close()},function(t){notification("error",t.msg),e.tpl.find(".modal-confirm").removeAttr("disabled")})}})},renderSubviews:function(){this.workspace.isAppEditMode()&&this.resourcePanel.render(),this.$el.find(".OEPanelLeft").toggleClass("force-hidden",!this.workspace.isAppEditMode()),this.statusbar.render(),this.toggleProcessing(),this.updateProgress()},toggleProcessing:function(){var e,r;if(!this.$el)return;this.toolbar.updateTbBtns(),this.statusbar.update(),this.$el.children(".ops-process").remove(),e=this.workspace.opsModel;if(!e.isProcessing())return;switch(e.get("state")){case t.State.Starting:r="Starting your app...";break;case t.State.Stopping:r="Stopping your app...";break;case t.State.Terminating:r="Terminating your app..";break;case t.State.Updating:r="Applying changes to your app...";break;default:void 0,r="Processing your request..."}this.__progress=0,this.$el.append(n.appProcessing(r))},updateProgress:function(){var e,t,n;t=this.workspace.opsModel.get("progress"),e=this.$el.find(".ops-process"),e.toggleClass("has-progess",!!t),this.__progress>t&&e.toggleClass("rolling-back",!0),this.__progress=t,n=""+t+"%",e.find(".process-info").text(n),e.find(".bar").css({width:n})},switchMode:function(e){MC.canvas.volume.close(),MC.canvas.instanceList.close(),MC.canvas.asgList.close(),this.toolbar.updateTbBtns(),this.statusbar.update(),this.$el.find(".OEPanelLeft").toggleClass("force-hidden",!e),e?this.resourcePanel.render():this.$el.find(".OEPanelLeft").empty(),this.propertyPanel.openPanel(),this.bindUserEvent()},emptyCanvas:function(){$("#vpc_layer, #az_layer, #subnet_layer, #asg_layer, #line_layer, #node_layer").empty()},showUpdateStatus:function(e,t){var r;this.$el.find(".ops-process").remove(),r=this,$(n.appUpdateStatus({error:e,loading:t})).appendTo(this.$el).find("#processDoneBtn").click(function(){return r.$el.find(".ops-process").remove()})}})})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define("workspaces/editor/AppEditor",["./StackEditor","./AppView","ResDiff","OpsModel","Design","CloudResources","constant"],function(e,n,r,i,s,o,u){var a;return a=function(a){function f(){return f.__super__.constructor.apply(this,arguments)}return t(f,a),f.prototype.title=function(){return((this.design||this.opsModel).get("name")||this.opsModel.get("importVpcId"))+" - app"},f.prototype.createView=function(){return new n({workspace:this})},f.prototype.tabClass=function(){switch(this.opsModel.get("state")){case i.State.Running:return"icon-app-running";case i.State.Stopped:return"icon-app-stopped";default:return"icon-app-pending"}},f.prototype.isReady=function(){return!!this.__hasAdditionalData},f.prototype.fetchAdditionalData=function(){var e,t,n;return t=this,e=this.opsModel.get("region"),n=this.opsModel.getJsonData().agent.module,Q.all([App.model.fetchStateModule(n.repo,n.tag),o(u.RESTYPE.AZ,e).fetch(),o(u.RESTYPE.SNAP,e).fetch(),o(u.RESTYPE.DHCP,e).fetch(),o("QuickStartAmi",e).fetch(),o("MyAmi",e).fetch(),o("FavoriteAmi",e).fetch(),this.loadVpcResource(),this.fetchAmiData()]).then(function(){var e,n;if(t.isRemoved())return;if(t.opsModel.isImported())return;if(!t.opsModel.testState(i.State.Running))return;n=t.opsModel.getJsonData(),e=t.opsModel.generateJsonFromRes(),t.differ=new r({old:n,"new":e,callback:function(e){return e?t.opsModel.saveApp(t.design.serialize()):(t.opsModel.__setJsonData(n),t.remove())}}),t.differ.getChangeInfo().hasResChange&&t.opsModel.__setJsonData(e)},function(e){if(e.error===286){t.view.showVpcNotExist(t.opsModel.get("name"),function(){return t.opsModel.terminate(!0)}),t.remove();return}throw e})},f.prototype.delayUntilAwake=function(e){this.isAwake()?e.call(this):(void 0,this.__calledUponWakeup=e)},f.prototype.awake=function(){e.prototype.awake.call(this),this.__calledUponWakeup&&(this.__calledUponWakeup.call(this),this.__calledUponWakeup=null)},f.prototype.isModified=function(){return this.isAppEditMode()&&this.design&&this.design.isModified()},f.prototype.isAppEditMode=function(){return!!this.__appEdit},f.prototype.initDesign=function(){if(this.opsModel.isImported()||this.differ&&this.differ.getChangeInfo().needUpdateLayout)MC.canvas.analysis(),this.opsModel.saveThumbnail();this.design.finishDeserialization()},f.prototype.initEditor=function(){this.differ&&this.differ.getChangeInfo().hasResChange&&(this.differ.render(),this.differ=null),this.opsModel.isImported()&&(this.updateTab(),this.view.confirmImport())},f.prototype.refreshResource=function(){},f.prototype.switchToEditMode=function(){if(this.isAppEditMode())return;this.__appEdit=!0,this.design.setMode(s.MODE.AppEdit),this.view.switchMode(!0)},f.prototype.cancelEditMode=function(e){var t;return t=e?!0:this.design.isModified(),t&&!e?!1:(this.__appEdit=!1,t?this.recreateDesign():this.design.setMode(s.MODE.App),this.view.switchMode(!1),!0)},f.prototype.recreateDesign=function(){this.view.emptyCanvas(),this.design.reload(this.opsModel),this.design.finishDeserialization()},f.prototype.loadVpcResource=function(){return o("OpsResource",this.opsModel.getVpcId()).init(this.opsModel.get("region")).fetchForce()},f.prototype.applyAppEdit=function(e,t){var n;if(!e){this.__appEdit=!1,this.design.setMode(s.MODE.App),this.view.switchMode(!1);return}return n=this,this.__applyingUpdate=!0,t=t&&!this.opsModel.testState(i.State.Stopped),this.opsModel.update(e,t).then(function(){return t?n.onAppEditDone():(n.view.showUpdateStatus("",!0),n.loadVpcResource().then(function(){return n.onAppEditDone()}))},function(e){var t;n.__applyingUpdate=!1,n.view.stopListening(n.opsModel,"change:progress",n.view.updateProgress),t=e.msg,e.result&&(t+="<br />"+e.result),n.view.showUpdateStatus(t)}),this.view.listenTo(this.opsModel,"change:progress",this.view.updateProgress),!0},f.prototype.onAppEditDone=function(){return this.delayUntilAwake(this.__onAppEditDone)},f.prototype.__onAppEditDone=function(){if(this.isRemoved())return;this.__appEdit=this.__applyingUpdate=!1,this.view.stopListening(this.opsModel,"change:progress",this.view.updateProgress),this.recreateDesign(),this.design.setMode(s.MODE.App),this.design.renderNode(),this.view.showUpdateStatus(),this.view.switchMode(!1),this.saveThumbnail(),this.view.showUpdateStatus()},f.prototype.onOpsModelStateChanged=function(){var t;if(!this.isInited())return;if(this.opsModel.testState(i.State.Saving))return;return this.updateTab(),this.opsModel.isProcessing()?this.view.toggleProcessing():!this.__applyingUpdate&&!this.opsModel.testState(i.State.Destroyed)&&(t=this,this.view.showUpdateStatus("",!0),this.loadVpcResource().then(function(){return t.delayUntilAwake(t.onVpcResLoaded)})),e.prototype.onOpsModelStateChanged.call(this)},f.prototype.onVpcResLoaded=function(){if(this.isRemoved())return;this.design.renderNode(),this.view.toggleProcessing()},f}(e),a})}.call(this),function(){define("workspaces/OpsEditor",["./editor/ProgressViewer","./editor/StackEditor","./editor/AppEditor","./editor/framework/DesignBundle"],function(e,t,n){var r;return r=function(r){if(!r)throw new Error("Cannot find opsmodel while openning workspace.");return r.isProcessing()?new e(r):r.isStack()?new t(r):new n(r)},r})}.call(this);