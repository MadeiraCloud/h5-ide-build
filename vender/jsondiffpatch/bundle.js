!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.jsondiffpatch=e()}}(function(){var e,t,n;return function r(e,t,n){function i(o,u){if(!t[o]){if(!e[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(s)return s(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=t[o]={exports:{}};e[o][0].call(f.exports,function(t){var n=e[o][1][t];return i(n?n:t)},f,f.exports,r,e,t,n)}return t[o].exports}var s=typeof require=="function"&&require;for(var o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){function i(){}var r=t.exports={};r.nextTick=function(){var e=typeof window!="undefined"&&window.setImmediate,t=typeof window!="undefined"&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||t===null)&&e.data==="process-tick"){e.stopPropagation();if(n.length>0){var r=n.shift();r()}}},!0),function(t){n.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=i,r.once=i,r.off=i,r.emit=i,r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],2:[function(e,t,n){var r=e("../pipe").Pipe,i=function(){};i.prototype.setResult=function(e){return this.result=e,this.hasResult=!0,this},i.prototype.exit=function(){return this.exiting=!0,this},i.prototype.switchTo=function(e,t){return typeof e=="string"||e instanceof r?this.nextPipe=e:(this.next=e,t&&(this.nextPipe=t)),this},i.prototype.push=function(e,t){return e.parent=this,typeof t!="undefined"&&(e.childName=t),e.root=this.root||this,e.options=e.options||this.options,this.children?(this.children[this.children.length-1].next=e,this.children.push(e)):(this.children=[e],this.nextAfterChildren=this.next||null,this.next=e),e.next=this,this},n.Context=i},{"../pipe":15}],3:[function(e,t,n){var r=e("./context").Context,i=function(t,n){this.left=t,this.right=n,this.pipe="diff"};i.prototype=new r,n.DiffContext=i},{"./context":2}],4:[function(e,t,n){var r=e("./context").Context,i=function(t,n){this.left=t,this.delta=n,this.pipe="patch"};i.prototype=new r,n.PatchContext=i},{"./context":2}],5:[function(e,t,n){var r=e("./context").Context,i=function(t){this.delta=t,this.pipe="reverse"};i.prototype=new r,n.ReverseContext=i},{"./context":2}],6:[function(e,t,n){t.exports=function(t,n){var r;if(typeof n=="string"){r=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+\-])(\d{2}):(\d{2}))$/.exec(n);if(r)return new Date(Date.UTC(+r[1],+r[2]-1,+r[3],+r[4],+r[5],+r[6],+(r[7]||0)))}return n}},{}],7:[function(e,t,n){var r=e("./processor").Processor,i=e("./pipe").Pipe,s=e("./contexts/diff").DiffContext,o=e("./contexts/patch").PatchContext,u=e("./contexts/reverse").ReverseContext,a=e("./filters/trivial"),f=e("./filters/nested"),l=e("./filters/arrays"),c=e("./filters/dates"),h=e("./filters/texts"),p=function(t){this.processor=new r(t),this.processor.pipe((new i("diff")).append(f.collectChildrenDiffFilter,a.diffFilter,c.diffFilter,h.diffFilter,f.objectsDiffFilter,l.diffFilter).shouldHaveResult()),this.processor.pipe((new i("patch")).append(f.collectChildrenPatchFilter,l.collectChildrenPatchFilter,a.patchFilter,h.patchFilter,f.patchFilter,l.patchFilter).shouldHaveResult()),this.processor.pipe((new i("reverse")).append(f.collectChildrenReverseFilter,l.collectChildrenReverseFilter,a.reverseFilter,h.reverseFilter,f.reverseFilter,l.reverseFilter).shouldHaveResult())};p.prototype.options=function(){return this.processor.options.apply(this.processor,arguments)},p.prototype.diff=function(e,t){return this.processor.process(new s(e,t))},p.prototype.patch=function(e,t){return this.processor.process(new o(e,t))},p.prototype.reverse=function(e){return this.processor.process(new u(e))},p.prototype.unpatch=function(e,t){return this.patch(e,this.reverse(t))},n.DiffPatcher=p},{"./contexts/diff":3,"./contexts/patch":4,"./contexts/reverse":5,"./filters/arrays":9,"./filters/dates":10,"./filters/nested":12,"./filters/texts":13,"./filters/trivial":14,"./pipe":15,"./processor":16}],8:[function(e,t,n){(function(t){var r=e("./diffpatcher").DiffPatcher;n.DiffPatcher=r,n.create=function(e){return new r(e)},n.dateReviver=e("./date-reviver");var i;n.diff=function(){return i||(i=new r),i.diff.apply(i,arguments)},n.patch=function(){return i||(i=new r),i.patch.apply(i,arguments)},n.unpatch=function(){return i||(i=new r),i.unpatch.apply(i,arguments)},n.reverse=function(){return i||(i=new r),i.reverse.apply(i,arguments)};var s=typeof t!="undefined"&&typeof t.execPath=="string";if(s){var o=e("./formatters/index");n.formatters=o,n.console=o.console}else n.homepage="https://github.com/benjamine/jsondiffpatch",n.version="0.1.6"}).call(this,e("/Users/Benja/proj/jsondiffpatch/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./date-reviver":6,"./diffpatcher":7,"/Users/Benja/proj/jsondiffpatch/node_modules/gulp-browserify/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":1}],9:[function(e,t,n){var r=e("../contexts/diff").DiffContext,i=e("../contexts/patch").PatchContext,s=e("../contexts/reverse").ReverseContext,o=e("./lcs"),u=3,a=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},f=typeof Array.prototype.indexOf=="function"?function(e,t){return e.indexOf(t)}:function(e,t){var n=e.length;for(var r=0;r<n;r++)if(e[r]===t)return r;return-1},l=function(t){if(!t.leftIsArray)return;var n=t.options&&t.options.objectHash,i=function(e,t,r,i,s){var o=e[r],u=t[i];if(o===u)return!0;if(typeof o!="object"||typeof u!="object")return!1;if(!n)return!1;var a,f;return typeof r=="number"?(s.hashCache1=s.hashCache1||[],a=s.hashCache1[r],typeof a=="undefined"&&(s.hashCache1[r]=a=n(o,r))):a=n(o),typeof a=="undefined"?!1:(typeof i=="number"?(s.hashCache2=s.hashCache2||[],f=s.hashCache2[i],typeof f=="undefined"&&(s.hashCache2[i]=f=n(u,i))):f=n(u),typeof f=="undefined"?!1:a===f)},s={},a=0,l=0,c,h,p,d=t.left,v=t.right,m=d.length,g=v.length,y;while(a<m&&a<g&&i(d,v,a,a,s))c=a,y=new r(t.left[c],t.right[c]),t.push(y,c),a++;while(l+a<m&&l+a<g&&i(d,v,m-1-l,g-1-l,s))h=m-1-l,p=g-1-l,y=new r(t.left[h],t.right[p]),t.push(y,p),l++;var b;if(a+l===m){if(m===g){t.setResult(undefined).exit();return}b=b||{_t:"a"};for(c=a;c<g-l;c++)b[c]=[v[c]];t.setResult(b).exit();return}if(a+l===g){b=b||{_t:"a"};for(c=a;c<m-l;c++)b["_"+c]=[d[c],0,0];t.setResult(b).exit();return}s={};var w=d.slice(a,m-l),E=v.slice(a,g-l),S=o.get(w,E,i,s),x=[];b=b||{_t:"a"};for(c=a;c<m-l;c++)f(S.indices1,c-a)<0&&(b["_"+c]=[d[c],0,0],x.push(c));var T=!0;t.options&&t.options.arrays&&t.options.arrays.detectMove===!1&&(T=!1);var N=!1;t.options&&t.options.arrays&&t.options.arrays.includeValueOnMove&&(N=!0);var C=x.length;for(c=a;c<g-l;c++){var k=f(S.indices2,c-a);if(k<0){var L=!1;if(T&&C>0)for(h=0;h<C;h++)if(i(w,E,x[h]-a,c-a,s)){b["_"+x[h]].splice(1,2,c,u),N||(b["_"+x[h]][0]=""),h=x[h],p=c,y=new r(t.left[h],t.right[p]),t.push(y,p),x.splice(h,1),L=!0;break}L||(b[c]=[v[c]])}else h=S.indices1[k]+a,p=S.indices2[k]+a,y=new r(t.left[h],t.right[p]),t.push(y,p)}t.setResult(b).exit()};l.filterName="arrays";var c={numerically:function(e,t){return e-t},numericallyBy:function(e){return function(t,n){return t[e]-n[e]}}},h=function(t){if(!t.nested)return;if(t.delta._t!=="a")return;var n,r,s=t.delta,o=t.left,a=[],f=[],l=[];for(n in s)if(n!=="_t")if(n[0]==="_"){if(s[n][2]!==0&&s[n][2]!==u)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+s[n][2]);a.push(parseInt(n.slice(1),10))}else s[n].length===1?f.push({index:parseInt(n,10),value:s[n][0]}):l.push({index:parseInt(n,10),delta:s[n]});a=a.sort(c.numerically);for(n=a.length-1;n>=0;n--){r=a[n];var h=s["_"+r],p=o.splice(r,1)[0];h[2]===u&&f.push({index:h[1],value:p})}f=f.sort(c.numericallyBy("index"));var d=f.length;for(n=0;n<d;n++){var v=f[n];o.splice(v.index,0,v.value)}var m=l.length,g;if(m>0)for(n=0;n<m;n++){var y=l[n];g=new i(t.left[y.index],y.delta),t.push(g,y.index)}if(!t.children){t.setResult(t.left).exit();return}t.exit()};h.filterName="arrays";var p=function(t){if(!t||!t.children)return;if(t.delta._t!=="a")return;var n=t.children.length,r;for(var i=0;i<n;i++)r=t.children[i],t.left[r.childName]=r.result;t.setResult(t.left).exit()};p.filterName="arraysCollectChildren";var d=function(t){if(!t.nested){t.delta[2]===u&&(t.newName="_"+t.delta[1],t.setResult([t.delta[0],parseInt(t.childName.substr(1),10),u]).exit());return}if(t.delta._t!=="a")return;var n,r;for(n in t.delta){if(n==="_t")continue;r=new s(t.delta[n]),t.push(r,n)}t.exit()};d.filterName="arrays";var v=function(e,t,n){var r=t;if(typeof t=="string"&&t[0]==="_")r=parseInt(t.substr(1),10);else{var i="_"+t;if(a(n)&&n[2]===0)r=i;else for(var s in e){var o=e[s];a(o)&&o[2]===u&&o[1].toString()===t&&(r=s.substr(1))}}return r},m=function(t){if(!t||!t.children)return;if(t.delta._t!=="a")return;var n=t.children.length,r,i={_t:"a"};for(var s=0;s<n;s++){r=t.children[s];var o=r.newName;typeof o=="undefined"&&(o=v(t.delta,r.childName,r.result)),i[o]!==r.result&&(i[o]=r.result)}t.setResult(i).exit()};m.filterName="arraysCollectChildren",n.diffFilter=l,n.patchFilter=h,n.collectChildrenPatchFilter=p,n.reverseFilter=d,n.collectChildrenReverseFilter=m},{"../contexts/diff":3,"../contexts/patch":4,"../contexts/reverse":5,"./lcs":11}],10:[function(e,t,n){var r=function(t){t.left instanceof Date?(t.right instanceof Date?t.left.getTime()!==t.right.getTime()?t.setResult([t.left,t.right]):t.setResult(undefined):t.setResult([t.left,t.right]),t.exit()):t.right instanceof Date&&t.setResult([t.left,t.right]).exit()};r.filterName="dates",n.diffFilter=r},{}],11:[function(e,t,n){var r=function(e,t,n,r){return e[n]===t[r]},i=function(e,t,n,r){var i=e.length,s=t.length,o,u,a=[i+1];for(o=0;o<i+1;o++){a[o]=[s+1];for(u=0;u<s+1;u++)a[o][u]=0}a.match=n;for(o=1;o<i+1;o++)for(u=1;u<s+1;u++)n(e,t,o-1,u-1,r)?a[o][u]=a[o-1][u-1]+1:a[o][u]=Math.max(a[o-1][u],a[o][u-1]);return a},s=function(e,t,n,r,i,o){if(r===0||i===0)return{sequence:[],indices1:[],indices2:[]};if(e.match(t,n,r-1,i-1,o)){var u=s(e,t,n,r-1,i-1,o);return u.sequence.push(t[r-1]),u.indices1.push(r-1),u.indices2.push(i-1),u}return e[r][i-1]>e[r-1][i]?s(e,t,n,r,i-1,o):s(e,t,n,r-1,i,o)},o=function(e,t,n,o){o=o||{};var u=i(e,t,n||r,o),a=s(u,e,t,e.length,t.length,o);return typeof e=="string"&&typeof t=="string"&&(a.sequence=a.sequence.join("")),a};n.get=o},{}],12:[function(e,t,n){var r=e("../contexts/diff").DiffContext,i=e("../contexts/patch").PatchContext,s=e("../contexts/reverse").ReverseContext,o=function(t){if(!t||!t.children)return;var n=t.children.length,r,i=t.result;for(var s=0;s<n;s++){r=t.children[s];if(typeof r.result=="undefined")continue;i=i||{},i[r.childName]=r.result}i&&t.leftIsArray&&(i._t="a"),t.setResult(i).exit()};o.filterName="collectChildren";var u=function(t){if(t.leftIsArray||t.leftType!=="object")return;var n,i;for(n in t.left)i=new r(t.left[n],t.right[n]),t.push(i,n);for(n in t.right)typeof t.left[n]=="undefined"&&(i=new r(undefined,t.right[n]),t.push(i,n));if(!t.children||t.children.length===0){t.setResult(undefined).exit();return}t.exit()};u.filterName="objects";var a=function(t){if(!t.nested)return;if(t.delta._t)return;var n,r;for(n in t.delta)r=new i(t.left[n],t.delta[n]),t.push(r,n);t.exit()};a.filterName="objects";var f=function(t){if(!t||!t.children)return;if(t.delta._t)return;var n=t.children.length,r;for(var i=0;i<n;i++)r=t.children[i],t.left[r.childName]!==r.result&&(t.left[r.childName]=r.result);t.setResult(t.left).exit()};f.filterName="collectChildren";var l=function(t){if(!t.nested)return;if(t.delta._t)return;var n,r;for(n in t.delta)r=new s(t.delta[n]),t.push(r,n);t.exit()};l.filterName="objects";var c=function(t){if(!t||!t.children)return;if(t.delta._t)return;var n=t.children.length,r,i={};for(var s=0;s<n;s++)r=t.children[s],i[r.childName]!==r.result&&(i[r.childName]=r.result);t.setResult(i).exit()};c.filterName="collectChildren",n.collectChildrenDiffFilter=o,n.objectsDiffFilter=u,n.patchFilter=a,n.collectChildrenPatchFilter=f,n.reverseFilter=l,n.collectChildrenReverseFilter=c},{"../contexts/diff":3,"../contexts/patch":4,"../contexts/reverse":5}],13:[function(e,t,n){var r=2,i=60,s=null,o=function(){if(!s){var t;if(typeof diff_match_patch!="undefined")t=new diff_match_patch;else if(typeof e=="function"){var n=e("../../external/diff_match_patch_uncompressed");t=new n.diff_match_patch}if(!t){var r=new Error("text diff_match_patch library not found");throw r.diff_match_patch_not_found=!0,r}s={diff:function(e,n){return t.patch_toText(t.patch_make(e,n))},patch:function(e,n){var r=t.patch_apply(t.patch_fromText(n),e);for(var i=0;i<r[1].length;i++)if(!r[1][i]){var s=new Error("text patch failed");s.textPatchFailed=!0}return r[0]}}}return s},u=function(t){if(t.leftType!=="string")return;var n=t.options&&t.options.textDiff&&t.options.textDiff.minLength||i;if(t.left.length<n||t.right.length<n){t.setResult([t.left,t.right]).exit();return}var s=o().diff;t.setResult([s(t.left,t.right),0,r]).exit()};u.filterName="texts";var a=function(t){if(t.nested)return;if(t.delta[2]!==r)return;var n=o().patch;t.setResult(n(t.left,t.delta[0])).exit()};a.filterName="texts";var f=function(e){var t,n,r,i,s,o=null,u=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/,a,f,l;r=e.split("\n");for(t=0,n=r.length;t<n;t++){i=r[t];var c=i.slice(0,1);c==="@"?(o=u.exec(i),a=t,f=null,l=null,r[a]="@@ -"+o[3]+","+o[4]+" +"+o[1]+","+o[2]+" @@"):c==="+"?(f=t,r[t]="-"+r[t].slice(1),r[t-1].slice(0,1)==="+"&&(s=r[t],r[t]=r[t-1],r[t-1]=s)):c==="-"&&(l=t,r[t]="+"+r[t].slice(1))}return r.join("\n")},l=function(t){if(t.nested)return;if(t.delta[2]!==r)return;t.setResult([f(t.delta[0]),0,r]).exit()};l.filterName="texts",n.diffFilter=u,n.patchFilter=a,n.reverseFilter=l},{}],14:[function(e,t,n){var r=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},i=function(t){if(t.left===t.right){t.setResult(undefined).exit();return}if(typeof t.left=="undefined"){if(typeof t.right=="function")throw new Error("functions are not supported");t.setResult([t.right]).exit();return}if(typeof t.right=="undefined"){t.setResult([t.left,0,0]).exit();return}if(typeof t.left=="function"||typeof t.right=="function")throw new Error("functions are not supported");t.leftType=t.left===null?"null":typeof t.left,t.rightType=t.right===null?"null":typeof t.right;if(t.leftType!==t.rightType){t.setResult([t.left,t.right]).exit();return}if(t.leftType==="boolean"||t.leftType==="number"){t.setResult([t.left,t.right]).exit();return}t.leftType==="object"&&(t.leftIsArray=r(t.left)),t.rightType==="object"&&(t.rightIsArray=r(t.right));if(t.leftIsArray!==t.rightIsArray){t.setResult([t.left,t.right]).exit();return}};i.filterName="trivial";var s=function(t){if(typeof t.delta=="undefined"){t.setResult(t.left).exit();return}t.nested=!r(t.delta);if(t.nested)return;if(t.delta.length===1){t.setResult(t.delta[0]).exit();return}if(t.delta.length===2){t.setResult(t.delta[1]).exit();return}if(t.delta.length===3&&t.delta[2]===0){t.setResult(undefined).exit();return}};s.filterName="trivial";var o=function(t){if(typeof t.delta=="undefined"){t.setResult(t.delta).exit();return}t.nested=!r(t.delta);if(t.nested)return;if(t.delta.length===1){t.setResult([t.delta[0],0,0]).exit();return}if(t.delta.length===2){t.setResult([t.delta[1],t.delta[0]]).exit();return}if(t.delta.length===3&&t.delta[2]===0){t.setResult([t.delta[0]]).exit();return}};o.filterName="trivial",n.diffFilter=i,n.patchFilter=s,n.reverseFilter=o},{}],15:[function(e,t,n){var r=function(t){this.name=t,this.filters=[]};r.prototype.process=function(e){if(!this.processor)throw new Error("add this pipe to a processor before using it");var t=this.debug,n=this.filters.length,r=e;for(var i=0;i<n;i++){var s=this.filters[i];t&&this.log("filter: "+s.filterName),s(r);if(typeof r=="object"&&r.exiting){r.exiting=!1;break}}!r.next&&this.resultCheck&&this.resultCheck(r)},r.prototype.log=function(e){console.log("[jsondiffpatch] "+this.name+" pipe, "+e)},r.prototype.append=function(){return this.filters.push.apply(this.filters,arguments),this},r.prototype.prepend=function(){return this.filters.unshift.apply(this.filters,arguments),this},r.prototype.indexOf=function(e){if(!e)throw new Error("a filter name is required");for(var t=0;t<this.filters.length;t++){var n=this.filters[t];if(n.filterName===e)return t}throw new Error("filter not found: "+e)},r.prototype.list=function(){var e=[];for(var t=0;t<this.filters.length;t++){var n=this.filters[t];e.push(n.filterName)}return e},r.prototype.after=function(e){var t=this.indexOf(e),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(t+1,0),Array.prototype.splice.apply(this.filters,n),this},r.prototype.before=function(e){var t=this.indexOf(e),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(t,0),Array.prototype.splice.apply(this.filters,n),this},r.prototype.clear=function(){return this.filters.length=0,this},r.prototype.shouldHaveResult=function(should){if(should===!1){this.resultCheck=null;return}if(this.resultCheck)return;var e=this;return this.resultCheck=function(t){if(!t.hasResult){console.log(t);var n=new Error(e.name+" failed");throw n.noResult=!0,n}},this},n.Pipe=r},{}],16:[function(e,t,n){var r=function(t){this.selfOptions=t,this.pipes={}};r.prototype.options=function(e){return e&&(this.selfOptions=e),this.selfOptions},r.prototype.pipe=function(e,t){if(typeof e=="string"){if(typeof t=="undefined")return this.pipes[e];this.pipes[e]=t}if(e&&e.name){t=e;if(t.processor===this)return t;this.pipes[t.name]=t}return t.processor=this,t},r.prototype.process=function(e,t){var n=e;n.options=this.options();var r=t||e.pipe||"default",i,s;while(r)typeof n.nextAfterChildren!="undefined"&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),typeof r=="string"&&(r=this.pipe(r)),r.process(n),s=n,i=r,r=null,n&&n.next&&(n=n.next,r=s.nextPipe||n.pipe||i);return n.hasResult?n.result:undefined},n.Processor=r},{}]},{},[8])(8)});