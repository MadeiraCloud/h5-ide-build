(function(){define("ide/Websocket",["Meteor","backbone","event","MC"],function(e,t,n){var r,i,s;return r=""+MC.API_HOST+"/ws/",e._debug=function(){return console.log.apply(console,arguments)},s=null,i=function(){var t;return s?s:(s=this,this.__readyDefer=Q.defer(),this.__isReady=!1,this.connection=e.connect(r,!0),t={connection:this.connection},this.collection={request:new e.Collection("request",t),request_detail:new e.Collection("request_detail",t),stack:new e.Collection("stack",t),app:new e.Collection("app",t),status:new e.Collection("status",t),imports:new e.Collection("imports",t)},Deps.autorun(function(e){return function(){return e.statusChanged()}}(this)),this.subscribe(),this.pipeChanges(),setTimeout(function(e){return function(){e.shouldNotify=!0;if(!e.connection.status.connected)return e.statusChanged()}}(this),5e3),this)},i.prototype.statusChanged=function(){var e;e=this.connection.status().connected,e&&(this.shouldNotify=!0);if(!this.shouldNotify)return;return this.trigger("StatusChanged",e)},i.prototype.subscribe=function(){var e,t,n,r,i;if(this.subscribed)return;r=!0,t=function(){return this.__isReady=!0,this.__readyDefer.resolve()},i=App.user.get("usercode"),n=App.user.get("session"),e={onReady:_.bind(t,this),onError:_.bind(this.onError,this)},this.connection.subscribe("request",i,n,e),this.connection.subscribe("stack",i,n),this.connection.subscribe("app",i,n),this.connection.subscribe("status",i,n),this.connection.subscribe("imports",i,n)},i.prototype.ready=function(){return this.__readyDefer.promise},i.prototype.isReady=function(){return this.__isReady},i.prototype.onError=function(e){void 0,this.subscribed=!1,this.trigger("Disconnected")},i.prototype.pipeChanges=function(){var e;return e=this,this.collection.request.find().fetch(),this.collection.request.find().observeChanges({added:function(t,n){return e.trigger("requestChange",t,n)},changed:function(t,n){return e.trigger("requestChange",t,n)}}),this.collection.imports.find().fetch(),this.collection.imports.find().observe({added:function(t,n){return e.trigger("visualizeUpdate",t)},changed:function(t,n){return e.trigger("visualizeUpdate",t)}}),this.collection.status.find().fetch(),this.collection.status.find().observe({added:function(e,t){return n.trigger(n.UPDATE_STATE_STATUS_DATA,"add",e,t),n.trigger(n.UPDATE_STATE_STATUS_DATA_TO_EDITOR,e?[e.res_id]:[])},changed:function(e,t){return n.trigger(n.UPDATE_STATE_STATUS_DATA,"change",e,t),n.trigger(n.UPDATE_STATE_STATUS_DATA_TO_EDITOR,e?[e.res_id]:[])}})},_.extend(i.prototype,t.Events),i})}).call(this),define("ide/subviews/SessionDialogTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<section style="width:400px;" class="invalid-session" id="SessionDialog">\r\n  <div class="confirmSession">\r\n  <div class="modal-header"><h3>Invalid Session</h3></div>\r\n\r\n  <article class="modal-body">\r\n    <div class="modal-text-major"> <p>Your account has signed in from other location or you last login has timed out.</p> <p>Would you like to reconnect this session or close it?</p> </div>\r\n    <div class="modal-text-minor">If you have unsaved changes, close this session will cause all your change to lose.</div>\r\n  </article>\r\n\r\n  <footer class="modal-footer">\r\n    <button id="SessionReconnect" class="btn btn-blue">Reconnect</button>\r\n    <button id="SessionClose" class="btn btn-silver">Close Session</button>\r\n  </footer>\r\n  </div>\r\n\r\n  <div class="reconnectSession" style="display:none;">\r\n  <div class="modal-header"><h3>Reconnect Session</h3></div>\r\n  <article class="modal-body">\r\n    <div class="modal-text-major">Please provide your password to reconnect:</div>\r\n    <div class="modal-input">\r\n      <input type="password" id="SessionPassword" class="input" placeholder="Password" style="width:200px;" autofocus>\r\n    </div>\r\n  </article>\r\n  <footer class="modal-footer">\r\n    <button id="SessionConnect" class="btn btn-blue" disabled>Connect</button>\r\n    <button id="SessionClose2" class="btn btn-red">Close Session</button>\r\n  </footer>\r\n  </div>\r\n</section>'};return e.template(t)}),function(){define("ide/subviews/SessionDialog",["i18n!/nls/lang.js","./SessionDialogTpl","backbone"],function(e,t){var n,r;return n=null,r=Backbone.View.extend({events:{"click #SessionReconnect":"showReconnect","click #SessionClose":"closeSession","click #SessionClose2":"closeSession","click #SessionConnect":"connect","keyup #SessionPassword":"passwordChanged"},constructor:function(){return n?n:(n=this,this.defer=Q.defer(),modal(t(),!1),this.setElement($("#modal-wrap")))},promise:function(){return this.defer.promise},showReconnect:function(){$(".invalid-session .confirmSession").hide(),$(".invalid-session .reconnectSession").show()},closeSession:function(){return App.logout()},connect:function(){if($("#SessionConnect").is(":disabled"))return;return $("#SessionConnect").attr("disabled","disabled"),App.user.acquireSession($("#SessionPassword").val()).then(function(e){return function(){e.remove(),e.defer.resolve()}}(this),function(t){$("#SessionConnect").removeAttr("disabled"),notification("error",e.ide.NOTIFY_MSG_WARN_AUTH_FAILED),$("#SessionPassword").toggleClass("parsley-error",!0)})},passwordChanged:function(e){$("#SessionPassword").toggleClass("parsley-error",!1),($("#SessionPassword").val()||"").length>=6?$("#SessionConnect").removeAttr("disabled"):$("#SessionConnect").attr("disabled","disabled"),e.which===13&&this.connect()}}),r})}.call(this),define("ide/subviews/HeaderTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<nav id="header">\r\n  <a id="support" class="icon-support" href="mailto:3rp02j1w@incoming.intercom.io" target="_blank">Support</a>\r\n\r\n  <section class="dropdown" >\r\n    <div id="HeaderNotification" class="js-toggle-dropdown">\r\n      <i class="icon-notification"></i>\r\n      <span id="NotificationCounter"></span>\r\n    </div>\r\n\r\n    <div class="dropdown-menu">\r\n      <div id="notification-panel-wrapper" class="scroll-wrap">\r\n        <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\r\n        <ul class="scroll-content"></ul>\r\n\r\n        <div class="notification-empty">\r\n          <div class="title">'+u(n.i18n.call(t,"HEAD_LABEL_BLANK_NOTIFICATION",{hash:{},data:i}))+'</div>\r\n          <div class="description">'+u(n.i18n.call(t,"HEAD_LABEL_BLANK_NOTIFICATION_DESC",{hash:{},data:i}))+'</div>\r\n        </div>\r\n      </div>\r\n\r\n    </div>\r\n  </section>\r\n\r\n  <section class="dropdown">\r\n    <div id="HeaderUser" class="js-toggle-dropdown tooltip" data-tooltip="'+u((o=t&&t.user_email,typeof o===a?o.apply(t):o))+'">\r\n      <span class="truncate left" style="max-width:100px;">'+u((o=t&&t.user_name,typeof o===a?o.apply(t):o))+'</span>\r\n      <i class="icon-caret-down"></i>\r\n    </div>\r\n\r\n    <ul class="dropdown-menu">\r\n      <li id="HeaderShortcuts">'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_KEY_SHORT",{hash:{},data:i}))+'</li>\r\n      <li><a class="dis-blk" href="http://docs.visualops.io" target="_blank" >'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_DOC",{hash:{},data:i}))+'</a></li>\r\n      <li id="HeaderSettings">'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_SETTING",{hash:{},data:i}))+'</li>\r\n      <li id="HeaderLogout">'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_LOGOUT",{hash:{},data:i}))+"</li>\r\n    </ul>\r\n  </section>\r\n</nav>",s};return e.template(t)}),define("ide/subviews/SettingsDialogTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){return'style="display:block;"'}function c(e,t){var r="";return r+='\r\n        <button id="CredSetupRemove" class="link-style">'+u(n.i18n.call(e,"SETTINGS_LABEL_REMOVE_CREDENTIAL",{hash:{},data:t}))+"</button>\r\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<div class="modal-header">\r\n  <h3>'+u(n.i18n.call(t,"HEAD_LABEL_SETTING",{hash:{},data:i}))+'</h3><i class="modal-close">&times;</i>\r\n</div>\r\n\r\n<nav id="SettingsNav">\r\n  <span data-target="AccountTab">'+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT",{hash:{},data:i}))+'</span>\r\n  <span data-target="CredentialTab">'+u(n.i18n.call(t,"HEAD_LABEL_CREDENTIAL",{hash:{},data:i}))+'</span>\r\n  <span data-target="TokenTab">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCESSTOKEN",{hash:{},data:i}))+'</span>\r\n</nav>\r\n\r\n<div class="modal-body" id="SettingsBody">\r\n  <section id="AccountTab">\r\n    <dl class="dl-horizontal">\r\n      <dt>'+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT_USERNAME",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.username,typeof o===a?o.apply(t):o))+"</dd>\r\n      <dt>"+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT_EMAIL",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.email,typeof o===a?o.apply(t):o))+'</dd>\r\n    </dl>\r\n\r\n    <button id="AccountPwd" class="link-style">'+u(n.i18n.call(t,"HEAD_LABEL_CHANGE_PASSWORD",{hash:{},data:i}))+'</button>\r\n    <div id="AccountPwdWrap">\r\n\r\n      <dl class="dl-horizontal">\r\n        <dt>'+u(n.i18n.call(t,"HEAD_LABEL_CURRENT_PASSWORD",{hash:{},data:i}))+'</dt>\r\n        <dd><input type="password" class="input" id="AccountCurrentPwd" /></dd>\r\n\r\n        <dt>'+u(n.i18n.call(t,"HAED_LABEL_NEW_PASSWORD",{hash:{},data:i}))+'</dt>\r\n        <dd><input type="password" class="input" id="AccountNewPwd" /></dd>\r\n      </dl>\r\n\r\n      <div id="AccountInfo" class="empty-hide"></div>\r\n\r\n      <div id="AccountPwdBtns">\r\n        <button class="btn btn-blue" id="AccountUpdatePwd" disabled>'+u(n.i18n.call(t,"HEAD_BTN_UPDATE",{hash:{},data:i}))+'</button>\r\n        <span id="AccountCancelPwd" class="link-style">'+u(n.i18n.call(t,"HEAD_BTN_CANCEL",{hash:{},data:i}))+'</span>\r\n      </div>\r\n    </div>\r\n  </section>\r\n\r\n  <section id="CredentialTab">\r\n    <div id="CredDemoWrap" ',o=n.unless.call(t,t&&t.account,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+=">\r\n      <h3>"+u(n.i18n.call(t,"SETTINGS_CRED_DEMO_TIT",{hash:{},data:i}))+"</h3>\r\n      <p>"+u(n.i18n.call(t,"SETTINGS_CRED_DEMO_TEXT",{hash:{},data:i}))+'</p>\r\n      <p class="tac"><button class="btn btn-blue cred-setup">'+u(n.i18n.call(t,"SETTINGS_CRED_DEMO_SETUP",{hash:{},data:i}))+'</button></p>\r\n    </div>\r\n\r\n    <div id="CredAwsWrap" class="pos-r" ',o=n["if"].call(t,t&&t.account,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+=">\r\n      <h3>"+u(n.i18n.call(t,"SETTINGS_CRED_CONNECTED_TIT",{hash:{},data:i}))+'</h3>\r\n      <button class="cred-setup link-style">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_UPDATE",{hash:{},data:i}))+'</button>\r\n      <dl class="dl-horizontal cred-setup-msg" style="margin-top:15px;">\r\n        <dt>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNTID",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.account,typeof o===a?o.apply(t):o))+"</dd>\r\n        <dt>"+u(n.i18n.call(t,"SETTINGS_LABEL_ACCESSKEY",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.awsAccessKey,typeof o===a?o.apply(t):o))+"</dd>\r\n        <dt>"+u(n.i18n.call(t,"SETTINGS_LABEL_SECRETKEY",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.awsSecretKey,typeof o===a?o.apply(t):o))+'</dd>\r\n      </dl>\r\n    </div>\r\n\r\n    <div id="CredSetupWrap">\r\n      <div id="CredSetupMsg" class="cred-setup-msg empty-hide"></div>\r\n      <ul>\r\n        <li>\r\n          <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_ACCOUNTID",{hash:{},data:i}))+'"></i>\r\n          <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNTID",{hash:{},data:i}))+'</label>\r\n          <input autocomplete="off" class="input" id="CredSetupAccount" type="text" value="'+u((o=t&&t.account,typeof o===a?o.apply(t):o))+'">\r\n        </li>\r\n        <li>\r\n          <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_ACCESSKEY",{hash:{},data:i}))+'"></i>\r\n          <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCESSKEY",{hash:{},data:i}))+'</label>\r\n          <input autocomplete="off" class="input" id="CredSetupAccessKey" type="text" placeholder="'+u((o=t&&t.awsAccessKey,typeof o===a?o.apply(t):o))+'">\r\n        </li>\r\n        <li>\r\n          <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_SECRETKEY",{hash:{},data:i}))+'"></i>\r\n          <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_SECRETKEY",{hash:{},data:i}))+'</label>\r\n          <input autocomplete="off" class="input" id="CredSetupSecretKey" type="password" placeholder="'+u((o=t&&t.awsSecretKey,typeof o===a?o.apply(t):o))+'">\r\n        </li>\r\n      </ul>\r\n\r\n      <div class="cred-btn-wrap clearfix">\r\n        ',o=n.unless.call(t,t&&t.credNeeded,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='\r\n        <button class="right link-style cred-setup-cancel">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_CANCEL",{hash:{},data:i}))+'</button>\r\n        <button id="CredSetupSubmit" class="btn btn-blue right">'+u(n.i18n.call(t,"HEAD_BTN_SUBMIT",{hash:{},data:i}))+'</button>\r\n      </div>\r\n\r\n    </div>\r\n\r\n    <div id="CredRemoveWrap">\r\n      <h3>'+u((o=t&&t.credRemoveTitle,typeof o===a?o.apply(t):o))+"</h3>\r\n      <div>"+u(n.i18n.call(t,"SETTINGS_CRED_REMOVE_TEXT",{hash:{},data:i}))+'</div>\r\n      <div class="cred-btn-wrap clearfix">\r\n        <button class="right link-style cred-cancel">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_CANCEL",{hash:{},data:i}))+'</button>\r\n        <button id="CredRemoveConfirm" class="btn btn-red right">'+u(n.i18n.call(t,"SETTINGS_LABEL_REMOVE_CREDENTIAL",{hash:{},data:i}))+'</button>\r\n      </div>\r\n    </div>\r\n\r\n    <div id="CredConfirmWrap">\r\n      <h3>'+u(n.i18n.call(t,"SETTINGS_CRED_UPDATE_CONFIRM_TIT",{hash:{},data:i}))+"</h3>\r\n      <div>"+u(n.i18n.call(t,"SETTINGS_CRED_UPDATE_CONFIRM_TEXT",{hash:{},data:i}))+'</div>\r\n      <div class="cred-btn-wrap clearfix">\r\n        <button class="right link-style cred-cancel">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_CANCEL",{hash:{},data:i}))+'</button>\r\n        <button id="CredSetupConfirm" class="btn btn-red right">'+u(n.i18n.call(t,"SETTINGS_LABEL_UPDATE_CONFIRM",{hash:{},data:i}))+'</button>\r\n      </div>\r\n    </div>\r\n\r\n    <div id="CredRemoving"><p>'+u(n.i18n.call(t,"SETTINGS_CRED_REMOVING",{hash:{},data:i}))+'</p><div class="loading-spinner"></div></div>\r\n    <div id="CredUpdating"><p>'+u(n.i18n.call(t,"SETTINGS_CRED_UPDATING",{hash:{},data:i}))+'</p><div class="loading-spinner"></div></div>\r\n\r\n  </section>\r\n\r\n  <section id="TokenTab">\r\n    <div id="TokenManager">\r\n      <p class="clearfix"> <button class="btn btn-blue right" id="TokenCreate">'+u(n.i18n.call(t,"SETTINGS_BTN_TOKEN_CREATE",{hash:{},data:i}))+"</button>"+u(n.i18n.call(t,"SETTINGS_INFO_TOKEN",{hash:{},data:i}))+'<!--<a href="" target="_blank">'+u(n.i18n.call(t,"SETTINGS_INFO_TOKEN_LINK",{hash:{},data:i}))+'</a>--> </p>\r\n      <section class="token-table">\r\n        <header class="clearfix">\r\n          <span class="tokenName">'+u(n.i18n.call(t,"SETTINGS_LABEL_TOKENTABLE_NAME",{hash:{},data:i}))+'</span>\r\n          <span class="tokenToken">'+u(n.i18n.call(t,"SETTINGS_LABEL_TOKENTABLE_TOKEN",{hash:{},data:i}))+'</span>\r\n        </header>\r\n        <div class="scroll-wrap">\r\n          <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\r\n          <ul id="TokenList" class="scroll-content" data-empty="'+u(n.i18n.call(t,"SETTINGS_INFO_TOKEN_EMPTY",{hash:{},data:i}))+'"></ul>\r\n        </div>\r\n      </section>\r\n    </div>\r\n    <div id="TokenRmConfirm" class="hide">\r\n      <h3 id="TokenRmTit"></h3>\r\n      <p>'+u(n.i18n.call(t,"SETTINGS_CONFIRM_TOKEN_RM",{hash:{},data:i}))+'</p>\r\n      <div class="cred-btn-wrap clearfix">\r\n        <button class="right link-style" id="TokenRmCancel">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_CANCEL",{hash:{},data:i}))+'</button>\r\n        <button id="TokenRemove" class="btn btn-red right">'+u(n.i18n.call(t,"SETTINGS_BTN_TOKEN_REMOVE",{hash:{},data:i}))+"</button>\r\n      </div>\r\n    </div>\r\n  </section>\r\n</div>",s};return e.template(t)}),function(){define("ide/subviews/SettingsDialog",["./SettingsDialogTpl","i18n!/nls/lang.js","ApiRequest","backbone"],function(e,t,n){var r;return r=Backbone.View.extend({events:{"click #SettingsNav span":"switchTab","click #AccountPwd":"showPwd","click #AccountCancelPwd":"hidePwd","click #AccountUpdatePwd":"changePwd","click .cred-setup, .cred-cancel":"showCredSetup","click .cred-setup-cancel":"cancelCredSetup","click #CredSetupRemove":"showRemoveCred","click #CredRemoveConfirm":"removeCred","click #CredSetupSubmit":"submitCred","click #CredSetupConfirm":"confirmCred","click #TokenCreate":"createToken","click .tokenControl .icon-edit":"editToken","click .tokenControl .icon-delete":"removeToken","click .tokenControl .tokenDone":"doneEditToken","click #TokenRemove":"confirmRmToken","click #TokenRmCancel":"cancelRmToken","keyup  #CredSetupAccount, #CredSetupAccessKey, #CredSetupSecretKey":"updateSubmitBtn","change #CredSetupAccount, #CredSetupAccessKey, #CredSetupSecretKey":"updateSubmitBtn","change #AccountCurrentPwd, #AccountNewPwd":"updatePwdBtn","keyup  #AccountCurrentPwd, #AccountNewPwd":"updatePwdBtn"},initialize:function(n){var i,s;i={username:App.user.get("username"),email:App.user.get("email"),account:App.user.get("account"),awsAccessKey:App.user.get("awsAccessKey"),awsSecretKey:App.user.get("awsSecretKey"),credRemoveTitle:sprintf(t.ide.SETTINGS_CRED_REMOVE_TIT,App.user.get("username")),credNeeded:!!App.model.appList().length},modal(e(i)),this.setElement($("#modal-box")),s=0,n&&(s=n.defaultTab||0,s===r.TAB.CredentialInvalid&&(this.showCredSetup(),$(".modal-close").hide(),$("#CredSetupMsg").text(t.ide.SETTINGS_ERR_CRED_VALIDATE)),s<0&&(s=Math.abs(s))),$("#SettingsNav").children().eq(s).click(),this.updateTokenTab()},updateCredSettings:function(){var n;return n={username:App.user.get("username"),email:App.user.get("email"),account:App.user.get("account"),awsAccessKey:App.user.get("awsAccessKey"),awsSecretKey:App.user.get("awsSecretKey"),credRemoveTitle:sprintf(t.ide.SETTINGS_CRED_REMOVE_TIT,App.user.get("username"))},$("#modal-box").html(e(n)),$("#SettingsNav").children().eq(r.TAB.Credential).click()},switchTab:function(e){var t;t=$(e.currentTarget);if(t.hasClass("selected"))return;$("#SettingsBody").children().hide(),$("#SettingsNav").children().removeClass("selected"),$("#"+t.addClass("selected").attr("data-target")).show()},showPwd:function(){$("#AccountPwd").hide(),$("#AccountPwdWrap").show(),$("#AccountCurrentPwd").focus()},hidePwd:function(){$("#AccountPwd").show(),$("#AccountPwdWrap").hide(),$("#AccountCurrentPwd, #AccountNewPwd").val(""),$("#AccountInfo").empty()},updatePwdBtn:function(){var e,t;t=$("#AccountCurrentPwd").val()||"",e=$("#AccountNewPwd").val()||"",t.length&&e.length?$("#AccountUpdatePwd").removeAttr("disabled"):$("#AccountUpdatePwd").attr("disabled","disabled")},changePwd:function(){var e,n;n=$("#AccountCurrentPwd").val()||"",e=$("#AccountNewPwd").val()||"";if(e.length<6){$("#AccountInfo").text(t.ide.SETTINGS_ERR_INVALID_PWD);return}$("#AccountInfo").empty(),$("#AccountUpdatePwd").attr("disabled","disabled"),App.user.changePassword(n,e).then(function(){notification("info",t.ide.SETTINGS_UPDATE_PWD_SUCCESS),$("#AccountCancelPwd").click(),$("#AccountUpdatePwd").removeAttr("disabled")},function(e){return e.error===2?$("#AccountInfo").html(""+t.ide.SETTINGS_ERR_WRONG_PWD+" <a href='/reset/' target='_blank'>"+t.ide.SETTINGS_INFO_FORGET_PWD+"</a>"):$("#AccountInfo").text(t.ide.SETTINGS_UPDATE_PWD_FAILURE),$("#AccountUpdatePwd").removeAttr("disabled")})},showCredSetup:function(){$("#CredentialTab").children().hide(),$("#CredSetupWrap").show(),$("#CredSetupAccount").focus()[0].select(),$("#CredSetupRemove").toggle(App.user.hasCredential()),this.updateSubmitBtn()},cancelCredSetup:function(){$("#CredentialTab").children().hide(),App.user.hasCredential()?$("#CredAwsWrap").show():$("#CredDemoWrap").show()},showRemoveCred:function(){$("#CredentialTab").children().hide(),$("#CredRemoveWrap").show()},removeCred:function(){var e;$("#CredentialTab").children().hide(),$("#CredRemoving").show(),$("#modal-box .modal-close").hide(),e=this,App.user.changeCredential().then(function(){e.updateCredSettings()},function(){return $("#CredSetupMsg").text(t.ide.SETTINGS_ERR_CRED_REMOVE),$("#modal-box .modal-close").show(),e.showCredSetup()})},updateSubmitBtn:function(){var e,t,n;t=$("#CredSetupAccount").val(),e=$("#CredSetupAccessKey").val(),n=$("#CredSetupSecretKey").val(),t.length&&e.length&&n.length?$("#CredSetupSubmit").removeAttr("disabled"):$("#CredSetupSubmit").attr("disabled","disabled")},submitCred:function(){var e,n,r;return $("#CredentialTab").children().hide(),$("#CredUpdating").show(),$("#modal-box .modal-close").hide(),e=$("#CredSetupAccessKey").val(),n=$("#CredSetupSecretKey").val(),r=this,App.user.validateCredential(e,n).then(function(){r.setCred()},function(){$("#CredSetupMsg").text(t.ide.SETTINGS_ERR_CRED_VALIDATE),$("#modal-box .modal-close").show(),r.showCredSetup()})},setCred:function(){var e,t,r,i;return t=$("#CredSetupAccount").val(),e=$("#CredSetupAccessKey").val(),r=$("#CredSetupSecretKey").val(),t==="demo_account"&&(t="user_demo_account",$("#CredSetupAccount").val(t)),i=this,App.user.changeCredential(t,e,r,!1).then(function(){return i.updateCredSettings()},function(e){e.error===n.Errors.ChangeCredConfirm?i.showCredConfirm():i.showCredUpdateFail()})},showCredUpdateFail:function(){return $("#CredSetupMsg").text(t.ide.SETTINGS_ERR_CRED_UPDATE),$("#modal-box .modal-close").show(),this.showCredSetup()},showCredConfirm:function(){return $("#CredentialTab").children().hide(),$("#CredConfirmWrap").show(),$("#modal-box .modal-close").show()},confirmCred:function(){var e,t,n,r;t=$("#CredSetupAccount").val(),e=$("#CredSetupAccessKey").val(),n=$("#CredSetupSecretKey").val(),r=this,App.user.changeCredential(t,e,n,!0).then(function(){return r.updateCredSettings()},function(){return r.showCredUpdateFail()})},editToken:function(e){var t,n;n=$(e.currentTarget),t=n.closest("li").toggleClass("editing",!0),t.children(".tokenName").removeAttr("readonly").focus().select()},removeToken:function(e){var n,r;n=$(e.currentTarget).closest("li"),r=n.children(".tokenName").val(),this.rmToken=n.children(".tokenToken").text(),$("#TokenManager").hide(),$("#TokenRmConfirm").show(),$("#TokenRmTit").text(sprintf(t.ide.SETTINGS_CONFIRM_TOKEN_RM_TIT,r))},createToken:function(){var e;$("#TokenCreate").attr("disabled","disabled"),e=this,App.user.createToken().then(function(){return e.updateTokenTab(),$("#TokenCreate").removeAttr("disabled")},function(){return notification("error","Fail to create token, please retry."),$("#TokenCreate").removeAttr("disabled")})},doneEditToken:function(e){var t,n,r,i,s,o,u,a,f;t=$(e.currentTarget).closest("li").removeClass("editing"),t.children(".tokenName").attr("readonly",!0),o=t.children(".tokenToken").text(),r=t.children(".tokenName").val(),f=App.user.get("tokens");for(u=0,a=f.length;u<a;u++)s=f[u],s.token===o?i=s.name:s.name===r&&(n=!0);if(!r||n){t.children(".tokenName").val(i);return}App.user.updateToken(o,r).fail(function(){return i="",t.children(".tokenName").val(i),notification("error","Fail to update token, please retry.")})},confirmRmToken:function(){var e;$("#TokenRemove").attr("disabled","disabled"),e=this,App.user.removeToken(this.rmToken).then(function(){return e.updateTokenTab(),e.cancelRmToken()},function(){return notification("Fail to delete token, please retry."),e.cancelRmToken()})},cancelRmToken:function(){this.rmToken="",$("#TokenRemove").removeAttr("disabled"),$("#TokenManager").show(),$("#TokenRmConfirm").hide()},updateTokenTab:function(){var e;e=App.user.get("tokens"),$("#TokenManager").find(".token-table").toggleClass("empty",e.length===0),e.length?$("#TokenList").html(MC.template.accessTokenTable(e)):$("#TokenList").empty()}}),r.TAB={CredentialInvalid:-1,Normal:0,Credential:1,Token:2},r})}.call(this),function(){define("ide/subviews/HeaderView",["./HeaderTpl","./SettingsDialog","backbone","UI.selectbox"],function(e,t){var n;return n=Backbone.View.extend({events:{"click #HeaderLogout":"logout","click #HeaderSettings":"settings","click #HeaderShortcuts":"shortcuts","DROPDOWN_CLOSE #HeaderNotification":"dropdownClosed"},initialize:function(){this.listenTo(App.user,"change",this.update),this.listenTo(App.model,"change:notification",this.updateNotification),this.setElement($(e(App.user.toJSON())).prependTo("#wrapper"))},logout:function(){return App.logout()},shortcuts:function(){return modal(MC.template.shortkey())},settings:function(){return new t},update:function(){return $("#HeaderUser").data("tooltip",App.user.get("email")).children("span").text(App.user.get("username"))},setAlertCount:function(e){return $("#NotificationCounter").text(e||"")},updateNotification:function(){var e,t,n,r,i,s;void 0,n=App.model.get("notification"),e="",r=0;for(i=0,s=n.length;i<s;i++)t=n[i],e+=MC.template.headerNotifyItem(t),t.readed||r++;return this.setAlertCount(r),$("#notification-panel-wrapper").find(".scroll-content").html(e),$("#notification-panel-wrapper").css("max-height",Math.ceil(window.innerHeight*.8)),null},dropdownClosed:function(){return $("#notification-panel-wrapper").find(".scroll-content").children().removeClass("unread"),this.setAlertCount(),App.model.markNotificationRead(),null}}),n})}.call(this),define("ide/subviews/WelcomeTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){var r="";return r+="\r\n    <p>"+u(n.i18n.call(e,"WELCOME_PROVIDE_CRED_DESC",{hash:{},data:t}))+"</p>\r\n  ",r}function c(e,t){var r="",i;return r+="\r\n    <h2>"+u(n.i18n.call(e,"WELCOME_TIT",{hash:{},data:t}))+"<span>"+u((i=e&&e.username,typeof i===a?i.apply(e):i))+"</span></h2>\r\n    <p>"+u(n.i18n.call(e,"WELCOME_DESC",{hash:{},data:t}))+"</p>\r\n  ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<section id="WelcomeSettings">\r\n  <header>\r\n  ',o=n["if"].call(t,t&&t.noWelcome,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\r\n  </header>\r\n  <div id="CredSetupWrap">\r\n    <div id="CredSetupMsg" class="cred-setup-msg empty-hide"></div>\r\n    <ul>\r\n      <li>\r\n        <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_ACCOUNTID",{hash:{},data:i}))+'"></i>\r\n        <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNTID",{hash:{},data:i}))+'</label>\r\n        <input autocomplete="off" class="input" id="CredSetupAccount" type="text">\r\n      </li>\r\n      <li>\r\n        <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_ACCESSKEY",{hash:{},data:i}))+'"></i>\r\n        <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCESSKEY",{hash:{},data:i}))+'</label>\r\n        <input autocomplete="off" class="input" id="CredSetupAccessKey" type="text">\r\n      </li>\r\n      <li>\r\n        <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_SECRETKEY",{hash:{},data:i}))+'"></i>\r\n        <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_SECRETKEY",{hash:{},data:i}))+'</label>\r\n        <input autocomplete="off" class="input" id="CredSetupSecretKey" type="password">\r\n      </li>\r\n    </ul>\r\n\r\n    <footer class="cred-btn-wrap clearfix tar">\r\n      <button id="WelcomeSkip" class="link-style">'+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT_SKIP",{hash:{},data:i}))+'</button>\r\n      <button id="CredSetupSubmit" class="btn btn-blue" disabled="disabled">'+u(n.i18n.call(t,"HEAD_BTN_SUBMIT",{hash:{},data:i}))+'</button>\r\n    </footer>\r\n  </div>\r\n</section>\r\n\r\n<section id="WelcomeCredUpdate" class="hide">\r\n  <p>'+u(n.i18n.call(t,"SETTINGS_CRED_UPDATING",{hash:{},data:i}))+'</p>\r\n  <div class="loading-spinner"></div>\r\n</section>\r\n\r\n<section id="WelcomeSkipWarning" class="hide modal-body">\r\n  <h3>'+u(n.i18n.call(t,"WELCOME_SKIP_TIT",{hash:{},data:i}))+"</h3>\r\n  <h5>"+u(n.i18n.call(t,"WELCOME_SKIP_SUBTIT",{hash:{},data:i}))+"</h5>\r\n  <p>"+u(n.i18n.call(t,"WELCOME_SKIP_MSG",{hash:{},data:i}))+"</p>\r\n  <p>"+u(n.i18n.call(t,"WELCOME_SKIP_MSG_EXTRA",{hash:{},data:i}))+'</p>\r\n  <footer class="cred-btn-wrap clearfix tar">\r\n    <button id="WelcomeBack" class="link-style">'+u(n.i18n.call(t,"HEAD_BTN_BACK",{hash:{},data:i}))+'</button>\r\n    <button id="WelcomeDone" class="btn btn-blue">'+u(n.i18n.call(t,"HEAD_BTN_DONE",{hash:{},data:i}))+'</button>\r\n  </footer>\r\n</section>\r\n\r\n<section id="WelcomeDoneWrap" class="hide">\r\n  <p id="WelcomeDoneTitDemo">'+u(n.i18n.call(t,"WELCOME_DONE_HINT_DEMO",{hash:{},data:i}))+'</p>\r\n  <p id="WelcomeDoneTit">'+u(n.i18n.call(t,"WELCOME_DONE_HINT",{hash:{},data:i}))+" <span></span></p>\r\n  <h3>"+u(n.i18n.call(t,"WELCOME_DONE_TIT",{hash:{},data:i}))+"</h3>\r\n  <ul>"+u(n.i18n.call(t,"WELCOME_DONE_MSG",{hash:{},data:i}))+'</ul>\r\n  <footer class="cred-btn-wrap clearfix tar">\r\n    <button id="WelcomeClose" class="btn btn-blue">'+u(n.i18n.call(t,"HEAD_BTN_DONE",{hash:{},data:i}))+"</button>\r\n  </footer>\r\n</section>",s};return e.template(t)}),function(){define("ide/subviews/WelcomeDialog",["./WelcomeTpl","UI.modalplus","i18n!/nls/lang.js","backbone"],function(e,t,n){var r;return r=Backbone.View.extend({events:{"click #WelcomeSkip":"skip","click #WelcomeBack":"back","click #WelcomeDone":"skipDone","click #WelcomeClose":"close","click #CredSetupSubmit":"submitCred","keyup #CredSetupAccount, #CredSetupAccessKey, #CredSetupSecretKey":"updateSubmitBtn"},initialize:function(r){var i,s;i={username:App.user.get("username")},r&&r.askForCredential?(s=n.ide.WELCOME_PROVIDE_CRED_TIT,i.noWelcome=!0):s=n.ide.WELCOME_DIALOG_TIT,this.modal=new t({title:s,template:e(i),width:"600",disableClose:!0,disableFooter:!0,compact:!0,hideClose:!0,cancel:{hide:!0}}),this.modal.tpl.find(".context-wrap").attr("id","WelcomeDialog"),this.setElement(this.modal.tpl)},skip:function(){return $("#WelcomeSettings").hide(),$("#WelcomeSkipWarning").show()},back:function(){return $("#WelcomeSettings").show(),$("#WelcomeSkipWarning").hide()},skipDone:function(){if(!App.user.hasCredential()){this.done();return}$("#CredSetupAccount").val(""),$("#CredSetupAccessKey").val(""),$("#CredSetupSecretKey").val(""),$("#WelcomeSkipWarning").hide(),$("#WelcomeCredUpdate").show(),this.setCred()},done:function(){return $("#WelcomeSettings, #WelcomeSkipWarning, #WelcomeCredUpdate").hide(),$("#WelcomeDoneWrap").show(),App.user.hasCredential()?($("#WelcomeDoneTitDemo").hide(),$("#WelcomeDoneTit").children("span").text(App.user.get("account"))):($("#WelcomeDoneTitDemo").show(),$("#WelcomeDoneTit").hide())},close:function(){return this.modal.close()},updateSubmitBtn:function(){var e,t,n;t=$("#CredSetupAccount").val(),e=$("#CredSetupAccessKey").val(),n=$("#CredSetupSecretKey").val(),t.length&&e.length&&n.length?$("#CredSetupSubmit").removeAttr("disabled"):$("#CredSetupSubmit").attr("disabled","disabled")},submitCred:function(){var e,t,r;return $("#WelcomeSettings").hide(),$("#WelcomeCredUpdate").show(),e=$("#CredSetupAccessKey").val(),t=$("#CredSetupSecretKey").val(),r=this,App.user.validateCredential(e,t).then(function(){r.setCred()},function(){$("#CredSetupMsg").text(n.ide.SETTINGS_ERR_CRED_VALIDATE),r.showCredSetup()})},setCred:function(){var e,t,r,i;return t=$("#CredSetupAccount").val(),e=$("#CredSetupAccessKey").val(),r=$("#CredSetupSecretKey").val(),t==="demo_account"&&(t="user_demo_account",$("#CredSetupAccount").val(t)),i=this,App.user.changeCredential(t,e,r,!0).then(function(){i.done()},function(e){$("#CredSetupMsg").text(n.ide.SETTINGS_ERR_CRED_UPDATE),i.showCredSetup()})},showCredSetup:function(){$("#WelcomeDialog").children().hide(),$("#WelcomeSettings").show(),$("#CredSetupAccount").focus()[0].select(),this.updateSubmitBtn()}}),r})}.call(this),define("ide/subviews/NavigationTpl",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<aside id="navigation">\n  <nav>\n    <button class="off-canvas-tab" id="off-canvas-app">'+o(n.i18n.call(t,"NAV_TIT_APPS",{hash:{},data:i}))+'</button>\n    <button class="off-canvas-tab selected" id="off-canvas-stack">'+o(n.i18n.call(t,"NAV_TIT_STACKS",{hash:{},data:i}))+'</button>\n  </nav>\n\n  <section class="scroll-wrap">\n    <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\n    <div class="scroll-content">\n      <ul class="scroll-content hide" id="nav-app-region"></ul>\n      <div class="scroll-content" id="nav-stack">\n        <ul id="nav-stack-region"></ul>\n        <div id="nav-show-empty">Show unused regions</div>\n        <ul id="nav-region-empty-list" class="hide"></ul>\n      </div>\n    </div>\n  </section>\n</aside>\n<button id="off-canvas-menu" class="icon-menu"></button>\n<div id="off-canvas-overlay"></div>',s},n.navigation=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r="",i;r+='<li data-region="'+o((i=e&&e.region,typeof i===u?i.apply(e):i))+'">\n	<h3 class="nav-group-title">'+o((i=e&&e.regionName,typeof i===u?i.apply(e):i))+" ("+o((i=(i=e&&e.data,i==null||i===!1?i:i.length),typeof i===u?i.apply(e):i))+')</h3>\n	<ul class="nav-item-list app-list">\n	',i=n.each.call(e,e&&e.data,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;return r+="\n	</ul>\n</li>",r}function l(e,t){var r="",i;r+='<li data-id="'+o((i=e&&e.id,typeof i===u?i.apply(e):i))+'" class="truncate nav-truncate icon-app-',i=n["if"].call(e,e&&e.progressing,{hash:{},inverse:a.program(5,h,t),fn:a.program(3,c,t),data:t});if(i||i===0)r+=i;r+='" title="'+o((i=e&&e.name,typeof i===u?i.apply(e):i))+" ["+o((i=e&&e.stateDesc,typeof i===u?i.apply(e):i))+']">'+o((i=e&&e.name,typeof i===u?i.apply(e):i)),i=n["if"].call(e,e&&e.usage,{hash:{},inverse:a.noop,fn:a.program(7,p,t),data:t});if(i||i===0)r+=i;return r+="</li>",r}function c(e,t){return"pending"}function h(e,t){return o(n.tolower.call(e,e&&e.stateDesc,{hash:{},data:t}))}function p(e,t){var n="",r;return n+='<i class="icon-app-type-'+o((r=e&&e.usage,typeof r===u?r.apply(e):r))+'"></i>',n}function d(e,t){var r="";return r+='\n<div class="nav-empty">'+o(n.i18n.call(e,"DASH_LBL_NO_APP",{hash:{},data:t}))+"</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=this.escapeExpression,u="function",a=this;return s=n.each.call(t,t,{hash:{},inverse:a.program(9,d,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.applist=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r;return r=n["if"].call(e,(r=e&&e.data,r==null||r===!1?r:r.length),{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t}),r||r===0?r:""}function l(e,t){var r="",i;r+='<li data-region="'+u((i=e&&e.region,typeof i===o?i.apply(e):i))+'">\n	<h3 class="nav-group-title">'+u((i=e&&e.regionName,typeof i===o?i.apply(e):i))+" ("+u((i=(i=e&&e.data,i==null||i===!1?i:i.length),typeof i===o?i.apply(e):i))+')<button class="icon-new-stack tooltip" data-tooltip=\''+u(n.i18n.call(e,"IDE_COM_CREATE_NEW_STACK",{hash:{},data:t}))+'\'></button></h3>\n	<ul class="nav-item-list stack-list">\n	',i=n.each.call(e,e&&e.data,{hash:{},inverse:a.noop,fn:a.program(3,c,t),data:t});if(i||i===0)r+=i;return r+="</ul>\n</li>",r}function c(e,t){var n="",r;return n+='<li data-id="'+u((r=e&&e.id,typeof r===o?r.apply(e):r))+'" class="truncate nav-truncate icon-stack-nav">'+u((r=e&&e.name,typeof r===o?r.apply(e):r))+"</li>",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.stacklist=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r;return r=n.unless.call(e,(r=e&&e.data,r==null||r===!1?r:r.length),{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t}),r||r===0?r:""}function l(e,t){var r="",i;return r+='<li class="nav-group-title" data-region="'+u((i=e&&e.region,typeof i===o?i.apply(e):i))+'">'+u((i=e&&e.regionName,typeof i===o?i.apply(e):i))+' (0) <button class="icon-new-stack tooltip" data-tooltip=\''+u(n.i18n.call(e,"IDE_COM_CREATE_NEW_STACK",{hash:{},data:t}))+"'></button></li>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.regionlist=e.template(t),n}),function(){define("ide/subviews/Navigation",["./NavigationTpl","backbone"],function(e){return Backbone.View.extend({events:{"click #off-canvas-app":"showNavApp","click #off-canvas-stack":"showNavStack","click .stack-list li, .app-list li":"openOps","click #nav-show-empty":"showEmptyRegion","click .icon-new-stack":"createStack"},initialize:function(){this.setElement($(e.navigation()).appendTo("#wrapper").eq(0)),$("#off-canvas-menu").click(_.bind(this.showOffCanvas,this)),$("#off-canvas-overlay").click(_.bind(this.hideOffCanvas,this)),this.updateStackList(),this.updateAppList(),this.listenTo(App.model.stackList(),"update",function(){this.showing?this.updateStackList():this.stackDirty=!0}),this.listenTo(App.model.appList(),"update change:state",function(){void 0,this.showing?this.updateAppList():this.appDirty=!0})},showOffCanvas:function(){if($("#wrapper").hasClass("off-canvas"))return $("wrapper").removeClass("off-canvas");this.stackDirty&&this.updateStackList(),this.appDirty&&this.updateAppList(),this.showing=!0,this.stackDirty=this.appDirty=!1,$("#nav-app-region").children(".nav-empty").length?this.showNavStack():this.showNavApp(),$("#wrapper").addClass("off-canvas")},hideOffCanvas:function(){return $("#wrapper").removeClass("off-canvas"),this.showing=!1},showNavApp:function(){$("#nav-app-region").show(),$("#nav-stack").hide(),$("#off-canvas-app").toggleClass("selected",!0),$("#off-canvas-stack").toggleClass("selected",!1)},showNavStack:function(){$("#nav-app-region").hide(),$("#nav-stack").show(),$("#off-canvas-app").toggleClass("selected",!1),$("#off-canvas-stack").toggleClass("selected",!0)},showEmptyRegion:function(){$("#nav-show-empty").hide(),$("#nav-region-empty-list").show()},updateStackList:function(){var t;return t=App.model.stackList().groupByRegion(!0),$("#nav-stack-region").html($.trim(e.stacklist(t))),$("#nav-region-empty-list").html(e.regionlist(t))},updateAppList:function(){return $("#nav-app-region").html(e.applist(App.model.appList().groupByRegion()))},openOps:function(e){this.hideOffCanvas(),App.openOps($(e.currentTarget).attr("data-id"))},createStack:function(e){var t;t=$(e.currentTarget).closest("li").attr("data-region");if(!t)return;this.hideOffCanvas(),App.createOps(t)}})})}.call(this),define("ide/subviews/AppTpl",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<header class="modal-header" style="width:390px;"><h3>'+u(n.i18n.call(t,"TOOL_TIP_DELETE_STACK",{hash:{},data:i}))+'</h3><i class="modal-close">&times;</i></header>\n<div class="modal-body modal-text-wraper" style="width:390px;">\n  <div class="modal-center-align-helper">\n      <div class="modal-text-major">'+u((o=t&&t.msg,typeof o===a?o.apply(t):o))+'</div>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn modal-close btn-red" id="confirmRmStack">'+u(n.i18n.call(t,"TOOL_POP_BTN_DELETE_STACK",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOL_POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.removeStackConfirm=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<header class="modal-header" style="width:390px;"><h3>'+u(n.i18n.call(t,"TOOL_TIP_DUPLICATE_STACK",{hash:{},data:i}))+'</h3><i class="modal-close">&times;</i></header>\n<div class="modal-body modal-text-wraper" style="width:390px;">\n  <div class="modal-center-align-helper">\n    <div class="modal-control-group">\n      <label class="modal-text-major">'+u(n.i18n.call(t,"TOOL_POP_BODY_DUPLICATE_STACK",{hash:{},data:i}))+'</label>\n      <input id="confirmDupStackIpt" class="input" type="text" value="'+u((o=t&&t.newName,typeof o===a?o.apply(t):o))+'">\n    </div>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-red" id="confirmDupStack">'+u(n.i18n.call(t,"TOOL_POP_BTN_DUPLICATE_STACK",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOL_POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.dupStackConfirm=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<header class="modal-header" style="width:390px;"><h3>'+u(n.i18n.call(t,"TOOL_TIP_START_APP",{hash:{},data:i}))+'</h3><i class="modal-close">&times;</i></header>\n<div class="modal-body modal-text-wraper" style="width:390px;">\n  <div class="modal-center-align-helper">\n      <div class="modal-text-major">'+u(n.i18n.call(t,"TOOL_POP_BODY_START_APP_LEFT",{hash:{},data:i}))+" "+u((o=t&&t.name,typeof o===a?o.apply(t):o))+" "+u(n.i18n.call(t,"TOOL_POP_BODY_START_APP_RIGHT",{hash:{},data:i}))+'</div>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn modal-close btn-blue" id="confirmStartApp">'+u(n.i18n.call(t,"TOOL_POP_BTN_START_APP",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOL_POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.startAppConfirm=e.template(t),t=function(e,t,n,r,i){function l(e,t){return u(n.i18n.call(e,"TOOL_POP_TIT_STOP_PRD_APP",{hash:{},data:t}))}function c(e,t){return u(n.i18n.call(e,"TOOL_POP_TIT_STOP_APP",{hash:{},data:t}))}function h(e,t){var r="",i;return r+='\n  <div class="modal-body" style="color:#676767;width:390px;">\n    <p><b style="color:#ec3c38;">'+u((i=e&&e.name,typeof i===a?i.apply(e):i))+" "+u(n.i18n.call(e,"POP_CONFIRM_PROD_APP_WARNING_MSG",{hash:{},data:t}))+"</b>"+u(n.i18n.call(e,"POP_CONFIRM_TERMINATE_PROD_APP_MSG",{hash:{},data:t}))+" "+u(n.i18n.call(e,"POP_CONFIRM_STOP_ASG",{hash:{},data:t}))+"</p>\n    <p>"+u(n.i18n.call(e,"POP_CONFIRM_STOP_PROD_APP_INPUT_LBL",{hash:{},data:t}))+'</p>\n    <div><input class="input" style="width:351px;" id="appNameConfirmIpt"/></div>\n  </div>\n',r}function p(e,t){var r="",i;return r+='\n  <div class="modal-body modal-text-wraper" style="width:390px;"> <div class="modal-center-align-helper">\n    <div class="modal-text-major">'+u(n.i18n.call(e,"TOOL_POP_BODY_STOP_APP_LEFT",{hash:{},data:t}))+" "+u((i=e&&e.name,typeof i===a?i.apply(e):i))+" "+u(n.i18n.call(e,"TOOL_POP_BODY_STOP_APP_RIGHT",{hash:{},data:t}))+"</div>\n  </div> </div>\n",r}function d(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<header class="modal-header" style="width:390px;"><h3>',o=n["if"].call(t,t&&t.production,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='</h3><i class="modal-close">&times;</i></header>\n\n',o=n["if"].call(t,t&&t.production,{hash:{},inverse:f.program(7,p,i),fn:f.program(5,h,i),data:i});if(o||o===0)s+=o;s+='\n\n<div class="modal-footer">\n  <button class="btn modal-close btn-red" id="confirmStopApp" ',o=n["if"].call(t,t&&t.production,{hash:{},inverse:f.noop,fn:f.program(9,d,i),data:i});if(o||o===0)s+=o;return s+=">"+u(n.i18n.call(t,"TOOL_POP_BTN_STOP_APP",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOL_POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.stopAppConfirm=e.template(t),t=function(e,t,n,r,i){function l(e,t){return u(n.i18n.call(e,"TOOL_POP_TIT_TERMINATE_PRD_APP",{hash:{},data:t}))}function c(e,t){return u(n.i18n.call(e,"TOOL_POP_TIT_TERMINATE_APP",{hash:{},data:t}))}function h(e,t){var r="",i;return r+='\n  <div class="modal-body" style="color:#676767;width:390px;">\n    <p><b style="color:#ec3c38;">'+u((i=e&&e.name,typeof i===a?i.apply(e):i))+" "+u(n.i18n.call(e,"POP_CONFIRM_PROD_APP_WARNING_MSG",{hash:{},data:t}))+"</b>"+u(n.i18n.call(e,"POP_CONFIRM_TERMINATE_PROD_APP_MSG",{hash:{},data:t}))+"</p>\n    <p>"+u(n.i18n.call(e,"POP_CONFIRM_TERMINATE_PROD_APP_INPUT_LBL",{hash:{},data:t}))+'</p>\n    <div><input class="input" style="width:351px;" id="appNameConfirmIpt"/></div>\n  </div>\n',r}function p(e,t){var r="",i;return r+='\n  <div class="modal-body modal-text-wraper" style="width:390px;">\n    <div class="modal-center-align-helper"> <div class="modal-text-major">'+u(n.i18n.call(e,"TOOL_POP_BODY_TERMINATE_APP_LEFT",{hash:{},data:t}))+" "+u((i=e&&e.name,typeof i===a?i.apply(e):i))+" "+u(n.i18n.call(e,"TOOL_POP_BODY_TERMINATE_APP_RIGHT",{hash:{},data:t}))+"</div>\n  </div> </div>\n",r}function d(e,t){return"disabled"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<header class="modal-header" style="width:390px;"><h3>',o=n["if"].call(t,t&&t.production,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='</h3><i class="modal-close">&times;</i></header>\n\n',o=n["if"].call(t,t&&t.production,{hash:{},inverse:f.program(7,p,i),fn:f.program(5,h,i),data:i});if(o||o===0)s+=o;s+='\n\n<div class="modal-footer">\n  <button id="appTerminateConfirm" class="btn btn-red modal-close" ',o=n["if"].call(t,t&&t.production,{hash:{},inverse:f.noop,fn:f.program(9,d,i),data:i});if(o||o===0)s+=o;return s+=">"+u(n.i18n.call(t,"TOOL_POP_BTN_TERMINATE_APP",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOL_POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.terminateAppConfirm=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<section class="disconnected-msg">\n  <div>Connection lost. Attempting to reconnect…</div>\n  <div>Changes made now may not be saved.</div>\n</section>'},n.disconnectedMsg=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<header class="modal-header" style="width:390px;"><h3>Force to delete app</h3><i class="modal-close">&times;</i></header>\n<div class="modal-body modal-text-wraper" style="width:390px;">\n  <div class="modal-center-align-helper">\n      <div class="modal-text-major">The app '+a((o=t&&t.name,typeof o===u?o.apply(t):o))+' failed to terminate. Do you want to force deleting it? After force deleting it, you need to manually manage the resource in aws console.</div>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn modal-close btn-red" id="forceTerminateApp">'+a(n.i18n.call(t,"TOOL_POP_BTN_DELETE_STACK",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+a(n.i18n.call(t,"TOOL_POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.forceTerminateApp=e.template(t),n}),function(){define("ide/ApplicationView",["backbone","./subviews/SessionDialog","./subviews/HeaderView","./subviews/WelcomeDialog","./subviews/SettingsDialog","./subviews/Navigation","./subviews/AppTpl","i18n!/nls/lang.js"],function(e,t,n,r,i,s,o,u){return e.View.extend({el:$("body")[0],events:{"click .click-select":"selectText"},initialize:function(){this.header=new n,new s,this.listenTo(App.user,"change:state",this.toggleWelcome),this.listenTo(App.model.appList(),"change:terminateFail",this.askForForceTerminate),$(window).on("beforeunload",this.checkUnload),$(document).on("keydown",this.globalKeyEvent)},checkUnload:function(){return App.canQuit()?void 0:u.ide.BEFOREUNLOAD_MESSAGE},globalKeyEvent:function(e){var t;t=e.target.nodeName.toLowerCase();if(t==="input"||t==="textarea"||e.target.contentEditable==="true")return;switch(e.which){case 8:return!1;case 191:return modal(MC.template.shortkey(),!0),!1}},toggleWSStatus:function(e){if(e)return $(".disconnected-msg").remove();if($(".disconnected-msg").show().length>0)return;return $(o.disconnectedMsg()).appendTo("body").on("mouseover",function(){$(".disconnected-msg").addClass("hovered"),$("body").on("mousemove.disconnectedmsg",function(e){var t,n,r,i;t=$(".disconnected-msg");if(!t.length){$("body").off("mousemove.disconnectedmsg");return}n=t.offset(),r=e.pageX,i=e.pageY;if(r<n.left||i<n.top||r>=n.left+t.outerWidth()||i>=n.top+t.outerHeight())$("body").off("mousemove.disconnectedmsg"),t.removeClass("hovered")})})},toggleWelcome:function(){App.user.isFirstVisit()&&new r},askForAwsCredential:function(){return new r({askForCredential:!0})},showSessionDialog:function(){return(new t).promise()},selectText:function(e){var t,n;try{n=document.body.createTextRange(),n.moveToElementText(e.currentTarget),n.select(),void 0}catch(r){t=r,window.getSelection&&(n=document.createRange(),n.selectNode(e.currentTarget),window.getSelection().addRange(n),void 0)}return!1},deleteStack:function(e,t){t=t||App.model.stackList().get(e).get("name"),modal(o.removeStackConfirm({msg:sprintf(u.ide.TOOL_POP_BODY_DELETE_STACK,t)})),$("#confirmRmStack").on("click",function(){var n,r;n=App.model.stackList().get(e),r=n.remove();if(n.isPersisted())return r.then(function(){return notification("info",sprintf(u.ide.TOOL_MSG_ERR_DEL_STACK_SUCCESS,t))},function(){return notification("error",sprintf(u.ide.TOOL_MSG_ERR_DEL_STACK_FAILED,t))})})},duplicateStack:function(e){var t;t=App.model.stackList().get(e);if(!t)return;t.fetchJsonData().then(function(){return App.openOps(App.model.createStackByJson(t.getJsonData()))},function(){return notification("error","Cannot duplicate the stack, please retry.")})},startApp:function(e){var t;t=App.model.appList().get(e).get("name"),modal(o.startAppConfirm({name:t})),$("#confirmStartApp").on("click",function(){App.model.appList().get(e).start().fail(function(e){var n;n=e.awsError?e.error+"."+e.awsError:e.error,notification('Fail to start your app "'+t+'". (ErrorCode: '+n+")")})})},stopApp:function(e){var t,n;t=App.model.appList().get(e),n=t.get("name"),modal(o.stopAppConfirm({name:n,production:t.get("usage")==="production"})),$("#confirmStopApp").on("click",function(){t.stop().fail(function(e){var t;t=e.awsError?e.error+"."+e.awsError:e.error,notification('Fail to stop your app "'+n+'". (ErrorCode: '+t+")")})}),$("#appNameConfirmIpt").on("keyup change",function(){$("#appNameConfirmIpt").val()===n?$("#confirmStopApp").removeAttr("disabled"):$("#confirmStopApp").attr("disabled","disabled")})},terminateApp:function(e){var t,n;t=App.model.appList().get(e),n=t.get("name"),modal(o.terminateAppConfirm({name:n,production:t.get("usage")==="production"})),$("#appNameConfirmIpt").on("keyup change",function(){$("#appNameConfirmIpt").val()===n?$("#appTerminateConfirm").removeAttr("disabled"):$("#appTerminateConfirm").attr("disabled","disabled")}),$("#appTerminateConfirm").on("click",function(){t.terminate().fail(function(e){var t;return t=e.awsError?e.error+"."+e.awsError:e.error,notification('Fail to terminate your app "'+n+'". (ErrorCode: '+t+")")})})},askForForceTerminate:function(e){if(!e.get("terminateFail"))return;modal(o.forceTerminateApp({name:e.get("name")})),$("#forceTerminateApp").on("click",function(){e.terminate(!0).fail(function(e){var t;return t=e.awsError?e.error+"."+e.awsError:e.error,notification('Fail to terminate your app "'+name+'". (ErrorCode: '+t+")")})})}})})}.call(this),function(){define("OpsModel",["ApiRequest","constant","CloudResources","ThumbnailUtil","backbone"],function(e,t,n,r){var i,s,o;return s={UnRun:0,Running:1,Stopped:2,Initializing:3,Starting:4,Updating:5,Stopping:6,Terminating:7,Destroyed:8,Saving:9},o=["","Running","Stopped","Starting","Starting","Updating","Stopping","Terminating","","Saving"],i=Backbone.Model.extend({defaults:function(){return{updateTime:+(new Date),region:"",state:s.UnRun,stoppable:!0,name:""}},initialize:function(e,t){t&&(t.initJsonData&&this.__initJsonData(),t.jsonData&&this.__setJsonData(t.jsonData))},url:function(){return this.get("id")?"ops/"+this.get("id"):"ops/"+this.cid+"/unsaved"},isStack:function(){return this.attributes.state===s.UnRun},isApp:function(){return this.attributes.state!==s.UnRun},isImported:function(){return!!this.attributes.importVpcId},testState:function(e){return this.attributes.state===e},getStateDesc:function(){return o[this.attributes.state]},toJSON:function(e){var n;return n=Backbone.Model.prototype.toJSON.call(this),n.stateDesc=o[n.state],n.regionName=t.REGION_SHORT_LABEL[n.region],this.isProcessing()&&(n.progressing=!0),e&&e.thumbnail&&(n.thumbnail=r.fetch(n.id)),n},isPersisted:function(){return!!this.get("id")},isExisting:function(){var e;return e=this.get("state"),e===s.Destroyed&&void 0,!!this.get("id")&&e!==s.Destroyed},getVpcId:function(){var e,n,r;if(this.get("importVpcId"))return this.get("importVpcId");if(!this.__jsonData)return void 0;r=this.__jsonData.component;for(n in r){e=r[n];if(e.type===t.RESTYPE.VPC)return e.resource.VpcId}return void 0},getThumbnail:function(){return r.fetch(this.get("id"))},saveThumbnail:function(e){e?(r.save(this.get("id"),e),this.trigger("change")):r.save(this.get("id"),"")},hasJsonData:function(){return!!this.__jsonData},getJsonData:function(){return this.__jsonData},fetchJsonData:function(){var t,r,i;return this.__jsonData?(t=Q.defer(),t.resolve(this),t.promise):(i=this,this.get("sampleId")?(r=this.get("sampleId"),e("stackstore_fetch_stackstore",{sub_path:"master/stack/"+r+"/"+r+".json"}).then(function(e){var t,n;try{n=JSON.parse(e),delete n.id,delete n.signature,i.collection.isNameAvailable(n.name)||(n.name=i.collection.getNewName(n.name)),i.attributes.region=n.region,i.__setJsonData(n)}catch(r){t=r,n=null,i.attributes.region="us-east-1",i.__initJsonData()}if(n)try{i.set("name",n.name)}catch(r){t=r}return i})):this.isImported()?n("OpsResource",this.getVpcId()).init(this.get("region")).fetchForceDedup().then(function(){var e;return e=i.generateJsonFromRes(),i.__setJsonData(e),i.attributes.name=e.name,i}):this.isStack()?e("stack_info",{region_name:this.get("region"),stack_ids:[this.get("id")]}).then(function(e){return i.__setJsonData(e[0])}):e("app_info",{region_name:this.get("region"),app_ids:[this.get("id")]}).then(function(e){return i.__setJsonData(e[0])}))},__setJsonData:function(t){var n;if(!t)throw this.__destroy(),new McError(e.Errors.MissingDataInServer,"Stack/App doesn't exist.");return t.agent||(t.agent={enabled:!1,module:{repo:App.user.get("repo"),tag:App.user.get("tag")}}),t.property||(t.property={stoppable:!0}),t.layout&&t.layout.component&&(n=$.extend({},t.layout.component.node,t.layout.component.group),n.size=t.layout.size,t.layout=n),t.layout&&!t.layout.size&&(t.layout.size=[240,240]),(t.version||"").split("-").length<3&&(t.version="2013-09-13"),this.__jsonData=t,this.attributes.name!==t.name&&this.set("name",t.name),this},generateJsonFromRes:function(){var e,t,r,i;return i=n.getAllResourcesForVpc(this.get("region"),this.getVpcId(),this.__jsonData),this.__jsonData?(e=this.__jsonData.component,r=this.__jsonData.layout,delete this.__jsonData.component,delete this.__jsonData.layout,t=$.extend(!0,{},this.__jsonData),this.__jsonData.component=e,this.__jsonData.layout=r):t=this.__createRawJson(),t.component=i.component,t.layout=i.layout,t.name=this.get("name")||i.theVpc.name,t},save:function(t,n){var i,o,u,a;return this.isApp()||this.testState(s.Saving)?this.__returnErrorPromise():(t||(t=this.__jsonData),this.set("state",s.Saving),u=this.collection.where({name:t.name})||[],u.length>1||u[0]&&u[0]!==this?(o=Q.defer(),o.reject(McError(e.Errors.StackRepeatedStack,"Stack name has already been used.")),o.promise):(i=this.get("id")?"stack_save":"stack_create",t.state!=="Enabled"&&(void 0,t.state="Enabled"),t.id=this.get("id"),a=this,e(i,{region_name:this.get("region"),spec:t}).then(function(e){var i;return i={name:t.name,updateTime:+(new Date),stoppable:t.property.stoppable,state:s.UnRun},a.get("id")||(i.id=e,t.id=e),n&&r.save(a.id||i.id,n),a.set(i),a.__jsonData=t,a.trigger("jsonDataSaved",a),i.id&&a.collection.__triggerUpdate(a),a},function(e){throw a.set("state",s.UnRun),e})))},remove:function(){var t,n;return this.isPersisted()&&this.isApp()?this.__returnErrorPromise():(this.__destroy(),this.get("id")?(n=this,e("stack_remove",{region_name:this.get("region"),stack_id:this.get("id")}).fail(function(){return this.set("state",s.UnRun),App.model.stackList().add(n)})):(t=Q.defer(),t.resolve(),t.promise))},run:function(t,n){var r;return r=this.get("region"),t.id=this.get("id")||"",e("stack_run_v2",{region_name:r,stack:t,app_name:n}).then(function(e){var o;return o=new i({name:n,requestId:e[0],state:s.Initializing,progress:0,region:r,usage:t.usage,updateTime:+(new Date),stoppable:t.property.stoppable,resource_diff:!1}),App.model.appList().add(o),o})},duplicate:function(t){var n,s,o;if(this.isApp())return;return o=r.fetch(this.get("id")),n=$.extend(!0,{},this.attributes,{name:t,updateTime:+(new Date)}),s=this.collection,e("stack_save_as",{region_name:this.get("region"),stack_id:this.get("id"),new_name:t||this.collection.getNewName()}).then(function(e){return o&&r.save(e,o),n.id=e,s.add(new i(n))})},stop:function(){var t;return!this.isApp()||this.get("state")!==s.Running?this.__returnErrorPromise():(t=this,this.set("state",s.Stopping),this.attributes.progress=0,e("app_stop",{region_name:this.get("region"),app_id:this.get("id"),app_name:this.get("name")}).fail(function(e){throw t.set("state",s.Running),e}))},start:function(){var t;return!this.isApp()||this.get("state")!==s.Stopped?this.__returnErrorPromise():(t=this,this.set("state",s.Starting),this.attributes.progress=0,e("app_start",{region_name:this.get("region"),app_id:this.get("id"),app_name:this.get("name")}).fail(function(e){throw t.set("state",s.Stopped),e}))},terminate:function(t){var n,r;return t==null&&(t=!1),this.isApp()?(n=this.get("state"),this.set("state",s.Terminating),this.attributes.progress=0,this.attributes.terminateFail=!1,r=this,e("app_terminate",{region_name:this.get("region"),app_id:this.get("id"),app_name:this.get("name"),flag:t}).then(function(){t&&r.__destroy()},function(e){throw e.error<0?e:(r.set({state:n,terminateFail:!0}),e)})):this.__returnErrorPromise()},update:function(t,n){var r,i,o;return this.isApp()?this.__updateAppDefer?(void 0,this.__updateAppDefer.promise):(i=this.get("state"),this.set("state",s.Updating),this.attributes.progress=0,this.__updateAppDefer=Q.defer(),o=this,e("app_update",{region_name:this.get("region"),spec:t,app_id:this.get("id"),fast_update:n}).fail(function(e){return o.__updateAppDefer.reject(e)}),r=function(e){throw o.__updateAppDefer=null,o.attributes.progress=0,o.set({state:i}),e},this.__updateAppDefer.promise.then(function(){return o.__jsonData=null,o.fetchJsonData().then(function(){return o.__updateAppDefer=null,o.importVpcId=void 0,o.set({name:t.name,state:s.Running})},r)},r)):this.__returnErrorPromise()},saveApp:function(t){var n,r;return this.isApp()?this.__saveAppDefer?(void 0,this.__saveAppDefer.promise):(t.changed=!1,t.state!==this.getStateDesc()&&(void 0,t.state=this.getStateDesc()),void 0,t.id?(t.id!==this.get("id")&&void 0,t.id=this.get("id")):t.id="",n=this.get("state"),this.set("state",s.Saving),this.attributes.progress=0,this.__saveAppDefer=Q.defer(),r=this,e("app_save_info",{spec:t}).then(function(e){r.id||(r.attributes.requestId=e[0]),r.attributes.importVpcId=void 0},function(e){return r.__saveAppDefer.reject(e)}),this.__saveAppDefer.promise.then(function(){r.__jsonData=t,r.attributes.requestId=void 0,r.set({name:t.name,state:n,usage:t.usage}),r.__saveAppDefer=null},function(e){throw r.__saveAppDefer=null,r.attributes.requestId=void 0,r.attributes.progress=0,r.set({state:n}),e})):this.__returnErrorPromise()},setStatusProgress:function(e,t){var n;n=parseInt(e*100/t),this.attributes.progress!==n&&(this.attributes.progress=n,this.trigger("change:progress",this,n))},isProcessing:function(){var e;return e=this.attributes.state,e===s.Initializing||e===s.Stopping||e===s.Updating||e===s.Terminating||e===s.Starting||e===s.Saving},setStatusWithApiResult:function(e){return this.set("state",s[e])},setStatusWithWSEvent:function(t,n,r){var i,o,u;switch(t){case"launch":n.completed?u=s.Running:n.failed&&(u=s.Destroyed);break;case"stop":n.completed?u=s.Stopped:n.failed&&(u=s.Running);break;case"update":if(!this.__updateAppDefer){void 0;return}n.completed?(this.__jsonData=null,o=this,this.fetchJsonData().then(function(){return i=o.__updateAppDefer,o.__updateAppDefer=null,i.resolve()})):(i=this.__updateAppDefer,this.__updateAppDefer=null,i.reject(McError(e.Errors.OperationFailure,r)));return;case"save":if(!this.__saveAppDefer){void 0;return}i=this.__saveAppDefer,this.__saveAppDefer=null,n.completed?i.resolve():i.reject(McError(e.Errors.OperationFailure,r));return;case"terminate":n.completed?u=s.Destroyed:(u=s.Stopped,this.attributes.terminateFail=!1,this.set("terminateFail",!0));break;case"start":n.completed?u=s.Running:u=s.Stopped}r&&(this.attributes.opsActionError=r),u===s.Destroyed?this.__destroy():u&&(this.attributes.progress=0,this.set("state",u))},destroy:function(){return void 0},__destroy:function(){if(this.attributes.state===s.Destroyed)return;return r.remove(this.get("id")),this.attributes.state=s.Destroyed,this.trigger("destroy",this,this.collection)},__returnErrorPromise:function(){var t;return t=Q.defer(),t.resolve(McError(e.Errors.InvalidMethodCall,"The method is not supported by this model.")),t.promise},__createRawJson:function(){return{id:this.get("id")||"",name:this.get("name"),description:"",region:this.get("region"),platform:"ec2-vpc",state:"Enabled",version:"2014-02-17",component:{},layout:{size:[240,240]},agent:{enabled:!0,module:{repo:App.user.get("repo"),tag:App.user.get("tag")}},property:{stoppable:!0}}},__initJsonData:function(){var e,t,n,r,i,s,o,u;r=this.__createRawJson(),o=MC.guid(),u="@{"+o+".resource.VpcId}",s={VPC:{coordinate:[5,3],size:[60,60]},RTB:{coordinate:[50,5],groupUId:o}},t={KP:{type:"AWS.EC2.KeyPair",name:"DefaultKP",resource:{KeyName:"DefaultKP",KeyFingerprint:""}},SG:{type:"AWS.EC2.SecurityGroup",name:"DefaultSG",resource:{IpPermissions:[{IpProtocol:"tcp",IpRanges:"0.0.0.0/0",FromPort:"22",ToPort:"22"}],IpPermissionsEgress:[{FromPort:"0",IpProtocol:"-1",IpRanges:"0.0.0.0/0",ToPort:"65535"}],Default:!0,GroupId:"",GroupName:"DefaultSG",GroupDescription:"default VPC security group",VpcId:u}},ACL:{type:"AWS.VPC.NetworkAcl",name:"DefaultACL",resource:{AssociationSet:[],Default:!0,NetworkAclId:"",VpcId:u,EntrySet:[{RuleAction:"allow",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!0,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:100},{RuleAction:"allow",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!1,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:100},{RuleAction:"deny",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!0,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:32767},{RuleAction:"deny",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!1,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:32767}]}},VPC:{type:"AWS.VPC.VPC",name:"vpc",resource:{VpcId:"",CidrBlock:"10.0.0.0/16",DhcpOptionsId:"",EnableDnsHostnames:!1,EnableDnsSupport:!0,InstanceTenancy:"default"}},RTB:{type:"AWS.VPC.RouteTable",name:"RT-0",resource:{VpcId:u,RouteTableId:"",AssociationSet:[{Main:"true",SubnetId:"",RouteTableAssociationId:""}],PropagatingVgwSet:[],RouteSet:[{InstanceId:"",NetworkInterfaceId:"",Origin:"CreateRouteTable",GatewayId:"local",DestinationCidrBlock:"10.0.0.0/16"}]}}};for(n in t)e=t[n],n==="VPC"?e.uid=o:e.uid=MC.guid(),r.component[e.uid]=e,s[n]&&(i=s[n],i.uid=e.uid,r.layout[e.uid]=i);this.__jsonData=r}}),i.State=s,i})}.call(this),function(){define("ide/submodels/OpsCollection",["OpsModel","constant","backbone"],function(e,t){return Backbone.Collection.extend({model:e,newNameTmpl:"untitled",comparator:function(e,t){return-(e.attributes.updateTime-t.attributes.updateTime)},initialize:function(){this.on("change:updateTime",this.sort,this),this.on("add remove",this.__triggerUpdate,this),this.on("change:id",this.__triggerUpdate,this),this.__debounceUpdate=_.debounce(function(){return this.trigger("update")})},getNewName:function(e){var t,n,r,i,s;n=this.groupBy("name"),t=0,e?(r=e.match(/(.+)(-\d*)$/),s=r?r[1]:e):s=this.newNameTmpl,i=s+"-0";for(;;){if(!n[i])break;t+=1,i=s+"-"+t}return i},isNameAvailable:function(e){return!this.findWhere({name:e})},groupByRegion:function(e,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m;e==null&&(e=!1),n==null&&(n=!0),r==null&&(r=!1),f={},v=this.models;for(c=0,p=v.length;c<p;c++){o=v[c];if(!r&&!o.isExisting())continue;a=o.attributes.region,s=f[a]||(f[a]=[]),s.push(n?o.toJSON():o)}l=[],m=t.REGION_KEYS;for(h=0,d=m.length;h<d;h++){i=m[h],u=f[i];if(!u&&!e)continue;l.push({region:i,regionName:t.REGION_SHORT_LABEL[i],data:u||[]})}return l},filterRecent:function(e){var t,n,r,i,s,o,u;e==null&&(e=!1),r=Math.round(+(new Date)/1e3),t=[],u=this.models;for(s=0,o=u.length;s<o;s++){n=u[s],i=n.get("updateTime");if(r-i>=2592e3)break;e&&(n=n.toJSON(),n.formatedTime=MC.intervalDate(i)),t.push(n)}return t},__triggerUpdate:function(e){if(!e)return;if(this.indexOf(e)!==-1&&!e.isExisting())return;this.__debounceUpdate()}})})}.call(this),function(){define("ide/ApplicationModel",["./submodels/OpsCollection","OpsModel","ApiRequest","backbone","constant","ThumbnailUtil"],function(e,t,n,r,i,s){return r.Model.extend({defaults:function(){return{__websocketReady:!1,notification:[],stackList:new e,appList:new e}},markNotificationRead:function(){var e,t,n,r;r=this.attributes.notification;for(t=0,n=r.length;t<n;t++)e=r[t],e.readed=!0},stackList:function(){return this.attributes.stackList},appList:function(){return this.attributes.appList},getOpsModelById:function(e){return this.attributes.appList.get(e)||this.attributes.stackList.get(e)},clearImportOps:function(){return this.attributes.appList.remove(this.attributes.appList.find(function(e){return e.isImported()}))},createImportOps:function(e,n){var r;return r=this.attributes.appList.findWhere({importVpcId:n}),r?r:(r=new t({name:"",importVpcId:n,region:e,state:t.State.Running}),this.attributes.appList.add(r),r)},createSampleOps:function(e){var n;return n=new t({sampleId:e}),this.attributes.stackList.add(n),n},createStack:function(e){var n;return void 0,n=new t({name:this.stackList().getNewName(),region:e},{initJsonData:!0}),this.attributes.stackList.add(n),n},createStackByJson:function(e){var n;return this.attributes.stackList.isNameAvailable(e.name)||(e.name=this.stackList().getNewName(e.name)),n=new t({name:e.name,region:e.region},{jsonData:e}),this.attributes.stackList.add(n),n},getPriceData:function(e){return(this.__appdata[e]||{}).price},getOsFamilyConfig:function(e){return(this.__appdata[e]||{}).osFamilyConfig},getInstanceTypeConfig:function(e){return(this.__appdata[e]||{}).instanceTypeConfig},getStateModule:function(e,t){return this.__stateModuleData[e+":"+t]},initialize:function(){this.__appdata={},this.__stateModuleData={},this.__initializeNotification()},fetch:function(){var e,t,r,i;return r=this,i=n("stack_list",{region_name:null}).then(function(e){return r.get("stackList").set(r.__parseListRes(e))}),e=n("app_list",{region_name:null}).then(function(e){return r.get("appList").set(r.__parseListRes(e))}),t=n("aws_aws",{fields:["region","price","region_ami_instance_type","instance_type"]}).then(function(e){var t,n,i,s,o,u,a,f,l,c,h,p,d,v,m;for(c=0,p=e.length;c<p;c++){i=e[c],o={},r.__appdata[i.region]={price:i.price,osFamilyConfig:i.region_ami_instance_type,instanceTypeConfig:o},v=i.instance_type;for(u in v){l=v[u];for(a in l){f=l[a];if(!f)continue;n=[f.name||"","","",""],m=(f.description||"").split(",");for(s=h=0,d=m.length;h<d;s=++h){t=m[s];if(s>2)break;n[s+1]=t}f.formated_desc=n,o[""+u+"."+a]=f}}}}),Q.all([i,e]).then(function(){var e;try{s.cleanup(r.appList().pluck("id").concat(r.stackList().pluck("id")))}catch(t){e=t}})},fetchStateModule:function(e,t){var r,i,s;return i=this.getStateModule(e,t),i?(r=Q.defer(),r.resolve(i),r.promise):(s=this,n("state_module",{mod_repo:e,mod_tag:t}).then(function(r){var i;try{r=JSON.parse(r)}catch(o){throw i=o,McError(n.Errors.InvalidRpcReturn,"Can't load state data. Please retry.")}return s.__stateModuleData[e+":"+t]=r,r}))},__parseListRes:function(e){var n,r,i,s;r=[];for(i=0,s=e.length;i<s;i++)n=e[i],r.push({id:n.id,updateTime:n.time_update,region:n.region,usage:n.usage,name:n.name,state:t.State[n.state]||t.State.UnRun,stoppable:!n.property||n.property.stoppable!==!1});return r},__initializeNotification:function(){var e;return e=this,App.WS.on("requestChange",function(t,n){return e.__processSingleNotification(t,n)})},__triggerNotification:_.debounce(function(){return this.trigger("change:notification")},400),__processSingleNotification:function(e){var t,n,r,i,s,o,u,a,f;s=App.WS.collection.request.findOne({_id:e});if(!s)return;r=this.__parseRequestInfo(s);if(!r)return;this.__handleRequestChange(r);if(r.operation==="save")return;n=this.attributes.notification;for(e=a=0,f=n.length;a<f;e=++a){t=n[e];if(t.id===r.id){o=t;break}}if(o&&_.isEqual(o.state,r.state))return;return r.readed=!App.WS.isReady(),!r.readed&&App.workspaces&&(u=App.workspaces.getAwakeSpace(),i=this.appList().get(r.targetId)||this.stackList().get(r.targetId),r.readed=u.isWorkingOn(i)),n.splice(e,1),n.splice(0,0,r),n.length>30&&(n.length=30),this.__triggerNotification(),null},__parseRequestInfo:function(e){var t,n,r,s,o,u,a,f,l;if(!e.brief)return;t=e.dag,s={id:e.id,region:i.REGION_SHORT_LABEL[e.region],time:e.time_end,operation:i.OPS_CODE_NAME[e.code],targetId:t&&t.spec?t.spec.id:e.rid,targetName:e.brief.split(" ")[2]||"",state:{processing:!0},readed:!0};switch(e.state){case i.OPS_STATE.OPS_STATE_FAILED:s.error=e.data,s.state={failed:!0};break;case i.OPS_STATE.OPS_STATE_INPROCESS:s.time=e.time_begin,s.step=0;if(e.dag&&e.dag.step){s.totalSteps=e.dag.step.length,l=e.dag.step;for(a=0,f=l.length;a<f;a++)r=l[a],r[1]==="done"&&++s.step}else s.totalSteps=1;break;case i.OPS_STATE.OPS_STATE_DONE:s.operation==="save"&&(s.targetId=e.data),s.state={completed:!0,terminated:e.code==="Forge.App.Terminate"};break;case i.OPS_STATE.OPS_STATE_PENDING:s.state={pending:!0},s.time=""}return s.time&&(s.time=MC.dateFormat(new Date(s.time*1e3),"hh:mm yyyy-MM-dd"),e.state!==i.OPS_STATE.OPS_STATE_INPROCESS&&(o=parseInt(e.time_begin,10),u=parseInt(e.time_end,10),!isNaN(o)&&!isNaN(u)&&u>=o&&(n=u-o,n<60?s.duration="Took "+n+" sec.":s.duration="Took "+Math.round(n/60)+" min."))),s},__handleRequestChange:function(e){var n;if(!App.WS.isReady()&&!e.state.processing)return;if(e.state.pending)return;n=this.appList().get(e.targetId),n||(n=this.appList().findWhere({requestId:e.id}),n&&e.targetId&&n.set("id",e.targetId));if(!n)return;if(!e.state.processing&&!n.isProcessing())return;if(n.testState(t.State.Terminating)&&e.operation!=="terminate"){void 0;return}return e.state.processing?n.setStatusProgress(e.step,e.totalSteps):n.setStatusWithWSEvent(e.operation,e.state,e.error)}})})}.call(this),function(){define("ide/User",["ApiRequest","backbone"],function(e){var t;return t={NotFirstTime:2},Backbone.Model.extend({initialize:function(){this.set({usercode:$.cookie("usercode"),username:MC.base64Decode($.cookie("usercode")),session:$.cookie("session_id")})},hasCredential:function(){return!!this.get("account")},isFirstVisit:function(){return!(t.NotFirstTime&this.get("state"))},userInfoAccuired:function(n){var r,i,s,o,u,a;i={email:MC.base64Decode(n.email),repo:n.mod_repo,tag:n.mod_tag,state:parseInt(n.state,10),intercomHash:n.intercom_secret,account:n.account_id,awsAccessKey:n.access_key,awsSecretKey:n.secret_key,tokens:n.tokens||[],defaultToken:""},n.account_id==="demo_account"&&(i.account=i.awsAccessKey=i.awsSecretKey=""),a=i.tokens;for(r=o=0,u=a.length;o<u;r=++o){s=a[r];if(!s.name){i.defaultToken=s.token,i.tokens.splice(r,1);break}}this.set(i),this.isFirstVisit()&&e("account_update_account",{attributes:{state:this.get("state")|t.NotFirstTime}})},bootIntercom:function(){var e;if(!window.Intercom){e=setInterval(function(t){return function(){window.Intercom&&(void 0,clearInterval(e),t.bootIntercom())}}(this),1e3);return}window.Intercom("boot",{app_id:"3rp02j1w",email:this.get("email"),username:this.get("username"),user_hash:this.get("intercomHash"),widget:{activator:"#support"}})},fetch:function(){var t;return t=this,e("session_login",{username:this.get("username"),password:this.get("session")}).then(function(n){t.userInfoAccuired(n),t.bootIntercom();if(t.hasCredential())return e("ec2_DescribeRegions").fail(function(){})},function(t){throw t.error<0?t.error===e.Errors.Network500?window.location="/500":window.location.reload():App.logout(),t})},acquireSession:function(t){return e("session_login",{username:this.get("username"),password:t}).then(function(e){return function(t){$.cookie("session_id",t.session_id,{expires:30,path:"/"}),e.set("session",t.session_id),e.userInfoAccuired(t),e.trigger("SessionUpdated")}}(this))},logout:function(){var e,t,n,r;n={domain:window.location.hostname.replace("ide","")},r=$.cookie();for(t in r)e=r[t],$.removeCookie(t,n),$.removeCookie(t)},changePassword:function(t,n){return e("account_update_account",{attributes:{password:t,new_password:n}})},validateCredential:function(t,n){var r;return e("account_validate_credential",{access_key:t,secret_key:n}),r=Q.defer(),r.resolve(),r.promise},changeCredential:function(t,n,r,i){var s;return t==null&&(t=""),n==null&&(n=""),r==null&&(r=""),i==null&&(i=!1),s=this,e("account_set_credential",{access_key:n,secret_key:r,account_id:t,force_update:i}).then(function(){var e;e={account:t,awsAccessKey:n,awsSecretKey:r},e.awsAccessKey.length>6&&(e.awsAccessKey=(new Array(n.length-6)).join("*")+n.substr(-6)),e.awsSecretKey.length>6&&(e.awsSecretKey=(new Array(r.length-6)).join("*")+r.substr(-6)),s.set(e),s.trigger("change:credential")})},createToken:function(){var t,n,r,i,s,o,u,a,f;o="MyToken",t=1,n={},f=this.attributes.tokens;for(u=0,a=f.length;u<a;u++)s=f[u],n[s.name]=!0;for(;;){r=o+t;if(!n[r])break;t+=1}return i=this,e("token_create",{token_name:r}).then(function(e){i.attributes.tokens.splice(0,0,{name:e[0],token:e[1]})})},removeToken:function(t){var n,r,i,s,o,u;u=this.attributes.tokens;for(n=s=0,o=u.length;s<o;n=++s){i=u[n];if(i.token===t)break}return r=this,e("token_remove",{token:t,token_name:i.name}).then(function(e){n=r.attributes.tokens.indexOf(i),n>=0&&r.attributes.tokens.splice(n,1)})},updateToken:function(t,n){var r;return r=this,e("token_update",{token:t,new_token_name:n}).then(function(e){var i,s,o,u,a;a=r.attributes.tokens;for(i=o=0,u=a.length;o<u;i=++o){s=a[i];if(s.token===t){s.name=n;break}}})}})})}.call(this),function(){define("ide/subviews/WorkspaceView",["backbone","jquerysort"],function(){return Backbone.View.extend({el:$("#tabbar-wrapper")[0],events:{"click li":"onClick","click .icon-close":"onClose"},initialize:function(e){var t;t=this,this.$el.find("#ws-tabs").dragsort({horizontal:!0,dragSelectorExclude:".fixed, .icon-close",dragEnd:function(){t.updateTabOrder()}})},updateTabOrder:function(){return this.trigger("orderChanged",this.tabOrder())},tabOrder:function(){return _.map(this.$el.find("li"),function(e){return e.id})},setTabIndex:function(e,t,n){var r,i,s;s=this.$el.find("#"+e);if(!s.length)return;t?i=$("#ws-fixed-tabs"):(i=$("#ws-tabs"),n-=$("#ws-fixed-tabs").children().length),r=i.children().eq(n),r.length?s.insertBefore(r):i.append(s)},addTab:function(e,t,n){var r,i,s;return t==null&&(t=-1),n==null&&(n=!1),r=n?$("#ws-fixed-tabs"):$("#ws-tabs"),s="<li class='"+e.klass+"' id='"+e.id+"'><span class='truncate'>"+e.title+"</span>",e.closable&&(s+='<i class="icon-close" title="Close Tab"></i>'),i=r.children().eq(t),i.length?$(s+"</li>").insertAfter(i):$(s+"</li>").appendTo(r)},removeTab:function(e){return this.$el.find("#"+e).remove()},updateTab:function(e,t,n){var r;r=this.$el.find("#"+e),(t!==void 0||t!==null)&&r.children("span").text(t);if(n!==void 0||n!==null)r.hasClass("active")&&(n+=" active"),r.attr("class",n)},activateTab:function(e){this.$el.find(".active").removeClass("active"),this.$el.find("#"+e).addClass("active")},onClick:function(e){this.trigger("click",e.currentTarget.id)},onClose:function(e){return this.trigger("close",$(e.currentTarget).closest("li")[0].id),!1},showLoading:function(){return $("#GlobalLoading").show()},hideLoading:function(){return $("#GlobalLoading").hide()}})})}.call(this),function(){define("ide/WorkspaceManager",["./subviews/WorkspaceView","underscore"],function(e){var t;return t=function(){function t(){var t;return this.view=new e,t=this,this.view.on("orderChanged",function(e){return t.__updateOrder(e)}),this.view.on("click",function(e){return t.awakeWorkspace(e)}),this.view.on("close",function(e){return t.remove(e)}),this.__spaces=[],this.__spacesById={},this.__awakeSpace=null,this}return t.prototype.__updateOrder=function(e){var t;t=this,this.__spaces=e.map(function(e){return t.__spacesById[e]})},t.prototype.spaces=function(){return this.__spaces.slice(0)},t.prototype.get=function(e){return this.__spacesById[e]},t.prototype.setIndex=function(e,t){this.view.setTabIndex(e.id,e.isFixed(),t),this.__updateOrder(this.view.tabOrder())},t.prototype.add=function(e){return this.__spacesById[e.id]=e,this.view.addTab({title:e.title(),id:e.id,closable:!e.isFixed(),klass:e.tabClass()},-1,e.isFixed()),this.__updateOrder(this.view.tabOrder()),this.__spaces.length===1&&this.awakeWorkspace(e),e},t.prototype.getAwakeSpace=function(){return this.__awakeSpace},t.prototype.awakeWorkspace=function(e){var t;if(!e)return;_.isString(e)&&(e=this.__spacesById[e]);if(this.__awakeSpace===e)return;if(e.isRemoved())return;this.__awakeSpace&&this.__awakeSpace.sleep(),this.__awakeSpace=e,this.__updateUrl(),this.view.activateTab(e.id),t=e.awake(),t&&t.then&&t.isFulfilled&&!t.isFulfilled()?(t.then(function(e){return function(){return e.view.hideLoading()}}(this)),this.view.showLoading()):this.view.hideLoading()},t.prototype.update=function(e){if(!e)return;return e===this.__awakeSpace&&this.__updateUrl(!0),this.view.updateTab(e.id,e.title(),e.tabClass()),e},t.prototype.remove=function(e,t){var n;if(!e)return;_.isString(e)&&(e=this.__spacesById[e]);if(!t&&!e.isRemovable())return;return n=e.id,this.view.removeTab(n),delete this.__spacesById[n],this.__spaces.splice(this.__spaces.indexOf(e),1),e.stopListening(),e.cleanup(),this.__awakeSpace===e&&(this.__awakeSpace=null,this.awakeWorkspace(this.__spaces[this.__spaces.length-1])),e},t.prototype.find=function(e){return _.find(this.__spaces,function(t){return t.isWorkingOn(e)})},t.prototype.hasUnsaveSpaces=function(){return this.__spaces.some(function(e){return e.isModified()})},t.prototype.__updateUrl=function(e){return e==null&&(e=!1),Router.navigate(this.__awakeSpace.url(),{replace:e})},t}(),t})}.call(this),function(){define("ide/Application",["ApiRequest","./Websocket","./ApplicationView","./ApplicationModel","./User","./subviews/SettingsDialog","CloudResources","./WorkspaceManager","OpsModel","JsonExporter","constant","underscore"],function(e,t,n,r,i,s,o,u,a,f,l){var c;return c=function(){if(window.App){void 0;return}window.App=this},c.prototype.initialize=function(){var e;return this.__createUser(),this.__createWebsocket(),this.workspaces=new u,this.model=new r,this.__view=new n,e=this.model.fetch().fail(function(e){throw notification("Cannot load application data. Please reload your browser."),e}),Q.all([this.user.fetch(),e])},c.prototype.__createWebsocket=function(){this.WS=new t,this.WS.on("Disconnected",function(e){return function(){return e.acquireSession()}}(this)),this.WS.on("StatusChanged",function(e){return function(t){void 0;if(e.__view)return e.__view.toggleWSStatus(t)}}(this))},c.prototype.__createUser=function(){this.user=new i,this.user.on("SessionUpdated",function(e){return function(){return e.WS.subscribe()}}(this)),this.user.on("change:credential",function(e){return function(){return e.discardAwsCache()}}(this))},c.prototype.acquireSession=function(){return this.__view.showSessionDialog()},c.prototype.logout=function(){var e;App.user.logout(),e=window.location.pathname,e==="/"&&(e=window.location.hash.replace("#","/")),e&&e!=="/"?window.location.href="/login?ref="+e:window.location.href="/login"},c.prototype.canQuit=function(){return!this.workspaces.hasUnsaveSpaces()},c.prototype.showSettings=function(e){return new s({defaultTab:e})},c.prototype.showSettings.TAB=s.TAB,c.prototype.askForAwsCredential=function(){return this.__view.askForAwsCredential()},c.prototype.deleteStack=function(e,t){return this.__view.deleteStack(e,t)},c.prototype.duplicateStack=function(e){return this.__view.duplicateStack(e)},c.prototype.startApp=function(e){return this.__view.startApp(e)},c.prototype.stopApp=function(e){return this.__view.stopApp(e)},c.prototype.terminateApp=function(e){return this.__view.terminateApp(e)},c.prototype.discardAwsCache=function(){return App.model.clearImportOps(),o.invalidate()},c.prototype.importJson=function(e){var t;return t=f.importJson(e),_.isString(t)?t:this.openOps(this.model.createStackByJson(t))},c.prototype.openOps=function(e,t){var n;if(!e)return;_.isString(e)&&(e=this.model.getOpsModelById(e));if(!e){void 0;return}if(e.testState(a.State.Destroyed)){void 0;return}return n=this.workspaces.find(e),n&&t&&(n.remove(),n=null),n||(n=new OpsEditor(e)),n.activate(),n},c.prototype.createOps=function(e){var t;if(!e)return;return t=new OpsEditor(this.model.createStack(e)),t.activate(),t},c})}.call(this),function(){define("Workspace",["backbone"],function(){var e,t;return t=0,e=function(){function e(e){var n,r,i,s;s=App.workspaces.spaces();for(r=0,i=s.length;r<i;r++){n=s[r];if(n instanceof this.constructor&&n.isWorkingOn(e))return void 0,n}return this.id="space_"+ ++t,this.initialize(e),App.workspaces.add(this),this}return e.prototype.isAwake=function(){return App.workspaces.getAwakeSpace()===this},e.prototype.index=function(){return App.workspaces.spaces().indexOf(this)},e.prototype.setIndex=function(e){return App.workspaces.setIndex(this,e)},e.prototype.isRemoved=function(){return!!this.__isRemoved},e.prototype.remove=function(){if(this.__isRemoved)return;return this.__isRemoved=!0,App.workspaces.remove(this,!0)},e.prototype.updateTab=function(){return App.workspaces.update(this)},e.prototype.activate=function(){return App.workspaces.awakeWorkspace(this)},e.prototype.initialize=function(e){},e.prototype.isFixed=function(){return!1},e.prototype.isModified=function(){return!1},e.prototype.tabClass=function(){return""},e.prototype.title=function(){return""},e.prototype.awake=function(){if(this.view)return this.view.$el.show()},e.prototype.sleep=function(){$(document.activeElement).filter("input, textarea").blur();if(this.view)return this.view.$el.hide()},e.prototype.cleanup=function(){this.view?this.view.remove():void 0},e.prototype.isRemovable=function(){return!0},e.prototype.isWorkingOn=function(e){return!1},e.prototype.updateUrl=function(){this.isAwake()&&Router.navigate(this.url(),{replace:!0})},e}(),_.extend(e.prototype,Backbone.Events),e})}.call(this),function(){define("ide/Router",["backbone"],function(){return Backbone.Router.extend({routes:{"":"openDashboard"},initialize:function(){this.route(/^ops\/([^/]+$)/,"openOps"),this.route(/^store\/([^/]+$)/,"openStore")},openStore:function(e){var t;t=App.model.stackList().findWhere({sampleId:e}),t||(t=App.model.createSampleOps(e)),Router.navigate(t.url(),{replace:!0}),App.openOps(t)},openOps:function(e){App.openOps(e)||Router.navigate("/",{replace:!0})},openDashboard:function(){if(window.Dashboard)return window.Dashboard.activate()},start:function(){Backbone.history.start({pushState:!0})||(void 0,this.navigate("/",{replace:!0})),this.route(/^ops\/([^/]+)/,"openOps")},execute:function(){this.__forceReplace=!0,Backbone.Router.prototype.execute.apply(this,arguments),this.__forceReplace=!1},navigate:function(e,t){return this.__forceReplace&&(t=t||{},t.replace=!0),Backbone.Router.prototype.navigate.apply(this,arguments)}})})}.call(this),function(){define("ide/AppBundle",["./Application","OpsModel","Workspace","./Router"],function(e){return e})}.call(this);