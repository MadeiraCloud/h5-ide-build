(function(){define("ide/Websocket",["Meteor","backbone","event","MC"],function(e,t,n){var r,i,s;return r=""+MC.API_HOST+"/ws/",e._debug=function(){return console.log.apply(console,arguments)},s=null,i=function(){var t;return s?s:(s=this,this.__readyDefer=Q.defer(),this.__isReady=!1,this.connection=e.connect(r,!0),t={connection:this.connection},this.collection={request:new e.Collection("request",t),request_detail:new e.Collection("request_detail",t),stack:new e.Collection("stack",t),app:new e.Collection("app",t),status:new e.Collection("status",t),imports:new e.Collection("imports",t),user_state:new e.Collection("user",t)},Deps.autorun(function(e){return function(){return e.statusChanged()}}(this)),this.subscribe(),this.pipeChanges(),setTimeout(function(e){return function(){e.shouldNotify=!0;if(!e.connection.status.connected)return e.statusChanged()}}(this),5e3),this)},i.prototype.statusChanged=function(){var e;e=this.connection.status().connected,e&&(this.shouldNotify=!0);if(!this.shouldNotify)return;return this.trigger("StatusChanged",e)},i.prototype.subscribe=function(){var e,t,n,r,i;if(this.subscribed)return;r=!0,t=function(){return this.__isReady=!0,this.__readyDefer.resolve()},i=App.user.get("usercode"),n=App.user.get("session"),e={onReady:_.bind(t,this),onError:_.bind(this.onError,this)},this.connection.subscribe("request",i,n,e),this.connection.subscribe("stack",i,n),this.connection.subscribe("app",i,n),this.connection.subscribe("status",i,n),this.connection.subscribe("imports",i,n),this.connection.subscribe("user",i,n)},i.prototype.ready=function(){return this.__readyDefer.promise},i.prototype.isReady=function(){return this.__isReady},i.prototype.onError=function(e){void 0,this.subscribed=!1,this.trigger("Disconnected")},i.prototype.pipeChanges=function(){var e;return e=this,this.collection.user_state.find().fetch(),this.collection.user_state.find().observeChanges({added:function(t,n){return e.trigger("userStateChange",t,n)},changed:function(t,n){return e.trigger("userStateChange",t,n)}}),this.collection.request.find().fetch(),this.collection.request.find().observeChanges({added:function(t,n){return e.trigger("requestChange",t,n)},changed:function(t,n){return e.trigger("requestChange",t,n)}}),this.collection.imports.find().fetch(),this.collection.imports.find().observe({added:function(t,n){return e.trigger("visualizeUpdate",t)},changed:function(t,n){return e.trigger("visualizeUpdate",t)}}),this.collection.status.find().fetch(),this.collection.status.find().observe({added:function(e,t){return n.trigger(n.UPDATE_STATE_STATUS_DATA,"add",e,t),n.trigger(n.UPDATE_STATE_STATUS_DATA_TO_EDITOR,e?[e.res_id]:[])},changed:function(e,t){return n.trigger(n.UPDATE_STATE_STATUS_DATA,"change",e,t),n.trigger(n.UPDATE_STATE_STATUS_DATA_TO_EDITOR,e?[e.res_id]:[])}})},_.extend(i.prototype,t.Events),i})}).call(this),define("ide/subviews/SessionDialogTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<section style="width:400px;" class="invalid-session" id="SessionDialog">\n  <div class="confirmSession">\n  <div class="modal-header"><h3>'+o(n.i18n.call(t,"IDE.DASH_INVALID_SESSION",{hash:{},data:i}))+'</h3></div>\n\n  <article class="modal-body">\n    <div class="modal-text-major">\n        <p>'+o(n.i18n.call(t,"IDE.DASH_INVALID_SESSION_ERROR",{hash:{},data:i}))+"</p>\n        <p>"+o(n.i18n.call(t,"IDE.DASH_INVALID_SESSION_ACTION",{hash:{},data:i}))+'</p>\n    </div>\n    <div class="modal-text-minor">'+o(n.i18n.call(t,"IDE.DASH_INVALID_SESSION_WARNING",{hash:{},data:i}))+'</div>\n  </article>\n\n  <footer class="modal-footer">\n    <button id="SessionReconnect" class="btn btn-blue">'+o(n.i18n.call(t,"IDE.DASH_LBL_RECONNECT",{hash:{},data:i}))+'</button>\n    <button id="SessionClose" class="btn btn-silver">'+o(n.i18n.call(t,"IDE.DASH_LBL_CLOSE_SESSION",{hash:{},data:i}))+'</button>\n  </footer>\n  </div>\n\n  <div class="reconnectSession" style="display:none;">\n  <div class="modal-header"><h3>'+o(n.i18n.call(t,"IDE.DASH_RECONNECT_SESSION",{hash:{},data:i}))+'</h3></div>\n  <article class="modal-body">\n    <div class="modal-text-major">'+o(n.i18n.call(t,"IDE.DASH_PROVIDE_PASSWORD_TO_RECONNECT",{hash:{},data:i}))+'</div>\n    <div class="modal-input">\n      <input type="password" id="SessionPassword" class="input" placeholder="Password" style="width:200px;" autofocus>\n    </div>\n  </article>\n  <footer class="modal-footer">\n    <button id="SessionConnect" class="btn btn-blue" disabled>'+o(n.i18n.call(t,"IDE.DASH_LBL_CONNECT",{hash:{},data:i}))+'</button>\n    <button id="SessionClose2" class="btn btn-red">'+o(n.i18n.call(t,"IDE.DASH_LBL_CLOSE_SESSION",{hash:{},data:i}))+"</button>\n  </footer>\n  </div>\n</section>",s};return e.template(t)}),function(){define("ide/subviews/SessionDialog",["i18n!/nls/lang.js","./SessionDialogTpl","backbone"],function(e,t){var n,r;return n=null,r=Backbone.View.extend({events:{"click #SessionReconnect":"showReconnect","click #SessionClose":"closeSession","click #SessionClose2":"closeSession","click #SessionConnect":"connect","keyup #SessionPassword":"passwordChanged"},constructor:function(){return n?n:(n=this,this.defer=Q.defer(),modal(t(),!1),this.setElement($("#modal-wrap")))},promise:function(){return this.defer.promise},showReconnect:function(){$(".invalid-session .confirmSession").hide(),$(".invalid-session .reconnectSession").show()},closeSession:function(){return App.logout()},connect:function(){if($("#SessionConnect").is(":disabled"))return;return $("#SessionConnect").attr("disabled","disabled"),App.user.acquireSession($("#SessionPassword").val()).then(function(e){return function(){e.remove(),e.defer.resolve()}}(this),function(t){$("#SessionConnect").removeAttr("disabled"),notification("error",e.NOTIFY.WARN_AUTH_FAILED),$("#SessionPassword").toggleClass("parsley-error",!0)})},passwordChanged:function(e){$("#SessionPassword").toggleClass("parsley-error",!1),($("#SessionPassword").val()||"").length>=6?$("#SessionConnect").removeAttr("disabled"):$("#SessionConnect").attr("disabled","disabled"),e.which===13&&this.connect()}}),r})}.call(this),define("ide/subviews/HeaderTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<nav id="header">\n  <section class="voquota tooltip" data-tooltip="<span>3600 free instance hours used up <br>\nYou are in limited status now</span>" data-tooltip-type="html">\n      <div class="payment-exclamation">!</div>\n  </section>\n  <a id="support" class="icon-support" href="mailto:3rp02j1w@incoming.intercom.io" target="_blank">'+u(n.i18n.call(t,"IDE.DASH_LBL_SUPPORT",{hash:{},data:i}))+'</a>\n\n  <section class="dropdown">\n    <div id="HeaderNotification" class="js-toggle-dropdown">\n      <i class="icon-notification"></i>\n      <span id="NotificationCounter"></span>\n    </div>\n\n    <div class="dropdown-menu">\n      <div id="notification-panel-wrapper" class="scroll-wrap">\n        <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\n        <ul class="scroll-content"></ul>\n\n        <div class="notification-empty">\n          <div class="title">'+u(n.i18n.call(t,"IDE.HEAD_LABEL_BLANK_NOTIFICATION",{hash:{},data:i}))+'</div>\n          <div class="description">'+u(n.i18n.call(t,"HEAD_LABEL_BLANK_NOTIFICATION_DESC",{hash:{},data:i}))+'</div>\n        </div>\n      </div>\n\n    </div>\n  </section>\n\n  <section class="dropdown">\n    <div id="HeaderUser" class="js-toggle-dropdown">\n      <span class="truncate left" style="max-width:100px;">'+u((o=t&&t.username,typeof o===a?o.apply(t):o))+'</span>\n      <i class="icon-caret-down"></i>\n    </div>\n\n    <ul class="dropdown-menu">\n      <li id="HeaderShortcuts">'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_KEY_SHORT",{hash:{},data:i}))+'</li>\n      <li><a class="dis-blk" href="http://docs.visualops.io" target="_blank" >'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_DOC",{hash:{},data:i}))+'</a></li>\n      <li id="HeaderSettings">'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_SETTING",{hash:{},data:i}))+'</li>\n      <li id="HeaderBilling">'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_BILLING",{hash:{},data:i}))+'</li>\n      <li id="HeaderLogout">'+u(n.i18n.call(t,"HEAD_LABEL_MENUITEM_LOGOUT",{hash:{},data:i}))+"</li>\n    </ul>\n  </section>\n</nav>",s};return e.template(t)}),define("ide/subviews/SettingsDialogTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){return'style="display:block;"'}function c(e,t){var r="";return r+='\n        <button id="CredSetupRemove" class="link-style">'+u(n.i18n.call(e,"SETTINGS_LABEL_REMOVE_CREDENTIAL",{hash:{},data:t}))+"</button>\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<nav id="SettingsNav">\n  <span data-target="AccountTab">'+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT",{hash:{},data:i}))+'</span>\n  <span data-target="CredentialTab">'+u(n.i18n.call(t,"HEAD_LABEL_CREDENTIAL",{hash:{},data:i}))+'</span>\n  <span data-target="TokenTab">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCESSTOKEN",{hash:{},data:i}))+'</span>\n</nav>\n\n<div class="tabContent" id="SettingsBody">\n  <section id="AccountTab">\n    <dl class="dl-horizontal">\n      <dt>'+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT_USERNAME",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.username,typeof o===a?o.apply(t):o))+'</dd>\n    </dl>\n\n    <dl class="dl-horizontal">\n      <dt class="accountFullNameRO">'+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT_FULLNAME",{hash:{},data:i}))+'</dt><dd class="accountFullNameRO"> <span class="fullNameText">'+u((o=t&&t.firstName,typeof o===a?o.apply(t):o))+" "+u((o=t&&t.lastName,typeof o===a?o.apply(t):o))+' </span> <button class="icon-edit link-style tooltip" data-tooltip=\''+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT_FULLNAME",{hash:{},data:i}))+'\' id="AccountFullName"></button></dd>\n    </dl>\n    <div id="AccountFullNameWrap" class="accountEditWrap">\n      <dl class="dl-horizontal">\n          <dt>'+u(n.i18n.call(t,"FIRST_NAME",{hash:{},data:i}))+'</dt>\n          <dd><input type="text" class="input" id="AccountFirstName"/></dd>\n          <dt>'+u(n.i18n.call(t,"LAST_NAME",{hash:{},data:i}))+'</dt>\n          <dd><input type="text" class="input" id="AccountLastName"/></dd>\n      </dl>\n      <div id="AccountFullNameInfo" class="empty-hide"></div>\n      <div class="accountPwdBtns">\n          <button class="btn btn-blue" id="AccountUpdateFullName" disabled>'+u(n.i18n.call(t,"HEAD_BTN_UPDATE",{hash:{},data:i}))+'</button>\n          <span id="AccountCancelFullName" class="link-style">'+u(n.i18n.call(t,"HEAD_BTN_CANCEL",{hash:{},data:i}))+'</span>\n      </div>\n    </div>\n\n    <dl class="dl-horizontal">\n      <dt class="accountEmailRO">'+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT_EMAIL",{hash:{},data:i}))+'</dt><dd class="accountEmailRO"><span>'+u((o=t&&t.email,typeof o===a?o.apply(t):o))+'</span><button class="icon-edit link-style tooltip" data-tooltip=\''+u(n.i18n.call(t,"HEAD_LABEL_NEW_EMAIL",{hash:{},data:i}))+'\' id="AccountEmail"></button></dd>\n    </dl>\n    <div id="AccountEmailWrap" class="accountEditWrap">\n      <dl class="dl-horizontal">\n        <dt>'+u(n.i18n.call(t,"HEAD_LABEL_NEW_EMAIL",{hash:{},data:i}))+'</dt>\n        <dd><input type="string" class="input" id="AccountNewEmail" /></dd>\n\n        <dt>'+u(n.i18n.call(t,"HEAD_LABEL_CURRENT_PASSWORD",{hash:{},data:i}))+'</dt>\n        <dd><input type="password" class="input" id="AccountEmailPwd" /></dd>\n      </dl>\n\n      <div id="AccountEmailInfo" class="empty-hide"></div>\n\n      <div class="accountPwdBtns">\n        <button class="btn btn-blue" id="AccountUpdateEmail" disabled>'+u(n.i18n.call(t,"HEAD_BTN_UPDATE",{hash:{},data:i}))+'</button>\n        <span id="AccountCancelEmail" class="link-style">'+u(n.i18n.call(t,"HEAD_BTN_CANCEL",{hash:{},data:i}))+'</span>\n      </div>\n    </div>\n\n    <button id="AccountPwd" class="link-style">'+u(n.i18n.call(t,"HEAD_LABEL_CHANGE_PASSWORD",{hash:{},data:i}))+'</button>\n    <div id="AccountPwdWrap" class="accountEditWrap">\n\n      <dl class="dl-horizontal">\n        <dt>'+u(n.i18n.call(t,"HEAD_LABEL_CURRENT_PASSWORD",{hash:{},data:i}))+'</dt>\n        <dd><input type="password" class="input" id="AccountCurrentPwd" /></dd>\n\n        <dt>'+u(n.i18n.call(t,"HAED_LABEL_NEW_PASSWORD",{hash:{},data:i}))+'</dt>\n        <dd><input type="password" class="input" id="AccountNewPwd" /></dd>\n      </dl>\n\n      <div id="AccountInfo" class="empty-hide"></div>\n\n      <div class="accountPwdBtns">\n        <button class="btn btn-blue" id="AccountUpdatePwd" disabled>'+u(n.i18n.call(t,"HEAD_BTN_UPDATE",{hash:{},data:i}))+'</button>\n        <span id="AccountCancelPwd" class="link-style">'+u(n.i18n.call(t,"HEAD_BTN_CANCEL",{hash:{},data:i}))+'</span>\n      </div>\n    </div>\n  </section>\n\n  <section id="CredentialTab">\n    <div id="CredDemoWrap" ',o=n.unless.call(t,t&&t.account,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+=">\n      <h3>"+u(n.i18n.call(t,"SETTINGS_CRED_DEMO_TIT",{hash:{},data:i}))+"</h3>\n      <p>"+u(n.i18n.call(t,"SETTINGS_CRED_DEMO_TEXT",{hash:{},data:i}))+'</p>\n      <p class="tac"><button class="btn btn-blue cred-setup">'+u(n.i18n.call(t,"SETTINGS_CRED_DEMO_SETUP",{hash:{},data:i}))+'</button></p>\n    </div>\n\n    <div id="CredAwsWrap" class="pos-r" ',o=n["if"].call(t,t&&t.account,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+=">\n      <h3>"+u(n.i18n.call(t,"SETTINGS_CRED_CONNECTED_TIT",{hash:{},data:i}))+'</h3>\n      <button class="cred-setup link-style">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_UPDATE",{hash:{},data:i}))+'</button>\n      <dl class="dl-horizontal cred-setup-msg" style="margin-top:15px;">\n        <dt>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNTID",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.account,typeof o===a?o.apply(t):o))+"</dd>\n        <dt>"+u(n.i18n.call(t,"SETTINGS_LABEL_ACCESSKEY",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.awsAccessKey,typeof o===a?o.apply(t):o))+"</dd>\n        <dt>"+u(n.i18n.call(t,"SETTINGS_LABEL_SECRETKEY",{hash:{},data:i}))+"</dt><dd>"+u((o=t&&t.awsSecretKey,typeof o===a?o.apply(t):o))+'</dd>\n      </dl>\n    </div>\n\n    <div id="CredSetupWrap">\n      <div id="CredSetupMsg" class="cred-setup-msg empty-hide"></div>\n      <ul>\n        <li>\n          <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_ACCOUNTID",{hash:{},data:i}))+'"></i>\n          <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNTID",{hash:{},data:i}))+'</label>\n          <input autocomplete="off" class="input" id="CredSetupAccount" type="text" value="'+u((o=t&&t.account,typeof o===a?o.apply(t):o))+'">\n        </li>\n        <li>\n          <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_ACCESSKEY",{hash:{},data:i}))+'"></i>\n          <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCESSKEY",{hash:{},data:i}))+'</label>\n          <input autocomplete="off" class="input" id="CredSetupAccessKey" type="text" placeholder="'+u((o=t&&t.awsAccessKey,typeof o===a?o.apply(t):o))+'">\n        </li>\n        <li>\n          <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_SECRETKEY",{hash:{},data:i}))+'"></i>\n          <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_SECRETKEY",{hash:{},data:i}))+'</label>\n          <input autocomplete="off" class="input" id="CredSetupSecretKey" type="password" placeholder="'+u((o=t&&t.awsSecretKey,typeof o===a?o.apply(t):o))+'">\n        </li>\n      </ul>\n\n      <div class="cred-btn-wrap clearfix">\n        ',o=n.unless.call(t,t&&t.credNeeded,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='\n        <button class="right link-style cred-setup-cancel">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_CANCEL",{hash:{},data:i}))+'</button>\n        <button id="CredSetupSubmit" class="btn btn-blue right">'+u(n.i18n.call(t,"HEAD_BTN_SUBMIT",{hash:{},data:i}))+'</button>\n      </div>\n\n    </div>\n\n    <div id="CredRemoveWrap">\n      <h3>'+u((o=t&&t.credRemoveTitle,typeof o===a?o.apply(t):o))+"</h3>\n      <div>"+u(n.i18n.call(t,"SETTINGS_CRED_REMOVE_TEXT",{hash:{},data:i}))+'</div>\n      <div class="cred-btn-wrap clearfix">\n        <button class="right link-style cred-cancel">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_CANCEL",{hash:{},data:i}))+'</button>\n        <button id="CredRemoveConfirm" class="btn btn-red right">'+u(n.i18n.call(t,"SETTINGS_LABEL_REMOVE_CREDENTIAL",{hash:{},data:i}))+'</button>\n      </div>\n    </div>\n\n    <div id="CredConfirmWrap">\n      <h3>'+u(n.i18n.call(t,"SETTINGS_CRED_UPDATE_CONFIRM_TIT",{hash:{},data:i}))+"</h3>\n      <div>"+u(n.i18n.call(t,"SETTINGS_CRED_UPDATE_CONFIRM_TEXT",{hash:{},data:i}))+'</div>\n      <div class="cred-btn-wrap clearfix">\n        <button class="right link-style cred-cancel">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_CANCEL",{hash:{},data:i}))+'</button>\n        <button id="CredSetupConfirm" class="btn btn-red right">'+u(n.i18n.call(t,"SETTINGS_LABEL_UPDATE_CONFIRM",{hash:{},data:i}))+'</button>\n      </div>\n    </div>\n\n    <div id="CredRemoving"><p>'+u(n.i18n.call(t,"SETTINGS_CRED_REMOVING",{hash:{},data:i}))+'</p><div class="loading-spinner"></div></div>\n    <div id="CredUpdating"><p>'+u(n.i18n.call(t,"SETTINGS_CRED_UPDATING",{hash:{},data:i}))+'</p><div class="loading-spinner"></div></div>\n\n  </section>\n\n  <section id="TokenTab">\n    <div id="TokenManager">\n      <p class="clearfix"><button class="btn btn-blue right" id="TokenCreate">'+u(n.i18n.call(t,"SETTINGS_BTN_TOKEN_CREATE",{hash:{},data:i}))+"</button>"+u(n.i18n.call(t,"SETTINGS_INFO_TOKEN",{hash:{},data:i}))+'<a href="http://docs.visualops.io/app_management/reload_states.html" target="_blank">'+u(n.i18n.call(t,"SETTINGS_INFO_TOKEN_LINK",{hash:{},data:i}))+'</a> </p>\n      <section class="token-table">\n        <header class="clearfix">\n          <span class="tokenName">'+u(n.i18n.call(t,"SETTINGS_LABEL_TOKENTABLE_NAME",{hash:{},data:i}))+'</span>\n          <span class="tokenToken">'+u(n.i18n.call(t,"SETTINGS_LABEL_TOKENTABLE_TOKEN",{hash:{},data:i}))+'</span>\n        </header>\n        <div class="scroll-wrap">\n          <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\n          <ul id="TokenList" class="scroll-content" data-empty="'+u(n.i18n.call(t,"SETTINGS_INFO_TOKEN_EMPTY",{hash:{},data:i}))+'"></ul>\n        </div>\n      </section>\n    </div>\n    <div id="TokenRmConfirm" class="hide">\n      <h3 id="TokenRmTit"></h3>\n      <p>'+u(n.i18n.call(t,"SETTINGS_CONFIRM_TOKEN_RM",{hash:{},data:i}))+'</p>\n      <div class="cred-btn-wrap clearfix">\n        <button class="right link-style" id="TokenRmCancel">'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNT_CANCEL",{hash:{},data:i}))+'</button>\n        <button id="TokenRemove" class="btn btn-red right">'+u(n.i18n.call(t,"SETTINGS_BTN_TOKEN_REMOVE",{hash:{},data:i}))+"</button>\n      </div>\n    </div>\n  </section>\n</div>",s};return e.template(t)}),function(){define("ide/subviews/SettingsDialog",["./SettingsDialogTpl","i18n!/nls/lang.js","ApiRequest","UI.modalplus","backbone"],function(e,t,n,r){var i;return i=Backbone.View.extend({events:{"click #SettingsNav span":"switchTab","click #AccountPwd":"showPwd","click #AccountCancelPwd":"hidePwd","click #AccountUpdatePwd":"changePwd","click .cred-setup, .cred-cancel":"showCredSetup","click .cred-setup-cancel":"cancelCredSetup","click #CredSetupRemove":"showRemoveCred","click #CredRemoveConfirm":"removeCred","click #CredSetupSubmit":"submitCred","click #CredSetupConfirm":"confirmCred","click #TokenCreate":"createToken","click .tokenControl .icon-edit":"editToken","click .tokenControl .icon-delete":"removeToken","click .tokenControl .tokenDone":"doneEditToken","click #TokenRemove":"confirmRmToken","click #TokenRmCancel":"cancelRmToken","keyup  #CredSetupAccount, #CredSetupAccessKey, #CredSetupSecretKey":"updateSubmitBtn","change #CredSetupAccount, #CredSetupAccessKey, #CredSetupSecretKey":"updateSubmitBtn","change #AccountCurrentPwd, #AccountNewPwd":"updatePwdBtn","keyup  #AccountCurrentPwd, #AccountNewPwd":"updatePwdBtn","click #AccountEmail":"showEmail","click #AccountCancelEmail":"hideEmail","click #AccountUpdateEmail":"changeEmail","click #AccountCancelFullName":"hideFullName","change #AccountNewEmail, #AccountEmailPwd":"updateEmailBtn","keyup  #AccountNewEmail, #AccountEmailPwd":"updateEmailBtn","click #AccountUpdateFullName":"changeFullName","change #AccountFirstName, #AccountLastName":"updateFullNameBtn","keyup #AccountFirstName, #AccountLastName":"updateFullNameBtn","click #AccountFullName":"showFullName"},initialize:function(n){var s,o;s={username:App.user.get("username"),firstName:App.user.get("firstName")||"",lastName:App.user.get("lastName")||"",email:App.user.get("email"),account:App.user.get("account"),awsAccessKey:App.user.get("awsAccessKey"),awsSecretKey:App.user.get("awsSecretKey"),credRemoveTitle:sprintf(t.IDE.SETTINGS_CRED_REMOVE_TIT,App.user.get("username")),credNeeded:!!App.model.appList().length},this.modal=new r({template:e(s),title:t.IDE.HEAD_LABEL_SETTING,disableFooter:!0,compact:!0,width:"490px"}),this.setElement(this.modal.tpl),this.modal.$("#SettingsNav span[data-target='AccountTab']").click(),this.modal.resize(),o=0,n&&(o=n.defaultTab||0,o===i.TAB.CredentialInvalid&&(this.showCredSetup(),this.modal.tpl.find(".modal-close").hide(),this.modal.tpl.find("#CredSetupMsg").text(t.IDE.SETTINGS_ERR_CRED_VALIDATE)),o<0&&(o=Math.abs(o))),this.modal.$("#SettingsNav").children().eq(o).click(),this.updateTokenTab()},updateCredSettings:function(){var n;return n={username:App.user.get("username"),email:App.user.get("email"),account:App.user.get("account"),awsAccessKey:App.user.get("awsAccessKey"),awsSecretKey:App.user.get("awsSecretKey"),credRemoveTitle:sprintf(t.IDE.SETTINGS_CRED_REMOVE_TIT,App.user.get("username"))},this.modal.setContent(e(n)),this.modal.$("#SettingsNav").children().eq(i.TAB.Credential).click()},switchTab:function(e){var t;t=$(e.currentTarget);if(t.hasClass("selected"))return;this.modal.$("#SettingsBody").children().hide(),this.modal.$("#SettingsNav").children().removeClass("selected"),this.modal.$("#"+t.addClass("selected").attr("data-target")).show()},showPwd:function(){this.modal.$("#AccountPwd").hide(),this.modal.$("#AccountPwdWrap").show(),this.modal.$("#AccountCurrentPwd").focus()},hidePwd:function(){this.modal.$("#AccountPwd").show(),this.modal.$("#AccountPwdWrap").hide(),this.modal.$("#AccountCurrentPwd, #AccountNewPwd").val(""),this.modal.$("#AccountInfo").empty()},updatePwdBtn:function(){var e,t;t=this.modal.$("#AccountCurrentPwd").val()||"",e=this.modal.$("#AccountNewPwd").val()||"",t.length&&e.length?this.modal.$("#AccountUpdatePwd").removeAttr("disabled"):this.modal.$("#AccountUpdatePwd").attr("disabled","disabled")},changePwd:function(){var e,n,r;r=this,n=this.modal.$("#AccountCurrentPwd").val()||"",e=this.modal.$("#AccountNewPwd").val()||"";if(e.length<6){this.modal.$("#AccountInfo").text(t.IDE.SETTINGS_ERR_INVALID_PWD);return}this.modal.$("#AccountInfo").empty(),this.modal.$("#AccountUpdatePwd").attr("disabled","disabled"),App.user.changePassword(n,e).then(function(){notification("info",t.NOTIFY.SETTINGS_UPDATE_PWD_SUCCESS),$("#AccountCancelPwd").click()},function(e){return e.error===2?r.modal.$("#AccountInfo").html(""+t.IDE.SETTINGS_ERR_WRONG_PWD+" <a href='/reset/' target='_blank'>"+t.IDE.SETTINGS_INFO_FORGET_PWD+"</a>"):r.modal.$("#AccountInfo").text(t.IDE.SETTINGS_UPDATE_PWD_FAILURE),r.modal.$("#AccountUpdatePwd").removeAttr("disabled")})},showEmail:function(){this.hideFullName(),$(".accountEmailRO").hide(),$("#AccountEmailWrap").show(),$("#AccountNewEmail").focus()},hideEmail:function(){$(".accountEmailRO").show(),$("#AccountEmailWrap").hide(),$("#AccountNewEmail, #AccountEmailPwd").val(""),$("#AccountEmailInfo").empty()},showFullName:function(){this.hideEmail(),$(".accountFullNameRO").hide(),$("#AccountFullNameWrap").show(),$("#AccountFirstName").val(App.user.get("firstName")||"").focus(),$("#AccountLastName").val(App.user.get("lastName")||"")},hideFullName:function(){return $(".accountFullNameRO").show(),$("#AccountFullNameWrap").hide(),$("#AccountFirstName, #AccountLastName").val(""),$("#AccountUpdateFullName").attr("disabled",!1)},updateEmailBtn:function(){var e,t;t=$("#AccountNewEmail").val()||"",e=$("#AccountEmailPwd").val()||"",t.length&&e.length>=6?$("#AccountUpdateEmail").removeAttr("disabled"):$("#AccountUpdateEmail").attr("disabled","disabled")},updateFullNameBtn:function(){var e,t;e=$("#AccountFirstName").val()||"",t=$("#AccountLastName").val()||"",e.length&&t.length?$("#AccountUpdateFullName").removeAttr("disabled"):$("#AccountUpdateFullName").attr("disabled","disabled")},changeFullName:function(){var e,n,r;r=this,e=$("#AccountFirstName").val()||"",n=$("#AccountLastName").val()||"";if(e&&n)return $("#AccountUpdateFullName").attr("disabled",!0),App.user.changeName(e,n).then(function(i){r.hideFullName(),$(".fullNameText").text(e+" "+n);if(i)return notification("info",t.NOTIFY.UPDATED_FULLNAME_SUCCESS)},function(e){return notification("error",t.NOTIFY.UPDATED_FULLNAME_FAIL),$("#AccountUpdateFullName").attr("disabled",!1),void 0})},changeEmail:function(){var e,n;e=$("#AccountNewEmail").val()||"",n=$("#AccountEmailPwd").val()||"",$("#AccountEmailInfo").empty(),$("#AccountUpdateEmail").attr("disabled","disabled"),App.user.changeEmail(e,n).then(function(){notification("info",t.NOTIFY.SETTINGS_UPDATE_EMAIL_SUCCESS),$("#AccountCancelEmail").click(),$(".accountEmailRO").children("span").text(App.user.get("email"))},function(e){var n;switch(e.error){case 116:n=t.IDE.SETTINGS_UPDATE_EMAIL_FAIL3;break;case 117:n=t.IDE.SETTINGS_UPDATE_EMAIL_FAIL2;break;default:n=t.IDE.SETTINGS_UPDATE_EMAIL_FAIL1}return $("#AccountEmailInfo").text(n),$("#AccountUpdateEmail").removeAttr("disabled")})},showCredSetup:function(){this.modal.$("#CredentialTab").children().hide(),this.modal.$("#CredSetupWrap").show(),this.modal.$("#CredSetupAccount").focus()[0].select(),this.modal.$("#CredSetupRemove").toggle(App.user.hasCredential()),this.updateSubmitBtn()},cancelCredSetup:function(){this.modal.$("#CredentialTab").children().hide(),App.user.hasCredential()?this.modal.$("#CredAwsWrap").show():this.modal.$("#CredDemoWrap").show()},showRemoveCred:function(){this.modal.$("#CredentialTab").children().hide(),this.modal.$("#CredRemoveWrap").show()},removeCred:function(){var e;this.modal.$("#CredentialTab").children().hide(),this.modal.$("#CredRemoving").show(),this.modal.$("#modal-box .modal-close").hide(),e=this,App.user.changeCredential().then(function(){e.updateCredSettings()},function(){return e.modal.$("#CredSetupMsg").text(t.IDE.SETTINGS_ERR_CRED_REMOVE),e.modal.$("#modal-box .modal-close").show(),e.showCredSetup()})},updateSubmitBtn:function(){var e,t,n;t=this.modal.$("#CredSetupAccount").val(),e=this.modal.$("#CredSetupAccessKey").val(),n=this.modal.$("#CredSetupSecretKey").val(),t.length&&e.length&&n.length?this.modal.$("#CredSetupSubmit").removeAttr("disabled"):this.modal.$("#CredSetupSubmit").attr("disabled","disabled")},submitCred:function(){var e,n,r;return this.modal.$("#CredentialTab").children().hide(),this.modal.$("#CredUpdating").show(),this.modal.$("#modal-box .modal-close").hide(),e=this.modal.$("#CredSetupAccessKey").val(),n=this.modal.$("#CredSetupSecretKey").val(),r=this,App.user.validateCredential(e,n).then(function(){r.setCred()},function(){r.modal.$("#CredSetupMsg").text(t.IDE.SETTINGS_ERR_CRED_VALIDATE),r.modal.$("#modal-box .modal-close").show(),r.showCredSetup()})},setCred:function(){var e,t,r,i;return t=this.modal.$("#CredSetupAccount").val(),e=this.modal.$("#CredSetupAccessKey").val(),r=this.modal.$("#CredSetupSecretKey").val(),t==="demo_account"&&(t="user_demo_account",this.modal.$("#CredSetupAccount").val(t)),i=this,App.user.changeCredential(t,e,r,!1).then(function(){return i.updateCredSettings()},function(e){e.error===n.Errors.ChangeCredConfirm?i.showCredConfirm():i.showCredUpdateFail()})},showCredUpdateFail:function(){return this.modal.$("#CredSetupMsg").text(t.IDE.SETTINGS_ERR_CRED_UPDATE),this.modal.$("#modal-box .modal-close").show(),this.showCredSetup()},showCredConfirm:function(){return this.modal.$("#CredentialTab").children().hide(),this.modal.$("#CredConfirmWrap").show(),this.modal.$("#modal-box .modal-close").show()},confirmCred:function(){var e,t,n,r;t=this.modal.$("#CredSetupAccount").val(),e=this.modal.$("#CredSetupAccessKey").val(),n=this.modal.$("#CredSetupSecretKey").val(),r=this,App.user.changeCredential(t,e,n,!0).then(function(){return r.updateCredSettings()},function(){return r.showCredUpdateFail()})},editToken:function(e){var t,n;n=$(e.currentTarget),t=n.closest("li").toggleClass("editing",!0),t.children(".tokenName").removeAttr("readonly").focus().select()},removeToken:function(e){var n,r;n=$(e.currentTarget).closest("li"),r=n.children(".tokenName").val(),this.rmToken=n.children(".tokenToken").text(),this.modal.$("#TokenManager").hide(),this.modal.$("#TokenRmConfirm").show(),this.modal.$("#TokenRmTit").text(sprintf(t.IDE.SETTINGS_CONFIRM_TOKEN_RM_TIT,r))},createToken:function(){var e;this.modal.$("#TokenCreate").attr("disabled","disabled"),e=this,App.user.createToken().then(function(){return e.updateTokenTab(),e.modal.$("#TokenCreate").removeAttr("disabled")},function(){return notification("error",t.NOTIFY.FAIL_TO_CREATE_TOKEN),e.modal.$("#TokenCreate").removeAttr("disabled")})},doneEditToken:function(e){var n,r,i,s,o,u,a,f,l;n=$(e.currentTarget).closest("li").removeClass("editing"),n.children(".tokenName").attr("readonly",!0),u=n.children(".tokenToken").text(),i=n.children(".tokenName").val(),l=App.user.get("tokens");for(a=0,f=l.length;a<f;a++)o=l[a],o.token===u?s=o.name:o.name===i&&(r=!0);if(!i||r){n.children(".tokenName").val(s);return}App.user.updateToken(u,i).fail(function(){return s="",n.children(".tokenName").val(s),notification("error",t.NOTIFY.FAIL_TO_UPDATE_TOKEN)})},confirmRmToken:function(){var e;this.modal.$("#TokenRemove").attr("disabled","disabled"),e=this,App.user.removeToken(this.rmToken).then(function(){return e.updateTokenTab(),e.cancelRmToken()},function(){return notification(t.NOTIFY.FAIL_TO_DELETE_TOKEN),e.cancelRmToken()})},cancelRmToken:function(){this.rmToken="",this.modal.$("#TokenRemove").removeAttr("disabled"),this.modal.$("#TokenManager").show(),this.modal.$("#TokenRmConfirm").hide()},updateTokenTab:function(){var e;e=App.user.get("tokens"),this.modal.$("#TokenManager").find(".token-table").toggleClass("empty",e.length===0),e.length?this.modal.$("#TokenList").html(MC.template.accessTokenTable(e)):this.modal.$("#TokenList").empty()}}),i.TAB={CredentialInvalid:-1,Normal:0,Credential:1,Token:2},i})}.call(this),define("ide/subviews/BillingDialogTpl",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var n;return a((n=(n=e&&e.paymentUpdate,n==null||n===!1?n:n.card),typeof n===u?n.apply(e):n))}function c(e,t){return a(n.i18n.call(e,"NO_CARD",{hash:{},data:t}))}function h(e,t){var r="",i;r+='\n                <table class="table-head">\n                    <thead>\n                    <tr>\n                        <th class="sortable desc-sort" data-row-type="datetime" style="width:25%;">'+a(n.i18n.call(e,"DATE",{hash:{},data:t}))+'</th>\n                        <th data-row-type="string" style="width:25%;">'+a(n.i18n.call(e,"AMOUNT",{hash:{},data:t}))+'</th>\n                        <th data-row-type="string" style="width:25%;">'+a(n.i18n.call(e,"STATUS",{hash:{},data:t}))+'</th>\n                        <th data-row-type="string" style="width:25%;">'+a(n.i18n.call(e,"ACTION",{hash:{},data:t}))+'</th>\n                    </tr>\n                    </thead>\n                </table>\n                <div class="scroll-wrap" style="max-height:200px;">\n                    <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\n                    <div class="scroll-content">\n                        <table class="table">\n                            <thead>\n                            <tr>\n                                <th style="width: 25%">\n                                    <div class="th-inner"></div>\n                                </th>\n                                <th style="width: 25%">\n                                    <div class="th-inner"></div>\n                                </th>\n                                <th style="width: 25%">\n                                    <div class="th-inner"></div>\n                                </th>\n                                <th style="width: 25%">\n                                    <div class="th-inner"></div>\n                                </th>\n                            </tr>\n                            </thead>\n                            <tbody class="t-m-content">\n                            ',i=n.each.call(e,e&&e.paymentHistory,{hash:{},inverse:f.noop,fn:f.program(6,p,t),data:t});if(i||i===0)r+=i;return r+="\n                            </tbody>\n                        </table>\n                    </div>\n                </div>\n                ",r}function p(e,t){var r="",i;r+='\n                                <tr class="item" data-id="'+a((i=t==null||t===!1?t:t.index,typeof i===u?i.apply(e):i))+'">\n                                    <td>'+a(n.formatTime.call(e,e&&e.updated_at,"yyyy-MM-d",{hash:{},data:t}))+"</td>\n                                    <td>$ "+a(n.or.call(e,e&&e.ending_balance,e&&e.total_balance,{hash:{},data:t}))+"</td>\n                                    <td>",i=n["if"].call(e,e&&e.success,{hash:{},inverse:f.program(9,v,t),fn:f.program(7,d,t),data:t});if(i||i===0)r+=i;return r+='</td>\n                                    <td>\n                                        <a class="payment-receipt link-blue" href="#">'+a(n.i18n.call(e,"PAYMENT_VIEW_RECEIPT",{hash:{},data:t}))+"</a></td>\n                                </tr>\n                            ",r}function d(e,t){return a(n.i18n.call(e,"PAYMENT_PAID",{hash:{},data:t}))}function v(e,t){var r="";return r+='<span class="link-red">'+a(n.i18n.call(e,"PAYMENT_FAILED",{hash:{},data:t}))+"</span>",r}function m(e,t){var r="";return r+='\n                    <div class="full-space">\n                        '+a(n.i18n.call(e,"NO_BILLING_EVENT",{hash:{},data:t}))+"\n                    </div>\n                ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div id="billing-status">\n    <nav id="PaymentNav">\n        <span data-target="PaymentBillingTab" class="selected">'+a(n.i18n.call(t,"PAYMENT_BILLING_TAB",{hash:{},data:i}))+'</span>\n        <span data-target="UsageTab">'+a(n.i18n.call(t,"PAYMENT_USAGE_TAB",{hash:{},data:i}))+'</span>\n    </nav>\n    <div class="tabContent" id="PaymentBody">\n        <section id="PaymentBillingTab">\n            <p class="warning-red"></p>\n            <h5>'+a(n.i18n.call(t,"CREDIT_CARD_INFORMATION",{hash:{},data:i}))+'</h5>\n            <div class="clearfix">\n                <div class="left clearfix">\n                    <div class="payment-credit-middle left">\n\n                    </div>\n                    <div class="left">\n                        <p class="payment-number">',o=n["if"].call(t,(o=t&&t.paymentUpdate,o==null||o===!1?o:o.card),{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='</p>\n                        <p class="payment-username">'+a((o=(o=t&&t.paymentUpdate,o==null||o===!1?o:o.first_name),typeof o===u?o.apply(t):o))+" "+a((o=(o=t&&t.paymentUpdate,o==null||o===!1?o:o.last_name),typeof o===u?o.apply(t):o))+'</p>\n                    </div>\n                </div>\n                <div class="right">\n                    <a class="btn btn-blue update-payment" href="'+a((o=(o=t&&t.paymentUpdate,o==null||o===!1?o:o.url),typeof o===u?o.apply(t):o))+'" target="_blank">'+a(n.i18n.call(t,"UPDATE_BILLING_INFORMATION",{hash:{},data:i}))+'<i class="icon-right"></i></a>\n                </div>\n            </div>\n            <h5>'+a(n.i18n.call(t,"BILLING_HISTORY",{hash:{},data:i}))+' <span class="payment-next-billing">'+a(n.i18n.call(t,"NEXT_BILLING_ON",{hash:{},data:i}))+" "+a(n.formatTime.call(t,(o=t&&t.paymentUpdate,o==null||o===!1?o:o.billingEnd),"yyyy-MM-d",{hash:{},data:i}))+'</span></h5>\n            <div class="table-head-fix">\n                ',o=n["if"].call(t,t&&t.hasPaymentHistory,{hash:{},inverse:f.program(11,m,i),fn:f.program(5,h,i),data:i});if(o||o===0)s+=o;return s+='\n            </div>\n        </section>\n        <section id="UsageTab" class="hide">\n            <p class="warning-red"></p>\n            <h5 class="billing_usage_title">'+a(n.i18n.call(t,"PAYMENT_CURRENT_USAGE",{hash:{},data:i}))+a(n.formatTime.call(t,(o=t&&t.paymentUpdate,o==null||o===!1?o:o.last_billing_time),"yyyy-MM-d",{hash:{},data:i}))+a(n.i18n.call(t,"PAYMENT_CURRENT_USAGE_SPAN",{hash:{},data:i}))+'</h5>\n            <div class="usage-wrapper">\n                <div class="used-points">\n                    <div class="usage-number">\n                        '+a((o=(o=t&&t.paymentUpdate,o==null||o===!1?o:o.current_quota),typeof o===u?o.apply(t):o))+"\n                    </div>\n                    <span>"+a(n.i18n.call(t,"PAYMENT_INSTANT_HOUR",{hash:{},data:i}))+'</span>\n                </div>\n            </div>\n            <p class="renew-points">'+a(n.i18n.call(t,"PAYMENT_RENEW_FREE_INFO",(o=t&&t.paymentUpdate,o==null||o===!1?o:o.max_quota),(o=t&&t.paymentUpdate,o==null||o===!1?o:o.renewRemainDays),{hash:{},data:i}))+"</p>\n        </section>\n    </div>\n</div>",s},n.billingTemplate=e.template(t),n}),function(){define("ide/subviews/BillingDialog",["./BillingDialogTpl","i18n!/nls/lang.js","ApiRequest","UI.modalplus","ApiRequestR","backbone"],function(e,t,n,r,i){var s;return s=Backbone.View.extend({events:{"click #PaymentNav span":"switchTab","click #PaymentBody a.payment-receipt":"viewPaymentReceipt","click .update-payment":"_bindPaymentEvent"},initialize:function(n){var i,s;return s=this,i=App.user.get("paymentState"),n?(this.modal=n,this.modal.setWidth("650px").setTitle(t.IDE.PAYMENT_SETTING_TITLE).setContent(MC.template.loadingSpiner).find(".modal-confirm").hide()):this.modal=new r({title:t.IDE.PAYMENT_SETTING_TITLE,width:"650px",template:MC.template.loadingSpiner,disableClose:!0,confirm:{hide:!0}}),this.getPaymentHistory().then(function(t){var n,r,i,o;return void 0,i={url:App.user.get("paymentUrl"),card:App.user.get("creditCard"),billingEnd:App.user.get("billingEnd"),current_quota:App.user.get("voQuotaCurrent"),max_quota:App.user.get("voQuotaPerMonth"),renewRemainDays:Math.round((App.user.get("renewDate")-new Date)/864e5),last_billing_time:App.user.get("billingStart")||new Date},n=App.user.get("voQuotaCurrent")-App.user.get("voQuotaPerMonth"),i.billable_quota=n>0?n:0,s.modal.find(".modal-body").css("padding","0"),r=_.keys(t).length,o=[],_.each(t,function(e){return e.ending_balance=e.ending_balance_in_cents/100,e.total_balance=e.total_in_cents/100,e.start_balance=e.starting_balance_in_cents/100,o.push(e)}),o.reverse(),t=o,s.paymentHistory=o,s.paymentUpdate=_.clone(i),s.modal.setContent(e.billingTemplate({paymentUpdate:i,paymentHistory:t,hasPaymentHistory:r})),App.user.get("creditCard")||(s.modal.find("#PaymentBillingTab").html(MC.template.paymentSubscribe({url:App.user.get("paymentUrl"),freePointsPerMonth:App.user.get("voQuotaPerMonth"),shouldPay:App.user.shouldPay()})),s.modal.listenTo(App.user,"paymentUpdate",function(){return s.initialize(s.modal),s.modal.stopListening()})),s.updateUsage()},function(){var e;return notification("error","Error while getting user payment info, please try again later."),(e=s.modal)!=null?e.close():void 0}),this.listenTo(App.user,"paymentUpdate",function(){return s.updateUsage()}),this.setElement(this.modal.tpl)},getPaymentHistory:function(){var e;return e=new Q.defer,App.user.get("creditCard")?i("payment_statement").then(function(t){return e.resolve(t)},function(t){return e.reject(t)}):e.resolve({}),e.promise},switchTab:function(e){var t;return t=$(e.currentTarget),void 0,this.modal.find("#PaymentNav").find("span").removeClass("selected"),this.modal.find(".tabContent > section").addClass("hide"),$("#"+t.addClass("selected").data("target")).removeClass("hide"),this.updateUsage()},_bindPaymentEvent:function(e){var t;return t=this,e.preventDefault(),window.open($(e.currentTarget).attr("href"),""),this.modal.listenTo(App.user,"change:paymentState",function(){var e;e=App.user.get("paymentState");if(t.modal.isClosed)return!1;if(e==="active")return t._renderBillingDialog(t.modal)}),this.modal.on("close",function(){return t.modal.stopListening(App.user)}),!1},_renderBillingDialog:function(e){return new s(e)},updateUsage:function(){var e,n;return this.modal.isClosed?!1:(n=App.user.shouldPay(),this.modal.$(".usage-block").toggleClass("error",n),this.modal.$(".used-points").toggleClass("error",n),e=App.user.get("voQuotaCurrent"),this.modal.find(".payment-number").text(App.user.get("creditCard")||"No Card"),this.modal.find(".payment-username").text(""+App.user.get("cardFirstName")+" "+App.user.get("cardLastName")),this.modal.find(".used-points .usage-number").text(e),App.user.shouldPay()?this.modal.find(".warning-red").not(".no-change").show().html(sprintf(t.IDE.PAYMENT_PROVIDE_UPDATE_CREDITCARD,App.user.get("paymentUrl"),App.user.get("creditCard")?"Update":"Provide")):App.user.isUnpaid()?this.modal.find(".warning-red").not(".no-change").show().html(sprintf(t.IDE.PAYMENT_UNPAID_BUT_IN_FREE_QUOTA,App.user.get("paymentUrl"))):this.modal.find(".warning-red").not(".no-change").hide())},viewPaymentReceipt:function(e){var t,n,r,i,s;return t=$(e.currentTarget),r=t.parent().parent().data("id"),s=this.paymentHistory[r],n=".billing_statement_section {\n    display: block;\n    position: relative;\n}\n.billing_statement_section h2 {\n    display: block;\n    background: #E6E6E6;\n    font-size: 16px;\n    padding: 10px;\n    font-weight: bold;\n    margin-bottom: 0;\n    border-bottom: 1px solid #727272;\n}\n.billing_statement_section_content {\n    display: block;\n    position: relative;\n    padding-top: 10px;\n}\ntable {\n    border-collapse: collapse;\n    width: 100%;\n}\ntable, td, th {\n    border: 1px solid #333;\n    padding: 7px;\n    text-align: left;\n    font-size: 14px;\n}\ntable thead {\n    background: #dedede;\n}\ntable tr.billing_statement_listing_tfoot {\n    font-weight: bold;\n    text-align: right;\n}\n#billing_statement {\n    width: 800px;\n    margin: 20px auto;\n    padding-bottom: 50px;\n}\n.billing_statement_section .billing_statement_section_content h3 {\n    font-size: 14px;\n    position: relative;\n    margin: 10px 0;\n    font-weight: bold;\n    margin-bottom: 14px;\n    background: #F3F3F3;\n    padding: 5px;\n}\ndiv#billing_statement_account_information_section {\n    width: 49%;\n    float: left;\n}\ndiv#billing_statement_summary_section {\n    width: 49%;\n    float: right;\n}\ndiv#billing_statement_detail_section {\n    clear: both;\n    padding-top: 10px;\n}\n.billing_statement_section_content .billing_statement_summary_label {\n    font-weight: bold;\n    font-size: 16px;\n    width: 44%;\n    display: inline-block;\n    text-align: right;\n}\n.billing_statement_section_content> div {\n    margin-bottom: 10px;\n}\n.billing_statement_section_content .billing_statement_summary_value {\n    text-align: right;\n    float: right;\n    color: #666;\n}\ndiv#billing_statement_summary_balance_paid_stamp.billing_statement_balance_paid_stamp_paid {\n    float: right;\n    font-size: 30px;\n    color: #50B816;\n    margin-top: 10px;\n}\ndiv#billing_statement_summary_balance_paid_stamp.billing_statement_balance_paid_stamp_unpaid {\n    float: right;\n    font-size: 30px;\n    color: #C70000;\n    margin-top: 10px;\n}\nbody {font-family: 'Lato', 'Helvetica Neue', Arial, sans-serif;}",i=function(){var e,t,r,i;return r=window.open("",""),r.focus(),e=s.html,r.document.write(e),t=r.document.head||r.document.getElementsByTagName("head")[0],i=document.createElement("style"),i.type="text/css",i.styleSheet?i.styleSheet.cssText=n:i.appendChild(document.createTextNode(n)),t.appendChild(i),r.document.close()},i()}}),s})}.call(this),function(){define("ide/subviews/HeaderView",["./HeaderTpl","./SettingsDialog","./BillingDialog","i18n!/nls/lang.js","backbone","UI.selectbox"],function(e,t,n,r){var i;return i=Backbone.View.extend({events:{"click #HeaderLogout":"logout","click #HeaderSettings":"settings","click #HeaderShortcuts":"shortcuts","click #HeaderBilling":"billingSettings","click .voquota":"billingSettings","DROPDOWN_CLOSE #HeaderNotification":"dropdownClosed"},initialize:function(){this.listenTo(App.user,"change",this.update),this.listenTo(App.model,"change:notification",this.updateNotification),this.setElement($(e(App.user.toJSON())).prependTo("#wrapper")),this.update()},logout:function(){return App.logout()},shortcuts:function(){return modal(MC.template.shortkey())},settings:function(){return new t},update:function(){var e;return e=$("#header").children(".voquota"),App.user.shouldPay()?e.addClass("show"):e.removeClass("show")},setAlertCount:function(e){return $("#NotificationCounter").text(e||"")},updateNotification:function(){var e,t,n,i,s,o;void 0,n=_.map(App.model.get("notification"),function(e){return _.extend({},e,{operation:r.TOOLBAR[e.operation.toUpperCase()]||e.operation})}),e="",i=0;for(s=0,o=n.length;s<o;s++)t=n[s],e+=MC.template.headerNotifyItem(t),t.readed||i++;return this.setAlertCount(i),$("#notification-panel-wrapper").find(".scroll-content").html(e),$("#notification-panel-wrapper").css("max-height",Math.ceil(window.innerHeight*.8)),null},dropdownClosed:function(){return $("#notification-panel-wrapper").find(".scroll-content").children().removeClass("unread"),this.setAlertCount(),App.model.markNotificationRead(),null},billingSettings:function(){return new n}}),i})}.call(this),define("ide/subviews/WelcomeTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){var r="";return r+="\n    <p>"+u(n.i18n.call(e,"WELCOME_PROVIDE_CRED_DESC",{hash:{},data:t}))+"</p>\n  ",r}function c(e,t){var r="",i;return r+="\n    <h2>"+u(n.i18n.call(e,"WELCOME_TIT",{hash:{},data:t}))+"<span>"+u((i=e&&e.username,typeof i===a?i.apply(e):i))+"</span></h2>\n    <p>"+u(n.i18n.call(e,"WELCOME_DESC",{hash:{},data:t}))+"</p>\n  ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<section id="WelcomeSettings">\n  <header>\n  ',o=n["if"].call(t,t&&t.noWelcome,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+='\n  </header>\n  <div id="CredSetupWrap">\n    <div id="CredSetupMsg" class="cred-setup-msg empty-hide"></div>\n    <ul>\n      <li>\n        <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_ACCOUNTID",{hash:{},data:i}))+'"></i>\n        <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCOUNTID",{hash:{},data:i}))+'</label>\n        <input autocomplete="off" class="input" id="CredSetupAccount" type="text">\n      </li>\n      <li>\n        <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_ACCESSKEY",{hash:{},data:i}))+'"></i>\n        <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_ACCESSKEY",{hash:{},data:i}))+'</label>\n        <input autocomplete="off" class="input" id="CredSetupAccessKey" type="text">\n      </li>\n      <li>\n        <i class="icon-info icon-label tooltip" data-tooltip="'+u(n.i18n.call(t,"SETTINGS_TIP_CRED_SECRETKEY",{hash:{},data:i}))+'"></i>\n        <label>'+u(n.i18n.call(t,"SETTINGS_LABEL_SECRETKEY",{hash:{},data:i}))+'</label>\n        <input autocomplete="off" class="input" id="CredSetupSecretKey" type="password">\n      </li>\n    </ul>\n\n    <footer class="cred-btn-wrap clearfix tar">\n      <button id="WelcomeSkip" class="link-style">'+u(n.i18n.call(t,"HEAD_LABEL_ACCOUNT_SKIP",{hash:{},data:i}))+'</button>\n      <button id="CredSetupSubmit" class="btn btn-blue" disabled="disabled">'+u(n.i18n.call(t,"HEAD_BTN_SUBMIT",{hash:{},data:i}))+'</button>\n    </footer>\n  </div>\n</section>\n\n<section id="WelcomeCredUpdate" class="hide">\n  <p>'+u(n.i18n.call(t,"SETTINGS_CRED_UPDATING",{hash:{},data:i}))+'</p>\n  <div class="loading-spinner"></div>\n</section>\n\n<section id="WelcomeSkipWarning" class="hide modal-body">\n  <h3>'+u(n.i18n.call(t,"WELCOME_SKIP_TIT",{hash:{},data:i}))+"</h3>\n  <h5>"+u(n.i18n.call(t,"WELCOME_SKIP_SUBTIT",{hash:{},data:i}))+"</h5>\n  <p>"+u(n.i18n.call(t,"WELCOME_SKIP_MSG",{hash:{},data:i}))+"</p>\n  <p>"+u(n.i18n.call(t,"WELCOME_SKIP_MSG_EXTRA",{hash:{},data:i}))+'</p>\n  <footer class="cred-btn-wrap clearfix tar">\n    <button id="WelcomeBack" class="link-style">'+u(n.i18n.call(t,"HEAD_BTN_BACK",{hash:{},data:i}))+'</button>\n    <button id="WelcomeDone" class="btn btn-blue">'+u(n.i18n.call(t,"HEAD_BTN_DONE",{hash:{},data:i}))+'</button>\n  </footer>\n</section>\n\n<section id="WelcomeDoneWrap" class="hide">\n  <p id="WelcomeDoneTitDemo">'+u(n.i18n.call(t,"WELCOME_DONE_HINT_DEMO",{hash:{},data:i}))+'</p>\n  <p id="WelcomeDoneTit">'+u(n.i18n.call(t,"WELCOME_DONE_HINT",{hash:{},data:i}))+" <span></span></p>\n  <h3>"+u(n.i18n.call(t,"WELCOME_DONE_TIT",{hash:{},data:i}))+"</h3>\n  <ul>"+u(n.i18n.call(t,"WELCOME_DONE_MSG",{hash:{},data:i}))+'</ul>\n  <footer class="cred-btn-wrap clearfix tar">\n    <button id="WelcomeClose" class="btn btn-blue">'+u(n.i18n.call(t,"HEAD_BTN_DONE",{hash:{},data:i}))+"</button>\n  </footer>\n</section>",s};return e.template(t)}),function(){define("ide/subviews/WelcomeDialog",["./WelcomeTpl","UI.modalplus","i18n!/nls/lang.js","backbone"],function(e,t,n){var r,i;return r=null,i=Backbone.View.extend({events:{"click #WelcomeSkip":"skip","click #WelcomeBack":"back","click #WelcomeDone":"skipDone","click #WelcomeClose":"close","click #CredSetupSubmit":"submitCred","keyup #CredSetupAccount, #CredSetupAccessKey, #CredSetupSecretKey":"updateSubmitBtn"},constructor:function(){return r?r:(r=this,Backbone.View.apply(this,arguments))},initialize:function(r){var i,s;i={username:App.user.get("username")},r&&r.askForCredential?(s=n.IDE.WELCOME_PROVIDE_CRED_TIT,i.noWelcome=!0):s=n.IDE.WELCOME_DIALOG_TIT,this.modal=new t({title:s,template:e(i),width:"600",disableClose:!0,disableFooter:!0,compact:!0,hideClose:!0,cancel:{hide:!0}}),this.modal.tpl.find(".context-wrap").attr("id","WelcomeDialog"),this.setElement(this.modal.tpl)},skip:function(){return $("#WelcomeSettings").hide(),$("#WelcomeSkipWarning").show()},back:function(){return $("#WelcomeSettings").show(),$("#WelcomeSkipWarning").hide()},skipDone:function(){if(!App.user.hasCredential()){this.done();return}$("#CredSetupAccount").val(""),$("#CredSetupAccessKey").val(""),$("#CredSetupSecretKey").val(""),$("#WelcomeSkipWarning").hide(),$("#WelcomeCredUpdate").show(),this.setCred()},done:function(){return $("#WelcomeSettings, #WelcomeSkipWarning, #WelcomeCredUpdate").hide(),$("#WelcomeDoneWrap").show(),App.user.hasCredential()?($("#WelcomeDoneTitDemo").hide(),$("#WelcomeDoneTit").children("span").text(App.user.get("account"))):($("#WelcomeDoneTitDemo").show(),$("#WelcomeDoneTit").hide())},close:function(){return r=null,this.modal.close()},updateSubmitBtn:function(){var e,t,n;t=$("#CredSetupAccount").val(),e=$("#CredSetupAccessKey").val(),n=$("#CredSetupSecretKey").val(),t.length&&e.length&&n.length?$("#CredSetupSubmit").removeAttr("disabled"):$("#CredSetupSubmit").attr("disabled","disabled")},submitCred:function(){var e,t,r;return $("#WelcomeSettings").hide(),$("#WelcomeCredUpdate").show(),e=$("#CredSetupAccessKey").val(),t=$("#CredSetupSecretKey").val(),r=this,App.user.validateCredential(e,t).then(function(){r.setCred()},function(){$("#CredSetupMsg").text(n.IDE.SETTINGS_ERR_CRED_VALIDATE),r.showCredSetup()})},setCred:function(){var e,t,r,i;return t=$("#CredSetupAccount").val(),e=$("#CredSetupAccessKey").val(),r=$("#CredSetupSecretKey").val(),t==="demo_account"&&(t="user_demo_account",$("#CredSetupAccount").val(t)),i=this,App.user.changeCredential(t,e,r,!0).then(function(){i.done()},function(e){$("#CredSetupMsg").text(n.IDE.SETTINGS_ERR_CRED_UPDATE),i.showCredSetup()})},showCredSetup:function(){$("#WelcomeDialog").children().hide(),$("#WelcomeSettings").show(),$("#CredSetupAccount").focus()[0].select(),this.updateSubmitBtn()}}),i})}.call(this),define("ide/subviews/NavigationTpl",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<aside id="navigation">\n  <nav>\n    <button class="off-canvas-tab" id="off-canvas-app">'+o(n.i18n.call(t,"NAV_TIT_APPS",{hash:{},data:i}))+'</button>\n    <button class="off-canvas-tab selected" id="off-canvas-stack">'+o(n.i18n.call(t,"NAV_TIT_STACKS",{hash:{},data:i}))+'</button>\n  </nav>\n  <div style="overflow-y:scroll;position:absolute;top:50px;bottom:0;left:0;right:0;">\n    <ul id="nav-app-region" class="hide"></ul>\n    <ul id="nav-stack-region"></ul>\n  </div>\n\n<!--   <section class="scroll-wrap">\n    <div class="scrollbar-veritical-wrap"><div class="scrollbar-veritical-thumb"></div></div>\n    <div class="scroll-content">\n      <ul class="scroll-content hide" id="nav-app-region"></ul>\n      <div class="scroll-content" id="nav-stack">\n        <ul id="nav-stack-region"></ul>\n        <div id="nav-show-empty">'+o(n.i18n.call(t,"TOOLBAR.SHOW_UNUSED_REGIONS",{hash:{},data:i}))+'</div>\n        <ul id="nav-region-empty-list" class="hide"></ul>\n      </div>\n    </div>\n  </section> -->\n</aside>\n<button id="off-canvas-menu" class="icon-menu"></button>\n<div id="off-canvas-overlay"></div>',s},n.navigation=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r="",i;r+='<li data-region="'+o((i=e&&e.region,typeof i===u?i.apply(e):i))+'">\n	<h3 class="nav-group-title">'+o((i=e&&e.regionName,typeof i===u?i.apply(e):i))+" ("+o((i=(i=e&&e.data,i==null||i===!1?i:i.length),typeof i===u?i.apply(e):i))+')</h3>\n	<ul class="nav-item-list app-list">\n	',i=n.each.call(e,e&&e.data,{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t});if(i||i===0)r+=i;return r+="\n	</ul>\n</li>",r}function l(e,t){var r="",i;r+='<li data-id="'+o((i=e&&e.id,typeof i===u?i.apply(e):i))+'" class="truncate nav-truncate icon-app-',i=n["if"].call(e,e&&e.progressing,{hash:{},inverse:a.program(5,h,t),fn:a.program(3,c,t),data:t});if(i||i===0)r+=i;r+='" title="'+o((i=e&&e.name,typeof i===u?i.apply(e):i))+" ["+o((i=e&&e.stateDesc,typeof i===u?i.apply(e):i))+']">'+o((i=e&&e.name,typeof i===u?i.apply(e):i)),i=n["if"].call(e,e&&e.usage,{hash:{},inverse:a.noop,fn:a.program(7,p,t),data:t});if(i||i===0)r+=i;return r+="</li>",r}function c(e,t){return"pending"}function h(e,t){return o(n.tolower.call(e,e&&e.stateDesc,{hash:{},data:t}))}function p(e,t){var n="",r;return n+='<i class="icon-app-type-'+o((r=e&&e.usage,typeof r===u?r.apply(e):r))+'"></i>',n}function d(e,t){var r="";return r+='\n<div class="nav-empty">'+o(n.i18n.call(e,"DASH_LBL_NO_APP",{hash:{},data:t}))+"</div>\n",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o=this.escapeExpression,u="function",a=this;return s=n.each.call(t,t,{hash:{},inverse:a.program(9,d,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.applist=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r;return r=n["if"].call(e,(r=e&&e.data,r==null||r===!1?r:r.length),{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t}),r||r===0?r:""}function l(e,t){var r="",i;r+='<li data-region="'+u((i=e&&e.region,typeof i===o?i.apply(e):i))+'">\n	<h3 class="nav-group-title">'+u((i=e&&e.regionName,typeof i===o?i.apply(e):i))+" ("+u((i=(i=e&&e.data,i==null||i===!1?i:i.length),typeof i===o?i.apply(e):i))+')<button class="icon-new-stack tooltip" data-tooltip=\''+u(n.i18n.call(e,"IDE_COM_CREATE_NEW_STACK",{hash:{},data:t}))+'\'></button></h3>\n	<ul class="nav-item-list stack-list">\n	',i=n.each.call(e,e&&e.data,{hash:{},inverse:a.noop,fn:a.program(3,c,t),data:t});if(i||i===0)r+=i;return r+="</ul>\n</li>",r}function c(e,t){var n="",r;return n+='<li data-id="'+u((r=e&&e.id,typeof r===o?r.apply(e):r))+'" class="truncate nav-truncate icon-stack-nav">'+u((r=e&&e.name,typeof r===o?r.apply(e):r))+"</li>",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.stacklist=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r;return r=n.unless.call(e,(r=e&&e.data,r==null||r===!1?r:r.length),{hash:{},inverse:a.noop,fn:a.program(2,l,t),data:t}),r||r===0?r:""}function l(e,t){var r="",i;return r+='<li class="nav-group-title" data-region="'+u((i=e&&e.region,typeof i===o?i.apply(e):i))+'">'+u((i=e&&e.regionName,typeof i===o?i.apply(e):i))+' (0) <button class="icon-new-stack tooltip" data-tooltip=\''+u(n.i18n.call(e,"IDE_COM_CREATE_NEW_STACK",{hash:{},data:t}))+"'></button></li>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n.each.call(t,t,{hash:{},inverse:a.noop,fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.regionlist=e.template(t),n}),function(){define("ide/subviews/Navigation",["./NavigationTpl","backbone"],function(e){return Backbone.View.extend({events:{"click #off-canvas-app":"showNavApp","click #off-canvas-stack":"showNavStack","click .stack-list li, .app-list li":"openOps","click #nav-show-empty":"showEmptyRegion","click .icon-new-stack":"createStack"},initialize:function(){this.setElement($(e.navigation()).appendTo("#wrapper").eq(0)),$("#off-canvas-menu").click(_.bind(this.showOffCanvas,this)),$("#off-canvas-overlay").click(_.bind(this.hideOffCanvas,this)),this.updateStackList(),this.updateAppList(),this.listenTo(App.model.stackList(),"update",function(){this.showing?this.updateStackList():this.stackDirty=!0}),this.listenTo(App.model.appList(),"update change:state",function(){void 0,this.showing?this.updateAppList():this.appDirty=!0})},showOffCanvas:function(){if($("#wrapper").hasClass("off-canvas"))return $("wrapper").removeClass("off-canvas");this.stackDirty&&this.updateStackList(),this.appDirty&&this.updateAppList(),this.showing=!0,this.stackDirty=this.appDirty=!1,$("#nav-app-region").children(".nav-empty").length?this.showNavStack():this.showNavApp(),$("#wrapper").addClass("off-canvas")},hideOffCanvas:function(){$("#wrapper").removeClass("off-canvas"),this.showing=!1},showNavApp:function(){$("#nav-app-region").show(),$("#nav-stack-region").hide(),$("#off-canvas-app").toggleClass("selected",!0),$("#off-canvas-stack").toggleClass("selected",!1)},showNavStack:function(){$("#nav-app-region").hide(),$("#nav-stack-region").show(),$("#off-canvas-app").toggleClass("selected",!1),$("#off-canvas-stack").toggleClass("selected",!0)},showEmptyRegion:function(){$("#nav-show-empty").hide(),$("#nav-region-empty-list").show()},updateStackList:function(){var t;return t=App.model.stackList().groupByRegion(!0),$("#nav-stack-region").html($.trim(e.stacklist(t))),$("#nav-region-empty-list").html(e.regionlist(t))},updateAppList:function(){return $("#nav-app-region").html(e.applist(App.model.appList().groupByRegion()))},openOps:function(e){this.hideOffCanvas(),App.openOps($(e.currentTarget).attr("data-id"))},createStack:function(e){var t;t=$(e.currentTarget).closest("li").attr("data-region");if(!t)return;this.hideOffCanvas(),App.createOps(t)}})})}.call(this),define("ide/subviews/AppTpl",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<header class="modal-header" style="width:390px;"><h3>'+u(n.i18n.call(t,"TOOLBAR.TIP_DELETE_STACK",{hash:{},data:i}))+'</h3><i class="modal-close">&times;</i></header>\n<div class="modal-body modal-text-wraper" style="width:390px;">\n  <div class="modal-center-align-helper">\n      <div class="modal-text-major">'+u((o=t&&t.msg,typeof o===a?o.apply(t):o))+'</div>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn modal-close btn-red" id="confirmRmStack">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_DELETE_STACK",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.removeStackConfirm=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<header class="modal-header" style="width:390px;"><h3>'+u(n.i18n.call(t,"TOOLBAR.TIP_DUPLICATE_STACK",{hash:{},data:i}))+'</h3><i class="modal-close">&times;</i></header>\n<div class="modal-body modal-text-wraper" style="width:390px;">\n  <div class="modal-center-align-helper">\n    <div class="modal-control-group">\n      <label class="modal-text-major">'+u(n.i18n.call(t,"TOOLBAR.POP_BODY_DUPLICATE_STACK",{hash:{},data:i}))+'</label>\n      <input id="confirmDupStackIpt" class="input" type="text" value="'+u((o=t&&t.newName,typeof o===a?o.apply(t):o))+'">\n    </div>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn btn-red" id="confirmDupStack">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_DUPLICATE_STACK",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"TOOLBAR.POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.dupStackConfirm=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="loading-spinner"></div>'},n.loading=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<section class="disconnected-msg">\n  <div>'+o(n.i18n.call(t,"TOOLBAR.CONNECTION_LOST_TO_RECONNECT",{hash:{},data:i}))+"</div>\n  <div>"+o(n.i18n.call(t,"TOOLBAR.CHANGES_MAY_NOT_BE_SAVED",{hash:{},data:i}))+"</div>\n</section>",s},n.disconnectedMsg=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<header class="modal-header" style="width:390px;"><h3>'+o(n.i18n.call(t,"TOOLBAR.POP_FORCE_TERMINATE",{hash:{},data:i}))+'</h3><i class="modal-close">&times;</i></header>\n<div class="modal-body modal-text-wraper" style="width:390px;">\n  <div class="modal-center-align-helper">\n      <div class="modal-text-major">'+o(n.i18n.call(t,"TOOLBAR.POP_FORCE_TERMINATE_CONTENT",t&&t.name,{hash:{},data:i}))+'</div>\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btn modal-close btn-red" id="forceTerminateApp">'+o(n.i18n.call(t,"TOOLBAR.POP_BTN_DELETE_STACK",{hash:{},data:i}))+'</button>\n  <button class="btn modal-close btn-silver">'+o(n.i18n.call(t,"TOOLBAR.POP_BTN_CANCEL",{hash:{},data:i}))+"</button>\n</div>",s},n.forceTerminateApp=e.template(t),n}),define("ide/subviews/FullnameTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="complete-fullname">\n    <div class="control-group fullname">\n        <div class="half-group">\n            <label for="complete-firstname" class="account-label">'+o(n.i18n.call(t,"FIRST_NAME",{hash:{},data:i}))+'</label>\n            <input autocomplete="off" id="complete-firstname" class="input" type="text"/>\n        </div>\n        <div class="half-group">\n            <label for="complete-lastname" class="account-label">'+o(n.i18n.call(t,"LAST_NAME",{hash:{},data:i}))+'</label>\n            <input autocomplete="off" id="complete-lastname" class="input" type="text"/>\n        </div>\n    </div>\n    <p class="information">'+o(n.i18n.call(t,"YOU_CAN_LATER_UPDATE_PROFILE",{hash:{},data:i}))+"</p>\n</div>",s};return e.template(t)}),function(){define("ide/subviews/FullnameSetup",["./FullnameTpl","UI.modalplus","i18n!/nls/lang.js","ApiRequest","backbone"],function(e,t,n,r){return Backbone.View.extend({events:{"click #submitFullName":"submit","change #complete-firstname":"changeInput","change #complete-lastname":"changeInput","keyup #complete-lastname":"changeInput","keyup #complete-lastname":"changeInput"},initialize:function(){return this.modal=new t({title:n.IDE.COMPLETE_YOUR_PROFILE,template:e(),width:"600",disableClose:!0,hideClose:!0,cancel:{hide:!0},confirm:{disabled:!0}}),this.modal.on("confirm",this.submit.bind(this)),this.setElement(this.modal.tpl)},changeInput:function(){var e,t,n;return n=this.modal.find(".modal-confirm"),e=this.modal.find("#complete-firstname"),t=this.modal.find("#complete-lastname"),!e.val()||!t.val()?n.attr("disabled",!0):n.attr("disabled",!1)},submit:function(){var e,t,i;return i=this,e=i.modal.$("#complete-firstname").val(),t=i.modal.$("#complete-lastname").val(),!e||!t?!1:(this.modal.find(".modal-confirm").attr("disabled",!0),this.modal.setContent(MC.template.loadingSpiner()),r("account_update_account",{attributes:{first_name:e,last_name:t}}).then(function(){return App.user.set("firstName",e),App.user.set("lastName",t),this.modal.close(),notification("info",n.IDE.PROFILE_UPDATED_SUCCESSFULLY)},function(){return this.modal.close(),notification("error",n.IDE.PROFILE_UPDATED_FAILED)}))}})})}.call(this),function(){define("ide/ApplicationView",["backbone","./subviews/SessionDialog","./subviews/HeaderView","./subviews/WelcomeDialog","./subviews/SettingsDialog","./subviews/Navigation","./subviews/AppTpl","./subviews/FullnameSetup","i18n!/nls/lang.js","CloudResources","constant","UI.modalplus"],function(e,t,n,r,i,s,o,u,a,f,l,c){return e.View.extend({el:$("body")[0],events:{"click .click-select":"selectText"},initialize:function(){this.header=new n,new s,this.listenTo(App.user,"change:state",this.toggleWelcome),this.listenTo(App.model.appList(),"change:terminateFail",this.askForForceTerminate),$(window).on("beforeunload",this.checkUnload),$(window).on("keydown",this.globalKeyEvent)},checkUnload:function(){return App.canQuit()?void 0:a.IDE.BEFOREUNLOAD_MESSAGE},globalKeyEvent:function(e){var t;t=e.target.nodeName.toLowerCase();if(t==="input"||t==="textarea"||e.target.contentEditable==="true")return;switch(e.which){case 8:e.preventDefault();return;case 191:return modal(MC.template.shortkey(),!0),!1}},toggleWSStatus:function(e){if(e)return $(".disconnected-msg").remove();if($(".disconnected-msg").show().length>0)return;return $(o.disconnectedMsg()).appendTo("body").on("mouseover",function(){$(".disconnected-msg").addClass("hovered"),$("body").on("mousemove.disconnectedmsg",function(e){var t,n,r,i;t=$(".disconnected-msg");if(!t.length){$("body").off("mousemove.disconnectedmsg");return}n=t.offset(),r=e.pageX,i=e.pageY;if(r<n.left||i<n.top||r>=n.left+t.outerWidth()||i>=n.top+t.outerHeight())$("body").off("mousemove.disconnectedmsg"),t.removeClass("hovered")})})},toggleWelcome:function(){App.user.isFirstVisit()?new r:App.user.fullnameNotSet()&&new u},askForAwsCredential:function(){return new r({askForCredential:!0})},showSessionDialog:function(){return(new t).promise()},selectText:function(e){var t,n;try{n=document.body.createTextRange(),n.moveToElementText(e.currentTarget),n.select(),void 0}catch(r){t=r,window.getSelection&&(n=document.createRange(),n.selectNode(e.currentTarget),window.getSelection().addRange(n),void 0)}return!1},askForForceTerminate:function(e){if(!e.get("terminateFail"))return;modal(o.forceTerminateApp({name:e.get("name")})),$("#forceTerminateApp").on("click",function(){e.terminate(!0).fail(function(e){var t;return t=e.awsError?e.error+"."+e.awsError:e.error,notification(sprintf(a.NOTIFY.ERROR_FAILED_TERMINATE,name,t))})})},notifyUnpay:function(){notification("error","Failed to charge your account. Please update your billing info.")}})})}.call(this),function(){define("OpsModel",["ApiRequest","constant","CloudResources","ThumbnailUtil","backbone"],function(e,t,n,r){var i,s,o,u,a,f,l;return i={},l=Backbone.Model.extend,f={OpenStack:"OpenstackOps",Amazon:"AwsOps"},u={UnRun:0,Running:1,Stopped:2,Initializing:3,Starting:4,Updating:5,Stopping:6,Terminating:7,Destroyed:8,Saving:9},a=["","Running","Stopped","Starting","Starting","Updating","Stopping","Terminating","","Saving"],o="2014-11-11",s=Backbone.Model.extend({type:"GenericOps",defaults:function(){return{updateTime:+(new Date),region:"",state:u.UnRun,stoppable:!0,name:"",version:o,provider:""}},constructor:function(e,t){var n,r;e=e||{},t=t||{};if(this.type==="GenericOps"){t.jsonData&&(r=t.jsonData.provider),e.provider=r||e.provider||"aws::global",void 0,n=i[e.provider];if(n)return new n(e,t)}Backbone.Model.apply(this,arguments)},initialize:function(e,t){t&&(t.initJsonData&&this.__initJsonData(),t.jsonData&&this.__setJsonData(t.jsonData))},url:function(){return this.get("id")?"ops/"+this.get("id"):"ops/"+this.cid+"/unsaved"},isStack:function(){return this.attributes.state===u.UnRun||this.attributes.state===u.Saving},isApp:function(){return!this.isStack()},isImported:function(){return!!this.attributes.importMsrId},isPMRestricted:function(){return this.get("version")>="2014-11-11"&&this.isApp()},testState:function(e){return this.attributes.state===e},getStateDesc:function(){return a[this.attributes.state]},toJSON:function(e){var n;return n=Backbone.Model.prototype.toJSON.call(this),n.stateDesc=a[n.state],n.regionName=t.REGION_SHORT_LABEL[n.region],this.isProcessing()&&(n.progressing=!0),e&&e.thumbnail&&(n.thumbnail=r.fetch(n.id)),n},isPersisted:function(){return!!this.get("id")},isExisting:function(){var e;return e=this.get("state"),e===u.Destroyed&&void 0,!!this.get("id")&&e!==u.Destroyed},getMsrId:function(){return this.get("importMsrId")||void 0},getThumbnail:function(){return r.fetch(this.get("id"))},saveThumbnail:function(e){e?(r.save(this.get("id"),e),this.trigger("change")):r.save(this.get("id"),"")},hasJsonData:function(){return!!this.__jsonData},getJsonData:function(){return this.__jsonData},fetchJsonData:function(){var e;return this.__jsonData?(e=Q.defer(),e.resolve(this),e.promise):this.__fjdTemplate(this)||this.__fjdImport(this)||this.__fjdStack(this)||this.__fjdApp(this)},__fjdTemplate:function(t){var n;n=this.get("sampleId");if(!n)return;return e("stackstore_fetch_stackstore",{sub_path:"master/stack/"+n+"/"+n+".json"}).then(function(e){var n,r;try{r=JSON.parse(e),delete r.id,delete r.signature,t.collection.isNameAvailable(r.name)||(r.name=t.collection.getNewName(r.name)),t.attributes.region=r.region,t.__setJsonData(r)}catch(i){n=i,r=null,t.attributes.region="us-east-1",t.__initJsonData()}return r&&t.set("name",r.name),t})},__fjdImport:function(e){if(!this.isImported())return;return n("OpsResource",this.getMsrId()).init(this.get("region"),this.get("provider")).fetchForceDedup().then(function(){return e.__onFjdImported()})},generateJsonFromRes:function(){var e;return e=n("OpsResource",this.getMsrId()).generatedJson,e.agent.module.repo||(e.agent.module={repo:App.user.get("repo"),tag:App.user.get("tag")}),e},__onFjdImported:function(){var e;return e=this.generateJsonFromRes(),this.__setJsonData(e),this.attributes.name=e.name,this},__fjdStack:function(t){if(!this.isStack())return;return e("stack_info",{region_name:this.get("region"),stack_ids:[this.get("id")]}).then(function(e){return t.__setJsonData(e[0])})},__fjdApp:function(t){if(!this.isApp())return;return e("app_info",{region_name:this.get("region"),app_ids:[this.get("id")]}).then(function(e){return t.__setJsonData(e[0])})},__setJsonData:function(t){var n;if(!t)throw this.__destroy(),new McError(e.Errors.MissingDataInServer,"Stack/App doesn't exist.");return t.agent||(t.agent={enabled:!1,module:{repo:App.user.get("repo"),tag:App.user.get("tag")}}),t.property||(t.property={stoppable:!0}),t.layout&&t.layout.component&&(n=$.extend({},t.layout.component.node,t.layout.component.group),n.size=t.layout.size,t.layout=n),t.layout&&!t.layout.size&&(t.layout.size=[240,240]),(t.version||"").split("-").length<3&&(t.version=o),!t.provider&&this.get("provider")&&(t.provider=this.get("provider")),this.__jsonData=t,this.attributes.name!==t.name&&this.set("name",t.name),this},save:function(t,n){var i,s,o,a;return this.isApp()||this.testState(u.Saving)?this.__returnErrorPromise():(t||(t=this.__jsonData),this.set("state",u.Saving),o=this.collection.where({name:t.name})||[],o.length>1||o[0]&&o[0]!==this?(s=Q.defer(),s.reject(McError(e.Errors.StackRepeatedStack,"Stack name has already been used.")),s.promise):(i=this.get("id")?"stack_save":"stack_create",t.state!=="Enabled"&&(void 0,t.state="Enabled"),t.id=this.get("id"),a=this,e(i,{region_name:this.get("region"),spec:t}).then(function(e){var i;return i={name:t.name,version:t.version,updateTime:+(new Date),stoppable:e.property.stoppable,state:u.UnRun},a.get("id")||(i.id=e.id),n&&r.save(a.get("id")||i.id,n),a.set(i),a.__jsonData=e,a.trigger("jsonDataSaved",a),i.id&&a.collection.__triggerUpdate(a),a},function(e){throw a.set("state",u.UnRun),e})))},remove:function(){var t,n;return this.isPersisted()&&this.isApp()?this.__returnErrorPromise():(this.__destroy(),this.get("id")?(n=this,e("stack_remove",{region_name:this.get("region"),stack_id:this.get("id")}).fail(function(){return this.set("state",u.UnRun),App.model.stackList().add(n)})):(t=Q.defer(),t.resolve(),t.promise))},run:function(t,n){var r;return r=this.get("region"),t.id=this.get("id")||"",e("stack_run_v2",{region_name:r,stack:t,app_name:n}).then(function(e){var i;return i=new s({name:n,requestId:e[0],state:u.Initializing,progress:0,region:r,provider:t.provider,usage:t.usage,version:t.version,updateTime:+(new Date),stoppable:t.property.stoppable,resource_diff:!1}),App.model.appList().add(i),i})},duplicate:function(t){var n,i,o;if(this.isApp())return;return o=r.fetch(this.get("id")),n=$.extend(!0,{},this.attributes,{name:t,updateTime:+(new Date),provider:this.get("provider")}),i=this.collection,e("stack_save_as",{region_name:this.get("region"),stack_id:this.get("id"),new_name:t||this.collection.getNewName()}).then(function(e){return o&&r.save(e,o),n.id=e,i.add(new s(n))})},stop:function(){var t;return!this.isApp()||this.get("state")!==u.Running?this.__returnErrorPromise():(t=this,this.set("state",u.Stopping),this.attributes.progress=0,e("app_stop",{region_name:this.get("region"),app_id:this.get("id"),app_name:this.get("name")}).fail(function(e){throw t.set("state",u.Running),e}))},start:function(){var t;return!this.isApp()||this.get("state")!==u.Stopped?this.__returnErrorPromise():(t=this,this.set("state",u.Starting),this.attributes.progress=0,e("app_start",{region_name:this.get("region"),app_id:this.get("id"),app_name:this.get("name")}).fail(function(e){throw t.set("state",u.Stopped),e}))},terminate:function(t,n){var r,i,s;return t==null&&(t=!1),this.isApp()?(r=this.get("state"),this.set("state",u.Terminating),this.attributes.progress=0,this.attributes.terminateFail=!1,s=this,i=$.extend({region_name:this.get("region"),app_id:this.get("id"),app_name:this.get("name"),flag:t},n||{}),e("app_terminate",i).then(function(){t&&s.__destroy()},function(e){throw e.error<0?e:(s.set({state:r,terminateFail:!0}),e)})):this.__returnErrorPromise()},update:function(t,n){var r,i,s;return this.isApp()?this.__updateAppDefer?(void 0,this.__updateAppDefer.promise):(i=this.get("state"),this.set("state",u.Updating),this.attributes.progress=0,this.__updateAppDefer=Q.defer(),s=this,e("app_update",{region_name:this.get("region"),spec:t,app_id:this.get("id"),fast_update:n}).fail(function(e){return s.__updateAppDefer.reject(e)}),r=function(e){throw s.__updateAppDefer=null,s.attributes.progress=0,s.set({state:i}),e},this.__updateAppDefer.promise.then(function(){return s.__jsonData=null,s.fetchJsonData().then(function(){return s.__updateAppDefer=null,s.importMsrId=void 0,s.set({name:t.name,state:u.Running})},r)},r)):this.__returnErrorPromise()},saveApp:function(t){var n,r;return this.isApp()?this.__saveAppDefer?(void 0,this.__saveAppDefer.promise):(t.changed=!1,t.state!==this.getStateDesc()&&(void 0,t.state=this.getStateDesc()),void 0,t.id?(t.id!==this.get("id")&&void 0,t.id=this.get("id")):t.id="",n=this.get("state"),this.set("state",u.Saving),this.attributes.progress=0,this.__saveAppDefer=Q.defer(),r=this,e("app_save_info",{spec:t}).then(function(e){r.id||(r.attributes.requestId=e[0]),r.attributes.importMsrId=void 0},function(e){return r.__saveAppDefer.reject(e)}),this.__saveAppDefer.promise.then(function(){r.__jsonData=t,r.attributes.requestId=void 0,r.__saveAppDefer=null,r.set({name:t.name,state:n,usage:t.usage})},function(e){throw r.__saveAppDefer=null,r.attributes.requestId=void 0,r.attributes.progress=0,r.set({state:n}),e})):this.__returnErrorPromise()},setStatusProgress:function(e,t){var n;n=parseInt(e*100/t),this.attributes.progress!==n&&(this.attributes.progress=n,this.trigger("change:progress",this,n))},isProcessing:function(){var e;return e=this.attributes.state,e===u.Initializing||e===u.Stopping||e===u.Updating||e===u.Terminating||e===u.Starting||e===u.Saving},setStatusWithApiResult:function(e){return void 0,this.set("state",u[e])},setStatusWithWSEvent:function(t,n,r){var i,s,o;void 0;switch(t){case"launch":n.completed?o=u.Running:n.failed&&(o=u.Destroyed);break;case"stop":n.completed?o=u.Stopped:n.failed&&(o=u.Running);break;case"update":if(!this.__updateAppDefer){void 0;return}n.completed?(this.__jsonData=null,s=this,this.fetchJsonData().then(function(){return i=s.__updateAppDefer,s.__updateAppDefer=null,i.resolve()})):(i=this.__updateAppDefer,this.__updateAppDefer=null,i.reject(McError(e.Errors.OperationFailure,r)));return;case"save":if(!this.__saveAppDefer){void 0;return}i=this.__saveAppDefer,this.__saveAppDefer=null,n.completed?i.resolve():i.reject(McError(e.Errors.OperationFailure,r));return;case"terminate":n.completed?o=u.Destroyed:(o=u.Stopped,this.attributes.terminateFail=!1,this.set("terminateFail",!0));break;case"start":n.completed?o=u.Running:o=u.Stopped}r&&(this.attributes.opsActionError=r),o===u.Destroyed?this.__destroy():o&&(this.attributes.progress=0,this.set("state",o))},destroy:function(){return void 0},__destroy:function(){var e,t;if(this.attributes.state===u.Destroyed)return;return r.remove(this.get("id")),e=this.getMsrId(),e&&(t=n("OpsResource",e))!=null&&t.destroy(),this.attributes.state=u.Destroyed,this.trigger("destroy",this,this.collection)},__returnErrorPromise:function(){var t;return t=Q.defer(),t.resolve(McError(e.Errors.InvalidMethodCall,"The method is not supported by this model.")),t.promise},__createRawJson:function(){return{id:this.get("id")||"",name:this.get("name"),description:"",region:this.get("region"),platform:"ec2-vpc",state:"Enabled",version:this.get("version"),resource_diff:!0,component:{},provider:this.get("provider"),layout:{size:[240,240]},agent:{enabled:!0,module:{repo:App.user.get("repo"),tag:App.user.get("tag")}},property:{stoppable:!0}}},__initJsonData:function(){this.__jsonData=this.__createRawJson()}},{extend:function(e,t){var n,r,s,o,u;r=l.call(this,e,t),u=t.supportedProviders;for(s=0,o=u.length;s<o;s++)n=u[s],i[n]=r;return r}}),s.Type=f,s.State=u,s.LatestVersion=o,s})}.call(this),function(){define("ide/submodels/OpsCollection",["OpsModel","constant","backbone"],function(e,t){return Backbone.Collection.extend({model:e,newNameTmpl:"untitled",comparator:function(e,t){return-(e.attributes.updateTime-t.attributes.updateTime)},initialize:function(){this.on("change:updateTime",this.sort,this),this.on("add remove",this.__triggerUpdate,this),this.on("change:id",this.__triggerUpdate,this),this.__debounceUpdate=_.debounce(function(){return this.trigger("update")})},getNewName:function(e){var t,n,r,i,s;n=this.groupBy("name"),t=0,e?(r=e.match(/(.+)(-\d*)$/),s=r?r[1]:e):s=this.newNameTmpl,i=s+"-0";for(;;){if(!n[i])break;t+=1,i=s+"-"+t}return i},isNameAvailable:function(e){return e&&!this.findWhere({name:e})},groupByRegion:function(e,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m;e==null&&(e=!1),n==null&&(n=!0),r==null&&(r=!1),f={},v=this.models;for(c=0,p=v.length;c<p;c++){o=v[c];if(!r&&!o.isExisting())continue;a=o.attributes.region,s=f[a]||(f[a]=[]),s.push(n?o.toJSON():o)}l=[],m=t.REGION_KEYS;for(h=0,d=m.length;h<d;h++){i=m[h],u=f[i];if(!u&&!e)continue;l.push({region:i,regionName:t.REGION_SHORT_LABEL[i],data:u||[]})}return l},filterRecent:function(t){var n,r,i,s,o,u,a;t==null&&(t=!1),i=Math.round(+(new Date)/1e3),n=[],a=this.models;for(o=0,u=a.length;o<u;o++){r=a[o];if(r.testState(e.State.Terminating))continue;s=r.get("updateTime");if(i-s>=2592e3)break;t&&(r=r.toJSON(),r.formatedTime=MC.intervalDate(s)),n.push(r)}return n},__triggerUpdate:function(e){if(!e)return;if(this.indexOf(e)!==-1&&!e.isExisting())return;this.__debounceUpdate()},add:function(e){var t;return this.isNameAvailable(e.get("name"))||(t=this.getNewName(),e.attributes.name=t,e.__jsonData&&(e.__jsonData.name=t)),Backbone.Collection.prototype.add.apply(this,arguments)}})})}.call(this),function(){define("ide/submodels/OpsModelOs",["OpsModel","ApiRequest","constant","CloudResources"],function(e,t,n,r){var i;return i=e.extend({type:e.Type.OpenStack,getMsrId:function(){var t,r,i,s;r=e.prototype.getMsrId.call(this);if(r)return r;if(!this.__jsonData)return void 0;s=this.__jsonData.component;for(i in s){t=s[i];if(t.type===n.RESTYPE.OSNETWORK)return t.resource.id}return void 0},__initJsonData:function(){var e,t,n,r,i,s,o,u;r=this.__createRawJson(),s={NETWORK:{coordinate:[27,3],size:[60,60]},SUBNET:{coordinate:[30,6],size:[25,54]},RT:{coordinate:[10,3]}},t={KP:{type:"OS::Nova::KeyPair",name:"DefaultKP",resource:{}},NETWORK:{type:"OS::Neutron::Network",resource:{name:"network1"}},SG:{type:"OS::Neutron::SecurityGroup",resource:{name:"DefaultSG",description:"default security group",rules:[]}},RT:{type:"OS::Neutron::Router",resource:{external_gateway_info:{}}},SUBNET:{type:"OS::Neutron::Subnet",resource:{cidr:"10.0.0.0/16",enable_dhcp:!0}}};for(n in t)e=t[n],e.uid=MC.guid(),r.component[e.uid]=e,s[n]&&(i=s[n],i.uid=e.uid,r.layout[i.uid]=i),e.type==="OS::Neutron::Subnet"?u=e.uid:e.type==="OS::Neutron::Network"&&(o=e.uid);for(n in t)e=t[n],e.type==="OS::Neutron::Subnet"?e.resource.network_id="@{"+o+".resource.id}":e.type==="OS::Neutron::Router"&&(e.resource.router_interface=[{subnet_id:"@{"+u+".resource.id}"}]);this.__jsonData=r}},{supportedProviders:["os::awcloud_bj"]}),i})}.call(this),function(){define("ide/submodels/OpsModelAws",["OpsModel","ApiRequest","constant","CloudResources"],function(e,t,n,r){var i;return i=e.extend({type:e.Type.Amazon,getMsrId:function(){var t,r,i,s;r=e.prototype.getMsrId.call(this);if(r)return r;if(!this.__jsonData)return void 0;s=this.__jsonData.component;for(i in s){t=s[i];if(t.type===n.RESTYPE.VPC)return t.resource.VpcId}return void 0},__initJsonData:function(){var e,t,n,r,i,s,o,u;r=this.__createRawJson(),o=MC.guid(),u="@{"+o+".resource.VpcId}",s={VPC:{coordinate:[5,3],size:[60,60]},RTB:{coordinate:[50,5],groupUId:o}},t={KP:{type:"AWS.EC2.KeyPair",name:"DefaultKP",resource:{KeyName:"DefaultKP",KeyFingerprint:""}},SG:{type:"AWS.EC2.SecurityGroup",name:"DefaultSG",resource:{IpPermissions:[{IpProtocol:"tcp",IpRanges:"0.0.0.0/0",FromPort:"22",ToPort:"22"}],IpPermissionsEgress:[{FromPort:"0",IpProtocol:"-1",IpRanges:"0.0.0.0/0",ToPort:"65535"}],Default:!0,GroupId:"",GroupName:"DefaultSG",GroupDescription:"default VPC security group",VpcId:u}},ACL:{type:"AWS.VPC.NetworkAcl",name:"DefaultACL",resource:{AssociationSet:[],Default:!0,NetworkAclId:"",VpcId:u,EntrySet:[{RuleAction:"allow",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!0,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:100},{RuleAction:"allow",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!1,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:100},{RuleAction:"deny",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!0,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:32767},{RuleAction:"deny",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!1,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:32767}]}},VPC:{type:"AWS.VPC.VPC",name:"vpc",resource:{VpcId:"",CidrBlock:"10.0.0.0/16",DhcpOptionsId:"",EnableDnsHostnames:!1,EnableDnsSupport:!0,InstanceTenancy:"default"}},RTB:{type:"AWS.VPC.RouteTable",name:"RT-0",resource:{VpcId:u,RouteTableId:"",AssociationSet:[{Main:"true",SubnetId:"",RouteTableAssociationId:""}],PropagatingVgwSet:[],RouteSet:[{InstanceId:"",NetworkInterfaceId:"",Origin:"CreateRouteTable",GatewayId:"local",DestinationCidrBlock:"10.0.0.0/16"}]}}};for(n in t)e=t[n],n==="VPC"?e.uid=o:e.uid=MC.guid(),r.component[e.uid]=e,s[n]&&(i=s[n],i.uid=e.uid,r.layout[e.uid]=i);this.__jsonData=r}},{supportedProviders:["aws::global","aws::china"]}),i})}.call(this),function(){define("ide/ApplicationModel",["./submodels/OpsCollection","OpsModel","ApiRequest","ApiRequestOs","backbone","constant","ThumbnailUtil","i18n!/nls/lang.js","./submodels/OpsModelOs","./submodels/OpsModelAws"],function(e,t,n,r,i,s,o,u){return i.Model.extend({defaults:function(){return{__websocketReady:!1,notification:[],stackList:new e,appList:new e}},markNotificationRead:function(){var e,t,n,r;r=this.attributes.notification;for(t=0,n=r.length;t<n;t++)e=r[t],e.readed=!0},stackList:function(){return this.attributes.stackList},appList:function(){return this.attributes.appList},getOpsModelById:function(e){return this.attributes.appList.get(e)||this.attributes.stackList.get(e)},createImportOps:function(e,n,r){var i;return i=this.attributes.appList.findWhere({importMsrId:r}),i?i:(i=new t({name:"ImportedApp",importMsrId:r,region:e,provider:n,state:t.State.Running}),this.attributes.appList.add(i),i)},createSampleOps:function(e){var n;return n=new t({sampleId:e}),this.attributes.stackList.add(n),n},createStack:function(e,n){var r;return n==null&&(n="aws::global"),r=new t({region:e,provider:n},{initJsonData:!0}),this.attributes.stackList.add(r),r},createStackByJson:function(e,n){var r;return n==null&&(n=!1),this.attributes.stackList.isNameAvailable(e.name)||(e.name=this.stackList().getNewName(e.name)),r=new t({name:e.name,region:e.region,autoLayout:n,__________itsshitdontsave:n},{jsonData:e}),this.attributes.stackList.add(r),r},getPriceData:function(e){return(this.__awsdata[e]||{}).price},getOsFamilyConfig:function(e){return(this.__awsdata[e]||{}).osFamilyConfig},getInstanceTypeConfig:function(e){return(this.__awsdata[e]||{}).instanceTypeConfig},getRdsData:function(e){return(this.__awsdata[e]||{}).rds},getStateModule:function(e,t){return this.__stateModuleData[e+":"+t]},getOpenstackFlavors:function(e,t){return this.__osdata[e][t].flavors},getOpenstackQuotas:function(e){return this.__osdata[e].quota},initialize:function(){this.__awsdata={},this.__osdata={},this.__stateModuleData={},this.__initializeNotification()},fetch:function(){var e,t,i,s,u;return s=this,u=n("stack_list",{region_name:null}).then(function(e){return s.get("stackList").set(s.__parseListRes(e))}),e=n("app_list",{region_name:null}).then(function(e){return s.get("appList").set(s.__parseListRes(e))}),t=n("aws_aws",{fields:["region","price","instance_types","rds"]}).then(function(e){return s.__parseAwsData(e)}),i=r("os_os",{provider:null}).then(function(e){return s.__parseOsData(e)}),Q.all([u,e,t,i]).then(function(){var e;try{o.cleanup(s.appList().pluck("id").concat(s.stackList().pluck("id")))}catch(t){e=t}})},__parseAwsData:function(e){var t,n,r,i,s,o,u,a,f,l;for(o=0,a=e.length;o<a;o++){n=e[o],r={},this.__awsdata[n.region]={price:n.price,osFamilyConfig:n.instance_types.sort,instanceTypeConfig:r,rds:n.rds},l=n.instance_types.info||[];for(u=0,f=l.length;u<f;u++){s=l[u];if(!s)continue;t=s.cpu||{},s.name=s.description,s.formated_desc=[s.name||"",t.units+" ECUs",t.cores+" vCPUs",s.memory+" GiB memory"],s.description=s.formated_desc.join(", "),i=s.storage,i&&i.ssd===!0&&(s.description+=", "+i.count+" x "+i.size+" GiB SSD Storage Capacity"),r[s.typeName]=s}}},__parseOsData:function(e){var t,n,s,o,u,a,f,l;a=this;for(o in e){n=e[o];for(f=0,l=n.length;f<l;f++)t=n[f],u=this.__osdata[o]||(this.__osdata[o]={}),u[t.region]={flavors:new i.Collection(_.values(t.flavor))};s=r("os_quota",{provider:o}).then(function(e){return a.__parseOsQuota(e)})}},__parseOsQuota:function(e){var t,n,r,i,s,o,u,a;a={};for(o in e){r=e[o];for(t in r){n=r[t];for(i in n)u=n[i],a[""+t+"::"+i]=u}s=this.__osdata[o]||(this.__osdata[o]={}),s.quota=a}},fetchStateModule:function(e,t){var r,i,s;return i=this.getStateModule(e,t),i?(r=Q.defer(),r.resolve(i),r.promise):(s=this,n("state_module",{mod_repo:e,mod_tag:t}).then(function(r){var i;try{r=JSON.parse(r)}catch(o){throw i=o,McError(n.Errors.InvalidRpcReturn,"Can't load state data. Please retry.")}return s.__stateModuleData[e+":"+t]=r,r}))},__parseListRes:function(e){var n,r,i,s;r=[];for(i=0,s=e.length;i<s;i++)n=e[i],r.push({id:n.id,updateTime:n.time_update,region:n.region,usage:n.usage,name:n.name,version:n.version,provider:n.provider,state:t.State[n.state]||t.State.UnRun,stoppable:!n.property||n.property.stoppable!==!1});return r},__initializeNotification:function(){var e;return e=this,App.WS.on("requestChange",function(t,n){return e.__processSingleNotification(t,n)})},__triggerNotification:_.debounce(function(){return this.trigger("change:notification")},400),__processSingleNotification:function(e){var t,n,r,i,s,o,u,a,f;s=App.WS.collection.request.findOne({_id:e});if(!s)return;r=this.__parseRequestInfo(s);if(!r)return;this.__handleRequestChange(r);if(r.operation==="save")return;n=this.attributes.notification;for(e=a=0,f=n.length;a<f;e=++a){t=n[e];if(t.id===r.id){o=t;break}}if(o&&_.isEqual(o.state,r.state))return;return r.readed=!App.WS.isReady(),!r.readed&&App.workspaces&&!r.state.failed&&(u=App.workspaces.getAwakeSpace(),i=this.appList().get(r.targetId)||this.stackList().get(r.targetId),r.readed=u.isWorkingOn(i)),n.splice(e,1),n.splice(0,0,r),n.length>30&&(n.length=30),this.__triggerNotification(),null},__parseRequestInfo:function(e){var t,n,r,i,o,a,f,l,c;if(!e.brief)return;t=e.dag,i={id:e.id,region:s.REGION_SHORT_LABEL[e.region],time:e.time_end,operation:s.OPS_CODE_NAME[e.code],targetId:t&&t.spec?t.spec.id:e.rid,targetName:e.brief.split(" ")[2]||"",state:{processing:!0},readed:!0};switch(e.state){case s.OPS_STATE.OPS_STATE_FAILED:i.error=e.data,i.state={failed:!0};break;case s.OPS_STATE.OPS_STATE_INPROCESS:i.time=e.time_begin,i.step=0;if(e.dag&&e.dag.step){i.totalSteps=e.dag.step.length,c=e.dag.step;for(f=0,l=c.length;f<l;f++)r=c[f],r[1]==="done"&&++i.step}else i.totalSteps=1;break;case s.OPS_STATE.OPS_STATE_DONE:i.operation==="save"&&(i.targetId=e.data),i.state={completed:!0,terminated:e.code==="Forge.App.Terminate"};break;case s.OPS_STATE.OPS_STATE_PENDING:i.state={pending:!0},i.time=""}return i.time&&(i.time=MC.dateFormat(new Date(i.time*1e3),"hh:mm yyyy-MM-dd"),e.state!==s.OPS_STATE.OPS_STATE_INPROCESS&&(o=parseInt(e.time_begin,10),a=parseInt(e.time_end,10),!isNaN(o)&&!isNaN(a)&&a>=o&&(n=a-o,n<60?i.duration=sprintf(u.TOOLBAR.TOOK_XXX_SEC,n):i.duration=sprintf(u.TOOLBAR.TOOK_XXX_MIN,Math.round(n/60))))),i},__handleRequestChange:function(e){var n;if(!App.WS.isReady()&&!e.state.processing)return;if(e.state.pending)return;n=this.appList().get(e.targetId),n||(n=this.appList().findWhere({requestId:e.id}),n&&e.targetId&&n.set("id",e.targetId));if(!n)return;if(!e.state.processing&&!n.isProcessing())return;if(n.testState(t.State.Terminating)&&e.operation!=="terminate"){void 0;return}return e.state.processing?n.setStatusProgress(e.step,e.totalSteps):n.setStatusWithWSEvent(e.operation,e.state,e.error)}})})}.call(this),function(){define("ide/User",["ApiRequest","ApiRequestR","backbone"],function(e,t){var n,r,i;return i={NotFirstTime:2},r={NoInfo:"",Pastdue:"pastdue",Unpaid:"unpaid",Active:"active"},n=Backbone.Model.extend({defaults:{paymentState:"",voQuotaPerMonth:1e3,voQuotaCurrent:0},initialize:function(){this.set({usercode:$.cookie("usercode"),username:Base64.decode($.cookie("usercode")),session:$.cookie("session_id")})},hasCredential:function(){return!!this.get("account")},isFirstVisit:function(){return!(i.NotFirstTime&this.get("state"))},fullnameNotSet:function(){return!this.get("firstName")||!this.get("lastName")},isUnpaid:function(){return this.get("paymentState")===r.Unpaid},shouldPay:function(){return this.get("voQuotaCurrent")>=this.get("voQuotaPerMonth")&&(!this.get("creditCard")||this.isUnpaid())},getBillingOverview:function(){var e;return e={quotaTotal:this.get("voQuotaPerMonth"),quotaCurrent:this.get("voQuotaCurrent"),billingStart:this.get("billingStart"),billingEnd:this.get("billingEnd"),billingRemain:Math.round((this.get("billingEnd")-new Date)/24/36e5)},e.quotaRemain=Math.max(e.quotaTotal-e.quotaCurrent,0),e.billingRemain=Math.min(e.billingRemain,31),e.billingRemain=Math.max(e.billingRemain,0),e.quotaPercent=Math.round(Math.min(e.quotaCurrent,e.quotaTotal)/Math.max(e.quotaCurrent,e.quotaTotal)*100),e},userInfoAccuired:function(t){var n,r,s,o,u,a,f,l;r=t.payment||{},o=r.self_page||{},s={email:Base64.decode(t.email),repo:t.mod_repo,tag:t.mod_tag,state:parseInt(t.state,10),intercomHash:t.intercom_secret,account:t.account_id,firstName:Base64.decode(t.first_name||""),lastName:Base64.decode(t.last_name||""),cardFirstName:Base64.decode(o.first_name||""),cardLastName:Base64.decode(o.last_name||""),voQuotaCurrent:r.current_quota||0,voQuotaPerMonth:r.max_quota||3600,has_card:!!r.has_card,paymentUrl:o.url,creditCard:o.card,billingEnd:new Date(o.current_period_ends_at||new Date),billingStart:new Date(o.current_period_started_at||new Date),renewDate:r.next_reset_time?new Date(r.next_reset_time*1e3):new Date,paymentState:r.state||"",awsAccessKey:t.access_key,awsSecretKey:t.secret_key,tokens:t.tokens||[],defaultToken:""},t.account_id==="demo_account"&&(s.account=s.awsAccessKey=s.awsSecretKey=""),l=s.tokens;for(n=a=0,f=l.length;a<f;n=++a){u=l[n];if(!u.name){s.defaultToken=u.token,s.tokens.splice(n,1);break}}this.set(s),this.isFirstVisit()&&e("account_update_account",{attributes:{state:""+(this.get("state")|i.NotFirstTime)}})},onWsUserStateChange:function(e){var n,r,i,s,o,u,a;void 0,o=this,s=e.payment;if(!e)return;n={current_quota:"voQuotaCurrent",max_quota:"voQuotaPerMonth",has_card:"creditCard",state:"paymentState"},r=!!e.time_update,u={};for(i in n){a=n[i];if(s!=null?s.hasOwnProperty(i):void 0)r=!0,u[a]=s[i]}r&&this.set(u),(s!=null?s.next_reset_time:void 0)&&App.user.set("renewDate",new Date(s.next_reset_time*1e3)),App.user.get("firstName")&&App.user.get("lastName")&&t("payment_self").then(function(e){return s={creditCard:e.card,billingEnd:new Date(e.current_period_ends_at||null),billingStart:new Date(e.current_period_started_at||null),paymentUrl:e.url,cardFirstName:e.card?Base64.decode(e.first_name||""):void 0,cardLastName:e.card?Base64.decode(e.last_name||""):void 0},o.set(s),o.trigger("paymentUpdate")})},bootIntercom:function(){var e;if(!window.Intercom){e=setInterval(function(t){return function(){window.Intercom&&(void 0,clearInterval(e),t.bootIntercom())}}(this),1e3);return}window.Intercom("boot",{app_id:"3rp02j1w",email:this.get("email"),username:this.get("username"),user_hash:this.get("intercomHash"),widget:{activator:"#support"}})},fetch:function(){var t;return t=this,e("session_login",{username:this.get("username"),password:this.get("session")}).then(function(n){t.userInfoAccuired(n),t.bootIntercom();if(t.hasCredential())return e("ec2_DescribeRegions").fail(function(){})},function(t){throw t.error<0?t.error===e.Errors.Network500?window.location="/500":window.location.reload():App.logout(),t})},acquireSession:function(t){return e("session_login",{username:this.get("username"),password:t}).then(function(e){return function(t){$.cookie("session_id",t.session_id,{expires:30,path:"/"}),e.set("session",t.session_id),e.userInfoAccuired(t),e.trigger("SessionUpdated")}}(this))},logout:function(){var e,t,n,r,i;r={domain:window.location.hostname.replace("ide",""),path:"/"},n={path:"/"},i=$.cookie();for(t in i)e=i[t],$.removeCookie(t,r),$.removeCookie(t,n)},changePassword:function(t,n){return e("account_update_account",{attributes:{password:t,new_password:n}})},changeEmail:function(t,n){var r;return r=this,e("account_update_account",{attributes:{password:n,email:t}}).then(function(){return r.set("email",t)})},changeName:function(t,n){var r,i;return i=this,r=new Q.defer,t===i.get("firstName")&&n===i.get("lastName")&&r.resolve(),e("account_update_account",{attributes:{first_name:t,last_name:n}}).then(function(e){return i.userInfoAccuired(e),r.resolve(e)},function(e){return r.reject(e)}),r.promise},validateCredential:function(t,n){return e("account_validate_credential",{access_key:t,secret_key:n})},changeCredential:function(t,n,r,i){var s;return t==null&&(t=""),n==null&&(n=""),r==null&&(r=""),i==null&&(i=!1),s=this,e("account_set_credential",{access_key:n,secret_key:r,account_id:t,force_update:i}).then(function(){var e;e={account:t,awsAccessKey:n,awsSecretKey:r},e.awsAccessKey.length>6&&(e.awsAccessKey=(new Array(n.length-6)).join("*")+n.substr(-6)),e.awsSecretKey.length>6&&(e.awsSecretKey=(new Array(r.length-6)).join("*")+r.substr(-6)),s.set(e),s.trigger("change:credential")})},createToken:function(){var t,n,r,i,s,o,u,a,f;o="MyToken",t=1,n={},f=this.attributes.tokens;for(u=0,a=f.length;u<a;u++)s=f[u],n[s.name]=!0;for(;;){r=o+t;if(!n[r])break;t+=1}return i=this,e("token_create",{token_name:r}).then(function(e){i.attributes.tokens.splice(0,0,{name:e[0],token:e[1]})})},removeToken:function(t){var n,r,i,s,o,u;u=this.attributes.tokens;for(n=s=0,o=u.length;s<o;n=++s){i=u[n];if(i.token===t)break}return r=this,e("token_remove",{token:t,token_name:i.name}).then(function(e){n=r.attributes.tokens.indexOf(i),n>=0&&r.attributes.tokens.splice(n,1)})},updateToken:function(t,n){var r;return r=this,e("token_update",{token:t,new_token_name:n}).then(function(e){var i,s,o,u,a;a=r.attributes.tokens;for(i=o=0,u=a.length;o<u;i=++o){s=a[i];if(s.token===t){s.name=n;break}}})}}),n.PaymentState=r,n})}.call(this),function(){define("ide/subviews/WorkspaceView",["i18n!/nls/lang.js","backbone","jquerysort"],function(e){return Backbone.View.extend({el:$("#tabbar-wrapper")[0],events:{"click li":"onClick","click .icon-close":"onClose"},initialize:function(e){var t;t=this,this.tabsWidth=0,this.$el.find("#ws-tabs").dragsort({horizontal:!0,dragSelectorExclude:".fixed, .icon-close",dragEnd:function(){t.updateTabOrder()}})},updateTabOrder:function(){return this.trigger("orderChanged",this.tabOrder())},tabOrder:function(){return _.map(this.$el.find("li"),function(e){return e.id})},setTabIndex:function(e,t,n){var r,i,s;s=this.$el.find("#"+e);if(!s.length)return;t?i=$("#ws-fixed-tabs"):(i=$("#ws-tabs"),n-=$("#ws-fixed-tabs").children().length),r=i.children().eq(n),r.length?s.insertBefore(r):i.append(s)},addTab:function(t,n,r){var i,s,o;return n==null&&(n=-1),r==null&&(r=!1),i=r?$("#ws-fixed-tabs"):$("#ws-tabs"),o="<li class='"+t.klass+"' id='"+t.id+"' title='"+t.title+"'><span class='truncate'>"+t.title+"</span>",t.closable&&(o+='<i class="icon-close" title="'+e.TOOLBAR.TIT_CLOSE_TAB+'"></i>'),s=i.children().eq(n),s.length?s=$(o+"</li>").insertAfter(s):s=$(o+"</li>").appendTo(i),this.tabsWidth+=s.outerWidth(),this.ensureTabSize(),s},removeTab:function(e){var t;return t=this.$el.find("#"+e),this.tabsWidth-=t.outerWidth(),t.remove(),this.ensureTabSize(),t},ensureTabSize:function(){var e,t,n;n=$(window).width(),e=n-$("#header").outerWidth()-$("#ws-tabs").offset().left,t=$("#ws-tabs").children(),this.tabsWidth<e?t.css("max-width","auto"):(e=Math.floor(e/t.length),t.css("max-width",e))},updateTab:function(e,t,n){var r;r=this.$el.find("#"+e);if(t!==void 0||t!==null)this.tabsWidth-=r.outerWidth(),r.attr("title",t),r.children("span").text(t),r.attr("title",t),this.tabsWidth+=r.outerWidth(),this.ensureTabSize();if(n!==void 0||n!==null)r.hasClass("active")&&(n+=" active"),r.attr("class",n)},activateTab:function(e){this.$el.find(".active").removeClass("active"),this.$el.find("#"+e).addClass("active")},onClick:function(e){this.trigger("click",e.currentTarget.id)},onClose:function(e){return this.trigger("close",$(e.currentTarget).closest("li")[0].id),!1},showLoading:function(){return $("#GlobalLoading").show()},hideLoading:function(){return $("#GlobalLoading").hide()}})})}.call(this),function(){define("ide/WorkspaceManager",["./subviews/WorkspaceView","underscore"],function(e){var t;return t=function(){function t(){var t;return this.view=new e,t=this,this.view.on("orderChanged",function(e){return t.__updateOrder(e)}),this.view.on("click",function(e){return t.awakeWorkspace(e)}),this.view.on("close",function(e){return t.remove(e)}),this.__spaces=[],this.__spacesById={},this.__awakeSpace=null,this}return t.prototype.__updateOrder=function(e){var t;t=this,this.__spaces=e.map(function(e){return t.__spacesById[e]})},t.prototype.spaces=function(){return this.__spaces.slice(0)},t.prototype.get=function(e){return this.__spacesById[e]},t.prototype.setIndex=function(e,t){this.view.setTabIndex(e.id,e.isFixed(),t),this.__updateOrder(this.view.tabOrder())},t.prototype.add=function(e){return this.__spacesById[e.id]=e,this.view.addTab({title:e.title(),id:e.id,closable:!e.isFixed(),klass:e.tabClass()},-1,e.isFixed()),this.__updateOrder(this.view.tabOrder()),this.__spaces.length===1&&this.awakeWorkspace(e),e},t.prototype.getAwakeSpace=function(){return this.__awakeSpace},t.prototype.awakeWorkspace=function(e){var t;if(!e)return;_.isString(e)&&(e=this.__spacesById[e]);if(this.__awakeSpace===e)return;if(e.isRemoved())return;this.__awakeSpace&&this.__awakeSpace.sleep(),this.__awakeSpace=e,this.__updateUrl(),this.view.activateTab(e.id),t=e.awake(),t&&t.then&&t.isFulfilled&&!t.isFulfilled()?(t.then(function(e){return function(){return e.view.hideLoading()}}(this)),this.view.showLoading()):this.view.hideLoading()},t.prototype.update=function(e){if(!e)return;return e===this.__awakeSpace&&this.__updateUrl(!0),this.view.updateTab(e.id,e.title(),e.tabClass()),e},t.prototype.remove=function(e,t){var n;if(!e)return;_.isString(e)&&(e=this.__spacesById[e]);if(!t&&!e.isRemovable())return;return n=e.id,this.view.removeTab(n),delete this.__spacesById[n],this.__spaces.splice(this.__spaces.indexOf(e),1),e.stopListening(),e.cleanup(),this.__awakeSpace===e&&(this.__awakeSpace=null,this.awakeWorkspace(this.__spaces[this.__spaces.length-1])),e},t.prototype.removeAllSpaces=function(e){var t,n,r,i;i=this.__spaces.slice(0);for(n=0,r=i.length;n<r;n++)t=i[n],!t.isFixed()&&(!e||e(t))&&this.remove(t,!0)},t.prototype.find=function(e){return _.find(this.__spaces,function(t){return t.isWorkingOn(e)})},t.prototype.hasUnsaveSpaces=function(){return this.__spaces.some(function(e){return e.isModified()})},t.prototype.__updateUrl=function(e){return e==null&&(e=!1),Router.navigate(this.__awakeSpace.url(),{replace:e})},t}(),t})}.call(this),function(){define("ide/Application",["ApiRequest","./Websocket","./ApplicationView","./ApplicationModel","./User","./subviews/SettingsDialog","CloudResources","./WorkspaceManager","OpsModel","JsonExporter","constant","i18n!/nls/lang.js","underscore"],function(e,t,n,r,i,s,o,u,a,f,l,c){var h;return h=function(){if(window.App){void 0;return}window.App=this},h.prototype.initialize=function(){var e;return this.__createUser(),this.__createWebsocket(),this.workspaces=new u,this.model=new r,this.__view=new n,e=this.model.fetch().fail(function(e){throw notification(c.NOTIFY.CANNOT_LOAD_APPLICATION_DATA),e}),Q.all([this.user.fetch(),e])},h.prototype.__createWebsocket=function(){this.WS=new t,this.WS.on("Disconnected",function(){return App.acquireSession()}),this.WS.on("StatusChanged",function(e){void 0;if(App.__view)return App.__view.toggleWSStatus(e)}),this.WS.on("userStateChange",function(e,t){return App.user.onWsUserStateChange(t)})},h.prototype.__createUser=function(){this.user=new i,this.user.on("SessionUpdated",function(e){return function(){return e.WS.subscribe()}}(this)),this.user.on("change:credential",function(e){return function(){return e.discardAwsCache()}}(this))},h.prototype.acquireSession=function(){return this.__view.showSessionDialog()},h.prototype.logout=function(){var e;App.user.logout(),e=window.location.pathname,e==="/"&&(e=window.location.hash.replace("#","/")),e&&e!=="/"?window.location.href="/login?ref="+e:window.location.href="/login"},h.prototype.canQuit=function(){return!this.workspaces.hasUnsaveSpaces()},h.prototype.showSettings=function(e){return new s({defaultTab:e})},h.prototype.showSettings.TAB=s.TAB,h.prototype.askForAwsCredential=function(){return this.__view.askForAwsCredential()},h.prototype.deleteStack=function(e,t){return this.__view.deleteStack(e,t)},h.prototype.duplicateStack=function(e){return this.__view.duplicateStack(e)},h.prototype.startApp=function(e){return this.__view.startApp(e)},h.prototype.stopApp=function(e){return this.__view.stopApp(e)},h.prototype.terminateApp=function(e){return this.__view.terminateApp(e)},h.prototype.discardAwsCache=function(){return o.invalidate()},h.prototype.importJson=function(e,t){var n;if(_.isString(e)){n=f.importJson(e);if(_.isString(n))return n}else n=e;return this.openOps(this.model.createStackByJson(n,t))},h.prototype.openOps=function(e,t){var n;if(!e)return;_.isString(e)&&(e=this.model.getOpsModelById(e));if(!e){void 0;return}if(e.testState(a.State.Destroyed)){void 0;return}return n=this.workspaces.find(e),n&&t&&(n.remove(),n=null),n||(n=new OpsEditor(e)),n.activate(),n},h.prototype.createOps=function(e,t){var n;if(!e)return;n=new OpsEditor(this.model.createStack(e,t)),n.activate(),n},h})}.call(this),function(){define("Workspace",["backbone"],function(){var e,t;return t=0,e=function(){function e(e){var n,r,i,s;s=App.workspaces.spaces();for(r=0,i=s.length;r<i;r++){n=s[r];if(n instanceof this.constructor&&n.isWorkingOn(e))return void 0,n}return this.id="space_"+ ++t,this.initialize(e),App.workspaces.add(this),this}return e.prototype.isAwake=function(){return App.workspaces.getAwakeSpace()===this},e.prototype.index=function(){return App.workspaces.spaces().indexOf(this)},e.prototype.setIndex=function(e){return App.workspaces.setIndex(this,e)},e.prototype.isRemoved=function(){return!!this.__isRemoved},e.prototype.remove=function(){if(this.__isRemoved)return;return this.__isRemoved=!0,App.workspaces.remove(this,!0)},e.prototype.updateTab=function(){return App.workspaces.update(this)},e.prototype.activate=function(){return App.workspaces.awakeWorkspace(this)},e.prototype.initialize=function(e){},e.prototype.isFixed=function(){return!1},e.prototype.isModified=function(){return!1},e.prototype.tabClass=function(){return""},e.prototype.title=function(){return""},e.prototype.awake=function(){if(this.view)return this.view.$el.show()},e.prototype.sleep=function(){$(document.activeElement).filter("input, textarea").blur();if(this.view)return this.view.$el.hide()},e.prototype.cleanup=function(){this.view?this.view.remove():void 0},e.prototype.isRemovable=function(){return!0},e.prototype.isWorkingOn=function(e){return!1},e.prototype.updateUrl=function(){this.isAwake()&&Router.navigate(this.url(),{replace:!0})},e}(),_.extend(e.prototype,Backbone.Events),e})}.call(this),function(){define("ide/Router",["backbone"],function(){return Backbone.Router.extend({routes:{"":"openDashboard"},initialize:function(){this.route(/^ops\/([^/]+$)/,"openOps"),this.route(/^store\/([^/]+$)/,"openStore")},openStore:function(e){var t;t=App.model.stackList().findWhere({sampleId:e}),t||(t=App.model.createSampleOps(e)),Router.navigate(t.url(),{replace:!0}),App.openOps(t)},openOps:function(e){App.openOps(e)||Router.navigate("/",{replace:!0})},openDashboard:function(){if(window.Dashboard)return window.Dashboard.activate()},start:function(){Backbone.history.start({pushState:!0})||(void 0,this.navigate("/",{replace:!0})),this.route(/^ops\/([^/]+)/,"openOps")},execute:function(){this.__forceReplace=!0,Backbone.Router.prototype.execute.apply(this,arguments),this.__forceReplace=!1},navigate:function(e,t){return this.__forceReplace&&(t=t||{},t.replace=!0),$(document).trigger("urlroute"),Backbone.Router.prototype.navigate.apply(this,arguments)}})})}.call(this),function(){define("ide/AppBundle",["./Application","OpsModel","Workspace","./Router"],function(e){return e})}.call(this);