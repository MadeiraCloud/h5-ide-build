define("ide/Websocket",["Meteor","backbone","event","MC"],function(e,t,n){var r,i,s,o;return s=null,r=""+MC.API_HOST+"/ws/",e._debug=function(){return console.log.apply(console,arguments)},i=function(){var t;return s?s:(s=this,this.connection=e.connect(r,!0),this.projects={},t={connection:this.connection},this.__sessionExpire=!1,this.collection={user:new e.Collection("user",t),imports:new e.Collection("imports",t),project:new e.Collection("project",t),history:new e.Collection("project_history",t),request:new e.Collection("request",t),status:new e.Collection("status",t),app:new e.Collection("app",t),stack:new e.Collection("stack",t)},this.collection.user.find().observe({removed:function(e){return App.WS.onUserSubError(e)}}),Deps.autorun(function(e){return function(){return e.statusChanged()}}(this)),this.pipeChanges(),setTimeout(function(e){return function(){e.shouldNotify=!0;if(!e.connection.status().connected)return e.statusChanged()}}(this),5e3),this.__appWideSubscripe(),this)},i.prototype.close=function(){return this.connection._stream.disconnect()},i.prototype.onUserSubError=function(e){void 0;if(this.__sessionExpire)return;this.__sessionExpire=!0,this.connection._stream.disconnect(),this.trigger("Disconnected")},i.prototype.statusChanged=function(){var e;e=this.connection.status().connected||this.__sessionExpire,e&&(this.shouldNotify=!0);if(!this.shouldNotify)return;return this.trigger("StatusChanged",e)},i.prototype.__appWideSubscripe=function(){return this.connection.subscribe("user",App.user.get("usercode"),App.user.get("session"),{onReady:function(){},onError:function(e){return s.onUserSubError(e)}}),this.connection.subscribe("imports",App.user.get("usercode"),App.user.get("session"))},o={project:0,history:1,request:2,stack:3,app:4,status:5},i.prototype.isSubReady=function(e,t){return this.projects[e][o[t]].ready()},i.prototype.subscribe=function(e){var t,n,r;if(this.projects[e])return;t=this,n=App.user.get("session"),r=App.user.get("usercode"),this.projects[e]=[this.connection.subscribe("project",r,n,e,{onError:function(n){return t.onError(n,e)}}),this.connection.subscribe("history",r,n,e),this.connection.subscribe("request",r,n,e),this.connection.subscribe("stack",r,n,e),this.connection.subscribe("app",r,n,e),this.connection.subscribe("status",r,n,e)]},i.prototype.unsubscribe=function(e){var t,n,r,i;i=this.projects[e]||[];for(n=0,r=i.length;n<r;n++)t=i[n],t.stop();delete this.projects[e]},i.prototype.onError=function(e,t){var n;void 0;if(!this.subscribeErrorState){this.subscribeErrorState=!0;try{this.unsubscribe(t)}catch(r){n=r}this.trigger("Disconnected")}},i.prototype.pipeChanges=function(){var e;return e=this,this.collection.imports.find().observe({added:function(t,n){return e.trigger("visualizeUpdate",t)},changed:function(t,n){return e.trigger("visualizeUpdate",t)}}),this.collection.status.find().observe({added:function(e,t){return n.trigger(n.UPDATE_STATE_STATUS_DATA,"add",e,t),n.trigger(n.UPDATE_STATE_STATUS_DATA_TO_EDITOR,e?[e.res_id]:[])},changed:function(e,t){return n.trigger(n.UPDATE_STATE_STATUS_DATA,"change",e,t),n.trigger(n.UPDATE_STATE_STATUS_DATA_TO_EDITOR,e?[e.res_id]:[])}})},_.extend(i.prototype,t.Events),i}),define("ide/subviews/SessionDialogTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<section class="invalid-session" id="SessionDialog">\n    <div class="confirmSession">\n        <div class="modal-text-major">\n            <p>'+o(n.i18n.call(t,"IDE.DASH_INVALID_SESSION_ERROR",{hash:{},data:i}))+"</p>\n            <p>"+o(n.i18n.call(t,"IDE.DASH_INVALID_SESSION_ACTION",{hash:{},data:i}))+'</p>\n        </div>\n        <div class="modal-text-minor">'+o(n.i18n.call(t,"IDE.DASH_INVALID_SESSION_WARNING",{hash:{},data:i}))+'</div>\n    </div>\n    <div class="reconnectSession" style="display:none;">\n        <div class="modal-text-major">'+o(n.i18n.call(t,"IDE.DASH_PROVIDE_PASSWORD_TO_RECONNECT",{hash:{},data:i}))+'</div>\n        <div class="modal-input">\n            <input type="password" id="SessionPassword" class="input" placeholder="Password" style="width:200px;" autofocus>\n        </div>\n    </div>\n</section>',s};return e.template(t)}),define("ide/subviews/SessionDialog",["i18n!/nls/lang.js","./SessionDialogTpl","UI.modalplus","backbone"],function(e,t,n){var r,i;return r=null,i=Backbone.View.extend({events:{"keyup #SessionPassword":"passwordChanged"},constructor:function(){var i;return r?r:(r=this,this.defer=Q.defer(),i=this,this.modal=new n({title:e.IDE.DASH_INVALID_SESSION,width:400,template:t(),disableClose:!0,hideClose:!0,confirm:{text:e.IDE.DASH_LBL_CONNECT},cancel:{text:e.IDE.DASH_LBL_CLOSE_SESSION,color:"red"}}),this.modal.on("confirm",function(){return i.showReconnect()}),this.modal.on("cancel",function(){return i.closeSession()}),this.modal.on("close",function(){return i.closeSession()}),this.setElement($("#modal-wrap")))},promise:function(){return this.defer.promise},showReconnect:function(){$(".invalid-session .confirmSession").hide(),$(".invalid-session .reconnectSession").show(),this.modal.find(".modal-confirm").text(e.IDE.DASH_LBL_CONNECT).attr("disabled","disabled"),this.modal.off("confirm"),this.modal.on("confirm",_.bind(this.connect,this))},closeSession:function(){return App.logout()},connect:function(){if(this.modal.find(".modal-confirm").is(":disabled"))return;return this.modal.find(".modal-confirm").attr("disabled","disabled"),App.user.acquireSession($("#SessionPassword").val()).then(function(e){return function(){e.remove(),e.defer.resolve(),App.ignoreChangesWhenQuit(),window.location.reload()}}(this),function(t){this.modal.find(".modal-confirm").removeAttr("disabled"),notification("error",e.NOTIFY.WARN_AUTH_FAILED),$("#SessionPassword").toggleClass("parsley-error",!0)})},passwordChanged:function(e){$("#SessionPassword").toggleClass("parsley-error",!1),($("#SessionPassword").val()||"").length>=6?this.modal.find(".modal-confirm").removeAttr("disabled"):this.modal.find(".modal-confirm").attr("disabled","disabled"),e.which===13&&this.connect()}}),i}),define("ide/subviews/AppTpl",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="loading-spinner"></div>'},n.loading=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<section class="disconnected-msg">\n  <div>'+o(n.i18n.call(t,"TOOLBAR.CONNECTION_LOST_TO_RECONNECT",{hash:{},data:i}))+"</div>\n  <div>"+o(n.i18n.call(t,"TOOLBAR.CHANGES_MAY_NOT_BE_SAVED",{hash:{},data:i}))+"</div>\n</section>",s},n.disconnectedMsg=e.template(t),n}),define("ide/subviews/FullnameTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<div class="complete-fullname">\n    <div class="control-group fullname">\n        <div class="half-group">\n            <label for="complete-firstname" class="account-label">'+o(n.i18n.call(t,"FIRST_NAME",{hash:{},data:i}))+'</label>\n            <input autocomplete="off" id="complete-firstname" class="input" type="text"/>\n        </div>\n        <div class="half-group">\n            <label for="complete-lastname" class="account-label">'+o(n.i18n.call(t,"LAST_NAME",{hash:{},data:i}))+'</label>\n            <input autocomplete="off" id="complete-lastname" class="input" type="text"/>\n        </div>\n    </div>\n    <p class="information">'+o(n.i18n.call(t,"YOU_CAN_LATER_UPDATE_PROFILE",{hash:{},data:i}))+"</p>\n</div>",s};return e.template(t)}),define("ide/subviews/FullnameSetup",["./FullnameTpl","UI.modalplus","i18n!/nls/lang.js","ApiRequest","backbone"],function(e,t,n,r){return Backbone.View.extend({events:{"click #submitFullName":"submit","change #complete-firstname":"changeInput","change #complete-lastname":"changeInput","keyup #complete-firstname":"changeInput","keyup #complete-lastname":"changeInput"},initialize:function(){return this.modal=new t({title:n.IDE.COMPLETE_YOUR_PROFILE,template:e(),width:"600",disableClose:!0,hideClose:!0,cancel:{hide:!0},confirm:{disabled:!0}}),this.modal.on("confirm",this.submit.bind(this)),this.setElement(this.modal.tpl)},changeInput:function(){var e,t,n;return n=this.modal.find(".modal-confirm"),e=this.modal.find("#complete-firstname"),t=this.modal.find("#complete-lastname"),!e.val()||!t.val()?n.attr("disabled",!0):n.attr("disabled",!1)},submit:function(){var e,t,i;return i=this,e=i.modal.$("#complete-firstname").val(),t=i.modal.$("#complete-lastname").val(),!e||!t?!1:(this.modal.find(".modal-confirm").attr("disabled",!0),this.modal.setContent(MC.template.loadingSpinner()),r("account_update_account",{attributes:{first_name:e,last_name:t}}).then(function(){return App.user.set("firstName",e),App.user.set("lastName",t),i.modal.close(),notification("info",n.IDE.PROFILE_UPDATED_SUCCESSFULLY)},function(){return i.modal.close(),notification("error",n.IDE.PROFILE_UPDATED_FAILED)}))}})}),define("ide/ApplicationView",["backbone","./subviews/SessionDialog","./subviews/AppTpl","./subviews/FullnameSetup","i18n!/nls/lang.js","constant"],function(e,t,n,r,i,s){return e.View.extend({el:$("body")[0],events:{"click .click-select":"selectText"},initialize:function(){return $(window).on("beforeunload",this.checkUnload),$(window).on("keydown",this.globalKeyEvent)},init:function(){App.user.fullnameNotSet()&&new r},checkUnload:function(){return App.canQuit()?void 0:i.IDE.BEFOREUNLOAD_MESSAGE},hideGlobalLoading:function(){return $("#GlobalLoading").hide()},globalKeyEvent:function(e){var t;t=e.target.nodeName.toLowerCase();if(t==="input"||t==="textarea"||e.target.contentEditable==="true")return;switch(e.which){case 8:e.preventDefault();return;case 191:return App.loadUrl("/cheatsheet"),!1}},toggleWSStatus:function(e){if(e)return $(".disconnected-msg").remove();if($(".disconnected-msg").show().length>0)return;return $(n.disconnectedMsg()).appendTo("body").on("mouseover",function(){$(".disconnected-msg").addClass("hovered"),$("body").on("mousemove.disconnectedmsg",function(e){var t,n,r,i;t=$(".disconnected-msg");if(!t.length){$("body").off("mousemove.disconnectedmsg");return}n=t.offset(),r=e.pageX,i=e.pageY;if(r<n.left||i<n.top||r>=n.left+t.outerWidth()||i>=n.top+t.outerHeight())$("body").off("mousemove.disconnectedmsg"),t.removeClass("hovered")})})},showSessionDialog:function(){return(new t).promise()},selectText:function(e){var t,n;try{n=document.body.createTextRange(),n.moveToElementText(e.currentTarget),n.select(),void 0}catch(r){t=r,window.getSelection&&(n=document.createRange(),n.selectNode(e.currentTarget),window.getSelection().addRange(n),void 0)}return!1},notifyUnpay:function(){notification("error","Failed to charge your account. Please update your billing info.")}})}),define("OpsModel",["ApiRequest","constant","CloudResources","ThumbnailUtil","backbone"],function(e,t,n,r){var i,s,o,u,a,f;return i={},f={OpenStack:"OpenstackOps",Amazon:"AwsOps"},u={UnRun:0,Running:1,Stopped:2,Initializing:3,Starting:4,Updating:5,Stopping:6,Terminating:7,Destroyed:8,Saving:9,RollingBack:10,Removing:11},a=["","Running","Stopped","Starting","Starting","Updating","Stopping","Terminating","","Saving","RollingBack","Removing"],o="2014-11-11",s=Backbone.Model.extend({type:"GenericOps",defaults:function(){return{updateTime:+(new Date),state:u.UnRun,version:o,name:"",provider:"",region:"",description:"",usage:"",unlimited:!1,importMsrId:void 0,stoppable:!0,requestId:"",progress:0,opsActionError:""}},constructor:function(e,t){var n,r;e=e||{},t=t||{};if(this.type==="GenericOps"){t.jsonData&&(r=t.jsonData.provider),e.provider=r||e.provider||"aws::global",void 0,n=i[e.provider];if(n)return new n(e,t)}return Backbone.Model.apply(this,arguments)},initialize:function(e,t){t&&t.jsonData&&this.__setJsonData(t.jsonData),this.__userTriggerAppProgress=!1},project:function(){var e,t,n,r,i;i=App.model.projects().models;for(n=0,r=i.length;n<r;n++){t=i[n],e=t.stacks().get(this)||t.apps().get(this);if(e)return t}return null},url:function(){var e;return e=this.project()||"",e&&(e=e.url()),e+"/"+this.relativeUrl()},relativeUrl:function(){return this.get("id")?"ops/"+this.get("id"):"unsaved/"+this.cid},credential:function(){return this.project().credOfProvider(this.get("provider"))},credentialId:function(){return(this.credential()||{}).id},isStack:function(){return this.attributes.state===u.UnRun?!0:this.attributes.state===u.Saving?(this.get("id")||"").indexOf("app-")===-1:!1},isApp:function(){return!this.isStack()},isImported:function(){return!!this.attributes.importMsrId},isPMRestricted:function(){return this.isApp()&&!this.get("unlimited")},testState:function(e){return this.attributes.state===e},getStateDesc:function(){return a[this.attributes.state]},toJSON:function(e){var n;return n=Backbone.Model.prototype.toJSON.call(this),n.stateDesc=a[n.state],n.regionName=t.REGION_SHORT_LABEL[n.region],n.url=this.url(),this.isProcessing()&&(n.progressing=!0),e&&e.thumbnail&&(n.thumbnail=r.fetch(n.id)),n},isPersisted:function(){return!!this.get("id")},isExisting:function(){var e;return e=this.get("state"),e===u.Destroyed&&void 0,!!this.get("id")&&e!==u.Destroyed},getMsrId:function(){return this.get("importMsrId")||void 0},getThumbnail:function(){return r.fetch(this.get("id"))},saveThumbnail:function(e){e?(r.save(this.get("id"),e),this.trigger("change")):r.save(this.get("id"),"")},getJsonData:function(){return{id:this.get("id")||"",name:this.get("name"),region:this.get("region"),usage:this.get("usage"),provider:this.get("provider"),version:this.get("version"),time_update:this.get("updateTime"),description:this.get("description"),property:{stoppable:this.get("stoppable")},resource_diff:this.__jsonData.resource_diff,component:this.__jsonData.component,layout:this.__jsonData.layout,agent:this.__jsonData.agent,stack_id:this.__jsonData.stack_id}},fetchJsonData:function(){return this.__fjdImport(this)||this.__fdjLocalInit(this)||this.__fjdStack(this)||this.__fjdApp(this)},__fdjLocalInit:function(){var t,n;if(this.isPersisted())return;return this.get("__________itsshitdontsave")?(t=Q.defer(),t.resolve(this),t.promise):this.get("duplicateTarget")?(n=this,e("stack_save_as",{region_name:this.get("region"),stack_id:this.get("duplicateTarget"),new_name:this.collection.getNewName()}).then(function(e){return n.__setJsonData(e),n.set({id:e.id,duplicateTarget:void 0})})):(this.__jsonData||this.__setJsonData(this.__defaultJson()),this.save())},__fjdImport:function(e){if(!this.isImported())return;return n(this.credentialId(),"OpsResource",this.getMsrId()).init({region:this.get("region"),project:this.project().id,provider:this.get("provider")}).fetchForceDedup().then(function(){return e.__setJsonData(e.generateJsonFromRes())})},generateJsonFromRes:function(){var e;return e=n(this.credentialId(),"OpsResource",this.getMsrId()).generatedJson,e.agent.module.repo||(e.agent.module={repo:App.user.get("repo"),tag:App.user.get("tag")}),e},__fjdStack:function(t){if(!this.isStack())return;return e("stack_info",{key_id:this.credentialId(),region_name:this.get("region"),stack_ids:[this.get("id")]}).then(function(e){return t.__setJsonData(e[0])})},__fjdApp:function(t){if(!this.isApp())return;return e("app_info",{key_id:this.credentialId(),region_name:this.get("region"),app_ids:[this.get("id")]}).then(function(e){return t.__setJsonData(e[0])})},__setJsonData:function(t){var n,r,i;if(!t)throw this.__destroy(),new McError(e.Errors.MissingDataInServer,"Stack/App doesn't exist.");t.agent||(t.agent={enabled:!1});if(!t.agent.module||!t.agent.module.repo)t.agent.module={repo:App.user.get("repo"),tag:App.user.get("tag")};return t.property||(t.property={stoppable:!0}),t.layout&&(t.layout.component&&(n=$.extend({},t.layout.component.node,t.layout.component.group),n.size=t.layout.size,t.layout=n),t.layout.size||(t.layout.size=[240,240])),(t.version||"").split("-").length<3&&(t.version=o),this.__jsonData={resource_diff:t.resource_diff,component:t.component,layout:t.layout,agent:t.agent},r=((i=t.property)!=null?i.stoppable:void 0)||!0,this.set({name:t.name||this.get("name"),version:t.version||o,stoppable:r,description:t.description,usage:t.usage,updateTime:t.time_update}),this},save:function(t,n){var i,s,o;return this.isApp()||this.testState(u.Saving)?this.__returnErrorPromise():(t=t||this.getJsonData(),t.id=this.get("id"),s=this.collection.where({name:t.name})||[],s.length>1||s[0]&&s[0]!==this?(i=Q.defer(),i.reject(McError(e.Errors.StackRepeatedStack,"Stack name has already been used.")),i.promise):(this.set("state",u.Saving),o=this,e(this.isPersisted()?"stack_save":"stack_create",{region_name:this.get("region"),spec:t,key_id:this.credentialId()}).then(function(e){return o.__setJsonData(e),o.set({state:u.UnRun,id:e.id}),r.save(e.id,n),o.trigger("jsonDataSaved",o),o},function(e){throw o.set("state",u.UnRun),e})))},remove:function(){var t,n,r;return this.isPersisted()&&this.isApp()?this.__returnErrorPromise():(r=this,t=this.collection,this.__userTriggerAppProgress=!0,this.__destroy(),this.isPersisted()?e("stack_remove",{region_name:this.get("region"),stack_id:this.get("id")}).fail(function(n){if(n.error===e.Errors.StackInvalidId)return;return r.__userTriggerAppProgress=!1,r.set("state",u.UnRun),t.add(r)}):(n=Q.defer(),n.resolve(),n.promise))},run:function(t,n){var r;return t.id="",t.stack_id=this.get("id"),r=this.project(),e("stack_run",{region_name:t.region,stack:t,app_name:n,key_id:this.credentialId()}).then(function(e){return r.apps().add(new s({name:n,requestId:e[0],state:u.Initializing,region:t.region,provider:t.provider,usage:t.usage,updateTime:+(new Date)}))})},duplicate:function(){if(this.isApp())return;return this.collection.add(new s({duplicateTarget:this.get("id"),provider:this.get("provider"),region:this.get("region")}))},stop:function(){var t;return!this.isApp()||this.get("state")!==u.Running?this.__returnErrorPromise():(t=this,this.attributes.progress=0,this.set("state",u.Stopping),this.__userTriggerAppProgress=!0,e("app_stop",{region_name:this.get("region"),key_id:this.credentialId(),app_id:this.get("id"),app_name:this.get("name")}).fail(function(e){throw t.__userTriggerAppProgress=!1,t.set("state",u.Running),e}))},start:function(){var t;return!this.isApp()||this.get("state")!==u.Stopped?this.__returnErrorPromise():(t=this,this.attributes.progress=0,this.set("state",u.Starting),this.__userTriggerAppProgress=!0,e("app_start",{region_name:this.get("region"),key_id:this.credentialId(),app_id:this.get("id"),app_name:this.get("name")}).fail(function(e){throw t.__userTriggerAppProgress=!1,t.set("state",u.Stopped),e}))},terminate:function(t,n){var r,i,s;return t==null&&(t=!1),this.isApp()?this.get("state")!==u.Stopped&&this.get("state")!==u.Running?this.__returnErrorPromise():(s=this,r=this.get("state"),this.attributes.progress=0,this.set("state",t?u.Removing:u.Terminating),this.__userTriggerAppProgress=!0,i=$.extend({region_name:this.get("region"),app_id:this.get("id"),app_name:this.get("name"),flag:t,key_id:this.credentialId()},n||{}),e("app_terminate",i).then(function(){t&&s.__destroy()},function(e){throw s.__userTriggerAppProgress=!1,s.set("state",r),e})):this.__returnErrorPromise()},update:function(t,n){var r,i,s;return this.isApp()?this.get("state")!==u.Stopped&&this.get("state")!==u.Running?this.__returnErrorPromise():this.testState(u.Updating)?(void 0,this.__updateAppDefer?this.__updateAppDefer.promise:this.__returnErrorPromise()):(i=this.get("state"),this.attributes.progress=0,this.__userTriggerAppProgress=!0,this.set("state",u.Updating),this.__updateAppDefer=Q.defer(),s=this,e("app_update",{region_name:this.get("region"),spec:t,app_id:this.get("id"),fast_update:n,key_id:this.credentialId()}).fail(function(e){return s.__userTriggerAppProgress=!1,s.__updateAppDefer.reject(e)}),r=function(e){throw s.__updateAppDefer=null,s.attributes.progress=0,s.set({state:i}),e},this.__updateAppDefer.promise.then(function(){return s.fetchJsonData().then(function(){return s.importMsrId=void 0,s.__updateAppDefer=null,s.set("state",u.Running)},r)},r)):this.__returnErrorPromise()},importApp:function(e){return e.id="",this.syncAppJson(e)},saveApp:function(e){return e.id=this.get("id"),this.syncAppJson(e)},syncAppJson:function(t){var n,r;return!this.isApp()||this.get("state")!==u.Stopped&&this.get("state")!==u.Running?this.__returnErrorPromise():this.testState(u.Saving)?(void 0,this.__saveAppDefer?this.__saveAppDefer.promise:this.__returnErrorPromise()):(t.id||this.set("name",t.name),n=this.get("state"),this.attributes.progress=0,this.__userTriggerAppProgress=!0,this.set("state",u.Saving),this.__saveAppDefer=Q.defer(),r=this,t.time_update=this.get("updateTime"),e("app_save_info",{spec:t,key_id:r.credentialId()}).then(function(e){r.id||(r.attributes.requestId=e[0]),r.attributes.importMsrId=void 0,t.time_update=e[3]},function(e){return r.__userTriggerAppProgress=!1,r.__saveAppDefer.reject(e)}),this.__saveAppDefer.promise.then(function(){r.__setJsonData(t),r.__saveAppDefer=null,r.attributes.requestId=void 0,r.attributes.progress=0,r.set("state",n)},function(e){throw r.__saveAppDefer=null,r.attributes.requestId=void 0,r.attributes.progress=0,r.set("state",n),e}))},isProcessing:function(){var e;return e=this.attributes.state,e===u.Initializing||e===u.Stopping||e===u.Updating||e===u.Terminating||e===u.Starting||e===u.Saving||e===u.RollingBack||e===u.Removing},isLastActionTriggerByUser:function(){return this.__userTriggerAppProgress},updateWithWSEvent:function(n){var r,i,s,o,a,f,l,c,h,p,d;if(n.state===t.OPS_STATE.INPROCESS&&this.isProcessing()){o=0,l=1;if(n.dag&&n.dag.step){l=n.dag.step.length,p=n.dag.step;for(c=0,h=p.length;c<h;c++)i=p[c],i[1]==="done"&&++o;n.dag.state==="Rollback"&&this.set("state",u.RollingBack)}s=parseInt(o*100/l),this.attributes.progress!==s&&(this.attributes.progress=s,this.trigger("change:progress",this,s));return}void 0,n.state===t.OPS_STATE.INPROCESS?f=0:n.state===t.OPS_STATE.DONE?f=1:f=2,r=u;switch(n.code){case t.OPS_CODE_NAME.LAUNCH:a=[r.Initializing,r.Running,r.Destroyed];break;case t.OPS_CODE_NAME.STOP:a=[r.Stopping,r.Stopped,r.Running];break;case t.OPS_CODE_NAME.START:a=[r.Starting,r.Running,r.Stopped];break;case t.OPS_CODE_NAME.TERMINATE:a=[r.Terminating,r.Destroyed,r.Stopped];break;case t.OPS_CODE_NAME.UPDATE:case t.OPS_CODE_NAME.STATE_UPDATE:if(this.__updateAppDefer){if(f===1){this.__updateAppDefer.resolve();return}if(f===2){this.__updateAppDefer.reject(McError(e.Errors.OperationFailure,n.data));return}}a=[r.Updating,r.Running,r.Stopped];break;case t.OPS_CODE_NAME.APP_SAVE:case t.OPS_CODE_NAME.APP_IMPORT:if(this.__saveAppDefer){if(f===1){this.__saveAppDefer.resolve();return}if(f===2){this.__saveAppDefer.reject(McError(e.Errors.OperationFailure,n.data));return}}a=[r.Saving,r.Running,r.Stopped]}a=a[f],!this.isProcessing()&&this.get("state")!==a&&(this.__userTriggerAppProgress=!1),this.attributes.opsActionError=f===2?n.data:"",a===u.Destroyed?this.__destroy():a&&this.set({state:a,progress:0})},destroy:function(){return void 0},__destroy:function(){var e;if(this.attributes.state===u.Destroyed)return;return r.remove(this.get("id")),e=this.getMsrId(),e&&n(this.credential(),"OpsResource",e).destroy(),this.attributes.state=u.Destroyed,this.trigger("destroy",this,this.collection)},__returnErrorPromise:function(){var t;return t=Q.defer(),t.resolve(McError(e.Errors.InvalidMethodCall,"Currently, the specific action can not be performed on the stack/app.")),t.promise},__defaultJson:function(){return{resource_diff:!0,component:{},layout:{size:[240,240]},agent:{enabled:!0,module:{repo:App.user.get("repo"),tag:App.user.get("tag")}}}}},{extend:function(e,t){var n,r,s,o,u;r=(window.__detailExtend||Backbone.Model.extend).call(this,e,t),u=t.supportedProviders;for(s=0,o=u.length;s<o;s++)n=u[s],i[n]=r;return r}}),s.Type=f,s.State=u,s.LatestVersion=o,s}),define("ide/submodels/Notification",["OpsModel","constant","backbone"],function(e,t){var n,r,i;return i={},i[t.OPS_CODE_NAME.LAUNCH]=[e.State.Initializing,e.State.Running,e.State.Destroyed,e.State.RollingBack],i[t.OPS_CODE_NAME.STOP]=[e.State.Stopping,e.State.Stopped,e.State.Running,e.State.RollingBack],i[t.OPS_CODE_NAME.START]=[e.State.Starting,e.State.Running,e.State.Stopped,e.State.RollingBack],i[t.OPS_CODE_NAME.TERMINATE]=[e.State.Terminating,e.State.Destroyed,e.State.Stopped,e.State.RollingBack],i[t.OPS_CODE_NAME.UPDATE]=i[t.OPS_CODE_NAME.STATE_UPDATE]=[e.State.Updating,e.State.Running,e.State.Stopped,e.State.RollingBack],n=Backbone.Model.extend({"default":{isNew:!0,startTime:0,duration:0,action:"",state:null,progress:0,error:""},constructor:function(e){Backbone.Model.call(this,{id:e.id}),this.__target=e,this.__targetProject=e.project()},target:function(){return this.__target},targetProject:function(){return this.__targetProject},remove:function(){this.__target=null,this.stopListening(),this.trigger("destroy",this,this.collection)},isNew:function(){return this.get("isNew")},raw:function(){var e,t,n;n=App.WS.collection.request._collection.docs||{};for(e in n){t=n[e];if(t.id===this.requestId)return t.dag}return null},markAsRead:function(){this.attributes.isNew=!1},markAsOld:function(){if(this.get("error"))this.attributes.isNew=!1;else{if(this.isProcessing()||this.isRollingBack())return;this.remove()}},updateWithRequest:function(e){var n,r,i,s,o,u,a,f,l,c,h,p;void 0,this.requestId=e.id;if(e.time_submit<this.get("startTime")){void 0;return}if(e.username!==App.user.get("usercode"))return void 0,this.remove();e.time_end&&e.time_end>e.time_submit?r=e.time_end-e.time_submit:r=0,u=null,i="",o=0;if(e.state===t.OPS_STATE.INPROCESS){f=0,a=0,l=1;if(e.dag&&e.dag.step){l=e.dag.step.length,p=e.dag.step;for(c=0,h=p.length;c<h;c++)s=p[c],s[1]==="done"&&++a;e.dag.state==="Rollback"&&(f=3)}o=parseInt(a*100/l)}else e.state===t.OPS_STATE.DONE?f=1:(f=2,i=e.data);n=this.attributes,n.progress=o,this.set({startTime:e.time_submit,duration:r,action:e.code,error:i,state:f,isNew:n.startTime!==e.time_submit||n.duration!==r||n.action!==e.code||n.error!==i||n.state!==f||n.isNew})},isProcessing:function(){return this.get("state")===0},isRollingBack:function(){return this.get("state")===4},isSucceeded:function(){return this.get("state")===1},isFailed:function(){return this.get("state")===2}}),r=Backbone.Collection.extend({model:n,comparator:function(e,t){return-(e.attributes.startTime-t.attributes.startTime)},initialize:function(){this.on("change:startTime",this.sort,this)},add:function(e,t){var r;return r=new n(e),void 0,r.updateWithRequest(t),Backbone.Collection.prototype.add.call(this,r),r},markAllAsRead:function(){var e,t,n,r,i;e=!1,i=this.models;for(n=0,r=i.length;n<r;n++)t=i[n],t.get("isNew")&&(e=!0,t.markAsRead());e&&this.trigger("change")}}),r}),define("ProjectLog",["constant","backbone"],function(e){var t,n,r,i;return n=Backbone.Model.extend({comparator:function(e,t){return-(e.attributes.time-t.attributes.time)},constructor:function(e,t){var n;return n=e.action.split("."),Backbone.Model.call(this,{id:e.id,usercode:e.username,username:Base64.decode(e.username||""),type:n[1]||"",action:n[2]||"",success:e.result===0,detail:e.detail,target:e.target,targetId:e.target_id,time:e.time,duration:e.duration},t)}},{TYPE:{APP:"App",APPSTATE:"AppState",STACK:"Stack",PROJECT:"Project",MEMBER:"Member",PAYMENT:"Payment",CREDENTIAL:"Credential",TOKEN:"Token"}}),t={},t[n.TYPE.PROJECT]=!0,t[n.TYPE.MEMBER]=!0,t[n.TYPE.PAYMENT]=!0,t[n.TYPE.CREDENTIAL]=!0,t[n.TYPE.TOKEN]=!0,i=function(e){return!t[e.get("type")]},r=function(e){return t[e.get("type")]},n.Collection=Backbone.Collection.extend({model:n,history:function(){return this.filter(i)},audit:function(){return this.filter(r)}}),n}),define("ide/submodels/OpsCollection",["OpsModel","constant","backbone"],function(e,t){return Backbone.Collection.extend({model:e,newNameTmpl:"untitled",comparator:function(e,t){return-(e.attributes.updateTime-t.attributes.updateTime)},initialize:function(){this.on("change:updateTime",this.sort,this)},getNewName:function(e){var t,n,r,i,s;n=this.groupBy("name"),t=0,e?(r=e.match(/(.+)(-\d*)$/),s=r?r[1]:e):s=this.newNameTmpl,i=s+"-0";for(;;){if(!n[i])break;t+=1,i=s+"-"+t}return i},isNameAvailable:function(e){return e&&!this.findWhere({name:e})},groupByRegion:function(e,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m;e==null&&(e=!1),n==null&&(n=!0),r==null&&(r=!1),f={},v=this.models;for(c=0,p=v.length;c<p;c++){o=v[c];if(!r&&!o.isExisting())continue;a=o.attributes.region,s=f[a]||(f[a]=[]),s.push(n?o.toJSON():o)}l=[],m=t.REGION_KEYS;for(h=0,d=m.length;h<d;h++){i=m[h],u=f[i];if(!u&&!e)continue;l.push({region:i,regionName:t.REGION_SHORT_LABEL[i],data:u||[]})}return l},filterRecent:function(t){var n,r,i,s,o,u,a;t==null&&(t=!1),i=Math.round(+(new Date)/1e3),n=[],a=this.models;for(o=0,u=a.length;o<u;o++){r=a[o];if(r.testState(e.State.Terminating))continue;s=r.get("updateTime");if(i-s>=2592e3)break;t&&(r=r.toJSON(),r.formatedTime=MC.intervalDate(s)),n.push(r)}return n},add:function(e){return this.isNameAvailable(e.get("name"))||(e.attributes.name=this.getNewName(e.get("name"))),Backbone.Collection.prototype.add.apply(this,arguments),e}})}),define("Credential",["ApiRequest","backbone"],function(e){var t,n,r,i;return i=function(e){return e.length>6?(new Array(e.length-6)).join("*")+e.substr(-6):e},n={AWSGLOBAL:"aws::global",AWSCHINA:"aws::china"},r={"aws::global":"AWS Global","aws::china":"AWS China"},t=Backbone.Model.extend({constructor:function(e,t){Backbone.Model.call(this),void 0,this.set({project:t.project,id:e.id,provider:e.provider,isDemo:e.is_demo,alias:e.alias,awsAccount:e.account_id,awsAccessKey:e.access_key,awsSecretKey:e.secret_key})},isDemo:function(){return!!this.get("isDemo")},__update:function(t,n){return e("project_update_credential",{project_id:this.get("project").id,key_id:this.id,credential:t,force_update:n})},formatCredForRequest:function(e,t){return t?{alias:"",account_id:"",access_key:"",secret_key:"",provider:e.provider||n.AWSGLOBAL}:{alias:e.alias,account_id:e.awsAccount,access_key:e.awsAccessKey,secret_key:e.awsSecretKey,provider:e.provider||n.AWSGLOBAL}},add:function(){var t,n,r;return n=this,t=this.formatCredForRequest(this.attributes),r=this.get("project"),e("project_add_credential",{project_id:r.id,credential:t}).then(function(e){return n.set("id",e[1]),r.credentials().add(n),e})},update:function(e,t){var n,r,i;return t==null&&(t=!1),i=this,n=this.formatCredForRequest(e),r=this.__update(n,t),r.then(function(t){return i.set({isDemo:!1,alias:e.alias,awsAccount:e.awsAccount,awsAccessKey:e.awsAccessKey,awsSecretKey:e.awsSecretKey})})},save:function(e,t,n){return t==null&&(t=!1),n==null&&(n=!0),e||(e=this.attributes),this.id?this.update(e,t,n):this.add(e,n)},destroy:function(t){var n,r,i;return r=this,i=this.get("project"),n=this.formatCredForRequest(this.attributes,!0),e("project_update_credential",{project_id:i.id,key_id:this.id,credential:n,force_update:!1}).then(function(e){var t;return t=e[1],r.set({isDemo:!0,alias:"",awsAccount:t[0],awsAccessKey:t[1],awsSecretKey:t[2]}),e})},toJSON:function(){return _.extend({},this.attributes,{awsAccessKey:i(this.attributes.awsAccessKey),awsSecretKey:i(this.attributes.awsSecretKey)})},getProviderName:function(){return r[this.get("provider")]}},{PROVIDER:n}),t.Collection=Backbone.Collection.extend({model:t}),t}),define("Project",["ApiRequest","ProjectLog","ide/submodels/OpsCollection","OpsModel","Credential","ApiRequestR","constant","backbone"],function(e,t,n,r,i,s,o){var u,a,f,l;return l={},f=function(e){l[e]&&(void 0,clearTimeout(l[e]),delete l[e])},a=function(){var e,t,n;a=function(){},App.WS.collection.project.find().observe({changed:function(e,t){var n;return(n=App.model.projects().get(e.id))!=null?n.updateWithWsData(e):void 0},removed:function(e){var t;if(!e)return;void 0,(t=App.model.projects().get(e.id))!=null&&t.cleanup()}}),App.WS.collection.history.find().observe({added:function(e){var t;if(!e)return;t=App.model.projects().get(e.project_id);if(!t){void 0;return}t.logs().unshift(e)}}),n=function(e,n,i,s){delete l[i.id];if(e.get(i.id))return;if(_.isFunction(n)){if(e.filter(n).length===0){void 0,e.add(new r(i));return}}else if(!e.findWhere(n)){void 0,e.add(new r(i));return}if(s===5){void 0;return}void 0,t(e,n,i,s+1,2e3)},t=function(e,t,r,i,s){l[r.id]=setTimeout(function(){return n(e,t,r,i)},s)},App.WS.collection.stack.find().observe({added:function(e){var n,i;if(!e||!App.WS.isSubReady(e.project_id,"stack"))return;n=App.model.projects().get(e.project_id);if(!n){void 0;return}i=n.__parseListRes([e])[0],t(n.stacks(),{name:i.name,provider:i.provider,region:i.region,state:r.State.Saving},i,0,1e3)},changed:function(e){var t,n;if(!e||!App.WS.isSubReady(e.project_id,"stack"))return;t=App.model.projects().get(e.project_id),t||void 0,(n=t.stacks().get(e.id))!=null&&n.set("name",e.name)},removed:function(e){var t,n;if(!e||!App.WS.isSubReady(e.project_id,"stack"))return;t=App.model.projects().get(e.project_id);if(!t){void 0;return}(n=t.stacks().get(e.id))!=null&&n.__destroy()}}),App.WS.collection.app.find().observe({added:function(e){var n,i,s;if(!e||!App.WS.isSubReady(e.project_id,"app"))return;n=App.model.projects().get(e.project_id);if(!n){void 0;return}s=n.__parseListRes([e])[0],i=function(e){var t;return t=e.attributes,t.name!==s.name?!1:t.provider!==s.provider?!1:t.region!==s.region?!1:t.state===r.State.Initializing||t.state===r.State.Saving},t(n.apps(),i,s,0,1e3)},changed:function(e){var t,n;if(!e||!App.WS.isSubReady(e.project_id,"app"))return;t=App.model.projects().get(e.project_id);if(!t){void 0;return}(n=t.apps().get(e.id))!=null&&n.set("name",e.name)},removed:function(e){var t,n;if(!e||!App.WS.isSubReady(e.project_id,"app"))return;n=App.model.projects().get(e.project_id);if(!n){void 0;return}t=n.apps().get(e.id),t&&(t.testState(r.State.RollingBack)?setTimeout(function(){return t.__destroy()},5e3):t.__destroy())}}),e=function(e){var t,n;if(!e.project_id||e.state===o.OPS_STATE.PENDING)return;e.state!==o.OPS_STATE.DONE||e.code!==o.OPS_CODE_NAME.APP_SAVE&&e.code!==o.OPS_CODE_NAME.APP_IMPORT?n=e.dag&&e.dag.spec?e.dag.spec.id:e.rid:n=e.data;if(!App.WS.isSubReady(e.project_id,"request"))return;t=App.model.projects().get(e.project_id);if(!t)return;t=t.apps().get(n)||t.apps().findWhere({requestId:e.id});if(!t)return;!t.id&&n&&t.set("id",n),t.updateWithWSEvent(e)},App.WS.collection.request.find().observe({added:e,changed:e})},u={ADMIN:"admin",MEMBER:"collaborator",OBSERVER:"observer"},Backbone.Model.extend({defaults:function(){return{name:"",tokens:[],credentials:new i.Collection,stacks:new n,apps:new n,logs:new t.Collection,members:null,myRole:"observer","private":!1,billingState:""}},constructor:function(e){var t,n,r,i,s,o;Backbone.Model.apply(this),this.set({id:e.id,name:e.name||"My Workspace","private":e.id===App.user.id,billingState:(s=e.payment)!=null?s.state:void 0}),o=e.tokens||[];for(t=r=0,i=o.length;r<i;t=++r)n=o[t],n.name?this.attributes.tokens.push(n):this.attributes.defaultToken=n.token;this.credentials().set(e.credentials,{project:this,silent:!0}),this.listenTo(this.credentials(),"change",function(){return this.trigger("change:credential")}),this.listenTo(this.credentials(),"add",function(){return this.trigger("update:credential")}),this.listenTo(this.credentials(),"remove",function(){return this.trigger("update:credential")}),this.__checkMyRole(e.members),this.stacks().set(this.__parseListRes(e.stacks||[])),this.apps().set(this.__parseListRes(e.apps||[])),this.listenTo(this.stacks(),"change",function(){return this.trigger("change:stack")}),this.listenTo(this.stacks(),"change:id",function(){return this.trigger("update:stack")}),this.listenTo(this.stacks(),"add",function(){return this.trigger("update:stack")}),this.listenTo(this.stacks(),"remove",function(e){return f(e.id),this.trigger("update:stack")}),this.listenTo(this.apps(),"change",function(){return this.trigger("change:app")}),this.listenTo(this.apps(),"add",function(){return this.trigger("update:app")}),this.listenTo(this.apps(),"remove",function(e){return f(e.id),this.trigger("update:app")}),App.WS.subscribe(this.id),a()},stacks:function(){return this.get("stacks")},apps:function(){return this.get("apps")},credentials:function(){return this.get("credentials")},logs:function(){return this.get("logs")},tokens:function(){return this.get("tokens")},defaultToken:function(){return this.get("defaultToken")},getOpsModel:function(e){return this.get("stacks").get(e)||this.get("apps").get(e)},url:function(){return"workspace/"+this.get("id")},showCredential:function(){return App.loadUrl("/settings/"+this.get("id")+"/credential")},isPrivate:function(){return this.get("private")},hasCredential:function(){return void 0,this.get("credentials").length>0},credIdOfProvider:function(e){return(this.credOfProvider(e)||{}).id},credOfProvider:function(e){var t,n,r,i;i=this.get("credentials").models;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.get("provider")===e)return t}return null},shouldPay:function(){var e;return(e=this.get("billingState"))!=="active"&&e!=="pastdue"},amIAdmin:function(){return this.get("myRole")===u.ADMIN||this.isPrivate()},amIMeber:function(){return this.get("myRole")===u.MEMBER},amIObserver:function(){return this.get("myRole")===u.OBSERVER},isDemoMode:function(e){var t;return e==null&&(e=i.PROVIDER.AWSGLOBAL),t=this.credentials().findWhere({provider:e}),t&&t.isDemo()||!1},updateName:function(t){var n;return n=this,e("project_rename",{project_id:this.id,spec:{name:t}}).then(function(e){return n.set("name",t),e})},destroy:function(){var t;return t=this,this.__manualDestroy=!0,e("project_remove",{project_id:this.id}).then(function(e){return t.cleanup(),e},function(e){throw t.__manualDestroy=!1,e})},cleanup:function(){if(this.__isRemoved)return;this.__isRemoved=!0,this.trigger("destroy",this,this.collection,{manualAction:!!this.__manualDestroy}),App.WS.unsubscribe(this.id)},leave:function(){var t;return t=this,this.__manualDestroy=!0,e("project_remove_members",{project_id:this.id,member_ids:[App.user.id]}).then(function(e){return t.cleanup(),e},function(e){throw self.__manualDestroy=!1,e})},createStack:function(e,t){return t==null&&(t=i.PROVIDER.AWSGLOBAL),this.stacks().add(new r({region:e,provider:t}))},createStackByJson:function(e,t){return t==null&&(t=!1),this.stacks().add(new r({name:e.name,region:e.region,autoLayout:t,__________itsshitdontsave:t},{jsonData:e}))},createAppByExistingResource:function(e,t,n){return n==null&&(n=i.PROVIDER.AWSGLOBAL),this.apps().findWhere({importMsrId:e})||this.apps().add(new r({name:"ImportedApp",importMsrId:e,region:t,provider:n,state:r.State.Running}))},__parseListRes:function(e){var t,n,i,s;n=[];for(i=0,s=e.length;i<s;i++)t=e[i],n.push({id:t.id,updateTime:t.time_update,region:t.region,usage:t.usage,name:t.name,version:t.version,provider:t.provider,state:r.State[t.state]||r.State.UnRun,stoppable:!t.property||t.property.stoppable!==!1,unlimited:t.before_charge});return n},getPaymentState:function(){var e,t;return t=this,e=this.get("id"),s("payment_self",{projectId:e}).then(function(e){var n;return n={email:e.email,cardNumber:e.card,lastName:e.last_name,firstName:e.first_name,periodEnd:e.current_period_ends_at,periodStart:e.current_period_started_at,maxQuota:e.max_quota,currentQuota:e.current_quota,nextPeriod:e.next_assessment_at,paymentState:e.state},n.renewDays=Math.round((new Date(n.nextPeriod)-new Date)/864e5),n.isDefault=t.isPrivate(),n.failToCharge=t.shouldPay(),t.set("payment",n),n})},__checkMyRole:function(e){var t,n,r,i,s;t=App.user.id,s=e||[];for(r=0,i=s.length;r<i;r++){n=s[r];if(n.id===t){this.set("myRole",n.role);return}}},updateWithWsData:function(e){var t,n,r,i,s,o,u,a;e.name&&this.set("name",e.name),e.members&&this.__checkMyRole(e.members),e.payment&&this.set("billingState",e.payment.state);if(e.credentials){n={},u=e.credentials;for(r=0,s=u.length;r<s;r++)t=u[r],this.credentials().get(t.id)?this.credentials().get(t.id).set("isDemo",t.is_demo):this.credentials.add(t,{project:this}),n[t.id]=!0;a=this.credentials().models.slice(0);for(i=0,o=a.length;i<o;i++)t=a[i],n[t.id]||this.credentials().remove(t)}}},{MEMBERROLE:u})}),define("ide/ApplicationModel",["OpsModel","./submodels/Notification","Project","ApiRequest","ApiRequestOs","ThumbnailUtil","constant","i18n!/nls/lang.js","backbone"],function(e,t,n,r,i,s,o,u){return Backbone.Model.extend({getPriceData:function(e){return(this.__awsdata[e]||{}).price},getOsFamilyConfig:function(e){return(this.__awsdata[e]||{}).osFamilyConfig},getInstanceTypeConfig:function(e){return(this.__awsdata[e]||{}).instanceTypeConfig},getRdsData:function(e){return(this.__awsdata[e]||{}).rds},getStateModule:function(e,t){return this.__stateModuleData[e+":"+t]},getOpenstackFlavors:function(e,t){return this.__osdata[e][t].flavors},getOpenstackQuotas:function(e){return this.__osdata[e].quota},notifications:function(){return this.get("notifications")},fetchUserData:function(e){var t,n,i,s,o,u,a,f;s=[],n={};for(a=0,f=e.length;a<f;a++)o=e[a],u=this.__vousercache[o],u===void 0?s.push(o):u&&(n[o]=$.extend({},u));return s.length?(i=this,r("account_list_user",{user_list:s}).then(function(e){var r,u,a,f,l;for(u=0,f=s.length;u<f;u++)o=s[u],i.__vousercache[o]=!1;for(a=0,l=e.length;a<l;a++)t=e[a],r=i.__vousercache[t.username]={usercode:t.username,email:Base64.decode(t.email||"")},r.avatar="https://www.gravatar.com/avatar/"+CryptoJS.MD5(r.email.trim().toLowerCase()).toString(),n[t.username]=$.extend({},r);return n})):(t=Q.defer(),t.resolve(n),t.promise)},getOpsModelById:function(e){var t,n,r,i,s;s=this.get("projects").models;for(r=0,i=s.length;r<i;r++){n=s[r],t=n.getOpsModel(e);if(t)return t}return null},projects:function(){return this.get("projects")},getPrivateProject:function(){var e,t,n,r;r=this.get("projects").models;for(t=0,n=r.length;t<n;t++){e=r[t];if(e.isPrivate())return e}return null},createProject:function(e){var t;return t=this,r("project_create",{project_name:e.name,first_name:e.firstname,last_name:e.lastname,email:e.email,credit_card:{full_number:e.card.number,expiration_month:e.card.expire.split("/")[0]||"",expiration_year:e.card.expire.split("/")[1]||"",cvv:e.card.cvv}}).then(function(e){var r;return r=new n(e),t.projects().add(r),r})},defaults:function(){return{notifications:new t,projects:new(Backbone.Collection.extend({comparator:function(e){return e.isPrivate()?"":e.get("name")},initialize:function(){this.on("change:name",this.sort,this)}}))}},initialize:function(){var e;this.__awsdata={},this.__osdata={},this.__stateModuleData={},this.__vousercache={},e=this,App.WS.collection.request.find().observe({added:function(t){return e.__handleRequest(t)},changed:function(t){return e.__handleRequest(t)}})},fetch:function(){var e,t,n;return n=this,t=r("project_list").then(function(e){return n.__parseProjectData(e)}),e=r("aws_aws",{fields:["region","price","instance_types","rds"]}).then(function(e){return n.__parseAwsData(e)}),Q.all([t,e]).then(function(){var e,t,r,i,o;e=[],o=n.projects().models;for(r=0,i=o.length;r<i;r++)t=o[r],e=e.concat(t.stacks().pluck("id"),t.apps().pluck("id"));s.cleanup(e)})},__parseProjectData:function(e){var t,r,i,s;s=e||[];for(r=0,i=s.length;r<i;r++)t=s[r],this.attributes.projects.add(new n(t))},__parseAwsData:function(e){var t,n,r,i,s,o,u,a,f,l;for(o=0,a=e.length;o<a;o++){n=e[o],r={},this.__awsdata[n.region]={price:n.price,osFamilyConfig:n.instance_types.sort,instanceTypeConfig:r,rds:n.rds},l=n.instance_types.info||[];for(u=0,f=l.length;u<f;u++){s=l[u];if(!s)continue;t=s.cpu||{},s.name=s.description,s.formated_desc=[s.name||"",t.units+" ECUs",t.cores+" vCPUs",s.memory+" GiB memory"],s.description=s.formated_desc.join(", "),i=s.storage,i&&i.ssd===!0&&(s.description+=", "+i.count+" x "+i.size+" GiB SSD Storage Capacity"),r[s.typeName]=s}}},__parseOsData:function(e){var t,n,r,i,s,o,u;s=this;for(r in e){n=e[r];for(o=0,u=n.length;o<u;o++)t=n[o],i=this.__osdata[r]||(this.__osdata[r]={}),i[t.region]={flavors:new Backbone.Collection(_.values(t.flavor))}}},__parseOsQuota:function(e){var t,n,r,i,s,o,u,a;a={};for(o in e){r=e[o];for(t in r){n=r[t];for(i in n)u=n[i],a[""+t+"::"+i]=u}s=this.__osdata[o]||(this.__osdata[o]={}),s.quota=a}},fetchStateModule:function(e,t){var n,i,s;return i=this.getStateModule(e,t),i?(n=Q.defer(),n.resolve(i),n.promise):(s=this,r("state_module",{mod_repo:e,mod_tag:t}).then(function(n){var i;try{n=JSON.parse(n)}catch(o){throw i=o,McError(r.Errors.InvalidRpcReturn,"Can't load state data. Please retry.")}return s.__stateModuleData[e+":"+t]=n,n}))},__handleRequest:function(e){var t,n,r,i;if(!e.project_id)return;if(e.state===o.OPS_STATE.PENDING)return;if(e.code===o.OPS_CODE_NAME.APP_SAVE||e.code===o.OPS_CODE_NAME.APP_IMPORT)return;r=e.dag&&e.dag.spec?e.dag.spec.id:e.rid,t=((i=this.projects().get(e.project_id))!=null?i.apps().get(r):void 0)||this.notifications().get(r);if(!t||!t.id)return;n=this.notifications().get(t.id),n?n.updateWithRequest(e):e.username===App.user.get("usercode")&&(n=this.notifications().add(t,e)),!App.WS.isSubReady(e.project_id,"request")&&n&&n.markAsOld()}})}),define("ide/User",["ApiRequest","backbone","crypto"],function(e){var t;return t={NotFirstTime:2},Backbone.Model.extend({initialize:function(){this.set({usercode:$.cookie("usercode"),username:Base64.decode($.cookie("usercode")),session:$.cookie("session_id")})},fullnameNotSet:function(){return!this.get("firstName")||!this.get("lastName")},userInfoAccuired:function(e){this.set({id:e.id,email:Base64.decode(e.email),state:parseInt(e.state,10),intercomHash:e.intercom_hash,firstName:Base64.decode(e.first_name||""),lastName:Base64.decode(e.last_name||""),repo:e.mod_repo,tag:e.mod_tag})},bootIntercom:function(){var e;if(!window.Intercom){e=setInterval(function(t){return function(){window.Intercom&&(void 0,clearInterval(e),t.bootIntercom())}}(this),1e3);return}window.Intercom("boot",{app_id:"3rp02j1w",email:this.get("email"),username:this.get("username"),user_hash:this.get("intercomHash")})},fetch:function(){var t;return t=this,e("session_login",{username:this.get("username"),password:this.get("session")}).then(function(e){t.userInfoAccuired(e),t.bootIntercom()})},acquireSession:function(t){return e("session_login",{username:this.get("username"),password:t}).then(function(e){return function(t){$.cookie("session_id",t.session_id,{expires:30,path:"/"}),e.set("session",t.session_id),e.userInfoAccuired(t),e.trigger("SessionUpdated")}}(this))},logout:function(){var e,t,n,r,i;r={domain:window.location.hostname.replace("ide",""),path:"/"},n={path:"/"},i=$.cookie();for(t in i)e=i[t],$.removeCookie(t,r),$.removeCookie(t,n)},changePassword:function(t,n){return e("account_update_account",{attributes:{password:t,new_password:n}})},changeEmail:function(t,n){var r;return r=this,e("account_update_account",{attributes:{password:n,email:t}}).then(function(){return r.set("email",t)})},changeName:function(t,n){var r,i;return i=this,r=new Q.defer,t===i.get("firstName")&&n===i.get("lastName")&&r.resolve(),e("account_update_account",{attributes:{first_name:t,last_name:n}}).then(function(e){return i.userInfoAccuired(e),r.resolve(e)},function(e){return r.reject(e)}),r.promise},gravatar:function(){var e;return e=CryptoJS.MD5(this.get("email").trim().toLowerCase()).toString(),{image:"https://www.gravatar.com/avatar/"+e,profile:"https://www.gravatar.com/"+e}}})}),define("Scene",["backbone"],function(){var e,t,n;return n=0,e=null,t=function(){function e(){return this.id="scene_"+ ++n,this.initialize.apply(this,arguments),App.sceneManager.add(this),this}return e.prototype.isActive=function(){return App.sceneManager.activeScene()===this},e.prototype.isRemoved=function(){return!!this.__isRemoved},e.prototype.remove=function(){if(this.__isRemoved)return;return App.sceneManager.remove(this,!0),null},e.prototype.activate=function(){return App.sceneManager.activate(this)},e.prototype.updateTitle=function(){var e;e=this.title();if(this.isActive()&&e){document.title=e;return}},e.prototype.updateUrl=function(){var e;e=this.url(),this.isActive()&&e&&Router.navigate(e,{replace:!0})},e.prototype.initialize=function(e){return this.activate()},e.prototype.isRemovable=function(){return!0},e.prototype.becomeActive=function(){return this.view&&this.view.$el.show(),this.updateUrl(),this.updateTitle()},e.prototype.becomeInactive=function(){$(document.activeElement).filter("input, textarea").blur();if(this.view)return this.view.$el.hide()},e.prototype.cleanup=function(){this.stopListening(),this.view?this.view.remove():void 0},e.prototype.isWorkingOn=function(e){return!1},e.prototype.url=function(){return""},e.prototype.title=function(){return""},e}(),_.extend(t.prototype,Backbone.Events),t.SetDefaultScene=function(t){e=t},t.DefaultScene=function(){return e},t}),define("ide/SceneManager",["Scene","backbone"],function(e){var t;return t=function(){function t(){this.__scenes=[],this.__scenesById={},this.__activeScene=null,this}return t.prototype.__frontActivateList=function(e){var t,n,r,i,s;t=[e],s=this.__scenes;for(r=0,i=s.length;r<i;r++)n=s[r],n!==e&&t.push(n);this.__scenes=t},t.prototype.__endActivateList=function(e){var t,n,r,i,s;t=[],s=this.__scenes;for(r=0,i=s.length;r<i;r++)n=s[r],n!==e&&t.push(n);t.push(e),this.__scenes=t},t.prototype.scenes=function(){return this.__scenes.slice(0)},t.prototype.get=function(e){return this.__scenesById[e]},t.prototype.add=function(e){return this.__scenesById[e.id]?e:(this.__scenesById[e.id]=e,this.__activeScene!==e&&this.__frontActivateList(e),this.__scenes.length===1&&this.activate(e),e)},t.prototype.activeScene=function(){return this.__activeScene},t.prototype.activate=function(e){return _.isString(e)&&(e=this.__scenesById[e]),e===this.__activeScene||!e||e.isRemoved()?e:(this.__activeScene&&this.__activeScene.becomeInactive(),this.__activeScene=e,this.__endActivateList(e),e.becomeActive(),e)},t.prototype.remove=function(t,n){_.isString(t)&&(t=this.__spacesById[t]);if(!t)return;if(!n&&!t.isRemovable())return;if(t.isRemoved())return;t.__isRemoved=!0,delete this.__scenesById[t.id],this.__scenes.splice(this.__scenes.indexOf(t),1),this.__activeScene===t&&(this.__activeScene=null,this.__scenes.length?this.__scenes[this.__scenes.length-1].activate():(void 0,(new(e.DefaultScene())).activate())),t.stopListening(),t.cleanup()},t.prototype.find=function(e){var t,n,r,i;i=this.__scenes;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.isWorkingOn(e))return t}return null},t.prototype.hasUnsaveScenes=function(){return this.__scenes.some(function(e){return!e.isRemovable()})},t}(),t}),define("ide/submodels/OpsModelAws",["OpsModel","ApiRequest","constant"],function(e,t,n){var r;return r=e.extend({type:e.Type.Amazon,getMsrId:function(){var t,r,i,s;r=e.prototype.getMsrId.call(this);if(r)return r;if(!this.__jsonData)return void 0;s=this.__jsonData.component;for(i in s){t=s[i];if(t.type===n.RESTYPE.VPC)return t.resource.VpcId}return void 0},__defaultJson:function(){var t,n,r,i,s,o,u,a;i=e.prototype.__defaultJson.call(this),u=MC.guid(),a="@{"+u+".resource.VpcId}",o={VPC:{coordinate:[5,3],size:[60,60]},RTB:{coordinate:[50,5],groupUId:u}},n={KP:{type:"AWS.EC2.KeyPair",name:"DefaultKP",resource:{KeyName:"DefaultKP",KeyFingerprint:""}},SG:{type:"AWS.EC2.SecurityGroup",name:"DefaultSG",resource:{IpPermissions:[{IpProtocol:"tcp",IpRanges:"0.0.0.0/0",FromPort:"22",ToPort:"22"}],IpPermissionsEgress:[{FromPort:"0",IpProtocol:"-1",IpRanges:"0.0.0.0/0",ToPort:"65535"}],Default:!0,GroupId:"",GroupName:"DefaultSG",GroupDescription:"default VPC security group",VpcId:a}},ACL:{type:"AWS.VPC.NetworkAcl",name:"DefaultACL",resource:{AssociationSet:[],Default:!0,NetworkAclId:"",VpcId:a,EntrySet:[{RuleAction:"allow",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!0,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:100},{RuleAction:"allow",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!1,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:100},{RuleAction:"deny",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!0,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:32767},{RuleAction:"deny",Protocol:-1,CidrBlock:"0.0.0.0/0",Egress:!1,IcmpTypeCode:{Type:"",Code:""},PortRange:{To:"",From:""},RuleNumber:32767}]}},VPC:{type:"AWS.VPC.VPC",name:"vpc",resource:{VpcId:"",CidrBlock:"10.0.0.0/16",DhcpOptionsId:"",EnableDnsHostnames:!1,EnableDnsSupport:!0,InstanceTenancy:"default"}},RTB:{type:"AWS.VPC.RouteTable",name:"RT-0",resource:{VpcId:a,RouteTableId:"",AssociationSet:[{Main:"true",SubnetId:"",RouteTableAssociationId:""}],PropagatingVgwSet:[],RouteSet:[{InstanceId:"",NetworkInterfaceId:"",Origin:"CreateRouteTable",GatewayId:"local",DestinationCidrBlock:"10.0.0.0/16"}]}}};for(r in n)t=n[r],r==="VPC"?t.uid=u:t.uid=MC.guid(),i.component[t.uid]=t,o[r]&&(s=o[r],s.uid=t.uid,i.layout[t.uid]=s);return i}},{supportedProviders:["aws::global","aws::china"]}),r}),define("ide/submodels/OpsModelOs",["OpsModel","ApiRequest","constant"],function(e,t,n){var r;return r=e.extend({type:e.Type.OpenStack,getMsrId:function(){var t,r,i,s;r=e.prototype.getMsrId.call(this);if(r)return r;if(!this.__jsonData)return void 0;s=this.__jsonData.component;for(i in s){t=s[i];if(t.type===n.RESTYPE.OSNETWORK)return t.resource.id}return void 0},__defaultJson:function(){var t,n,r,i,s,o,u,a;i=e.prototype.__defaultJson.call(this),o={NETWORK:{coordinate:[27,3],size:[60,60]},SUBNET:{coordinate:[30,6],size:[25,54]},RT:{coordinate:[10,3]}},n={KP:{type:"OS::Nova::KeyPair",name:"DefaultKP",resource:{}},NETWORK:{type:"OS::Neutron::Network",resource:{name:"network1"}},SG:{type:"OS::Neutron::SecurityGroup",resource:{name:"DefaultSG",description:"default security group",rules:[]}},RT:{type:"OS::Neutron::Router",resource:{external_gateway_info:{}}},SUBNET:{type:"OS::Neutron::Subnet",resource:{cidr:"10.0.0.0/16",enable_dhcp:!0}}};for(r in n)t=n[r],t.uid=MC.guid(),i.component[t.uid]=t,o[r]&&(s=o[r],s.uid=t.uid,i.layout[s.uid]=s),t.type==="OS::Neutron::Subnet"?a=t.uid:t.type==="OS::Neutron::Network"&&(u=t.uid);for(r in n)t=n[r],t.type==="OS::Neutron::Subnet"?t.resource.network_id="@{"+u+".resource.id}":t.type==="OS::Neutron::Router"&&(t.resource.router_interface=[{subnet_id:"@{"+a+".resource.id}"}]);return i}},{supportedProviders:["os::awcloud_bj"]}),r}),define("ide/Application",["./Websocket","./ApplicationView","./ApplicationModel","./User","./SceneManager","ApiRequest","i18n!/nls/lang.js","UI.notification","./submodels/OpsModelAws","./submodels/OpsModelOs"],function(e,t,n,r,i,s,o){var u;return u=function(){if(window.App){void 0;return}window.App=this},u.prototype.initialize=function(){var e,r;return this.__createUser(),this.__createWebsocket(),this.sceneManager=new i,this.model=new n,this.view=new t,r=this,e=this.user.fetch().then(function(){return r.model.fetch().fail(function(e){var t;return notification("error",o.NOTIFY.CANNOT_LOAD_APPLICATION_DATA,!1),t=Q.defer(),t.promise})}),e.then(function(){return App.view.hideGlobalLoading(),App.view.init()},function(e){e.error<0?e.error===s.Errors.Network500?window.location="/500":window.location.reload():App.logout()})},u.prototype.__createWebsocket=function(){this.WS=new e,this.WS.on("Disconnected",function(){return App.acquireSession()}),this.WS.on("StatusChanged",function(e){void 0;if(App.view)return App.view.toggleWSStatus(e)})},u.prototype.__createUser=function(){this.user=new r},u.prototype.acquireSession=function(){return this.view.showSessionDialog()},u.prototype.logout=function(){var e;App.user.logout(),this.ignoreChangesWhenQuit(),e=window.location.pathname,e==="/"&&(e=window.location.hash.replace("#","/")),e&&e!=="/"?window.location.href="/login?ref="+e:window.location.href="/login"},u.prototype.ignoreChangesWhenQuit=function(){this.__ICWQ=!0},u.prototype.canQuit=function(){return this.__ICWQ||!this.sceneManager.hasUnsaveScenes()},u.prototype.loadUrl=function(e){return window.Router.navigate(e,{replace:!0,trigger:!0})},u}),define("ide/AppBundle",function(){});