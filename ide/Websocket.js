(function(){define(["Meteor","backbone","event","MC"],function(e,t,n){var r,i,s;return r=""+MC.API_HOST+"/ws/",e._debug=function(){return console.log.apply(console,arguments)},s=null,i=function(){var t;return s?s:(s=this,this.connection=e.connect(r,!0),t={connection:this.connection},this.collection={request:new e.Collection("request",t),request_detail:new e.Collection("request_detail",t),stack:new e.Collection("stack",t),app:new e.Collection("app",t),status:new e.Collection("status",t),imports:new e.Collection("imports",t)},Deps.autorun(function(e){return function(){return e.trigger("StatusChanged",e.connection.status().connected)}}(this)),this.subscribe(),this.pipeChanges(),this)},i.prototype.subscribe=function(){var e,t,n,r;if(this.subscribed)return;n=!0,r=$.cookie("usercode"),t=$.cookie("session_id"),e={onReady:_.bind(this.onReady,this),onError:_.bind(this.onError,this)},this.connection.subscribe("request",r,t,e),this.connection.subscribe("stack",r,t),this.connection.subscribe("app",r,t),this.connection.subscribe("status",r,t),this.connection.subscribe("imports",r,t)},i.prototype.onReady=function(){n.trigger(n.WS_COLLECTION_READY_REQUEST)},i.prototype.onError=function(e){void 0,this.subscribed=!1,this.trigger("Disconnected")},i.prototype.pipeChanges=function(){return this.collection.request.find().fetch(),this.collection.request.find().observeChanges({added:function(e,t){return n.trigger(n.UPDATE_REQUEST_ITEM,e,t)},changed:function(e,t){return n.trigger(n.UPDATE_REQUEST_ITEM,e,t)}}),this.collection.imports.find().fetch(),this.collection.imports.find().observe({added:function(e,t){return n.trigger(n.UPDATE_IMPORT_ITEM,e)},changed:function(e,t){return n.trigger(n.UPDATE_IMPORT_ITEM,e)}})},_.extend(i.prototype,t.Events),i})}).call(this);