(function(){define("ide/cloudres/CrCollection",["ApiRequest","backbone"],function(e){var t;return t={},Backbone.Collection.extend({category:"",constructor:function(){return this.on("add remove",_.debounce(function(){return this.trigger("update")}),this),Backbone.Collection.apply(this,arguments)},isReady:function(){return this.__fetchPromise&&this.__ready},fetch:function(){var t;return this.__fetchPromise?this.__fetchPromise:(this.lastFetch=+(new Date),this.__ready=!1,t=this,this.__fetchPromise=this.doFetch().then(function(n){var r;if(!t.__selfParseData)try{n=t.parseFetchData(n)}catch(i){throw r=i,McError(e.Errors.InvalidAwsReturn,"",n)}return t.__ready=!0,n.length===0&&t.models.length===0?t.trigger("update"):t.set(n),t},function(e){throw t.lastFetch=0,t.__fetchPromise=null,e}),this.__fetchPromise)},fetchForce:function(){return this.__fetchPromise=null,this.reset(),this.trigger("update"),this.fetch()},fetchIfExpired:function(){var e;e=this.lastFetch||0;if(+(new Date)-e<18e5){void 0;return}return this.__fetchPromise=null,this.fetch()},parseFetchData:function(e){return e},destroy:function(){return this.trigger("destroy",this.id)},create:function(e){var t;return t=new this.model(e),t.__collection=this,t},region:function(){return this.category}},{category:function(e){return e},classId:function(e,t){return(t||"AWS")+"_"+e},getClassById:function(e){return t[e]},extend:function(e,n){var r;return void 0,r=(this.__detailExtend||Backbone.Collection.extend).call(this,e,n),t[this.classId(e.type,e.platform)]=r,r}})})}).call(this),function(){define("CloudResources",["ide/cloudres/CrCollection"],function(e){var t,n,r;return t={},r=function(e){return delete t[e]},n=function(n,i,s){var o,u,a,f;return s==null&&(s="AWS"),f=e.classId(n,s),o=e.getClassById(f),i=o.category(i),a=f+"_"+i,u=t[a],u||(u=new o,u.id=a,u.category=i,t[a]=u,u.on("destroy",r)),u},n.invalidate=function(){var e,n;for(n in t)e=t[n],e.fetchForce()},n})}.call(this),function(){define("ide/cloudres/CrModel",["./CrCollection","ApiRequest","backbone"],function(e,t){return Backbone.Model.extend({save:function(){var e;if(this.get("id")){void 0;return}return this.__savePromise||(e=this,this.__savePromise=this.doCreate().then(function(){return e.__collection.add(e),e.tagResource(),delete e.__collection,delete e.__savePromise,e},function(t){throw delete e.__savePromise,t})),this.__savePromise},update:function(e){if(!this.get("id")){void 0;return}if(!this.doUpdate){void 0;return}return this.doUpdate(e)},destroy:function(){var e;return e=this,this.doDestroy().then(function(){return e.getCollection().remove(e),e},function(t){if(t.awsError===400&&t.awsErrorCode.indexOf(".NotFound")!==-1)return e.getCollection().remove(e),e;throw t})},getCollection:function(){return this.__collection||this.collection},tagResource:function(){var e;if(this.taggable===!1)return;return e=this,t("ec2_CreateTags",{region_name:this.getCollection().region(),resource_ids:[this.get("id")],tags:[{Name:"Created by",Value:App.user.get("username")}]}).then(function(){void 0})}},{})})}.call(this),function(){define("ide/cloudres/CrModelDhcp",["./CrModel","ApiRequest"],function(e,t){return e.extend({defaults:function(){return{"domain-name":[],"domain-name-servers":[],"ntp-servers":[],"netbios-name-servers":[],"netbios-node-type":[]}},constructor:function(t,n){return t=this.tryParseDhcpAttr(t),e.call(this,t,n)},tryParseDhcpAttr:function(e){var t,n,r,i,s;if(e.dhcpConfigurationSet)try{s=e.dhcpConfigurationSet.item;for(r=0,i=s.length;r<i;r++)n=s[r],e[n.key]=n.valueSet;delete e.dhcpConfigurationSet}catch(o){t=o}return e},toAwsAttr:function(){var e,t,n,r;e=[],r=this.attributes;for(t in r)n=r[t],t!=="id"&&t!=="tagSet"&&n.length>0&&e.push({Name:t,Value:n});return e},doCreate:function(){var e;return e=this,t("dhcp_CreateDhcpOptions",{region_name:this.getCollection().region(),dhcp_configs:this.toAwsAttr()}).then(function(n){var r,i;try{i=n.CreateDhcpOptionsResponse.dhcpOptions.dhcpOptionsId}catch(s){throw r=s,McError(t.Errors.InvalidAwsReturn,"Dhcp created but aws returns invalid ata.")}return e.set("id",i),void 0,e})},doDestroy:function(){return t("dhcp_DeleteDhcpOptions",{region_name:this.getCollection().region(),dhcp_id:this.get("id")})}})})}.call(this),function(){define("ide/cloudres/CrModelKeypair",["./CrModel","ApiRequest"],function(e,t){return e.extend({defaults:{keyName:"",keyData:"",keyMaterial:"",keyFingerprint:""},doCreate:function(){var e,n;return n=this,this.get("keyData")?e=t("kp_ImportKeyPair",{region_name:this.getCollection().region(),key_name:this.get("keyName"),key_data:this.get("keyData")}):e=t("kp_CreateKeyPair",{region_name:this.getCollection().region(),key_name:this.get("keyName")}),e.then(function(e){var r;try{n.set(e.CreateKeyPairResponse)}catch(i){throw r=i,McError(t.Errors.InvalidAwsReturn,"Keypair created but aws returns invalid ata.")}return void 0,n})},doDestroy:function(){return t("kp_DeleteKeyPair",{region_name:this.getCollection().region(),key_name:this.get("id")})}})})}.call(this),function(){define("ide/cloudres/CrModelSslcert",["./CrModel","ApiRequest"],function(e,t){return e.extend({taggable:!1,defaults:{Path:"",Name:"",PrivateKey:"",CertificateChain:"",CertificateBody:""},doUpdate:function(e){var n;return n=this,t("iam_UpdateServerCertificate",{servercer_name:this.get("Name"),new_servercer_name:e.Name,new_path:e.Path}).then(function(t){var r,i;return i=n.get("Arn"),r=""+i.split("/")[0]+"/"+e.Name,n.set("Arn",r),n.set(e),n})},doCreate:function(){var e;return e=this,t("iam_UploadServerCertificate",{servercer_name:this.get("Name"),cert_body:this.get("CertificateBody"),private_key:this.get("PrivateKey"),cert_chain:this.get("CertificateChain"),path:this.get("Path")}).then(function(n){var r;e.attributes.CertificateChain="",e.attributes.PrivateKey="";try{n=n.UploadServerCertificateResponse.UploadServerCertificateResult.ServerCertificateMetadata,n.Arn=n.Arn,n.Expiration=n.Expiration,n.Path=n.Path,n.id=n.ServerCertificateId,n.Name=n.ServerCertificateName,n.UploadDate=n.UploadDate}catch(i){throw r=i,McError(t.Errors.InvalidAwsReturn,"Ssl cert created but aws returns invalid data.")}return e.set(n),void 0,e})},doDestroy:function(){return t("iam_DeleteServerCertificate",{servercer_name:this.get("Name")})}})})}.call(this),function(){define("ide/cloudres/CrModelTopic",["./CrModel","ApiRequest"],function(e,t){return e.extend({taggable:!1,defaults:{Name:"",DisplayName:""},doCreate:function(){var e;return e=this,t("sns_CreateTopic",{region_name:this.getCollection().region(),topic_name:this.get("Name")}).then(function(n){var r,i;try{i=n.CreateTopicResponse.CreateTopicResult.TopicArn}catch(s){throw r=s,McError(t.Errors.InvalidAwsReturn,"Topic created but aws returns invalid ata.")}return e.set("id",i),void 0,e.get("DisplayName")&&setTimeout(function(){return t("sns_SetTopicAttributes",{region_name:e.getCollection().region(),topic_arn:i,attr_name:"DisplayName",attr_value:e.get("DisplayName")})},1e3),e})},doUpdate:function(e){var n;return n=this,t("sns_SetTopicAttributes",{region_name:this.getCollection().region(),topic_arn:this.get("id"),attr_name:"DisplayName",attr_value:e}).then(function(){return n.set("DisplayName",e),n})},doDestroy:function(){return t("sns_DeleteTopic",{region_name:this.getCollection().region(),topic_arn:this.get("id")})}})})}.call(this),function(){define("ide/cloudres/CrModelSubscription",["./CrModel","ApiRequest"],function(e,t){var n;return n=e.extend({taggable:!1,defaults:{Endpoint:"",Protocol:"",TopicName:"",TopicArn:"",SubscriptionArn:""},initialize:function(e){e.TopicArn&&(this.attributes.TopicName=e.TopicArn.split(":").pop())},isRemovable:function(){return this.attributes.SubscriptionArn!=="PendingConfirmation"&&this.attributes.SubscriptionArn!=="Deleted"},set:function(e,t,n){e==="TopicArn"?this.attributes.TopicName=t.split(":").pop():e.TopicArn&&(this.attributes.TopicName=e.TopicArn.split(":").pop()),Backbone.Model.prototype.set.apply(this,arguments)},doCreate:function(){var e;return e=this,t("sns_Subscribe",{region_name:this.getCollection().region(),topic_arn:this.get("TopicArn"),protocol:this.get("Protocol"),endpoint:this.get("Endpoint")}).then(function(r){var i,s;try{i=r.SubscribeResponse.SubscribeResult.SubscriptionArn}catch(o){throw s=o,McError(t.Errors.InvalidAwsReturn,"Subscription created but aws returns invalid ata.")}return i==="pending confirmation"&&(i="PendingConfirmation"),e.set({id:n.uniqueId(),SubscriptionArn:i}),void 0,e})},doDestroy:function(){var e;return this.isRemovable()?t("sns_Unsubscribe",{region_name:this.getCollection().region(),sub_arn:this.get("SubscriptionArn")}):(e=Q.defer(),e.resolve(McError(t.Errors.InvalidMethodCall,"Cannot unsubscribe pending subscription.",self)),e.promise)}},{uniqueId:function(){return _.uniqueId("CrSnsSub_")}}),n})}.call(this),function(){define("ide/cloudres/CrModelSnapshot",["./CrModel","CloudResources","ApiRequest"],function(e,t,n){return e.extend({defaults:{volumeId:"",status:"pending",startTime:"",progress:0,ownerId:"",volumeSize:1,description:"",name:""},isComplete:function(){return this.attributes.status==="completed"},isPending:function(){return this.attributes.status==="pending"},doCreate:function(){var e;return e=this,n("ebs_CreateSnapshot",{region_name:this.getCollection().region(),volume_id:this.get("volumeId"),description:this.get("description")}).then(function(t){var r;try{t=t.CreateSnapshotResponse,t.id=t.snapshotId,t.progress=t.progress||0,delete t.snapshotId,delete t["@attributes"]}catch(i){throw r=i,McError(n.Errors.InvalidAwsReturn,"Snapshot created but aws returns invalid ata.")}return e.set(t),e.getCollection().startPollingStatus(),void 0,e})},set:function(e,t){e.progress&&(e.progress=parseInt(e.progress,10)||0),e.volumeSize&&(e.volumeSize=parseInt(e.volumeSize,10)||1),Backbone.Model.prototype.set.apply(this,arguments)},copyTo:function(e,r,i){var s;return s=this,n("ebs_CopySnapshot",{region_name:this.getCollection().region(),snapshot_id:this.get("id"),dst_region_name:e,description:i}).then(function(o){var u,a,f,l,c;a=(c=o.CopySnapshotResponse)!=null?c.snapshotId:void 0;if(!a)throw McError(n.Errors.InvalidAwsReturn,"Snapshot copied but aws returns invalid data.");return l=t(s.collection.type,e),u=s.toJSON(),u.name=r,u.description=i,u.region=e,u.id=a,f=l.create(u),l.add(f),f.tagResource(),f})},doDestroy:function(){return n("ebs_DeleteSnapshot",{region_name:this.getCollection().region(),snapshot_id:this.get("id")})},tagResource:function(){var e;return e=this,n("ec2_CreateTags",{region_name:this.getCollection().region(),resource_ids:[this.get("id")],tags:[{Name:"Created by",Value:App.user.get("username")},{Name:"Name",Value:this.get("name")}]}).then(function(){void 0})}})})}.call(this),function(){define("ide/cloudres/CrClnSharedRes",["./CrCollection","CloudResources","ApiRequest","constant","./CrModelDhcp","./CrModelKeypair","./CrModelSslcert","./CrModelTopic","./CrModelSubscription","./CrModelSnapshot"],function(e,t,n,r,i,s,o,u,a,f){return e.extend({type:r.RESTYPE.DHCP,model:i,doFetch:function(){return n("dhcp_DescribeDhcpOptions",{region_name:this.region()})},parseFetchData:function(e){var t,n,r;e=e.DescribeDhcpOptionsResponse.dhcpOptionsSet;if(e===null)return[];e=e.item;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.dhcpOptionsId,delete t.dhcpOptionsId;return e}}),e.extend({type:r.RESTYPE.KP,model:s,doFetch:function(){return n("kp_DescribeKeyPairs",{region_name:this.region()})},parseFetchData:function(e){var t,n,r;e=e.DescribeKeyPairsResponse.keySet;if(e===null)return[];e=e.item;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.keyName;return e}}),e.extend({type:r.RESTYPE.IAM,model:o,doFetch:function(){return n("iam_ListServerCertificates")},parseFetchData:function(e){var t,n,r;e=e.ListServerCertificatesResponse.ListServerCertificatesResult.ServerCertificateMetadataList;if(e===null)return[];e=e.member;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.ServerCertificateId,t.Name=t.ServerCertificateName,delete t.ServerCertificateName,delete t.ServerCertificateId;return e}},{category:function(){return""}}),e.extend({type:r.RESTYPE.TOPIC,model:u,constructor:function(){return this.on("remove",this.__clearSubscription),e.apply(this,arguments)},doFetch:function(){return n("sns_ListTopics",{region_name:this.region()})},parseFetchData:function(e){var t,n,r;e=e.ListTopicsResponse.ListTopicsResult.Topics;if(e===null)return[];e=e.member;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.TopicArn,t.Name=t.TopicArn.split(":").pop(),delete t.TopicArn;return e},__clearSubscription:function(e,n,i){var s,o,u,a,f,l;o=t(r.RESTYPE.SUBSCRIPTION,this.region()),s=[],l=o.models;for(a=0,f=l.length;a<f;a++)u=l[a],u.get("TopicArn")===e.id&&s.push(u);s.length&&o.remove(s)},filterEmptySubs:function(){var e,n,i,s,o,u;n=t(r.RESTYPE.SUBSCRIPTION,this.category),i={},u=n.models;for(s=0,o=u.length;s<o;s++)e=u[s],i[e.get("TopicArn")]=!0;return this.filter(function(e){return!i[e.get("id")]})}}),e.extend({type:r.RESTYPE.SUBSCRIPTION,model:a,doFetch:function(){return n("sns_ListSubscriptions",{region_name:this.region()})},parseFetchData:function(e){var t,n,r;e=e.ListSubscriptionsResponse.ListSubscriptionsResult.Subscriptions;if(e===null)return[];e=e.member;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=a.uniqueId();return e}}),e.extend({type:r.RESTYPE.SNAP,model:f,initialize:function(){this.__pollingStatus=_.bind(this.__pollingStatus,this)},doFetch:function(){return n("ebs_DescribeSnapshots",{region_name:this.region(),owners:["self"]})},parseFetchData:function(e){var t,n,r;e=e.DescribeSnapshotsResponse.snapshotSet;if(e===null)return[];e=e.item;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.snapshotId,t.tagSet&&(t.name=t.tagSet.Name||t.tagSet.name||"",delete t.tagSet),delete t.snapshotId,t.status==="pending"&&this.startPollingStatus();return e},startPollingStatus:function(){if(this.__polling)return;this.__polling=setTimeout(this.__pollingStatus,2e3)},stopPollingStatus:function(){clearTimeout(this.__polling),this.__polling=null},__pollingStatus:function(){var e;return e=this,n("ebs_DescribeSnapshots",{region_name:this.region(),owners:["self"],filters:[{Name:"status",Value:["pending"]}]}).then(function(t){e.__polling=null,e.__parsePolling(t)},function(){return e.__polling=null,e.startPollingStatus()})},__parsePolling:function(e){var t,n,r,i,s,o;e=e.DescribeSnapshotsResponse.snapshotSet,t={progress:100,status:"completed"},r={};if(e!==null&&e.item){this.startPollingStatus(),o=e.item;for(i=0,s=o.length;i<s;i++)n=o[i],r[n.snapshotId]={progress:n.progress}}this.where({status:"pending"}).forEach(function(e){return e.set(r[e.get("id")]||t)})}})})}.call(this),function(){define("ide/cloudres/CrCommonCollection",["ApiRequest","./CrCollection","./CrModel"],function(e,t,n){var r,i;return i=[],r=t.extend({model:n,type:"CrCommonCollection",__selfParseData:!0,doFetch:function(){var t,n;return t={},t[this.type]={},n=this,e("aws_resource",{region_name:null,resources:t,addition:"all",retry_times:1}).then(function(e){var t,r,s,o,u,a,f,l;u=[];for(o in e){r=e[o];try{l=n.parseFetchData($.xml2json($.parseXML(r[0])))||i;for(a=0,f=l.length;a<f;a++)t=l[a],n.modelIdAttribute&&(t.id=t[n.modelIdAttribute],delete t[n.modelIdAttribute]),t.category=o,u.push(new n.model(t))}catch(c){s=c;continue}}return u})}},{category:function(){return""}}),r})}.call(this),function(){define("ide/cloudres/CrClnCommonRes",["./CrCommonCollection","ApiRequest","constant"],function(e,t,n){return e.extend({type:n.RESTYPE.ELB,modelIdAttribute:"LoadBalancerName",parseFetchData:function(e){var t;return(t=e.DescribeLoadBalancersResponse.DescribeLoadBalancersResult.LoadBalancerDescriptions)!=null?t.member:void 0}}),e.extend({type:n.RESTYPE.VPN,modelIdAttribute:"vpnConnectionId",parseFetchData:function(e){var t;return(t=e.DescribeVpnConnectionsResponse.vpnConnectionSet)!=null?t.item:void 0}}),e.extend({type:n.RESTYPE.EIP,modelIdAttribute:"allocationId",parseFetchData:function(e){var t;return(t=e.DescribeAddressesResponse.addressesSet)!=null?t.item:void 0}}),e.extend({type:n.RESTYPE.VOL,modelIdAttribute:"volumeId",parseFetchData:function(e){var t;return(t=e.DescribeVolumesResponse.volumeSet)!=null?t.item:void 0}}),e.extend({type:n.RESTYPE.VPC,modelIdAttribute:"vpcId",parseFetchData:function(e){var t;return(t=e.DescribeVpcsResponse.vpcSet)!=null?t.item:void 0}}),e.extend({type:n.RESTYPE.INSTANCE,modelIdAttribute:"instanceId",parseFetchData:function(e){var t,n,r,i,s,o,u,a,f,l,c;s=e.DescribeInstancesResponse.reservationSet;if(!s)return;i=[],l=s.item;for(o=0,a=l.length;o<a;o++){r=l[o];try{c=r.instancesSet.item;for(u=0,f=c.length;u<f;u++)t=c[u],i.push(t)}catch(h){n=h,void 0}}return i}})})}.call(this),function(){define("ide/cloudres/CrBundle",["constant","CloudResources","./CrClnSharedRes","./CrClnCommonRes"],function(e,t){})}.call(this);