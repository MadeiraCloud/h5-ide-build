(function(){define(["event","./diff","./view","./JsonDiffLib","UI.modalplus","./jqUi"],function(e,t,n,r,i){var s,o,u,a,f;return o=null,u=".",e.on(e.OPEN_PROPERTY,function(e,t){return $("#jsonViewer").length&&(u=t||".",s()),null}),a=function(){return $("#diffChangesOnly").is(":checked")?($("#jsondiffContainer").toggleClass("changesOnly",!0),$("#jsondiffContainer").find(".changed, .added, .removed").each(function(e,t){var n;n=$(t).parent();while(n.attr("id")!=="jsondiffContainer")n.toggleClass("hasChanges",!0).removeClass("closed"),n=n.parent();return null})):$("#jsondiffContainer").removeClass("changesOnly"),null},s=function(){var e,t,n,r,i,s,a,f,l,c,h;t=$.trim($("#diffSearch").val()),n=$("#diffTypeSelect").val()||".",i=0,s=null,h=$("#jsonCompContainer").children().children("li").children().children("span");for(l=0,c=h.length;l<c;l++)f=h[l],f=$(f),a=f.children(":first-child").text().replace(": ",""),e=o[a],!t||e.uid.indexOf(t)!==-1||e.type.indexOf(t)!==-1||e.name.indexOf(t)!==-1?r=!0:r=!1,n==="selected"?e.uid!==u&&u!=="."&&(r=!1):e.type.indexOf(n)===-1&&(r=!1),r&&(++i,s=f.parent()),r?f.parent().parent().css({display:""}):f.parent().parent().css({display:"none"});return u==="."&&n==="selected"?$("#jsonCompContainer").children().children("li").children().addClass("closed"):i===1&&s.removeClass("closed"),null},f=function(e){var t,n,i,a,f,l,c,h,p,d,v,m,g;i=e.component,a=e.layout,delete e.component,delete e.layout,o=i,t=$.extend(!0,{},e),r.compare(t,t,"attribute",$("#jsonAttrContainer").empty()[0]),r.compare(i,i,"component",$("#jsonCompContainer").empty()[0]),r.compare(a,a,"layout",$("#jsonLayoutContainer").empty()[0]),$("#jsonCompContainer, #jsonAttrContainer, #jsonLayoutContainer").children().removeClass("closed"),h={},c=[];for(p in i)n=i[p],h[n.type]||(h[n.type]=!0,c.push(n.type));f="<option value='.'>All</option><option value='selected' selected='selected'>Selected Component</option><option value='.'>----------</option>",u=((m=debug.selectedComp())!=null?m.id:void 0)||".",g=c.sort();for(d=0,v=g.length;d<v;d++)l=g[d],f+="<option value='"+l+"'>"+l+"</option>";return $("#diffTypeSelect").html(f),s(),null},{showDiffDialog:function(e,n){var s;return s=new i({title:"JSON Diff",compact:!0,template:t()}),s.tpl.css({width:"98%",height:"98%",top:"1%",left:"1%"}),s.setWidth("100%"),$("#diffTextarea1").val(JSON.stringify(e)),$("#diffTextarea2").val(JSON.stringify(n)),r.compare(e,n,"CanvasData",$("#jsondiffContainer")[0]),s.tpl.on("click","ul",function(e){return e.target.tagName&&e.target.tagName.toUpperCase()==="UL"&&$(e.target).toggleClass("closed"),!1}),$("#diffTextarea1, #diffTextarea2").on("focus",function(){return setTimeout(function(e){return function(){return $(e).select()}}(this),10),null}),$("#diffSwap").on("click",function(){var e;return e=$("#diffTextarea1").val(),$("#diffTextarea1").val($("#diffTextarea2").val()),$("#diffTextarea2").val(e),null}),$("#diffClear").on("click",function(){return $("#diffTextarea1").val(""),$("#diffTextarea2").val(""),null}),$("#diffCompare").on("click",function(){var e,t,n;try{t=JSON.parse($("#diffTextarea1").css({background:""}).val())}catch(i){e=i,$("#diffTextarea1").css({background:"res"})}try{n=JSON.parse($("#diffTextarea2").css({background:""}).val())}catch(i){e=i,$("#diffTextarea2").css({background:"res"})}return t&&n&&r.compare(t,n,"CanvasData",$("#jsondiffContainer").empty()[0]),a(),null}),a(),$("#diffChangesOnly").on("change",function(e){return a(),null}),null},showViewDialog:function(e){var t,r;return $("#jsonViewer").length?($("#diffWrap").hide(),$("#jsonViewer .modal-header").dblclick(),null):(t=new i({title:"Data View",template:n(),width:"100%",disableFooter:!0,compact:!0}),t.tpl.attr("id","jsonViewer").css({width:"98%",height:"98%",top:"1%",left:"1%"}),f(e),$("#jsonViewer").on("click","ul",function(e){return e.target.tagName&&e.target.tagName.toUpperCase()==="UL"&&$(e.target).toggleClass("closed"),!1}),$("#jsonViewer").on("dblclick",".modal-header",function(){var e;return e=t.$(".modal-body"),e.is(":hidden")?($("#jsonViewer").css({height:$("#jsonViewer").attr("data-height")||"98%",width:$("#jsonViewer").attr("data-width")||"98%","min-width":"540px"}),e.show()):($("#jsonViewer").attr({"data-height":$("#jsonViewer").height(),"data-width":$("#jsonViewer").width()}).css({height:"auto",width:"150px","min-width":"150px"}),e.hide()),null}),$("#diffRefresh").on("click",function(){return f(d().serialize())}),r=null,$("#diffSearch").on("keydown",function(){return r&&clearTimeout(r),r=setTimeout(function(){return s()},200),null}),$("#diffTypeSelect").on("change",s),null)}}})}).call(this);