define("component/stateeditor/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){function l(e,t){var i="",s;i+='\n	<li class="state-item view ',s=n.ifCond.call(e,e&&e.cmd_value,"#",{hash:{},inverse:u.noop,fn:u.program(2,c,t),data:t});if(s||s===0)i+=s;i+='" data-command="'+f((s=e&&e.cmd_value,typeof s===a?s.apply(e):s))+'" data-id="'+f((s=e&&e.id,typeof s===a?s.apply(e):s))+'">\n		<div class="state-toolbar">\n			<div class="state-action-wrap">\n				<div class="state-remove icon-del tooltip" data-tooltip="'+f(n.i18n.call(e,"STATE_TIP_DELETE_STATE",{hash:{},data:t}))+'"></div>\n				<div class="state-check tooltip" data-tooltip="'+f(n.i18n.call(e,"STATE_TIP_SELECT_STATE",{hash:{},data:t}))+'">\n					<div class="checkbox">\n						<input id="state-check-'+f((s=e&&e.id,typeof s===a?s.apply(e):s))+'" type="checkbox" name="state-check-'+f((s=e&&e.id,typeof s===a?s.apply(e):s))+'">\n						<label for="state-check-'+f((s=e&&e.id,typeof s===a?s.apply(e):s))+'"></label>\n					</div>\n				</div>\n			</div>\n			<i class="state-status-icon status status-yellow"></i>\n			<i class="state-drag"></i>\n			<div class="state-view">\n				<div class="command-view-value"></div>\n				<div class="parameter-view-list">\n					',s=u.invokePartial(r.paraViewListTpl,"paraViewListTpl",e,n,r,t);if(s||s===0)i+=s;i+='\n				</div>\n			</div>\n		</div>\n		<div class="state-edit clearfix">\n			<div class="command-value editable-area line">'+f((s=e&&e.cmd_value,typeof s===a?s.apply(e):s))+'</div>\n			<div class="parameter-list">\n				',s=u.invokePartial(r.paraListTpl,"paraListTpl",e,n,r,t);if(s||s===0)i+=s;return i+="\n			</div>\n		</div>\n	</li>\n",i}function c(e,t){return"comment"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;o=n.each.call(t,t&&t.state_list,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n\n",s},n.stateListTpl=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;r+="\n\n	",i=n["if"].call(e,e&&e.type_line,{hash:{},inverse:u.noop,fn:u.program(2,c,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_dict,{hash:{},inverse:u.noop,fn:u.program(9,v,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_array,{hash:{},inverse:u.noop,fn:u.program(11,m,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_bool,{hash:{},inverse:u.noop,fn:u.program(13,g,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_text,{hash:{},inverse:u.noop,fn:u.program(15,y,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_state,{hash:{},inverse:u.noop,fn:u.program(17,b,t),data:t});if(i||i===0)r+=i;return r+="\n\n",r}function c(e,t){var r="",i;r+='\n		<div class="parameter-item line ',i=n["if"].call(e,e&&e.required,{hash:{},inverse:u.program(5,p,t),fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;r+=" ",i=n["if"].call(e,e&&e.para_disabled,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">\n				'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'\n			</div>\n			<div class="parameter-container">\n				<div class="parameter-value editable-area line">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n			</div>\n		</div>\n	",r}function h(e,t){return"required"}function p(e,t){return"optional"}function d(e,t){return"disabled"}function v(e,t){var i="",s;i+='\n		<div class="parameter-item dict ',s=n["if"].call(e,e&&e.required,{hash:{},inverse:u.program(5,p,t),fn:u.program(3,h,t),data:t});if(s||s===0)i+=s;i+=" ",s=n["if"].call(e,e&&e.para_disabled,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='" data-para-name="'+f((s=e&&e.para_name,typeof s===a?s.apply(e):s))+'">\n			<div class="parameter-name">\n				'+f((s=e&&e.para_name,typeof s===a?s.apply(e):s))+'\n			</div>\n			<div class="parameter-container">\n				',s=u.invokePartial(r.paraDictListTpl,"paraDictListTpl",e,n,r,t);if(s||s===0)i+=s;return i+="\n			</div>\n		</div>\n	",i}function m(e,t){var i="",s;i+='\n		<div class="parameter-item array ',s=n["if"].call(e,e&&e.required,{hash:{},inverse:u.program(5,p,t),fn:u.program(3,h,t),data:t});if(s||s===0)i+=s;i+=" ",s=n["if"].call(e,e&&e.para_disabled,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='" data-para-name="'+f((s=e&&e.para_name,typeof s===a?s.apply(e):s))+'">\n			<div class="parameter-name">\n				'+f((s=e&&e.para_name,typeof s===a?s.apply(e):s))+'\n			</div>\n			<div class="parameter-container">\n				',s=u.invokePartial(r.paraArrayListTpl,"paraArrayListTpl",e,n,r,t);if(s||s===0)i+=s;return i+="\n			</div>\n		</div>\n	",i}function g(e,t){var r="",i;r+='\n		<div class="parameter-item bool ',i=n["if"].call(e,e&&e.required,{hash:{},inverse:u.program(5,p,t),fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;r+=" ",i=n["if"].call(e,e&&e.para_disabled,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">\n				'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'\n			</div>\n			<div class="parameter-container">\n				<div class="parameter-value editable-area line">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n			</div>\n		</div>\n	",r}function y(e,t){var r="",i;r+='\n		<div class="parameter-item text ',i=n["if"].call(e,e&&e.required,{hash:{},inverse:u.program(5,p,t),fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;r+=" ",i=n["if"].call(e,e&&e.para_disabled,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">\n				'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'\n			</div>\n			<div class="parameter-container">\n				<div class="parameter-text-expand icon-expand">Expand</div>\n				<div class="parameter-value editable-area text">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n			</div>\n		</div>\n	",r}function b(e,t){var i="",s;i+='\n		<div class="parameter-item state ',s=n["if"].call(e,e&&e.required,{hash:{},inverse:u.program(5,p,t),fn:u.program(3,h,t),data:t});if(s||s===0)i+=s;i+=" ",s=n["if"].call(e,e&&e.para_disabled,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(s||s===0)i+=s;i+='" data-para-name="'+f((s=e&&e.para_name,typeof s===a?s.apply(e):s))+'">\n			<div class="parameter-name">\n				'+f((s=e&&e.para_name,typeof s===a?s.apply(e):s))+'\n			</div>\n			<div class="parameter-container">\n				',s=u.invokePartial(r.paraArrayListTpl,"paraArrayListTpl",e,n,r,t);if(s||s===0)i+=s;return i+="\n			</div>\n		</div>\n	",i}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;o=n.each.call(t,t&&t.parameter_list,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n\n",s},n.paraListTpl=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;r+="\n\n	",i=n["if"].call(e,e&&e.type_line,{hash:{},inverse:u.noop,fn:u.program(2,c,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_dict,{hash:{},inverse:u.noop,fn:u.program(5,p,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_array,{hash:{},inverse:u.noop,fn:u.program(7,d,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_bool,{hash:{},inverse:u.noop,fn:u.program(9,v,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_text,{hash:{},inverse:u.noop,fn:u.program(11,m,t),data:t});if(i||i===0)r+=i;r+="\n\n	",i=n["if"].call(e,e&&e.type_state,{hash:{},inverse:u.noop,fn:u.program(13,g,t),data:t});if(i||i===0)r+=i;return r+="\n\n",r}function c(e,t){var r="",i;r+='\n		<div class="parameter-item line ',i=n["if"].call(e,e&&e.para_no_visible,{hash:{},inverse:u.noop,fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'</div>\n			<div class="parameter-value">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n		</div>\n	",r}function h(e,t){return"no-visible"}function p(e,t){var r="",i;r+='\n		<div class="parameter-item dict ',i=n["if"].call(e,e&&e.para_no_visible,{hash:{},inverse:u.noop,fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'</div>\n			<div class="parameter-value">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n		</div>\n	",r}function d(e,t){var r="",i;r+='\n		<div class="parameter-item array ',i=n["if"].call(e,e&&e.para_no_visible,{hash:{},inverse:u.noop,fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'</div>\n			<div class="parameter-value">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n		</div>\n	",r}function v(e,t){var r="",i;r+='\n		<div class="parameter-item bool ',i=n["if"].call(e,e&&e.para_no_visible,{hash:{},inverse:u.noop,fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'</div>\n			<div class="parameter-value">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n		</div>\n	",r}function m(e,t){var r="",i;r+='\n		<div class="parameter-item text ',i=n["if"].call(e,e&&e.para_no_visible,{hash:{},inverse:u.noop,fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'</div>\n			<div class="parameter-value">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n		</div>\n	",r}function g(e,t){var r="",i;r+='\n		<div class="parameter-item state ',i=n["if"].call(e,e&&e.para_no_visible,{hash:{},inverse:u.noop,fn:u.program(3,h,t),data:t});if(i||i===0)r+=i;return r+='" data-para-name="'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'">\n			<div class="parameter-name">'+f((i=e&&e.para_name,typeof i===a?i.apply(e):i))+'</div>\n			<div class="parameter-value">'+f((i=e&&e.para_value,typeof i===a?i.apply(e):i))+"</div>\n		</div>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;o=n.each.call(t,t&&t.parameter_view_list,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n\n",s},n.paraViewListTpl=e.template(t),t=function(e,t,n,r,i){function l(e,t){var n="",r;return n+='\n	<div class="parameter-dict-item">\n		<div class="parameter-value editable-area line key">'+a((r=e&&e.key,typeof r===u?r.apply(e):r))+'</div>\n		<div class="parameter-value editable-area line value">'+a((r=e&&e.value,typeof r===u?r.apply(e):r))+"</div>\n	</div>\n",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;o=n.each.call(t,t&&t.para_value,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n\n",s},n.paraDictListTpl=e.template(t),t=function(e,t,n,r,i){function l(e,t){var n="";return n+='<div class="parameter-value editable-area line">'+a(typeof e===u?e.apply(e):e)+"</div>",n}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;o=n.each.call(t,t&&t.para_value,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n\n",s},n.paraArrayListTpl=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="state-empty">'+a((o=t&&t.tip,typeof o===u?o.apply(t):o))+"</div>\n\n",s},n.stateEmptyTpl=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="";return r+='<div class="state-warning font-normal">'+u(n.i18n.call(e,"STATE_UNKNOWN_DISTRO_LBL",{hash:{},data:t}))+"</div>",r}function c(e,t){var r="";return r+='\n						<div class="state-item-add-btn btn btn-blue">'+u(n.i18n.call(e,"STATE_NO_STATE_ADD_BTN",{hash:{},data:t}))+"</div>\n					",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=this.merge(r,e.partials),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<div id="state-editor-model" class="se-model-'+u((o=t&&t.current_state,typeof o===a?o.apply(t):o))+'">\n	<div class="selectbox state-editor-res-select" data-res-name="'+u((o=t&&t.res_name,typeof o===a?o.apply(t):o))+'">\n		',o=f.invokePartial(r.stateResSelectTpl,"stateResSelectTpl",t,n,r,i);if(o||o===0)s+=o;s+='\n	</div>\n\n	<div id="state-editor-wrap">\n		<div id="state-editor-body">\n			<div id="state-editor" spellcheck="false" class="font-mono">\n				',o=n.unless.call(t,t&&t.supported_platform,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\n\n				<div class="state-no-state-container font-normal">\n					<div class="state-no-data-tip">'+u(n.i18n.call(t,"STATE_NO_STATE_LBL",{hash:{},data:i}))+"</div>\n					",o=n["if"].call(t,t&&t.allow_add_state,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;s+='\n				</div>\n\n				<div class="state-have-state-container">\n					<div class="state-editor-toolbar clearfix font-normal">\n						<a class="tooltip state-desc-toggle icon-desc" data-tooltip="'+u(n.i18n.call(t,"STATE_TIP_DESCRIPTION",{hash:{},data:i}))+'"></a>\n						<a class="tooltip state-log-toggle icon-log" data-tooltip="'+u(n.i18n.call(t,"STATE_TIP_STATE_LOG",{hash:{},data:i}))+'"></a>\n						<a class="tooltip state-log-refresh icon-refresh" data-tooltip="'+u(n.i18n.call(t,"STATE_TIP_REFRESH_STATE_LOG",{hash:{},data:i}))+'"></a>\n						<a class="tooltip state-sys-log-btn icon-syslog" data-tooltip="'+u(n.i18n.call(t,"STATE_TIP_SYSTEM_LOG",{hash:{},data:i}))+'"></a>\n\n						<div class="state-operate">\n							<a id="state-toolbar-add" href="javascript:void(0)"><i class="icon-add icon-label"></i>'+u(n.i18n.call(t,"STATE_TOOL_ADD_STATE",{hash:{},data:i}))+'</a>\n							<a id="state-toolbar-copy-all" href="javascript:void(0)">'+u(n.i18n.call(t,"STATE_TOOL_COPY_ALL",{hash:{},data:i}))+'</a>\n							<a id="state-toolbar-copy" href="javascript:void(0)">'+u(n.i18n.call(t,"STATE_TOOL_COPY_SELECTED",{hash:{},data:i}))+'(<span id="state-toolbar-copy-count"></span>)</a>\n							<a id="state-toolbar-delete" href="javascript:void(0)">'+u(n.i18n.call(t,"STATE_TOOL_DELETE",{hash:{},data:i}))+'(<span id="state-toolbar-delete-count"></span>)</a>\n							<a id="state-toolbar-paste" class="disabled" href="javascript:void(0)">'+u(n.i18n.call(t,"STATE_TOOL_PASTE",{hash:{},data:i}))+'</a>\n							<a id="state-toolbar-undo" href="javascript:void(0)">'+u(n.i18n.call(t,"STATE_TOOL_UNDO",{hash:{},data:i}))+'</a>\n							<a id="state-toolbar-redo" href="javascript:void(0)">'+u(n.i18n.call(t,"STATE_TOOL_REDO",{hash:{},data:i}))+'</a>\n\n							<div id="state-toolbar-selectAll" class="checkbox tooltip" data-tooltip="'+u(n.i18n.call(t,"STATE_TIP_SELECT_ALL_STATES",{hash:{},data:i}))+'">\n								<input type="checkbox" name="state-toolbar-selectAll">\n								<label for="state-toolbar-selectAll"></label>\n							</div>\n						</div>\n					</div>\n\n					<ol class="state-list"></ol>\n\n				</div>\n			</div>\n		</div>\n	</div>\n\n	<div id="state-description" data-command="" class="state-sidebar"></div>\n	<div id="state-log" data-state-id="" class="state-sidebar">\n		<div class="state-log-header">'+u(n.i18n.call(t,"STATE_LOG_TIT",{hash:{},data:i}))+'<span class="state-log-loading">'+u(n.i18n.call(t,"STATE_LOG_LOADING_LBL",{hash:{},data:i}))+'</span></div>\n		<ul class="state-log-list">\n			',o=f.invokePartial(r.stateLogInstanceItemTpl,"stateLogInstanceItemTpl",t,n,r,i);if(o||o===0)s+=o;s+="\n			",o=f.invokePartial(r.stateLogItemTpl,"stateLogItemTpl",t,n,r,i);if(o||o===0)s+=o;return s+="\n		</ul>\n	</div>\n</div>\n\n",s},n.editorModalTpl=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n		<li class="item ',i=n.unless.call(e,t==null||t===!1?t:t.index,{hash:{},inverse:u.noop,fn:u.program(2,c,t),data:t});if(i||i===0)r+=i;return r+='" data-id="'+f((i=e&&e.res_id,typeof i===a?i.apply(e):i))+'">'+f((i=e&&e.res_name,typeof i===a?i.apply(e):i))+"</li>\n	",r}function c(e,t){return"selected"}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;s+='<div class="selection">'+f((o=(o=(o=t&&t.res_selects,o==null||o===!1?o:o[0]),o==null||o===!1?o:o.res_name),typeof o===a?o.apply(t):o))+'</div>\n<ul class="dropdown" tabindex="-1">\n	',o=n.each.call(t,t&&t.res_selects,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</ul>\n\n",s},n.stateResSelectTpl=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;r+='\n	<li class="state-log-item '+a((i=e&&e.state_status,typeof i===u?i.apply(e):i))+" ",i=n["if"].call(e,e&&e.view,{hash:{},inverse:f.noop,fn:f.program(2,c,t),data:t});if(i||i===0)r+=i;r+=" ",i=n["if"].call(e,e&&e.is_state_log,{hash:{},inverse:f.noop,fn:f.program(4,h,t),data:t});if(i||i===0)r+=i;r+='" data-state-id="'+a((i=e&&e.id,typeof i===u?i.apply(e):i))+'">\n		<div class="state-log-item-header">\n			<div class="state-log-item-name">',i=n["if"].call(e,e&&e.state_num,{hash:{},inverse:f.noop,fn:f.program(6,p,t),data:t});if(i||i===0)r+=i;r+="</div>\n			",i=n["if"].call(e,e&&e.log_time,{hash:{},inverse:f.noop,fn:f.program(8,d,t),data:t});if(i||i===0)r+=i;r+='\n			<div class="state-log-item-status">'+a((i=e&&e.state_status,typeof i===u?i.apply(e):i))+'</div>\n		</div>\n		<div class="state-log-item-content">\n			',i=n["if"].call(e,e&&e.comment,{hash:{},inverse:f.noop,fn:f.program(10,v,t),data:t});if(i||i===0)r+=i;r+="\n			",i=n["if"].call(e,e&&e.stdout,{hash:{},inverse:f.noop,fn:f.program(12,m,t),data:t});if(i||i===0)r+=i;return r+="\n		</div>\n	</li>\n",r}function c(e,t){return"view"}function h(e,t){return"state-log"}function p(e,t){var n;return a((n=e&&e.state_num,typeof n===u?n.apply(e):n))}function d(e,t){var n="",r;return n+='<div class="state-log-item-time">'+a((r=e&&e.log_time,typeof r===u?r.apply(e):r))+"</div>",n}function v(e,t){var r="";return r+='<div class="state-log-item-detail comment">'+a(n.breaklines.call(e,e&&e.comment,{hash:{},data:t}))+"</div>",r}function m(e,t){var r="",i;r+="\n				",i=n["if"].call(e,e&&e.long_stdout,{hash:{},inverse:f.program(15,y,t),fn:f.program(13,g,t),data:t});if(i||i===0)r+=i;return r+="\n			",r}function g(e,t){var r="";return r+='\n					<a class="state-log-item-view-detail">'+a(n.i18n.call(e,"STATE_LOG_VIEW_DETAIL",{hash:{},data:t}))+"</a>\n				",r}function y(e,t){var r="";return r+='\n					<div class="state-log-item-detail stdout">'+a(n.breaklines.call(e,e&&e.stdout,{hash:{},data:t}))+"</div>\n				",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;o=n.each.call(t,t&&t.state_logs,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n\n",s},n.stateLogItemTpl=e.template(t),t=function(e,t,n,r,i){function l(e,t){var n;return a((n=e&&e.res_status,typeof n===u?n.apply(e):n))}function c(e,t){return a(n.i18n.call(e,"STATE_LOG_ITEM_UNKNOWN",{hash:{},data:t}))}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<li class="state-log-item">\n	<div class="state-log-item-header">\n		<div class="state-log-item-name">'+a(n.i18n.call(t,"STATE_LOG_ITEM_INSTANCE",{hash:{},data:i}))+'</div>\n		<div class="state-log-item-status">',o=n["if"].call(t,t&&t.res_status,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="</div>\n	</div>\n</li>\n\n",s},n.stateLogInstanceItemTpl=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function";return s+='<div id="modal-state-log-detail" style="width: 900px;">\n	<div class="modal-header"><h3>'+u(n.i18n.call(t,"STATE_LOG_DETAIL_MOD_TIT",{hash:{},data:i}))+'</h3><i class="modal-close">&times;</i> </div>\n	<div class="modal-body">\n		<textarea class="state-log-detail-content" readonly="readonly">'+u((o=t&&t.content,typeof o===a?o.apply(t):o))+'</textarea>\n	</div>\n	<div class="modal-footer">\n		<button class="btn modal-close btn-silver">'+u(n.i18n.call(t,"STATE_LOG_DETAIL_MOD_CLOSE_BTN",{hash:{},data:i}))+"</button>\n	</div>\n</div>\n\n",s},n.stateLogDetailModal=e.template(t),t=function(e,t,n,r,i){function l(e,t){return"View"}function c(e,t){return"Edit"}function h(e,t){var r="";return r+='<button id="modal-state-text-expand-save" class="btn btn-blue">'+u(n.i18n.call(e,"STATE_TEXT_EXPAND_MODAL_SAVE_BTN",{hash:{},data:t}))+"</button>",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a=this,f="function";s+='<div id="modal-state-text-expand" style="width: 900px;">\n	<div class="modal-header"><h3>',o=n["if"].call(t,t&&t.read_only,{hash:{},inverse:a.program(3,c,i),fn:a.program(1,l,i),data:i});if(o||o===0)s+=o;s+=" "+u((o=t&&t.cmd_name,typeof o===f?o.apply(t):o))+" > "+u((o=t&&t.para_name,typeof o===f?o.apply(t):o))+'</h3><i class="modal-close">&times;</i> </div>\n	<div class="modal-body">\n		<div class="editable-area text-code-editor text"></div>\n	</div>\n	<div class="modal-footer">\n		',o=n.unless.call(t,t&&t.read_only,{hash:{},inverse:a.noop,fn:a.program(5,h,i),data:i});if(o||o===0)s+=o;return s+="\n	</div>\n</div>\n",s},n.stateTextExpandModal=e.template(t),n}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("component/stateeditor/validate",["Design","validation","constant","i18n!nls/lang.js","jquery","underscore","MC","UI.errortip"],function(t,n,r,i){var s,o,u,a,f,l,c;return f=n.state,u={},a={before:function(){},after:function(){}},l={command:function(e,t,n,r){var i;return e=o.trim(e),i=t.dataMap,this.required(e)?this.stateAllowed(e,i)?null:'Command "'+e+'" is not supported.':"Command name is required."},parameter:function(e,t,n,r){var i,s;return s=["required","type"],i=null,this[t.constraint.type]&&(i=this[t.constraint.type](e,t,n,r)),i||(i=this.componentExist(e)),i},dict:function(e,t,n,r){var i,s;return s=t.subType,i=null,t.constraint.required&&s==="key"&&!this.required(e)&&(i="dict key is required"),i},array:function(e,t,n,r){var i;return i=null,t.constraint.required&&!this.required(e)&&(i="array value is required"),i},line:function(e,t,n,r){var i;return i=null,t.constraint.required&&!this.required(e)&&(i="line value is required"),i},text:function(e,t,n,r){var i;return i=null,t.constraint.required&&!this.required(e)?i="text value is required":i=this.componentExist(e),i},bool:function(e,t,n,r){var i;return i=null,t.constraint.required&&!this.required(e)?i="line value is required":!this.isBool(e)&&!this.isStringBool(e,!0)&&(i='invalid boolean value: "'+e+'"'),i},componentExist:function(e){var t,n,r,i,s;r=o.getRefName(e),t=0;for(i=0,s=r.length;i<s;i++)n=r[i],o.nameExist(n.name)||t++;return t?"Reference 'unknown' doesn't exist.":null},required:function(e){return this.notnull(e)&&this.notblank(e)},notnull:function(e){return e.length>0},notblank:function(e){return"string"==typeof e&&""!==e.replace(/^\s+/g,"").replace(/\s+$/g,"")},isBool:function(e){return _.isBoolean(e)},isStringBool:function(e,t){return/^(true|false)$/i.test(e||t&&e==="")},stateAllowed:function(t,n){return e.call(o.getAllowCommands(n),t)>=0}},o={getAllowCommands:function(e){return _.keys(e)},trim:function(e){return $.trim(e)},nameExist:function(e){var n,r,i;n=t.instance().serialize().component;for(i in n){r=n[i];if(r.name===e)return!0}return!1},getRefName:function(e){var t,n,i;t=r.REGEXP.stateEditorOriginReference,i=[];while((n=t.exec(e))!==null)i.push({name:n[1],ref:n[0]});return i}},s={displayError:function(e,t,n){return errortip.hasError(t)?(errortip.changeError(e,t),errortip.changeError(e,n)):(errortip.createError(e,t),errortip.createError(e,n))},clearError:function(e,t){if(errortip.hasError(e))return errortip.removeError(e),errortip.removeError(t)}},c=function(e,t,n,r){var i;return i=l[t.type](e,t,n,r),i?s.displayError(i,n,r):s.clearError(n,r),i},_.extend(c,a),c})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("component/stateeditor/view",["event","i18n!nls/lang.js","./template","./validate","constant","instance_model","./lib/markdown","UI.errortip"],function(t,n,r,i,s,o,u){var a,f,l;for(f in r)l=r[f],Handlebars.registerPartial(f,l);return a=Backbone.View.extend({events:{closed:"closedPopup","blur .parameter-item.dict .parameter-value":"onDictInputBlur","keyup .parameter-item.dict .parameter-value":"onDictInputChange","paste .parameter-item.dict .parameter-value":"onDictInputChange","keyup .parameter-item.array .parameter-value":"onArrayInputChange","paste .parameter-item.array .parameter-value":"onArrayInputChange","keyup .parameter-item.state .parameter-value":"onArrayInputChange","paste .parameter-item.state .parameter-value":"onArrayInputChange","blur .parameter-item.array .parameter-value":"onArrayInputBlur","blur .parameter-item.state .parameter-value":"onArrayInputBlur","blur .command-value":"onCommandInputBlur","focus .editable-area":"onFocusInput","blur .editable-area":"onBlurInput","click #state-toolbar-add":"addStateItem","click #state-toolbar-copy-all":"copyAllState","click #state-toolbar-copy":"copyState","click #state-toolbar-delete":"removeState","click #state-toolbar-paste":"pasteState","click #state-toolbar-undo":"onUndo","click #state-toolbar-redo":"onRedo","click #state-toolbar-selectAll":"onSelectAllClick","click .state-toolbar":"onStateToolbarClick","click .state-toolbar .checkbox":"checkboxSelect","click .state-toolbar .state-remove":"onStateRemoveClick","click .state-save":"onStateSaveClick","click .state-cancel":"onStateCancelClick","click .state-close":"onStateCancelClick","click .parameter-item .parameter-remove":"onParaRemoveClick","click .state-desc-toggle":"onDescToggleClick","click .state-log-toggle":"onLogToggleClick","click .state-log-refresh":"onLogRefreshClick","click .state-sys-log-btn":"openSysLogModal","click .state-item-add":"onStateItemAddClick","click .state-item-add-btn":"onStateItemAddBtnClick","click #state-editor":"onClickBlank","click .state-log-item-header":"onStateLogItemHeaderClick","click .state-log-item .state-log-item-view-detail":"onStateLogDetailBtnClick","OPTION_CHANGE .state-editor-res-select":"onResSelectChange","keyup .parameter-item.optional .parameter-value":"onOptionalParaItemChange","paste .parameter-item.optional .parameter-value":"onOptionalParaItemChange","click .parameter-item .parameter-name":"onParaNameClick","click .parameter-item.text .parameter-text-expand":"onTextParaExpandClick",SWITCH_STATE:"onSwitchState",EXPAND_STATE:"onExpandState",COLLAPSE_STATE:"onCollapseState",REMOVE_STATE:"onRemoveState",ACE_TAB_SWITCH:"aceTabSwitch",ACE_UTAB_SWITCH:"aceUTabSwitch"},editorShow:!1,initialize:function(){},initState:function(){return this.initData(),this.initUndoManager(),$(document).off("keydown",this.keyEvent).on("keydown",{target:this},this.keyEvent)},closedPopup:function(){return this.trigger("CLOSE_POPUP"),$(document).off("keydown",this.keyEvent)},render:function(){var e,t,n;return t=this,e=this.model.get("compData"),t.initState(),t.isWindowsPlatform?(this.__renderEmpty("is_windows"),t):(Design.instance().get("agent").enabled?!e||(n=e.type)!==s.RESTYPE.INSTANCE&&n!==s.RESTYPE.LC?this.__renderEmpty():this.__renderState():this.__renderEmpty("disalbed"),this)},__renderEmpty:function(e){var t,n;return n={disalbed:"VisualOps is disabled.","void":"The component does'nt have state editor.",group:"View states and log by selecting individual instance.","default":"No state editor here.",group_in_app:"View states and log by selecting individual instance.",is_windows:"Editing state is only available for Linux platform."},t=e&&n[e]||n["default"],this.$el.html($.trim(r.stateEmptyTpl({tip:t}))),this.editorShow=!1,this},renderStateCount:function(){var e;return e=this.$stateList.find(".state-item").length,$("#btn-switch-state b").text("("+e+")")},__renderState:function(){var e,t,n,i,s,o,u,a,f,l,c,h,p;this.editorShow=!0,c=this,c.unloadEditor(),this.$el.html($.trim(r.editorModalTpl({res_name:c.resName,supported_platform:c.supportedPlatform,current_state:c.currentState,no_state:c.resNoState,allow_add_state:(h=c.currentState)==="stack"||h==="appedit"})),!1,null,{opacity:.2,conflict:"loose"}),c.$editorModal=c.$el,c.$stateList=c.$editorModal.find(".state-list"),c.$stateLogList=c.$editorModal.find(".state-log-list"),c.$cmdDsec=c.$("#state-description"),c.$noStateContainer=c.$editorModal.find(".state-no-state-container"),c.$haveStateContainer=c.$editorModal.find(".state-have-state-container"),c.$stateGistPasteArea=this.$("#state-gist-paste-area"),c.resNoState?(c.$haveStateContainer.hide(),c.$noStateContainer.show()):(c.$haveStateContainer.show(),c.$noStateContainer.hide()),a=jQuery.proxy(c.onDocumentMouseDown,c),$(document).off("mousedown",a).on("mousedown",a),f=jQuery.proxy(c.onPasteGistData,c),$(document).off("paste",f).on("paste",f),c.$("#state-editor").on("scroll",function(){return c.$(".ace_editor.ace_autocomplete").hide()}),l=c.loadStateData(c.originCompStateData),c.refreshStateList(l),o=c.$stateList.find(".state-item"),c.refreshStateViewList(o),c.bindStateListSortEvent(),c.readOnlyMode&&c.setEditorReadOnlyMode(),c.refreshDescription(),c.onLogRefreshClick(),c.isShowLogPanel&&c.showLogPanel(),i=c.$editorModal.find(".state-log-toggle"),n=c.$editorModal.find(".state-log-refresh"),s=c.$editorModal.find(".state-sys-log-btn"),t=$("#state-log");if(c.currentState==="stack")i.hide();else if((p=c.currentState)==="app"||p==="appedit")u=Design.instance().get("state"),u==="Stopped"?(i.hide(),n.hide(),c.currentResId||s.hide()):setTimeout(function(){return c.onLogToggleClick()},0);return e=$(".ace_autocomplete_tip"),e.length||$("body").append('<div class="ace_autocomplete_tip">No result matches the input</div>'),c.$aceAutocompleteTip=$(".ace_autocomplete_tip"),c.updateToolbar(),this},initData:function(){var e,t;t=this,t.cmdNameAry=t.model.get("cmdNameAry"),t.cmdParaMap=t.model.get("cmdParaMap"),t.cmdParaObjMap=t.model.get("cmdParaObjMap"),t.cmdModuleMap=t.model.get("cmdModuleMap"),t.moduleCMDMap=t.model.get("moduleCMDMap"),t.langTools=ace.require("ace/ext/language_tools"),t.Tokenizer=ace.require("ace/tokenizer").Tokenizer,t.resAttrDataAry=t.model.get("resAttrDataAry"),t.resStateDataAry=t.model.get("resStateDataAry"),t.groupResSelectData=t.model.get("groupResSelectData"),t.originCompStateData=t.model.getStateData(),t.resName=t.model.getResName(),t.supportedPlatform=t.model.get("supportedPlatform"),t.amiExist=t.model.get("amiExist"),t.isWindowsPlatform=t.model.get("isWindowsPlatform"),t.currentResId=t.model.get("resId"),t.currentState=t.model.get("currentState"),e=t.model.get("currentAppState"),t.resAttrRegexStr=t.model.get("resAttrRegexStr"),t.markdownConvert=new u.Converter,t.generalTip=n.ide.STATE_HELP_INTRO_LBL,t.resNoState=!0,t.originCompStateData&&_.isArray(t.originCompStateData)&&t.originCompStateData.length&&(t.resNoState=!1),t.currentState==="app"&&(t.readOnlyMode=!0,t.isShowLogPanel=!0,t.setEditorAppModel());if(t.currentState==="appedit")return t.readOnlyMode=!1,t.isShowLogPanel=!0,t.setEditorAppModel();if(t.currentState==="stack")return t.readOnlyMode=!1,t.isShowLogPanel=!1},setEditorAppModel:function(){var e;return e=this,!e.currentResId&&e.groupResSelectData&&e.groupResSelectData[0]&&(e.currentResId=e.groupResSelectData[0].res_id),e.currentResId||(e.isShowLogPanel=!1),null},genStateUID:function(){return"state-"+MC.guid()},bindStateListSortEvent:function(){var e;return e=this,e.$stateList.dragsort({itemSelector:".state-item",dragSelector:".state-drag",dragBetween:!0,placeHolderTemplate:'<div class="state-item state-placeholder"></div>',dragStart:function(t){var n;return n=$(t),e.collapseItem(n)},dragEnd:function(t,n){var r,i,s;return r=$(t),i=r.index(),s=r.attr("data-id"),n!==i&&e.undoManager.register(s,n,"sort",i),e.refreshLogItemNum()}})},onLogRefreshClick:function(e){var t;return t=this,t.onResSelectChange()},refreshStateList:function(e){var t,n;n=this;if(!e||!e.state_list.length)e={state_list:[]};return n.$stateList.html($.trim(r.stateListTpl(e))),t=n.$stateList.find(".state-item")},refreshStateViewList:function(e){var t,n,r,i,s;s=this,_.each(e,function(e){var t;return t=$(e),s.refreshStateView(t),null});if(!s.readOnlyMode)return n=e.find(".parameter-item.dict .parameter-dict-item:last .key"),_.each(n,function(e){return s.onDictInputChange({currentTarget:e},!0)}),t=e.find(".parameter-item.array .parameter-value:last").toArray(),i=e.find(".parameter-item.state .parameter-value:last").toArray(),r=t.concat(i),_.each(r,function(e){return s.onArrayInputChange({currentTarget:e},!0)})},refreshStateView:function(e){var t,n,i,s,o,u,a,f,l,c,h;return h=this,u=e.attr("data-command"),f=h.cmdParaObjMap[u],n=e.find(".command-view-value"),s=e.find(".parameter-list"),o=e.find(".parameter-view-list"),i=s.find(".parameter-item"),t=e.find(".state-edit .command-value"),a=h.getPlainText(t),n.text(a),c=[],l=!0,_.each(f,function(e){return e.visible&&(l=!1),null}),_.each(i,function(e){var t,n,r,i,s,o,u,a,p,d,v,m;n=$(e),s=n.attr("data-para-name"),u=f[s],a=u.type,s=u.name,o=!0,l?o=!1:u.visible&&(u.required?o=!1:n.hasClass("disabled")||(o=!1)),m={para_name:s,para_no_visible:o},m["type_"+a]=!0,p="";if(a==="dict")t=n.find(".parameter-dict-item"),d=[],_.each(t,function(e){var t,n,r,i,s;return n=$(e),t=n.find(".key"),r=n.find(".value"),i=h.getPlainText(t),s=h.getPlainText(r),i&&s&&d.push(i+":"+s),i&&!s&&d.push(i),null}),p=d.join(", ");else if(a==="array"||a==="state")i=n.find(".parameter-value"),d=[],_.each(i,function(e){var t,n;t=$(e),n=h.getPlainText(t);if(n)return d.push(n)}),p=d.join(", ");else if(a==="line"||a==="text"||a==="bool"||a==="state")r=n.find(".parameter-value"),v=h.getPlainText(r),p=v,a==="bool"&&(p==="true"?p=s:m.para_no_visible=!0);return m.para_value=p,p&&c.push(m),null}),o.html($.trim(r.paraViewListTpl({parameter_view_list:c})))},bindStateListEvent:function(e){var t;return t=this,_.each(e,function(e){var n,r;return r=$(e),n=r.find(".command-value"),t.bindCommandEvent(n),null})},bindCommandEvent:function(e){var t,n;return n=this,t=n.cmdNameAry,t=_.map(t,function(e,t){var n;return n="",e.support===!1&&(n="not supported"),{name:e.name,value:e.name,meta:n,support:e.support}}),n.initCodeEditor(e[0],{focus:t})},bindParaListEvent:function(e,t){var n;return n=this,setTimeout(function(){var r,i;return r=e.find(".parameter-item"),i=n.cmdParaObjMap[t],_.each(r,function(e){var t,r,s;return t=$(e),r=t.attr("data-para-name"),s=i[r],n.bindParaItemEvent(t,s),null})},0)},bindParaItemEvent:function(e,t){var n,r,i,s,o,u,a,f,l,c;c=this,l=t.type,a=t.option,f=null,a&&(_.isString(a)?f=[a]:_.isArray(a)&&(f=a),f=_.map(f,function(e){return{name:e,value:e}}));if(l==="dict")return _.each(e,function(e){var t,n,r;return n=$(e),t=n.find(".key"),r=n.find(".value"),_.each(t,function(e){return c.initCodeEditor(e,{})}),_.each(r,function(e){return c.initCodeEditor(e,{focus:f,at:c.resAttrDataAry})})});if(l==="line"||l==="text"||l==="array"){s=e.find(".parameter-value"),s.length||(s=e.nextAll(".parameter-value")),_.each(s,function(e){return c.initCodeEditor(e,{focus:f,at:c.resAttrDataAry})}),n=e.parents(".state-item.comment"),r=n.find(".parameter-value"),o=r.data("editor");if(o)return o.focus()}else{if(l==="state")return s=e.find(".parameter-value"),s.length||(s=e.nextAll(".parameter-value")),u=_.map(c.resStateDataAry,function(e){return{name:"@"+e.name,value:"@"+e.value,meta:e.meta}}),_.each(s,function(e){return c.initCodeEditor(e,{focus:u})});if(l==="bool")return i=e.find(".parameter-value"),c.initCodeEditor(i[0],{focus:[{name:"true",value:"true"},{name:"false",value:"false"}]})}},unBindParaListEvent:function(e){var t;return t=this,setTimeout(function(){var t;return t=e.find(".editable-area"),_.each(t,function(e){var t,n;t=$(e),n=t.data("editor");if(n)return n.destroy()})},0)},refreshDescription:function(e){var t,n,r,i;i=this,n="";if(!e){t=i.generalTip,i.$cmdDsec.html(t);return}return r=i.cmdModuleMap[e],r.reference&&(n=r.reference.en),i.$cmdDsec.attr("data-command",e),t="",setTimeout(function(){return n&&(t=i.markdownConvert.makeHtml(n)),i.$cmdDsec.html(t),i.$cmdDsec.find("em:contains(required)").parents("li").addClass("required"),i.$cmdDsec.find("em:contains(optional)").parents("li").addClass("optional"),i.$cmdDsec.scrollTop(0)},0),null},refreshParaList:function(e,t){var n,i,s,o;return o=this,i=o.cmdParaObjMap[t],n=o.cmdParaMap[t],s=[],_.each(n,function(e){var t,n,r,i;n=!1,e.required||(n=!0),t={para_name:e.name,required:e.required,para_disabled:n},t["type_"+e.type]=!0;if((r=e.type)==="line"||r==="text"||r==="bool")t.para_value="";else if(e.type==="dict")t.para_value=[{key:"",value:""}];else if((i=e.type)==="array"||i==="state")t.para_value=[""];return s.push(t),null}),e.html($.trim(r.paraListTpl({parameter_list:s}))),o.bindParaListEvent(e,t)},getParaObj:function(e){var t,n,r,i,s,o,u;return u=this,n=e.parents(".state-item"),t=e.parents(".parameter-item"),r=n.attr("data-command"),s=t.attr("data-para-name"),i=u.cmdParaObjMap[r],o=i[s],o},onDictInputChange:function(e,t){var n,i,s,o,u,a,f,l,c,h,p,d,v,m,g;m=this;if(m.readOnlyMode)return;s=$(e.currentTarget),c=m.getPlainText(s),c&&s.removeClass("disabled"),v=m.getParaObj(s),i=s.parent(".parameter-dict-item"),d=i.next();if(!d.length){n=i.parents(".parameter-container"),u=i.find(".key"),l=i.find(".value"),h=m.getPlainText(u),g=m.getPlainText(l);if(h||g){p=$.trim(r.paraDictListTpl({para_value:[{key:"",value:""}]})),o=$(p).appendTo(n),f=o.find(".parameter-value"),f.addClass("disabled"),a=o.parents(".parameter-item");if(!t)return m.bindParaItemEvent(a,v)}}},onDictInputBlur:function(e){var t,n,r,i,s,o;o=this;if(o.readOnlyMode)return;n=$(e.currentTarget),t=n.parents(".parameter-container"),r=t.find(".parameter-dict-item"),_.each(r,function(e,t){var n,i;return n=$(e).find(".parameter-value"),i=!0,_.each(n,function(e){return o.getPlainText(e)&&(i=!1),null}),i&&t!==r.length-1&&$(e).remove(),null}),i=t.find(".parameter-dict-item");if(i.length===1)return s=$(i[0]).find(".parameter-value"),s.removeClass("disabled")},onArrayInputChange:function(e,t){var n,i,s,o,u,a,f,l,c,h;h=this,s=$(e.currentTarget),a=h.getPlainText(s),a&&s.removeClass("disabled"),c=h.getParaObj(s),l=s.next();if(!l.length){i=s.parents(".parameter-container"),u=h.getPlainText(s);if(u){f=$.trim(r.paraArrayListTpl({para_value:[""]})),n=$(f).appendTo(i),n.addClass("disabled"),o=n.parents(".parameter-item");if(!t)return h.bindParaItemEvent(o,c)}}},onArrayInputBlur:function(e){var t,n,r,i;return i=this,n=$(e.currentTarget),t=n.parents(".parameter-container"),r=t.find(".parameter-value"),_.each(r,function(e,t){var n;return n=i.getPlainText(e),!n&&t!==r.length-1&&$(e).remove(),null})},onFocusInput:function(e){var t,n,r,i,s,o,u;u=this,t=$(e.currentTarget),t.hasClass("parameter-value")&&(s=u.getPlainText(t),o=u.getParaObj(t),o&&u.highlightParaDesc(o.name)),n=t.parents(".state-item"),r=n.attr("data-command"),i=u.$cmdDsec.attr("data-command");if(r&&i!==r)return u.refreshDescription(r)},onBlurInput:function(e){var t,n,r;r=this,t=$(e.currentTarget),n=t.data("editor");if(n)return n.clearSelection()},onParaNameClick:function(e){var t,n,r,i,s;s=this,t=$(e.currentTarget),r=t.parents(".parameter-item"),n=r.find(".parameter-value"),i=n.data("editor");if(i)return i.focus()},onStateToolbarClick:function(e){var t,n,r;return r=this,n=$(e.currentTarget),r.clearFocusedItem(),t=n.parents(".state-item"),t.addClass("focused"),t.hasClass("view")?r.expandItem.call(this,t):r.collapseItem.call(this,t),!1},expandItem:function(e){var t,n,r,i,s,o,u,a,f;a=this,a.clearFocusedItem(),r=a.$stateList.find(".state-item"),o=e.attr("data-command"),n=e.find(".parameter-list"),a.bindStateListEvent([e]),_.each(r,function(t){var n;return n=$(t),!e.is(n)&&!n.hasClass("view")&&a.refreshStateView(n),null}),r.addClass("view"),e.removeClass("view").addClass("focused"),s=e.attr("data-command"),s&&a.refreshDescription(s);if((f=a.currentState)==="app"||f==="appedit")u=e.attr("data-id"),a.scrollToLogItem(u);return t=e.find(".command-value"),i=t.data("editor"),i&&setTimeout(function(){return i.focus()},0),a.bindParaListEvent(n,o)},collapseItem:function(e){var t,n,r,i;return i=this,t=i.$stateList.find(".editable-area.ace_focus"),t&&(r=t.data("editor"),r&&r.blur()),i.refreshStateView(e),e.addClass("view"),i.refreshDescription(),n=e.find(".parameter-list")},onExpandState:function(e){var t;return t=this,t.expandItem($(".state-list").find(".focused")),!1},onCollapseState:function(e){var t;return t=this,t.collapseItem($(".state-list").find(".focused")),!1},clearSelectedItem:function(){var e;return e=this,e.$stateList.find(".selected").removeClass("selected"),e.$stateList.find(".checkbox input").prop("checked",!1),null},clearFocusedItem:function(){var e;return e=this,e.$stateList.find(".focused").removeClass("focused"),null},onStateItemAddClick:function(e){var t;return t=this,t.addStateItem.call(this,e),!1},addStateItem:function(e){var t,n,i,s,o,u,a,f,l,c,h;return h=this,h.currentState==="app"?!1:(s=h.$stateList.find(".state-item:last"),l=h.genStateUID(),f=$.trim(r.stateListTpl({state_list:[{id:l}]})),n=h.$stateList.find(".state-item.focused"),n.length?i=$(f).insertAfter(n):i=$(f).appendTo(h.$stateList),h.clearFocusedItem(),t=i.find(".command-value"),h.bindCommandEvent(t),o=h.$stateList.find(".state-item"),_.each(o,function(e){var t;return t=$(e),!i.is(t)&&!t.hasClass("view")&&h.refreshStateView(t),null}),o.addClass("view"),i.removeClass("view").addClass("focused"),a=t.data("editor"),a&&setTimeout(function(){return a.focus()},0),h.refreshLogItemNum(),u=h.$stateList.find(".state-item"),u.length&&(h.$haveStateContainer.show(),h.$noStateContainer.hide()),c=i.index(),h.undoManager.register(l,c,"add"),h.updateToolbar(),!1)},onStateRemoveClick:function(e){var t,n,r;return r=this,t=$(e.currentTarget),n=t.parents(".state-item"),r.onRemoveState(null,n)},submitValidate:function(e){var t,n,r,s,o,u,a;return u=this,r=function(e){var t,n,r;return r=u.getPlainText(e),t=u.getParaObjByInput(e),n=u.getRepresent(e),i(r,t,e,n)},a=function(e){var t;t=r(e.currentTarget);if(!t)return $(e.currentTarget).off("keyup.validate")},n=function(e){return $(e).on("keyup.validate",a)},e?o=r(e):(t=this.$stateList.find('.editable-area:not(".disabled")'),s=t.toArray(),o=!0,_.each(s,function(e){var t;return t=r(e),t&&(n(e),o&&(o=!1)),o})),o},genStateItemData:function(e){var t,n,r,i,s,o,u;return u=this,r=e.attr("data-command"),s=e.attr("data-id"),i=u.cmdModuleMap[r],i?(o={id:s,module:i.module,parameter:{}},n=e.find(".parameter-list"),t=n.find(".parameter-item"),_.each(t,function(e){var t,n,r,i,s,a,f,l,c;i=$(e);if(i.hasClass("disabled"))return;l=i.attr("data-para-name"),c=null;if(i.hasClass("line")||i.hasClass("bool")||i.hasClass("text")){r=i.find(".parameter-value"),c=u.getPlainText(r),i.hasClass("bool")&&(c==="true"?c=!0:c==="false"?c=!1:c="");if(i.hasClass("line")||i.hasClass("text"))c=u.model.replaceParaNameToUID(c)}else if(i.hasClass("dict"))n=i.find(".parameter-dict-item"),a=[],_.each(n,function(e){var t,n,r,i,s;return t=$(e),n=t.find(".key"),r=t.find(".value"),i=u.getPlainText(n),s=u.getPlainText(r),i&&(s=u.model.replaceParaNameToUID(s),a.push({key:i,value:s})),null}),c=a;else if(i.hasClass("array")||i.hasClass("state"))t=i.find(".parameter-value"),f=i.hasClass("state"),s=[],_.each(t,function(e){var t,n;return t=$(e),n=u.getPlainText(t),n&&(f?n=u.model.replaceStateNameToUID(n):n=u.model.replaceParaNameToUID(n),s.push(n)),null}),c=s;return o.parameter[l]=c}),o):{id:s,module:"",parameter:{}}},saveStateData:function(){var e,t,n;return n=this,e=n.$stateList.find(".state-item"),t=[],_.each(e,function(e,r){var i,s;return i=$(e),s=n.genStateItemData(i),s&&s.module&&s.id&&t.push(s),null}),t},loadStateData:function(e){var t,n;return n=this,t={state_list:[],err_list:[]},_.each(e,function(e,r){var i,s,o,u,a,f;try{i=n.moduleCMDMap[e.module];if(!i)throw new Error("command");u=n.cmdParaObjMap[i],o=e.parameter,a=e.id,f={id:a,id_show:r+1,cmd_value:i,parameter_list:[]},_.each(u,function(e,r){var i,s,u,a,l,c;u=e.type,s=e.required,l={para_name:r,para_disabled:!0,required:s},l["type_"+u]=!0,a=o[r];if(a===void 0&&s)throw new Error("parameter");a===void 0&&!s?l.para_disabled=!0:l.para_disabled=!1,c=null;if(u==="line"||u==="text"||u==="bool"){c=String(a),a||(c=""),u==="bool"&&a===!1&&(c="false");if(u==="line"||u==="text")c=n.model.replaceParaUIDToName(c),c&&c.indexOf("unknown")!==-1&&t.err_list.push("reference")}else if(u==="dict"){c=[],_.isArray(a)?_.each(a,function(e){return e.value=n.model.replaceParaUIDToName(e.value),e.value&&e.value.indexOf("unknown")!==-1&&t.err_list.push("reference"),c.push({key:e.key,value:e.value}),null}):_.isObject(a)&&_.each(a,function(e,r){return e=n.model.replaceParaUIDToName(e),e&&e.indexOf("unknown")!==-1&&t.err_list.push("reference"),c.push({key:r,value:e}),null});if(!a||_.isEmpty(a))c=[{key:"",value:""}]}else if(u==="array"||u==="state"){c=[],_.isArray(a)||(a||(a=""),a=[a]),_.each(a,function(e){return u==="state"?e=n.model.replaceStateUIDToName(e):e=n.model.replaceParaUIDToName(e),e&&e.indexOf("unknown")!==-1&&t.err_list.push("reference"),c.push(e),null});if(!a||!a.length)c=[""]}return l.para_value=c,f.parameter_list.push(l),i=f.parameter_list,f.parameter_list=n.model.sortParaList(i,"para_name"),null}),t.state_list.push(f)}catch(l){s=l,t.err_list.push(s.message)}return null}),t},onStateSaveClick:function(e){var n,r,i,s,o,u,a;u=this,o=u.saveStateData(),u.model.setStateData(o);if(o){i=null,s=null,n=[];if(u.originCompStateData&&o){u.originCompStateData.length>o.length?(i=o,s=u.originCompStateData):(i=u.originCompStateData,s=o),_.each(i,function(e,t){return _.isEqual(e,s[t])||n.push(e.id),null});if((a=u.currentState)==="app"||a==="appedit"){r={resId:u.currentResId,stateIds:n};if(!_.isEqual(u.originCompStateData,o)||n.length)return t.trigger(t.STATE_EDITOR_DATA_UPDATE,r)}}}},onStateCancelClick:function(e){var t;return t=this,t.unloadEditor(),t.closedPopup()},onParaRemoveClick:function(e){var t,n,r;return r=this,t=$(e.currentTarget),n=t.parents(".parameter-item"),n.hasClass("disabled")?n.removeClass("disabled"):n.addClass("disabled"),null},onDescToggleClick:function(e){var t,n,r,i,s,o,u;return u=this,s=$("#state-editor"),t=$("#state-description"),r=$("#state-log"),n=u.$editorModal.find(".state-desc-toggle"),i=u.$editorModal.find(".state-log-toggle"),o=$("#property-panel").hasClass("state-wide"),o&&t.hasClass("show")?(s.addClass("full"),r.removeClass("show"),t.removeClass("show"),n.removeClass("active"),$("#property-panel").removeClass("state-wide")):(s.removeClass("full"),r.removeClass("show"),t.addClass("show"),n.addClass("active"),$("#property-panel").addClass("state-wide")),i.removeClass("active")},onLogToggleClick:function(e){var t,n,r,i,s,o,u,a,f;a=this;if((f=a.currentState)==="app"||f==="appedit"){o=Design.instance().get("state");if(o==="Stopped")return}return s=$("#state-editor"),t=$("#state-description"),r=$("#state-log"),n=a.$editorModal.find(".state-desc-toggle"),i=a.$editorModal.find(".state-log-toggle"),u=$("#property-panel").hasClass("state-wide"),u&&r.hasClass("show")?(s.addClass("full"),t.removeClass("show"),r.removeClass("show"),i.removeClass("active"),$("#property-panel").removeClass("state-wide")):(s.removeClass("full"),t.removeClass("show"),r.addClass("show"),i.addClass("active"),$("#property-panel").addClass("state-wide")),n.removeClass("active")},showLogPanel:function(){var e,t,n,r,i,s;return s=this,i=$("#state-editor"),e=$("#state-description"),n=$("#state-log"),t=s.$editorModal.find(".state-desc-toggle"),r=s.$editorModal.find(".state-log-toggle"),i.removeClass("full"),e.removeClass("show"),n.addClass("show"),r.addClass("active"),t.removeClass("active"),null},onDocumentMouseDown:function(e){var t,n,r,i;return i=this,n=$(e.target),r=n.parents(".editable-area"),!r.length&&!n.hasClass("editable-area")&&!n.hasClass("ace_scrollbar")&&(t=$(".editable-area"),_.each(t,function(e){var t,n;return t=$(e),n=t.data("editor"),n&&n.blur(),null}),setTimeout(function(){return i.$stateGistPasteArea.focus()},0)),i.onMouseDownSaveFromOther(e)},onMouseDownSaveFromOther:function(e){var t,n,r,i,s,o;o=this,t=$(e.target),r=t.parents(".editable-area"),s=$("#state-editor-model"),n=t.parents("#state-editor-model");if(s.length&&!n.length){i=$("#property-panel");if(s.length&&!i.hasClass("no-state"))return o.onStateSaveClick();if(t.parents("#tabbar-wrapper").length)return o.onStateSaveClick()}},initCodeEditor:function(e,t,n){var r,i,s;i=this;if(!e)return;r=$(e);if(r.data("editor"))return;return n||(n={}),s=function(){var s,o,u,a,f,l,c,h,p;a=ace.edit(e),r.data("editor",a),a.hintObj=t,a.renderer.setPadding(4),a.setBehavioursEnabled(!1),f=!1,c=void 0,r.hasClass("line")&&(c=1,f=!0),h=[{token:"res_ref_correct",regex:i.resAttrRegexStr},{token:"res_ref",regex:"@\\{(\\w|\\-)+(\\.(\\w+(\\[\\d+\\])*))+\\}"}],u=a.getSession(),l=!1,n.isCodeEditor?(ace.modeResRefRule=h,n.extName==="js"?u.setMode("ace/mode/javascript"):n.extName==="sh"?u.setMode("ace/mode/sh"):n.extName==="rb"?u.setMode("ace/mode/ruby"):n.extName==="py"&&u.setMode("ace/mode/python"),a.setTheme("ace/theme/tomorrow_night"),l=!0):(p=new i.Tokenizer({start:h}),u.$mode.$tokenizer=p,u.bgTokenizer.setTokenizer(p),a.renderer.updateText()),a.setOptions({enableBasicAutocompletion:!0,maxLines:c,showGutter:n.showGutter||!1,highlightGutterLine:!0,showPrintMargin:!1,highlightActiveLine:!1,highlightSelectedWord:!1,enableSnippets:!1,singleLine:f,enableTab:l}),o=u.getLength(),s=u.getLine(o-1).length,a.gotoLine(o,s),a.commands.on("afterExec",function(e){var t,n,a,f,l,c,h,p,d,v,m,g,y,b,w;b=e.editor,c=b.getValue(),d=b.hintObj,e.command.name==="insertstring"&&/^{$/.test(e.args)&&d.at&&(u=b.getSession(),h=b.getCursorPosition(),o=h.row,s=h.column,g=u.getLine(o),m=g[s-2],m==="@"&&(b.insert("}"),b.moveCursorTo(o,s),i.setEditorCompleter(b,d.at,"reference"),b.execCommand("startAutocomplete"))),e.command.name==="backspace"&&(f=r.parents(".state-item"),d.focus&&(n=r.parents(".parameter-item"),(n.hasClass("bool")||n.hasClass("state"))&&i.setPlainText(r,""),i.setEditorCompleter(b,d.focus,"command"),b.execCommand("startAutocomplete")),c===""&&f.hasClass("comment")&&(l=f.find(".command-value").data("editor"),l&&l.focus())),e.command.name==="autocomplete_confirm"&&(f=r.parents(".state-item"),a=f.find(".parameter-list"),r.hasClass("command-value")&&(w=e.args,y=f.attr("data-command"),y!==w&&(i.setCMDForStateItem(f,w),i.refreshDescription(w),i.refreshParaList(a,w),i.refreshStateView(f))),w==="#"?(t=a.find(".parameter-value"),p=t.data("editor"),p&&p.focus()):r.hasClass("parameter-value")?(h=b.getCursorPosition(),b.moveCursorTo(h.row,h.column+1),n=r.parents(".parameter-item"),n.hasClass("dict")?i.onDictInputChange({currentTarget:r[0]}):n.hasClass("array")||n.hasClass("state")?i.onArrayInputChange({currentTarget:r[0]}):(n.hasClass("line")||n.hasClass("bool")||n.hasClass("text"))&&n.removeClass("disabled")):r.hasClass("text-code-editor")&&(h=b.getCursorPosition(),b.moveCursorTo(h.row,h.column+1)));if(e.command.name==="autocomplete_match"){v=!1,r.hasClass("parameter-value")&&(n=r.parents(".parameter-item"),n.hasClass("state")&&(v=!0)),r.hasClass("command-value")&&(v=!0);if(v)return e.args?i.$aceAutocompleteTip.hide():i.$aceAutocompleteTip.show()}}),a.on("focus",function(e,t){var n,r,s,o,u,a;return r=$(t.container),n=r.parents(".state-item"),i.justScrollToElem(i.$stateList,r),o=t.hintObj,s=t.getValue(),!s&&o.focus&&(i.setEditorCompleter(t,o.focus,"command"),t.execCommand("startAutocomplete")),u=r.offset().left,a=r.offset().top,i.$aceAutocompleteTip.css({left:u,top:a+25}),i.clearFocusedItem(),n.addClass("focused")}),a.on("blur",function(e,t){var n,r,s,o;i.$cmdDsec.find(".highlight").removeClass("highlight"),i.$aceAutocompleteTip.hide(),s=$(t.container),r=s.parents(".state-item"),n=s.parents(".parameter-item"),o=t.getValue();if(n&&n[0]&&n.hasClass("bool")&&o!=="true"&&o!=="false")return i.setPlainText(s,"")});if(i.readOnlyMode)return a.setReadOnly(!0)},s()},highlightParaDesc:function(e){var t,n,r,i,s,o;o=this,o.$cmdDsec.find(".highlight").removeClass("highlight"),t=o.$cmdDsec.find("strong code:contains('"+e+"')"),r=t.filter(function(){return $(this).text()===e}),r[0]&&(i=$(r[0]).parents("li"),i.addClass("highlight"));try{return s=i.offset().top-o.$cmdDsec.offset().top+o.$cmdDsec.scrollTop()-15,o.$cmdDsec.stop(!0,!0),o.$cmdDsec.animate({scrollTop:s},150)}catch(u){return n=u,null}},scrollToLogItem:function(e){var t,n,r,i,s;s=this,n=s.$stateLogList.find(".state-log-item[data-state-id='"+e+"']"),t=$("#state-log");try{if(n[0])return i=n.offset().top-t.offset().top+t.scrollTop(),t.stop(!0,!0),t.animate({scrollTop:i},150)}catch(o){return r=o,null}},justScrollToElem:function(e,t){var n,r,i,s,o,u;try{return o=t.offset().top,r=e.offset().top,u=o+35,i=r+e.height(),u>i?s=e.scrollTop()+u-i+15:o<r&&(s=e.scrollTop()+o-r-15),e.scrollTop(s)}catch(a){return n=a,null}},setEditorCompleter:function(e,t,n){return e.completers=[{getCompletions:function(e,n,r,i,s){return t&&t.length?s(null,t.map(function(e){return{name:e.name,value:e.value,score:e.value,meta:e.meta,support:e.support}})):s(null,[])}}],null},getRepresent:function(e){var t,n,r,i,s;return t=$(e),r=t.closest(".state-item"),t.hasClass("command-value")?s=r.find(".state-view .command-view-value"):(n=t.closest(".parameter-item"),i=n.data("paraName"),s=r.find(".state-view [data-para-name='"+i+"']")),s},getParaObjByInput:function(e){var t,n,r,i,s,o,u,a,f,l,c;return l=this,t=$(e),a={},t.hasClass("command-value")?(c="command",a={type:c,dataMap:l.cmdParaObjMap}):(c="parameter",n=t.closest(".parameter-item"),r=n.closest(".state-item"),u=n.data("paraName"),i=r.data("command"),o=l.cmdParaObjMap[i],s=o[u],t.hasClass("key")?f="key":t.hasClass("value")&&(f="value"),a={type:c,subType:f,command:i,paramName:u,constraint:s,dataMap:l.cmdParaObjMap,refList:l.model.genAttrRefList()}),a},getPlainText:function(e){var t,n;return t=$(e),n=t.data("editor"),n?n.getValue():t.hasClass("ace_editor")?"":t.text()},setPlainText:function(e,t){var n,r;n=$(e),r=n.data("editor");if(r)return r.setValue(t)},updateStateIdBySort:function(e){var t;return t=this,t.model.updateAllStateRef(e)},refreshStateLogList:function(){var e,t,n,i,s,o,u,a,f;return f=this,o=f.model.get("stateLogDataAry"),(!o||!o.length)&&f.showLogListLoading(!1,!0),f.stateIdLogContentMap={},u=[],a={},s={},e=f.$stateLogList.find(".state-log-item"),_.each(e,function(e){var t,n,r;return t=$(e),n=t.attr("data-state-id"),r=t.hasClass("view"),n&&(s[n]=r),null}),_.each(o,function(e,t){var n,r,i,o,l,c,h,p,d;return p=null,e.time&&(p=MC.dateFormat(new Date(e.time),"yyyy-MM-dd hh:mm:ss")),c=e.result,o=""+e.id,l="",r=!1,e.id!=="Agent"?(o="State "+o,r=!0,a[e.id]=c):l=e.id,h="",n="",i=!1,e.comment&&(n=$.trim(e.comment.replace(/\n\n/g,"\n"))),e.stdout&&(h=$.trim(e.stdout.replace(/\n\n/g,"\n")),h.length>100&&(i=!0,f.stateIdLogContentMap[e.id]={number:l,content:h})),d=s[e.id],d!==!0&&d!==!1&&(d=!1),u.push({id:e.id,state_num:l,log_time:p,state_status:c,stdout:h,comment:n,long_stdout:i,view:d,is_state_log:r}),null}),n=$.trim(r.stateLogItemTpl({state_logs:u})),f.refreshStateItemStatus(a),i=f.model.get("resState"),t=$.trim(r.stateLogInstanceItemTpl({res_status:i})),f.$stateLogList.empty().append(t).append(n),f.refreshLogItemNum()},setEditorReadOnlyMode:function(){var e,t,n;return n=this,n.$stateList.find(".state-drag").hide(),n.$stateList.find(".state-add").hide(),n.$stateList.find(".state-remove").hide(),n.$stateList.find(".parameter-remove").hide(),n.$editorModal.find(".state-item-add").hide(),t=n.$editorModal.find(".state-save, .state-cancel"),t.hide(),e=n.$editorModal.find(".state-close"),e.css("display","inline-block")},showLogListLoading:function(e,t){var n,r,i,s;return s=this,i=$("#state-log"),n=i.find(".state-log-loading"),r=i.find(".state-log-info"),e?(n.show(),r.hide()):(n.hide(),t?r.show():r.hide())},onResSelectChange:function(){var e,t,n,r;r=this,n=r.currentResId,r.showLogListLoading(!0),r.model.getResState(n);if(!r.isLoadingLogList)return t=$("#state-log"),e=t.find(".state-log-loading"),e.text("Refresh..."),r.isLoadingLogList=!0,r.model.genStateLogData(n,function(){return r.refreshStateLogList(),r.showLogListLoading(!1),r.isLoadingLogList=!1}),r.logRefreshTimer&&clearTimeout(r.logRefreshTimer),r.logRefreshTimer=setTimeout(function(){if(r.isLoadingLogList)return e.text("Request log info timeout, please try again")},5e3)},onStateStatusUpdate:function(t){var n,r;r=this,n=r.currentResId;if(!t)return r.onLogRefreshClick();if(!t.length)return r.onLogRefreshClick();if(n&&e.call(t,n)>=0)return r.onLogRefreshClick()},onOptionalParaItemChange:function(e){var t,n,r,i,s,o,u;u=this,n=$(e.currentTarget),s=u.getPlainText(n),i=n.parents(".parameter-item");if(s)return i.removeClass("disabled");if(i.hasClass("line")||i.hasClass("bool")||i.hasClass("text"))return i.addClass("disabled");if(i.hasClass("dict")){o=!0,r=i.find(".parameter-dict-item");if(r.length<=2){_.each(r,function(e){var t,n,r,i,s;t=$(e),n=t.find(".key"),r=t.find(".value"),i=u.getPlainText(n),s=u.getPlainText(r);if(i||s)o=!1;return null});if(o)return i.addClass("disabled")}}else if(i.hasClass("array")||i.hasClass("state")){o=!0,t=i.find(".parameter-value");if(t.length<=2){_.each(t,function(e){var t,n;return t=$(e),n=u.getPlainText(t),n&&(o=!1),null});if(o)return i.addClass("disabled")}}},onCommandInputBlur:function(e){var t,n,r,i,s,o,u;u=this,t=$(e.currentTarget),r=t.parents(".state-item"),i=u.getPlainText(t),s=u.cmdModuleMap[i],o=r.attr("data-command");if(!s||!s.support)return u.setPlainText(t,o);if(o!==i)return u.setCMDForStateItem(r,i),u.refreshDescription(i),n=r.find(".parameter-list"),u.refreshParaList(n,i),u.refreshStateView(r)},setCMDForStateItem:function(e,t){var n;return n=this,e.attr("data-command",t),t==="#"?e.addClass("comment"):e.removeClass("comment")},refreshStateItemStatus:function(e){var t,n;return n=this,t=n.$stateList.find(".state-item"),_.each(t,function(t){var n,r,i,s;return n=$(t),i=n.attr("data-id"),r=n.find(".state-status-icon"),r.removeClass("status-green").removeClass("status-red").removeClass("status-yellow"),s=e[i],s==="success"?r.addClass("status-green"):s==="failure"?r.addClass("status-red"):r.addClass("status-yellow"),null})},refreshLogItemNum:function(){var e,t,n,r;r=this;if(r.currentState==="stack")return;return n={},t=r.$stateList.find(".state-item"),_.each(t,function(e,t){var r,i;return r=$(e),i=r.attr("data-id"),n[i]=t+1,null}),e=r.$stateLogList.find(".state-log-item"),_.each(e,function(e,t){var r,i,s,o;return t>=2&&(r=$(e),i=r.attr("data-state-id"),s=n[i],o="deleted",s&&(o=s),r.find(".state-log-item-name").text("State "+o)),null})},unloadEditor:function(){var e,t;return t=this,e=$(".ace_editor"),e.remove()},initUndoManager:function(){var e;return e=this,e.commandStack=[],e.commandIndex=-1,e.undoManager={register:function(t,n,r,i){var s,o,u,a,f;return e.commandStack.splice(e.commandIndex+1,e.commandStack.length-e.commandIndex),r==="remove"&&(a=[],f=n,_.each(t,function(t){var n,r;return n=e.getStateItemById(t),r=e.getStateItemByData(n),a.push(r)}),e.commandStack.push({redo:function(){return _.each(a,function(t){var n;return n=e.getStateItemById(t.id),e.onRemoveState(null,n,!0)})},undo:function(){var t;return t=0,_.each(a,function(n){return e.addStateItemByData([n],f[t++]-1)}),null}})),r==="add"&&e.commandStack.push({redo:function(){return null},undo:function(){var r;return r=e.getStateItemById(t),i=e.getStateItemByData(r),this.redo=function(){return e.addStateItemByData([i],n-1)},e.onRemoveState(null,r,!0)}}),r==="sort"&&(u=n,o=i,e.commandStack.push({redo:function(){var n;return n=e.getStateItemById(t),i=e.getStateItemByData(n),e.onRemoveState(null,n,!0),e.addStateItemByData([i],o-1)},undo:function(){var n;return n=e.getStateItemById(t),i=e.getStateItemByData(n),e.onRemoveState(null,n,!0),e.addStateItemByData([i],u-1)}})),r==="paste"&&(s=n,a=_.map(i,function(e){return _.extend({},e)}),e.commandStack.push({redo:function(){return e.addStateItemByData(a,s-1)},undo:function(){return _.each(a,function(t){var n,r;return r=t.id,n=e.getStateItemById(r),e.onRemoveState(null,n,!0),null})}})),e.commandIndex=e.commandStack.length-1,_.defer(_.bind(e.renderStateCount,e)),null},redo:function(){var t;return e.undoManager.hasRedo()&&(t=e.commandStack[e.commandIndex+1],t&&(t.redo(),e.commandIndex=e.commandIndex+1),e.renderStateCount()),null},undo:function(){var t;return e.undoManager.hasUndo()&&(t=e.commandStack[e.commandIndex],t&&(t.undo(),e.commandIndex=e.commandIndex-1),e.renderStateCount()),null},hasUndo:function(){return e.commandIndex!==-1},hasRedo:function(){return e.commandIndex<e.commandStack.length-1}},null},getStateItemById:function(e){var t,n;return n=this,t=n.$stateList.find('.state-item[data-id="'+e+'"]'),t},getStateItemByData:function(e){var t,n;return n=this,t=n.genStateItemData(e),t},setNewStateIdForStateAry:function(e){var t;return t=this,e=_.map(e,function(e){return e.id=t.genStateUID(),e}),e},addStateItemByData:function(t,i){var s,o,u,a,f,l,c,h;return h=this,c=h.loadStateData(t),f=c.err_list,f.length&&((e.call(f,"command")>=0||e.call(f,"parameter")>=0)&&notification("warning",n.ide.NOTIFY_MSG_INFO_STATE_PARSE_COMMAND_FAILED),e.call(f,"reference")>=0&&notification("warning",n.ide.NOTIFY_MSG_INFO_STATE_PARSE_REFRENCE_FAILED)),a=$.trim(r.stateListTpl(c)),s=h.$stateList.find(".state-item"),l=null,_.isNumber(i)?i<=-1?(o=$(a).prependTo(h.$stateList),l=-1):s[i]?(o=$(a).insertAfter(s[i]),l=i):(o=$(a).appendTo(h.$stateList),l=h.$stateList.length-1):(o=$(a).appendTo(h.$stateList),l=h.$stateList.length-1),h.bindStateListEvent(o),h.refreshStateViewList(o),u=h.$stateList.find(".state-item"),u.length&&(h.$haveStateContainer.show(),h.$noStateContainer.hide()),l},keyEvent:function(e){var t,n,r,i,s,o,u,a,f,l,c;c=this;if($(".sub-stateeditor").css("display")==="none")return!0;l=e.data.target,a=l.currentState,r=a==="appedit"||a==="stack",f=e.target.tagName.toLowerCase(),i=f==="input"||f==="textarea",s=e.which,o=e.ctrlKey||e.metaKey,u=e.shiftKey,t=e.altKey;if(o&&u===!1&&t===!1&&s===90&&r)return l.undoManager.undo(),!1;if(o&&u===!1&&t===!1&&s===89&&r)return l.undoManager.redo(),!1;if(o&&u===!1&&t===!1&&s===67&&i===!1&&r)return l.copyState.call(l,e),!1;o&&u===!1&&t===!1&&s===86&&r&&i===!1&&l.pasteState.call(l,e);if(o&&u===!1&&t===!1&&s===69)return l.onTextParaExpandClick.call(l,e),!1;if(o&&(s===46||s===8)&&u===!1&&t===!1&&r)return l.removeState.call(l,e),!1;if(o&&u===!1&&t===!1&&s===13&&r)return l.addStateItem.call(l,e),!1;if(o&&u===!1&&t===!1&&s===40&&r)return l.moveState.call(l,"down"),!1;if(o&&u===!1&&t===!1&&s===38&&r)return l.moveState.call(l,"up"),!1;if(o===!1&&u===!1&&t===!1&&s===27)return l.collapseItem.call(l,$(".state-list .focused")),$("#modal-state-text-expand").is(":visible")?(l.saveStateTextEditorContent(),!1):!1;if(o&&u===!1&&t===!1&&s===73)return l.onDescToggleClick(l,e),!1;if(o&&u===!1&&t===!1&&s===76&&a!=="stack")return l.onLogToggleClick(l,e),!1;if(o&&u===!1&&t===!1&&s===65&&r)return l.selectAll(l,e),!1;if(o&&u===!1&&t===!1&&s===68&&r)return l.unSelectAll(l,e),!1;if(s===9&&u&&o===!1)return l.onSwitchState.call(l,!0),!1;if(o===!1&&u===!1&&s===38)return l.switchFocus.call(l,!0),!1;if(o===!1&&u===!1&&s===40)return l.switchFocus.call(l),!1;if(o===!1&&u===!1&&s===32&&i===!1&&r)return l.toggleSelected.call(l),!1;if(o===!1&&u===!1&&s===13)return n=$("#state-editor .state-item.focused"),n[0]!==null&&n.hasClass("view")===!0&&l.expandItem.call(l,n),$(e.target).parent().hasClass("text")===!0?!0:!1;if(o===!1&&u===!1&&s===9)return l.onSwitchState.call(l),!1;if(o===!1&&u===!1&&s===80&&i===!1)return $canvas.trigger("SHOW_PROPERTY_PANEL"),!1;if(o===!1&&u===!1&&s===83&&i===!1)return $canvas.trigger("SHOW_STATE_EDITOR"),!1},onUndo:function(){var e;return e=this,e.undoManager.undo(),!1},onRedo:function(){var e;return e=this,e.undoManager.redo(),!1},copyState:function(){var e,t;return t=this,e=[],$(".state-list .selected").each(function(){return e.push(t.getStateItemByData($(this)))}),e.length&&(MC.data.stateClipboard=e,t.updateToolbar(),notification("info",n.ide.NOTIFY_MSG_INFO_STATE_COPY_TO_CLIPBOARD)),!0},copyAllState:function(){var e,t;return t=this,e=[],$(".state-list .state-item").each(function(){return e.push(t.getStateItemByData($(this)))}),MC.data.stateClipboard=e,t.updateToolbar(),notification("info",n.ide.NOTIFY_MSG_INFO_STATE_COPY_TO_CLIPBOARD),!0},moveState:function(e){var t,n,r,i,s,o,u;return u=this,n=$("#state-editor .state-item.focused"),t=$("#state-editor .state-item.focused").index("#state-editor .state-list > li"),e==="down"&&(i=n.next(),i.length>0?(n.insertAfter(i),r=t+1):(n.parent().prepend(n),r=0)),e==="up"&&(s=n.prev(),s.length>0?(n.insertBefore(s),r=t-1):(n.parent().append(n),r=$("#state-editor .state-item").length)),o=n.data("id"),u.undoManager.register(o,t,"sort",r),!1},pasteState:function(){var e,t,n,r;return r=this,e=$("#state-editor .state-item.focused").index("#state-editor .state-list > li"),e===-1&&(e=null),n=r.setNewStateIdForStateAry(MC.data.stateClipboard),t=r.addStateItemByData(n,e),r.undoManager.register(null,t,"paste",n),r.clearSelectedItem(),r.clearFocusedItem(),r.updateToolbar(),!0},removeState:function(){var e;return e=this,e.onRemoveState(null,$(".state-list").find(".selected")),!0},toggleSelected:function(){var e,t;return t=this,e=$("#state-editor .state-item.focused"),e.hasClass("selected")?(e.removeClass("selected"),e.find(".checkbox input").prop("checked",!1)):(e.addClass("selected"),e.find(".checkbox input").prop("checked",!0)),t.updateToolbar(),!1},switchFocus:function(e){var t,n,r,i,s,o;return s=this,t=0,n=$("#state-editor .state-item"),o=n.length,t=$("#state-editor .state-item.focused").index("#state-editor .state-list > li"),s.clearFocusedItem(),e&&e===!0?(t>0&&(r=t-1),t<1&&(r=o-1)):t+1<o?r=t+1:r=0,i=n.eq(r),i.addClass("focused"),s.justScrollToElem(s.$stateList,i),!1},onSwitchState:function(e){var t,n,r,i,s,o;return s=this,t=0,n=$("#state-editor .state-item"),o=n.length,t=$("#state-editor .state-item.focused").index("#state-editor .state-list > li"),s.clearFocusedItem(),e&&e===!0?(t>0&&(r=t-1),t<1&&(r=o-1)):t+1<o?r=t+1:r=0,i=n.eq(r),s.expandItem.call(this,i.addClass("focused")),!1},aceTabSwitch:function(e,t){var n,r,i,s,o;return s=this,s.currentState==="app"?(s.onSwitchState.call(this,e),!1):(n=$(t),r=0,n.hasClass("command-value")?(i=n.parents(".state-item").find(".parameter-list .ace_editor"),i.length>0&&i.eq(0).find(".ace_text-input").focus()):(i=n.parents(".parameter-list").find(".ace_editor"),o=i.length,$.each(i,function(e,n){if(t===n)return r=e}),r+1<o?i.eq(r+1).find(".ace_text-input").focus():n.parents(".state-item").find(".command-value .ace_text-input").focus()),!1)},aceUTabSwitch:function(e,t){var n,r,i,s,o;return s=this,s.currentState==="app"?(s.onSwitchState.call(this,e),!1):(n=$(t),r=0,n.hasClass("command-value")?(i=n.parents(".state-item").find(".parameter-list .ace_editor"),o=i.length,i.eq(o-1).find(".ace_text-input").focus(),!1):(i=n.parents(".parameter-list").find(".ace_editor"),o=i.length,$.each(i,function(e,n){if(t===n)return r=e}),r>0&&i.eq(r-1).find(".ace_text-input").focus(),r===0&&n.parents(".state-item").find(".command-value .ace_text-input").focus(),!1))},onRemoveState:function(e,t,n){var r,i,s,o;return o=this,o.currentState==="app"?!1:(n||(i=[],s=[],_.each(t,function(e){var t,n,r;return t=$(e),n=t.attr("data-id"),i.push(n),r=t.index(),s.push(r)}),o.undoManager.register(i,s,"remove")),_.each(t,function(e){var t;return t=$(e),o.collapseItem(t),null}),t.remove(),r=o.$stateList.find(".state-item"),r.length?_.each(r,function(e){var t;return t=$(e),t.hasClass("view")||o.expandItem(t),null}):(o.$haveStateContainer.hide(),o.$noStateContainer.show()),o.refreshLogItemNum(),o.updateToolbar(),!1)},checkboxSelect:function(e){var t,n,r;return r=this,t=$(e.currentTarget).find("input"),n=t.parents(".state-item"),n.removeClass("selected"),t.prop("checked")===!1?(t.prop("checked",!0),n.addClass("selected")):t.prop("checked",!1),r.updateToolbar(),!1},selectAll:function(){var e;return e=this,$("#state-editor .state-item").addClass("selected").find(".checkbox input").prop("checked",!0),e.updateToolbar(),!0},unSelectAll:function(){var e;return e=this,$("#state-editor .state-item").removeClass("selected").find(".checkbox input").prop("checked",!1),e.updateToolbar(),!0},onSelectAllClick:function(){var e,t;return t=this,e=$(event.currentTarget).find("input"),e.prop("checked")===!1?(e.prop("checked",!0),t.selectAll.call(this,event)):(e.prop("checked",!1),t.unSelectAll.call(this,event)),!1},onStateItemAddBtnClick:function(e){var t;return t=this,t.onStateItemAddClick(),t.$haveStateContainer.show(),t.$noStateContainer.hide(),!1},updateToolbar:function(){var e,t;return t=this,e=t.$("#state-editor .state-item.selected").length,e>0?(t.$("#state-toolbar-copy, #state-toolbar-delete").show(),t.$("#state-toolbar-copy-all").hide(),t.$("#state-toolbar-copy-count, #state-toolbar-delete-count").text(e)):(t.$("#state-toolbar-copy, #state-toolbar-delete").hide(),t.$("#state-toolbar-copy-all").show()),MC.data.stateClipboard.length>0?t.$("#state-toolbar-paste").removeClass("disabled"):t.$("#state-toolbar-paste").addClass("disabled"),e>0&&e===t.$("#state-editor .state-item").length?t.$("#state-toolbar-selectAll").find("input").prop("checked",!0):t.$("#state-toolbar-selectAll").find("input").prop("checked",!1),!0},onClickBlank:function(e){var t,n;return n=this,t=$(e.target),t.parents(".state-item").length===0&&n.clearFocusedItem(),!1},onPasteGistData:function(e){var t,n,r,i;i=this,n=e.originalEvent.clipboardData.getData("text/plain");try{return r=JSON.parse(n),r=i.setNewStateIdForStateAry(r),i.addStateItemByData(r)}catch(s){return t=s,null}},onStateLogItemHeaderClick:function(e){var t,n;return t=$(e.currentTarget),n=t.parents(".state-log-item"),n.toggleClass("view")},openSysLogModal:function(){var e,t,n;return n=this,t=n.currentResId,e=MC.canvas_data.region,o.GetConsoleOutput({sender:n},$.cookie("usercode"),$.cookie("session_id"),e,t),modal(MC.template.modalInstanceSysLog({instance_id:t,log_content:""},!0)),n.off("EC2_INS_GET_CONSOLE_OUTPUT_RETURN").on("EC2_INS_GET_CONSOLE_OUTPUT_RETURN",function(e){return e.is_error||void 0,n.refreshSysLog(e.resolved_data)}),!1},refreshSysLog:function(e){var t,n;return $("#modal-instance-sys-log .instance-sys-log-loading").hide(),e&&e.output?(n=MC.base64Decode(e.output),t=$("#modal-instance-sys-log .instance-sys-log-content"),t.html(MC.template.convertBreaklines({content:n})),t.show()):$("#modal-instance-sys-log .instance-sys-log-info").show(),modal.position()},onStateLogDetailBtnClick:function(e){var t,n,i,s,o;o=this,t=$(e.currentTarget),n=t.parents(".state-log-item"),i=n.attr("data-state-id");if(i){s=o.stateIdLogContentMap[i];if(s)return modal($.trim(r.stateLogDetailModal({number:s.number,content:s.content})),!0)}},onTextParaExpandClick:function(e){var t,n,r,i,s,o,u,a,f,l,c,h;h=this,t=$(e.target),r=t.parents(".parameter-container").find(".parameter-value"),f=r.data("editor");if(f){n=r.parents(".parameter-item");if(n.hasClass("text"))return l=n.attr("data-para-name"),i=n.parents(".state-item"),o="",c=h.getStateItemByData(i),c&&c.parameter&&c.parameter.path&&(u=c.parameter.path,a=u.split("."),o=a[a.length-1]),s=i.attr("data-command"),h.openStateTextEditor(s,l,o,f)}},openStateTextEditor:function(e,t,n,i){var s,o,u,a;return a=this,u=i.getValue(),modal($.trim(r.stateTextExpandModal({cmd_name:e,para_name:t,read_only:a.readOnlyMode})),!1),$("#modal-state-text-expand").data("origin-editor",i),s=$("#modal-state-text-expand .editable-area"),a.initCodeEditor(s[0],{at:a.resAttrDataAry},{showGutter:!0,isCodeEditor:!0,extName:n}),o=s.data("editor"),o&&(o.setValue(u),o.focus(),o.clearSelection()),$("#modal-state-text-expand-save").off("click").on("click",function(){return a.saveStateTextEditorContent()})},saveStateTextEditorContent:function(){var e,t,n,r,i;i=this;if(i.readOnlyMode)return modal.close();r=$("#modal-state-text-expand").data("origin-editor");if(r)return e=$("#modal-state-text-expand .editable-area"),t=e.data("editor"),n=t.getValue(),r.setValue(n),r.clearSelection(),r.focus(),modal.close()}}),a})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("component/stateeditor/model",["MC","constant","state_model","backbone","jquery","underscore"],function(t,n,r){var i;return i=Backbone.Model.extend({defaults:{compData:null,allCompData:null,stateLogDataAry:[]},initialize:function(){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;S=this,n=Design.instance().get("agent"),h=n.module.repo,p=n.module.tag,d=h+":"+p,g=t.data.state.module[d],w=S.getResPlatformInfo(),y=w.osPlatform,b=w.osPlatformDistro,y==="windows"?S.set("isWindowsPlatform",!0):S.set("isWindowsPlatform",!1),S.set("amiExist",w.amiExist),b?S.set("supportedPlatform",!0):S.set("supportedPlatform",!1),m={},y==="linux"||!b?g.linux&&(m=_.extend(m,g.linux)):y==="windows"&&g.windows&&(m=_.extend(m,g.windows)),g.common&&(m=_.extend(m,g.common)),g.meta&&(m=_.extend(m,g.meta)),i=[],u={},a={},s={},v={},_.each(m,function(t,n){var r,o,f,l;return o=t.distro,l=!1,(!o||o&&e.call(o,b)>=0)&&y==="linux"&&(l=!0),b||(l=!0),t.support=l,i.push({name:n,support:l}),f=t.parameter,u[n]=[],a[n]={},s[n]=t,v[t.module]=n,_.each(f,function(e,t){var r;return r=_.extend(e,{}),r.name=t,r["type_"+r.type]=!0,u[n].push(r),a[n][t]=r,null}),r=u[n],u[n]=S.sortParaList(r,"name"),null}),o=i.sort(function(e,t){if(e.support===t.support)return e.name>t.name?1:e.name<t.name?-1:0;if(e.support===!0)return-1;if(t.support===!0)return 1}),r=S.get("allCompData"),S.set("cmdNameAry",o),S.set("cmdParaMap",u),S.set("cmdParaObjMap",a),S.set("cmdModuleMap",s),S.set("moduleCMDMap",v),S.genStateRefList(r),f=S.get("compData"),E=t.aws.aws.genAttrRefList(f,r),S.set("resAttrDataAry",E),S.genAttrRefRegexList(),c=S.getGroupResSelectData(),S.set("groupResSelectData",c),l=t.canvas.getState(),l==="stack"?S.set("currentState","stack"):l==="app"?S.set("currentState","app"):l==="appedit"&&S.set("currentState","appedit");if(t.canvas_data.state==="Stoped")return S.set("currentAppState","stoped")},sortParaList:function(e,t){var n;return n=e.sort(function(e,n){if(e.required===n.required)return e[t]<n[t]?-1:1;if(e.required)return-1;if(n.required)return 1}),n},getResPlatformInfo:function(){var n,r,i,s,o,u,a,f,l,c;return c=this,r=c.get("compData"),i=r.resource.ImageId,s=t.data.dict_ami[i],a=null,f=null,n=!0,s?(u=s.osFamily,l=s.osType,o=["centos","redhat","rhel","ubuntu","debian","fedora","gentoo","opensuse","suse","sles","amazon","amaz","linux-other"],l==="windows"?a="windows":e.call(o,l)>=0&&(a="linux",f=l)):n=!1,{osPlatform:a,osPlatformDistro:f,amiExist:n}},updateAllStateRef:function(e){var t,r,i,s,o,u,a;return a=this,t=Design.modelClassForType(n.RESTYPE.INSTANCE).allObjects(),r=Design.modelClassForType(n.RESTYPE.LC).allObjects(),u={},_.each(e,function(e,t){var n,r;return n=a.replaceParaNameToUID(t),r=a.replaceParaNameToUID(e),u[n]=r,null}),o=a.get("moduleCMDMap"),i=a.get("cmdParaObjMap"),s=function(e){var t,n;return n=e.getStateData(),t=e.id,n&&n.length>0&&(_.each(n,function(e){var t,n,r,s;s=e.parameter,n=e.module,t=o[n];if(!t)return;r=i[t];if(!r)return;return _.each(s,function(e,t){var n,i;return i=r[t].type,i==="state"&&(n=_.map(e,function(e){return u[e]?u[e]:e}),s[t]=n),null}),null}),e.setStateData(n)),null},_.each(t,s),_.each(r,s),null},setStateData:function(e){var t,n,r;return r=this,t=r.get("compData"),n=r.get("resModel"),n.setStateData(e)},getStateData:function(){var e,t,n,r;r=this,e=r.get("compData"),t=r.get("resModel");if(e){n=t.getStateData();if(_.isArray(n))return n}return null},getResName:function(){var e,t,r;return r=this,t="",e=r.get("compData"),e&&e.name&&(t=e.name),e.type===n.RESTYPE.INSTANCE&&e.serverGroupUid===e.uid&&e.serverGroupName&&(t=e.serverGroupName),t},genStateRefList:function(e){var t,r,i,s,o,u;return u=this,r=_.values(e),o=[],t=u.get("compData"),i=t.uid,s=u.get("moduleCMDMap"),r&&!_.isEmpty(r)&&_.isArray(r)&&_.each(r,function(e){var t,r,u,a;u=e.uid,r=e.type,t=e.name;if(i===u)return;if(r===n.RESTYPE.INSTANCE){if(e.index!==0)return;t=e.serverGroupName}return r===n.RESTYPE.LC&&(t=Design.instance().component(u).parent().get("name")),a=e.state,a&&_.isArray(a)&&_.each(a,function(e,n){var r,i,u;if(e.module!=="meta.comment")return i=String(n+1),u="{"+t+".state."+i+"}",r=s[e.module],o.push({name:u,value:u,meta:r})}),null}),o=o.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),u.set("resStateDataAry",o)},genAttrRefRegexList:function(){var e,t,n,r,i,s;return s=this,e=[],t=s.get("resAttrDataAry"),r=s.get("resStateDataAry"),t||(t=[]),e=_.map(t,function(e){var t;return t=e.name.replace("{","\\{").replace("}","\\}").replace(".","\\.").replace("[","\\[").replace("]","\\]"),"@{"+t+"}"}),i=_.map(r,function(e){var t;return t=e.name.replace("{","\\{").replace("}","\\}").replace(".","\\.").replace("[","\\[").replace("]","\\]"),"@"+t}),e=e.concat(i),n=e.join("|"),s.set("resAttrRegexStr",n)},replaceStateUIDToName:function(e){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;return v=this,r=v.get("allCompData"),f=/@\{([A-Z0-9]{8}-([A-Z0-9]{4}-){3}[A-Z0-9]{12})\.state\.state-([A-Z0-9]{8}-([A-Z0-9]{4}-){3}[A-Z0-9]{12})\}/g,g=/[A-Z0-9]{8}-([A-Z0-9]{4}-){3}[A-Z0-9]{12}/g,u=e.match(f),s=e,u&&u.length&&(a=u[0],m=a.match(g),c=m[0],d="state-"+m[1],i=r[c],l="unknown",h="unknown",i&&(p={},l=i.name,i.type===n.RESTYPE.INSTANCE&&i.number&&i.number>1&&(l=i.serverGroupName),i.type===n.RESTYPE.LC&&_.each(r,function(e){var r,i;return e.type===n.RESTYPE.ASG&&(i=e.resource.LaunchConfigurationName,i&&(r=t.extractID(i),r===c&&(l=e.name))),null}),i.state&&_.isArray(i.state)&&_.each(i.state,function(e,t){return e.id===d&&(h=t+1),null})),o=a.replace(c,l).replace(d,h),s=s.replace(a,o)),s},replaceStateNameToUID:function(e){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;return g=this,r=g.get("allCompData"),h=/@\{([\w-]+)\.state\.\d+\}/g,l=e.match(h),a=e,l&&l.length&&(c=l[0],p=c.replace("@{","").split(".")[0],d=g.getUIDByResName(p),v=Number(c.replace("}","").split(".")[2]),m="",s=null,d&&_.isNumber(v)&&(i=r[d],i.type===n.RESTYPE.ASG&&(u=i.resource.LaunchConfigurationName,u&&(o=t.extractID(u),d=o,s=r[o])),s&&(i=s),i.state&&_.isArray(i.state)&&i.state[v-1]&&(m=i.state[v-1].id)),d&&m&&(f=c.replace(p,d).replace(".state."+v,".state."+m),a=a.replace(c,f))),a},replaceParaUIDToName:function(e){var t,r,i,s,o,u,a,f;return a=this,r=a.get("compData"),i=r.uid,t=a.get("allCompData"),u=/@\{([A-Z0-9]{8}-([A-Z0-9]{4}-){3}[A-Z0-9]{12})(\.(\w+(\[\d+\])*))+\}/g,f=/[A-Z0-9]{8}-([A-Z0-9]{4}-){3}[A-Z0-9]{12}/,o=e.match(u),s=e,_.each(o,function(e){var r,i,o,u,a;return a=e.match(f),u=a[0],r=t[u],r?(o=r.name,r.type===n.RESTYPE.INSTANCE&&r.number&&r.number>1&&(o=r.serverGroupName)):o="unknown",i=e.replace(u,o),s=s.replace(e,i),null}),s},replaceParaNameToUID:function(e){var t,r,i,s,o;return o=this,t=o.get("allCompData"),s=n.REGEXP.stateEditorOriginReference,i=e.match(s),r=e,_.each(i,function(e){var t,n,i;return n=e.replace("@{","").split(".")[0],n!=="self"&&(i=o.getUIDByResName(n),i&&(t=e.replace(n,i),r=r.replace(e,t))),null}),r},getUIDByResName:function(e){var t,r,i,s,o;return o=this,r=o.get("compData"),i=r.uid,t=o.get("allCompData"),s="",$.each(t,function(t,r){return r.type===n.RESTYPE.INSTANCE&&r.number&&r.number>1&&r.serverGroupName===e?(s=t,!1):(r.name===e&&(s=t),null)}),s},getResState:function(e){var n,r,i,s;return s=this,n=t.canvas_data.region,r=t.data.resource_list[n][e],i="unknown",r&&r.instanceState&&r.instanceState.name&&(i=r.instanceState.name),s.set("resState",i),null},genStateLogData:function(e,n){var i,s,o,u,a,f,l;l=this,s=t.canvas_data.id;if(!s||!e){l.set("stateLogDataAry",[]),n();return}return u=l.get("resModel"),a=u.getStateData(),f={},o=_.map(a,function(e,t){return f[e.id]=t,{id:e.id,result:"pending"}}),i="pending",r.log({sender:l},$.cookie("usercode"),$.cookie("session_id"),s,e),l.off("STATE_LOG_RETURN"),l.on("STATE_LOG_RETURN",function(e){var t,r,s;if(!e.is_error){r=e.resolved_data,r&&r[0]&&(s=r[0],s.agent_status&&(i=s.agent_status),t=s.status,t&&_.isArray(t)&&_.each(t,function(e){var t;t=f[e.id],_.isNumber(t)&&(o[t]=e)})),o.unshift({id:"Agent",result:i}),l.set("stateLogDataAry",o),l.set("agentStatus",i);if(n)return n()}})},getCurrentResUID:function(){var e,t,n;return n=this,e=n.get("compData"),t=e.uid,t},getGroupResSelectData:function(){var e,n,r,i,s,o;return o=this,n=o.get("compData"),e=o.get("allCompData"),s="",i=n.uid,n.type==="AWS.EC2.Instance"&&(s=n.serverGroupUid),r=[],_.each(e,function(e){var o,u,a,f,l,c,h;return u=e.type,a=e.uid,u==="AWS.EC2.Instance"&&n.type===u&&(f=e.serverGroupUid,a===i?(c=e.resource.InstanceId,h=e.name,r.push({res_id:c,res_name:h})):s&&f&&a!==s&&f===s&&(c=e.resource.InstanceId,r.push({res_id:c,res_name:e.name}))),u==="AWS.AutoScaling.Group"&&n.type==="AWS.AutoScaling.LaunchConfiguration"&&(o=e.resource.AutoScalingGroupName,l=t.extractID(e.resource.LaunchConfigurationName),l===i&&$.each(t.data.resource_list[t.canvas_data.region],function(e,t){if(t&&t.AutoScalingGroupName&&t.Instances&&t.AutoScalingGroupName===o)return $.each(t.Instances.member,function(e,t){var n;return n=t.InstanceId,r.push({res_id:n,res_name:n})})})),null}),r}}),i})}.call(this),function(){define("component/stateeditor/stateeditor",["event","./view","./model","./lib/ace","UI.modal","jquerysort"],function(e,t,n){var r,i;return r=function(r,i,s,o){var u,a,f,l;return u=r[i],f=Design.instance().component(i),u?a=new n({compData:u,resModel:f,resId:s,allCompData:r}):a=new Backbone.Model,l=new t({model:a}),l.model=a,e.offListen(e.UPDATE_STATE_STATUS_DATA_TO_EDITOR),e.onLongListen(e.UPDATE_STATE_STATUS_DATA_TO_EDITOR,function(e){return l.onStateStatusUpdate(e)}),e.offListen(e.STATE_EDITOR_SAVE_DATA),e.onLongListen(e.STATE_EDITOR_SAVE_DATA,function(e){return l.onMouseDownSaveFromOther(e)}),o||$("#property-panel").addClass("state"),$("#property-panel .sub-stateeditor").html(l.render().el)},i=function(t,n){var r;void 0;try{t.off(),n.off(),t.undelegateEvents(),modal.close(),t=null,n=null,e.offListen(e.UPDATE_STATE_STATUS_DATA_TO_EDITOR)}catch(i){r=i}},{loadModule:r,unLoadModule:i}})}.call(this);