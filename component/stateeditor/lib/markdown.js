define([],function(){function t(e){return e}function n(e){return!1}function r(){}function i(){}var e={};return r.prototype={chain:function(e,n){var r=this[e];if(!r)throw new Error("unknown hook "+e);r===t?this[e]=n:this[e]=function(e){var t=Array.prototype.slice.call(arguments,0);return t[0]=r.apply(null,t),n.apply(null,t)}},set:function(e,t){if(!this[e])throw new Error("unknown hook "+e);this[e]=t},addNoop:function(e){this[e]=t},addFalse:function(e){this[e]=n}},e.HookCollection=r,i.prototype={set:function(e,t){this["s_"+e]=t},get:function(e){return this["s_"+e]}},e.Converter=function(){function a(e){return e=e.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?(?=\s|$)[ \t]*\n?[ \t]*((\n*)["(](.+?)[")][ \t]*)?(?:\n+)/gm,function(e,t,r,i,o,u){return t=t.toLowerCase(),n.set(t,M(r)),o?i:(u&&s.set(t,u.replace(/"/g,"&quot;")),"")}),e}function f(e){var t="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del",n="p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math";return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,l),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,l),e=e.replace(/\n[ ]{0,3}((<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,l),e=e.replace(/\n\n[ ]{0,3}(<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>[ \t]*(?=\n{2,}))/g,l),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,l),e}function l(e,t){var n=t;return n=n.replace(/^\n+/,""),n=n.replace(/\n+$/g,""),n="\n\n~K"+(o.push(n)-1)+"K\n\n",n}function h(e,n){e=t.preBlockGamut(e,c),e=w(e);var r="<hr />\n";return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?-[ ]?){3,}[ \t]*$/gm,r),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,r),e=E(e),e=T(e),e=A(e),e=t.postBlockGamut(e,c),e=f(e),e=O(e,n),e}function p(n){return n=t.preSpanGamut(n),n=C(n),n=d(n),n=_(n),n=g(n),n=v(n),n=F(n),n=n.replace(/~P/g,"://"),n=M(n),n=e._DoItalicsAndBold?e._DoItalicsAndBold(n):L(n),n=n.replace(/  +\n/g," <br>\n"),n=t.postSpanGamut(n),n}function d(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--(?:|(?:[^>-]|-[^>])(?:[^-]|-[^-])*)--)>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=W(t,e.charAt(1)=="!"?"\\`*_/":"\\`*_"),t}),e}function v(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,m),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?((?:\([^)]*\)|[^()\s])*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,m),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,m),e}function m(e,t,r,i,o,u,a,f){f==undefined&&(f="");var l=t,c=r.replace(/:\/\//g,"~P"),h=i.toLowerCase(),p=o,d=f;if(p==""){h==""&&(h=c.toLowerCase().replace(/ ?\n/g," ")),p="#"+h;if(n.get(h)!=undefined)p=n.get(h),s.get(h)!=undefined&&(d=s.get(h));else{if(!(l.search(/\(\s*\)$/m)>-1))return l;p=""}}p=z(p),p=W(p,"*_");var v='<a href="'+p+'"';return d!=""&&(d=y(d),d=W(d,"*_"),v+=' title="'+d+'"'),v+=">"+c+"</a>",v}function g(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,b),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,b),e}function y(e){return e.replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}function b(e,t,r,i,o,u,a,f){var l=t,c=r,h=i.toLowerCase(),p=o,d=f;d||(d="");if(p==""){h==""&&(h=c.toLowerCase().replace(/ ?\n/g," ")),p="#"+h;if(n.get(h)==undefined)return l;p=n.get(h),s.get(h)!=undefined&&(d=s.get(h))}c=W(y(c),"*_[]()"),p=W(p,"*_");var v='<img src="'+p+'" alt="'+c+'"';return d=y(d),d=W(d,"*_"),v+=' title="'+d+'"',v+=" />",v}function w(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return"<h1>"+p(t)+"</h1>\n\n"}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return"<h2>"+p(t)+"</h2>\n\n"}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,n){var r=t.length;return"<h"+r+">"+p(n)+"</h"+r+">\n\n"}),e}function E(e,t){e+="~0";var n=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return u?e=e.replace(n,function(e,n,r){var i=n,s=r.search(/[*+-]/g)>-1?"ul":"ol",o=x(i,s,t);return o=o.replace(/\s+$/,""),o="<"+s+">"+o+"</"+s+">\n",o}):(n=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(n,function(e,t,n,r){var i=t,s=n,o=r.search(/[*+-]/g)>-1?"ul":"ol",u=x(s,o);return u=i+"<"+o+">\n"+u+"</"+o+">\n",u})),e=e.replace(/~0/,""),e}function x(e,t,n){u++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var r=S[t],i=new RegExp("(^[ \\t]*)("+r+")[ \\t]+([^\\r]+?(\\n+))(?=(~0|\\1("+r+")[ \\t]+))","gm"),s=!1;return e=e.replace(i,function(e,t,r,i){var o=i,u=t,a=/\n\n$/.test(o),f=a||o.search(/\n{1,}/)>-1;return f||s?o=h(q(o),!0):(o=E(q(o),!0),o=o.replace(/\n$/,""),n||(o=p(o))),s=a,"<li>"+o+"</li>\n"}),e=e.replace(/~0/g,""),u--,e}function T(e){return e+="~0",e=e.replace(/(?:\n\n|^\n?)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var r=t,i=n;return r=k(q(r)),r=R(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>","\n\n"+r+"\n\n"+i}),e=e.replace(/~0/,""),e}function N(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(o.push(e)-1)+"K\n\n"}function C(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,r,i){var s=r;return s=s.replace(/^([ \t]*)/g,""),s=s.replace(/[ \t]*$/g,""),s=k(s),s=s.replace(/:\/\//g,"~P"),t+"<code>"+s+"</code>"}),e}function k(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=W(e,"*_{}[]\\",!1),e}function L(e){return e=e.replace(/([\W_]|^)(\*\*|__)(?=\S)([^\r]*?\S[\*_]*)\2([\W_]|$)/g,"$1<strong>$3</strong>$4"),e=e.replace(/([\W_]|^)(\*|_)(?=\S)([^\r\*_]*?\S)\2([\W_]|$)/g,"$1<em>$3</em>$4"),e}function A(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=h(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /mg,"~0"),n=n.replace(/~0/g,""),n}),N("<blockquote>\n"+n+"\n</blockquote>")}),e}function O(e,t){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");var n=e.split(/\n{2,}/g),r=[],i=/~K(\d+)K/,s=n.length;for(var u=0;u<s;u++){var a=n[u];i.test(a)?r.push(a):/\S/.test(a)&&(a=p(a),a=a.replace(/^([ \t]*)/g,"<p>"),a+="</p>",r.push(a))}if(!t){s=r.length;for(var u=0;u<s;u++){var f=!0;while(f)f=!1,r[u]=r[u].replace(/~K(\d+)K/g,function(e,t){return f=!0,o[t]})}}return r.join("\n\n")}function M(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?!]|~D)/gi,"&lt;"),e}function _(e){return e=e.replace(/\\(\\)/g,X),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,X),e}function j(e,t,n,r){if(t)return e;if(r.charAt(r.length-1)!==")")return"<"+n+r+">";var i=r.match(/[()]/g),s=0;for(var o=0;o<i.length;o++)i[o]==="("?s<=0?s=1:s++:s--;var u="";if(s<0){var a=new RegExp("\\){1,"+ -s+"}$");r=r.replace(a,function(e){return u=e,""})}if(u){var f=r.charAt(r.length-1);B.test(f)||(u=f+u,r=r.substr(0,r.length-1))}return"<"+n+r+">"+u}function F(e){e=e.replace(H,j);var n=function(e,n){return'<a href="'+n+'">'+t.plainLinkText(n)+"</a>"};return e=e.replace(/<((https?|ftp):[^'">\s]+)>/gi,n),e}function I(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)}),e}function q(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,""),e}function R(e){if(!/\t/.test(e))return e;var t=["    ","   ","  "," "],n=0,r;return e.replace(/[\n\t]/g,function(e,i){return e==="\n"?(n=i+1,e):(r=(i-n)%4,n=i+1,t[r])})}function z(e){if(!e)return"";var t=e.length;return e.replace(U,function(e,t){return e=="~D"?"%24":e==":"?":":"%"+e.charCodeAt(0).toString(16)})}function W(e,t,n){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(r="\\\\"+r);var i=new RegExp(r,"g");return e=e.replace(i,X),e}function X(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}var e={};this.setOptions=function(t){e=t};var t=this.hooks=new r;t.addNoop("plainLinkText"),t.addNoop("preConversion"),t.addNoop("postNormalization"),t.addNoop("preBlockGamut"),t.addNoop("postBlockGamut"),t.addNoop("preSpanGamut"),t.addNoop("postSpanGamut"),t.addNoop("postConversion");var n,s,o,u;this.makeHtml=function(e){if(n)throw new Error("Recursive call to converter.makeHtml");return n=new i,s=new i,o=[],u=0,e=t.preConversion(e),e=e.replace(/~/g,"~T"),e=e.replace(/\$/g,"~D"),e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),e="\n\n"+e+"\n\n",e=R(e),e=e.replace(/^[ \t]+$/mg,""),e=t.postNormalization(e),e=f(e),e=a(e),e=h(e),e=I(e),e=e.replace(/~D/g,"$$"),e=e.replace(/~T/g,"~"),e=t.postConversion(e),o=s=n=null,e};var c=function(e){return h(e)},S={ol:"\\d+[.]",ul:"[*+-]"},D="[-A-Z0-9+&@#/%?=~_|[\\]()!:,.;]",P="[-A-Z0-9+&@#/%=~_|[\\])]",H=new RegExp('(="|<)?\\b(https?|ftp)(://'+D+"*"+P+")(?=$|\\W)","gi"),B=new RegExp(P,"i"),U=/(?:["'*()[\]:]|~D)/g},e});