define("component/appactions/template",["handlebars"],function(e){var t,n={};return t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='<div class="modal-center-align-helper">\n    <div class="modal-text-major">'+a((o=t&&t.msg,typeof o===u?o.apply(t):o))+"</div>\n</div>",s},n.removeStackConfirm=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="";return r+="\n            <li>\n                "+u(n.i18n.call(e,"TOOLBAR.POP_START_CONFIRM_LIST_1",{hash:{},data:t}))+"\n            </li>\n        ",r}function c(e,t){var r="";return r+="\n            <li>\n                "+u(n.i18n.call(e,"TOOLBAR.POP_START_CONFIRM_LIST_2",{hash:{},data:t}))+"\n            </li>\n        ",r}function h(e,t){var r="";return r+="\n            <li>\n                "+u(n.i18n.call(e,"TOOLBAR.POP_START_CONFIRM_LIST_3",{hash:{},data:t}))+"\n            </li>\n        ",r}function p(e,t){var r="",i;r+='\n        <div class="modal-shrink">\n            <div class="sub-gray">'+u(n.i18n.call(e,"TOOLBAR.POP_START_WARNNING",{hash:{},data:t}))+'</div>\n            <div class="error">\n                '+u(n.i18n.call(e,"TOOLBAR.POP_START_MISSING_SNAPSHOT_1",{hash:{},data:t}))+" ",i=n.each.call(e,e&&e.lostDBSnapshot,{hash:{},inverse:a.noop,fn:a.program(8,d,t),data:t});if(i||i===0)r+=i;return r+=" "+u(n.i18n.call(e,"TOOLBAR.POP_START_MISSING_SNAPSHOT_2",{hash:{},data:t}))+"\n            </div>\n        </div>\n    ",r}function d(e,t){var r="",i;i=n["if"].call(e,e&&e.index,{hash:{},inverse:a.noop,fn:a.program(9,v,t),data:t});if(i||i===0)r+=i;return r+=u((i=e&&e.name,typeof i===f?i.apply(e):i)),r}function v(e,t){return", "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a=this,f="function";s+='<div class="modal-center-align-helper">\n    <div class="modal-text-major">'+u(n.i18n.call(t,"TOOLBAR.POP_BODY_START_APP",{hash:{},data:i}))+'</div>\n    <ul class="modal-list-items">\n        ',o=n["if"].call(t,t&&t.hasEC2Instance,{hash:{},inverse:a.noop,fn:a.program(1,l,i),data:i});if(o||o===0)s+=o;s+="\n        ",o=n["if"].call(t,t&&t.hasDBInstance,{hash:{},inverse:a.noop,fn:a.program(3,c,i),data:i});if(o||o===0)s+=o;s+="\n        ",o=n["if"].call(t,t&&t.hasASG,{hash:{},inverse:a.noop,fn:a.program(5,h,i),data:i});if(o||o===0)s+=o;s+="\n    </ul>\n    ",o=n["if"].call(t,(o=t&&t.lostDBSnapshot,o==null||o===!1?o:o.length),{hash:{},inverse:a.noop,fn:a.program(7,p,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s},n.startAppConfirm=e.template(t),t=function(e,t,n,r,i){function f(e,t){var r="",i;return r+='\n    <div style="padding: 20px">\n        <p><b style="color:#ec3c38;">'+u((i=e&&e.appName,typeof i===o?i.apply(e):i))+" "+u(n.i18n.call(e,"POP_CONFIRM_PROD_APP_WARNING_MSG",{hash:{},data:t}))+"</b>"+u(n.i18n.call(e,"POP_CONFIRM_TERMINATE_PROD_APP_MSG",{hash:{},data:t}))+" "+u(n.i18n.call(e,"POP_CONFIRM_STOP_ASG",{hash:{},data:t}))+"</p>\n        <p>"+u(n.i18n.call(e,"POP_CONFIRM_STOP_PROD_APP_INPUT_LBL",{hash:{},data:t}))+'</p>\n        <div><input class="input" style="width:351px;" id="appNameConfirmIpt"/></div>\n    </div>\n',r}function l(e,t){var r="",i;r+='\n    <div class="modal-center-align-helper" style="padding: 20px">\n        <div class="modal-text-major">'+u(n.i18n.call(e,"TOOLBAR.POP_BODY_STOP_APP_LEFT",{hash:{},data:t}))+" "+u((i=e&&e.appName,typeof i===o?i.apply(e):i))+" "+u(n.i18n.call(e,"TOOLBAR.POP_BODY_STOP_APP_RIGHT",{hash:{},data:t}))+'</div>\n        <ul class="modal-list-items">\n            ',i=n["if"].call(e,e&&e.hasEC2Instance,{hash:{},inverse:a.noop,fn:a.program(4,c,t),data:t});if(i||i===0)r+=i;r+="\n            ",i=n["if"].call(e,e&&e.hasDBInstance,{hash:{},inverse:a.noop,fn:a.program(7,p,t),data:t});if(i||i===0)r+=i;r+="\n            ",i=n["if"].call(e,e&&e.hasAsg,{hash:{},inverse:a.noop,fn:a.program(9,d,t),data:t});if(i||i===0)r+=i;return r+="\n        </ul>\n    </div>\n",r}function c(e,t){var r="",i;r+="\n                <li>\n                    "+u(n.i18n.call(e,"TOOLBAR.POP_STOP_CONFIRM_LIST_1",{hash:{},data:t}))+"\n                    ",i=n["if"].call(e,e&&e.hasInstanceStore,{hash:{},inverse:a.noop,fn:a.program(5,h,t),data:t});if(i||i===0)r+=i;return r+="\n                </li>\n            ",r}function h(e,t){var r="";return r+='<span class="error">'+u(n.i18n.call(e,"TOOLBAR.POP_STOP_CONFIRM_LIST_1_SPAN",{hash:{},data:t}))+"</span>",r}function p(e,t){var r="";return r+="\n                <li>\n                    "+u(n.i18n.call(e,"TOOLBAR.POP_STOP_CONFIRM_LIST_2",{hash:{},data:t}))+"\n                    <span>"+u(n.i18n.call(e,"TOOLBAR.POP_STOP_CONFIRM_LIST_2_SPAN",{hash:{},data:t}))+"</span>\n                </li>\n            ",r}function d(e,t){var r="";return r+="\n                <li>\n                    "+u(n.i18n.call(e,"TOOLBAR.POP_STOP_CONFIRM_LIST_3",{hash:{},data:t}))+"\n                    <span>"+u(n.i18n.call(e,"TOOLBAR.POP_STOP_CONFIRM_LIST_3_SPAN",{hash:{},data:t}))+"</span>\n                </li>\n            ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s,o="function",u=this.escapeExpression,a=this;return s=n["if"].call(t,t&&t.isProduction,{hash:{},inverse:a.program(3,l,i),fn:a.program(1,f,i),data:i}),s||s===0?s:""},n.stopAppConfirm=e.template(t),t=function(e,t,n,r,i){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{},'<div class="loading-spinner"></div>'},n.loading=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;i=n["if"].call(e,t==null||t===!1?t:t.index,{hash:{},inverse:u.noop,fn:u.program(2,c,t),data:t});if(i||i===0)r+=i;return r+=f((i=(i=e&&e.attributes,i==null||i===!1?i:i.DBInstanceIdentifier),typeof i===a?i.apply(e):i))+'(<span class="db-stop-status">'+f((i=(i=e&&e.attributes,i==null||i===!1?i:i.DBInstanceStatus),typeof i===a?i.apply(e):i))+"</span>)",r}function c(e,t){return", "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this,a="function",f=this.escapeExpression;s+="<p>DB Instance\n    ",o=n.each.call(t,t&&t.cantStop,{hash:{},inverse:u.noop,fn:u.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n    "+f(n.i18n.call(t,"TOOLBAR.POP_CANT_STOP_1",{hash:{},data:i}))+"</p>\n<p>"+f(n.i18n.call(t,"TOOLBAR.POP_CANT_STOP_2",{hash:{},data:i}))+"</p>",s},n.cantStop=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="",i;return r+='\n        <p><b style="color:#ec3c38;">'+a((i=e&&e.name,typeof i===u?i.apply(e):i))+" "+a(n.i18n.call(e,"POP_CONFIRM_PROD_APP_WARNING_MSG",{hash:{},data:t}))+"</b>"+a(n.i18n.call(e,"POP_CONFIRM_TERMINATE_PROD_APP_MSG",{hash:{},data:t}))+"</p>\n        <p>"+a(n.i18n.call(e,"POP_CONFIRM_TERMINATE_PROD_APP_INPUT_LBL",{hash:{},data:t}))+'</p>\n        <div><input class="input" style="width:390px;" id="appNameConfirmIpt"/></div>\n    ',r}function c(e,t){var r="";return r+='\n        <div class="modal-center-align-helper"><div class="modal-text-major">'+a(n.i18n.call(e,"TOOLBAR.POP_BODY_TERMINATE_APP_LEFT",{hash:{},data:t}))+a(n.i18n.call(e,"TOOLBAR.POP_BODY_TERMINATE_APP_RIGHT",{hash:{},data:t}))+"</div></div>\n    ",r}function h(e,t){var r="",i;r+='\n        <section class="check-final-snapshot checkbox-wrap">\n            <div class="checkbox">\n                <input id="take-rds-snapshot" type="checkbox" checked="checked" name="dns-resolution">\n                <label for="take-rds-snapshot"></label>\n            </div>\n            <label for="take-rds-snapshot">'+a(n.i18n.call(e,"TOOLBAR.POP_TAKE_DB_SNAPSHOT",{hash:{},data:t}))+"</label>\n        </section>\n        ",i=n["if"].call(e,(i=e&&e.notReadyDB,i==null||i===!1?i:i.length),{hash:{},inverse:f.noop,fn:f.program(6,p,t),data:t});if(i||i===0)r+=i;return r+="\n    ",r}function p(e,t){var r="",i;r+='\n            <p class="cant-snapshot">'+a(n.i18n.call(e,"TOOLBAR.POP_CANT_TAKE_SNAPSHOT_1",{hash:{},data:t}))+"\n                ",i=n.each.call(e,e&&e.notReadyDB,{hash:{},inverse:f.noop,fn:f.program(7,d,t),data:t});if(i||i===0)r+=i;return r+="\n                "+a(n.i18n.call(e,"TOOLBAR.POP_CANT_TAKE_SNAPSHOT_2",{hash:{},data:t}))+"</p>\n        ",r}function d(e,t){var r="",i;i=n["if"].call(e,t==null||t===!1?t:t.index,{hash:{},inverse:f.noop,fn:f.program(8,v,t),data:t});if(i||i===0)r+=i;return r+='<span class="resource-tag">'+a((i=(i=e&&e.attributes,i==null||i===!1?i:i.DBInstanceIdentifier),typeof i===u?i.apply(e):i))+'</span>(<span class="db-stop-status">'+a((i=(i=e&&e.attributes,i==null||i===!1?i:i.DBInstanceStatus),typeof i===u?i.apply(e):i))+"</span>)",r}function v(e,t){return", "}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="confirm-padding">\n    ',o=n["if"].call(t,t&&t.production,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+="\n    ",o=n["if"].call(t,(o=t&&t.hasDBInstance,o==null||o===!1?o:o.length),{hash:{},inverse:f.noop,fn:f.program(5,h,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s},n.terminateAppConfirm=e.template(t),t=function(e,t,n,r,i){function l(e,t){var r="";return r+='\n        <div class="modal-center-align-helper"> <div class="modal-text-major">'+u(n.i18n.call(e,"TOOLBAR.FORGET_VISUALOPS_CANT",{hash:{},data:t}))+"</div></div>\n    ",r}function c(e,t){var r="",i;r+="\n        ",i=n["if"].call(e,e&&e.production,{hash:{},inverse:f.program(6,p,t),fn:f.program(4,h,t),data:t});if(i||i===0)r+=i;return r+="\n    ",r}function h(e,t){var r="",i;return r+='\n            <p><b style="color:#ec3c38;">'+u((i=e&&e.name,typeof i===a?i.apply(e):i))+" "+u(n.i18n.call(e,"POP_CONFIRM_PROD_APP_WARNING_MSG",{hash:{},data:t}))+"</b>"+u(n.i18n.call(e,"TOOLBAR.FORGET_CONFIRM_INSTRUCTION",{hash:{},data:t}))+"</p>\n            <p>"+u(n.i18n.call(e,"POP_CONFIRM_TERMINATE_PROD_APP_INPUT_LBL",{hash:{},data:t}))+'</p>\n            <div><input class="input" style="width:390px;" id="appNameConfirmIpt"/></div>\n        ',r}function p(e,t){var r="";return r+='\n            <div class="modal-center-align-helper"> <div class="modal-text-major">'+u(n.i18n.call(e,"TOOLBAR.FORGET_APP_CONFIRM",{hash:{},data:t}))+"</div></div>\n        ",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u=this.escapeExpression,a="function",f=this;s+='<div class="confirm-padding">\n    ',o=n["if"].call(t,t&&t.hasState,{hash:{},inverse:f.program(3,c,i),fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;return s+="\n</div>",s},n.forgetAppConfirm=e.template(t),t=function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o=this.escapeExpression;return s+='<section class="disconnected-msg">\n    <div>'+o(n.i18n.call(t,"TOOLBAR.CONNECTION_LOST_TO_RECONNECT",{hash:{},data:i}))+"</div>\n    <div>"+o(n.i18n.call(t,"TOOLBAR.CHANGES_MAY_NOT_BE_SAVED",{hash:{},data:i}))+"</div>\n</section>",s},n.disconnectedMsg=e.template(t),n}),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("AppAction",["backbone","component/appactions/template","ThumbnailUtil","i18n!/nls/lang.js","CloudResources","constant","UI.modalplus","ApiRequest","kp_dropdown","OsKp","TaGui","OpsModel","credentialFormView"],function(t,n,r,i,s,o,u,a,f,l,c,h,p){return t.View.extend({initialize:function(e){return _.extend(this,e)},credentialId:function(){return Design.instance()?Design.instance().credentialId():this.model.project().credIdOfProvider(this.model.get("provider"))},runStack:function(e,t){var n,r,s,o,a,f,l,d,v;return s=this.workspace.opsModel.type,d=this,f=this.workspace.opsModel.project().get("billingState"),t?(this.modal=t,this.modal.setTitle(i.IDE.RUN_STACK_MODAL_TITLE).setWidth("665px").setContent(MC.template.modalRunStack({paymentState:f,paymentUpdate:e})).compact().find(".modal-footer").show()):(this.modal=new u({title:i.IDE.RUN_STACK_MODAL_TITLE,template:MC.template.modalRunStack({paymentState:f,paymentUpdate:e}),disableClose:!0,width:"665px",compact:!0,confirm:{text:Design.instance().project().isDemoMode()?i.IDE.RUN_STACK_MODAL_NEED_CREDENTIAL:i.IDE.RUN_STACK_MODAL_CONFIRM_BTN,disabled:!0}}),this.renderKpDropdown(this.modal,s)),s===h.Type.OpenStack&&(this.modal.find(".estimate").hide(),this.modal.resize()),o=Design.instance().getCost(),this.modal.find(".modal-input-value").val(this.workspace.opsModel.get("name")),a="$"+o.totalFee,(v=Design.instance().region())==="cn-north-1"&&(a="￥"+o.totalFee),this.modal.find("#label-total-fee").find("b").text(a),this.modal.find("#label-visualops-fee").find("b").text("$"+o.visualOpsFee),c.loadModule("stack").then(function(e){return function(){var t;return e.modal.resize(),(t=e.modal)!=null?t.toggleConfirm(!1):void 0}}(this)),n=this.modal.tpl.find("#app-name"),r=this.checkAppNameRepeat.bind(this),n.keyup(function(){return r(n.val())}),l=this,this.modal.on("confirm",function(e){return function(){var t;return e.hideError(),Design.instance().project().isDemoMode()?(Design.instance().project().amIAdmin()?(new p({model:Design.instance().project()})).render():l.modal.find(".modal-body .members-only").show(),!1):(t=e.checkAppNameRepeat(n.val()),!e.defaultKpIsSet(s)||t?!1:(e.modal.tpl.find(".btn.modal-confirm").attr("disabled","disabled"),e.json=e.workspace.design.serialize({usage:"runStack"}),e.json.usage=$("#app-usage-selectbox").find(".dropdown .item.selected").data("value"),e.json.name=n.val(),e.workspace.opsModel.run(e.json,n.val()).then(function(e){return l.modal.close(),App.loadUrl(e.url())},function(e){var t;return l.modal.close(),t=e.awsError?e.error+"."+e.awsError:" "+e.error+" : "+(e.result||e.msg),notification("error",sprintf(i.NOTIFY.FAILA_TO_RUN_STACK_BECAUSE_OF_XXX,l.workspace.opsModel.get("name"),t))})))}}(this)),this.modal.listenTo(Design.instance().project(),"change:credential",function(){if(Design.instance().credential()&&d.modal.isOpen())return d.modal.find(".modal-confirm").text(i.IDE.RUN_STACK_MODAL_CONFIRM_BTN)}),this.modal.on("close",function(){return d.modal.stopListening(App.user)})},renderKpDropdown:function(e,t){var n,r,i,s,u;if(t===h.Type.OpenStack)return l.prototype.hasResourceWithDefaultKp()?(u=new l,n=Design.modelClassForType(o.RESTYPE.OSKP),r=_.find(n.allObjects(),function(e){return e.get("name")==="DefaultKP"}),e.isOpen()&&e.find("#kp-runtime-placeholder").html(u.render(r.get("keyName")).$el),e.tpl.find(".default-kp-group").show(),u.$input.on("change",function(){return u.setDefaultKeyPair()}),!1):!1;if(f.hasResourceWithDefaultKp()){s=new f;if(!e)return!1;e.tpl.find("#kp-runtime-placeholder").html(s.render().el),i=this.hideError.bind(this),s.dropdown.on("change",function(){return i("kp")}),e.tpl.find(".default-kp-group").show(),e.on("close",function(){return s.remove()})}return null},hideError:function(e){var t;return t=e?$("#runtime-error-"+e):$(".runtime-error"),t.hide()},defaultKpIsSet:function(e){var t,n;return e===h.Type.OpenStack?l.prototype.hasResourceWithDefaultKp()&&l.prototype.defaultKpNotSet()?(this.showError("kp",i.IDE.RUN_STACK_MODAL_KP_WARNNING),!1):!0:f.hasResourceWithDefaultKp()?(n=Design.modelClassForType(o.RESTYPE.KP),t=n.getDefaultKP(),!t.get("isSet")||!this.modal&&!this.updateModal||!(this.modal||this.updateModal).tpl.find("#kp-runtime-placeholder .item.selected").size()?(this.showError("kp",i.IDE.RUN_STACK_MODAL_KP_WARNNING),!1):!0):!0},checkAppNameRepeat:function(e){return this.workspace.opsModel.project().apps().findWhere({name:e})?(this.showError("appname",i.PROP.MSG_WARN_REPEATED_APP_NAME),!0):e?(this.hideError("appname"),!1):(this.showError("appname",i.PROP.MSG_WARN_NO_APP_NAME),!0)},showError:function(e,t){return $("#runtime-error-"+e).text(t).show()},deleteStack:function(e,t){var r,s,o,a;return o=this.workspace,t=t||((a=this.workspace)!=null?a.opsModel.project().stacks().get(e).get("name"):void 0)||this.model.get("name"),s=this,r=new u({title:i.TOOLBAR.TIP_DELETE_STACK,width:420,confirm:{text:i.TOOLBAR.POP_BTN_DELETE_STACK,color:"red"},template:n.removeStackConfirm({msg:sprintf(i.TOOLBAR.POP_BODY_DELETE_STACK,t)})}),r.on("confirm",function(){var n,u;r.close(),n=s.model||o.opsModel.project().stacks().get(e),u=n.remove();if(n.isPersisted())return u.then(function(){return notification("info",sprintf(i.NOTIFY.ERR_DEL_STACK_SUCCESS,t))},function(){return notification("error",sprintf(i.NOTIFY.ERR_DEL_STACK_FAILED,t))})})},duplicateStack:function(e){var t,n;n=this.workspace,t=this.model||n.opsModel.project().stacks().get(e);if(!t)return;t.fetchJsonData().then(function(){return App.loadUrl((t.project()||n.opsModel.project()).createStackByJson(t.getJsonData()).url())},function(){return notification("error",i.NOTIFY.ERROR_CANT_DUPLICATE)})},startApp:function(e){var t,r,s;return s=this.workspace,t=this.model||s.opsModel.project().apps().get(e),r=new u({template:n.loading(),title:i.TOOLBAR.TIP_START_APP,confirm:{text:i.TOOLBAR.POP_BTN_START_APP,color:"blue",disabled:!1},disableClose:!0}),r.tpl.find(".modal-footer").hide(),this.checkBeforeStart(t).then(function(e){var s,o,u,a,f;a=e.hasEC2Instance,u=e.hasDBInstance,o=e.hasASG,f=e.lostDBSnapshot,s=e.awsError;if(s&&s!==403)return r.close(),notification("error",i.NOTIFY.ERROR_FAILED_LOAD_AWS_DATA),!1;r.tpl.find(".modal-footer").show(),r.tpl.find(".modal-body").html(n.startAppConfirm({hasEC2Instance:a,hasDBInstance:u,hasASG:o,lostDBSnapshot:f})),r.on("confirm",function(){r.close(),t.start().fail(function(e){var t;t=e.awsError?e.error+"."+e.awsError:e.error,notification("error",sprintf(i.NOTIFY.ERROR_FAILED_START,name,t))})})})},checkBeforeStart:function(e){var t,n,r,i;return i=this,n=null,t=e.type,r=new Q.defer,t===h.Type.OpenStack?(void 0,r.resolve({})):a("app_info",{key_id:this.credentialId(),region_name:e.get("region"),app_ids:[e.get("id")]}).then(function(e){return n=e[0].component}).then(function(){var t,u,a,f,l,c;return l=!!_.filter(n,function(e){return e.type===o.RESTYPE.INSTANCE}).length,f=!!_.filter(n,function(e){return e.type===o.RESTYPE.DBINSTANCE}).length,a=!!_.filter(n,function(e){return e.type===o.RESTYPE.ASG}).length,u=_.filter(n,function(e){return e.type===o.RESTYPE.DBINSTANCE}),c=s(i.credentialId(),o.RESTYPE.DBSNAP,e.get("region")),t=null,c.fetchForce().fail(function(e){return t=e.awsError})["finally"](function(){var e;return e=_.filter(u,function(e){return e.resource.DBSnapshotIdentifier&&!c.findWhere({id:e.resource.DBSnapshotIdentifier})}),r.resolve({hasEC2Instance:l,hasDBInstance:f,hasASG:a,lostDBSnapshot:e,awsError:t})})}),r.promise},checkBeforeStop:function(e){var t,n,r;return t=e.type,t===h.Type.OpenStack?(void 0,n=new Q.defer,n.resolve(),n.promise):(r=s(this.credentialId(),o.RESTYPE.DBINSTANCE,e.get("region")),r.fetchForce())},stopApp:function(t){var r,a,f,l,c,p,d,v;return r=this.model||this.workspace.opsModel.project().apps().get(t),p=r.get("name"),v=this,l=r.type,c=r.get("usage")==="production",a=r.get("name"),d=new u({template:n.loading(),title:c?i.TOOLBAR.POP_TIT_STOP_PRD_APP:i.TOOLBAR.POP_TIT_STOP_APP,confirm:{text:i.TOOLBAR.POP_BTN_STOP_APP,color:"red",disabled:c},disableClose:!0}),d.tpl.find(".modal-footer").hide(),f=null,this.checkBeforeStop(r).fail(function(e){void 0;if(e.awsError)return f=e.awsError})["finally"](function(){var t;return t=s(v.credentialId(),o.RESTYPE.DBINSTANCE,r.get("region")),f&&f!==403?(d.close(),notification("error",i.NOTIFY.ERROR_FAILED_LOAD_AWS_DATA),!1):(l===h.Type.OpenStack?(d.tpl.find(".modal-footer").show(),d.tpl.find(".modal-body").css("padding","0").html(n.stopAppConfirm({isProduction:c,appName:a})),d.resize(),$("#appNameConfirmIpt").on("keyup change",function(){return $("#appNameConfirmIpt").val()===p?d.tpl.find(".modal-confirm").removeAttr("disabled"):d.tpl.find(".modal-confirm").attr("disabled","disabled")})):r.fetchJsonData().then(function(){var i,u,f,l,h,m,g;f=r.getJsonData().component,h={};for(g in f){u=f[g];if(u.type===o.RESTYPE.INSTANCE||u.type===o.RESTYPE.LC)l=u.resource.ImageId,l&&(h[l]=!0)}return m=_.keys(h),i=s(v.credentialId(),o.RESTYPE.AMI,r.get("region")),i.fetchAmis(_.keys(h)).then(function(){var r,s,u,l,h,v,g,y;return h=!1,i.each(function(t){var n;if((n=t.id,e.call(m,n)>=0)&&t.get("rootDeviceType")==="instance-store")return h=!0,null}),l=(g=_.filter(f,function(e){return e.type===o.RESTYPE.INSTANCE}))!=null?g.length:void 0,u=_.filter(f,function(e){return e.type===o.RESTYPE.DBINSTANCE}),r=_.map(u,function(e){return e.resource.DBInstanceIdentifier}),v=t.filter(function(t){var n;return(n=t.get("DBInstanceIdentifier"),e.call(r,n)>=0)&&t.get("DBInstanceStatus")!=="available"}),s=(y=_.filter(f,function(e){return e.type===o.RESTYPE.ASG}))!=null?y.length:void 0,d.tpl.find(".modal-footer").show(),v&&v.length?(d.tpl.find(".modal-body").html(n.cantStop({cantStop:v})),d.tpl.find(".modal-confirm").remove()):(u=u!=null?u.length:void 0,d.tpl.find(".modal-body").css("padding","0").html(n.stopAppConfirm({isProduction:c,appName:a,hasEC2Instance:l,hasDBInstance:u,hasAsg:s,hasInstanceStore:h}))),d.resize(),$("#appNameConfirmIpt").on("keyup change",function(){return $("#appNameConfirmIpt").val()===p?d.tpl.find(".modal-confirm").removeAttr("disabled"):d.tpl.find(".modal-confirm").attr("disabled","disabled")})})}),d.on("confirm",function(){return d.close(),r.stop().fail(function(e){var t;return void 0,t=e.awsError?e.error+"."+e.awsError:e.error,notification(sprintf(i.NOTIFY.ERROR_FAILED_STOP,p,t))})}))})},terminateApp:function(e,t){var r,a,f,l,c,p,d;return p=this,r=this.model||this.workspace.opsModel.project().apps().get(e),f=r.get("name"),l=r.get("usage")==="production",d=new u({title:l?i.TOOLBAR.POP_TIT_TERMINATE_PRD_APP:i.TOOLBAR.POP_TIT_TERMINATE_APP,template:n.loading(),confirm:{text:i.TOOLBAR.POP_BTN_TERMINATE_APP,color:"red",disabled:l},disableClose:!0}),a=r.type,a===h.Type.OpenStack?(this.__terminateApp(e,null,d,t),!1):(d.tpl.find(".modal-footer").hide(),c=s(p.credentialId(),o.RESTYPE.DBINSTANCE,r.get("region")),c.fetchForce().then(function(){return p.__terminateApp(e,c,d,t)},function(n){return n.awsError===403?p.__terminateApp(e,c,d,t):(d.close(),notification("error",i.NOTIFY.ERROR_FAILED_LOAD_AWS_DATA),!1)}))},__terminateApp:function(t,r,s,u){var a,f,l,c,p;return a=this.model||this.workspace.opsModel.project().apps().get(t),c=a.get("name"),p=a.get("usage")==="production",f=a.type,l=function(){var e;return e=new Q.defer,f===h.Type.OpenStack?(e.resolve(),e.promise):u?(e.resolve(),e.promise):a.fetchJsonData()},l().then(function(){var t,u,l,d;f===h.Type.OpenStack?(l=null,d=[]):(t=a.getJsonData().component,l=_.filter(t,function(e){return e.type===o.RESTYPE.DBINSTANCE}),u=_.map(l,function(e){return e.resource.DBInstanceIdentifier}),d=r.filter(function(t){var n;return(n=t.get("DBInstanceIdentifier"),e.call(u,n)>=0)&&t.get("DBInstanceStatus")!=="available"})),s.tpl.find(".modal-body").html(n.terminateAppConfirm({production:p,name:c,hasDBInstance:l,notReadyDB:d})),s.tpl.find(".modal-footer").show(),s.resize(),(d!=null?d.length:void 0)&&s.tpl.find("#take-rds-snapshot").attr("checked",!1).change(function(){return s.tpl.find(".modal-confirm").attr("disabled",$(this).is(":checked"))}),$("#appNameConfirmIpt").on("keyup change",function(){$("#appNameConfirmIpt").val()===c?s.tpl.find(".modal-confirm").removeAttr("disabled"):s.tpl.find(".modal-confirm").attr("disabled","disabled")}),s.on("confirm",function(){var e;s.close(),e=s.tpl.find("#take-rds-snapshot").is(":checked"),a.terminate(null,{create_snapshot:e}).fail(function(e){var t;return t=e.awsError?e.error+"."+e.awsError:e.error,notification(sprintf(i.NOTIFY.ERROR_FAILED_TERMINATE,c,t))})})})},forgetApp:function(e){var t,r,s,o,a;return a=this,t=this.workspace.opsModel.project().apps().get(e),s=t.get("name"),o=t.get("usage")==="production",r=new u({title:i.IDE.TITLE_CONFIRM_TO_FORGET,template:n.loading(),confirm:{text:i.TOOLBAR.BTN_FORGET_CONFIRM,color:"red",disabled:o},disableClose:!0}),r.tpl.find(".modal-footer").hide(),a.__forgetApp(e,r)},__forgetApp:function(e,t){var r,i,s,u,a,f,l,c;r=this.workspace.opsModel.project().apps().get(e),u=r.get("name"),a=r.get("usage")==="production",s=!1;if(Design.instance().get("agent").enabled){l=Design.instance().serialize().component;for(f in l){i=l[f];if(((c=i.type)===o.RESTYPE.INSTANCE||c===o.RESTYPE.LC)&&i.state&&i.state.length>0){s=!0;break}null}}return r.fetchJsonData().then(function(){t.tpl.find(".modal-body").html(n.forgetAppConfirm({production:a,name:u,hasState:s})),t.tpl.find(".modal-footer").show(),t.resize(),s&&t.tpl.find(".modal-confirm").attr("disabled","disabled"),$("#appNameConfirmIpt").on("keyup change",function(){$("#appNameConfirmIpt").val()===u?t.tpl.find(".modal-confirm").removeAttr("disabled"):t.tpl.find(".modal-confirm").attr("disabled","disabled")}),t.on("confirm",function(){t.close(),r.terminate(!0,!1).then(function(){return notification("info",'Your app "'+u+'" has been removed from our database.')},function(e){return notification("error",'Failed to remove your app "'+u+'" from our database. (ErrorCode: '+e.error+")")})})})},showPayment:function(e,t){var n,r,s,o,a,f,l;return t||(t=(l=this.workspace)!=null?l.opsModel:void 0),r=(t!=null?t.project():void 0)||this.project,s=r.get("id"),a=Q.defer(),f="/settings/"+s+"/billing",r.shouldPay()?(o={isAdmin:r.amIAdmin(),url:f,freePointsPerMonth:3600},e?($(e).html(MC.template.loadingSpinner()),$(e).trigger("paymentRendered")):(n=new u({title:i.PROP.LBL_LOADING,template:MC.template.loadingSpinner(),disableClose:!0,confirm:{text:r.isDemoMode()?i.IDE.RUN_STACK_MODAL_NEED_CREDENTIAL:i.IDE.RUN_STACK_MODAL_CONFIRM_BTN,disabled:!0}}),n.find(".modal-footer").hide()),r.getPaymentState().then(function(){var t,s;return((s=r.get("payment"))!=null?s.cardNumber:void 0)||!r.isPrivate()?t=MC.template.paymentUpdate(o):t=MC.template.providePayment(o),e?($(e).html(t),$(e).trigger("paymentRendered")):(n.setContent(t),n.setTitle(i.IDE.PAYMENT_INVALID_BILLING),n.setContent(t),n.listenTo(r,"change:billingState",function(){if(n.isClosed)return!1;if(!r.shouldPay())return a.resolve({result:o,modal:n})}))})):a.resolve({result:{url:f}}),a.promise}})})}.call(this),define("component/AppAction",function(){});