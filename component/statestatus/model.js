(function(){define(["constant","event","backbone","jquery","underscore","MC"],function(e,t){var n;return n=Backbone.Model.extend({initialize:function(){var e;return this.collection=new(this.__customCollection()),e=MC.data.websocket.collection.status.find().fetch(),this.collection.set(this.__dispose(e).models,{silent:!0}),this.set("items",this.collection),this.set("new",[]),this.set("stop",Design.instance().get("state")==="Stopped")},__collectNew:function(e){var t;return t=this.get("new"),this.set("new",this.get("new").concat(e)),this},flushNew:function(){return this.set("new",[])},__customCollection:function(){var e;return e=this,Backbone.Collection.extend({comparator:function(e){return-e.get("time")},initialize:function(){return this.on("add",e.__collectNew,e)}})},__genId:function(e,t){return""+e+"|"+t},__dispose:function(e){var t,n,r,i,s,o,u,a,f,l;t=new Backbone.Collection,void 0,_.isArray(e)||(e=[e]);for(o=0,a=e.length;o<a;o++){i=e[o];if(i.status){l=i.status;for(r=u=0,f=l.length;u<f;r=++u){s=l[r];if(i.app_id!==Design.instance().get("id"))continue;n={id:this.__genId(i.res_id,s.id),appId:i.app_id,resId:i.res_id,stateId:r+1,time:s.time,result:s.result},_.extend(n,this.__extendComponent(n.resId)),n.name||(n.name="unknown"),n.result==="failure"&&t.add(new Backbone.Model(n))}}}return t},__extendComponent:function(e){var t,n;return n={},t=MC.aws.aws.getCompByResIdForState(e),t.parent?(t.self?n.name=t.self.get("name"):(n.parent=t.parent.get("name"),n.name=e),n.uid=t.parent.id):t.self&&(n.name=t.self.get("name"),n.uid=t.self.id),n},listenStateStatusUpdate:function(e,t,n){var r;return r=this.__dispose(t),this.collection.add(r.models),null},listenStateEditorUpdate:function(e){var t,n,r,i,s,o;n=e.resId,i=e.stateIds;for(s=0,o=i.length;s<o;s++)r=i[s],t=this.__genId(n,r),this.collection.get(t)&&this.collection.get(t).set("updated",!0);return null},listenUpdateAppState:function(e){return e==="Stopped"?this.set("stop",!0):this.set("stop",!1)}}),n})}).call(this);