(function(){define(["constant","MC","i18n!nls/lang.js","Design","underscore"],function(e,t,n,r,i){var s,o;return o={taReturn:function(t,n,r){var i;return i={level:e.TA[t],info:n},r&&(i.uid=r),i},genTip:function(e){var t;return e.length>2?t=Function.call.apply(sprintf,e):t=e[1],t}},s={map:{protocal:{1:"icmp",6:"tcp",17:"udp","-1":"all"}},protocal:{get:function(e){return s.map.protocal[e.toString()]||e}},i18n:{"short":function(){return n.ide}},component:{get:function(e,n){return n?r.instance().component(e):t.canvas_data.component[e]}},message:{error:function(t,n){return n=o.genTip(arguments),o.taReturn(e.TA.ERROR,n,t)},warning:function(t,n){return n=o.genTip(arguments),o.taReturn(e.TA.WARNING,n,t)},notice:function(t,n){return n=o.genTip(arguments),o.taReturn(e.TA.NOTICE,n,t)}},eni:{getByInstance:function(n){return i.filter(t.canvas_data.component,function(r){if(r.type===e.AWS_RESOURCE_TYPE.AWS_VPC_NetworkInterface&&t.extractID(r.resource.Attachment.InstanceId)===n.uid)return!0})}},sg:{get:function(n){var r,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;f=[];if(n.type===e.AWS_RESOURCE_TYPE.AWS_AutoScaling_LaunchConfiguration){y=n.resource.SecurityGroups;for(l=0,d=y.length;l<d;l++)a=y[l],f.push(s.component.get(t.extractID(a)))}else if(n.type===e.AWS_RESOURCE_TYPE.AWS_EC2_Instance){o=s.eni.getByInstance(n);for(c=0,v=o.length;c<v;c++){r=o[c],b=r.resource.GroupSet;for(h=0,m=b.length;h<m;h++)u=b[h],f.push(s.component.get(t.extractID(u.GroupId)))}}else if(n.type===e.AWS_RESOURCE_TYPE.AWS_ELB){w=n.resource.SecurityGroups;for(p=0,g=w.length;p<g;p++)a=w[p],f.push(s.component.get(t.extractID(a)))}return i.uniq(i.compact(f))},port:function(t){var n,r,o,u,a,f,l,c,h,p,d,v;r={"in":{},out:{}},i.isArray(t)||(t=[t]),n=function(e,t){var n,o;n=s.protocal.get(e.IpProtocol),r[t][n]||(r[t][n]=[]),o={from:Number(e.FromPort),to:Number(e.ToPort),range:e.IpRanges};if(i.where(r[t][n],o).length===0)return r[t][n].push(o)};for(a=0,c=t.length;a<c;a++){u=t[a];if(u.type!==e.RESTYPE.SG)continue;d=u.resource.IpPermissionsEgress;for(f=0,h=d.length;f<h;f++)o=d[f],n(o,"out");v=u.resource.IpPermissions;for(l=0,p=v.length;l<p;l++)o=v[l],n(o,"in")}return r},isInRange:function(e,t,n,r){var o,u,a;return o=!1,a=s.protocal.get(e.toLowerCase()),u=Number(t),i.each(n[r],function(e,t){return t===a&&i.each(e,function(e){return u>=e.from&&u<=e.to&&(o=!0),null}),null}),o}}},s})}).call(this);