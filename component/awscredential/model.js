(function(){define(["backbone","jquery","underscore","MC","session_model","vpc_model","account_model","i18n!nls/lang.js","event","constant","UI.notification"],function(e,t,n,r,i,s,o,u,a,f){var l;return l=e.Model.extend({defaults:{account_id:null,is_authenticated:null},initialize:function(){var e,t;t=this,t.on("ACCOUNT_UPDATE__ACCOUNT_RETURN",function(e){var n;return void 0,n=e.param[3],e.is_error?t.trigger("UPDATE_ACCOUNT_ATTRIBUTES_FAILED",n):(t.trigger("UPDATE_ACCOUNT_ATTRIBUTES_SUCCESS",n),n.state==="3"&&r.common.cookie.setCookieByName("state",n.state)),null}),t.on("SESSION_SYNC__REDIS_RETURN",function(e){return void 0,e.is_error||a.trigger(a.UPDATE_AWS_CREDENTIAL),null}),t.on("ACCOUNT_RESET__KEY_RETURN",function(e){var n;void 0,n=e.param[3];if(!e.is_error){void 0;if(!n||n===0)t.set("is_authenticated",!0),t.set("account_id",e.resolved_data),r.common.cookie.setCookieByName("account_id",e.resolved_data),r.common.cookie.setCookieByName("has_cred",!0),t.trigger("REFRESH_AWS_CREDENTIAL")}else void 0;return null}),e=!1,r.common.cookie.getCookieByName("has_cred")==="true"&&(e=!0),t.set("is_authenticated",e);if(r.common.cookie.getCookieByName("account_id"))return t.set("account_id",r.common.cookie.getCookieByName("account_id"))},awsAuthenticate:function(e,o,u){var a,l;return a=this,l={expires:1,path:"/"},i.set_credential({sender:this},t.cookie("usercode"),t.cookie("session_id"),e,o,u),a.once("SESSION_SET__CREDENTIAL_RETURN",function(e){var i;return void 0,void 0,e.is_error?(a.set("is_authenticated",!1),r.common.cookie.setCookieByName("has_cred",!1),a.set("account_id",u),a.trigger("REFRESH_AWS_CREDENTIAL")):(i="DescribeAccountAttributes_"+t.cookie("usercode")+"__"+"supported-platforms,default-vpc",r.session.get(i)&&r.session.remove(i),s.DescribeAccountAttributes({sender:s},t.cookie("usercode"),t.cookie("session_id"),"",["supported-platforms","default-vpc"]),s.once("VPC_VPC_DESC_ACCOUNT_ATTRS_RETURN",function(e){var i;return void 0,e.is_error?a.set("is_authenticated",!1):(a.set("is_authenticated",!0),r.common.cookie.setCookieByName("has_cred",!0),r.common.cookie.setCookieByName("account_id",u),i=e.resolved_data,n.map(f.REGION_KEYS,function(e){var n,s;return i[e]&&i[e].accountAttributeSet&&(s=i[e].accountAttributeSet.item[0].attributeValueSet.item,s&&t.type(s)==="array"&&(s.length===2?r.data.account_attribute[e].support_platform=s[0].attributeValue+","+s[1].attributeValue:s.length===1&&(r.data.account_attribute[e].support_platform=s[0].attributeValue)),n=i[e].accountAttributeSet.item[1].attributeValueSet.item,n&&t.type(n)==="array"&&n.length===1&&(r.data.account_attribute[e].default_vpc=n[0].attributeValue)),null})),a.set("account_id",u),a.trigger("REFRESH_AWS_CREDENTIAL")}))}),null},updateAccountEmail:function(e){var n,r;return r=this,n={email:e},o.update_account({sender:r},t.cookie("usercode"),t.cookie("session_id"),n),null},updateAccountPassword:function(e,n){var r,i;return i=this,r={password:e,new_password:n},o.update_account({sender:i},t.cookie("usercode"),t.cookie("session_id"),r),null},removeCredential:function(){var e,n;return n=this,e={account_id:null,access_key:null,secret_key:null},o.update_account({sender:n},t.cookie("usercode"),t.cookie("session_id"),e),null},sync_redis:function(){var e;return e=this,i.sync_redis({sender:e},t.cookie("usercode"),t.cookie("session_id")),null},resetKey:function(e){return void 0,o.reset_key({sender:this},t.cookie("usercode"),t.cookie("session_id"),e),null},updateAccountService:function(){return void 0,o.update_account({sender:this},t.cookie("usercode"),t.cookie("session_id"),{state:"3"})}}),l})}).call(this);