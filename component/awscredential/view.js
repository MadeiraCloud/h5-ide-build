(function(){define(["event","i18n!nls/lang.js","constant","./form","./loading","./skip","backbone","jquery","handlebars","UI.modal","UI.notification"],function(e,t,n,r,i,s){var o,u,a,f;return a=null,u=null,f=null,o=Backbone.View.extend({state:"credential",events:{"click #close-awscredential":"onClose","click #account-setting-close":"onClose","click #awscredentials-submit":"onSubmit","click #awscredentials-update-done":"onDone","click .AWSCredentials-account-update":"onUpdate","click #awscredentials-cancel":"onAWSCredentialCancel","click #awscredentials-remove":"onAWSCredentialRemove","click #account-setting-tab li a":"onTab","click #account-change-password":"onChangePassword","click #account-email-update":"clickUpdateEmail","click #account-email-cancel":"clickCancelEmail","click #account-password-update":"clickUpdatePassword","click #account-password-cancel":"clickCancelPassword","input #aws-credential-account-id":"verificationKey","input #aws-credential-access-key":"verificationKey","input #aws-credential-secret-key":"verificationKey","keyup #aws-credential-account-id":"verificationKey","keyup #aws-credential-access-key":"verificationKey","keyup #aws-credential-secret-key":"verificationKey","change #aws-credential-account-id":"verificationKey","change #aws-credential-access-key":"verificationKey","change #aws-credential-secret-key":"verificationKey","click #awscredentials-skip":"onSkinButton"},render:function(e){return void 0,modal(e(this.model.get("account_id")),!1),this.setElement($("#account-setting-wrap").closest("#modal-wrap")),$("#AWSCredential-form").find("ul").html(r()),$("#AWSCredentials-submiting").html(i()),$("#modal-box").hide(),setTimeout(function(){return $("#modal-box").show(),modal.position()},500)},onClose:function(){return void 0,MC.common.cookie.getCookieByName("has_cred")!=="true"?(this.trigger("CANCAL_CREDENTIAL"),this.state==="welcome"&&($("#awscredentials-submit").text("Loading..."),$("#awscredentials-skip").hide(),$("#AWSCredential-welcome-img").hide())):this.trigger("CLOSE_POPUP"),null},onDone:function(){return void 0,this.trigger("CLOSE_POPUP")},onUpdate:function(){var e;return void 0,e=this,e.showSetting("credential","in_update")},onSubmit:function(){var e,n,r,i,s,o;void 0;if((o=$("#awscredentials-skip").attr("data-type"))==="back"||o==="done"){MC.common.cookie.getCookieByName("has_cred")!=="true"?(this.trigger("CANCAL_CREDENTIAL"),this.state==="welcome"&&($("#awscredentials-submit").text("Loading..."),$("#awscredentials-skip").hide(),$("#AWSCredential-welcome-img").hide())):this.onDone();return}r=this,i=0,n=$("#aws-credential-account-id").val().trim(),e=$("#aws-credential-access-key").val().trim(),s=$("#aws-credential-secret-key").val().trim();if(MC.common.cookie.getCookieByName("account_id")==="demo_account"&&$("#aws-credential-account-id").val().trim()==="demo_account"){notification("error",t.ide.HEAD_MSG_ERR_INVALID_SAME_ID);return}if(!n)return notification("error",t.ide.HEAD_MSG_ERR_INVALID_ACCOUNT_ID);if(!e)return notification("error",t.ide.HEAD_MSG_ERR_INVALID_ACCESS_KEY);if(!s)return notification("error",t.ide.HEAD_MSG_ERR_INVALID_SECRET_KEY);r.showSetting("credential","on_submit"),a=n,u=e,f=s,r.trigger("AWS_AUTHENTICATION",n,e,s);if(this.state==="welcome")return $("#awscredentials-submit").text("Loading..."),$("#awscredentials-skip").hide(),$("#AWSCredential-welcome-img").hide()},onAWSCredentialCancel:function(){var e;return void 0,e=this,MC.common.cookie.getCookieByName("has_cred")!=="true"?$("#AWSCredentials-remove-wrap").attr("data-type")==="remove"?e.showSetting("credential","in_update"):e.trigger("CANCAL_CREDENTIAL"):e.showSetting("credential","on_update")},onAWSCredentialRemove:function(e){var t;return void 0,t=this,$("#AWSCredentials-remove-wrap").attr("data-type","remove"),$("#awscredentials-remove").hasClass("btn btn-red")?(t.trigger("REMOVE_CREDENTIAL"),t.showSetting("credential")):t.showSetting("credential","on_remove")},onTab:function(e){var n,r;return void 0,n=this,r=$(e.currentTarget),r.text()===t.ide.HEAD_LABEL_CREDENTIAL?$.cookie("has_cred")==="true"?n.showSetting("credential","on_update"):n.showSetting("credential","is_failed"):n.showSetting("account"),null},clickUpdateEmail:function(e){var n,r,i;void 0,r=this,n=$("#account-email-input").val(),i=$("#email-verification-status"),i.removeClass("error-status");if(e&&e==="is_failed")return i.show().text(t.ide.HEAD_MSG_ERR_UPDATE_EMAIL2);if(n)return n!==""&&/^[\w-]+(\.[\w-]+)*@([\w-]+\.)+[a-zA-Z]+$/.test(n)?n===MC.base64Decode($.cookie("email"))?r.showSetting("account"):r.trigger("UPDATE_ACCOUNT_EMAIL",n):i.show().text(t.ide.HEAD_MSG_ERR_UPDATE_EMAIL3)},clickCancelEmail:function(e){var t;return void 0,t=this,t.showSetting("account")},onChangePassword:function(e){var t;return void 0,t=this,$("#account-password-wrap").css("display")==="none"?t.showSetting("account","on_password"):t.showSetting("account"),null},clickUpdatePassword:function(e){var n,r,i;return void 0,n=this,i=$("#account-current-password").val(),r=$("#account-new-password").val(),!i||!r?($("#account-passowrd-info").show(),$("#account-passowrd-info").text(t.ide.HEAD_MSG_ERR_NULL_PASSWORD)):r===$.cookie("username")||r.length<6?($("#account-passowrd-info").show(),$("#account-passowrd-info").text(t.ide.HEAD_MSG_ERR_INVALID_PASSWORD)):e==="error_password"?($("#account-passowrd-info").show(),$("#account-passowrd-info").html(t.ide.HEAD_MSG_ERR_WRONG_PASSWORD+' <a href="/reset/" target="_blank">'+t.ide.HEAD_MSG_INFO_FORGET_PASSWORD+"</a>")):($("#account-passowrd-info").hide(),n.trigger("UPDATE_ACCOUNT_PASSWORD",i,r))},clickCancelPassword:function(e){var t;return void 0,t=this,t.showSetting("account")},notify:function(e,t){return notification(e,t)},verificationKey:function(){var e;return void 0,e=0,$("#aws-credential-account-id").val().trim()&&(e+=1),$("#aws-credential-access-key").val().trim()&&(e+=1),$("#aws-credential-secret-key").val().trim()&&(e+=1),e===3?$("#awscredentials-submit").attr("disabled",!1):$("#awscredentials-submit").attr("disabled",!0),null},onSkinButton:function(){var e;return void 0,e=$("#awscredentials-skip"),$("#AWSCredential-info").removeClass("error"),e.attr("data-type")==="skip"?(e.attr("data-type","back"),e.text("Back"),$("#awscredentials-submit").text("Done"),$("#awscredentials-submit").removeAttr("disabled"),$("#AWSCredential-form").find("ul").html(s()),$("#AWSCredential-welcome").text(t.ide.HEAD_INFO_PROVIDE_CREDENTIAL1),$("#AWSCredential-info").find("p").text(t.ide.HEAD_INFO_DEMO_MODE),$("#AWSCredential-welcome-img").hide(),$("#AWSCredential-form").find("h4").hide()):e.attr("data-type")==="back"&&(e.attr("data-type","skip"),e.text("Skip"),$("#awscredentials-submit").attr("disabled",!0),$("#awscredentials-submit").text(t.ide.HEAD_BTN_SUBMIT),$("#AWSCredential-form").find("ul").html(r()),$("#AWSCredential-welcome").text(sprintf(t.ide.HEAD_INFO_WELCOME,MC.common.cookie.getCookieByName("username"))),$("#AWSCredential-info").find("p").text(t.ide.HEAD_INFO_PROVIDE_CREDENTIAL2),$("#AWSCredential-welcome-img").show(),$("#AWSCredential-form").find("h4").show()),null},showSetting:function(e,r){var i,s,o,l,c,h,p,d,v,m,g,y,b;void 0,o=this;if(e==="account")$("#account-profile-setting").show(),$("#AWSCredential-setting").hide(),$("#account-profile-setting-body").show(),$("#account-profile-setting-username").show(),$("#account-profile-setting-email").show(),r?r==="on_email"?($("#account-email-change-wrap").hide(),$("#account-email-input-wrap").show(),$("#account-password-wrap").hide(),$("#email-verification-status").hide(),$("#account-email-input").val(MC.base64Decode($.cookie("email")))):r==="on_password"&&($("#account-email-change-wrap").show(),$("#account-email-input-wrap").hide(),$("#account-password-wrap").show(),$("#account-passowrd-info").hide(),$("#account-current-password").val(""),$("#account-new-password").val("")):($("#account-email-change-wrap").show(),$("#account-email-input-wrap").hide(),$("#account-password-wrap").hide(),$("#account-profile-username").text($.cookie("username")),$("#account-profile-email").text(MC.base64Decode($.cookie("email"))));else if(e==="credential"){$("#account-profile-setting").hide(),$("#AWSCredential-setting").show(),$("#AWSCredentials-remove").hide(),$("#AWSCredential-form").show(),$("#AWSCredential-form").find("ul").show(),$("#awscredentials-submit").show(),$("#AWSCredential-info-wrap").show(),$("#AWSCredential-info").show(),$("#AWSCredentials-remove-wrap").hide(),$("#awscredentials-remove").css("display","inline-block"),$("#awscredentials-cancel").show(),$("#awscredentials-submit").attr("disabled","true"),$("#awscredentials-remove").css("display","inline-block");if(!r)$("#AWSCredentials-submiting").hide(),$("#AWSCredentials-update").hide(),$("#aws-credential-account-id").val(" "),$("#aws-credential-access-key").val(" "),$("#aws-credential-secret-key").val(" "),this.state==="credential"?$("#AWSCredential-info").find("p").text(t.ide.HEAD_INFO_PROVIDE_CREDENTIAL3):this.state==="welcome"&&(p=sprintf(t.ide.HEAD_INFO_WELCOME,MC.common.cookie.getCookieByName("username")),$("#AWSCredential-welcome").text(p),$("#AWSCredential-info").find("p").text(t.ide.HEAD_INFO_PROVIDE_CREDENTIAL2)),$("#awscredentials-remove").hide(),$("#awscredentials-cancel").hide();else if(r==="is_failed")$("#AWSCredentials-submiting").hide(),$("#AWSCredentials-update").hide(),$("#AWSCredential-info").addClass("error"),$("#AWSCredential-info").find("p").text(t.ide.HEAD_ERR_AUTHENTICATION),h=0,a&&($("#aws-credential-account-id").text(a),h+=1),u&&($("#aws-credential-access-key").text(u),h+=1),f&&($("#aws-credential-secret-key").text(f),h+=1),h===3&&$("#awscredentials-submit").attr("disabled",!1),this.state==="welcome"&&($("#awscredentials-submit").text(t.ide.HEAD_BTN_SUBMIT),$("#awscredentials-skip").show());else if(r==="on_update")$("#AWSCredential-form").hide(),$("#AWSCredentials-submiting").hide(),$("#AWSCredentials-update").show(),$("#AWSCredential-info-wrap").hide(),$("#aws-credential-update-account-id").text(o.model.attributes.account_id),$(".AWSCredentials-nochange-warn").hide(),$(".AWSCredentials-account-update").show(),$(".AWSCredentials-account-update").attr("disabled",!1),this.state==="welcome"&&($("#awscredentials-skip").hide(),$("#awscredentials-skip").attr("data-type","done"),$("#awscredentials-submit").text(t.ide.HEAD_BTN_DONE),$("#awscredentials-submit").removeAttr("disabled"));else if(r==="in_update"){MC.common.cookie.getCookieByName("account_id")==="demo_account"&&$("#awscredentials-remove").hide(),$("#AWSCredentials-submiting").hide(),$("#AWSCredentials-update").hide(),$("#AWSCredential-info").find("p").text(t.ide.HEAD_CHANGE_CREDENTIAL),$("#aws-credential-account-id").val(o.model.attributes.account_id),$("#awscredentials-remove").removeClass("btn btn-red"),$("#aws-credential-access-key").val(" "),$("#aws-credential-secret-key").val(" "),l=0,y=n.REGION_KEYS;for(d=0,m=y.length;d<m;d++){c=y[d],b=MC.data.app_list[c];for(v=0,g=b.length;v<g;v++)i=b[v],l++}l>0?($("#aws-credential-account-id").attr("disabled",!0),$("#awscredentials-remove").hide()):($("#aws-credential-account-id").attr("disabled",!1),$("#awscredentials-remove").show()),o.model.attributes.account_id==="demo_account"&&($("#aws-credential-account-id").val(" "),$("#aws-credential-account-id").attr("disabled",!1))}else r==="on_submit"?($("#AWSCredential-form").hide(),$("#AWSCredentials-submiting").show(),$("#AWSCredentials-update").hide(),$("#AWSCredential-info-wrap").hide()):r==="load_resource"?($("#AWSCredential-form").hide(),$("#AWSCredentials-submiting").show(),$("#AWSCredentials-update").hide(),$("#AWSCredentials-loading-text").text(t.ide.HEAD_INFO_LOADING_RESOURCE),$("#AWSCredential-info-wrap").hide()):r==="on_remove"&&($("#AWSCredential-info").hide(),$("#AWSCredentials-remove-wrap").show(),s=sprintf(t.ide.HEAD_INFO_CONFIRM_REMOVE,o.model.attributes.account_id),$("#AWSCredential-remove-head").find("p").text(s),$("#awscredentials-submit").hide(),$("#AWSCredential-form").find("ul").hide(),$("#awscredentials-remove").addClass("btn btn-red"))}return MC.common.cookie.getCookieByName("account_id")==="demo_account"?$("#awscredentials-remove").hide():$("#awscredentials-remove").show(),null}}),o})}).call(this);