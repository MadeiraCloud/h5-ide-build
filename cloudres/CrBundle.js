(function(){define("cloudres/CrModel",["ApiRequest","backbone"],function(e){return Backbone.Model.extend({constructor:function(e,t){Backbone.Model.call(this,e,t),t&&t.RES_TAG&&(this.RES_TAG=t.RES_TAG)},save:function(){var e;if(this.get("id")){void 0;return}return this.__savePromise||(e=this,this.__savePromise=this.doCreate().then(function(){return e.__collection.add(e),e.tagResource(),delete e.__collection,delete e.__savePromise,e},function(t){throw delete e.__savePromise,t})),this.__savePromise},update:function(e){if(!this.get("id")){void 0;return}if(!this.doUpdate){void 0;return}return this.doUpdate(e)},destroy:function(){var e;return e=this,this.doDestroy().then(function(){return e.getCollection().remove(e),e},function(t){if(t.awsError===400&&t.awsErrorCode.indexOf(".NotFound")!==-1)return e.getCollection().remove(e),e;throw t})},getCollection:function(){return this.__collection||this.collection},tagResource:function(){var t;if(this.taggable===!1)return;return t=this,e("ec2_CreateTags",{region_name:this.getCollection().region(),resource_ids:[this.get("id")],tags:[{Name:"Created by",Value:App.user.get("username")}]}).then(function(){void 0})}},{})})}).call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("cloudres/CrCollection",["ApiRequest","./CrModel","constant","backbone"],function(t,n,r){var i,s,o,u,a,f,l,c;return i={},o=[],s={},f={INSTANCE:{networkInterfaces:"networkInterfaceSet",state:"instanceState",securityGroups:"groupSet",blockDeviceMappings:"blockDeviceMapping",publicDnsName:"dnsName"},VOL:{attachments:"attachmentSet"},RT:{associations:"associationSet",routes:"routeSet",propagatingVgws:"propagatingVgwSet"},SG:{description:"groupDescription"},VGW:{vpcAttachments:"attachments"},IGW:{attachments:"attachmentSet"},LC:{blockDeviceMappings:"BlockDeviceMapping"},DBSBG:{dbsubnetGroupDescription:"DBSubnetGroupDescription",dbsubnetGroupName:"DBSubnetGroupName"},DBINSTANCE:{dbinstanceClass:"DBInstanceClass",dbinstanceIdentifier:"DBInstanceIdentifier",dbinstanceStatus:"DBInstanceStatus",dbname:"DBName",dbparameterGroups:"DBParameterGroups",dbsecurityGroups:"DBSecurityGroups",dbsubnetGroup:"DBSubnetGroup",dbname:"DBName"},ALL:{associations:"associationSet",privateIpAddresses:"privateIpAddressesSet",groups:"groupSet"}},a=function(e){var t,n;return t=jQuery.extend(!0,{},f.ALL),n=r.WRAP(f),_.extend(t,n[e])},l=function(e,t,n){return e[n]=e[t],delete e[t]},u=function(t){var n,r,i,s,o;n=["member","item"],o=[];for(r in t)s=t[r],i=r.substring(0,1).toUpperCase()+r.substring(1),e.call(n,r)<0&&i!==r?o.push(l(t,r,i)):o.push(void 0);return o},c=function(t,n){var r,i,s,o;i=a(n),o=[];for(r in t)s=t[r],e.call(_.keys(i),r)>=0?o.push(l(t,r,i[r])):o.push(void 0);return o},Backbone.Collection.extend({category:"",model:n,constructor:function(){return this.on("add remove",_.debounce(function(){return this.trigger("update")}),this),Backbone.Collection.apply(this,arguments)},isReady:function(){return this.__fetchPromise&&this.__ready},isLastFetchFailed:function(){return!!this.lastFetchError()},lastFetchError:function(){return this.__lastFetchError},fetch:function(){var e;return!this.isLastFetchFailed()&&this.__fetchPromise?this.__fetchPromise:(this.lastFetch=+(new Date),this.__ready=!1,this.__lastFetchError=null,e=this,this.__fetchPromise=this.doFetch().then(function(n){var r,i,s,u;if(!e.__selfParseData){try{e.trAwsXml&&(n=e.trAwsXml(n)),e.parseFetchData&&n&&(n=e.parseFetchData(n)),n||(n=o)}catch(a){throw i=a,McError(t.Errors.InvalidAwsReturn,"Failed to parse aws data.",[n,i])}if(e.modelIdAttribute)for(s=0,u=n.length;s<u;s++)r=n[s],r.id=r[e.modelIdAttribute],delete r[e.modelIdAttribute]}return e.__ready=!0,n.length===0&&e.models.length===0?e.trigger("update"):e.set(n),e},function(t){throw e.lastFetch=0,e.__lastFetchError=t,e.__ready=!0,e.trigger("update"),t}),this.__fetchPromise)},fetchForce:function(){return this.__fetchPromise=null,this.reset(),this.trigger("update"),this.fetch()},fetchIfExpired:function(){var e;e=this.lastFetch||0;if(+(new Date)-e<18e5){void 0;return}return this.__fetchPromise=null,this.fetch()},resolveTagSet:function(e){var t,n,r,i,s,o,u;if(!e)return{};if(e["Created by"]&&e.app&&e["app-id"]&&e.name&&e.Name)r=jQuery.extend(!0,{},e),r.isOwner=App.user.get("username")===e["Created by"];else if(e.visualops&&e.Name){r={},i=e.visualops;if(i.indexOf("app-name=")===0&&i.indexOf("app-id=")>0&&i.indexOf("created-by=")>0){u=i.split(" ");for(s=0,o=u.length;s<o;s++){n=u[s],t=n.split("=");switch(t[0]){case"app-name":r.app=t[1];break;case"app-id":r["app-id"]=t[1];break;case"created-by":r["Created by"]=t[1]}null}}r.name=e.Name,r["Created by"]&&r.app&&r["app-id"]&&r.name&&(r.Name=r.app+"-"+r.name,r.isOwner=App.user.get("username")===r["Created by"])}return r},__parseExternalData:function(e,t,n){var r,i,s,o,u,a,f,l,c,h;try{this.parseExternalData?e=this.parseExternalData(e,n):this.parseFetchData&&(e=this.parseFetchData(e))}catch(p){return i=p,null}if(!e||!e.length){this.trigger("update");return}o=[];for(a=0,l=e.length;a<l;a++){r=e[a],r.category=n;if(r.tags||r.Tags)r.tagSet=r.tags||r.Tags,delete r.tags,delete r.Tags;if(_.isArray(r.tagSet)){u={},h=r.tagSet;for(f=0,c=h.length;f<c;f++)s=h[f],s.key?u[s.key]=s.value:s.Key&&(u[s.Key]=s.Value);r.tagSet=u}r.tagSet&&(r.visopsTag=this.resolveTagSet(r.tagSet)),this.modelIdAttribute&&(r.id=r[this.modelIdAttribute],delete r[this.modelIdAttribute]),o.push(r.id)}this.remove(o,{silent:!0}),this.add(e,t)},parseFetchData:function(e){return e},destroy:function(){return this.trigger("destroy",this.id)},create:function(e){var t;return t=new this.model(e),t.__collection=this,t},region:function(){return this.category},where:function(e,t){var n,r,i;e.category&&e.category===this.category&&delete e.category;for(r in e)if(e.hasOwnProperty(r)){n=!0;break}return n?i=Backbone.Collection.prototype.where.call(this,e)||[]:i=this.models.slice(0),t?i[0]:i},convertNumTimeToString:function(e){var t,n,r;for(t in e){r=e[t];if(!e.hasOwnProperty(t))continue;_.isObject(e[t])||_.isArray(e[t])?this.convertNumTimeToString(r):_.isNumber(e[t])&&(e[t]=String(e[t]),t&&t.toLowerCase().indexOf("time")!==-1&&e[t].length>12&&(n=new Date(Number(e[t])),n&&(e[t]=n.toISOString())))}return e},unifyApi:function(e,t){var n,r,i;n=!1;if(!_.isObject(e))return e;for(r in e){i=e[r];if(!e.hasOwnProperty(r))continue;_.isArray(e)||(c(e,t),n=!0),n||this.unifyApi(i,t)}return e},camelToPascal:function(t){var n,r,i,s;r=["member","item"];if(!_.isObject(t))return t;for(n in t){s=t[n];if(!t.hasOwnProperty(n))continue;i=n.substring(0,1).toUpperCase()+n.substring(1),!_.isArray(t)&&i!==n&&e.call(r,n)<0&&(t[i]=s,delete t[n]),this.camelToPascal(s)}return t}},{category:function(e){return e},getClassByType:function(e){return i[e]},getClassByAwsResponseType:function(e){return s[e]},extend:function(e,t){var r,o;return void 0,e.AwsResponseType&&(r=e.AwsResponseType,delete e.AwsResponseType),t=t||{},t.type=e.type,o=n.extend.call(this,e,t),i[e.type]=o,r&&(s[r]=o),o}})})}.call(this),function(){define("CloudResources",["cloudres/CrCollection"],function(e){var t,n,r;return t={},r=function(e){return void 0,delete t[e]},n=function(n,i){var s,o,u;return s=e.getClassByType(n),s?(i=s.category(i),u=n+"_"+i,o=t[u],o||(o=new s,o.id=u,o.category=i,t[u]=o,o.on("destroy",r)),o):null},n.invalidate=function(){return Q.all(_.values(t).map(function(e){return e.fetchForce()}))},n.clearWhere=function(n,r){var i,s,o,u,a;_.isFunction(n)?o="filter":o="where";for(u in t)s=t[u],i=e.getClassByType(s.type),a=i.category(r),s.category===a&&s.remove(s[o](n))},n})}.call(this),function(){define("cloudres/CrModelDhcp",["./CrModel","ApiRequest"],function(e,t){return e.extend({defaults:function(){return{"domain-name":[],"domain-name-servers":[],"ntp-servers":[],"netbios-name-servers":[],"netbios-node-type":[]}},constructor:function(t,n){return t=this.tryParseDhcpAttr(t),e.call(this,t,n)},tryParseDhcpAttr:function(e){var t,n,r,i,s;if(e.dhcpConfigurationSet)try{s=e.dhcpConfigurationSet.item;for(r=0,i=s.length;r<i;r++)n=s[r],e[n.key]=n.valueSet;delete e.dhcpConfigurationSet}catch(o){t=o}return e},toAwsAttr:function(){var e,t,n,r;e=[],r=this.attributes;for(t in r)n=r[t],t!=="id"&&t!=="tagSet"&&n.length>0&&e.push({Name:t,Value:n});return e},doCreate:function(){var e;return e=this,t("dhcp_CreateDhcpOptions",{region_name:this.getCollection().region(),dhcp_configs:this.toAwsAttr()}).then(function(n){var r,i;try{i=n.CreateDhcpOptionsResponse.dhcpOptions.dhcpOptionsId}catch(s){throw r=s,McError(t.Errors.InvalidAwsReturn,"Dhcp created but aws returns invalid ata.")}return e.set("id",i),void 0,e})},doDestroy:function(){return t("dhcp_DeleteDhcpOptions",{region_name:this.getCollection().region(),dhcp_id:this.get("id")})}})})}.call(this),function(){define("cloudres/CrModelKeypair",["./CrModel","ApiRequest"],function(e,t){return e.extend({defaults:{keyName:"",keyData:"",keyMaterial:"",keyFingerprint:""},idAttribute:"keyName",taggable:!1,doCreate:function(){var e,n;return n=this,this.get("keyData")?e=t("kp_ImportKeyPair",{region_name:this.getCollection().region(),key_name:this.get("keyName"),key_data:this.get("keyData")}):e=t("kp_CreateKeyPair",{region_name:this.getCollection().region(),key_name:this.get("keyName")}),e.then(function(e){var r,i;try{e=e.CreateKeyPairResponse||e.ImportKeyPairResponse,n.set(e),i=e.keyName}catch(s){throw r=s,McError(t.Errors.InvalidAwsReturn,"Keypair created but aws returns invalid data.")}return n.set("keyName",i),void 0,n})},doDestroy:function(){return t("kp_DeleteKeyPair",{region_name:this.getCollection().region(),key_name:this.get("id")})}})})}.call(this),function(){define("cloudres/CrModelSslcert",["./CrModel","ApiRequest"],function(e,t){return e.extend({taggable:!1,defaults:{Path:"",Name:"",PrivateKey:"",CertificateChain:"",CertificateBody:""},doUpdate:function(e){var n;return n=this,t("iam_UpdateServerCertificate",{servercer_name:this.get("Name"),new_servercer_name:e.Name,new_path:e.Path}).then(function(t){var r,i;return i=n.get("Arn"),r=""+i.split("/")[0]+"/"+e.Name,n.set("Arn",r),n.set(e),n})},doCreate:function(){var e;return e=this,t("iam_UploadServerCertificate",{servercer_name:this.get("Name"),cert_body:this.get("CertificateBody"),private_key:this.get("PrivateKey"),cert_chain:this.get("CertificateChain"),path:this.get("Path")}).then(function(n){var r;e.attributes.CertificateChain="",e.attributes.PrivateKey="";try{n=n.UploadServerCertificateResponse.UploadServerCertificateResult.ServerCertificateMetadata,n.Arn=n.Arn,n.Expiration=n.Expiration,n.Path=n.Path,n.id=n.ServerCertificateId,n.Name=n.ServerCertificateName,n.UploadDate=n.UploadDate}catch(i){throw r=i,McError(t.Errors.InvalidAwsReturn,"Ssl cert created but aws returns invalid data.")}return e.set(n),void 0,e})},doDestroy:function(){return t("iam_DeleteServerCertificate",{servercer_name:this.get("Name")})}})})}.call(this),function(){define("cloudres/CrModelTopic",["./CrModel","ApiRequest"],function(e,t){return e.extend({taggable:!1,defaults:{Name:"",DisplayName:""},doCreate:function(){var e;return e=this,t("sns_CreateTopic",{region_name:this.getCollection().region(),topic_name:this.get("Name")}).then(function(n){var r,i;try{i=n.CreateTopicResponse.CreateTopicResult.TopicArn}catch(s){throw r=s,McError(t.Errors.InvalidAwsReturn,"Topic created but aws returns invalid ata.")}return e.set("id",i),void 0,e.get("DisplayName")&&setTimeout(function(){return t("sns_SetTopicAttributes",{region_name:e.getCollection().region(),topic_arn:i,attr_name:"DisplayName",attr_value:e.get("DisplayName")})},1e3),e})},doUpdate:function(e){var n;return n=this,t("sns_SetTopicAttributes",{region_name:this.getCollection().region(),topic_arn:this.get("id"),attr_name:"DisplayName",attr_value:e}).then(function(){return n.set("DisplayName",e),n})},doDestroy:function(){return t("sns_DeleteTopic",{region_name:this.getCollection().region(),topic_arn:this.get("id")})}})})}.call(this),function(){define("cloudres/CrModelSubscription",["./CrModel","ApiRequest"],function(e,t){var n;return n=e.extend({taggable:!1,defaults:{Endpoint:"",Protocol:"",TopicName:"",TopicArn:"",SubscriptionArn:""},initialize:function(e){e.TopicArn&&(this.attributes.TopicName=e.TopicArn.split(":").pop())},isRemovable:function(){return this.attributes.SubscriptionArn!=="PendingConfirmation"&&this.attributes.SubscriptionArn!=="Deleted"},set:function(e,t,n){e==="TopicArn"?this.attributes.TopicName=t.split(":").pop():e.TopicArn&&(this.attributes.TopicName=e.TopicArn.split(":").pop()),Backbone.Model.prototype.set.apply(this,arguments)},doCreate:function(){var e;return e=this,t("sns_Subscribe",{region_name:this.getCollection().region(),topic_arn:this.get("TopicArn"),protocol:this.get("Protocol"),endpoint:this.get("Endpoint")}).then(function(r){var i,s;try{r=r.SubscribeResponse.SubscribeResult,i=r.SubscriptionArn}catch(o){throw s=o,McError(t.Errors.InvalidAwsReturn,"Subscription created but aws returns invalid ata.")}return i==="pending confirmation"&&(i="PendingConfirmation"),e.set({id:n.getIdFromData(e.attributes),SubscriptionArn:i}),void 0,e})},doDestroy:function(){var e;return this.isRemovable()?t("sns_Unsubscribe",{region_name:this.getCollection().region(),sub_arn:this.get("SubscriptionArn")}):(e=Q.defer(),e.resolve(McError(t.Errors.InvalidMethodCall,"Cannot unsubscribe pending subscription.",self)),e.promise)}},{getIdFromData:function(e){return(""+e.TopicArn+":"+e.Protocol+":"+e.Endpoint).replace("arn:aws:sns:","")}}),n})}.call(this),function(){define("cloudres/CrModelSnapshot",["./CrModel","CloudResources","ApiRequest"],function(e,t,n){return e.extend({defaults:{volumeId:"",status:"pending",startTime:"",progress:0,ownerId:"",volumeSize:1,description:"",name:""},isComplete:function(){return this.attributes.status==="completed"},isPending:function(){return this.attributes.status==="pending"},doCreate:function(){var e;return e=this,n("ebs_CreateSnapshot",{region_name:this.getCollection().region(),volume_id:this.get("volumeId"),description:this.get("description")}).then(function(t){var r;try{t=t.CreateSnapshotResponse,t.id=t.snapshotId,t.progress=t.progress||0,delete t.snapshotId,delete t["@attributes"]}catch(i){throw r=i,McError(n.Errors.InvalidAwsReturn,"Snapshot created but aws returns invalid ata.")}return e.set(t),e.getCollection().startPollingStatus(),void 0,e})},set:function(e,t){e.progress&&(e.progress=parseInt(e.progress,10)||0),e.volumeSize&&(e.volumeSize=parseInt(e.volumeSize,10)||1),Backbone.Model.prototype.set.apply(this,arguments)},copyTo:function(e,r,i){var s;return s=this,n("ebs_CopySnapshot",{region_name:this.getCollection().region(),snapshot_id:this.get("id"),dst_region_name:e,description:i}).then(function(o){var u,a,f,l,c;a=(c=o.CopySnapshotResponse)!=null?c.snapshotId:void 0;if(!a)throw McError(n.Errors.InvalidAwsReturn,"Snapshot copied but aws returns invalid data.");return l=t(s.collection.type,e),u=s.toJSON(),u.name=r,u.description=i,u.region=e,u.id=a,f=l.create(u),l.add(f),f.tagResource(),f})},doDestroy:function(){return n("ebs_DeleteSnapshot",{region_name:this.getCollection().region(),snapshot_id:this.get("id")})},tagResource:function(){var e;return e=this,n("ec2_CreateTags",{region_name:this.getCollection().region(),resource_ids:[this.get("id")],tags:[{Name:"Created by",Value:App.user.get("username")},{Name:"Name",Value:this.get("name")}]}).then(function(){void 0})}})})}.call(this),function(){define("cloudres/CrClnSharedRes",["./CrCollection","CloudResources","ApiRequest","constant","./CrModelDhcp","./CrModelKeypair","./CrModelSslcert","./CrModelTopic","./CrModelSubscription","./CrModelSnapshot"],function(e,t,n,r,i,s,o,u,a,f){return e.extend({type:r.RESTYPE.DHCP,model:i,doFetch:function(){return n("dhcp_DescribeDhcpOptions",{region_name:this.region()})},trAwsXml:function(e){var t;return(t=e.DescribeDhcpOptionsResponse.dhcpOptionsSet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.dhcpOptionsId;return e}}),e.extend({type:r.RESTYPE.KP,model:s,doFetch:function(){return n("kp_DescribeKeyPairs",{region_name:this.region()})},trAwsXml:function(e){var t;return(t=e.DescribeKeyPairsResponse.keySet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.keyName;return e}}),e.extend({type:r.RESTYPE.IAM,model:o,doFetch:function(){return n("iam_ListServerCertificates")},trAwsXml:function(e){var t;return(t=e.ListServerCertificatesResponse.ListServerCertificatesResult.ServerCertificateMetadataList)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.ServerCertificateId,t.Name=t.ServerCertificateName,delete t.ServerCertificateName,delete t.ServerCertificateId;return e}},{category:function(){return""}}),e.extend({type:r.RESTYPE.TOPIC,model:u,constructor:function(){return this.on("remove",this.__clearSubscription),e.apply(this,arguments)},doFetch:function(){return n("sns_ListTopics",{region_name:this.region()})},trAwsXml:function(e){var t;return(t=e.ListTopicsResponse.ListTopicsResult.Topics)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.TopicArn,t.Name=t.TopicArn.split(":").pop(),delete t.TopicArn;return e},__clearSubscription:function(e,n,i){var s,o,u,a,f,l;o=t(r.RESTYPE.SUBSCRIPTION,this.region()),s=[],l=o.models;for(a=0,f=l.length;a<f;a++)u=l[a],u.get("TopicArn")===e.id&&s.push(u);s.length&&o.remove(s)},filterEmptySubs:function(){var e,n,i,s,o,u;n=t(r.RESTYPE.SUBSCRIPTION,this.category),i={},u=n.models;for(s=0,o=u.length;s<o;s++)e=u[s],i[e.get("TopicArn")]=!0;return this.filter(function(e){return!i[e.get("id")]})}}),e.extend({type:r.RESTYPE.SUBSCRIPTION,model:a,doFetch:function(){return n("sns_ListSubscriptions",{region_name:this.region()})},trAwsXml:function(e){var t;return(t=e.ListSubscriptionsResponse.ListSubscriptionsResult.Subscriptions)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=a.getIdFromData(t);return e}}),e.extend({type:r.RESTYPE.SNAP,model:f,initialize:function(){this.__pollingStatus=_.bind(this.__pollingStatus,this)},doFetch:function(){return n("ebs_DescribeSnapshots",{region_name:this.region(),owners:["self"]})},trAwsXml:function(e){var t;return(t=e.DescribeSnapshotsResponse.snapshotSet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.snapshotId,t.tagSet&&(t.name=t.tagSet.Name||t.tagSet.name||"",delete t.tagSet),delete t.snapshotId,t.status==="pending"&&this.startPollingStatus();return e},startPollingStatus:function(){if(this.__polling)return;this.__polling=setTimeout(this.__pollingStatus,2e3)},stopPollingStatus:function(){clearTimeout(this.__polling),this.__polling=null},__pollingStatus:function(){var e;return e=this,n("ebs_DescribeSnapshots",{region_name:this.region(),owners:["self"],filters:[{Name:"status",Value:["pending"]}]}).then(function(t){e.__polling=null,e.__parsePolling(t)},function(){return e.__polling=null,e.startPollingStatus()})},__parsePolling:function(e){var t,n,r,i,s,o;e=e.DescribeSnapshotsResponse.snapshotSet,t={progress:100,status:"completed"},r={};if(e!==null&&e.item){this.startPollingStatus(),o=e.item;for(i=0,s=o.length;i<s;i++)n=o[i],r[n.snapshotId]={progress:n.progress}}this.where({status:"pending"}).forEach(function(e){return e.set(r[e.get("id")]||t)})}})})}.call(this),function(){define("cloudres/CrCommonCollection",["ApiRequest","./CrCollection","./CrModel","constant"],function(e,t,n,r){var i,s;return s=[],i=t.extend({model:n,type:"CrCommonCollection",__selfParseData:!0,groupByCategory:function(e,t){var n,i,s,o,u,a,f,l,c,h,p,d,v,m;e=e||{includeEmptyRegion:!0,calcSum:!0,toJSON:!1},a={},v=this.models;for(c=0,p=v.length;c<p;c++){s=v[c];if(t&&t(s)===!1)continue;u=s.attributes.category,i=a[u]||(a[u]=[]),i.push(e.toJSON?s.toJSON():s)}l=0,f=[],m=r.REGION_KEYS;for(h=0,d=m.length;h<d;h++){n=m[h],o=a[n];if(o)l+=o.length;else if(!e.includeEmptyRegion)continue;f.push({region:n,regionName:r.REGION_SHORT_LABEL[n],regionArea:r.REGION_LABEL[n],data:o||[]})}return e.calcSum&&(f.totalCount=l),f},doFetch:function(){var t,n;return t={},t[this.type]={},n=this,e("aws_resource",{region_name:null,resources:t,addition:"all",retry_times:1}).then(function(e){var t,r,i,o,u,a,f,l,c;u=[];for(o in e){r=e[o];if(!r[0])continue;try{a=$.xml2json($.parseXML(r[0])),n.trAwsXml&&(a=n.trAwsXml(a)),n.parseFetchData&&a&&(a=n.parseFetchData(a,o)),c=a||s;for(f=0,l=c.length;f<l;f++)t=c[f],t.visopsTag=n.resolveTagSet(t.tagSet),n.modelIdAttribute&&(t.id=t[n.modelIdAttribute],delete t[n.modelIdAttribute]),t.category=o,u.push(new n.model(t))}catch(h){i=h;continue}}return u})}},{category:function(){return""}}),i})}.call(this),function(){define("cloudres/CrModelElb",["./CrModel","ApiRequest"],function(e,t){return e.extend({initialize:function(){var e;e=this,t("elb_DescribeInstanceHealth",{region_name:this.get("category"),elb_name:this.get("Name")}).then(function(t){return e.onInsHealthData(t)})},onInsHealthData:function(e){var t;e=e.DescribeInstanceHealthResponse;if(!e)return;e=e.DescribeInstanceHealthResult;if(!e)return;e=(t=e.InstanceStates)!=null?t.member:void 0;if(!e)return;this.set("InstanceStates",e)}})})}.call(this),function(){define("cloudres/CrClnCommonRes",["./CrCommonCollection","./CrCollection","./CrModel","./CrModelElb","ApiRequest","constant","CloudResources"],function(e,t,n,r,i,s,o){return e.extend({type:s.RESTYPE.ELB,model:r,trAwsXml:function(e){var t;return(t=e.DescribeLoadBalancersResponse.DescribeLoadBalancersResult.LoadBalancerDescriptions)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m;for(u=0,f=e.length;u<f;u++){t=e[u];for(s in t)o=t[s],n=s.substring(0,1).toUpperCase()+s.substring(1),delete t[s],t[n]=o;t.id=t.LoadBalancerName,t.AvailabilityZones=((c=t.AvailabilityZones)!=null?c.member:void 0)||[],t.Instances=((h=t.Instances)!=null?h.member:void 0)||[],t.SecurityGroups=((p=t.SecurityGroups)!=null?p.member:void 0)||[],t.Subnets=((d=t.Subnets)!=null?d.member:void 0)||[],t.ListenerDescriptions=((v=t.ListenerDescriptions)!=null?v.member:void 0)||[],m=t.Instances;for(i=a=0,l=m.length;a<l;i=++a)r=m[i],t.Instances[i]=r.InstanceId;t.vpcId=t.VPCId,t.id=t.DNSName,t.Name=t.LoadBalancerName,delete t.VPCId}return e},parseExternalData:function(e){return this.camelToPascal(e),this.unifyApi(e,this.type),this.convertNumTimeToString(e),_.each(e,function(e){return e.Instances=_.map(e.Instances,function(e){return e.InstanceId}),e.ListenerDescriptions=_.map(e.ListenerDescriptions,function(e){return e.PolicyNames={member:e.PolicyNames},e}),e.vpcId=e.Vpcid,delete e.Vpcid,e.id=e.Dnsname,e.Name=e.LoadBalancerName}),e}}),e.extend({type:s.RESTYPE.VPN,trAwsXml:function(e){var t;return(t=e.DescribeVpnConnectionsResponse.vpnConnectionSet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r,i,s;i=e||[];for(n=0,r=i.length;n<r;n++)t=i[n],t.vgwTelemetry=((s=t.vgwTelemetry)!=null?s.item:void 0)||[],t.id=t.vpnConnectionId;return e},parseExternalData:function(e){var t,n,r,i;this.unifyApi(e,this.type),i=e||[];for(n=0,r=i.length;n<r;n++)t=i[n],t.id=t.vpnConnectionId;return e}}),e.extend({type:s.RESTYPE.EIP,trAwsXml:function(e){var t;return(t=e.DescribeAddressesResponse.addressesSet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.allocationId;return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.allocationId;return e}}),e.extend({type:s.RESTYPE.VPC,trAwsXml:function(e){var t;return(t=e.DescribeVpcsResponse.vpcSet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.vpcId;return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.vpcId;return e}}),e.extend({type:s.RESTYPE.ASG,modelIdAttribute:"AutoScalingGroupARN",trAwsXml:function(e){var t;return(t=e.DescribeAutoScalingGroupsResponse.DescribeAutoScalingGroupsResult.AutoScalingGroups)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r,i,s,o,u;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.AutoScalingGroupARN,t.Name=t.AutoScalingGroupName,t.AvailabilityZones=((i=t.AvailabilityZones)!=null?i.member:void 0)||[],t.Instances=((s=t.Instances)!=null?s.member:void 0)||[],t.LoadBalancerNames=((o=t.LoadBalancerNames)!=null?o.member:void 0)||[],t.TerminationPolicies=((u=t.TerminationPolicies)!=null?u.member:void 0)||[],t.Subnets=(t.VPCZoneIdentifier||t.VpczoneIdentifier||"").split(",");return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type),this.camelToPascal(e);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.AutoScalingGroupARN,t.Name=t.AutoScalingGroupName,t.DefaultCooldown=String(t.DefaultCooldown),t.DesiredCapacity=String(t.DesiredCapacity),t.HealthCheckGracePeriod=String(t.HealthCheckGracePeriod),t.MaxSize=String(t.MaxSize),t.MinSize=String(t.MinSize),t.Subnets=(t.VPCZoneIdentifier||t.VpczoneIdentifier).split(",");return e}}),e.extend({type:s.RESTYPE.CW,trAwsXml:function(e){var t;return(t=e.DescribeAlarmsResponse.DescribeAlarmsResult.MetricAlarms)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r,i,s;for(n=0,r=e.length;n<r;n++)t=e[n],t.Dimensions=((i=t.Dimensions)!=null?i.member:void 0)||[],t.AlarmActions=((s=t.AlarmActions)!=null?s.member:void 0)||[],t.id=t.AlarmArn,t.Name=t.AlarmName;return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type),this.camelToPascal(e);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.AlarmArn,t.Name=t.AlarmName;return e}}),e.extend({type:s.RESTYPE.CGW,trAwsXml:function(e){var t;return(t=e.DescribeCustomerGatewaysResponse.customerGatewaySet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.customerGatewayId;return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.customerGatewayId;return e}}),e.extend({type:s.RESTYPE.VGW,trAwsXml:function(e){var t;return(t=e.DescribeVpnGatewaysResponse.vpnGatewaySet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.vpnGatewayId,t.attachments&&t.attachments.length>0&&(t.vpcId=t.attachments[0].vpcId,t.attachmentState=t.attachments[0].state);return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.vpnGatewayId,t.attachments&&t.attachments.length>0&&(t.vpcId=t.attachments[0].vpcId,t.attachmentState=t.attachments[0].state);return e}}),e.extend({type:s.RESTYPE.IGW,trAwsXml:function(e){var t;return(t=e.DescribeInternetGatewaysResponse.internetGatewaySet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r,i;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.internetGatewayId,t.attachmentSet=((i=t.attachmentSet)!=null?i.item:void 0)||t.attachments||[],t.attachmentSet&&t.attachmentSet.length>0&&(t.vpcId=t.attachmentSet[0].vpcId,t.state=t.attachmentSet[0].state);return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.internetGatewayId,t.attachmentSet&&t.attachmentSet.length>0&&(t.vpcId=t.attachmentSet[0].vpcId,t.state=t.attachmentSet[0].state);return e}}),e.extend({type:s.RESTYPE.RT,trAwsXml:function(e){var t;return(t=e.DescribeRouteTablesResponse.routeTableSet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;for(a=0,c=e.length;a<c;a++){u=e[a],u.routeSet=((d=u.routeSet)!=null?d.item:void 0)||[],u.associationSet=((v=u.associationSet)!=null?v.item:void 0)||[],u.propagatingVgwSet=((m=u.propagatingVgwSet)!=null?m.item:void 0)||[],n=-1,g=u.routeSet;for(r=f=0,h=g.length;f<h;r=++f)o=g[r],o.gatewayId==="local"&&(n=r);n>0&&(i=u.routeSet.splice(n,1),u.routeSet.splice(0,0,i[0])),n=-1,y=u.associationSet;for(r=l=0,p=y.length;l<p;r=++l)t=y[r],t.main&&n===-1&&(n=r);n>0&&(s=u.associationSet.splice(n,1),u.associationSet.splice(0,0,s[0])),u.id=u.routeTableId}return e},parseExternalData:function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;this.unifyApi(e,this.type);for(a=0,c=e.length;a<c;a++){u=e[a],n=-1,d=u.routeSet;for(r=f=0,h=d.length;f<h;r=++f)o=d[r],o.gatewayId==="local"&&n===-1&&(n=r);n>0&&(i=u.routeSet.splice(n,1),u.routeSet.splice(0,0,i[0])),n=-1,v=u.associationSet;for(r=l=0,p=v.length;l<p;r=++l)t=v[r],t.main&&n===-1&&(n=r);n>0&&(s=u.associationSet.splice(n,1),u.associationSet.splice(0,0,s[0])),u.id=u.routeTableId}return e}}),e.extend({initialize:function(){this.listenTo(this,"add",function(e){return o(s.RESTYPE.AMI,e.attributes.category).fetchAmi(e.attributes.imageId)})},type:s.RESTYPE.INSTANCE,trAwsXml:function(e){var t,n,r,i,s,o,u,a,f,l,c;r=[],f=((a=e.DescribeInstancesResponse.reservationSet)!=null?a.item:void 0)||[];for(i=0,o=f.length;i<o;i++){t=f[i],c=((l=t.instancesSet)!=null?l.item:void 0)||[];for(s=0,u=c.length;s<u;s++)n=c[s],r.push(n)}return r},parseFetchData:function(e,t){var n,r,i,s,o,u,a;for(r=0,i=e.length;r<i;r++){n=e[r];if(n.tagSet)if(n.tagSet["aws:elasticmapreduce:instance-group-role"]||n.tagSet["aws:elasticmapreduce:job-flow-id"]){void 0;continue}n.id=n.instanceId;if(!(!n.instanceState||(s=n.instanceState.name)!=="terminated"&&s!=="shutting-down"))continue;n.blockDeviceMapping=((o=n.blockDeviceMapping)!=null?o.item:void 0)||[],n.networkInterfaceSet=((u=n.networkInterfaceSet)!=null?u.item:void 0)||[],n.groupSet=((a=n.groupSet)!=null?a.item:void 0)||[],n.blockDeviceMapping&&n.blockDeviceMapping.length>1&&(n.blockDeviceMapping=n.blockDeviceMapping.sort(MC.createCompareFn("deviceName")))}return e},parseExternalData:function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;this.convertNumTimeToString(e),this.unifyApi(e,this.type);for(s=0,a=e.length;s<a;s++){r=e[s];if(r.tags){c=r.tags;for(o=0,f=c.length;o<f;o++){i=c[o];if(i.key==="aws:elasticmapreduce:instance-group-role"||i.key==="aws:elasticmapreduce:job-flow-id"){void 0;continue}}}r.id=r.instanceId;if(!(!r.instanceState||(h=r.instanceState.name)!=="terminated"&&h!=="shutting-down"))continue;p=r.networkInterfaceSet;for(u=0,l=p.length;u<l;u++)n=p[u],n.privateIpAddresses&&(n.privateIpAddressesSet={item:n.privateIpAddresses},delete n.privateIpAddresses),n.groups&&(n.groupSet={item:n.groups},delete n.groups);r.blockDeviceMapping&&r.blockDeviceMapping.length>1&&(r.blockDeviceMapping=r.blockDeviceMapping.sort(MC.createCompareFn("deviceName")))}return e}}),e.extend({type:s.RESTYPE.VOL,trAwsXml:function(e){var t;return(t=e.DescribeVolumesResponse.volumeSet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r,i;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.volumeId,t.attachmentSet=((i=t.attachmentSet)!=null?i.item:void 0)||[],_.each(t.attachmentSet,function(e,n){var r,i;return i=t.status,r=e.status,_.extend(t,e),t.status=i,t.attachmentStatus=r});return e},parseExternalData:function(e){var t,n,r;this.convertNumTimeToString(e),this.unifyApi(e,this.type);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.volumeId,_.each(t.attachmentSet,function(e,n){var r,i;return i=t.state,r=e.state,_.extend(t,e),t.status=i,t.attachmentStatus=r});return e}}),e.extend({type:s.RESTYPE.LC,AwsResponseType:"DescribeLaunchConfigurationsResponse",trAwsXml:function(e){var t;return(t=e.DescribeLaunchConfigurationsResponse.DescribeLaunchConfigurationsResult.LaunchConfigurations)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r,i,s;for(n=0,r=e.length;n<r;n++)t=e[n],t.BlockDeviceMapping=((i=t.BlockDeviceMappings)!=null?i.member:void 0)||[],t.SecurityGroups=((s=t.SecurityGroups)!=null?s.member:void 0)||[],t.BlockDeviceMapping&&t.BlockDeviceMapping.length>1&&(t.BlockDeviceMapping=t.BlockDeviceMapping.sort(MC.createCompareFn("DeviceName"))),t.id=t.LaunchConfigurationARN,t.Name=t.LaunchConfigurationName;return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type),this.camelToPascal(e);for(n=0,r=e.length;n<r;n++)t=e[n],t.BlockDeviceMapping&&t.BlockDeviceMapping.length>1&&(t.BlockDeviceMapping=t.BlockDeviceMapping.sort(MC.createCompareFn("DeviceName"))),t.id=t.LaunchConfigurationARN,t.Name=t.LaunchConfigurationName;return e}}),e.extend({type:s.RESTYPE.SP,AwsResponseType:"DescribePoliciesResponse",trAwsXml:function(e){var t;return(t=e.DescribePoliciesResponse.DescribePoliciesResult.ScalingPolicies)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.PolicyARN,t.Name=t.PolicyName;return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type),this.camelToPascal(e);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.PolicyARN,t.Name=t.PolicyName,t.Cooldown=t.Cooldown?t.Cooldown.toString():"";return e}}),e.extend({type:s.RESTYPE.AZ,AwsResponseType:"DescribeAvailabilityZonesResponse",trAwsXml:function(e){var t;return(t=e.DescribeAvailabilityZonesResponse.availabilityZoneInfo)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.zoneName;return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.zoneName;return e}}),e.extend({type:s.RESTYPE.NC,AwsResponseType:"DescribeNotificationConfigurationsResponse",trAwsXml:function(e){var t;return(t=e.DescribeNotificationConfigurationsResponse.DescribeNotificationConfigurationsResult.NotificationConfigurations)!=null?t.member:void 0},parseFetchData:function(e){var t,n,r,i,s,o,u;s=[],i={};for(o=0,u=e.length;o<u;o++)r=e[o],n=i[t]||(i[t]={}),t=n.AutoScalingGroupName+"-"+n.TopicARN,n?n.NotificationType.push(r.NotificationType):(n=i[t]={id:t,AutoScalingGroupName:r.AutoScalingGroupName,TopicARN:r.TopicARN,NotificationType:[r.NotificationType]},s.push(n));return s},parseExternalData:function(e){var t,n,r,i,s,o;this.unifyApi(e,this.type),this.camelToPascal(e),i=[];for(s=0,o=e.length;s<o;s++)r=e[s],t=r[0],n={AutoScalingGroupName:t.AutoScalingGroupName,TopicARN:t.TopicARN,NotificationType:_.pluck(r,"NotificationType")},n.id=n.AutoScalingGroupName+"-"+n.TopicARN,i.push(n);return i}}),e.extend({type:s.RESTYPE.ACL,AwsResponseType:"DescribeNetworkAclsResponse",trAwsXml:function(e){var t;return(t=e.DescribeNetworkAclsResponse.networkAclSet)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r,i,s;for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.networkAclId,t.entrySet=((i=t.entrySet)!=null?i.item:void 0)||[],t.associationSet=((s=t.associationSet)!=null?s.item:void 0)||[],t.associationSet.length>0&&(t.subnetId=t.associationSet[0].subnetId);return e},parseExternalData:function(e){var t,n,r;this.unifyApi(e,this.type);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.networkAclId,t.associationSet.length>0&&(t.subnetId=t.associationSet[0].subnetId);return e}}),t.extend({type:s.RESTYPE.ENI,AwsResponseType:"DescribeNetworkInterfacesResponse",doFetch:function(){return i("eni_DescribeNetworkInterfaces",{region_name:this.region()})},trAwsXml:function(e){var t;return(t=e.DescribeNetworkInterfacesResponse.networkInterfaceSet)!=null?t.item:void 0},parseFetchData:function(e){return _.each(e,function(t,n){return t.id=t.networkInterfaceId,_.each(t,function(t,r){var i,s;r==="groupSet"&&(e[n].groupSet=((i=e[n].groupSet)!=null?i.item:void 0)||[]);if(r==="privateIpAddressesSet")return e[n].privateIpAddressesSet=((s=e[n].privateIpAddressesSet)!=null?s.item:void 0)||[]})}),e},parseExternalData:function(e){return this.convertNumTimeToString(e),this.unifyApi(e,this.type),_.each(e,function(e,t){return e.id=e.networkInterfaceId}),e}}),t.extend({type:s.RESTYPE.SUBNET,doFetch:function(){return i("subnet_DescribeSubnets",{region_name:this.region()})},trAwsXml:function(e){var t;return(t=e.DescribeSubnetsResponse.subnetSet)!=null?t.item:void 0},parseFetchData:function(e){return _.each(e,function(e,t){return e.id=e.subnetId}),e},parseExternalData:function(e){return this.unifyApi(e,this.type),_.each(e,function(e,t){return e.id=e.subnetId}),e}}),t.extend({type:s.RESTYPE.SG,AwsResponseType:"DescribeSecurityGroupsResponse",doFetch:function(){return i("sg_DescribeSecurityGroups",{region_name:this.region()})},trAwsXml:function(e){var t;return(t=e.DescribeSecurityGroupsResponse.securityGroupInfo)!=null?t.item:void 0},parseFetchData:function(e){var t,n,r,i,s;for(n=0,r=e.length;n<r;n++)t=e[n],t.ipPermissions=((i=t.ipPermissions)!=null?i.item:void 0)||[],_.each(t.ipPermissions,function(e,n){return _.each(e,function(e,r){if(r==="groups"||r==="ipRanges")return t.ipPermissions[n][r]=(e!=null?e.item:void 0)||[]})}),t.ipPermissionsEgress=((s=t.ipPermissionsEgress)!=null?s.item:void 0)||[],_.each(t.ipPermissionsEgress,function(e,n){return _.each(e,function(e,r){if(r==="groups"||r==="ipRanges")return t.ipPermissionsEgress[n][r]=(e!=null?e.item:void 0)||[]})}),t.id=t.groupId,t.Name=t.groupName;return e},parseExternalData:function(e){var t,n,r,i;this.unifyApi(e,this.type),this.convertNumTimeToString(e);for(r=0,i=e.length;r<i;r++)t=e[r],t.groupName=t.groupName.trim(),t.id=t.groupId,t.Name=t.groupName,t.ipPermissions=t.ipPermissions||[],t.ipPermissionsEgress=t.ipPermissionsEgress||[],n=t.ipPermissions.concat(t.ipPermissionsEgress),_.each(n,function(e,t){e.ipRanges&&e.ipRanges.length&&(e.ipRanges=_.map(e.ipRanges,function(e){return{cidrIp:e}})),e.groups=[];if(e.userIdGroupPairs)return e.groups=e.userIdGroupPairs,delete e.userIdGroupPairs});return e}})})}.call(this),function(){define("cloudres/CrClnOpsResource",["ApiRequest","./CrCollection","constant","CloudResources"],function(e,t,n,r){return t.extend({type:"OpsResource",init:function(e){return this.__region=e,this},fetchForceDedup:function(){var e;return this.__forceDedup=!1,e=this.fetchForce(),this.__forceDedup=!0,e},fetchForce:function(){var e;return this.__forceDedup?(this.__forceDedup=!1,e=Q.defer(),e.resolve(),e.promise):(this.generatedJson=null,t.prototype.fetchForce.call(this))},doFetch:function(){var t;return t=this,r.clearWhere(function(e){return e.RES_TAG===t.category},this.__region),void 0,e("resource_vpc_resource",{region_name:this.__region,vpc_id:this.category})},parseFetchData:function(e){var t,i,s,o,u,a,f,l,c;delete e.vpc,t=e.app_json,delete e.app_json,a={RES_TAG:this.category};for(l in e){o=e[l],i=r(l,this.__region);if(!i){void 0;continue}i.__parseExternalData(o,a,this.__region)}if(t){this.generatedJson=t;if(!t.agent.module.repo||!t.agent.module.tag)this.generatedJson.agent.module.repo=App.user.get("repo"),this.generatedJson.agent.module.tag=App.user.get("tag");void 0,c=this.generatedJson.component;for(f in c)s=c[f],s.type===n.RESTYPE.ENI&&(u=r(n.RESTYPE.ENI,this.__region).where({id:s.resource.NetworkInterfaceId}),u&&u.length>0&&!s.resource.Attachment.AttachmentId&&(u=u[0].attributes,s.resource.Attachment.AttachmentId=u.attachment.attachmentId,void 0)),null}},__generateJsonFromRes:function(e){var t,n;return n=r.getAllResourcesForVpc(this.__region,this.category,e),t={id:"",name:this.category,description:"",region:this.__region,platform:"ec2-vpc",state:"Enabled",version:"2014-02-17",component:{},layout:{size:[240,240]},agent:{enabled:!0,module:{repo:App.user.get("repo"),tag:App.user.get("tag")}},property:{stoppable:!0}},t.component=n.component,t.layout=n.layout,t.name=e?e.name:"imported-"+this.category,t}})})}.call(this),function(){define("cloudres/CrClnAmi",["ApiRequest","./CrCollection","constant","CloudResources"],function(e,t,n,r){var i,s,o,u,a,f,l,c,h;return o=["centos","redhat","rhel","ubuntu","debian","fedora","gentoo","opensuse","suse","amazon","amzn"],a=/sql.*?web.*?/i,u=/sql.*?standard.*?/i,i=/\[(.+?)\]/,s=/\s["|'](.+?)["|']/,h=function(e){var t,n,r,i,s,u,a,f,l;if(e.osType)return e.osType;if(e.platform==="windows")return"windows";r=(e.name||"").toLowerCase(),t=(e.description||"").toLowerCase(),n=(e.imageLocation||"").toLowerCase();for(f=0,l=o.length;f<l;f++){a=o[f];if(r.indexOf(a)>=0){i=a;break}t.indexOf(a)>=0&&(s=a),n.indexOf(a)>=0&&(u=a)}return i=i||s||u||"linux-other",i==="rhel"?"redhat":i==="amzn"?"amazon":i},c=function(e){var t;return e.osType?(t=e.osType,t==="windows"||t==="win"?a.exec(e.name||"")||a.exec(e.description||"")||a.exec(e.imageLocation||"")?"mswinSQLWeb":u.exec(e.name||"")||u.exec(e.description||"")||u.exec(e.imageLocation||"")?"mswinSQL":"mswin":n.OS_TYPE_MAPPING[t]||"linux"):"linux"},l=function(e){var t,n,r,i,s,o,u,a,f,l;i=[];for(s=0,u=e.length;s<u;s++){t=e[s],t.id=t.imageId,delete t.imageId,n={},l=((f=t.blockDeviceMapping)!=null?f.item:void 0)||[];for(o=0,a=l.length;o<a;o++)r=l[o],n[r.deviceName]=r.ebs||{};t.osType=h(t),t.osFamily=c(t),t.blockDeviceMapping=n,i.push(t.id)}return i},t.extend({type:n.RESTYPE.AMI,__selfParseData:!0,initialize:function(){var e,t,n,r,i;t=localStorage.getItem("invalidAmi/"+this.region()),this.__markedIds={};if(t){i=t.split(",");for(n=0,r=i.length;n<r;n++)e=i[n],this.__markedIds[e]=!0}},doFetch:function(){var e;return localStorage.setItem("invalidAmi/"+this.region(),""),this.__markedIds={},e=Q.defer(),e.resolve([]),this.trigger("update"),e.promise},markId:function(e,t){this.__markedIds[e]=t},isIdMarked:function(e){return this.__markedIds.hasOwnProperty(e)},isInvalidAmiId:function(e){return this.__markedIds[e]},getOSFamily:function(e){return c(this.get(e))},saveInvalidAmiId:function(){var e,t,n,r;t=[],r=this.__markedIds;for(e in r)n=r[e],n&&t.push(e);return localStorage.setItem("invalidAmi/"+this.region(),t.join(","))},fetchAmi:function(e){var t;if(!e)return;void 0;if(this.__toFetch){this.__toFetch.push(e);return}this.__toFetch=[e],t=this,setTimeout(function(){var e;return e=t.__toFetch,t.__toFetch=null,t.fetchAmis(e)},0)},fetchAmis:function(t){var n,r,o,u,a,f;if(!t)return;_.isString(t)&&(void 0,t=[t]),u=[];for(a=0,f=t.length;a<f;a++){n=t[a];if(this.get(n))continue;if(this.isIdMarked(n)){this.__markedIds[n]?void 0:void 0;continue}this.markId(n,!1),u.push(n)}return u.length===0?(r=Q.defer(),r.resolve(),r.promise):(o=this,e("ami_DescribeImages",{region_name:this.region(),ami_ids:u}).then(function(e){var t;return e=(t=e.DescribeImagesResponse.imagesSet)!=null?t.item:void 0,e?(l(e),o.add(e,{add:!0,merge:!0,remove:!1})):o.trigger("update"),o.saveInvalidAmiId()},function(t){var n,r,a;t.awsErrorCode==="InvalidAMIID.NotFound"?n=i.exec(t.awsResult):t.awsErrorCode==="InvalidAMIID.Malformed"&&(n=s.exec(t.awsResult));if(!n)throw McError(e.Errors.InvalidAwsReturn,"Can't describe AMIs and AWS returns invalid data. Please contact us when you encouter this issue.",u);return n=n[1],void 0,u.splice(u.indexOf(n),1),o.markId(n,!0),a=this.__markedIds,this.__markedIds={},r=o.fetchAmis(u),this.__markedIds=a,r}))}}),f=t.extend({type:"SpecificAmiCollection",initialize:function(){this.__models=[]},getModels:function(){var e,t,i,s,o,u;i=[],e=r(n.RESTYPE.AMI,this.region()),u=this.__models;for(s=0,o=u.length;s<o;s++)t=u[s],i.push(e.get(t));return i},fetchForce:function(){return this.__models=[],t.prototype.fetchForce.call(this)}}),f.extend({type:"QuickStartAmi",doFetch:function(){return e("aws_quickstart",{region_name:this.region()})},parseFetchData:function(e){var t,i,s,o,u;o=[],i=[];for(s in e){t=e[s];if(t.architecture==="i386"||t.name.indexOf("by VisualOps")===-1&&(u=t.osType)!=="windows"&&u!=="suse")continue;t.id=s,o.push(t),i.push(s)}r(n.RESTYPE.AMI,this.region()).add(o),this.__models=i}}),f.extend({type:"MyAmi",doFetch:function(){var t,n,r;return n={region_name:this.region(),executable_by:["self"],filters:[{Name:"is-public",Value:!1}]},r={region_name:this.region(),owners:["self"]},t=this,Q.allSettled([e("ami_DescribeImages",n),e("ami_DescribeImages",r)]).spread(function(e,n){var r,i;return e=((r=e.value.DescribeImagesResponse.imagesSet)!=null?r.item:void 0)||[],n=((i=n.value.DescribeImagesResponse.imagesSet)!=null?i.item:void 0)||[],t.onFetch(e.concat(n))},function(e,n){var r,i,s,o;e.state==="fulfilled"&&(r=(s=e.value.DescribeImagesResponse.imagesSet)!=null?s.item:void 0),n.state==="fulfilled"&&(i=(o=n.value.DescribeImagesResponse.imagesSet)!=null?o.item:void 0),(r||i)&&t.onFetch([].concat(r||[],i||[]));if(r.state==="rejected")throw r;if(i.state==="rejected")throw i})},onFetch:function(e){this.__models=l(e),r(n.RESTYPE.AMI,this.region()).add(e)},parseFetchData:function(e){var t,i,s,o,u,a;o=[],i=[];for(u=0,a=e.length;u<a;u++){t=e[u];try{t.id=t.imageId,delete t.imageId,o.push(t),i.push(t.id)}catch(f){s=f}}r(n.RESTYPE.AMI,this.region()).add(o),this.__models=i}}),f.extend({type:"FavoriteAmi",doFetch:function(){return e("favorite_info",{region_name:this.region(),provider:"AWS",service:"EC2",resource:"AMI"})},parseFetchData:function(e){var t,i,s,o,u;s=[],i=[];for(o=0,u=e.length;o<u;o++)t=e[o],$.isEmptyObject(t.blockDeviceMapping)&&(t.blockDeviceMapping=null),s.push(t),i.push(t.id);r(n.RESTYPE.AMI,this.region()).add(s),this.__models=i},unfav:function(t){var n,r,i;return i=this,r=this.__models.indexOf(t),r===-1?(n=Q.defer(),n.resolve(),n.promise):e("favorite_remove",{resource_ids:[t]}).then(function(){return r=i.__models.indexOf(t),i.__models.splice(r,1),i.trigger("update"),i})},fav:function(t){var i,s;return _.isString(t)?(i=t,t=""):(t=$.extend({},t),i=t.id),s=this,e("favorite_add",{resource:{id:i,provider:"AWS",resource:"AMI",service:"EC2"}}).then(function(){return s.__models.push(i),t&&r(n.RESTYPE.AMI,s.region()).add(t,{add:!0,merge:!0,remove:!1}),s.trigger("update"),s})}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("cloudres/CloudImportVpc",["CloudResources","cloudres/CrCollection","constant","ApiRequest","DiffTree"],function(t,n,r,i,s){var o,u,a,f,l,c,h,p,d;u=function(e,t){return e?t?"@{"+(e.uid||e)+"."+t+"}":"@{"+(e.uid||e)+".r.p}":""},c=MC.guid,o=function(e,t){var n;return n=r.AWS_RESOURCE_KEY[t],e[n]||e.resource&&e.resource[n]},l=function(e){var t;return t=null,e.tagSet&&(t=e.tagSet.name||e.tagSet.Name||e.tagSet["aws:cloudformation:logical-id"]),t},a=function(){function e(e,t,n){this.region=e,this.vpcId=t,this.azs={},this.subnets={},this.instances={},this.enis={},this.gateways={},this.volumes={},this.sgs={},this.iams={},this.elbs={},this.lcs={},this.asgs={},this.topics={},this.sps={},this.sbgs={},this.dbinstances={},this.ogs={},this.ins_in_asg=[],this.component={},this.layout={},this.originalJson=jQuery.extend(!0,{component:[],layout:[]},n),this.originAppJSON=n,this.DEFAULT_KP=null,this.COMPARISONOPERATOR={GreaterThanOrEqualToThreshold:">=",GreaterThanThreshold:">",LessThanThreshold:"<",LessThanOrEqualToThreshold:"<="}}return e.prototype.CrPartials=function(e){return t(r.RESTYPE[e],this.region)},e.prototype.getResourceByType=function(e){return t(r.RESTYPE[e],this.region).filter(function(e){return function(t){return t.RES_TAG===e.vpcId||t.get("vpcId")===e.vpcId}}(this))},e.prototype.add=function(e,t,n){var i,s,u;return u=r.RESTYPE[e],t&&t.uid?(this.component[t.uid]=t,t):(s=this.getOriginalComp(t,u),s?(_.extend(s.resource,t),this.component[s.uid]=s,this.component[s.uid]):(i={uid:c(),name:n||o(t,u)||e,type:u,resource:t},this.component[i.uid]=i,i))},e.prototype.addLayout=function(e,t,n){var r;r=this.originalJson.layout[e.uid],r||(r={uid:e.uid,coordinate:[0,0]},t&&(r.size=[0,0]),n&&(r.groupUId=n.uid)),this.layout[r.uid]=r},e.prototype.addExpandedAsg=function(e,t){var n,r,i,s;s=this.originalJson.layout;for(n in s){i=s[n];if(i.type==="ExpandedAsg"&&i.originalId===e.uid&&i.groupUId===t.uid){r=this.originalJson.layout[i.uid];break}}r||(r={uid:c(),coordinate:[0,0],originalId:e.uid,type:"ExpandedAsg",groupUId:t.uid}),this.layout[r.uid]=r},e.prototype.addAz=function(e){var t,n;return t=this.azs[e],t?t:(n=this.getOriginalComp(e,"AZ"),n||(n={RegionName:this.region,ZoneName:e}),t=this.add("AZ",n,e),this.addLayout(t,!0,this.theVpc),this.azs[e]=t,t)},e.prototype.addIAM=function(e){var t,n,r,i,s;return t=this.iams[e],t?t:(i=/arn:aws:iam::.*:server-certificate\/.*/g,e.match(i)?(s=e.split(":"),r=s[s.length-1].replace("server-certificate/",""),n={CertificateBody:"",CertificateChain:"",PrivateKey:"",ServerCertificateMetadata:{Arn:e,ServerCertificateId:"",ServerCertificateName:r}},t=this.add("IAM",n,r),this.iams[e]=t,t):(void 0,null))},e.prototype.addTopic=function(e){var t,n,r,i;return n=this.topics[e],n?n:(i={TopicArn:e},t=e.split(":"),t.length>0&&(r=t[t.length-1]),n=this.add("TOPIC",i,r),this.topics[e]=n,n)},e.prototype.getOriginalComp=function(e,t){var n,i,s,o,u,a;if(t===r.RESTYPE.NC){u=this.originalJson.component;for(o in u){n=u[o];if(n.type!==t)continue;if(n.resource.AutoScalingGroupName===e.AutoScalingGroupName&&n.resource.TopicARN===e.TopicARN)return n}}else{t=r.RESTYPE[t]||t,s=r.AWS_RESOURCE_KEY[t],i=_.isObject(e)?e[s]:e;if(!i)return null;a=this.originalJson.component;for(o in a){n=a[o];if(n.type!==t)continue;if((n[s]||n.resource[s])===i)return n}}return null},e.prototype._mapProperty=function(e,t){var n,r,i;for(n in e)r=e[n],((i=typeof r)==="string"||i==="number"||i==="boolean")&&t[n[0].toUpperCase()+n.slice(1)]!==void 0&&(t[n[0].toUpperCase()+n.slice(1)]=r);return t},e.prototype._genCompMap=function(e){var t,n,i,s,o;n={},o=e.component;for(s in o){t=o[s],i=r.AWS_RESOURCE_KEY[t.type];if(!t.resource)continue;if(!i)continue;t.resource[i]||void 0,n[t.resource[i]]={uid:s,name:t.name}}return n},e.prototype._removeAppId=function(e){var t,n;return t=/app-[a-z0-9]{8}$/g,n=e.match(t),n&&n.length===1&&(e=e.replace(n[0],"")),e},e}(),f=[function(){var t,n,i,s,o,u,a;s=["AWS.EC2.Tag","AWS.AutoScaling.Tag",r.RESTYPE.KP,r.RESTYPE.TOPIC,r.RESTYPE.SUBSCRIPTION,r.RESTYPE.IAM,r.RESTYPE.DHCP],u=this.originalJson.component;for(o in u)t=u[o],!this.component[o]&&(a=t.type,e.call(s,a)>=0)&&(n=this.add(null,t),t.type===r.RESTYPE.IAM?this.iams[t.resource.ServerCertificateMetadata.Arn]=n:t.type===r.RESTYPE.KP&&t.name==="DefaultKP"&&(this.DEFAULT_KP=jQuery.extend(!0,{},t),this.component[t.uid]=this.DEFAULT_KP)),null;return this.DEFAULT_KP||(i={KeyFingerprint:"",KeyName:"DefaultKP"},this.add("KP",i,"DefaultKP")),null},function(){var e,t;e=this.getResourceByType("VPC")[0],this.theVpc=t=this.add("VPC",{VpcId:this.vpcId,CidrBlock:e.attributes.cidrBlock,DhcpOptionsId:e.attributes.dhcpOptionsId,InstanceTenancy:e.attributes.instanceTenancy,EnableDnsHostnames:e.attributes.enableDnsHostnames,EnableDnsSupport:e.attributes.enableDnsSupport},l(e.attributes)||this.vpcId),this.addLayout(t,!0)},function(){var e,t,n,r,i,s,o;o=this.getResourceByType("SUBNET")||[];for(t=i=0,s=o.length;i<s;t=++i)n=o[t],n=n.attributes,e=this.addAz(n.availabilityZone),r=this.add("SUBNET",{AvailabilityZone:u(e,"resource.ZoneName"),CidrBlock:n.cidrBlock,SubnetId:n.id,VpcId:u(this.theVpc,"resource.VpcId")},l(n)||n.id),this.subnets[n.id]=r,this.addLayout(r,!0,e)},function(){var e,t,n,r,i,s;s=this.getResourceByType("IGW")||[];for(r=0,i=s.length;r<i;r++){e=s[r],e=e.attributes;if(!(e.attachmentSet&&e.attachmentSet.length>0))continue;n={AttachmentSet:[{VpcId:u(this.theVpc,"resource.VpcId")}],InternetGatewayId:e.id},t=this.add("IGW",n,"Internet-gateway"),this.addLayout(t,!0,this.theVpc),this.gateways[e.id]=t}},function(){var e,t,n,r,i,s,o,a;o=this.getResourceByType("VGW");for(i=0,s=o.length;i<s;i++){e=o[i],e=e.attributes;if((a=e.state)==="deleted"||a==="deleting")continue;e.attachments&&e.attachments.length>0&&(t=e.attachments[0]),r={Attachments:[{VpcId:u(this.theVpc,"resource.VpcId")}],Type:e.type,VpnGatewayId:""},r.VpnGatewayId=e.id,n=this.add("VGW",r,"VPN-gateway"),this.addLayout(n,!0,this.theVpc),this.gateways[e.id]=n}},function(){var e,t,n,r,i,s,o;s=this.getResourceByType("CGW");for(r=0,i=s.length;r<i;r++){e=s[r],e=e.attributes;if((o=e.state)==="deleted"||o==="deleting")continue;n={BgpAsn:"bgpAsn"in e?e.bgpAsn:"",CustomerGatewayId:e.id,IpAddress:e.ipAddress,Type:e.type},t=this.add("CGW",n,l(e)),delete this.component[t.uid],this.gateways[e.id]=t}},function(){var e,t,n,r,i,s,o,a,f,c,h,p,d,v;h=this.getResourceByType("VPN");for(o=0,f=h.length;o<f;o++){e=h[o],e=e.attributes;if((p=e.state)==="deleted"||p==="deleting")continue;r=this.gateways[e.vpnGatewayId],t=this.gateways[e.customerGatewayId];if(!t||!r)continue;s={CustomerGatewayId:u(t,"resource.CustomerGatewayId"),Options:{StaticRoutesOnly:!1},Routes:[],Type:e.type,VpnConnectionId:e.id,VpnGatewayId:u(r,"resource.VpnGatewayId")},e.options&&e.options.staticRoutesOnly&&(s.Options.StaticRoutesOnly=e.options.staticRoutesOnly,t.resource.BgpAsn="");if(e.routes){d=e.routes;for(a=0,c=d.length;a<c;a++){n=d[a];if((v=n.state)==="deleting"||v==="deleted")continue;s.Routes.push({DestinationCidrBlock:n.destinationCidrBlock})}}i=this.add("VPN",s,l(e)),this.component[t.uid]=t,this.addLayout(t,!1)}},function(){var e,t,n,r,i,s,o,a,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;h=this,a={},r=function(e,t){var n;h=this,String(e.ipProtocol)==="-1"&&(e.fromPort="0",e.toPort="65535");if(e.groups&&e.groups.length>0)return _.each(e.groups,function(n){var r,i,s;if(n.groupId)return r="",s=n.groupId,i=a[s],i?r=u(i,"resource.GroupId"):r=n.groupId,t.push({FromPort:String(e.fromPort?e.fromPort:""),IpProtocol:String(e.ipProtocol),IpRanges:r,ToPort:String(e.toPort?e.toPort:"")})});if(e.ipRanges&&e.ipRanges.length>0)return n=e.ipRanges,_.each(n,function(n){return t.push({FromPort:String(e.fromPort?e.fromPort:""),IpProtocol:String(e.ipProtocol),IpRanges:n.cidrIp,ToPort:String(e.toPort?e.toPort:"")})})},T=this.getResourceByType("SG");for(m=0,w=T.length;m<w;m++)e=T[m],i=e.attributes.groupId,o=this.getOriginalComp(i,"SG"),o&&(a[i]=o);v=null,p=null,N=this.getResourceByType("SG");for(g=0,E=N.length;g<E;g++){e=N[g],e=e.attributes,f={Default:!1,GroupDescription:"",GroupId:"",GroupName:"",IpPermissions:[],IpPermissionsEgress:[],VpcId:""},f=this._mapProperty(e,f),s=this.getOriginalComp(e.id,"SG"),s&&(f.GroupName=s.resource.GroupName),d=this.getOriginalComp(e.vpcId,"VPC"),d&&(f.VpcId=u(d.uid,"resource.VpcId")),f.GroupDescription=e.groupDescription;if(e.ipPermissions){C=e.ipPermissions||[];for(y=0,S=C.length;y<S;y++)c=C[y],r.call(this,c,f.IpPermissions)}if(e.ipPermissionsEgress){k=e.ipPermissionsEgress||[];for(b=0,x=k.length;b<x;b++)c=k[b],r.call(this,c,f.IpPermissionsEgress)}o=this.add("SG",f,l(e)||this._removeAppId(e.groupName)),e.groupName==="default"?v=e:e.groupName.indexOf("-DefaultSG-app-")!==-1&&(p=e),this.sgs[e.id]=o}p&&v&&(n=this.sgs[v.id],delete this.sgs[v.id],delete this.component[n.uid],v=null),t=p||v,t&&(t=this.sgs[t.id]),t&&(t.name="DefaultSG",t.resource.Default=!0),_.each(h.sgs,function(e){return _.each(e.resource.IpPermissions,function(e){var t,n;if(e.IpRanges&&e.IpRanges.indexOf("sg-")===0){n=h.sgs[e.IpRanges];if(n)return t=u(n,"resource.GroupId"),e.IpRanges=t}}),_.each(e.resource.IpPermissionsEgress,function(e){var t,n;if(e.IpRanges&&e.IpRanges.indexOf("sg-")===0){n=h.sgs[e.IpRanges];if(n)return t=u(n,"resource.GroupId"),e.IpRanges=t}})})},function(){var e,t,n,r,i,s,o,a;a=this.getResourceByType("VOL");for(s=0,o=a.length;s<o;s++){e=a[s],e=e.attributes;if(!e.attachmentSet)continue;t=this.azs[e.availabilityZone],i={VolumeId:e.id,Size:Number(e.size),SnapshotId:e.snapshotId?e.snapshotId:"",Iops:e.iops?e.iops:"",VolumeType:e.volumeType,AvailabilityZone:u(t,"resource.ZoneName")},e.volumeType==="gp2"&&(i.Iops=""),e.attachmentSet&&(n=this.instances[e.attachmentSet[0].instanceId],n&&(i.AttachmentSet.Device=e.attachmentSet[0].device,i.AttachmentSet.InstanceId=u(n,"resource.InstanceId"))),r=this.add("VOL",i,e.attachmentSet[0].device),delete this.component[r.uid],this.volumes[e.id]=r}},function(){var t,n,r,i,s,o,a,f,c,h,p,d,v,m,g,y,b,w;o=this,g=this.getResourceByType("ASG");for(p=0,v=g.length;p<v;p++)t=g[p],t=t.attributes,_.each(t.Instances,function(e,t){return o.ins_in_asg.push(e.InstanceId)});y=this.getResourceByType("INSTANCE")||[];for(d=0,m=y.length;d<m;d++){n=y[d],n=n.attributes;if(n.tagSet&&n.tagSet["aws:elasticmapreduce:instance-group-role"]&&n.tagSet["aws:elasticmapreduce:job-flow-id"]){void 0;continue}if((b=n.instanceState.name)==="shutting-down"||b==="terminated")continue;if(w=n.id,e.call(this.ins_in_asg,w)>=0)continue;r=this.addAz(n.placement.availabilityZone),c=this.subnets[n.subnetId];if(!c)continue;s={BlockDeviceMapping:[],DisableApiTermination:!1,EbsOptimized:"",ImageId:"",InstanceId:"",InstanceType:"",KeyName:"",Monitoring:"",NetworkInterface:[],Placement:{Tenancy:"",AvailabilityZone:""},SecurityGroup:[],SecurityGroupId:[],ShutdownBehavior:"",SubnetId:"",UserData:{Base64Encoded:!1,Data:""},VpcId:""},s=this._mapProperty(n,s),s.SubnetId=u(c,"resource.SubnetId"),s.VpcId=u(this.theVpc,"resource.VpcId"),s.Placement.AvailabilityZone=u(r,"resource.ZoneName"),s.Placement.Tenancy=n.placement.tenancy,n.monitoring&&n.monitoring&&(s.Monitoring=n.monitoring.state),n.placement.tenancy==="default"&&(s.Placement.Tenancy=""),n.shutdownBehavior||(s.ShutdownBehavior="terminate"),s.InstanceId=n.id,s.EbsOptimized=n.ebsOptimized,a=this.getOriginalComp(n.id,"INSTANCE"),h=[],n.rootDeviceType==="ebs"&&(a&&(s.BlockDeviceMapping=a.resource.BlockDeviceMapping||[],s.BlockDeviceMapping=_.filter(s.BlockDeviceMapping,function(e){return _.isString(e)?!1:!0})),f=[],_.each(n.blockDeviceMapping,function(e){var t,r;if(n.rootDeviceName.indexOf(e.deviceName)!==-1){r=o.volumes[e.ebs.volumeId];if(r)return t={DeviceName:e.deviceName,Ebs:{SnapshotId:r.resource.SnapshotId,VolumeSize:r.resource.Size,VolumeType:r.resource.VolumeType}},r.resource.VolumeType==="io1"&&(t.Ebs.Iops=r.resource.Iops),f.push(t)}}),s.BlockDeviceMapping.length!==f.length&&(s.BlockDeviceMapping=f)),_.each(n.blockDeviceMapping||[],function(e){var t;if(n.rootDeviceType==="instance-store"||n.rootDeviceName.indexOf(e.deviceName)===-1){t=o.volumes[e.ebs.volumeId];if(t)return o.component[t.uid]=t,h.push(t.uid)}}),i=this.add("INSTANCE",s,l(n)),_.each(h,function(e,t){var n;n=o.component[e];if(n)return n.resource.AttachmentSet||(n.resource.AttachmentSet={}),n.resource.AttachmentSet.InstanceId=u(i,"resource.InstanceId")}),this.addLayout(i,!1,c),this.instances[n.id]=i}},function(){var e,t,n,r,i,s,o,a,f,c,h,p,d,v,m,g,y,b,w,E;m=this.getResourceByType("ENI")||[];for(f=0,p=m.length;f<p;f++){e=m[f],e=e.attributes,t=this.addAz(e.availabilityZone),a=this.subnets[e.subnetId];if(!a)continue;r={AssociatePublicIpAddress:!1,Attachment:{AttachmentId:"",DeviceIndex:"1",InstanceId:""},AvailabilityZone:"",Description:"",GroupSet:[],NetworkInterfaceId:"",PrivateIpAddressSet:[],SourceDestCheck:!0,SubnetId:"",VpcId:""};if(e.attachment&&e.attachment.instanceOwnerId&&((g=e.attachment.instanceOwnerId)==="amazon-elb"||g==="amazon-rds"))continue;r=this._mapProperty(e,r),e.association&&e.association.publicIp&&(r.AssociatePublicIpAddress=!0),r.NetworkInterfaceId=e.id,r.AvailabilityZone=u(t,"resource.ZoneName"),r.SubnetId=u(a,"resource.SubnetId"),r.VpcId=u(this.theVpc,"resource.VpcId"),e.attachment&&((y=e.attachment.deviceIndex)!=="0"&&y!==0&&(r.Attachment.AttachmentId=e.attachment.attachmentId),s=this.instances[e.attachment.instanceId],s&&(r.Attachment.InstanceId=u(s,"resource.InstanceId"),r.Attachment.DeviceIndex=String(e.attachment.deviceIndex===0?"0":e.attachment.deviceIndex))),b=e.privateIpAddressesSet;for(c=0,d=b.length;c<d;c++)o=b[c],r.PrivateIpAddressSet.push({PrivateIpAddress:o.privateIpAddress,AutoAssign:!1,Primary:o.primary});w=e.groupSet;for(h=0,v=w.length;h<v;h++)i=w[h],r.GroupSet.push({GroupId:u(this.sgs[i.groupId],"resource.GroupId"),GroupName:u(this.sgs[i.groupId],"resource.GroupName")});n=this.add("ENI",r,l(e)),this.enis[e.id]=n,(!e.attachment||(E=e.attachment.deviceIndex)!=="0"&&E!==0)&&this.addLayout(n,!1,a)}},function(){var e,t,n,r,i,s,o,a,f,l,c,h;c=this.getResourceByType("EIP");for(o=0,f=c.length;o<f;o++){e=c[o],e=e.attributes,r=this.enis[e.networkInterfaceId];if(!r)continue;n={AllocationId:e.id,Domain:e.domain,InstanceId:"",NetworkInterfaceId:u(r,"resource.NetworkInterfaceId"),PrivateIpAddress:"",PublicIp:e.publicIp},i=0,h=r.resource.PrivateIpAddressSet;for(a=0,l=h.length;a<l;a++)s=h[a],s.PrivateIpAddress===e.privateIpAddress&&(n.PrivateIpAddress=u(r,"resource.PrivateIpAddressSet."+i+".PrivateIpAddress")),i++;t=this.add("EIP",n)}},function(){var e,t,n,r,i,s,o,a,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T;E=this.getResourceByType("RT")||[];for(p=0,g=E.length;p<g;p++){t=E[p],t=t.attributes,f={AssociationSet:[],PropagatingVgwSet:[],RouteSet:[],RouteTableId:t.id,VpcId:u(this.theVpc,"resource.VpcId")},S=t.associationSet;for(d=0,y=S.length;d<y;d++)i=S[d],e={Main:i.main===!1?!1:"true",RouteTableAssociationId:"",SubnetId:""},e.Main||(e.RouteTableAssociationId=i.routeTableAssociationId,c=this.subnets[i.subnetId],i.subnetId&&c&&(e.SubnetId=u(c,"resource.SubnetId"))),f.AssociationSet.push(e);h={},x=t.routeSet;for(v=0,b=x.length;v<b;v++){i=x[v];if(i.state!=="active")continue;if(i.origin&&i.origin==="EnableVgwRoutePropagation")continue;s=this.instances[i.instanceId],n=this.enis[i.networkInterfaceId],r=this.gateways[i.gatewayId],o={DestinationCidrBlock:i.destinationCidrBlock,GatewayId:"",InstanceId:"",NetworkInterfaceId:i.networkInterfaceId&&n?u(n,"resource.NetworkInterfaceId"):"",Origin:i.gatewayId==="local"?i.origin:""},i.gatewayId&&(h[i.gatewayId]=!0,i.gatewayId!=="local"&&r?r.type==="AWS.VPC.VPNGateway"?o.GatewayId=u(r,"resource.VpnGatewayId"):r.type==="AWS.VPC.InternetGateway"&&(o.GatewayId=u(r,"resource.InternetGatewayId")):o.GatewayId=i.gatewayId),f.RouteSet.push(o)}T=t.propagatingVgwSet;for(m=0,w=T.length;m<w;m++)i=T[m],r=this.gateways[i.gatewayId],r&&h[i.gatewayId]&&f.PropagatingVgwSet.push(u(r,"resource.VpnGatewayId"));a=this.add("RT",f,l(t)),this.addLayout(a,!0,this.theVpc)}},function(){var e,t,n,r,i,s,o,a,f,c,h,p,d,v,m,g,y;m=this.getResourceByType("ACL")||[];for(f=0,p=m.length;f<p;f++){i=m[f],i=i.attributes,r={AssociationSet:[],Default:!1,EntrySet:[],NetworkAclId:"",VpcId:""},r=this._mapProperty(i,r),r.VpcId=u(this.theVpc,"resource.VpcId"),r.NetworkAclId=i.id,i["default"]?(r.Default=i["default"],n="DefaultACL"):n=l(i),g=i.entries;for(c=0,d=g.length;c<d;c++)e=g[c],s=e.egress,_.isString(s)&&(s==="true"?s=!0:s=!1),r.EntrySet.push({RuleAction:e.ruleAction,Protocol:Number(e.protocol),CidrBlock:e.cidrBlock,Egress:e.egress,IcmpTypeCode:{Type:e.icmpTypeCode?String(e.icmpTypeCode.type):"",Code:e.icmpTypeCode?String(e.icmpTypeCode.code):""},PortRange:{To:e.portRange?String(e.portRange.to):"",From:e.portRange?String(e.portRange.from):""},RuleNumber:e.ruleNumber});y=i.associationSet;for(h=0,v=y.length;h<v;h++){e=y[h],a=this.subnets[e.subnetId];if(!a)continue;r.AssociationSet.push({NetworkAclAssociationId:e.networkAclAssociationId,SubnetId:u(a,"resource.SubnetId")})}o=this.getOriginalComp(i.id,"ACL"),o&&o.resource.AssociationSet.sort().toString()===r.AssociationSet.sort().toString()&&(r.AssociationSet=jQuery.extend(!0,[],o.resource.AssociationSet)),t=this.add("ACL",r,n)}},function(){var t,n,r,i,s,o,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L;f=this,T=this.getResourceByType("ELB")||[];for(d=0,y=T.length;d<y;d++){t=T[d],t=t.attributes,i={HealthCheck:{Timeout:"",Target:"",HealthyThreshold:"",UnhealthyThreshold:"",Interval:""},Policies:{AppCookieStickinessPolicies:[{CookieName:"",PolicyName:""}],OtherPolicies:[],LBCookieStickinessPolicies:[{CookieExpirationPeriod:"",PolicyName:""}]},BackendServerDescriptions:[{InstantPort:"",PoliciyNames:""}],SecurityGroups:[],ListenerDescriptions:[],DNSName:"",Scheme:"",Instances:[],Subnets:[],VpcId:"",LoadBalancerName:"",AvailabilityZones:[],CrossZoneLoadBalancing:"",ConnectionDraining:{Enabled:!1,Timeout:null},ConnectionSettings:{IdleTimeout:60}},i=this._mapProperty(t,i),l=this.getOriginalComp(t.Name,"ELB"),i.ConnectionDraining.Enabled=t.ConnectionDraining.Enabled,i.ConnectionSettings.IdleTimeout=Number(t.ConnectionSettings.IdleTimeout),l?i.ConnectionDraining.Timeout=l.resource.ConnectionDraining.Timeout:t.ConnectionDraining.Enabled&&(i.ConnectionDraining.Timeout=Number(t.ConnectionDraining.Timeout));if(t.SecurityGroups){N=t.SecurityGroups;for(v=0,b=N.length;v<b;v++)c=N[v],i.SecurityGroups.push(u(this.sgs[c],"resource.GroupId"))}i.VpcId=u(this.theVpc,"resource.VpcId");if(t.Subnets){C=t.Subnets;for(m=0,w=C.length;m<w;m++)p=C[m],i.Subnets.push(u(this.subnets[p],"resource.SubnetId"))}i.DNSName=t.Dnsname,i.CrossZoneLoadBalancing=t.CrossZoneLoadBalancing.Enabled;if(t.ListenerDescriptions){k=t.ListenerDescriptions;for(g=0,E=k.length;g<E;g++)a=k[g],h="",a.Listener.SslcertificateId?(s=this.addIAM(a.Listener.SslcertificateId),s&&(h=u(s,"resource.ServerCertificateMetadata.Arn"))):a.Listener.SslcertificateId="",n={PolicyNames:"",Listener:{LoadBalancerPort:a.Listener.LoadBalancerPort,InstanceProtocol:a.Listener.InstanceProtocol,Protocol:a.Listener.Protocol,SSLCertificateId:h||a.Listener.SslcertificateId,InstancePort:a.Listener.InstancePort}},i.ListenerDescriptions.push(n)}i.HealthCheck=t.HealthCheck;if(t.Instances){L=t.Instances;for(x=0,S=L.length;x<S;x++)o=L[x],e.call(f.ins_in_asg,o)>=0||this.instances[o]&&i.Instances.push({InstanceId:u(this.instances[o],"resource.InstanceId")})}r=this.add("ELB",i,t.Name),this.addLayout(r,!1,this.theVpc),this.elbs[t.Name]=r}},function(){var e,t,n,r,i,s,o,a,f,l,c;s=this,c=this.getResourceByType("LC");for(f=0,l=c.length;f<l;f++){e=c[f],e=e.attributes,i={AssociatePublicIpAddress:!1,BlockDeviceMapping:[],EbsOptimized:!1,ImageId:"",InstanceMonitoring:!1,InstanceType:"",KeyName:"",LaunchConfigurationARN:"",LaunchConfigurationName:"",SecurityGroups:[],UserData:""},i=this._mapProperty(e,i),i.LaunchConfigurationARN=e.id,i.LaunchConfigurationName=e.Name,i.InstanceMonitoring=e.InstanceMonitoring.Enabled,e.UserData&&atob&&(i.UserData=atob(e.UserData)),a=[],_.each(e.SecurityGroups,function(e,t){var n;n=s.sgs[e];if(n)return a.push(u(n,"resource.GroupId"))});if(a.length===0)continue;i.SecurityGroups=a,t=i.BlockDeviceMapping,_.each(e.BlockDeviceMapping||[],function(e,n){var r;return e.Ebs===null&&e.VirtualName?r={DeviceName:e.DeviceName,Ebs:null,NoDevice:e.NoDevice,VirtualName:e.VirtualName}:(r={DeviceName:e.DeviceName,Ebs:{VolumeSize:e.Ebs?Number(e.Ebs.VolumeSize):0,VolumeType:e.Ebs?e.Ebs.VolumeType:""}},e.Ebs&&(e.Ebs.SnapshotId&&(r.Ebs.SnapshotId=e.Ebs.SnapshotId),r.Ebs.VolumeType==="io1"&&(r.Ebs.Iops=e.Ebs.Iops)),t.push(r))}),n=this.getOriginalComp(e.KeyName,"KP"),n?(o=this.getOriginalComp(e.id,"LC"),o?i.KeyName=o.resource.KeyName:i.KeyName=u(n,"resource.KeyName")):e.KeyName&&(i.KeyName=e.KeyName),r=this.add("LC",i,e.Name),this.addLayout(r),delete this.component[e.id],this.lcs[e.Name]=r}},function(){var e,t,n,r,i,s,o,a,f,c,h,p,d,v;o=this,v=this.getResourceByType("ASG");for(p=0,d=v.length;p<d;p++){r=v[p],r=r.attributes;if(!this.lcs[r.LaunchConfigurationName])continue;n={AutoScalingGroupARN:"",AutoScalingGroupName:"",AvailabilityZones:[],DefaultCooldown:"0",DesiredCapacity:"0",HealthCheckGracePeriod:"0",HealthCheckType:"",LaunchConfigurationName:"",LoadBalancerNames:[],MaxSize:"0",MinSize:"0",TerminationPolicies:[],VPCZoneIdentifier:""},n=this._mapProperty(r,n),c=this.getOriginalComp(r.id,"ASG"),n.AutoScalingGroupARN=r.id,n.AutoScalingGroupName=r.Name,n.TerminationPolicies=r.TerminationPolicies,n.LaunchConfigurationName=u(this.lcs[r.LaunchConfigurationName],"resource.LaunchConfigurationName"),h=[],_.each(r.Subnets,function(e,t){var n;n=o.subnets[e];if(n)return h.push(u(n,"resource.SubnetId"))});if(h.length===0)continue;n.VPCZoneIdentifier=h.join(" , "),s=[],_.each(r.LoadBalancerNames,function(e,t){var n;return n=o.elbs[e],s.push(u(n,"resource.LoadBalancerName"))}),n.LoadBalancerNames=s,i=[],_.each(r.AvailabilityZones,function(e,t){var n;return n=o.addAz(e),i.push(u(n,"resource.ZoneName"))}),n.AvailabilityZones=i,t=this.add("ASG",n,l(r)||r.Name),a="",f=this.originalJson.layout[t.uid],e=!1,_.each(r.Subnets,function(n,r){var i;return i=o.subnets[n],!e&&(f&&f.groupUId===i.uid||!f)?(o.addLayout(t,!0,i),e=!0):o.addExpandedAsg(t,i)}),this.asgs[r.Name]=t}},function(){var e,t,n,i,s,o,a,f;f=this.getResourceByType("NC");for(o=0,a=f.length;o<a;o++){t=f[o],t=t.attributes,i={AutoScalingGroupName:t.AutoScalingGroupName,NotificationType:t.NotificationType,TopicARN:t.TopicARN},e=this.asgs[i.AutoScalingGroupName];if(!e)continue;i.AutoScalingGroupName=u(e,"resource.AutoScalingGroupName"),s=_.first(_.filter(this.originalJson.component,function(e){if(e.type===r.RESTYPE.TOPIC)return e.resource.TopicArn===i.TopicARN})),s?i.TopicARN=u(s,"resource.TopicArn"):(s=this.addTopic(i.TopicARN),s&&(i.TopicARN=u(s,"resource.TopicArn"))),n=this.add("NC",i,"SnsNotification")}},function(){var e,t,n,r,i,s,o;o=this.getResourceByType("SP");for(i=0,s=o.length;i<s;i++){t=o[i],t=t.attributes,r={AdjustmentType:"",AutoScalingGroupName:"",Cooldown:"0",MinAdjustmentStep:"",PolicyARN:"",PolicyName:"",ScalingAdjustment:""},r=this._mapProperty(t,r),t.Cooldown===""&&(r.Cooldown="0"),e=this.asgs[t.AutoScalingGroupName],r.ScalingAdjustment&&(r.ScalingAdjustment=String(r.ScalingAdjustment));if(!e)continue;r.AutoScalingGroupName=u(e,"resource.AutoScalingGroupName"),r.PolicyARN=t.id,r.PolicyName=t.Name,n=this.add("SP",r,t.Name),this.sps[t.id]=n}},function(){var e,t,n,r,i,s,o,a,f,l,c,h,p,d;o=this,d=this.getResourceByType("CW");for(h=0,p=d.length;h<p;h++){t=d[h],t=t.attributes,r={AlarmActions:[],AlarmArn:"",AlarmName:"",ComparisonOperator:"",Dimensions:[],EvaluationPeriods:"",InsufficientDataActions:[],MetricName:"",Namespace:"",OKAction:[],Period:0,Statistic:"",Threshold:"",Unit:""},r=this._mapProperty(t,r),i=[],_.each(t.Dimensions,function(e,t){var n,r;if(e.Name==="AutoScalingGroupName"){n=o.asgs[e.Value];if(n)return r={name:e.Name,value:u(n,"resource.AutoScalingGroupName")},i.push(r)}});if(i.length===0)continue;r.Dimensions=i,f=/arn:aws:autoscaling:.*:scalingPolicy:/g,l=/arn:aws:sns:.*:.*/g,c=[],s=!1,_.each(t.AlarmActions,function(e,t){var n,r;if(e.match(l)){r=o.addTopic(e);if(r)return c.push(e)}else if(e.match(f)){n=o.sps[e];if(n)return s=!0,c.push(e)}});if(!s)continue;e=[],_.each(c,function(t,n){var r,i;if(t.match(l)){i=o.addTopic(t);if(i)return e.push(u(i,"resource.TopicArn"))}else if(t.match(f)){r=o.sps[t];if(r)return e.push(u(r,"resource.PolicyARN"))}}),r.AlarmActions=e,a=[],_.each(t.Okactions,function(e,t){var n;if(e.match(f)){n=o.sps[e];if(n)return a.push(u(n,"resource.PolicyARN"))}}),r.OKAction=a,r.Threshold=String(t.Threshold),r.EvaluationPeriods=String(t.EvaluationPeriods),t.ComparisonOperator&&(r.ComparisonOperator=this.COMPARISONOPERATOR[t.ComparisonOperator]),r.AlarmArn=t.id,r.AlarmName=t.Name,n=this.add("CW",r,t.Name)}},function(){var e,t,n,r,i,s,o,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;w=this.getResourceByType("DBOG");for(h=0,m=w.length;h<m;h++){e=w[h],e=e.attributes;if(e.OptionGroupName.indexOf("default:")===0){void 0;continue}r={CreatedBy:"",EngineName:"",MajorEngineVersion:"",OptionGroupDescription:"",OptionGroupName:"",Options:[],VpcId:""},r=this._mapProperty(e,r),r.OptionGroupName=e.id,r.VpcId=u(this.theVpc,"resource.VpcId"),E=e.Options||[];for(p=0,g=E.length;p<g;p++){i=E[p],s=this._mapProperty(i,{OptionName:"",OptionSettings:[],Port:"",VpcSecurityGroupMemberships:[]}),s.Port=s.Port?s.Port.toString():"",S=i.OptionSettings;for(d=0,y=S.length;d<y;d++)a=S[d],f=this._mapProperty(a,{Name:"",Value:""}),s.OptionSettings.push(f);x=i.VpcSecurityGroupMemberships;for(v=0,b=x.length;v<b;v++)l=x[v],c=this.sgs[l.VpcSecurityGroupId],c?s.VpcSecurityGroupMemberships.push(u(c,"resource.GroupId")):void 0;r.Options.push(s)}o=this.getOriginalComp(e.id,"DBOG"),o?(t=o.name,r.CreatedBy=o.resource.CreatedBy):(t=e.OptionGroupName,r.CreatedBy="user",void 0),n=this.add("DBOG",r,t),this.ogs[e.id]=n}},function(){var e,t,n,r,i,s,o,a,f,c,h,p,d;p=this.getResourceByType("DBSBG");for(a=0,c=p.length;a<c;a++){e=p[a],e=e.attributes,i={CreatedBy:"",DBSubnetGroupName:"",SubnetIds:[],DBSubnetGroupDescription:""},i=this._mapProperty(e,i),i.DBSubnetGroupName=e.id,d=e.Subnets;for(f=0,h=d.length;f<h;f++)s=d[f],o=this.subnets[s.SubnetIdentifier],i.SubnetIds.push(u(o,"resource.SubnetId"));n=this.getOriginalComp(e.id,"DBSBG"),n?(t=n.name,i.CreatedBy=n.resource.CreatedBy,i.SubnetIds.sort().toString()===n.resource.SubnetIds.sort().toString()&&(i.SubnetIds=jQuery.extend(!0,[],n.resource.SubnetIds))):(t=e.DBSubnetGroupName,i.CreatedBy="user"),r=this.add("DBSBG",i,l(e)||t),this.addLayout(r,!0,this.theVpc),this.sbgs[e.id]=r}},function(){var e,t,n,r,i,s,o,a,f,c,h,p,d,v,m,g,y,b,w,E;i=[],w=this.getResourceByType("DBINSTANCE");for(d=0,g=w.length;d<g;d++)e=w[d],e=e.attributes,e.ReadReplicaSourceDBInstanceIdentifier?i.push(e):i.unshift(e);for(v=0,y=i.length;v<y;v++){e=i[v],p=this.sbgs[e.sbgId];if(!p){void 0;continue}a=this.sbgs[e.DBSubnetGroup.DBSubnetGroupName];if(!a){void 0;continue}r={CreatedBy:"",DBInstanceIdentifier:"",DBSnapshotIdentifier:"",AllocatedStorage:0,AutoMinorVersionUpgrade:!1,AvailabilityZone:"",MultiAZ:!1,Iops:"",BackupRetentionPeriod:0,CharacterSetName:"",DBInstanceClass:"",DBName:"",Endpoint:{Port:0},Engine:"",EngineVersion:"",LicenseModel:"",MasterUsername:"",MasterUserPassword:"",OptionGroupMembership:{OptionGroupName:""},DBParameterGroups:{DBParameterGroupName:""},PendingModifiedValues:"",PreferredBackupWindow:"",PreferredMaintenanceWindow:"",PubliclyAccessible:!1,DBSubnetGroup:{DBSubnetGroupName:""},VpcSecurityGroupIds:[]},r=this._mapProperty(e,r),e.PendingModifiedValues&&(e.PendingModifiedValues.AllocatedStorage&&(r.AllocatedStorage=Number(e.PendingModifiedValues.AllocatedStorage)),e.PendingModifiedValues.BackupRetentionPeriod&&(r.BackupRetentionPeriod=Number(e.PendingModifiedValues.BackupRetentionPeriod)),e.PendingModifiedValues.DBInstanceClass&&(r.DBInstanceClass=e.PendingModifiedValues.DBInstanceClass),e.PendingModifiedValues.Iops&&(r.Iops=Number(e.PendingModifiedValues.Iops)),e.PendingModifiedValues.MultiAZ&&(r.MultiAZ=e.PendingModifiedValues.MultiAZ),e.PendingModifiedValues.MasterUserPassword&&(r.MasterUserPassword=e.PendingModifiedValues.MasterUserPassword)),r.MultiAZ&&(r.AvailabilityZone=""),e.ReadReplicaSourceDBInstanceIdentifier&&(h=this.dbinstances[e.ReadReplicaSourceDBInstanceIdentifier],h?r.ReadReplicaSourceDBInstanceIdentifier=u(h,"resource.DBInstanceIdentifier"):void 0),e.Endpoint&&(r.Endpoint.Port=e.Endpoint.Port),e.OptionGroupMemberships[0]&&(s=this.ogs[e.OptionGroupMemberships[0].OptionGroupName],s?r.OptionGroupMembership.OptionGroupName=u(s,"resource.OptionGroupName"):(r.OptionGroupMembership.OptionGroupName=e.OptionGroupMemberships[0].OptionGroupName,e.OptionGroupMemberships[0].OptionGroupName.indexOf("default:")!==0&&void 0)),e.DBParameterGroups[0]&&(r.DBParameterGroups.DBParameterGroupName=e.DBParameterGroups[0].DBParameterGroupName),r.DBSubnetGroup.DBSubnetGroupName=u(a,"resource.DBSubnetGroupName"),E=e.VpcSecurityGroups;for(m=0,b=E.length;m<b;m++)f=E[m],c=this.sgs[f.VpcSecurityGroupId],c?r.VpcSecurityGroupIds.push(u(c,"resource.GroupId")):void 0;o=this.getOriginalComp(e.id,"DBINSTANCE"),o?(t=o.name,r.CreatedBy=o.resource.CreatedBy,e.Endpoint||(r.Endpoint.Port=o.resource.Endpoint.Port),o.resource.PreferredBackupWindow||(r.PreferredBackupWindow=o.resource.PreferredBackupWindow),o.resource.PreferredMaintenanceWindow||(r.PreferredMaintenanceWindow=o.resource.PreferredMaintenanceWindow),r.MasterUserPassword=o.resource.MasterUserPassword,r.DBSnapshotIdentifier=o.resource.DBSnapshotIdentifier):(t=e.Name||e.DBInstanceIdentifier,r.CreatedBy="user"),n=this.add("DBINSTANCE",r,l(e)||t),this.addLayout(n,!1,p),this.dbinstances[e.id]=n}}],p=function(e){var t,n,i,o,u,a,f,l,c,h,p;o=new s,h=e.originAppJSON.component,f=e.component,u=function(e){var t,n,i,s,o,a,f,l;f=e.type;if(f===r.RESTYPE.INSTANCE)return e.serverGroupUid;if(f===r.RESTYPE.ENI){o=e.resource.Attachment.InstanceId;if(o){a=MC.extractID(o),s=h[a];if(s)return s.serverGroupUid}else{l=e.serverGroupUid;if(l!==e.uid){t=h[l];if(t)return u(t)}}}if(f===r.RESTYPE.VOL){o=e.resource.AttachmentSet.InstanceId;if(o){a=MC.extractID(o),s=h[a];if(s)return s.serverGroupUid}}if(f===r.RESTYPE.EIP){n=e.resource.NetworkInterfaceId;if(n){i=MC.extractID(n),t=h[i];if(t)return u(t)}}return""},p={},_.each(h,function(e){if(e.number&&e.number>1)return p[e.uid]=e}),l={},_.each(f,function(e){return p[e.uid]&&(l[e.uid]=e),null}),i=o.compare(p,l),i&&_.each(i,function(e,t){var n,r;n=l[t];if(n){r=u(n);if(r)return _.each(l,function(e){if(u(e)===r){e.serverGroupName&&(e.serverGroupName=e.name),e.number&&(e.number=1),e.index&&(e.index=0);if(e.serverGroupUid)return e.serverGroupUid=e.uid}})}}),_.each(e.elbs,function(e){var t,n,r,i,s;r=_.map(e.resource.Instances,function(e){return MC.extractID(e.InstanceId)}),i=h[e.uid];if(i){s=_.map(i.resource.Instances,function(e){return MC.extractID(e.InstanceId)}),t=o.compare(r,s);if(t)return n=[],_.each(t,function(e){return e.__old__&&n.push(e.__old__),e.__new__&&n.push(e.__new__),null}),_.each(n,function(e){var t,n;t=l[e];if(t)return n=t.serverGroupUid,_.each(l,function(e,t){var r;r=u(e);if(r===n){e.serverGroupName&&(e.serverGroupName=e.name),e.number&&(e.number=1),e.index&&(e.index=0);if(e.serverGroupUid)return e.serverGroupUid=e.uid}})})}}),a={},c={},_.each(f,function(e){var t;if((t=e.type)===r.RESTYPE.ENI||t===r.RESTYPE.EIP||t===r.RESTYPE.INSTANCE||t===r.RESTYPE.VOL)if(!h[e.uid])return a[e.uid]=e}),_.each(h,function(e){var t;if((t=e.type)===r.RESTYPE.ENI||t===r.RESTYPE.EIP||t===r.RESTYPE.INSTANCE||t===r.RESTYPE.VOL)f[e.uid]||(c[e.uid]=e);return null}),t=o.compare(a,c),n=[];if(t)return _.each(t,function(e,t){var n,r;return n=f[t]||h[t],r=u(n),_.each(f,function(e,t){var n;n=u(e);if(n===r){e.serverGroupName&&(e.serverGroupName=e.name),e.number&&(e.number=1),e.index&&(e.index=0);if(e.serverGroupUid)return e.serverGroupUid=e.uid}})})},h=function(e,t,n){var r,i,s,o,u;void 0,r=new a(e,t,n);for(o=0,u=f.length;o<u;o++)s=f[o],s.call(r);if(r.originAppJSON)try{p(r)}catch(l){i=l,void 0}return r},d=function(e,n){var i,s,o,u,a,f,l,c,h,p,d,v,m,g;i=r.RESTYPE,a={filter:{"vpc-id":n}},s={"AWS.EC2.SecurityGroup":a,"AWS.VPC.NetworkAcl":a,"AWS.VPC.NetworkInterface":a},c={},m=t(i.SUBNET,e).where({vpcId:n});for(h=0,d=m.length;h<d;h++)l=m[h],c[l.id]=!0;u=[],f=[],g=t(i.ASG,e).models;for(p=0,v=g.length;p<v;p++)o=g[p],c[o.get("VPCZoneIdentifier")]&&(u.push(o.get("AutoScalingGroupName")),f.push(o.get("LaunchConfigurationName")));return u.length&&(s[i.LC]={id:_.uniq(f)},s[i.NC]={id:u},s[i.SP]={filter:{AutoScalingGroupName:u}}),s},t.getAllResourcesForVpc=h})}.call(this),function(){define("cloudres/CrModelRdsSnapshot",["./CrModel","CloudResources","ApiRequest"],function(e,t,n){return e.extend({taggable:!1,isComplete:function(){return this.attributes.Status==="available"},isAutomated:function(){return this.attributes.SnapshotType==="automated"},doCreate:function(){var e;return e=this,n("rds_snap_CreateDBSnapshot",{region_name:this.getCollection().region(),source_id:this.get("DBInstanceIdentifier"),snapshot_id:this.get("DBSnapshotIdentifier")}).then(function(t){var r;try{t=t.CreateDBSnapshotResponse.CreateDBSnapshotResult.DBSnapshot,t.id=t.DBSnapshotIdentifier}catch(i){throw r=i,McError(n.Errors.InvalidAwsReturn,"Snapshot created but aws returns invalid data.")}return e.set(t),void 0,e})},set:function(e){e.PercentProgress&&(e.PercentProgress=parseInt(e.PercentProgress,10)||0),e.Status==="creating"&&this.startPollingStatus(),Backbone.Model.prototype.set.apply(this,arguments)},startPollingStatus:function(){var e;if(this.__polling)return;e=this.__pollingStatus.bind(this),this.__polling=setTimeout(e,2e3)},stopPollingStatus:function(){clearTimeout(this.__polling),this.__polling=null},__pollingStatus:function(){var e,t;return e=this,n("rds_snap_DescribeDBSnapshots",{region_name:((t=this.getCollection())!=null?t.region():void 0)||Design.instance().region(),snapshot_id:this.get("DBSnapshotIdentifier")}).then(function(t){e.__polling=null,e.__parsePolling(t)},function(t){if(t&&t.awsError){t.awsError===404&&e.remove();return}if(t&&t.error<0)return e.__polling=null,e.startPollingStatus()})},__parsePolling:function(e){e=e.DescribeDBSnapshotsResponse.DescribeDBSnapshotsResult.DBSnapshots.DBSnapshot,this.set({PercentProgress:e.PercentProgress,Status:e.Status})},copyTo:function(e,r,i){var s,o;return s=this,o="arn:aws:rds:"+this.collection.region()+":"+App.user.attributes.account.split("-").join("")+":snapshot:"+this.get("id"),n("rds_snap_CopyDBSnapshot",{region_name:e,source_id:o,target_id:r}).then(function(i){var o,u,a,f,l,c;void 0,a=(l=i.CopyDBSnapshotResponse)!=null?(c=l.CopyDBSnapshotResult)!=null?c.DBSnapshot:void 0:void 0;if(!a.DBSnapshotIdentifier)throw McError(n.Errors.InvalidAwsReturn,"Snapshot copied but aws returns invalid data.");return f=t(s.collection.type,e),o=a,o.id=a.DBSnapshotIdentifier,o.name=r,o.region=e,u=f.create(o),f.add(u),u.tagResource(),u})},doDestroy:function(){return n("rds_snap_DeleteDBSnapshot",{region_name:this.getCollection().region(),snapshot_id:this.get("id")})}})})}.call(this),function(){define("cloudres/CrModelRdsInstance",["./CrModel","CloudResources","ApiRequest"],function(e,t,n){return e.extend({taggable:!1})})}.call(this),function(){define("cloudres/CrModelRdsPGroup",["./CrModel","CloudResources","ApiRequest","constant"],function(e,t,n,r){return e.extend({taggable:!1,isDefault:function(){return(this.get("DBParameterGroupName")||"").indexOf("default.")===0},getParameters:function(){return t(r.RESTYPE.DBPARAM,this.id).init(this)},doCreate:function(){var e;return e=this,n("rds_pg_CreateDBParameterGroup",{region_name:this.getCollection().region(),param_group:this.get("DBParameterGroupName"),param_group_family:this.get("DBParameterGroupFamily"),description:this.get("Description")}).then(function(t){return e.set("id",e.get("DBParameterGroupName")),e})},doDestroy:function(){return n("rds_pg_DeleteDBParameterGroup",{region_name:this.collection.region(),param_group:this.id})},resetParams:function(){var e;return e=this,n("rds_pg_ResetDBParameterGroup",{region_name:this.collection.region(),param_group:this.id,reset_all:!0}).then(function(){return e.getParameters().fetchForce()})},modifyParams:function(e){var t,r,i,s,o,u,a,f;i=[];for(r in e)f=e[r],i.push({ParameterName:r,ParameterValue:f,ApplyMethod:this.getParameters().get(r).applyMethod()});u=[],o={region_name:this.collection.region(),param_group:this.id,parameters:[]},t=0;while(t<i.length)o.parameters=i.slice(t,t+20),u.push(n("rds_pg_ModifyDBParameterGroup",o)),t+=20;return a=this,s=a.getParameters(),Q.all(u).then(function(){var t,n;for(t in e)n=e[t],s.get(t).set("ParameterValue",n)})}})})}.call(this),function(){define("cloudres/CrClnRds",["ApiRequest","./CrCollection","constant","CloudResources","./CrModelRdsSnapshot","./CrModelRdsInstance","./CrModelRdsPGroup"],function(e,t,n,r,i,s,o){return t.extend({type:n.RESTYPE.DBENGINE,__selfParseData:!0,initialize:function(){this.optionGroupData={},this.engineDict={},this.defaultInfo={}},getOptionGroupsByEngine:function(e,t){var n;return e?t?n=this.optionGroupData[e][t]:void 0:void 0,n||""},getDefaultByNameVersion:function(e,t,n){var r;return e?t?n?r=this.engineDict[e][t][n]:void 0:void 0:void 0,r||""},getDefaultByFamily:function(e,t){var n;return e?t?n=this.defaultInfo[e][t]:void 0:void 0,n||""},doFetch:function(){var t,n;return n=this,t=this.region(),e("rds_DescribeDBEngineVersions",{region_name:t}).then(function(r){var i,s,o,u,a,f,l;n.optionGroupData[t]={},n.engineDict[t]={},n.defaultInfo[t]={};try{r=r.DescribeDBEngineVersionsResponse.DescribeDBEngineVersionsResult.DBEngineVersions.DBEngineVersion}catch(c){o=c,void 0}r=r||[],_.isArray(r)||(r=[r]),u={};for(f=0,l=r.length;f<l;f++)i=r[f],i.id=i.Engine+" "+i.EngineVersion,u[i.Engine]=!0,n.engineDict[t][i.Engine]||(n.engineDict[t][i.Engine]={}),s={family:i.DBParameterGroupFamily,defaultPGName:"default."+i.DBParameterGroupFamily,defaultOGName:"default:"+i.Engine+"-"+i.EngineVersion.split(".").slice(0,2).join("-"),canCustomOG:!1},n.engineDict[t][i.Engine][i.EngineVersion]=s,n.defaultInfo[t][i.DBParameterGroupFamily]||(n.defaultInfo[t][i.DBParameterGroupFamily]=s);return a=_.keys(u).map(function(r){return e("rds_og_DescribeOptionGroupOptions",{region_name:t,engine_name:r}).then(function(e){try{n.__parseOptions(n.category,e)}catch(t){o=t,void 0}})}),Q.all(a).then(function(){return r})})},__parseOptions:function(e,t){var n,r,i,s,o,u;s=this,t=t.DescribeOptionGroupOptionsResponse.DescribeOptionGroupOptionsResult.OptionGroupOptions;if(!t)return;t=t.OptionGroupOption||[],_.isArray(t)||(t=[t]);if(!t.length)return;i={};for(o=0,u=t.length;o<u;o++)n=t[o],r=n.EngineName,i[n.MajorEngineVersion]||(i[n.MajorEngineVersion]=[]),n.OptionGroupOptionSettings&&n.OptionGroupOptionSettings.OptionGroupOptionSetting&&(n.OptionGroupOptionSettings=n.OptionGroupOptionSettings.OptionGroupOptionSetting),i[n.MajorEngineVersion].push(n),_.each(s.engineDict[e][n.EngineName],function(e,t){if(t.indexOf(n.MajorEngineVersion)===0)return e.canCustomOG=!0});this.optionGroupData[e][r]=i}}),t.extend({type:n.RESTYPE.DBSBG,doFetch:function(){return e("rds_subgrp_DescribeDBSubnetGroups",{region_name:this.region()})},parseFetchData:function(e){var t,n,r,i,s;e=((i=e.DescribeDBSubnetGroupsResponse.DescribeDBSubnetGroupsResult.DBSubnetGroups)!=null?i.DBSubnetGroup:void 0)||[],_.isArray(e)||(e=[e]);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.DBSubnetGroupName,t.Subnets=(s=t.Subnets)!=null?s.Subnet:void 0;return e},parseExternalData:function(e){return this.unifyApi(e,this.type),this.camelToPascal(e),_.each(e,function(e){return e.id=e.DBSubnetGroupName}),e}}),t.extend({type:n.RESTYPE.DBOG,doFetch:function(){return e("rds_og_DescribeOptionGroups",{region_name:this.region()})},parseFetchData:function(e){var t,n,r,i;e=((i=e.DescribeOptionGroupsResponse.DescribeOptionGroupsResult.OptionGroupsList)!=null?i.OptionGroup:void 0)||[],_.isArray(e)||(e=[e]);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.OptionGroupName;return e},parseExternalData:function(e){return this.unifyApi(e,this.type),this.camelToPascal(e),_.each(e,function(e){return e.id=e.OptionGroupName}),e}}),t.extend({type:n.RESTYPE.DBINSTANCE,model:s,doFetch:function(){return e("rds_ins_DescribeDBInstances",{region_name:this.region()})},parseFetchData:function(e){var t,n,r,i,s,o,u;e=((i=e.DescribeDBInstancesResponse.DescribeDBInstancesResult.DBInstances)!=null?i.DBInstance:void 0)||[],_.isArray(e)||(e=[e]);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.DBInstanceIdentifier,t.Name=t.DBName,t.sbgId=(s=t.DBSubnetGroup)!=null?s.DBSubnetGroupName:void 0,t.DBParameterGroups=((o=t.DBParameterGroups)!=null?o.DBParameterGroup:void 0)||[],t.DBSecurityGroups=((u=t.DBSecurityGroups)!=null?u.DBSecurityGroup:void 0)||[];return e},parseExternalData:function(e){return this.unifyApi(e,this.type),this.camelToPascal(e),_.each(e,function(e){var t,n,r,i;e.DBSubnetGroup&&(e.DBSubnetGroup.DBSubnetGroupDescription=e.DBSubnetGroup.DbsubnetGroupDescription,e.DBSubnetGroup.DBSubnetGroupName=e.DBSubnetGroup.DbsubnetGroupName,delete e.DBSubnetGroup.DbsubnetGroupDescription,delete e.DBSubnetGroup.DbsubnetGroupName),i=e.DBParameterGroups;for(n=0,r=i.length;n<r;n++)t=i[n],t.DBParameterGroupName=t.DbparameterGroupName,delete t.DbparameterGroupName;return e.PendingModifiedValues&&(e.PendingModifiedValues.DBInstanceClass=e.PendingModifiedValues.DbinstanceClass,e.PendingModifiedValues.DBInstanceIdentifier=e.PendingModifiedValues.DbinstanceIdentifier,delete e.PendingModifiedValues.DbinstanceClass,delete e.PendingModifiedValues.DbinstanceIdentifier),e.id=e.DBInstanceIdentifier,e.Name=e.DBName,e.sbgId=e.DBSubnetGroup.DBSubnetGroupName}),e}}),t.extend({type:n.RESTYPE.DBSNAP,model:i,doFetch:function(){return e("rds_snap_DescribeDBSnapshots",{region_name:this.region()})},parseFetchData:function(e){var t,n,r,i;e=((i=e.DescribeDBSnapshotsResponse.DescribeDBSnapshotsResult.DBSnapshots)!=null?i.DBSnapshot:void 0)||[],_.isArray(e)||(e=[e]);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.DBSnapshotIdentifier;return e}}),t.extend({type:n.RESTYPE.DBPG,model:o,doFetch:function(){return e("rds_pg_DescribeDBParameterGroups",{region_name:this.region()})},parseFetchData:function(e){var t,n,r,i;e=((i=e.DescribeDBParameterGroupsResponse.DescribeDBParameterGroupsResult.DBParameterGroups)!=null?i.DBParameterGroup:void 0)||[],_.isArray(e)||(e=[e]);for(n=0,r=e.length;n<r;n++)t=e[n],t.id=t.DBParameterGroupName;return e}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define("cloudres/CrModelRdsParameter",["./CrModel","CloudResources","ApiRequest"],function(t,n,r){return t.extend({taggable:!1,isValidValue:function(t){var n,r,i,s,o,u,a;if(!this.attributes.AllowedValues)return!0;s=Number(t);if(e.call(this.attributes.AllowedValues.split(","),t)>=0)return!0;a=this.attributes.AllowedValues.split(",");for(o=0,u=a.length;o<u;o++){n=a[o];if(n.indexOf("-")>=0){if(!!isNaN(parseFloat(t))||!isFinite(t))return!1;if(n.split("-").length>=2){n.indexOf("-")===0?i=n.indexOf("-",1):i=n.indexOf("-",0),n=n.substr(0,i)+"#"+n.substr(i+1),r=n.split("#");if(s>=Number(r[0])&&s<=Number(r[1]))return!0}}}return!1},isFunctionValue:function(e){var t;return t=/^((GREATEST|LEAST|SUM)\s*\(\s*)*((({(DBInstanceClassMemory|AllocatedStorage|EndPointPort))+((\/|\*|\+|\-)*(\d+|(DBInstanceClassMemory|AllocatedStorage|EndPointPort)))*}|\d+)\s*,?\s*\)*)*$/,t.test(e)},isNumber:function(e){var t;return t=/^\d+$/,t.test(e)},applyMethod:function(){return this.get("ApplyType")==="dynamic"?"immediate":"pending-reboot"}})})}.call(this),function(){define("cloudres/CrClnRdsParam",["ApiRequest","./CrCollection","constant","CloudResources","./CrModelRdsParameter"],function(e,t,n,r,i){return t.extend({type:n.RESTYPE.DBPARAM,model:i,__selfParseData:!0,init:function(e){return this.groupModel?this:(this.groupModel=e,this.listenTo(e,"remove",this.reset),this)},region:function(){var e;return(e=this.groupModel.collection)!=null?e.region():void 0},doFetch:function(t){var n;return n=this,e("rds_pg_DescribeDBParameters",{region_name:this.region(),param_group:this.category,marker:t}).then(function(e){var r,i,s,o,u;try{t=e.DescribeDBParametersResponse.DescribeDBParametersResult.Marker,e=((u=e.DescribeDBParametersResponse.DescribeDBParametersResult.Parameters)!=null?u.Parameter:void 0)||[]}catch(a){i=a,void 0}_.isArray(e)||(e=[e]);for(s=0,o=e.length;s<o;s++)r=e[s],r.id=r.ParameterName;return t?(n.__bucket?n.__bucket=n.__bucket.concat(e):n.__bucket=e,n.doFetch(t)):(n.__bucket&&(e=n.__bucket.concat(e),n.__bucket=null),e)})}})})}.call(this),function(){define("cloudres/CrBundle",["CloudResources","./CrClnSharedRes","./CrClnCommonRes","./CrClnOpsResource","./CrClnAmi","./CloudImportVpc","./CrClnRds","./CrClnRdsParam"],function(e){return e})}.call(this);