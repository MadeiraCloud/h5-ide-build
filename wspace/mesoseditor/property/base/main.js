define(["event"],function(e){var t,n,r,i,s,o,u,a,f,l,c,h;return n=null,r=null,i=null,s=null,f=[].slice,e.onLongListen("all",function(e){var t,r;if((!n||!n.ideEvents)&&(!i||!i.ideEvents))return;return n&&n.ideEvents&&n.ideEvents.hasOwnProperty(e)&&(t=f.call(arguments,1),r=n.ideEvents[e],_.isString(r)&&(r=n[r]),r.apply(n,t)),i&&i.ideEvents&&i.ideEvents.hasOwnProperty(e)&&(t||(t=f.call(arguments,1)),r=i.ideEvents[e],_.isString(r)&&(r=i[r]),r.apply(i,t)),null}),u={},a=[],u.DEFAULT_TYPE="default",o={},t=function(){return this.type=t.TYPE.Stack,null},t.TYPE=t.prototype.TYPE={Stack:"Stack",App:"App",AppEdit:"AppEdit"},t.prototype.loadSubPanel=function(e,t){return c(o[e],e,t,n.type)},t.extend=function(e,n){var r,i,s,f,l,c,h;s=Backbone.Model.extend.call(t,e,n),i=new s;if(i.subPanelID)return o[i.subPanelID]=i,s;e.handleTypes===""?r=[u.DEFAULT_TYPE]:_.isString(e.handleTypes)||!e.handleTypes.hasOwnProperty("length")?r=[e.handleTypes]:r=e.handleTypes;for(c=0,h=r.length;c<h;c++){f=r[c];if(!f.hasOwnProperty("length")){a.push({regexp:f,prop:i});continue}f.indexOf(">")&&(l=f.split(">"),l.length===2&&l[1].length>0&&(u[l[1]+">"+l[0]]=i)),u[f]=i}return s},t.prototype.activeModule=function(){return n},t.prototype.activeSubModule=function(){return i},t.activeModule=t.prototype.activeModule,t.activeSubModule=t.prototype.activeSubModule,t.loadSubPanel=t.prototype.loadSubPanel,t.load=function(e,t,n,r){var i,s;return s=l(e,t,n),i=c(s,e,t,n,r),i!==!0?(i===!1?e="Missing_Resource":(e="",void 0),s=l(e,t,n),c(s,e,t,n,r)):!0},l=function(e,t,n){var r,i,s,o,f;e||(e=u.DEFAULT_TYPE),r=e,i=u[e],i||(r=n+":"+e,i=u[r]);if(!i&&e.indexOf(!1))for(o=0,f=a.length;o<f;o++){s=a[o];if(e.match(s.regexp)){r=s.regexp,i=s.prop;break}}if(!i)return;return i.handle=r,i},c=function(e,o,u,a,f){var l,c,p;if(!e)return!1;e.type=a,l="init"+e.type;if(!e[l])return;e.uid=u,c=e[l].call(e,u);if(c===!1)return;l="setup"+e.type,e[l]&&(e[l].call(e),e[l]=null),e.subPanelID?(i=e,s=o):(i=null,s=null,n=e,r=o);if((p=e.model)!=null?p.init:void 0){e.model.clear({silent:!0});if(e.model.init(u)===!1)return!1}return h(f,e.model),e.view.model=e.model,e.view._isSub=!!e.subPanelID,e.view.__restore=t.__restore,t.__restore=!1,e.subPanelID?e.view._loadAsSub(e.subPanelID):e.view._load(),l="afterLoad"+e.type,e[l]&&e[l].call(e),!0},h=function(e,t){},t.onUnloadSubPanel=function(){return n.onUnloadSubPanel&&n.onUnloadSubPanel(i.subPanelID),i=null,s=null,null},t.snapshot=function(){return{activeModuleId:n.uid,activeModuleType:r,activeSubModuleId:i?i.uid:null,activeSubModuleType:s,tab_type:n.type}},t.restore=function(e,n){return t.load(e.activeModuleType,e.activeModuleId,e.tab_type,!0),e.activeSubModuleType&&(t.__restore=!0,t.loadSubPanel(e.activeSubModuleType,e.activeSubModuleId,!0),t.__restore=!1),null},t});