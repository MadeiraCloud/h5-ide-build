define(["./template/container","./template/containerApp","i18n!/nls/lang.js","constant","UI.modalplus"],function(e,t,n,r,i){return Backbone.View.extend({className:"container-settings",tagName:"form",events:{"click #add-item-outside":"addItem","ADD_ROW .multi-input":"processMapTitle","REMOVE_ROW .multi-input":"processMapTitle"},initialize:function(e){var t;return this.appData=e.appData,this.$el.prop("data-bind",!0),t={template:this.el,title:"Container Settings",width:"555px",height:"473px",compact:!0,mode:"panel",confirm:{text:"Save"}},this.modal=new i(t),this.modal.on("confirm",this.save,this)},render:function(){return this.appData?this.$el.html(t(this.appData.container)):this.$el.html(e(this.model.container()))},remove:function(){var e;return(e=this.modal)!=null&&e.close(),Backbone.View.prototype.remove.apply(this,arguments)},addItem:function(e){return $(e.currentTarget).closest(".input-item").find(".ipt-controls .icon-add").eq(0).click(),!1},save:function(){var e,t;t=this.$el;if(!t.parsley("validate"))return;return e=this.getContainer(t),this.model.set("container",e),this.remove()},getContainer:function(e){var t;return t={docker:{}},_.each(e.serializeArray(),function(e){return t.docker[e.name]=e.value}),t.docker.portMappings=this.getMapData(this.$(".port-mappings")),t.docker.parameters=this.getMapData(this.$(".parameters")),t.docker.privileged=this.$("#cb-privileged")[0].checked,t.volumes=this.getMapData(this.$(".volumes")),t},getMapData:function(e){var t;return t=[],e.find(".multi-ipt-row:not(.template)").each(function(){var e;return e={},$(this).find(".input").each(function(){var t,n,r,i;t=$(this),i=t.val(),n=t.data("name");if(n==="hostPort"||n==="servicePort")i=+i;return n==="container"?(r=i.split("/"),e.containerPort=+r[0],e.protocol=r[1]):n==="containerPath"?(r=i.split(":"),e.containerPath=r[0],e.mode=r[1]):e[n]=i}),t.push(e)}),t},processMapTitle:function(e){var t,n;return t=$(e.currentTarget),n=t.find(".multi-ipt-row").length>1,t.prev(".titles").toggle(n)}})});