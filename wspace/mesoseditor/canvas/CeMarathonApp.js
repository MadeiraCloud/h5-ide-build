define(["CanvasElement","constant","CanvasManager","i18n!/nls/lang.js","CanvasView","CloudResources"],function(e,t,n,r,i,s){return e.extend({type:t.RESTYPE.MRTHAPP,parentType:[t.RESTYPE.MRTHGROUP,"SVG"],defaultSize:[18,8],portPosition:function(t,n){var r,i;return r=this.model,t==="app-dep-in"?(i=0,n&&(i-=5),[i,41,e.constant.PORT_LEFT_ANGLE]):(i=175,n&&(i+=9),[i,41,e.constant.PORT_RIGHT_ANGLE])},iconUrl:function(){return"ide/icon-mrth/icn-"+this.model.get("image")+".png"},listenModelEvents:function(){this.listenTo(s(this.canvas.design.credentialId(),t.RESTYPE.MRTHAPP,this.canvas.design.opsModel().id),"change",this.render),this.listenTo(this.model,"change",this.render)},create:function(){var e,t,n,i,s,o,u;return t=this.model,s=this.canvas.svg,i=this.size(),u=150,e=70,n=10,o=s.group().add([s.rect(u+9,e+9).move(8.5,.5).radius(5).classes("marathon-app-bg"),s.rect(u-1,37).move(n+3.5,37.5).radius(2).classes("marathon-app-bottom"),s.rect(u-1,32).move(n+3.5,8.5).classes("marathon-app-top"),s.rect(u-2,1).move(n+4,40).classes("marathon-app-line"),s.use("marathon_app_title").attr({"class":"marathon-app-ceiling",fill:this.model.get("color")}),s.image(MC.IMG_URL+this.iconUrl(),20,20).move(21,15),s.text("").move(47,29).classes("node-label"),s.image(MC.IMG_URL+"ide/icon-mrth/cvs-appicon.png",120,32).move(20,42),s.plain("").move(50,62).attr({"class":"cpu-label tooltip","data-tooltip":"CPU"}),s.plain("").move(115,62).attr({"class":"memory-label tooltip","data-tooltip":"Memory"}),s.use("marathon_port").attr({"class":"port port-marathon tooltip","data-name":"app-dep-in","data-tooltip":r.IDE.PORT_TIP_U}),s.use("marathon_port").attr({"class":"port port-marathon tooltip","data-name":"app-dep-out","data-tooltip":r.IDE.PORT_TIP_V}),s.group().add([s.rect(20,16).move(155,-3).radius(3).classes("server-number-bg"),s.plain("0").move(165,9).attr({"class":"server-number","text-anchor":"middle"})]).attr({"class":"server-number-group tooltip","data-tooltip":this.canvas.design.modeIsApp()?"Tasks/Instances":"Instances"})]).attr({"data-id":this.cid}).classes("canvasel "+this.type.replace(/\.|:/g,"-")),this.canvas.design.modeIsApp()&&($(o.node).find(".server-number-bg").attr({width:40,x:135}),$(o.node).find(".server-number").attr({x:155})),this.canvas.appendNode(o),this.initNode(o,t.x(),t.y()),o},label:function(){return this.model.get("name")},labelWidth:function(){return 110},render:function(){var e,r,o,u,a;return o=this.model,n.setLabel(this,this.$el.children(".node-label")),this.$el[0].instance.move(o.x()*i.GRID_WIDTH,o.y()*i.GRID_WIDTH),n.update(this.$el.find(".cpu-label"),o.get("cpus")||"0"),n.update(this.$el.find(".memory-label"),o.get("mem")||"0"),this.canvas.design.modeIsApp()?(e=s(this.canvas.design.credentialId(),t.RESTYPE.MRTHAPP,this.canvas.design.opsModel().id).get(o.path()),e?(u=e.get("tasksRunning"),r=e.get("instances"),a=""+u+"/"+r,parseInt(u)!==parseInt(r)?n.addClass(this.$el.find(".server-number-group"),"mismatch"):n.removeClass(this.$el.find(".server-number-group"),"mismatch")):a=o.get("instances"),n.update(this.$el.find(".server-number"),a)):n.update(this.$el.find(".server-number"),o.get("instances")||"0")}})});