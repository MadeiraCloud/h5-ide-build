define("wspace/progress/PVTpl",["handlebars"],function(e){var t=function(e,t,n,r,i){function l(e,t){return"has-progess"}function c(e,t){var n;return a((n=e&&e.title,typeof n===u?n.apply(e):n))}function h(e,t){return a(n.i18n.call(e,"PROC_TITLE",{hash:{},data:t}))}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+="<div class='ops-process ",o=n["if"].call(t,t&&t.progress,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+='\'>\n  <section class="processing-wrap">\n    <header class="processing">',o=n["if"].call(t,t&&t.title,{hash:{},inverse:f.program(5,h,i),fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='<span class="process-info">'+a((o=t&&t.progress,typeof o===u?o.apply(t):o))+'%</span></header>\n    <header class="processing rolling-back-content">'+a(n.i18n.call(t,"PROP.ROLLING_BACK",{hash:{},data:i}))+'</header>\n    <section class="loading-spinner"></section>\n    <section class="progress">\n        <div class="bar" style="width:'+a((o=t&&t.progress,typeof o===u?o.apply(t):o))+'%;"></div>\n    </section>\n  </section>\n\n  <section class="success hide">\n    <p class="title">'+a(n.i18n.call(t,"PROC_RLT_DONE_TITLE",{hash:{},data:i}))+'</p>\n    <p class="sub-title">'+a(n.i18n.call(t,"PROC_RLT_DONE_SUB_TITLE",{hash:{},data:i}))+'</p>\n  </section>\n\n  <section class="fail hide error-info-block">\n    <header>'+a(n.i18n.call(t,"PROC_FAILED_TITLE",{hash:{},data:i}))+'</header>\n    <p class="sub-title">'+a(n.i18n.call(t,"PROC_RLT_FAILED_SUB_TITLE",{hash:{},data:i}))+'</p>\n    <div class="result-error-info">\n      <p class="title">'+a(n.i18n.call(t,"PROC_ERR_INFO",{hash:{},data:i}))+'</p>\n      <p class="detail"></p>\n    </div>\n    <button class="btn btn-silver btn-close-process right">'+a(n.i18n.call(t,"PROC_CLOSE_TAB",{hash:{},data:i}))+"</button>\n  </section>\n</div>",s};return e.template(t)}),function(){define("wspace/progress/ProgressViewer",["OpsModel","Workspace","./PVTpl"],function(e,t,n){var r;return r=Backbone.View.extend({events:{"click .btn-close-process":"close"},initialize:function(t){var r;this.listenTo(this.model,"destroy",this.updateState),this.listenTo(this.model,"change:state",this.updateState),this.listenTo(this.model,"change:progress",this.updateProgress),r={progress:this.model.get("progress")},this.model.testState(e.State.Initializing)||(r.title=this.model.getStateDesc()+" your app..."),this.setElement($(n(r)).appendTo(t.workspace.scene.spaceParentElement())),this.__progress=0},switchToDone:function(){var e;this.$el.find(".success").show(),e=this,setTimeout(function(){e.$el.find(".processing-wrap").addClass("fadeout"),e.$el.find(".success").addClass("fadein")},10),setTimeout(function(){return e.trigger("done")},2e3)},updateState:function(){switch(this.model.get("state")){case e.State.Running:case e.State.Stopped:this.__awake?this.switchToDone():this.done=!0;break;case e.State.Destroyed:if(this.done){this.close();return}this.$el.children().hide(),this.$el.find(".fail").show(),this.$el.find(".detail").html(this.model.get("opsActionError").replace(/\n/g,"<br/>"));break;default:void 0}},updateProgress:function(){var e,t;e=this.model.get("progress"),this.$el.toggleClass("has-progess",!0),this.__progress>e&&this.$el.toggleClass("rolling-back",!0),this.__progress=e,t=""+e+"%",this.$el.find(".process-info").text(t),this.$el.find(".bar").css({width:t})},close:function(){return this.trigger("close")},awake:function(){this.$el.show(),this.__awake=!0,this.done&&(this.done=!1,this.switchToDone())},sleep:function(){this.$el.hide(),this.__awake=!1}}),t.extend({type:"ProgressViewer",isWorkingOn:function(e){return this.opsModel()===e.opsModel},tabClass:function(){return"icon-app-pending"},title:function(){return this.opsModel().get("name")+" - app"},url:function(){return this.opsModel().relativeUrl()},constructor:function(n){if(!n.opsModel)throw new Error("Cannot find opsmodel while openning workspace.");if(n.opsModel.testState(e.State.Saving)||n.opsModel.testState(e.State.Terminating)){void 0;return}t.apply(this,arguments)},initialize:function(){var e;this.view=new r({model:this.opsModel(),workspace:this}),this.listenTo(this.opsModel(),"change:id",function(){this.updateUrl()}),e=this,this.view.on("close",function(){return e.remove()}),this.view.on("done",function(){e.remove(),App.loadUrl(e.opsModel().url())})},opsModel:function(){return this.get("opsModel")},awake:function(){return this.view.awake()},sleep:function(){return this.view.sleep()}},{canHandle:function(t){return t.opsModel?t.opsModel.testState(e.State.Saving)||t.opsModel.testState(e.State.Terminating)?(void 0,!1):t.opsModel.isApp()&&t.opsModel.isProcessing():!1}})})}.call(this);