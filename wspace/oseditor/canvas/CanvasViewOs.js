define(["CanvasView","constant","i18n!/nls/lang.js","CanvasManager","Design","./CpVolume"],function(e,t,n,r,i,s){var o,u;return u=function(e,t){return t.x1<=e.x&&t.y1<=e.y&&t.x2>=e.x&&t.y2>=e.y},o=e.extend({events:function(){return $.extend({addVol_dragover:"__addVolDragOver",addVol_dragleave:"__addVolDragLeave",addVol_drop:"__addVolDrop"},e.prototype.events)},recreateStructure:function(){this.svg.clear().add([this.svg.group().classes("layer_network"),this.svg.group().classes("layer_groupLine"),this.svg.group().classes("layer_subnet"),this.svg.group().classes("layer_line"),this.svg.group().classes("layer_node")])},appendNetwork:function(e){return this.__appendSvg(e,".layer_network")},appendSubnet:function(e){return this.__appendSvg(e,".layer_subnet")},appendGroupLine:function(e){return this.__appendSvg(e,".layer_groupLine")},fixConnection:function(e,t,n){},errorMessageForDrop:function(e){switch(e){case t.RESTYPE.OSSUBNET:return n.CANVAS.WARN_NOTMATCH_OSSUBNET;case t.RESTYPE.OSLISTENER:return n.CANVAS.WARN_NOTMATCH_LISTENER;case t.RESTYPE.OSPOOL:return n.CANVAS.WARN_NOTMATCH_POOL;case t.RESTYPE.OSELB:return n.CANVAS.WARN_NOTMATCH_LB;case t.RESTYPE.OSRT:return n.CANVAS.WARN_NOTMATCH_ROUTER;case t.RESTYPE.OSRT:return n.CANVAS.WARN_NOTMATCH_ROUTER;case t.RESTYPE.OSVOL:return n.CANVAS.WARN_NOTMATCH_OSVOL;case t.RESTYPE.OSSERVER:return n.CANVAS.WARN_NOTMATCH_SERVER}},selectVolume:function(e){return this.deselectItem(!0),e&&this.triggerSelected(t.RESTYPE.OSVOL,e),this.__selectedVolume=e,!1},isReadOnly:function(){return this.design.modeIsApp()},delSelectedItem:function(){var t,n,r,i;if(this.isReadOnly())return!1;if(this.__selectedVolume){i=this.design.component(this.__selectedVolume),n=i.isRemovable();if(_.isString(n)){notification("error",n);return}r=this.__selectedVolume,this.__selectedVolume=null,i.remove(),t=$(".canvas-pp .popup-volume").children().eq(0),t.length?t.trigger("mousedown"):this.deselectItem();return}return e.prototype.delSelectedItem.apply(this,arguments)},__addVolDragOver:function(e,n){var i,o,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T;this.__scrollOnDrag(n);if(!n.volDropTargets){n.hoverItem=null,n.volDropTargets=i=[],E=this.design.componentsOfType(t.RESTYPE.OSSERVER);for(p=0,g=E.length;p<g;p++){h=E[p],h=this.getItem(h.id),S=h.$el;for(d=0,y=S.length;d<y;d++)o=S[d],c=h.rect(o),c.tgt=h,c.el=o,i.push(c)}}if(!n.effect){n.effect=!0,x=n.volDropTargets||[];for(v=0,b=x.length;v<b;v++)h=x[v],r.addClass(h.tgt.$el,"droppable")}l=this.__localToCanvasCoor(n.pageX-n.zoneDimension.x1,n.pageY-n.zoneDimension.y1),a=null,T=n.volDropTargets;for(m=0,w=T.length;m<w;m++){h=T[m];if(u(l,h)){a=h;break}}a!==n.hoverItem&&(n.popup&&n.popup.remove(),n.hoverItem=a,a&&(f=a.tgt.model,n.popup=new s({attachment:a.el,host:f,models:f.volumes(),canvas:this})))},__addVolDragLeave:function(e,t){var n,i,s,o;this.__clearDragScroll(),o=t.volDropTargets||[];for(i=0,s=o.length;i<s;i++)n=o[i],r.removeClass(n.tgt.$el,"droppable");t.effect=!1,t.popup&&t.popup.remove()},__addVolDrop:function(e,n){var r,o,u,a,f,l,c;if(!n.hoverItem)return;o=n.dataTransfer||{},f=n.hoverItem.tgt.model;if(o.id){c=this.design.component(o.id),a=c.getOwner(),u=c.isReparentable(f);if(_.isString(u))return notification("error",u);u&&(c.attachTo(f),this.selectItem(n.hoverItem.el));return}o.owner=f,r=i.modelClassForType(t.RESTYPE.OSVOL),l=new r(o),n.popup&&n.popup.remove(),new s({attachment:n.hoverItem.el,host:f,models:f.volumes(),canvas:this,selectAtBegin:l})}}),o});