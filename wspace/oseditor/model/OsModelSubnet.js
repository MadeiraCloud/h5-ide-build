define(["GroupModel","constant"],function(e,t){var n;return n=e.extend({type:t.RESTYPE.OSSUBNET,newNameTmpl:"subnet",defaults:function(){return{"public":!1,cidr:"",dhcp:!0,nameservers:[]}},initialize:function(e,t){if(t.createByUser)return this.set("cidr",this.generateCidr())},generateCidr:function(){var e,t,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;r="10.0.0.0/8",c=r.split("/"),h=c[0],p=h.split("."),d=Number(c[1]),i=-1,g=n.allObjects();for(v=0,m=g.length;v<m;v++)e=g[v],o=e.get("cidr"),u=o.split("/"),f=u[0],l=Number(u[1]),a=f.split("."),t=Number(a[1]),i<t&&(i=t);return s=i+1,s>255?"":(p[1]=String(s),p.join(".")+"/16")},resetAllChildIP:function(){var e,n,r;return n=Design.modelClassForType(t.RESTYPE.OSPORT).allObjects(),e=Design.modelClassForType(t.RESTYPE.OSLISTENER).allObjects(),r=n.concat(e),_.each(r,function(e){return e.assignIP(),null})},serialize:function(){return{layout:this.generateLayout(),component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),cidr:this.get("cidr"),enable_dhcp:this.get("dhcp"),dns_nameservers:this.get("nameservers"),network_id:this.parent().createRef("id"),gateway_ip:"",ip_version:"4",allocation_pools:{}}}}}},{handleTypes:t.RESTYPE.OSSUBNET,deserialize:function(e,t,r){new n({id:e.uid,name:e.resource.name,appId:e.resource.id,parent:r(MC.extractID(e.resource.network_id)),cidr:e.resource.cidr,dhcp:e.resource.enable_dhcp,x:t.coordinate[0],y:t.coordinate[1],width:t.size[0],height:t.size[1],nameservers:_.isArray(e.resource.dns_nameservers)?e.resource.dns_nameservers:[]})}}),n});