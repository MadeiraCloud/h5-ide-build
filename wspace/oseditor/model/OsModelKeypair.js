(function(){define(["constant","ComplexResModel","ConnectionModel"],function(e,t,n){var r,i;return i=n.extend({type:"KeypairUsage",oneToMany:e.RESTYPE.OSKP,serialize:function(t){var n,r,i,s,o,u,a,f;r=this.getTarget(e.RESTYPE.OSKP);if(r){s=this.getOtherTarget(r),o=t[s.id];if(!o)return;u=r.createRef("keyName"),o.resource.keyName=u,n=s.groupMembers?s.groupMembers():[];for(a=0,f=n.length;a<f;a++)i=n[a],t[i.id]&&(t[i.id].resource.keyName=u)}return null}}),r=t.extend({type:e.RESTYPE.OSKP,defaults:{fingerprint:"",isSet:!1},isVisual:function(){return!1},isDefault:function(){return this.get("name")==="DefaultKP"},remove:function(){var e,n,s,o,u;e=r.getDefaultKP(),u=this.connectionTargets("KeypairUsage");for(s=0,o=u.length;s<o;s++)n=u[s],new i(e,n);return t.prototype.remove.call(this),null},assignTo:function(e){return new i(this,e)},dissociate:function(t){var n;return n=this.connections(),_.each(n,function(n){if(n.getOtherTarget(e.RESTYPE.OSKP)===t)return n.remove()})},isSet:function(){return this.get("appId")&&this.get("fingerprint")},getKPList:function(){var e,t,n,i,s;t=[],s=r.allObjects();for(n=0,i=s.length;n<i;n++)e=s[n],t.push({id:e.id,name:e.get("name"),selected:e===this,using:e.connections("KeypairUsage").length>1});return _.sortBy(t,function(e,t){if(e.name==="DefaultKP")return-1;if(t.name==="DefaultKP")return 1;if(e.name>t.name)return 1;if(e.name===t.name)return 0;if(e.name<t.name)return-1})},serialize:function(){return{component:{name:this.get("name"),type:this.type,uid:this.id,resource:{fingerprint:this.get("fingerprint")||"",keyName:this.get("keyName")||""}}}}},{getDefaultKP:function(){return _.find(r.allObjects(),function(e){return e.get("name")==="DefaultKP"})},setDefaultKP:function(e,t){var n;return n=_.find(r.allObjects(),function(e){return e.get("name")==="DefaultKP"}),n.set("appId",e||""),n.set("fingerprint",t||""),n.set("isSet",!0)},diffJson:function(){},handleTypes:e.RESTYPE.OSKP,deserialize:function(e,t,n){return new r({id:e.uid,name:e.name,keyName:e.resource.keyName,fingerprint:e.resource.fingerprint}),null}}),r})}).call(this);