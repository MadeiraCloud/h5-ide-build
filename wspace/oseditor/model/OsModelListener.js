(function(){define(["./OsModelPort","constant","Design"],function(e,t,n){var r;return r=e.extend({type:t.RESTYPE.OSLISTENER,newNameTmpl:"listener",defaults:function(){return{protocol:"HTTP",port:80,limit:1e3,ip:"",portId:""}},initialize:function(e,r){var i;r.pool&&(i=n.modelClassForType("OsListenerAsso"),new i(this,r.pool)),r.createByUser&&(n.modelClassForType(t.RESTYPE.OSSG).attachDefaultSG(this),this.assignIP()),this.listenTo(this,"change:protocol",function(){var e;return(e=this.connectionTargets("OsListenerAsso")[0])!=null?e.set("protocol",this.get("protocol"),{silent:!0}):void 0})},assignIP:function(){var e;e=n.modelClassForType(t.RESTYPE.OSPORT).getAvailableIP(this.parent());if(e)return this.set("ip",e)},onParentChanged:function(e){if(e)return this.assignIP()},isAttached:function(){return!0},isVisual:function(){return!0},isEmbedded:function(){return!1},getFloatingIp:function(){return this.connectionTargets("OsFloatIpUsage")[0]},serialize:function(){var e;return{layout:this.generateLayout(),component:{name:this.get("name"),type:this.type,uid:this.id,resource:{id:this.get("appId"),name:this.get("name"),pool_id:((e=this.connectionTargets("OsListenerAsso")[0])!=null?e.createRef("id"):void 0)||"",subnet_id:this.parent().createRef("id"),connection_limit:this.get("limit"),protocol:this.get("protocol"),protocol_port:this.get("port"),port_id:this.get("portId"),address:this.get("ip"),security_groups:this.connectionTargets("OsSgAsso").map(function(e){return e.createRef("id")})}}}}},{handleTypes:t.RESTYPE.OSLISTENER,deserialize:function(e,t,i){var s,o,u,a,f,l;o=new r({id:e.uid,name:e.resource.name,appId:e.resource.id,limit:e.resource.connection_limit,port:e.resource.protocol_port,protocol:e.resource.protocol,parent:i(MC.extractID(e.resource.subnet_id)),x:t.coordinate[0],y:t.coordinate[1],portId:e.resource.port_id,ip:e.resource.address},{pool:i(MC.extractID(e.resource.pool_id))}),s=n.modelClassForType("OsSgAsso"),l=e.resource.security_groups||[];for(a=0,f=l.length;a<f;a++)u=l[a],new s(o,i(MC.extractID(u)))}}),r})}).call(this);