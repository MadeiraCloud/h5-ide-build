define(["OpsModel","Design","../template/TplStatusbar","constant","backbone","event","state_status","i18n!/nls/lang.js"],function(e,t,n,r,i,s,o,u){var a,f;return f=[{name:"lastSaved",className:"info",visible:!0,events:{update:function(){return[{obj:null,event:"jsonDataSaved"}]}},update:function(e,t){var n;return n=jQuery.now()/1e3,this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){var t,r;t=e(".stack-save-time"),r=MC.intervalDate(n);if(t.text()!==r)return t.text(r)},1e3),null},click:function(e){return null},remove:function(){return clearInterval(this.timer)}},{name:"ta",className:"status-bar-btn",visible:function(e,t){var n,r;return r=t.design.mode(),r==="app"||r==="appview"?n=!1:n=!0,typeof e=="function"&&e(n),n},changeVisible:!0,click:function(e){var t,n;return t=$(e.currentTarget),n=u.IDE.LBL_VALIDATE,t.text(u.IDE.VALIDATING_3DOT),setTimeout(function(){return MC.ta.validAll(),t.text(n),require(["TaGui"],function(e){return e.loadModule("statusbar",null)})},50)}},{name:"state",className:"status-bar-btn",visible:function(t,n){var r,i,s;return s=n.design.mode(),r=_.every([e.State.Updating,e.State.Running,e.State.Saving],function(e){return!n.opsModel.testState(e)}),i=!1,s==="app"||s==="appedit"?i=!r:s==="appview"&&(i=!1),typeof t=="function"&&t(i),i},events:{update:[{obj:s,event:s.UPDATE_STATE_STATUS_DATA}]},changeVisible:!0,update:function(e,t){var n;return n=this.renderData(!0,t),e(".state-success b").text(n.successCount),e(".state-failed b").text(n.failCount)},renderData:function(e,t){var n,r,i,s,o,u,a,f,l,c;this.workspace=t;if(!e)return{};i=App.WS.collection.status.find().fetch(),o=n=0,_.isArray(i)||(i=[i]);for(u=0,f=i.length;u<f;u++){r=i[u];if(r.app_id!==t.opsModel.get("id"))continue;if(r.status){c=r.status;for(a=0,l=c.length;a<l;a++)s=c[a],s.result==="success"?o++:s.result==="failure"&&n++}}return{successCount:o,failCount:n}},click:function(e){return o.loadModule()}}],a=i.View.extend({tagName:"li",initialize:function(){return _.bindAll(this,"render","toggle"),this.clearGarbage=[],this.needUpdate=[]},render:function(){return this.$el.html(this.template(this.data)),this},toggle:function(e){return this.$el.toggle(e)},remove:function(){var e,t,n,r;this.$el.remove(),this.stopListening(),r=this.clearGarbage;for(t=0,n=r.length;t<n;t++)e=r[t],_.isArray(e)?e[1].apply(e[0],e.slice(2)):e();return this.clearGarbage=[],this.needUpdate=[],this},update:function(){var e,t,n,r;r=this.needUpdate;for(t=0,n=r.length;t<n;t++)e=r[t],e();return this}}),i.View.extend({initialize:function(e){var t;return _.extend(this,e),t=this.workspace,this.itemViews=[],this.setElement(this.parent.$el.find(".OEPanelBottom").html(n.frame())),this.renderItem()},ready:!1,bindItem:function(){var e,t,r,i,o,u,l,c,h,p,d,v,m,g,y,b,w;b=jQuery.extend(!0,[],f).reverse();for(r=v=0,g=b.length;v<g;r=++v){o=b[r],l=new a,l.delegateEvents({click:o.click}),l.template=n[o.name],l.$el.addClass(o.className),c=_.bind(l.$,l),h=_.bind(l.toggle,l),_.isFunction(o.visible)&&(d=_.bind(o.visible,o,h,this.workspace)),_.isFunction(o.update)&&(p=_.bind(o.update,o,c,this.workspace)),w=o.events;for(u in w){t=w[u],_.isFunction(t)&&(t=t());if(!_.isArray(t))continue;for(m=0,y=t.length;m<y;m++)e=t[m],u==="update"&&(e.obj===s?(s.onLongListen(e.event,p),l.clearGarbage.push([s,s.offListen,e.event,p])):l.listenTo(e.obj||this.workspace.opsModel,e.event,p))}o.changeVisible&&(o.visible&&l.needUpdate.push(d),o.update&&l.needUpdate.push(p)),_.isFunction(o.visible)?i=o.visible(l.toggle,this.workspace):(l.toggle(o.visible),i=o.visible),l.data=(typeof o.renderData=="function"?o.renderData(i,this.workspace):void 0)||{},o.remove&&l.clearGarbage.push(_.bind(o.remove,o)),this.itemViews.push(l)}return null},renderItem:function(){var e,t,n,r,i;e=this,this.ready||(this.bindItem(),this.ready=!0),i=this.itemViews;for(n=0,r=i.length;n<r;n++)t=i[n],this.$("ul").append(t.render().el);return this},update:function(){var e,t,n,r,i;r=this.itemViews,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.update());return i},remove:function(){var e,t,n,r;this.$el.remove(),this.stopListening(),r=this.itemViews;for(t=0,n=r.length;t<n;t++)e=r[t],e.remove();return this}})});