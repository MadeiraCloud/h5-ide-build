(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["ApiRequest","CloudResources","constant","backbone"],function(t,n,r){return Backbone.Model.extend({defaults:{region:"",provider:""},initialize:function(){var e,t;return t=this.region=App.user.get("default_region"),this.provider=App.user.get("default_provider"),e=r.RESTYPE,t=this.region,this.listenTo(n(e.OSSERVER,t),"update",this.onRegionResChanged(["OSSERVER","FIP"])),this.listenTo(n(e.OSPORT,t),"update",this.onRegionResChanged(["FIP"])),this.listenTo(n(e.OSVOL,t),"update",this.onRegionResChanged(["OSVOL","OSSNAP"])),this.listenTo(n(e.OSSNAP,t),"update",this.onRegionResChanged(["OSSNAP"])),this.listenTo(n(e.OSFIP,t),"update",this.onRegionResChanged(["OSFIP"])),this.listenTo(n(e.OSRT,t),"update",this.onRegionResChanged(["OSRT"])),this.listenTo(n(e.OSPOOL,t),"update",this.onRegionResChanged(["OSPOOL","OSLISTENER"])),this.listenTo(n(e.OSLISTENER,t),"update",this.onRegionResChanged(["OSLISTENER"])),this.listenTo(n(e.OSNETWORK,t),"update",this.onRegionResChanged(["OSRT"]))},onRegionResChanged:function(e){return function(){return this.trigger("change:regionResources",e)}},fetchOsResources:function(){n(r.RESTYPE.OSSERVER,this.region).fetch(),n(r.RESTYPE.OSPORT,this.region).fetch(),n(r.RESTYPE.OSVOL,this.region).fetch(),n(r.RESTYPE.OSSNAP,this.region).fetch(),n(r.RESTYPE.OSFIP,this.region).fetch(),n(r.RESTYPE.OSRT,this.region).fetch(),n(r.RESTYPE.OSPOOL,this.region).fetch(),n(r.RESTYPE.OSLISTENER,this.region).fetch(),n(r.RESTYPE.OSNETWORK,this.region).fetch()},isOsResReady:function(e){var t;t=n(e,this.region).isReady();switch(e){case r.RESTYPE.OSLISTENER:t=t&&n(r.RESTYPE.OSPOOL,this.region).isReady();break;case r.RESTYPE.OSPOOL:t=t&&n(r.RESTYPE.OSLISTENER,this.region).isReady()}return t},getOsResData:function(t){var i,s,o,u;return u=this.region,i=["centos","debian","fedora","gentoo","opensuse","redhat","suse","ubuntu","windows","cirros"],s={servers:_.map(n(r.RESTYPE.OSSERVER,u).toJSON(),function(t){var n;if(n=t.system_metadata.image_os_distro,e.call(i,n)<0)t.system_metadata.image_os_distro="unknown";return t}),volumes:n(r.RESTYPE.OSVOL,u).toJSON(),snaps:n(r.RESTYPE.OSSNAP,u).toJSON(),fips:n(r.RESTYPE.OSFIP,u).toJSON(),rts:n(r.RESTYPE.OSRT,u).toJSON(),elbs:n(r.RESTYPE.OSLISTENER,u).toJSON()},_.each(s.fips,function(e){var t,i,s,o,a,f,l;return i=e.port_id,t=(o=n(r.RESTYPE.OSPORT,u))!=null?(a=o.get(i))!=null?a.toJSON():void 0:void 0,t&&(s=(f=n(r.RESTYPE.OSSERVER,u))!=null?(l=f.get(t.device_id))!=null?l.toJSON():void 0:void 0),e.serverName=s!=null?s.name:void 0,e.portName=t!=null?t.name:void 0}),_.each(s.snaps,function(e){var t,i,s;return t=(i=n(r.RESTYPE.OSVOL,u))!=null?(s=i.get(e.volume_id))!=null?s.toJSON():void 0:void 0,e.volumeName=t!=null?t.name:void 0}),_.each(s.elbs,function(e){var t,i,s;return t=(i=n(r.RESTYPE.OSPOOL,u))!=null?(s=i.get(e.pool_id))!=null?s.toJSON():void 0:void 0,e.poolName=t!=null?t.name:void 0}),o=_.map(n(r.RESTYPE.OSNETWORK,u).getExtNetworks(),function(e){return e.toJSON()}),_.each(s.rts,function(e){var t,n;return n="",e.external_gateway_info&&(t=_.findWhere(o,{id:e.external_gateway_info.network_id}),t&&(n=t.name)),e.externalNetworkName=n}),s},getOsResDataById:function(e,t){return n(e,this.region).get(t)},getResourcesCount:function(){var e,t,i,s,o,u;s={category:this.region},i={servers:"OSSERVER",volumes:"OSVOL",snaps:"OSSNAP",fips:"OSFIP",rts:"OSRT",elbs:"OSLISTENER"},t={};for(o in i)u=i[o],e=n(r.RESTYPE[u],this.region),e.isReady()?t[o]=e.where(s).length:t[o]="";return t},importApp:function(){var e;return e=this,t("resource_region_resource").then(function(t){var n,i,s,o,u,a,f;n=[],i=[],f=t.openstack[e.provider]||{};for(s in f){a=f[s],u={name:r.REGION_LABEL[s],region:s,apps:[]};for(o in a)t=a[o],u.apps.push({id:o,subnet:(t[r.RESTYPE.OSSUBNET]||i).length,router:(t[r.RESTYPE.OSRT]||i).length,server:(t[r.RESTYPE.OSSERVER]||i).length,fip:(t[r.RESTYPE.OSFIP]||i).length,listener:(t[r.RESTYPE.OSLISTENER]||i).length,pool:(t[r.RESTYPE.OSPOOL]||i).length});u.apps.length&&n.push(u)}return n})}})})}).call(this);