var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["ApiRequest","CloudResources","constant","backbone"],function(e,t,n){return Backbone.Model.extend({defaults:{region:"",provider:""},initialize:function(){var e,r;return r=this.region=App.user.get("default_region"),this.provider=App.user.get("default_provider"),e=n.RESTYPE,r=this.region,this.listenTo(t(e.OSSERVER,r),"update",this.onRegionResChanged(["OSSERVER","FIP"])),this.listenTo(t(e.OSPORT,r),"update",this.onRegionResChanged(["FIP"])),this.listenTo(t(e.OSVOL,r),"update",this.onRegionResChanged(["OSVOL","OSSNAP"])),this.listenTo(t(e.OSSNAP,r),"update",this.onRegionResChanged(["OSSNAP"])),this.listenTo(t(e.OSFIP,r),"update",this.onRegionResChanged(["OSFIP"])),this.listenTo(t(e.OSRT,r),"update",this.onRegionResChanged(["OSRT"])),this.listenTo(t(e.OSPOOL,r),"update",this.onRegionResChanged(["OSPOOL","OSLISTENER"])),this.listenTo(t(e.OSLISTENER,r),"update",this.onRegionResChanged(["OSLISTENER"])),this.listenTo(t(e.OSNETWORK,r),"update",this.onRegionResChanged(["OSRT"]))},onRegionResChanged:function(e){return function(){return this.trigger("change:regionResources",e)}},fetchOsResources:function(){t(n.RESTYPE.OSSERVER,this.region).fetch(),t(n.RESTYPE.OSPORT,this.region).fetch(),t(n.RESTYPE.OSVOL,this.region).fetch(),t(n.RESTYPE.OSSNAP,this.region).fetch(),t(n.RESTYPE.OSFIP,this.region).fetch(),t(n.RESTYPE.OSRT,this.region).fetch(),t(n.RESTYPE.OSPOOL,this.region).fetch(),t(n.RESTYPE.OSLISTENER,this.region).fetch(),t(n.RESTYPE.OSNETWORK,this.region).fetch()},isOsResReady:function(e){var r;r=t(e,this.region).isReady();switch(e){case n.RESTYPE.OSLISTENER:r=r&&t(n.RESTYPE.OSPOOL,this.region).isReady();break;case n.RESTYPE.OSPOOL:r=r&&t(n.RESTYPE.OSLISTENER,this.region).isReady()}return r},getOsResData:function(e){var r,i,s,o;return o=this.region,r=["centos","debian","fedora","gentoo","opensuse","redhat","suse","ubuntu","windows","cirros"],i={servers:_.map(t(n.RESTYPE.OSSERVER,o).toJSON(),function(e){var t;if(t=e.system_metadata.image_os_distro,__indexOf.call(r,t)<0)e.system_metadata.image_os_distro="unknown";return e}),volumes:t(n.RESTYPE.OSVOL,o).toJSON(),snaps:t(n.RESTYPE.OSSNAP,o).toJSON(),fips:t(n.RESTYPE.OSFIP,o).toJSON(),rts:t(n.RESTYPE.OSRT,o).toJSON(),elbs:t(n.RESTYPE.OSLISTENER,o).toJSON()},_.each(i.fips,function(e){var r,i,s,u,a,f,l;return i=e.port_id,r=(u=t(n.RESTYPE.OSPORT,o))!=null?(a=u.get(i))!=null?a.toJSON():void 0:void 0,r&&(s=(f=t(n.RESTYPE.OSSERVER,o))!=null?(l=f.get(r.device_id))!=null?l.toJSON():void 0:void 0),e.serverName=s!=null?s.name:void 0,e.portName=r!=null?r.name:void 0}),_.each(i.snaps,function(e){var r,i,s;return r=(i=t(n.RESTYPE.OSVOL,o))!=null?(s=i.get(e.volume_id))!=null?s.toJSON():void 0:void 0,e.volumeName=r!=null?r.name:void 0}),_.each(i.elbs,function(e){var r,i,s;return r=(i=t(n.RESTYPE.OSPOOL,o))!=null?(s=i.get(e.pool_id))!=null?s.toJSON():void 0:void 0,e.poolName=r!=null?r.name:void 0}),s=_.map(t(n.RESTYPE.OSNETWORK,o).getExtNetworks(),function(e){return e.toJSON()}),_.each(i.rts,function(e){var t,n;return n="",e.external_gateway_info&&(t=_.findWhere(s,{id:e.external_gateway_info.network_id}),t&&(n=t.name)),e.externalNetworkName=n}),i},getOsResDataById:function(e,n){return t(e,this.region).get(n)},getResourcesCount:function(){var e,r,i,s,o,u;s={category:this.region},i={servers:"OSSERVER",volumes:"OSVOL",snaps:"OSSNAP",fips:"OSFIP",rts:"OSRT",elbs:"OSLISTENER"},r={};for(o in i)u=i[o],e=t(n.RESTYPE[u],this.region),e.isReady()?r[o]=e.where(s).length:r[o]="";return r},importApp:function(){var t;return t=this,e("resource_region_resource").then(function(e){var r,i,s,o,u,a,f;r=[],i=[],f=e.openstack[t.provider]||{};for(s in f){a=f[s],u={name:n.REGION_LABEL[s],region:s,apps:[]};for(o in a)e=a[o],u.apps.push({id:o,subnet:(e[n.RESTYPE.OSSUBNET]||i).length,router:(e[n.RESTYPE.OSRT]||i).length,server:(e[n.RESTYPE.OSSERVER]||i).length,fip:(e[n.RESTYPE.OSFIP]||i).length,listener:(e[n.RESTYPE.OSLISTENER]||i).length,pool:(e[n.RESTYPE.OSPOOL]||i).length});u.apps.length&&r.push(u)}return r})}})});