(function(){var e={}.hasOwnProperty,t=function(t,n){function i(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return i.prototype=n.prototype,t.prototype=new i,t.__super__=n.prototype,t};define(["Scene","./DebuggerTpl","ApiRequest","ApiRequestOs","ApiRequestDefs","Design","component/jsonviewer/JsonViewer","backbone","jquery","UI.select2","UI.tooltip"],function(e,n,r,i,s,o,u){var a,f,l;window.d=function(){return o.instance()},window.dds=function(){return debug.designSerialize()},window.debug={stacks:function(){var e,t,n,r,i,s,o,u,a;n={},u=App.model.projects().models;for(r=0,s=u.length;r<s;r++){t=u[r],n[t.id]={name:t.get("name"),stacks:[]},a=t.stacks().models;for(i=0,o=a.length;i<o;i++)e=a[i],n[t.id].stacks.push(e)}return n},apps:function(){var e,t,n,r,i,s,o,u,a;n={},u=App.model.projects().models;for(r=0,s=u.length;r<s;r++){t=u[r],n[t.id]={name:t.get("name"),apps:[]},a=t.apps().models;for(i=0,o=a.length;i<o;i++)e=a[i],n[t.id].apps.push(e)}return n},selectedComp:function(){var e;e=App.sceneManager.activeScene();if(e.getAwakeSpace){e=e.getAwakeSpace();if(e.getSelectedComponent)return e.getSelectedComponent()}return null},selectedCompState:function(){var e,t;return e=(t=debug.selectedComp())!=null?t.serialize()[1]:void 0,e&&e.component&&e.component.state?'{\n	"component": {\n		"init" : {\n			"state": '+JSON.stringify(e.component.state)+"\n		}\n	}\n}\n":"no state for selected component"},designSerialize:function(){var e;if(!o.instance())return;return e=o.instance().serialize(),void 0,JSON.stringify(e)},designCheckValid:function(){return o.instance().eachComponent(function(e){return e.design()===o.instance()?void 0:void 0,null}),null},designExportToFile:function(){var e,t,n,r,i;if(!o.instance())return;return i="CanvasData.json",n=o.debug.json(),t=new Blob([n],{type:"text/json"}),r=document.createEvent("MouseEvents"),e=document.createElement("a"),e.download=i,e.href=window.URL.createObjectURL(t),e.dataset.downloadurl=["text/json",e.download,e.href].join(":"),r.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(r),null},designDiff:function(){o.instance()&&u.showDiffDialog(o.instance().__opsModel.getJsonData(),o.instance().serialize())},designView:function(){if(!o.instance())return;u.showViewDialog(o.instance().serialize())},designLayout:function(){return App.sceneManager.activeScene().getAwakeSpace().view.canvas.autoLayout()},designSet:function(e,t){var n;return(n=o.instance())!=null?n.set(e,t):void 0},designGet:function(e){var t;return(t=o.instance())!=null?t.get(e):void 0},designComps:function(){var e,t,n,r;if(!o.instance())return;t={line:{},node:{},group:{},otherResource:{},otherConnection:{}},r=o.instance().__componentMap;for(n in r)e=r[n],e.node_group?t.group[e.id]=e:e.node_line?e.isVisual()?t.line[e.id]=e:t.otherConnection[e.id]=e:e.isVisual()?t.node[e.id]=e:t.otherResource[e.id]=e;return t}},window.man="d()          Return the current Design instance \n dds()        Print JSON \n copy(dds())  Copy JSON \n debug        A object contains some debug functions",null,l=Backbone.View.extend({events:{"click li":function(e){var t;return typeof this[t=e.currentTarget.id]=="function"?this[t]():void 0}},initialize:function(){$("head").append('<link rel="stylesheet" href="/assets/css/debugger.css"></link>'),this.setElement($(n.Toolbar()).appendTo("body"))},ask:function(e,t){var r,i;r=$(n.Question({content:e,buttons:t||[]})).prependTo("body"),i=this,r.on("click","button",function(e){var t;return typeof i[t=$(e.currentTarget).attr("data-id")]=="function"?i[t]():void 0}),setTimeout(function(){return $("#DebugQuestion").addClass("ready")},18)},DtDiff:function(){return debug.designDiff()},DtView:function(){return debug.designView()},DtApi:function(){return new a},DtSession:function(){var e;e="<textarea id='DebugShareSession' spellcheck='false'>(function(){var o = {expires:30,path:'/'}, a = "+JSON.stringify($.cookie())+",k;for (k in a) { $.cookie(k,a[k],o); } window.location.href = window.location.protocol + '//' + window.location.host + '"+window.location.pathname+"'; })();</textarea>",this.ask(e),setTimeout(function(){return $("#DebugShareSession").focus().select()},200)},DtClearApp:function(){var e;return e=[{id:"debug_q_clear_project_app",text:"当前项目的App"},{id:"debug_q_clear_all_app",text:"所有项目的App"}],this.ask("えええええええっ！！你要Teminate所有App？本当ですか？",e)},DtClearStack:function(){var e;return e=[{id:"debug_q_clear_project_stack",text:"当前项目的Stack"},{id:"debug_q_clear_all_stack",text:"所有项目的Stack"}],this.ask("マジですか？你要删除所有Stack？",e)},debug_q_close:function(){$("#DebugQuestion").addClass("quick").removeClass("ready"),setTimeout(function(){return $("#DebugQuestion").remove()},100)},debug_q_clear_project_stack:function(){var e,t,n,r,i,s;n=App.sceneManager.activeScene(),_.isFunction(n.project)?t=n.project():t=App.model.getPrivateProject(),s=t.stacks().models.slice(0);for(r=0,i=s.length;r<i;r++)e=s[r],e.remove();return this.debug_q_close()},debug_q_clear_project_app:function(){var e,t,n,r,i,s;n=App.sceneManager.activeScene(),_.isFunction(n.project)?t=n.project():t=App.model.getPrivateProject(),s=t.apps().models.slice(0);for(r=0,i=s.length;r<i;r++)e=s[r],e.remove();return this.debug_q_close()},debug_q_clear_all_stack:function(){var e,t,n,r,i,s,o,u;o=App.model.projects().models;for(n=0,i=o.length;n<i;n++){t=o[n],u=t.stacks().models.slice(0);for(r=0,s=u.length;r<s;r++)e=u[r],e.remove()}return this.debug_q_close()},debug_q_clear_all_app:function(){var e,t,n,r,i,s,o,u;o=App.model.projects().models;for(n=0,i=o.length;n<i;n++){t=o[n],u=t.apps().models.slice(0);for(r=0,s=u.length;r<s;r++)e=u[r],e.terminate()}return this.debug_q_close()}}),f=Backbone.View.extend({events:{"change #ApiSelect":"onApiChange","click  #ApiDebugSend":"onSendClick","click  #ApiDebuggerClose":"close"},initialize:function(){this.setElement($(n.ApiDebugger()).appendTo("body")),this.render(),$("#ApiSelect").select2("open"),$("#s2id_autogen1_search").focus()},remove:function(){return $("#ApiSelect").select2("destroy"),this.$el.remove()},close:function(){return this.trigger("closed")},render:function(){var e,t,n,r,i,o,u,a,f,l,c;a="<option></option>",o={},c=s.Defs;for(n in c)t=c[n],e=n.split("_"),e.length===1?r="General":r=e[0].toUpperCase(),o[r]||(o[r]=[]),o[r].push(n);for(u in o){r=o[u],a+="<optgroup label='"+u+"'>";for(f=0,l=r.length;f<l;f++)i=r[f],a+="<option value='"+i+"'>"+i+"</option>";a+="</optgrouop>"}return $("#ApiSelect").html(a).select2({dropdownCssClass:"debugger",matcher:function(e,t,n){return t.match(new RegExp(e.replace(/\s+/g,"").split("").join(".*"),"i"))}})},onApiChange:function(){var e,t,n,r,i,o,u,a;i=$("#ApiSelect").select2("val"),e=s.Defs[i],$("#ApiResult").empty(),$("#ApiDebuggerLabel").text("Api : '"+i+"'");if(!e)return $("#ApiParamsWrap").empty();n="",a=e.params;for(o=0,u=a.length;o<u;o++)t=a[o],r=s.AutoFill(t),r===null&&(r=""),n+="<input placeholder='"+t+"' class='tooltip' value='"+r+"' data-tooltip='"+t+"'/>";return $("#ApiParamsWrap").html(n),this.trigger("apiChanged",i)},onSendClick:function(){var e,t,n,o,u,a,f,l,c,h;e=$("#ApiSelect").select2("val"),t=s.Defs[e];if(!t)return;a={},h=$("#ApiParamsWrap").children("input");for(l=0,c=h.length;l<c;l++){n=h[l],f=n.value;if(!f)continue;u=$(n).attr("placeholder");try{a[u]=JSON.parse(f)}catch(p){o=p,a[u]=f}}return $("#ApiDebugSend").attr("disabled","disabled"),$("#ApiResult").text("Loading...").attr("finish","false"),(t.type==="openstack"?i:r)(e,a).then(function(e){var n,r,i,s,o,u,a,f;if(t.url.indexOf("/aws/")===0&&t.url.length>5&&typeof e[1]=="string")try{e[1]=$.xml2json($.parseXML(e[1]))}catch(l){}else if(t.url.indexOf("/os/")===0)if(t.method==="Info")for(i=o=0,a=e.length;o<a;i=++o){s=e[i];try{if($.type(e)==="array")for(r=u=0,f=s.length;u<f;r=++u)n=s[r],e[i][r]=JSON.parse(n);else e[i]=JSON.parse(s)}catch(l){}}else try{e[1]=JSON.parse(e[1])}catch(l){}return $("#ApiResult").text(JSON.stringify(e,void 0,4)),$("#ApiDebugSend").removeAttr("disabled"),$("#ApiResult").attr("finish","true")},function(e){return $("#ApiResult").text(JSON.stringify(e,void 0,4)),$("#ApiDebugSend").removeAttr("disabled"),$("#ApiResult").attr("finish","true")}),null},switchToApi:function(e){return $("#ApiSelect").select2("val",e).select2("close"),this.onApiChange()}}),a=function(n){function r(t){var n;return t=t||"",n=App.sceneManager.find("ApiDebugger"),n?(n.activate(),n.switchToApi(t),n):e.call(this,t)}return t(r,n),r.prototype.api="",r.prototype.initialize=function(e){return this.view=new f,this.listenTo(this.view,"apiChanged",this.onApiChange),this.listenTo(this.view,"closed",this.remove),this.activate(),this.switchToApi(e||"")},r.prototype.title=function(){return"API Debugger"},r.prototype.url=function(){return this.api?"debug/api/"+this.api:"debug/api"},r.prototype.isWorkingOn=function(e){return e==="ApiDebugger"},r.prototype.onApiChange=function(e){return this.api=e,this.updateUrl()},r.prototype.switchToApi=function(e){if(this.api===e||!e)return;return this.onApiChange(),this.view.switchToApi(e)},r}(e),new l,window.Router.route("debug/api(/:theapi)",function(e){return new a(e)})})}).call(this);