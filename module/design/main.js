(function(){define(["i18n!nls/lang.js","constant","component/stateeditor/stateeditor","./module/design/framework/DesignBundle"],function(e,t,n,r){var i,s,o;return i=function(){return require(["design_view","design_model","property","event"],function(e,i,s,u){var a,f;return a=null,MC.data.design_submodule_count=0,f=new e,f.listen(i),f.once("DESIGN_COMPLETE",function(){return void 0,o()}),f.render(),u.onLongListen(u.DESIGN_SUB_COMPLETE,function(){return void 0,MC.data.design_submodule_count===3?(a=f.$el.html(),MC.data.design_submodule_count=-1,u.trigger(u.DESIGN_COMPLETE),u.trigger(u.IDE_AVAILABLE),u.offListen(u.DESIGN_SUB_COMPLETE)):MC.data.design_submodule_count=MC.data.design_submodule_count+1,null}),u.onLongListen(u.ADD_TAB_DATA,function(e){var t,n;void 0;try{(n=e.split("-")[0])!=="process"&&i.addTab(e,f.html(),i.getDesignModel(),i.getCanvasData(),i.getOriginData(),s.snapshot(),i.getTAValidation())}catch(r){t=r,void 0,void 0}return null}),u.onLongListen(u.DELETE_TAB_DATA,function(e){return void 0,i.deleteTab(e),null}),u.onLongListen(u.UPDATE_TAB_DATA,function(e,t){return i.updateTab(e,t),null}),u.onLongListen(u.SWITCH_TAB,function(e,n,s,o,l){var c,h,p,d,v;void 0,e==="NEW_STACK"&&(MC.open_failed_list[MC.data.current_tab_id]={id:n,region:s,platform:l,type:e}),e==="OLD_STACK"||e==="OLD_APP"?i.getTab(e,n):f.$el.html(a);if(e==="NEW_STACK"||e==="OPEN_STACK"||e==="OPEN_APP"){if(o&&o.resolved_data&&o.resolved_data.length===0){void 0;return}h=e==="NEW_STACK"?o:n,MC.data.open_tab_data[h]={region:s,type:e,platform:l,tab_id:n,result:o},e==="NEW_STACK"&&(i.setCanvasData({}),MC.common.other.canvasData.initSet("id",o),MC.common.other.canvasData.initSet("name",n),MC.common.other.canvasData.initSet("region",s),MC.common.other.canvasData.initSet("platform",l),MC.common.other.canvasData.initSet("version","2014-02-17"),l===r.TYPE.Classic||l===r.TYPE.DefaultVpc?(c=$.extend(!0,{},MC.canvas.DESIGN_INIT_DATA),p=MC.canvas.DESIGN_INIT_LAYOUT):(c=$.extend(!0,{},MC.canvas.DESIGN_INIT_DATA_VPC),p=MC.canvas.DESIGN_INIT_LAYOUT_VPC),MC.common.other.canvasData.initSet("component",c),MC.common.other.canvasData.initSet("layout",p)),(e==="OPEN_STACK"||e==="OPEN_APP")&&i.setCanvasData(o.resolved_data[0]),u.trigger(u.OPEN_DESIGN,s,e,l,n,o),e==="OPEN_STACK"&&u.trigger(u.SWITCH_WAITING_BAR,null,!0)}if(e==="OPEN_APP"||e==="OLD_APP")void 0,MC.data.process[n]&&MC.data.process[n].flag_list?MC.data.process[n].flag_list.is_updated?e==="OLD_APP"?u.trigger(u.SHOW_DESIGN_OVERLAY,"UPDATING_SUCCESS",n):MC.common.other.deleteProcess(n):MC.data.process[n].flag_list.is_done?u.trigger(u.HIDE_DESIGN_OVERLAY):MC.data.process[n].flag_list.is_failed?e==="OLD_APP"&&u.trigger(u.SHOW_DESIGN_OVERLAY,"CHANGED_FAIL",n):MC.data.process[n].flag_list.flag==="UPDATE_APP"?u.trigger(u.SHOW_DESIGN_OVERLAY,t.APP_STATE.APP_STATE_UPDATING,n):((v=MC.data.process[n].flag_list.flag)==="START_APP"||v==="STOP_APP"||v==="TERMINATE_APP")&&u.trigger(u.SHOW_DESIGN_OVERLAY,i.returnAppState(MC.data.process[n].flag_list.flag,MC.data.process[n].state),n):(d=MC.common.other.filterProcess(n),d?u.trigger(u.SHOW_DESIGN_OVERLAY,d,n):void 0);return(e==="OLD_APP"||e==="OLD_STACK")&&MC.open_failed_list[n]&&u.trigger(u.SHOW_DESIGN_OVERLAY,"OPEN_TAB_FAIL",n),f.hideStatusbar(),null}),u.onLongListen(u.UPDATE_APP_STATE,function(e,n){void 0;if(_.isEmpty(MC.common.other.initDataProcess(n,e,MC.process)))return;if(MC.data.current_tab_id!==n)return;return MC.process[n].flag_list&&MC.process[n].flag_list.is_updated?u.trigger(u.SHOW_DESIGN_OVERLAY,"UPDATING_SUCCESS",n):MC.process[n].flag_list&&MC.process[n].flag_list.is_failed?(u.trigger(u.SHOW_DESIGN_OVERLAY,"CHANGED_FAIL",n),_.delay(function(){var e;e=MC.common.other.searchStackAppById(n);if(e&&e.state)return u.trigger(u.UPDATE_DESIGN_TAB_ICON,e.state,n)},500)):e===t.APP_STATE.APP_STATE_RUNNING||e===t.APP_STATE.APP_STATE_STOPPED||e===t.APP_STATE.APP_STATE_TERMINATED?u.trigger(u.HIDE_DESIGN_OVERLAY):(e===t.APP_STATE.APP_STATE_STARTING||e===t.APP_STATE.APP_STATE_STOPPING||e===t.APP_STATE.APP_STATE_TERMINATING||e===t.APP_STATE.APP_STATE_UPDATING)&&u.trigger(u.SHOW_DESIGN_OVERLAY,e,n),null}),u.onLongListen(u.UPDATE_APP_INFO,function(e,t){return void 0,setTimeout(function(){if(MC.data.process[t]&&MC.data.process[t].flag_list.is_failed)return;return i.appInfoService(e,t)},200),null}),u.onLongListen(u.UPDATE_APP_RESOURCE,function(e,t){return void 0,u.trigger(u.SWITCH_LOADING_BAR,null,!0),i.getAppResourcesService(e,t),null}),u.onLongListen(u.UPDATE_STATUS_BAR,function(e,t){return f.updateStatusbar(e,t)}),u.onLongListen(u.UPDATE_STATUS_BAR_SAVE_TIME,function(){return f.updateStatusBarSaveTime()}),u.onLongListen(u.UPDATE_RESOURCE_STATE,function(){return f.hideStatusbar()}),u.onLongListen(u.OPEN_STATE_EDITOR,function(e,t){var i,s;return i=r.instance().serialize().component,s=i[e],n.loadModule(i,e,t)}),i.on("SET_PROPERTY_PANEL",function(e){return s.restore(e),null}),u.onLongListen(u.RESOURCE_API_COMPLETE,function(){var e,t,n;return void 0,e=MC.data.open_tab_data[MC.data.current_tab_id],e&&e.tab_id?(u.trigger(u.CREATE_DESIGN_OBJ,e.region,e.type,e.platform,e.tab_id,e.result),Tabbar.current==="app"?i.getAppResourcesService(e.region,e.tab_id):Tabbar.current==="appview"?r.instance().trigger(r.EVENT.AwsResourceUpdated):((t=Tabbar.current)==="new"||t==="stack")&&u.trigger(u.GET_STATE_MODULE),(n=e.type)!=="OLD_APP"&&n!=="OLD_STACK"&&u.trigger(u.OPEN_PROPERTY,"component",""),delete MC.data.open_tab_data[MC.data.current_tab_id]):void 0}),u.onLongListen(u.GET_STATE_MODULE,function(){return void 0,i.getStateModule()})})},s=function(){},o=function(){return require(["resource","property","toolbar","canvas"],function(e,t,n,r){return r.loadModule(),n.loadModule(),e.loadModule(),t.loadModule()})},{loadModule:i,unLoadModule:s}})}).call(this);