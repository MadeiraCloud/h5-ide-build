(function(){define(["MC","event","account_model","session_model","common_handle","crypto"],function(e,t,n,r,i){var s;return s=Backbone.Model.extend({defaults:{password:null,username:null},initialize:function(){return this.on("ACCOUNT_CHECK__REPEAT_RETURN",function(e){void 0,void 0;if(!e.is_error)e.param[1]&&e.param[2]?this.registerService(e.param[1],e.param[2],this.get("password")):e.param[1]&&!e.param[2]?this.trigger("USERNAME_VALID"):!e.param[1]&&e.param[2]&&this.trigger("EMAIL_VALID");else switch(e.error_message){case"username":this.trigger("USERNAME_REPEAT");break;case"email":this.trigger("EMAIL_REPEAT");break;case"username,email":this.trigger("USERNAME_EMAIL_REPEAT");break;default:void 0,!_.isEmpty(e.param[1])&&!_.isEmpty(e.param[2])?this.trigger("RESET_CREATE_ACCOUNT",e.return_code):this.trigger("OTHER_ERROR")}return null})},checkRepeatService:function(e,t,r){return void 0,this.set("password",r),n.check_repeat({sender:this},e,t)},registerService:function(e,t,r){var i;return void 0,n.register({sender:this},e,r,t),i=this,this.once("ACCOUNT_REGISTER_RETURN",function(e){return void 0,void 0,e.is_error?i.trigger("RESET_CREATE_ACCOUNT",e.return_code):(i.set("username",e.param[1]),i.set("password",e.param[2]),i.trigger("RESIGER_SUCCESS")),null})},loginService:function(){void 0;if(!this.get("username")||!this.get("password"))return;return r.login({sender:this},this.get("username"),this.get("password")),this.set("username",null),this.set("password",null),this.once("SESSION_LOGIN_RETURN",function(t){var n,r;if(!t.is_error)return r=t.resolved_data,i.cookie.deleteCookie(),i.cookie.setCookie(r),i.cookie.setIDECookie(r),localStorage.setItem("email",e.base64Decode(i.cookie.getCookieByName("email"))),localStorage.setItem("user_name",i.cookie.getCookieByName("username")),n=function(){var t,n;return n="4tGsMJzq_2gJmwGDQgtP2En1rFlZEvBhWQWEOTKE",t=CryptoJS.HmacSHA256(e.base64Decode($.cookie("email")),n),t.toString(CryptoJS.enc.Hex)},localStorage.setItem("user_hash",n()),window.location.href="/",null})}}),new s})}).call(this);