(function(){define(["MC","event","account_model","session_model","common_handle","crypto"],function(e,t,n,r,i){var s;return s=Backbone.Model.extend({defaults:{password:null},initialize:function(){return this.on("ACCOUNT_CHECK__REPEAT_RETURN",function(e){console.log("ACCOUNT_CHECK__REPEAT_RETURN"),console.log(e);if(!e.is_error)e.param[1]&&e.param[2]?this.registerService(e.param[1],e.param[2],this.get("password")):e.param[1]&&!e.param[2]?this.trigger("USERNAME_VALID"):!e.param[1]&&e.param[2]&&this.trigger("EMAIL_VALID");else switch(e.error_message){case"username":this.trigger("USERNAME_REPEAT");break;case"email":this.trigger("EMAIL_REPEAT");break;case"username,email":this.trigger("USERNAME_EMAIL_REPEAT");break;default:console.log("other error")}return null})},checkRepeatService:function(e,t,r){return console.log("checkRepeatService, username = "+e+", email = "+t+", password = "+r),this.set("password",r),n.check_repeat({sender:this},e,t)},registerService:function(e,t,r){return console.log("registerService, username = "+e+", email = "+t+", password = "+r),n.register({sender:this},e,r,t),this.once("ACCOUNT_REGISTER_RETURN",function(e){return console.log("ACCOUNT_REGISTER_RETURN"),console.log(e),e.is_error?this.trigger("RESET_CREATE_ACCOUNT"):(sessionStorage.setItem("username",e.param[1]),sessionStorage.setItem("password",e.param[2]),window.location.href="register.html#success"),null})},loginService:function(){console.log("loginService");if(!sessionStorage.getItem("username")||!sessionStorage.getItem("password"))return;return r.login({sender:this},sessionStorage.getItem("username"),sessionStorage.getItem("password")),sessionStorage.clear(),this.once("SESSION_LOGIN_RETURN",function(t){var n,r;if(!t.is_error)return r=t.resolved_data,i.cookie.deleteCookie(),i.cookie.setCookie(r),i.cookie.setIDECookie(r),localStorage.setItem("email",e.base64Decode(i.cookie.getCookieByName("email"))),localStorage.setItem("user_name",i.cookie.getCookieByName("username")),n=function(){var t,n;return n="4tGsMJzq_2gJmwGDQgtP2En1rFlZEvBhWQWEOTKE",t=CryptoJS.HmacSHA256(e.base64Decode($.cookie("email")),n),console.log("hash.toString(CryptoJS.enc.Hex) = "+t.toString(CryptoJS.enc.Hex)),t.toString(CryptoJS.enc.Hex)},localStorage.setItem("user_hash",n()),window.location.href="/ide.html",null})}}),new s})}).call(this);