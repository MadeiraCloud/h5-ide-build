(function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};define(["app_model","stack_model","ec2_model","state_model","aws_model","constant","event","backbone","jquery","underscore"],function(t,n,r,i,s,o,u){var a,f,l;return l=[],a=Backbone.Model.extend({defaults:{app_list:null,stack_list:null,region_list:null,region_empty_list:null},initialize:function(){var t;return t=this,t.on("APP_LST_RETURN",function(n){var r,i,s,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H;void 0;if(n.is_error)return;i=n.param[4],r=[];if(i){r=$.extend(!0,[],t.get("app_list")),a=_.map(n.resolved_data,function(e,t){return{region_group:o.REGION_SHORT_LABEL[t],region_count:e.length,region_name_group:e}});for(d=0,y=a.length;d<y;d++){l=a[d];for(v=0,b=r.length;v<b;v++)h=r[v],h.region_group===l.region_group&&(p=h);s=r.indexOf(p);if(p){L=l.region_name_group;for(m=0,w=L.length;m<w;m++){f=L[m],A=p.region_name_group;for(g=0,E=A.length;g<E;g++)c=A[g],c.id===f.id&&(u=c);u?p.region_name_group.splice(p.region_name_group.indexOf(u),1,f):p.region_name_group.push(f),(O=f.id,e.call(i,O)>=0)&&i.splice(i.indexOf(f.id),1)}p.region_count=p.region_name_group.length,r.splice(s,1,p)}else{r.push(l),M=l.region_name_group;for(N=0,S=M.length;N<S;N++)u=M[N],(D=u.id,e.call(i,D)>=0)&&i.splice(i.indexOf(u.id),1)}}if(i.length>0){a=[];for(C=0,x=r.length;C<x;C++){p=r[C],l={region_group:p.region_group,region_name_group:[]},P=p.region_name_group;for(k=0,T=P.length;k<T;k++){u=P[k];if(H=u.id,e.call(i,H)>=0)continue;l.region_name_group.push(u)}l.region_count=l.region_name_group.length,l.region_count>0&&a.push(l)}r=a}}else r=_.map(n.resolved_data,function(e,t){return{region_group:o.REGION_SHORT_LABEL[t],region_count:e.length,region_name_group:e}});return void 0,t.set("app_list",$.extend(!0,[],r)),null}),t.on("STACK_LST_RETURN",function(n){var r,i,s,u,a,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,D,P,H,B;void 0;if(n.is_error)return;r=n.param[4],d=[];if(r){d=$.extend(!0,[],t.get("stack_list")),u=_.map(n.resolved_data,function(e,t){return{region_group:o.REGION_SHORT_LABEL[t],region_count:e.length,region_name_group:e}});for(v=0,b=u.length;v<b;v++){f=u[v];for(m=0,w=d.length;m<w;m++)h=d[m],h.region_group===f.region_group&&(p=h);i=d.indexOf(p);if(p){A=f.region_name_group;for(g=0,E=A.length;g<E;g++){a=A[g],O=p.region_name_group;for(y=0,S=O.length;y<S;y++)c=O[y],c.id===a.id&&(s=c);s?p.region_name_group.splice(p.region_name_group.indexOf(s),1,a):p.region_name_group.push(a),(M=a.id,e.call(r,M)>=0)&&r.splice(r.indexOf(a.id),1)}p.region_count=p.region_name_group.length,d.splice(i,1,p)}else{d.push(f),D=f.region_name_group;for(C=0,x=D.length;C<x;C++)s=D[C],(P=s.id,e.call(r,P)>=0)&&r.splice(r.indexOf(s.id),1)}}if(r.length>0){u=[];for(k=0,T=d.length;k<T;k++){p=d[k],f={region_group:p.region_group,region_name_group:[]},H=p.region_name_group;for(L=0,N=H.length;L<N;L++){s=H[L];if(B=s.id,e.call(r,B)>=0)continue;f.region_name_group.push(s)}f.region_count=f.region_name_group.length,f.region_count>0&&u.push(f)}d=u}}else d=_.map(n.resolved_data,function(e,t){return{region_group:o.REGION_SHORT_LABEL[t],region_count:e.length,region_name_group:e}});return void 0,t.set("stack_list",$.extend(!0,[],d)),l=[],_.each(d,function(e){return l.push(e.region_name_group[0].region)}),this.regionEmptyList(),null}),t.on("EC2_EC2_DESC_REGIONS_RETURN",function(e){var n;return void 0,n=[],e.is_error?n=_.map(o.REGION_KEYS,function(e){var t,n;return n=o.REGION_SHORT_LABEL[e],t=o.REGION_LABEL[e],{region_city:n,region_area:t,region_name:e}}):n=_.map(e.resolved_data.item,function(e,t){var n,r;return r=o.REGION_SHORT_LABEL[e.regionName],n=o.REGION_LABEL[e.regionName],{region_city:r,region_area:n,region_name:e.regionName}}),void 0,t.set("region_list",$.extend(!0,[],n)),null}),null},appListService:function(e,n){return void 0,t.list({sender:this},$.cookie("usercode"),$.cookie("session_id"),null,n)},stackListService:function(e,t){return void 0,n.list({sender:this},$.cookie("usercode"),$.cookie("session_id"),null,t)},regionEmptyList:function(){var e,t;return void 0,e=_.difference(_.keys(o.REGION_SHORT_LABEL),l),t=_.map(e,function(e){return o.REGION_SHORT_LABEL[e]}),void 0,this.set("region_empty_list",$.extend(!0,[],t)),null},describeRegionsService:function(){var e;return e=this,r.DescribeRegions({sender:e},$.cookie("usercode"),$.cookie("session_id"),null,null)},updateApplistState:function(e,t){var n;return void 0,void 0,n=$.extend(!0,[],this.get("app_list")),_.each(n,function(n){return _.each(n.region_name_group,function(n){return n.id===t&&(n.state=e),null})}),void 0,this.set("app_list",n),MC.data.nav_app_list=this.get("app_list"),null},getStateAWSProperty:function(){var e;return void 0,e=this,s.property({sender:e},$.cookie("usercode"),$.cookie("session_id")),e.on("AWS_PROPERTY_RETURN",function(e){return e.is_error||(MC.data.state.aws_property=e.resolved_data,u.trigger(u.IDE_AVAILABLE)),null})},listenStateStatusList:function(){var e,t;return MC.data.websocket.collection.status.find().fetch(),t=MC.data.websocket.collection.status.find(),e=t.observe({added:function(e,t){var n;return u.trigger(u.UPDATE_STATE_STATUS_DATA,"add",e,t),n=[],e&&n.push(e.res_id),u.trigger(u.UPDATE_STATE_STATUS_DATA_TO_EDITOR,n)},changed:function(e,t){var n;return u.trigger(u.UPDATE_STATE_STATUS_DATA,"change",e,t),n=[],e&&n.push(e.res_id),u.trigger(u.UPDATE_STATE_STATUS_DATA_TO_EDITOR,n)}}),null}}),f=new a,f})}).call(this);