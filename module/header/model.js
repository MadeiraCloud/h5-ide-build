(function(){define(["backbone","jquery","underscore","constant","event","common_handle","ApiRequest"],function(e,t,n,r,i,s,o){var u;return u=e.Model.extend({defaults:{info_list:[],unread_num:null,in_dashboard:!0,has_cred:!0,user_name:null,user_email:null},init:function(){return this.set({user_name:MC.base64Decode(t.cookie("usercode")),user_email:MC.base64Decode(t.cookie("email"))}),null},updateHeader:function(e){var t,n,r,i,s,o,u,a,f,l,c;s=this.parseInfo(e);if(!s)return;i=this.attributes.info_list,u=this.attributes.unread_num,r=this.attributes.in_dashboard,o=null;for(a=0,l=i.length;a<l;a++)t=i[a],t.id===s.id&&(o=t);if(o!==null&&o.is_request===s.is_request&&o.is_process===s.is_process&&o.is_complete===s.is_complete)return;if(r||s.rid!==MC.canvas_data.id)s.is_readed=!1,(o===null||o.is_readed)&&this.set("unread_num",u+1);for(n=f=0,c=i.length;f<c;n=++f){t=i[n];if(t.id===s.id){i.splice(n,1);break}}return i.splice(0,0,s),null},parseInfo:function(e){var n,i,s,o,u;if(!e.brief)return;return s=e.brief.split(" "),i={is_readed:!0,is_request:e.state===r.OPS_STATE.OPS_STATE_PENDING,is_process:e.state===r.OPS_STATE.OPS_STATE_INPROCESS,is_complete:e.state===r.OPS_STATE.OPS_STATE_DONE,operation:s[0].toLowerCase(),name:s[s.length-1],region_label:r.REGION_SHORT_LABEL[e.region],time:e.time_end},i=t.extend({},e,i),e.state===r.OPS_STATE.OPS_STATE_FAILED?i.error=e.data:e.state===r.OPS_STATE.OPS_STATE_INPROCESS&&(i.time=e.time_begin),e.state!==r.OPS_STATE.OPS_STATE_PENDING&&(i.time_str=MC.dateFormat(new Date(i.time*1e3),"hh:mm yyyy-MM-dd"),e.state!==r.OPS_STATE.OPS_STATE_INPROCESS&&(o=parseInt(e.time_begin,10),u=parseInt(e.time_end,10),!isNaN(o)&&!isNaN(u)&&u>=o&&(n=u-o,n<60?i.duration="Took "+n+" sec.":i.duration="Took "+Math.round(n/60)+" min."))),i.rid.search("stack")===0&&(i.name=s[2]),i.is_terminated=i.is_complete&&i.operation==="terminate",i},setFlag:function(e){var t,n,r,i,s;this.set("in_dashboard",e),r=this.attributes.unread_num,n=this.attributes.info_list;if(!e&&r>0)for(i=0,s=n.length;i<s;i++){t=n[i];if(t.rid===MC.canvas_data.id&&!t.is_readed){t.is_readed=!0,this.set("unread_num",r-1);break}}return null},resetInfoList:function(){var e,t,n,r;r=this.attributes.info_list;for(t=0,n=r.length;t<n;t++)e=r[t],e.is_readed=!0;return this.set("unread_num",0),null},openApp:function(e){var t,n,r,s,o;n=this.attributes.info_list;for(s=0,o=n.length;s<o;s++)t=n[s],t.id===e&&(r=t);return r&&i.trigger(i.OPEN_DESIGN_TAB,"OPEN_APP",r.name,r.region,r.rid),null},logout:function(){return o("logout").then(function(){return s.cookie.deleteCookie(),window.location.href="/login/"},function(){return window.location.href="/login/"})}}),new u})}).call(this);