(function(){define(["backbone","jquery","underscore","session_model","constant","event","common_handle"],function(e,t,n,r,i,s,o){var u;return u=e.Model.extend({defaults:{info_list:[],unread_num:null,in_dashboard:!0,has_cred:!0,user_name:null,user_email:null},initialize:function(){return this.on("SESSION_LOGOUT_RETURN",function(e){var t;return e.is_error||(t=e.resolved_data),o.cookie.deleteCookie(),window.location.href="/login",!1})},init:function(){return this.set({user_name:MC.base64Decode(t.cookie("usercode")),user_email:MC.base64Decode(t.cookie("email"))}),null},updateHeader:function(e){var t,n,r,i,s,o,u,a,f,l,c;s=this.parseInfo(e);if(!s)return;i=this.attributes.info_list,u=this.attributes.unread_num,r=this.attributes.in_dashboard,o=null;for(a=0,l=i.length;a<l;a++)t=i[a],t.id===s.id&&(o=t);if(o!==null&&o.is_request===s.is_request&&o.is_process===s.is_process&&o.is_complete===s.is_complete)return;if(r||s.rid!==MC.canvas_data.id)s.is_readed=!1,(o===null||o.is_readed)&&this.set("unread_num",u+1);for(n=f=0,c=i.length;f<c;n=++f){t=i[n];if(t.id===s.id){i.splice(n,1);break}}return i.splice(0,0,s),null},parseInfo:function(e){var n,r,s,o,u;if(!e.brief)return;return s=e.brief.split(" "),r={is_readed:!0,is_request:e.state===i.OPS_STATE.OPS_STATE_PENDING,is_process:e.state===i.OPS_STATE.OPS_STATE_INPROCESS,is_complete:e.state===i.OPS_STATE.OPS_STATE_DONE,operation:s[0].toLowerCase(),name:s[s.length-1],region_label:i.REGION_SHORT_LABEL[e.region],time:e.time_end},r=t.extend({},e,r),e.state===i.OPS_STATE.OPS_STATE_FAILED?r.error=e.data:e.state===i.OPS_STATE.OPS_STATE_INPROCESS&&(r.time=e.time_begin),e.state!==i.OPS_STATE.OPS_STATE_PENDING&&(r.time_str=MC.dateFormat(new Date(r.time*1e3),"hh:mm yyyy-MM-dd"),e.state!==i.OPS_STATE.OPS_STATE_INPROCESS&&(o=parseInt(e.time_begin,10),u=parseInt(e.time_end,10),!isNaN(o)&&!isNaN(u)&&u>=o&&(n=u-o,n<60?r.duration="Took "+n+" sec.":r.duration="Took "+Math.round(n/60)+" min."))),r.rid.search("stack")===0&&(r.name=s[2]),r.is_terminated=r.is_complete&&r.operation==="terminate",r},setFlag:function(e){var t,n,r,i,s;this.set("in_dashboard",e),r=this.attributes.unread_num,n=this.attributes.info_list;if(!e&&r>0)for(i=0,s=n.length;i<s;i++){t=n[i];if(t.rid===MC.canvas_data.id&&!t.is_readed){t.is_readed=!0,this.set("unread_num",r-1);break}}return null},resetInfoList:function(){var e,t,n,r;r=this.attributes.info_list;for(t=0,n=r.length;t<n;t++)e=r[t],e.is_readed=!0;return this.set("unread_num",0),null},openApp:function(e){var t,n,r,i,o;n=this.attributes.info_list;for(i=0,o=n.length;i<o;i++)t=n[i],t.id===e&&(r=t);return r&&s.trigger(s.OPEN_DESIGN_TAB,"OPEN_APP",r.name,r.region,r.rid),null},logout:function(){return r.logout({sender:this},t.cookie("usercode"),t.cookie("session_id"))}}),new u})}).call(this);