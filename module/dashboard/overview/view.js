(function(){define(["event","i18n!nls/lang.js","./module/dashboard/overview/template","./module/dashboard/overview/template_data","component/exporter/Thumbnail","constant","unmanagedvpc","backbone","jquery","handlebars","UI.scrollbar"],function(e,t,n,r,i,s,o){var u,a,f;return f=null,u={switchTab:function(e,t,n){var r,i;return t=t instanceof $?t:$(t),n=n instanceof $?n:$(n),r=$(e.currentTarget),i=$(t).index(r),r.hasClass("on")||(t.each(function(e){return e===i?$(this).addClass("on"):$(this).removeClass("on")}),n.each(function(e){return e===i?$(this).show():$(this).hide()})),null},thumbError:function(e){var t;return t=$(e.currentTarget),t.hide()},regexIndexOf:function(e,t,n){var r;return r=e.substring(n||0).search(t),r>=0?r+(n||0):r},updateLoadTime:function(e){return $("#global-refresh").text(e)},scrollToResource:function(){var e,t;return e=$("#global-region-wrap .scroll-content"),e.addClass("scroll-transition"),setTimeout(function(){return e.removeClass("scroll-transition"),null},100),t=$("#global-region-map-wrap").height()+7,scrollbar.scrollTo($("#global-region-wrap"),{top:t})},hasCredential:function(){return MC.common.cookie.getCookieByName("has_cred")==="true"},accountIsDemo:function(){return $.cookie("account_id")==="demo_account"}},a=Backbone.View.extend({el:$("#tab-content-dashboard"),overview:n,events:{"click #global-region-spot > li":"gotoRegion","click #global-region-create-stack-list li":"createStack","click #btn-create-stack":"createStack","click .global-region-status-content li a":"openItem","click .global-region-status-tab-item":"switchRecent","click #region-switch-list li":"switchRegion","click #region-resource-tab a":"switchAppStack","click #region-aws-resource-tab a":"switchResource","click #global-refresh":"reloadResource","click .global-region-resource-content a":"switchRegionAndResource","click .show-credential":"showCredential","click .region-resource-thumbnail":"clickRegionResourceThumbnail","click .table-app-link-clickable":"openApp","modal-shown .start-app":"startAppClick","modal-shown .stop-app":"stopAppClick","modal-shown .terminate-app":"terminateAppClick","modal-shown .duplicate-stack":"duplicateStackClick","modal-shown .delete-stack":"deleteStackClick","click #global-region-visualize-VPC":"unmanagedVPCClick","click #global-import-stack":"importJson"},status:{reloading:!1,resourceType:null,isDemo:!1},initialize:function(){return $(document.body).on("click","div.nav-region-group a",this.gotoRegion),$(document.body).on("click","#dashboard-global",this.gotoRegion),$(document.body).on("keyup","#confirm-app-name",this.confirmAppName)},confirmAppName:function(e){var t;return t=$(this).data("confirm"),$(this).val()===t?$("#btn-confirm").removeAttr("disabled"):$("#btn-confirm").attr("disabled","disabled")},setDemo:function(){return this.status.isDemo=!0,null},clearDemo:function(){return this.status.isDemo=!1,null},reloadResource:function(e,t){if(!u.hasCredential()||!!this.status.isDemo)return this.showCredential();this.status.reloading=!0,this.showLoading("#global-view, #region-resource-wrap");if(!t)return this.trigger("RELOAD_RESOURCE")},showLoading:function(e){return this.$el.find(e).html(r.loading())},showLoadingFaild:function(e){return this.$el.find(e).html(r.loading_failed())},switchRegion:function(e){var t,n,r;void 0,r=$(e.currentTarget),t=r.data("region"),t!=="global"&&(f=t),n=r.find("a").text();if(n===this.$el.find("#region-switch span").text())return;return this.$el.find("#region-switch span").text(n).data("region",t),t==="global"?(this.$el.find("#global-view").show(),this.$el.find("#region-view").hide()):(this.status.isDemo||this.showLoading("#region-app-stack-wrap, #region-resource-wrap"),this.$el.find("#global-view").hide(),this.$el.find("#region-view").show(),this.trigger("SWITCH_REGION",t),this.renderRegionAppStack())},switchRecent:function(e){return u.switchTab(e,"#global-region-status-tab-wrap a","#global-region-status-content-wrap > div")},switchAppStack:function(e){return u.switchTab(e,"#region-resource-tab a",".region-resource-list")},switchResource:function(e){var t;return t=$(e.currentTarget).data("resourceType"),this.renderRegionResourceBody(t)},switchRegionAndResource:function(e){var t,n;return t=$(e.currentTarget),n=t.data("region"),this.status.resourceType=t.data("resourceType"),this.gotoRegion(n)},renderGlobalList:function(e){var n;return this.status.reloading&&(notification("info",t.ide.DASH_MSG_RELOAD_AWS_RESOURCE_SUCCESS),this.status.reloading=!1),n=r.global_list(this.model.toJSON()),f&&this.trigger("SWITCH_REGION",f,!0),$(this.el).find("#global-view").html(n)},renderRegionAppStack:function(e){var t,n,s,o,a,f,l,c,h;this.regionAppStackRendered=!0,e||(e="stack"),t=_.extend({},this.model.toJSON()),c=t.cur_stack_list||[];for(o=0,f=c.length;o<f;o++)n=c[o],n.url=i.fetch(n.id);h=t.cur_app_list||[];for(a=0,l=h.length;a<l;a++)n=h[a],n.url=i.fetch(n.id);return t[e]=!0,s=r.region_app_stack(t),$(this.el).find("#region-app-stack-wrap").html(s).find(".region-resource-thumbnail img").error(u.thumbError)},renderRegionResource:function(e){var t;return void 0,this.status.reloading||(t=r.region_resource_head(this.model.toJSON()),this.$el.find("#region-resource-wrap").html(t),this.renderRegionResourceBody()),null},renderRegionResourceBody:function(e,t){var n,i,s,o;i=$("#region-aws-resource-tab .region-resource-tab-item"),n=i.filter(".on"),s=n.data("resourceType");if(t&&e!==s)return;return!e&&!t&&(this.status.resourceType?(e=this.status.resourceType,this.status.resourceType=null):e="DescribeInstances"),o=r[e],i.each(function(){return $(this).data("resourceType")===e?$(this).addClass("on"):$(this).removeClass("on")}),this.$el.find("#region-aws-resource-data").html(o(this.model.get("cur_region_resource"))),null},renderRecent:function(){return $(this.el).find("#global-region-status-widget").html(r.recent(this.model.attributes)),null},renderLoadingFaild:function(){return this.showLoadingFaild("#global-view, #region-resource-wrap")},renderGlobalDemo:function(){return this.$el.find("#global-view").html(r.demo_global())},renderRegionDemo:function(){return this.$el.find("#region-resource-wrap").html(r.demo_region())},enableCreateStack:function(e){var t,n;return t=$("#btn-create-stack"),n=$("#global-create-stack"),t.removeAttr("disabled"),n.removeAttr("disabled").addClass("js-toggle-dropdown"),$("#global-import-stack").removeAttr("disabled"),MC.common.cookie.getCookieByName("account_id")!=="demo_account"&&$("#global-region-visualize-VPC").removeAttr("disabled"),null},enableSwitchRegion:function(){return $("#region-switch").removeClass("disabled").addClass("js-toggle-dropdown")},disableSwitchRegion:function(){return $("#region-switch").addClass("disabled").removeClass("js-toggle-dropdown")},createStack:function(t){var n;n=$(t.currentTarget);if(n.prop("disabled"))return;return e.trigger(e.OPEN_DESIGN_TAB,"NEW_STACK",null,n.data("region")||f,null)},gotoRegion:function(e){var t,n;return void 0,e===Object(e)?(t=$(e.currentTarget),n=t.attr("id")||t.data("regionName"),n=n.replace("dashboard-global","global")):n=e,$("#region-switch-list li[data-region="+n+"]").click(),u.scrollToResource()},displayLoadTime:function(){var e;return e=$.now()/1e3,clearInterval(this.timer),u.updateLoadTime(MC.intervalDate(e)),this.timer=setInterval(function(){return u.updateLoadTime(MC.intervalDate(e)),void 0},60001),$("#global-refresh ").show(),null},hideLoadTime:function(){return $("#global-refresh ").hide(),null},openApp:function(t){var n,r,i;return n=$(t.currentTarget),i=n.data("name"),r=n.data("id"),e.trigger(e.OPEN_DESIGN_TAB,"OPEN_APP",i,f,r)},showCredential:function(e){return require(["component/awscredential/main"],function(t){return t.loadModule(e)})},renderMapResult:function(){var e;return void 0,e=r.overview_result(this.model.attributes),$(this.el).find("#global-region-spot").html(e),null},render:function(){var e,t;return void 0,void 0,t=_.map(s.REGION_LABEL,function(e,t){return{"long":{id:t,name:e},"short":{id:t,name:s.REGION_SHORT_LABEL[t]}}}),e={region_names:t},void 0,$(this.el).html(this.overview(e)),null},openItem:function(t){var n,r;return void 0,r=this,n=t.currentTarget.id,n.indexOf("app-")===0?e.trigger(e.OPEN_DESIGN_TAB,"OPEN_APP",$("#"+n).data("option").name,$("#"+n).data("option").region,n):n.indexOf("stack-")===0&&e.trigger(e.OPEN_DESIGN_TAB,"OPEN_STACK",$("#"+n).data("option").name,$("#"+n).data("option").region,n),null},clickRegionResourceThumbnail:function(t){var n,r,i;return void 0,$(t.currentTarget).children(".app-thumbnail-pending").length>0||(r=$(t.currentTarget).next(".region-resource-info")[0],n=$(r).find(".modal")[0].id,i=$($(r).find(".region-resource-item-name")[0]).text(),n.indexOf("app-")===0?e.trigger(e.OPEN_DESIGN_TAB,"OPEN_APP",i,f,n):n.indexOf("stack-")===0&&e.trigger(e.OPEN_DESIGN_TAB,"OPEN_STACK",i,f,n)),null},deleteStackClick:function(t){var n,r;return void 0,n=$(t.currentTarget).attr("id"),r=$(t.currentTarget).attr("name"),$("#btn-confirm").on("click",{target:this},function(t){return void 0,modal.close(),e.trigger(e.DELETE_STACK,f,n,r)}),null},duplicateStackClick:function(n){var r,i,s;return void 0,r=$(n.currentTarget).attr("id"),i=$(n.currentTarget).attr("name"),s=MC.aws.aws.getDuplicateName(i),$("#modal-input-value").val(s),$("#btn-confirm").on("click",{target:this},function(n){return void 0,s=$("#modal-input-value").val(),s?s.indexOf(" ")>=0?notification("warning",t.ide.PROP_MSG_WARN_WHITE_SPACE):MC.aws.aws.checkStackName(null,s)?(modal.close(),e.trigger(e.DUPLICATE_STACK,f,r,s,i)):notification("warning",t.ide.PROP_MSG_WARN_REPEATED_STACK_NAME):notification("warning",t.ide.PROP_MSG_WARN_NO_STACK_NAME)}),null},startAppClick:function(t){var n,r;return void 0,n=$(t.currentTarget).attr("id"),r=$(t.currentTarget).attr("name"),MC.common.cookie.getCookieByName("has_cred")!=="true"?(modal.close(),void 0,require(["component/awscredential/main"],function(e){return e.loadModule()})):$("#btn-confirm").on("click",{target:this},function(t){return void 0,modal.close(),e.trigger(e.START_APP,f,n,r)}),null},stopAppClick:function(t){var n,r;return void 0,n=$(t.currentTarget).attr("id"),r=$(t.currentTarget).attr("name"),MC.common.cookie.getCookieByName("has_cred")!=="true"?(modal.close(),void 0,require(["component/awscredential/main"],function(e){return e.loadModule()})):$("#btn-confirm").on("click",{target:this},function(t){return void 0,modal.close(),e.trigger(e.STOP_APP,f,n,r)}),null},terminateAppClick:function(t){var n,r;return void 0,n=$(t.currentTarget).attr("id"),r=$(t.currentTarget).attr("name"),MC.common.cookie.getCookieByName("has_cred")!=="true"?(modal.close(),void 0,require(["component/awscredential/main"],function(e){return e.loadModule()})):$("#btn-confirm").on("click",{target:this},function(t){return void 0,modal.close(),e.trigger(e.TERMINATE_APP,f,n,r)}),null},updateThumbnail:function(e,t){return void 0,_.each($(".region-resource-list-item").find(".region-resource-thumbnail img"),function(n){var r,i;r=$(n);if(r.attr("data-id")===t)return i="https://madeiracloudthumbnails-dev.s3.amazonaws.com/"+e+"?time="+Math.round(+(new Date)),void 0,r.attr("src",i),r.removeAttr("style")}),null},unmanagedVPCClick:function(){return void 0,MC.common.cookie.getCookieByName("account_id")!=="demo_account"&&o.loadModule(),null},importJson:function(){var e,n,r,i;return modal(MC.template.importJSON()),n=this.model,r=new FileReader,r.onload=function(e){var t;return t=n.importJson(r.result),t?$("#import-json-error").html(t):(modal.close(),r=null),null},r.onerror=function(){return $("#import-json-error").html(t.ide.POP_IMPORT_ERROR),null},e=function(e){var t;e.stopPropagation(),e.preventDefault(),$("#modal-import-json-dropzone").removeClass("dragover"),$("#import-json-error").html(""),e=e.originalEvent,t=(e.dataTransfer||e.target).files;if(!t||!t.length)return;return r.readAsText(t[0]),null},$("#modal-import-json-file").on("change",e),i=$("#modal-import-json-dropzone").on("drop",e),i.on("dragenter",function(){return $(this).closest("#modal-import-json-dropzone").toggleClass("dragover",!0)}),i.on("dragleave",function(){return $(this).closest("#modal-import-json-dropzone").toggleClass("dragover",!1)}),i.on("dragover",function(e){var t;return t=e.originalEvent.dataTransfer,t&&(t.dropEffect="copy"),e.stopPropagation(),e.preventDefault(),null}),null}}),a})}).call(this);