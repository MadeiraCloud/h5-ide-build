/*
#**********************************************************
#* Filename: UI.tooltip
#* Creator: Angel
#* Description: UI.tooltip
#* Date: 20140115
# **********************************************************
# (c) Copyright 2014 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.scrollbar
#* Creator: Angel
#* Description: UI.scrollbar
#* Date: 20140307
# **********************************************************
# (c) Copyright 2014 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.tabbar
#* Creator: Angel
#* Description: UI.tabbar
#* Date: 20140218
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.bubble
#* Creator: Angel
#* Description: UI.bubble
#* Date: 20140116
# **********************************************************
# (c) Copyright 2014 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.modal
#* Creator: Angel
#* Description: UI.modal
#* Date: 20140213
# **********************************************************
# (c) Copyright 2014 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.table
#* Creator: Angel
#* Description: UI.table
#* Date: 20130917
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.tablist
#* Creator: Cinde
#* Description: UI.tablist
#* Date: 20130620
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.selectbox
#* Creator: Cinde
#* Description: UI.selectbox
#* Date: 20130627
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.searchbar
#* Creator: Cinde
#* Description: UI.searchbar
#* Date: 20130627
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.filter
#* Creator: Cinde
#* Description: UI.filter
#* Date: 20130627
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.radiobuttons
#* Creator: Cinde
#* Description: UI.radiobuttons
#* Date: 20130629
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.notification
#* Creator: Cinde
#* Description: UI.notification
#* Date: 20130607
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename : UI.multiinputbox
#* Creator  : Morris
#* Desc     : Multiple Input Box
#* Date     : 20130715
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/**
 * A class to parse color values
 * @author Stoyan Stefanov <sstoo@gmail.com>
 * @link   http://www.phpied.com/rgb-color-parser-in-javascript/
 * @license Use it if you like it
 */

/*
 * HTML5 Sortable jQuery Plugin
 * http://farhadi.ir/projects/html5sortable
 *
 * Copyright 2012, Ali Farhadi
 * Released under the MIT license.
 */

/*
#**********************************************************
#* Filename: UI.parsley
#* Creator: Tim
#* Description: UI.parsley
#* Date: 20130813
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.errortip
#* Creator: Tim
#* Description: UI.errortip
#* Date: 20140102
# **********************************************************
# (c) Copyright 2013 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*
#**********************************************************
#* Filename: UI.tour
#* Creator: Song
#* Description: UI.tour
#* Date: 20140415
# **********************************************************
# (c) Copyright 2014 Madeiracloud  All Rights Reserved
# **********************************************************
*/

/*!
 * jqPagination, a jQuery pagination plugin (obviously)
 * Version: 1.3 (26th July 2013)
 *
 * Copyright (C) 2013 Ben Everard
 *
 * http://beneverard.github.com/jqPagination
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 *
 */

// License: http://dragsort.codeplex.com/license

define("UI.tooltip",["jquery"],function(){var e=function(t){var n=$(this),r=$.trim(n.data("tooltip")),i=$("#tooltip_box"),s=document.documentElement,o,u,a,f,l,c;return r!==""&&!n.hasClass("parsley-error")&&(i[0]||($(document.body).append('<div id="tooltip_box"></div>'),i=$("#tooltip_box")),i.text(r).show(),n.prop("namespaceURI")==="http://www.w3.org/2000/svg"?(o=n[0].getBoundingClientRect(),f=o.width,l=o.height):(o=n.offset(),f=n.innerWidth(),l=n.innerHeight()),u=i.width(),a=i.height(),i.css({left:o.left+f+u-s.scrollLeft>window.innerWidth?o.left+f-u-20:o.left+5,top:o.top+l+a-s.scrollTop+45>window.innerHeight?o.top-a-15:o.top+l+8}),$(document.body).on("mouseleave",".tooltip",e.clear),e.timer.push(setInterval(function(){n.closest("html").length===0&&e.clear()},1e3))),!0};e.timer=[],e.clear=function(){return $(document.body).off("mouseleave",".tooltip",e.clear),$("#tooltip_box").remove(),$.each(e.timer,function(e,t){clearInterval(t)}),!1},$(document).ready(function(){$(document.body).on("mouseenter",".tooltip",e)})}),define("UI.scrollbar",["jquery"],function(){var e=document.documentElement.style,t=!1,n;$.each(["webkitTransform","MozTransform","OTransform","msTransform","transform"],function(r,i){i in e&&(t=!0,n=i)});var r={init:function(){var e=document.getElementsByClassName("scroll-wrap");return $(document).on("mousewheel",".scroll-wrap",r.wheel).on("DOMMouseScroll",".scroll-wrap",r.wheel).on("mousedown",".scrollbar-veritical-thumb",{direction:"veritical"},r.mousedown).on("mousedown",".scrollbar-horizontal-thumb",{direction:"horizontal"},r.mousedown),setInterval(function(){var i=e.length;while(i--){var s=e[i],o=$(s),u=o.children(),a=u[0]?$(u[0].firstChild):undefined,f=u[1]?$(u[1].firstChild):undefined,l=s.getElementsByClassName("scroll-content")[0],c=s.offsetHeight,h=s.offsetWidth,p,d,v,m;l&&o.css("display")==="block"&&!o.hasClass("scrolling")&&(p=l.scrollHeight>0?c*c/l.scrollHeight:0,d=l.scrollWidth>0?h*h/l.scrollWidth:0,a&&a.hasClass("scrollbar-veritical-thumb")&&(v=o.height(),p<=c*2-l.scrollHeight||p>v?(a.parent().hide(),t?l.style[n]="translate("+(l.realScrollLeft?l.realScrollLeft:0)+", 0)":l.style.top="0px",l.realScrollTop=0,a[0].style.top="0px"):(a.parent().show(),a[0].style.height=p+"px",l.realScrollTop!==0&&v-l.realScrollTop>l.scrollHeight&&r.scrollTop({scroll_content:l,scrollbar_wrap:u[0],thumb:a[0],scroll_target:o},l.scrollHeight))),f&&f.hasClass("scrollbar-horizontal-thumb")&&(m=o.width(),d<=h*2-l.scrollWidth||d>m?(f.parent().hide(),t?l.style[n]="translate(0, "+(l.realScrollTop?l.realScrollTop:0)+"px)":l.style.left="0px",l.realScrollLeft=0,f[0].style.left="0px"):(f.parent().show(),f[0].style.width=d+"px",l.realScrollLeft!==0&&m-l.realScrollLeft>l.scrollWidth&&r.scrollLeft({scroll_content:l,scrollbar_wrap:u[1],thumb:f[0],scroll_target:o},l.scrollWidth))),s.scrollTop!==0&&(r.scrollTop({scroll_content:l,scrollbar_wrap:u[0],thumb:a[0],scroll_target:o},s.scrollTop),s.scrollTop=0),s.scrollLeft!==0&&(r.scrollLeft({scroll_content:l,scrollbar_wrap:u[0],thumb:a[0],scroll_target:o},s.scrollLeft),s.scrollLeft=0))}},800),!0},mousedown:function(e){var t=$(this),n=t.parent().parent(),i=e.data.direction;$(document.body).append('<div id="overlayer"></div>'),n.addClass("scrolling").trigger("scroll"),$(document).on({mousemove:r.mousemove,mouseup:r.mouseup},{scroll_target:n,direction:i,scrollbar_wrap:n.find(".scrollbar-"+i+"-wrap").first(),scroll_content:n.find(".scroll-content").first()[0],thumb:t[0],thumbPos:i==="veritical"?e.clientY-t.offset().top:e.clientX-t.offset().left})},mousemove:function(e){var t=e.data,n=t.scroll_target,i=t.direction,s=t.thumbPos;return i==="veritical"&&r.scrollTop(t,e.clientY-t.scrollbar_wrap.offset().top-s),i==="horizontal"&&r.scrollLeft(t,e.clientX-t.scrollbar_wrap.offset().left-s),!1},mouseup:function(e){return $(document).off({mousemove:r.mousemove,mouseup:r.mouseup}),$("#overlayer").remove(),e.data.scroll_target.removeClass("scrolling"),!0},scrollTo:function(e,t){var n=e.find(".scroll-content").first(),i,s;return t.left>=0&&(s=e.find(".scrollbar-horizontal-thumb").first(),i=e.find(".scrollbar-horizontal-wrap").first(),s[0]&&i[0]&&r.scrollLeft({scroll_content:n[0],scrollbar_wrap:i,thumb:s[0],scroll_target:e},t.left/(n[0].scrollWidth/i.width()))),t.top>=0&&(s=e.find(".scrollbar-veritical-thumb").first(),i=e.find(".scrollbar-veritical-wrap").first(),s[0]&&i[0]&&r.scrollTop({scroll_content:n[0],scrollbar_wrap:i,thumb:s[0],scroll_target:e},t.top/(n[0].scrollHeight/i.height()))),!0},scrollLeft:function(e,r){var i=e.scroll_content,s=e.thumb,o=e.scroll_target.width(),u=i.scrollWidth-o,a=i.scrollWidth/o,f=u/a,l;return u<0?!0:(r>0&&r<f?(s.style.left=r+"px",l=-(r*a)):(r<=0&&(s.style.left="0px",l=0),r>=f&&(s.style.left=f+"px",l=-u)),l=Math.round(l),t?i.style[n]="translate("+l+"px, "+(i.realScrollTop?i.realScrollTop:0)+"px)":i.style.left=l+"px",i.realScrollLeft=l,!0)},scrollTop:function(e,r){var i=e.scroll_content,s=e.thumb,o=e.scroll_target.height(),u=i.scrollHeight-o,a=i.scrollHeight/o,f=u/a,l;return u<0?!0:(r>0&&r<f?(s.style.top=r+"px",l=-(r*a)):(r<=0&&(s.style.top="0px",l=0),r>=f&&(s.style.top=f+"px",l=-u)),l=Math.round(l),t?i.style[n]="translate("+(i.realScrollLeft?i.realScrollLeft:0)+"px, "+l+"px)":i.style.top=l+"px",i.realScrollTop=l,!0)},wheel:function(e,t){var n=$(this),i=e.target,s=e.originalEvent,o=n.find(".scroll-content").first(),u,a,f,l,c,h,p;if(i.tagName.toLowerCase()==="textarea"&&i.scrollHeight>i.offsetHeight)return!0;if(s.wheelDeltaX||s.axis===1){n.trigger("onscroll"),u=n.find(".scrollbar-horizontal-thumb").first();if(u[0])return t=s.wheelDeltaX?s.wheelDeltaX/120:-s.detail/3,a=n.find(".scrollbar-horizontal-wrap").first(),wrap_width=n.width(),scrollLeft=u[0].offsetLeft-t*12,c=o[0].scrollWidth-wrap_width,h=o[0].scrollWidth/wrap_width,p=c/h,a.css("display")==="block"?(r.scrollLeft({scroll_content:o[0],scrollbar_wrap:a,thumb:u[0],scroll_target:n},scrollLeft),scrollLeft<0||scrollLeft>p):!0}if(s.wheelDeltaY||s.wheelDelta||s.detail){n.trigger("scroll"),u=n.find(".scrollbar-veritical-thumb").first();if(u[0])return t=s.wheelDelta?s.wheelDelta/120:s.wheelDeltaY?s.wheelDeltaY/120:-s.detail/3,a=n.find(".scrollbar-veritical-wrap").first(),f=n.height(),l=u[0].offsetTop-t*12,c=o[0].scrollHeight-f,h=o[0].scrollHeight/f,p=c/h,a.css("display")==="block"?(r.scrollTop({scroll_content:o[0],scrollbar_wrap:a,thumb:u[0],scroll_target:n},l),l<0||l>p):!0}}};window.scrollbar=r,$(document).ready(function(){r.init()})}),define("UI.tabbar",["jquery"],function(){var e=window.Tabbar={current:"dashboard",mousedown:function(t){if(t.which===1){if($(t.target).hasClass("icon-close"))return!1;this.id==="tab-bar-dashboard"&&e.open("dashboard");var n=$(this),r=n.position(),i=$("#tab-bar li"),s=n.clone();s.css({position:"absolute",left:r.left}),$("#tab-bar ul").append(s),n.css("visibility","hidden"),$(document.body).append('<div id="overlayer"></div>'),$(document).on("mousemove",{target:n,dragging_tab:s,offset_left:t.pageX-n.offset().left-117,tab_list:i,tab_width:i.last().width(),tabbar_offsetLeft:$("#tab-bar").offset().left},e.mousemove).on("mouseup",{target:n,dragging_tab:s},e.mouseup),MC.canvas.volume.close(),MC.canvas.event.clearList(t)}},mousemove:function(e){var t=e.pageX-e.data.offset_left,n=e.data.tabbar_offsetLeft,r=Math.round((t-n-117)/e.data.tab_width),i=e.data.tab_list.length;return t=t>n?t:n,t<162&&(t=162),e.data.dragging_tab.css("left",t-117),r>0&&(r>=i?e.data.tab_list.eq(i-1).after(e.data.target):e.data.tab_list.eq(r).before(e.data.target)),!1},mouseup:function(t){return t.data.dragging_tab.remove(),t.data.target.css("visibility","visible"),$("#overlayer").remove(),$(document).off({mousemove:e.mousemove,mouseup:e.mouseup}),e.open(t.data.target.attr("id").replace("tab-bar-",""),t.target.title,t),!1},add:function(t,n){var r=t.match(/(appview|app\-edit|app|stack|new|process)*/ig)[0];return $("#tab-bar ul").append(MC.template.tab.item({tab_id:t,tab_name:n,tab_type:r})),e.open(t,n),e.resize($("#tab-bar").width()),$("#tab-bar").trigger("NEW_TAB",t),t},open:function(t,n,r){var i=$("#tab-bar"),s=$("#tab-bar-"+t),o=$("#tab-bar .active")[0],u=null;return!o&&r&&(i.find("ul").append(r.data.target),o=$("#tab-bar .active")[0]),s[0]?(o&&(u=o.id.replace("tab-bar-","")),$("#tab-bar li").removeClass("active"),s.addClass("active"),t==="dashboard"?e.current="dashboard":e.current=s.data("tab-type"),i.trigger("OPEN_TAB",[u,t]),t==="dashboard"&&scrollbar.scrollTo($("#global-region-wrap"),{top:1}),t):(e.add(t,n),!1)},updateState:function(t,n){var r=$("#tab-bar-"+t);return r.hasClass("active")&&(e.current=n),r.data("tab-type",n),!0},closeTabRestriction:function(e){if(e.which===1){var t=$(this).parent(),n=t.find("a").attr("title").replace(" - stack",""),r=t.attr("id").replace("tab-bar-","");$("#tab-bar").trigger("CLOSE_TAB_RESTRICTION",[t,n,r])}},close:function(t){t.stopImmediatePropagation();if(t.which===1||$(t.currentTarget).hasClass("auto-close")){var n=$(this).parent(),r=n.attr("id").replace("tab-bar-","");n.remove(),e.open($("#tab-bar li:last").attr("id").replace("tab-bar-","")),$("#tab-bar").trigger("CLOSE_TAB",r),e.resize($("#tab-bar").width())}return!1},resize:function(e){var t=$("#tab-bar li"),n=$("#tab-bar li a.tab-bar-truncate"),r=t.length-1,i=(e-122-r*5)/r;return i=i>220?220:i,t.css("width",i),n.css("width",i-30),!0}};$(document).ready(function(){$("#tab-bar").on("click",".close-restriction",e.closeTabRestriction).on("mousedown","li",e.mousedown).on("click",".close-tab",e.close),$(window).resize(function(){e.resize($("#tab-bar").width())})})}),define("UI.bubble",["jquery"],function(){var e=function(t){if(t.type==="mouseleave")return e.clear(),!1;var n=$(this),r=n.data("bubble-template"),i=n.data("bubble-data"),s=$("#bubble-box"),o={},u=document.documentElement,a,f,l,c,h;$.trim(r)!==""&&(s[0]||($(document.body).append('<div id="bubble-box"><div class="arrow"></div><div id="bubble-content"></div></div>'),s=$("#bubble-box")),$("#bubble-content").html(MC.template[r](i)),l=n.offset(),c=n.innerWidth(),h=n.innerHeight(),a=s.width(),f=s.height(),l.left+c+a-u.scrollLeft>window.innerWidth?(o.left=l.left-a-15,s.addClass("bubble-right")):(o.left=l.left+c+15,s.addClass("bubble-left")),o.top=l.top-(f-h)/2,s.css(o).show()),e.timer=setInterval(function(){n.closest("html").length===0&&e.clear()},1e3)};e.clear=function(){$("#bubble-box").remove(),clearInterval(e.timer)},$(document).ready(function(){$(document.body).on("mouseenter mouseleave",".bubble",e)})}),define("UI.modal",["jquery"],function(){var e=window.modal=function(t,n,r,i){var s=$("#modal-wrap");s[0]||($(document.body).append('<div id="modal-wrap"></div>'),s=$("#modal-wrap")),i&&i.opacity&&s.css("background-color","rgba(0, 0, 0, "+i.opacity+")");var o="",u="",a=null;i&&i.$source&&(a=i.$source);if(a){var f=a.offset().left,l=a.offset().top,c=a.width(),h=a.height();o="overflow:hidden;opacity:0;left:"+f+"px;top:"+l+"px;width:"+c+"px;height:"+h+"px;",u="modal-transition-animation"}return t===Object(t)?s.html('<div id="modal-box" class="'+u+'" style="'+o+'"></div>').find("#modal-box").html(t):s.html('<div id="modal-box" class="'+u+'" style="'+o+'">'+t+"</div>"),$modal=$("#modal-box"),$modal.show(),$modal.children(":first").show(),a&&($modal.css({opacity:1,width:$modal.find("div").width(),height:$modal.find("div").height()}),$modal.on("webkitTransitionEnd transitionend oTransitionEnd",function(){$modal.removeClass("modal-transition-animation")})),e.position(a),n===!0&&($("#modal-wrap").on("click",e.dismiss),$(document).on("keyup",e.keyup)),$(window).on("resize",e.position),$("#modal-box").on("click",".modal-close",e.close).on("mousedown",".modal-header",{options:i},e.drag.mousedown),r&&r(),!0};e.open=function(t){var n=$(this),r=n.data("modal-template"),i=n.data("modal-data");return r&&(i===undefined&&(i=""),e(MC.template[r](i),n.data("modal-dismiss")),n.trigger("modal-shown"),$("#modal-wrap").one("closed",function(){n.trigger("modal-closed")})),!0},e.keyup=function(t){return t.which===27&&e.close(),!1},e.dismiss=function(t){t.target.id==="modal-wrap"&&e.close()},e.close=function(t){$(window).off("resize",e.position),$(document).off("keyup",e.keyup),$("#modal-wrap").trigger("closed").remove(),t&&t.target.tagName==="A"&&t.preventDefault&&t.preventDefault()},e.isPopup=function(){return $("#modal-box").html()!==void 0},e.drag={mousedown:function(t){var n=$("#modal-box"),r=n.position();$(document).on({mousemove:e.drag.mousemove,mouseup:e.drag.mouseup},{target:n,left:t.pageX-r.left,top:t.pageY-r.top,options:t.data.options}),t.preventDefault()},mousemove:function(e){return e.data.target.css({top:e.pageY-e.data.top,left:e.pageX-e.data.left}),!1},mouseup:function(t){var n=t.data.target,r=t.data.options,i=n.position(),s=n.height(),o=n.width(),u={};return r&&r.conflict==="loose"?(i.top<0&&(u.top=10),i.left<-o*.8&&(u.left=10),i.top>window.innerHeight-s+s*.7&&(u.top=window.innerHeight-s-10),i.left>window.innerWidth-o+o*.8&&(u.left=window.innerWidth-o-25)):(i.top<0&&(u.top=10),i.left<0&&(u.left=10),i.top>window.innerHeight-s&&(u.top=window.innerHeight-s-10),i.left>window.innerWidth-o&&(u.left=window.innerWidth-o-25)),$.isEmptyObject(u)||n.animate(u,300),$(document).off({mousemove:e.drag.mousemove,mouseup:e.drag.mouseup}),!1}},e.position=function(e){var t=$("#modal-box"),n=0,r=0;return e?(n=(window.innerHeight-t.find("div").height())/2,r=(window.innerWidth-t.find("div").width())/2):(n=(window.innerHeight-t.height())/2,r=(window.innerWidth-t.width())/2,n>250&&(n=250)),t.css({top:n,left:r}),!0},$(document).ready(function(){$(document).on("click",".modal",e.open)})}),define("UI.table",["jquery"],function(){var e={edit:function(e){if(e.target.tagName.toLowerCase()==="input")return!1;var t=$(this),n=t.css("height"),r=t.html('<input class="table-input" type="text" value="'+t.text()+'"/>').children(":first");return $(r).css({color:t.css("color"),"font-size":t.css("font-size")}).focus(),!0},update:function(e){return $(this).parent().text(this.value),!0},sort:function(e){var t=$(this),n=t.index()+1,r=t.parent().parent(),i=r.parent(),s=t.hasClass("desc-sort")?"DESC":"ASC",o=document.createDocumentFragment(),u=[],a=!1,f,l;return i.attr("data-target")&&(i=$("#"+i.attr("data-target"))),i.hasClass("table-head")?(f=i.parent().find(".table tbody"),l=f.find("tr")):(f=i.find("tbody"),l=f.find("tr")),r.find(".active").removeClass("active"),t.addClass("active"),l.map(function(){u.push({item:this,value:$(this).find("td:nth-child("+n+")").text().toLowerCase()})}),t.data("row-type")==="datetime"&&(a=!0),s==="DESC"?(u.sort(function(e,t){if(a)return new Date(e.value)-new Date(t.value);if(!isNaN(parseInt(e.value)))return e.value-t.value;if(typeof e.value=="string")return e.value.localeCompare(t.value)}),t.removeClass("desc-sort")):(u.sort(function(e,t){if(a)return new Date(t.value)-new Date(e.value);if(!isNaN(parseInt(e.value)))return t.value-e.value;if(typeof e.value=="string")return t.value.localeCompare(e.value)}),t.addClass("desc-sort")),$.each(u,function(e,t){o.appendChild(t.item)}),f.empty().append(o),o=null,!0}};$(document).ready(function(){$(document.body).on("click",".table td.editable",e.edit).on("click",".table .sortable, .table-head .sortable",e.sort).on("blur",".table-input",e.update)})}),define("UI.tablist",["jquery"],function(){var e=window.tab={update:function(e){var t=$(e.currentTarget);if(t.hasClass("active"))return!1;var n=t.addClass("active").siblings(".active").removeClass("active");return $(n.attr("data-tab-target")).removeClass("active"),$(t.attr("data-tab-target")).addClass("active"),!1}};$(function(){$(document.body).on("click",".tab [data-tab-target]",e.update)})}),define("UI.selectbox",["jquery"],function(){var e=window.selectbox={init:function(){$(".selectbox").each(function(){var e=$(this),t=e.find(".selected");t.length==0&&(t=e.find(".item:first-child").addClass("selected")),e.find(".selection").html(t.html())})}};(function(){function t(e){var t=$(e.currentTarget).closest(".selectbox");if(t.hasClass("open"))return t.removeClass("open"),!1;$(".selectbox.open").removeClass("open");var n=t.addClass("open").find(".dropdown");return n.find(".focused").removeClass("focused"),n.find(".selected").focus().addClass("focused"),$(document.body).one("click",function(e){t.removeClass("open")}),t.trigger("OPTION_SHOW"),!1}function n(e){var t=$(e.currentTarget).addClass("selected"),n=t.siblings(".selected").removeClass("selected"),r=t.closest(".selectbox").removeClass("open"),i=r.find(".selection").html(t.html()),s=$.Event("OPTION_CHANGE");return r.trigger(s,[t.attr("data-id"),t.data()]),s.isDefaultPrevented()&&(t.removeClass("selected"),n.addClass("selected"),i.html(n.html())),!0}function r(e){if(!/(38|40|13|27)/.test(e.which))return;var t=$(e.currentTarget);if(e.which==27)return t.closest(".selectbox").removeClass("open"),!1;if(e.which==13)return t.hasClass("selected")||(e.currentTarget=t.find(".focused"),n(e)),!1;var r=t.children(),i=r.filter(".focused").removeClass("focused").index();return e.which==40?i=i<r.length-1?i+1:0:i=i>1?i-1:r.length-1,r.eq(i).addClass("focused").focus(),!1}function i(){return $(this).hide().siblings(".edit").show(),!1}function s(e){var t=$(e.currentTarget).closest(".edit"),n=t.closest(".selectbox"),r=t.find(".input"),i=r.val();if(!i||i.length==0){n.trigger("EDIT_UPDATE","");return}r.val(""),t.hide().siblings(".editbtn").show(),e=$.Event("EDIT_UPDATE"),n.trigger(e,i);if(e.isDefaultPrevented())return;var s=e.id||i;n.find(".selection").html(i);var o=n.find(".dropdown").find(".selected").removeClass("selected");o.parent().append('<li class="item selected" data-id="'+s+'">'+i+"</li>"),n.trigger("EDIT_FINISHED").trigger("OPTION_CHANGE",s).removeClass("open")}function u(e){var t=$(e.currentTarget);if(t.is(".disabled, :disabled"))return;var n=t.attr("data-target");n&&(n=$(n)),n||(n=t.parent());var r=n.hasClass("open");return r?(n.removeClass("open"),t.trigger("DROPDOWN_CLOSE")):(t.attr("data-toggle")!="self-only"&&(o?a():(a(),o=!0,$(document.body).one("click",a))),n.addClass("open"),t.trigger("DROPDOWN_OPEN")),!1}function a(){var e=$(".js-toggle-dropdown");e.each(function(){var e=$(this);if(e.attr("data-toggle")=="self-only")return;var t=e.attr("data-target");t&&(t=$(t)),t||(t=e.parent()),t.hasClass("open")&&(t.removeClass("open"),e.trigger("DROPDOWN_CLOSE"))}),o=!1}$(function(){e.init(),$(document.body).on("click",".selectbox .editor .editbtn",i).on("click",".selectbox .editor .btn",s).on("click",".selectbox .editor",function(e){e.stopPropagation()}).on("click",".selectbox .selection",t).on("click",".selectbox .dropdown .item",n).on("keydown",".selectbox.open .dropdown",r).on("click",".js-toggle-dropdown",u)});var o=!1})()}),define("UI.searchbar",["jquery"],function(){var e=window.searchbar={init:function(){$(document).on("click",".search-bar .icon-search",e.show).on("click",".search-bar .icon-cancel",e.hide).on("keyup",".search-bar input",e.change)},show:function(e){var t=$(this),n=t.parent(),r=n.find("input"),i=n.find(".icon-cancel"),s=246;return n.animate({width:s+"px"},{duration:100,complete:function(){$(this).addClass("open"),r.focus(),n.trigger("SEARCHBAR_SHOW")}}),!1},hide:function(e){var t=$(this),n=t.parent(),r=n.find("input"),i=n.find(".icon-search"),s=i.outerWidth();return n.animate({width:s+"px"},{duration:100,complete:function(){$(this).removeClass("open"),r.val(""),n.trigger("SEARCHBAR_HIDE")}}),!1},change:function(e){var t=$(this),n=t.val();return t.trigger("SEARCHBAR_CHANGE",[n]),!1}};$(document).ready(function(){e.init()})}),define("UI.filter",["jquery"],function(){window.filter={update:function(e,t){!t||!t.type&&t.value==""?(e.trigger("FILTER_RESET"),e.find(".item").each(function(){$(this).removeClass("hide")})):(e.trigger("FILTER_SET"),e.find(".item").each(function(){var e=!0,n=$(this).data("id"),r=$(this);t.value&&n.toLowerCase().indexOf(t.value.toLowerCase())<0&&(e=!1);if(t.type&&e){var i=!0,s=t.type;$.each(s,function(e,t){if(s.hasOwnProperty(e)){var n=r.data(e);!n&&t?i=!1:t&&String(n).toLowerCase()!=String(t).toLowerCase()&&(i=!1)}}),e=i}$(this).toggleClass("hide",!e)}))}}}),define("UI.radiobuttons",["jquery"],function(){var e=window.radiobuttons={init:function(){$(document).on("click",".radiobuttons button",e.click)},click:function(e){var t=$(this),n=t.parent(),r=t.hasClass("active"),i=n.find(".active"),s=t.data("radio");return s==undefined&&(s=t.text()),r||(i.length>0&&i.removeClass("active"),t.addClass("active"),t.trigger("RADIOBTNS_CLICK",[s])),!1},data:function(e){var t=e.find(".active");return t.length>0?(cur_value=t.data("radio"),cur_value==undefined&&(cur_value=t.text()),cur_value):""}};$(document).ready(function(){e.init()})}),define("UI.notification",["jquery"],function(){var e={error:!0,warning:!0,info:!0};window.notification=function(n,r,i){if(!e[n])return;var s=$("#notification_wrap");if(s.length==0){var o=function(){$(this).closest(".notification_item").addClass("closing").slideUp("fast",function(){$(this).remove()})};s=$('<div id="notification_wrap"></div>').appendTo($(document.body)).on("click",".notification_close",o).on("CLOSE_ITEM",".notification_item",o)}var u=MC.template.notification.item({type:n,template:r,should_stay:i}),a=$(u).appendTo(s);i||t(a,n==="error",r.length);var f=s.children(":not(.closing)"),l=f.length-1;if(l>=3)for(var c=0;c<l;++c){var h=f.eq(c);if(h.children("span").text()===r){to=h.trigger("CLOSE_ITEM").data("close_to"),to&&clearTimeout(to);break}}};var t=function(e,t,n){stay_time=n*80,t&&(stay_time+=2e3);var r=setTimeout(function(){e.trigger("CLOSE_ITEM")},stay_time);e.data("close_to",r)}}),define("UI.multiinputbox",["jquery"],function(e){function n(){var t=e(this).closest(".multi-input"),n=t.data("row-tmpl");if(!n){var r=e("<p>").append(t.children().eq(0).clone());r.find("input").removeAttr("value"),n=r.html(),t.data("row-tmpl",n)}t.append(n).trigger("ADD_ROW");var i=parseInt(t.attr("data-max-row"));return i&&i<=t.children().length&&t.addClass("max"),!1}function r(){var t=e(this),n=t.closest(".multi-input").removeClass("max"),r=t.closest(".multi-ipt-row"),i=r.find("input").val(),s=e.Event("BEFORE_REMOVE_ROW",{value:i});return n.trigger(s),s.isDefaultPrevented()?!1:(r.remove(),n.trigger("REMOVE_ROW",i),!1)}var t={init:function(t){e(t).on("click",".multi-input .icon-add",n).on("click",".multi-input .icon-del",r)},update:function(t){var n=e(t),r=parseInt(n.attr("data-max-row"));n.toggleClass("max",r&&r<=n.children().length)}};e(function(){t.init(document.body)}),window.multiinputbox=t}),define("UI.canvg",[],function(){function e(e){this.ok=!1,e.charAt(0)=="#"&&(e=e.substr(1,6)),e=e.replace(/ /g,""),e=e.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in t)e==n&&(e=t[n]);var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}];for(var i=0;i<r.length;i++){var s=r[i].re,o=r[i].process,u=s.exec(e);u&&(channels=o(u),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),n=this.b.toString(16);return e.length==1&&(e="0"+e),t.length==1&&(t="0"+t),n.length==1&&(n="0"+n),"#"+e+t+n}}function t(){var t={};return t.MAX_VIRTUAL_PIXELS=3e4,t.init=function(e){var n=0;t.UniqueId=function(){return n++,"canvg"+n},t.Definitions={},t.Styles={},t.Animations=[],t.Images=[],t.ctx=e,t.ViewPort=new function(){this.viewPorts=[],this.Clear=function(){this.viewPorts=[]},this.SetCurrent=function(e,t){this.viewPorts.push({width:e,height:t})},this.RemoveCurrent=function(){this.viewPorts.pop()},this.Current=function(){return this.viewPorts[this.viewPorts.length-1]},this.width=function(){return this.Current().width},this.height=function(){return this.Current().height},this.ComputeSize=function(e){return e!=null&&typeof e=="number"?e:e=="x"?this.width():e=="y"?this.height():Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2)}}},t.init(),t.trim=function(e){return e.replace(/^\s+|\s+$/g,"")},t.compressSpaces=function(e){return e.replace(/[\s\r\t\n]+/gm," ")},t.parseXml=function(e,n){doc=null;try{if(window.DOMParser){var r=new DOMParser;doc=r.parseFromString(e,"text/xml")}else e=e.replace(/<!DOCTYPE svg[^>]*>/,""),doc=new ActiveXObject("Microsoft.XMLDOM"),doc.async="false",doc.loadXML(e)}catch(i){if(n)return console.warn("We still cannot parse the SVG."),t.parseXml("<svg></svg>");console.warn("Retry to parse the svg, this should only happen in IE.");var s=e.match(/<svg[^>]+>/);return s?(s=s[0],newSvgTag=s.replace(/xmlns=[^\s>]+/,"").replace(/[^\s]+:[^=]+=[^\s>]+/g,""),e=e.replace(s,newSvgTag),t.parseXml(e,!0)):null}return doc},t.Property=function(e,t){this.name=e,this.value=t},t.Property.prototype.getValue=function(){return this.value},t.Property.prototype.hasValue=function(){return this.value!=null&&this.value!==""},t.Property.prototype.numValue=function(){if(!this.hasValue())return 0;var e=parseFloat(this.value);return(this.value+"").match(/%$/)&&(e/=100),e},t.Property.prototype.valueOrDefault=function(e){return this.hasValue()?this.value:e},t.Property.prototype.numValueOrDefault=function(e){return this.hasValue()?this.numValue():e},t.Property.prototype.addOpacity=function(n){var r=this.value;if(n!=null&&n!=""&&typeof this.value=="string")if(this.value.indexOf("rgba(")!=-1)i=this.value.split(","),i[3]=parseFloat(i[3])*n,r=i.join(",")+")";else{var i=new e(this.value);i.ok&&(r="rgba("+i.r+", "+i.g+", "+i.b+", "+n+")")}return new t.Property(this.name,r)},t.Property.prototype.getDefinition=function(){var e=this.value.match(/#([^\)'"]+)/);return e&&(e=e[1]),e||(e=this.value),t.Definitions[e]},t.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0},t.Property.prototype.getFillStyleDefinition=function(e,n){var r=this.getDefinition();if(r!=null&&r.createGradient)return r.createGradient(t.ctx,e,n);if(r!=null&&r.createPattern){if(r.getHrefAttribute().hasValue()){var i=r.attribute("patternTransform");r=r.getHrefAttribute().getDefinition(),i.hasValue()&&(r.attribute("patternTransform",!0).value=i.value)}return r.createPattern(t.ctx,e)}return null},t.Property.prototype.getDPI=function(e){return 96},t.Property.prototype.getEM=function(e){var n=12,r=new t.Property("fontSize",t.Font.Parse(t.ctx.font).fontSize);return r.hasValue()&&(n=r.toPixels(e)),n},t.Property.prototype.getUnits=function(){var e=this.value+"";return e.replace(/[0-9\.\-]/g,"")},t.Property.prototype.toPixels=function(e,n){if(!this.hasValue())return 0;var r=this.value+"";if(r.match(/em$/))return this.numValue()*this.getEM(e);if(r.match(/ex$/))return this.numValue()*this.getEM(e)/2;if(r.match(/px$/))return this.numValue();if(r.match(/pt$/))return this.numValue()*this.getDPI(e)*(1/72);if(r.match(/pc$/))return this.numValue()*15;if(r.match(/cm$/))return this.numValue()*this.getDPI(e)/2.54;if(r.match(/mm$/))return this.numValue()*this.getDPI(e)/25.4;if(r.match(/in$/))return this.numValue()*this.getDPI(e);if(r.match(/%$/))return this.numValue()*t.ViewPort.ComputeSize(e);var i=this.numValue();return n&&i<1?i*t.ViewPort.ComputeSize(e):i},t.Property.prototype.toMilliseconds=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/s$/)?this.numValue()*1e3:e.match(/ms$/)?this.numValue():this.numValue()},t.Property.prototype.toRadians=function(){if(!this.hasValue())return 0;var e=this.value+"";return e.match(/deg$/)?this.numValue()*(Math.PI/180):e.match(/grad$/)?this.numValue()*(Math.PI/200):e.match(/rad$/)?this.numValue():this.numValue()*(Math.PI/180)},t.Font=new function(){this.Styles="normal|italic|oblique|inherit",this.Variants="normal|small-caps|inherit",this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit",this.CreateFont=function(e,n,r,i){var s=this.Parse(i?i:t.ctx.font);return e||(e=s.fontStyle||""),n||(n=s.fontWeight||""),r||(r=s.fontSize||""),[e,"normal",n,r,'"Lato", "Helvetica Neue", Arial, sans-serif'].join(" ")};var e=this;this.Parse=function(n){var r={},i=t.trim(t.compressSpaces(n||"")).split(" "),s={fontSize:!1,fontStyle:!1,fontWeight:!1,fontVariant:!1},o="";for(var u=0;u<i.length;u++)!s.fontStyle&&e.Styles.indexOf(i[u])!=-1?(i[u]!="inherit"&&(r.fontStyle=i[u]),s.fontStyle=!0):!s.fontVariant&&e.Variants.indexOf(i[u])!=-1?(i[u]!="inherit"&&(r.fontVariant=i[u]),s.fontStyle=s.fontVariant=!0):!s.fontWeight&&e.Weights.indexOf(i[u])!=-1?(i[u]!="inherit"&&(r.fontWeight=i[u]),s.fontStyle=s.fontVariant=s.fontWeight=!0):s.fontSize?i[u]!="inherit"&&(o+=i[u]):(i[u]!="inherit"&&(r.fontSize=i[u].split("/")[0]),s.fontStyle=s.fontVariant=s.fontWeight=s.fontSize=!0);return o!=""&&(r.fontFamily=o),r}},t.ToNumberArray=function(e){var n=t.trim(t.compressSpaces((e||"").replace(/,/g," "))).split(" ");for(var r=0;r<n.length;r++){var i=parseFloat(n[r]);isNaN(i)&&(i=0),n[r]=i}return n},t.Point=function(e,t){this.x=e,this.y=t},t.Point.prototype.angleTo=function(e){return Math.atan2(e.y-this.y,e.x-this.x)},t.Point.prototype.applyTransform=function(e){var t=this.x*e[0]+this.y*e[2]+e[4],n=this.x*e[1]+this.y*e[3]+e[5];this.x=t,this.y=n},t.CreatePoint=function(e){var n=t.ToNumberArray(e);return new t.Point(n[0],n[1])},t.CreatePath=function(e){var n=t.ToNumberArray(e),r=[];for(var i=0;i<n.length;i+=2)r.push(new t.Point(n[i],n[i+1]));return r},t.BoundingBox=function(e,t,n,r){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN,this.x=function(){return this.x1},this.y=function(){return this.y1},this.width=function(){return this.x2-this.x1},this.height=function(){return this.y2-this.y1},this.addPoint=function(e,t){if(e!=null){if(isNaN(this.x1)||isNaN(this.x2))this.x1=e,this.x2=e;e<this.x1&&(this.x1=e),e>this.x2&&(this.x2=e)}if(t!=null){if(isNaN(this.y1)||isNaN(this.y2))this.y1=t,this.y2=t;t<this.y1&&(this.y1=t),t>this.y2&&(this.y2=t)}},this.addX=function(e){this.addPoint(e,null)},this.addY=function(e){this.addPoint(null,e)},this.addBoundingBox=function(e){this.addPoint(e.x1,e.y1),this.addPoint(e.x2,e.y2)},this.addQuadraticCurve=function(e,t,n,r,i,s){var o=e+2/3*(n-e),u=t+2/3*(r-t),a=o+1/3*(i-e),f=u+1/3*(s-t);this.addBezierCurve(e,t,o,a,u,f,i,s)},this.addBezierCurve=function(e,t,n,r,s,o,u,a){var f=[e,t],l=[n,r],c=[s,o],h=[u,a];this.addPoint(f[0],f[1]),this.addPoint(h[0],h[1]);for(i=0;i<=1;i++){var p=function(e){return Math.pow(1-e,3)*f[i]+3*Math.pow(1-e,2)*e*l[i]+3*(1-e)*Math.pow(e,2)*c[i]+Math.pow(e,3)*h[i]},d=6*f[i]-12*l[i]+6*c[i],v=-3*f[i]+9*l[i]-9*c[i]+3*h[i],m=3*l[i]-3*f[i];if(v==0){if(d==0)continue;var g=-m/d;0<g&&g<1&&(i==0&&this.addX(p(g)),i==1&&this.addY(p(g)));continue}var y=Math.pow(d,2)-4*m*v;if(y<0)continue;var b=(-d+Math.sqrt(y))/(2*v);0<b&&b<1&&(i==0&&this.addX(p(b)),i==1&&this.addY(p(b)));var w=(-d-Math.sqrt(y))/(2*v);0<w&&w<1&&(i==0&&this.addX(p(w)),i==1&&this.addY(p(w)))}},this.isPointInBox=function(e,t){return this.x1<=e&&e<=this.x2&&this.y1<=t&&t<=this.y2},this.addPoint(e,t),this.addPoint(n,r)},t.Transform=function(e){var n=this;this.Type={},this.Type.translate=function(e){this.p=t.CreatePoint(e),this.apply=function(e){e.translate(this.p.x||0,this.p.y||0)},this.unapply=function(e){e.translate(-1*this.p.x||0,-1*this.p.y||0)},this.applyToPoint=function(e){e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0])}},this.Type.rotate=function(e){var n=t.ToNumberArray(e);this.angle=new t.Property("angle",n[0]),this.cx=n[1]||0,this.cy=n[2]||0,this.apply=function(e){e.translate(this.cx,this.cy),e.rotate(this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.unapply=function(e){e.translate(this.cx,this.cy),e.rotate(-1*this.angle.toRadians()),e.translate(-this.cx,-this.cy)},this.applyToPoint=function(e){var t=this.angle.toRadians();e.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]),e.applyTransform([Math.cos(t),Math.sin(t),-Math.sin(t),Math.cos(t),0,0]),e.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0])}},this.Type.scale=function(e){this.p=t.CreatePoint(e),this.apply=function(e){e.scale(this.p.x||1,this.p.y||this.p.x||1)},this.unapply=function(e){e.scale(1/this.p.x||1,1/this.p.y||this.p.x||1)},this.applyToPoint=function(e){e.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0])}},this.Type.matrix=function(e){this.m=t.ToNumberArray(e),this.apply=function(e){e.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5])},this.applyToPoint=function(e){e.applyTransform(this.m)}},this.Type.SkewBase=function(e){this.base=n.Type.matrix,this.base(e),this.angle=new t.Property("angle",e)},this.Type.SkewBase.prototype=new this.Type.matrix,this.Type.skewX=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0]},this.Type.skewX.prototype=new this.Type.SkewBase,this.Type.skewY=function(e){this.base=n.Type.SkewBase,this.base(e),this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0]},this.Type.skewY.prototype=new this.Type.SkewBase,this.transforms=[],this.apply=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].apply(e)},this.unapply=function(e){for(var t=this.transforms.length-1;t>=0;t--)this.transforms[t].unapply(e)},this.applyToPoint=function(e){for(var t=0;t<this.transforms.length;t++)this.transforms[t].applyToPoint(e)};var r=t.trim(t.compressSpaces(e)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var i=0;i<r.length;i++){var s=t.trim(r[i].split("(")[0]),o=r[i].split("(")[1].replace(")",""),u=new this.Type[s](o);u.type=s,this.transforms.push(u)}},t.AspectRatio=function(e,n,r,i,s,o,u,a,f,l){n=t.compressSpaces(n),n=n.replace(/^defer\s/,"");var c=n.split(" ")[0]||"xMidYMid",h=n.split(" ")[1]||"meet",p=r/i,d=s/o,v=Math.min(p,d),m=Math.max(p,d);h=="meet"&&(i*=v,o*=v),h=="slice"&&(i*=m,o*=m),f=new t.Property("refX",f),l=new t.Property("refY",l),f.hasValue()&&l.hasValue()?e.translate(-v*f.toPixels("x"),-v*l.toPixels("y")):(c.match(/^xMid/)&&(h=="meet"&&v==d||h=="slice"&&m==d)&&e.translate(r/2-i/2,0),c.match(/YMid$/)&&(h=="meet"&&v==p||h=="slice"&&m==p)&&e.translate(0,s/2-o/2),c.match(/^xMax/)&&(h=="meet"&&v==d||h=="slice"&&m==d)&&e.translate(r-i,0),c.match(/YMax$/)&&(h=="meet"&&v==p||h=="slice"&&m==p)&&e.translate(0,s-o)),c=="none"?e.scale(p,d):h=="meet"?e.scale(v,v):h=="slice"&&e.scale(m,m),e.translate(u==null?0:-u,a==null?0:-a)},t.Element={},t.EmptyProperty=new t.Property("EMPTY",""),t.Element.ElementBase=function(e){this.attributes={},this.styles={},this.children=[];if(e!=null&&e.nodeType==1){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];r.nodeType==1&&this.addChild(r,!0);if(this.captureTextNodes&&r.nodeType==3){var i=r.nodeValue||r.text||"";t.trim(t.compressSpaces(i))!=""&&this.addChild(new t.Element.tspan(r),!1)}}for(var n=0;n<e.attributes.length;n++){var s=e.attributes[n];this.attributes[s.nodeName]=new t.Property(s.nodeName,s.nodeValue)}var o=this.attribute("stylez").value.split(";");for(var n=0;n<o.length;n++)if(o[n].indexOf(":")!=-1){var u=o[n].split(":"),a=t.trim(u[0]);this.styles[a]=new t.Property(a,t.trim(u[1]))}}},t.Element.ElementBase.prototype.attribute=function(e,n){var r=this.attributes[e];return r!=null?r:(n==1&&(r=new t.Property(e,""),this.attributes[e]=r),r||t.EmptyProperty)},t.Element.ElementBase.prototype.getHrefAttribute=function(){for(var e in this.attributes)if(e.match(/:href$/))return this.attributes[e];return this.attributes.href||t.EmptyProperty()},t.Element.ElementBase.prototype.style=function(e,n){var r=this.styles[e];if(r!=null)return r;var i=this.attribute(e);return i!=null&&i.hasValue()?(this.styles[e]=i,i):(n==1&&(r=new t.Property(e,""),this.styles[e]=r),r||t.EmptyProperty)},t.Element.ElementBase.prototype.render=function(e){e.save(),this.setContext(e);try{this.renderChildren(e)}catch(t){console.warn("Error occur when rendering svg in canvas",t)}this.clearContext(e),e.restore()},t.Element.ElementBase.prototype.setContext=function(e){},t.Element.ElementBase.prototype.clearContext=function(e){},t.Element.ElementBase.prototype.renderChildren=function(e){for(var t=0;t<this.children.length;t++)this.children[t].render(e)},t.Element.ElementBase.prototype.addChild=function(e,n){var r=e;n&&(r=t.CreateElement(e)),r.parent=this,this.children.push(r)},t.Element.RenderedElementBase=function(e){this.base=t.Element.ElementBase,this.base(e)},t.Element.RenderedElementBase.prototype=new t.Element.ElementBase,t.Element.RenderedElementBase.prototype.setContext=function(e){if(this.style("fill").isUrlDefinition()){var n=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));n!=null&&(e.fillStyle=n)}else if(this.style("fill").hasValue()){var r=this.style("fill");r.value=="currentColor"&&(r.value=this.style("color").value),e.fillStyle=r.value=="none"?"rgba(0,0,0,0)":r.value}fillOpacity=this.style("fill-opacity");if(fillOpacity.hasValue()&&fillOpacity.value+""!="1"){var r=new t.Property("fill",e.fillStyle);r=r.addOpacity(fillOpacity.value),e.fillStyle=r.value}if(this.style("stroke").isUrlDefinition()){var n=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));n!=null&&(e.strokeStyle=n)}else if(this.style("stroke").hasValue()){var i=this.style("stroke");i.value=="currentColor"&&(i.value=this.style("color").value),e.strokeStyle=i.value=="none"?"rgba(0,0,0,0)":i.value}if(this.style("stroke-opacity").hasValue()){var i=new t.Property("stroke",e.strokeStyle);i=i.addOpacity(this.style("stroke-opacity").value),e.strokeStyle=i.value}if(this.style("stroke-width").hasValue()){var s=this.style("stroke-width").toPixels();e.lineWidth=s==0?.001:s}this.style("stroke-linecap").hasValue()&&(e.lineCap=this.style("stroke-linecap").value),this.style("stroke-linejoin").hasValue()&&(e.lineJoin=this.style("stroke-linejoin").value),this.style("stroke-miterlimit").hasValue()&&(e.miterLimit=this.style("stroke-miterlimit").value);if(this.style("stroke-dasharray").hasValue()){var o=t.ToNumberArray(this.style("stroke-dasharray").value);if(o.length>1||o[0]!=0){typeof e.setLineDash!="undefined"?e.setLineDash(o):typeof e.webkitLineDash!="undefined"?e.webkitLineDash=o:typeof e.mozDash!="undefined"&&(e.mozDash=o);var u=this.style("stroke-dashoffset").numValueOrDefault(1);typeof e.lineDashOffset!="undefined"?e.lineDashOffset=u:typeof e.webkitLineDashOffset!="undefined"?e.webkitLineDashOffset=u:typeof e.mozDashOffset!="undefined"&&(e.mozDashOffset=u)}}if(this.attribute("transform").hasValue()){var a=new t.Transform(this.attribute("transform").value);a.apply(e)}if(this.style("clip-path").hasValue()){var f=this.style("clip-path").getDefinition();f!=null&&f.apply(e)}this.style("opacity").hasValue()&&(e.globalAlpha=this.style("opacity").numValue())},t.Element.PathElementBase=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.path=function(e){return e!=null&&e.beginPath(),new t.BoundingBox},this.renderChildren=function(e){this.path(e),e.fillStyle!=""&&(this.attribute("fill-rule").hasValue()?e.fill(this.attribute("fill-rule").value):e.fill()),e.strokeStyle!=""&&e.stroke();var t=this.getMarkers();if(t!=null){if(this.style("marker-start").isUrlDefinition()){var n=this.style("marker-start").getDefinition();n.render(e,t[0][0],t[0][1])}if(this.style("marker-mid").isUrlDefinition()){var n=this.style("marker-mid").getDefinition();for(var r=1;r<t.length-1;r++)n.render(e,t[r][0],t[r][1])}if(this.style("marker-end").isUrlDefinition()){var n=this.style("marker-end").getDefinition();n.render(e,t[t.length-1][0],t[t.length-1][1])}}},this.getBoundingBox=function(){return this.path()},this.getMarkers=function(){return null}},t.Element.PathElementBase.prototype=new t.Element.RenderedElementBase,t.Element.svg=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.baseClearContext=this.clearContext,this.clearContext=function(e){this.baseClearContext(e),t.ViewPort.RemoveCurrent()},this.baseSetContext=this.setContext,this.setContext=function(e){e.strokeStyle="rgba(0,0,0,0)",e.lineCap="butt",e.lineJoin="miter",e.miterLimit=4,this.baseSetContext(e),this.attribute("x").hasValue()||(this.attribute("x",!0).value=0),this.attribute("y").hasValue()||(this.attribute("y",!0).value=0),e.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var n=t.ViewPort.width(),r=t.ViewPort.height();this.attribute("width").hasValue()||(this.attribute("width",!0).value="100%"),this.attribute("height").hasValue()||(this.attribute("height",!0).value="100%");if(typeof this.root=="undefined"){n=this.attribute("width").toPixels("x"),r=this.attribute("height").toPixels("y");var i=0,s=0;this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()&&(i=-this.attribute("refX").toPixels("x"),s=-this.attribute("refY").toPixels("y")),e.beginPath(),e.moveTo(i,s),e.lineTo(n,s),e.lineTo(n,r),e.lineTo(i,r),e.closePath(),e.clip()}t.ViewPort.SetCurrent(n,r)}},t.Element.svg.prototype=new t.Element.RenderedElementBase,t.Element.rect=function(e){this.base=t.Element.PathElementBase,this.base(e),this.path=function(e){var n=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y"),o=this.attribute("rx").toPixels("x"),u=this.attribute("ry").toPixels("y");return this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()&&(u=o),this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()&&(o=u),o=Math.min(o,i/2),u=Math.min(u,s/2),e!=null&&(e.beginPath(),e.moveTo(n+o,r),e.lineTo(n+i-o,r),e.quadraticCurveTo(n+i,r,n+i,r+u),e.lineTo(n+i,r+s-u),e.quadraticCurveTo(n+i,r+s,n+i-o,r+s),e.lineTo(n+o,r+s),e.quadraticCurveTo(n,r+s,n,r+s-u),e.lineTo(n,r+u),e.quadraticCurveTo(n,r,n+o,r),e.closePath()),new t.BoundingBox(n,r,n+i,r+s)}},t.Element.rect.prototype=new t.Element.PathElementBase,t.Element.circle=function(e){this.base=t.Element.PathElementBase,this.base(e),this.path=function(e){var n=this.attribute("cx").toPixels("x"),r=this.attribute("cy").toPixels("y"),i=this.attribute("r").toPixels();return e!=null&&(e.beginPath(),e.arc(n,r,i,0,Math.PI*2,!0),e.closePath()),new t.BoundingBox(n-i,r-i,n+i,r+i)}},t.Element.circle.prototype=new t.Element.PathElementBase,t.Element.ellipse=function(e){this.base=t.Element.PathElementBase,this.base(e),this.path=function(e){var n=4*((Math.sqrt(2)-1)/3),r=this.attribute("rx").toPixels("x"),i=this.attribute("ry").toPixels("y"),s=this.attribute("cx").toPixels("x"),o=this.attribute("cy").toPixels("y");return e!=null&&(e.beginPath(),e.moveTo(s,o-i),e.bezierCurveTo(s+n*r,o-i,s+r,o-n*i,s+r,o),e.bezierCurveTo(s+r,o+n*i,s+n*r,o+i,s,o+i),e.bezierCurveTo(s-n*r,o+i,s-r,o+n*i,s-r,o),e.bezierCurveTo(s-r,o-n*i,s-n*r,o-i,s,o-i),e.closePath()),new t.BoundingBox(s-r,o-i,s+r,o+i)}},t.Element.ellipse.prototype=new t.Element.PathElementBase,t.Element.line=function(e){this.base=t.Element.PathElementBase,this.base(e),this.getPoints=function(){return[new t.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new t.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))]},this.path=function(e){var n=this.getPoints();return e!=null&&(e.beginPath(),e.moveTo(n[0].x,n[0].y),e.lineTo(n[1].x,n[1].y)),new t.BoundingBox(n[0].x,n[0].y,n[1].x,n[1].y)},this.getMarkers=function(){var e=this.getPoints(),t=e[0].angleTo(e[1]);return[[e[0],t],[e[1],t]]}},t.Element.line.prototype=new t.Element.PathElementBase,t.Element.polyline=function(e){this.base=t.Element.PathElementBase,this.base(e),this.points=t.CreatePath(this.attribute("points").value),this.path=function(e){var n=new t.BoundingBox(this.points[0].x,this.points[0].y);e!=null&&(e.beginPath(),e.moveTo(this.points[0].x,this.points[0].y));for(var r=1;r<this.points.length;r++)n.addPoint(this.points[r].x,this.points[r].y),e!=null&&e.lineTo(this.points[r].x,this.points[r].y);return n},this.getMarkers=function(){var e=[];for(var t=0;t<this.points.length-1;t++)e.push([this.points[t],this.points[t].angleTo(this.points[t+1])]);return e.push([this.points[this.points.length-1],e[e.length-1][1]]),e}},t.Element.polyline.prototype=new t.Element.PathElementBase,t.Element.polygon=function(e){this.base=t.Element.polyline,this.base(e),this.basePath=this.path,this.path=function(e){var t=this.basePath(e);return e!=null&&(e.lineTo(this.points[0].x,this.points[0].y),e.closePath()),t}},t.Element.polygon.prototype=new t.Element.polyline,t.Element.path=function(e){this.base=t.Element.PathElementBase,this.base(e);var n=this.attribute("d").value;n=n.replace(/,/gm," "),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2"),n=n.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2"),n=n.replace(/([0-9])([+\-])/gm,"$1 $2"),n=n.replace(/(\.[0-9]*)(\.)/gm,"$1 $2"),n=n.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 "),n=t.compressSpaces(n),n=t.trim(n),this.PathParser=new function(e){this.tokens=e.split(" "),this.reset=function(){this.i=-1,this.command="",this.previousCommand="",this.start=new t.Point(0,0),this.control=new t.Point(0,0),this.current=new t.Point(0,0),this.points=[],this.angles=[]},this.isEnd=function(){return this.i>=this.tokens.length-1},this.isCommandOrEnd=function(){return this.isEnd()?!0:this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null},this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return!0}return!1},this.getToken=function(){return this.i++,this.tokens[this.i]},this.getScalar=function(){return parseFloat(this.getToken())},this.nextCommand=function(){this.previousCommand=this.command,this.command=this.getToken()},this.getPoint=function(){var e=new t.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(e)},this.getAsControlPoint=function(){var e=this.getPoint();return this.control=e,e},this.getAsCurrentPoint=function(){var e=this.getPoint();return this.current=e,e},this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t")return this.current;var e=new t.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return e},this.makeAbsolute=function(e){return this.isRelativeCommand()&&(e.x+=this.current.x,e.y+=this.current.y),e},this.addMarker=function(e,t,n){n!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null&&(this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(n)),this.addMarkerAngle(e,t==null?null:t.angleTo(e))},this.addMarkerAngle=function(e,t){this.points.push(e),this.angles.push(t)},this.getMarkerPoints=function(){return this.points},this.getMarkerAngles=function(){for(var e=0;e<this.angles.length;e++)if(this.angles[e]==null)for(var t=e+1;t<this.angles.length;t++)if(this.angles[t]!=null){this.angles[e]=this.angles[t];break}return this.angles}}(n),this.path=function(e){var n=this.PathParser;n.reset();var r=new t.BoundingBox;e!=null&&e.beginPath();while(!n.isEnd()){n.nextCommand();switch(n.command){case"M":case"m":var i=n.getAsCurrentPoint();n.addMarker(i),r.addPoint(i.x,i.y),e!=null&&e.moveTo(i.x,i.y),n.start=n.current;while(!n.isCommandOrEnd()){var i=n.getAsCurrentPoint();n.addMarker(i,n.start),r.addPoint(i.x,i.y),e!=null&&e.lineTo(i.x,i.y)}break;case"L":case"l":while(!n.isCommandOrEnd()){var s=n.current,i=n.getAsCurrentPoint();n.addMarker(i,s),r.addPoint(i.x,i.y),e!=null&&e.lineTo(i.x,i.y)}break;case"H":case"h":while(!n.isCommandOrEnd()){var o=new t.Point((n.isRelativeCommand()?n.current.x:0)+n.getScalar(),n.current.y);n.addMarker(o,n.current),n.current=o,r.addPoint(n.current.x,n.current.y),e!=null&&e.lineTo(n.current.x,n.current.y)}break;case"V":case"v":while(!n.isCommandOrEnd()){var o=new t.Point(n.current.x,(n.isRelativeCommand()?n.current.y:0)+n.getScalar());n.addMarker(o,n.current),n.current=o,r.addPoint(n.current.x,n.current.y),e!=null&&e.lineTo(n.current.x,n.current.y)}break;case"C":case"c":while(!n.isCommandOrEnd()){var u=n.current,a=n.getPoint(),f=n.getAsControlPoint(),l=n.getAsCurrentPoint();n.addMarker(l,f,a),r.addBezierCurve(u.x,u.y,a.x,a.y,f.x,f.y,l.x,l.y),e!=null&&e.bezierCurveTo(a.x,a.y,f.x,f.y,l.x,l.y)}break;case"S":case"s":while(!n.isCommandOrEnd()){var u=n.current,a=n.getReflectedControlPoint(),f=n.getAsControlPoint(),l=n.getAsCurrentPoint();n.addMarker(l,f,a),r.addBezierCurve(u.x,u.y,a.x,a.y,f.x,f.y,l.x,l.y),e!=null&&e.bezierCurveTo(a.x,a.y,f.x,f.y,l.x,l.y)}break;case"Q":case"q":while(!n.isCommandOrEnd()){var u=n.current,f=n.getAsControlPoint(),l=n.getAsCurrentPoint();n.addMarker(l,f,f),r.addQuadraticCurve(u.x,u.y,f.x,f.y,l.x,l.y),e!=null&&e.quadraticCurveTo(f.x,f.y,l.x,l.y)}break;case"T":case"t":while(!n.isCommandOrEnd()){var u=n.current,f=n.getReflectedControlPoint();n.control=f;var l=n.getAsCurrentPoint();n.addMarker(l,f,f),r.addQuadraticCurve(u.x,u.y,f.x,f.y,l.x,l.y),e!=null&&e.quadraticCurveTo(f.x,f.y,l.x,l.y)}break;case"A":case"a":while(!n.isCommandOrEnd()){var u=n.current,c=n.getScalar(),h=n.getScalar(),p=n.getScalar()*(Math.PI/180),d=n.getScalar(),v=n.getScalar(),l=n.getAsCurrentPoint(),m=new t.Point(Math.cos(p)*(u.x-l.x)/2+Math.sin(p)*(u.y-l.y)/2,-Math.sin(p)*(u.x-l.x)/2+Math.cos(p)*(u.y-l.y)/2),g=Math.pow(m.x,2)/Math.pow(c,2)+Math.pow(m.y,2)/Math.pow(h,2);g>1&&(c*=Math.sqrt(g),h*=Math.sqrt(g));var y=(d==v?-1:1)*Math.sqrt((Math.pow(c,2)*Math.pow(h,2)-Math.pow(c,2)*Math.pow(m.y,2)-Math.pow(h,2)*Math.pow(m.x,2))/(Math.pow(c,2)*Math.pow(m.y,2)+Math.pow(h,2)*Math.pow(m.x,2)));isNaN(y)&&(y=0);var b=new t.Point(y*c*m.y/h,y*-h*m.x/c),w=new t.Point((u.x+l.x)/2+Math.cos(p)*b.x-Math.sin(p)*b.y,(u.y+l.y)/2+Math.sin(p)*b.x+Math.cos(p)*b.y),E=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))},S=function(e,t){return(e[0]*t[0]+e[1]*t[1])/(E(e)*E(t))},x=function(e,t){return(e[0]*t[1]<e[1]*t[0]?-1:1)*Math.acos(S(e,t))},T=x([1,0],[(m.x-b.x)/c,(m.y-b.y)/h]),N=[(m.x-b.x)/c,(m.y-b.y)/h],C=[(-m.x-b.x)/c,(-m.y-b.y)/h],k=x(N,C);S(N,C)<=-1&&(k=Math.PI),S(N,C)>=1&&(k=0);var L=1-v?1:-1,A=T+L*(k/2),O=new t.Point(w.x+c*Math.cos(A),w.y+h*Math.sin(A));n.addMarkerAngle(O,A-L*Math.PI/2),n.addMarkerAngle(l,A-L*Math.PI),r.addPoint(l.x,l.y);if(e!=null){var S=c>h?c:h,M=c>h?1:c/h,_=c>h?h/c:1;e.translate(w.x,w.y),e.rotate(p),e.scale(M,_),e.arc(0,0,S,T,T+k,1-v),e.scale(1/M,1/_),e.rotate(-p),e.translate(-w.x,-w.y)}}break;case"Z":case"z":e!=null&&e.closePath(),n.current=n.start}}return r},this.getMarkers=function(){var e=this.PathParser.getMarkerPoints(),t=this.PathParser.getMarkerAngles(),n=[];for(var r=0;r<e.length;r++)n.push([e[r],t[r]]);return n}},t.Element.path.prototype=new t.Element.PathElementBase,t.Element.pattern=function(e){this.base=t.Element.ElementBase,this.base(e),this.createPattern=function(e,n){var r=this.attribute("width").toPixels("x",!0),i=this.attribute("height").toPixels("y",!0),s=new t.Element.svg;s.attributes.viewBox=new t.Property("viewBox",this.attribute("viewBox").value),s.attributes.width=new t.Property("width",r+"px"),s.attributes.height=new t.Property("height",i+"px"),s.attributes.transform=new t.Property("transform",this.attribute("patternTransform").value),s.children=this.children;var o=document.createElement("canvas");o.width=r,o.height=i;var u=o.getContext("2d");this.attribute("x").hasValue()&&this.attribute("y").hasValue()&&u.translate(this.attribute("x").toPixels("x",!0),this.attribute("y").toPixels("y",!0));for(var a=-1;a<=1;a++)for(var f=-1;f<=1;f++)u.save(),u.translate(a*o.width,f*o.height),s.render(u),u.restore();var l=e.createPattern(o,"repeat");return l}},t.Element.pattern.prototype=new t.Element.ElementBase,t.Element.marker=function(e){this.base=t.Element.ElementBase,this.base(e),this.baseRender=this.render,this.render=function(e,n,r){e.translate(n.x,n.y),this.attribute("orient").valueOrDefault("auto")=="auto"&&e.rotate(r),this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"&&e.scale(e.lineWidth,e.lineWidth),e.save();var i=new t.Element.svg;i.attributes.viewBox=new t.Property("viewBox",this.attribute("viewBox").value),i.attributes.refX=new t.Property("refX",this.attribute("refX").value),i.attributes.refY=new t.Property("refY",this.attribute("refY").value),i.attributes.width=new t.Property("width",this.attribute("markerWidth").value),i.attributes.height=new t.Property("height",this.attribute("markerHeight").value),i.attributes.fill=new t.Property("fill",this.attribute("fill").valueOrDefault("black")),i.attributes.stroke=new t.Property("stroke",this.attribute("stroke").valueOrDefault("none")),i.children=this.children,i.render(e),e.restore(),this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"&&e.scale(1/e.lineWidth,1/e.lineWidth),this.attribute("orient").valueOrDefault("auto")=="auto"&&e.rotate(-r),e.translate(-n.x,-n.y)}},t.Element.marker.prototype=new t.Element.ElementBase,t.Element.defs=function(e){this.base=t.Element.ElementBase,this.base(e),this.render=function(e){}},t.Element.defs.prototype=new t.Element.ElementBase,t.Element.GradientBase=function(e){this.base=t.Element.ElementBase,this.base(e),this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox"),this.stops=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];r.type=="stop"&&this.stops.push(r)}this.getGradient=function(){},this.createGradient=function(e,n,r){var i=this;this.getHrefAttribute().hasValue()&&(i=this.getHrefAttribute().getDefinition());var s=function(e){if(r.hasValue()){var n=new t.Property("color",e);return n.addOpacity(r.value).value}return e},o=this.getGradient(e,n);if(o==null)return s(i.stops[i.stops.length-1].color);for(var u=0;u<i.stops.length;u++)o.addColorStop(i.stops[u].offset,s(i.stops[u].color));if(this.attribute("gradientTransform").hasValue()){var a=t.ViewPort.viewPorts[0],f=new t.Element.rect;f.attributes.x=new t.Property("x",-t.MAX_VIRTUAL_PIXELS/3),f.attributes.y=new t.Property("y",-t.MAX_VIRTUAL_PIXELS/3),f.attributes.width=new t.Property("width",t.MAX_VIRTUAL_PIXELS),f.attributes.height=new t.Property("height",t.MAX_VIRTUAL_PIXELS);var l=new t.Element.g;l.attributes.transform=new t.Property("transform",this.attribute("gradientTransform").value),l.children=[f];var c=new t.Element.svg;c.attributes.x=new t.Property("x",0),c.attributes.y=new t.Property("y",0),c.attributes.width=new t.Property("width",a.width),c.attributes.height=new t.Property("height",a.height),c.children=[l];var h=document.createElement("canvas");h.width=a.width,h.height=a.height;var p=h.getContext("2d");return p.fillStyle=o,c.render(p),p.createPattern(h,"no-repeat")}return o}},t.Element.GradientBase.prototype=new t.Element.ElementBase,t.Element.linearGradient=function(e){this.base=t.Element.GradientBase,this.base(e),this.getGradient=function(e,t){var n=t.getBoundingBox();!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()&&(this.attribute("x1",!0).value=0,this.attribute("y1",!0).value=0,this.attribute("x2",!0).value=1,this.attribute("y2",!0).value=0);var r=this.gradientUnits=="objectBoundingBox"?n.x()+n.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"),i=this.gradientUnits=="objectBoundingBox"?n.y()+n.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"),s=this.gradientUnits=="objectBoundingBox"?n.x()+n.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"),o=this.gradientUnits=="objectBoundingBox"?n.y()+n.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y");return r==s&&i==o?null:e.createLinearGradient(r,i,s,o)}},t.Element.linearGradient.prototype=new t.Element.GradientBase,t.Element.radialGradient=function(e){this.base=t.Element.GradientBase,this.base(e),this.getGradient=function(e,t){var n=t.getBoundingBox();this.attribute("cx").hasValue()||(this.attribute("cx",!0).value="50%"),this.attribute("cy").hasValue()||(this.attribute("cy",!0).value="50%"),this.attribute("r").hasValue()||(this.attribute("r",!0).value="50%");var r=this.gradientUnits=="objectBoundingBox"?n.x()+n.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"),i=this.gradientUnits=="objectBoundingBox"?n.y()+n.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"),s=r,o=i;this.attribute("fx").hasValue()&&(s=this.gradientUnits=="objectBoundingBox"?n.x()+n.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x")),this.attribute("fy").hasValue()&&(o=this.gradientUnits=="objectBoundingBox"?n.y()+n.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));var u=this.gradientUnits=="objectBoundingBox"?(n.width()+n.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels();return e.createRadialGradient(s,o,0,r,i,u)}},t.Element.radialGradient.prototype=new t.Element.GradientBase,t.Element.stop=function(e){this.base=t.Element.ElementBase,this.base(e),this.offset=this.attribute("offset").numValue(),this.offset<0&&(this.offset=0),this.offset>1&&(this.offset=1);var n=this.style("stop-color");this.style("stop-opacity").hasValue()&&(n=n.addOpacity(this.style("stop-opacity").value)),this.color=n.value},t.Element.stop.prototype=new t.Element.ElementBase,t.Element.font=function(e){this.base=t.Element.ElementBase,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.isRTL=!1,this.isArabic=!1,this.fontFace=null,this.missingGlyph=null,this.glyphs=[];for(var n=0;n<this.children.length;n++){var r=this.children[n];r.type=="font-face"?(this.fontFace=r,r.style("font-family").hasValue()&&(t.Definitions[r.style("font-family").value]=this)):r.type=="missing-glyph"?this.missingGlyph=r:r.type=="glyph"&&(r.arabicForm!=""?(this.isRTL=!0,this.isArabic=!0,typeof this.glyphs[r.unicode]=="undefined"&&(this.glyphs[r.unicode]=[]),this.glyphs[r.unicode][r.arabicForm]=r):this.glyphs[r.unicode]=r)}},t.Element.font.prototype=new t.Element.ElementBase,t.Element.fontface=function(e){this.base=t.Element.ElementBase,this.base(e),this.ascent=this.attribute("ascent").value,this.descent=this.attribute("descent").value,this.unitsPerEm=this.attribute("units-per-em").numValue()},t.Element.fontface.prototype=new t.Element.ElementBase,t.Element.missingglyph=function(e){this.base=t.Element.path,this.base(e),this.horizAdvX=0},t.Element.missingglyph.prototype=new t.Element.path,t.Element.glyph=function(e){this.base=t.Element.path,this.base(e),this.horizAdvX=this.attribute("horiz-adv-x").numValue(),this.unicode=this.attribute("unicode").value,this.arabicForm=this.attribute("arabic-form").value},t.Element.glyph.prototype=new t.Element.path,t.Element.text=function(e){this.captureTextNodes=!0,this.base=t.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.style("dominant-baseline").hasValue()&&(e.textBaseline=this.style("dominant-baseline").value),this.style("alignment-baseline").hasValue()&&(e.textBaseline=this.style("alignment-baseline").value),this.style("fill").hasValue()||(e.fillStyle="#000000"),typeof e.font!="undefined"&&(e.font=t.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"12px",this.style("font-family").value))},this.getBoundingBox=function(){return new t.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0)},this.renderChildren=function(e){this.x=this.attribute("x").toPixels("x"),this.y=this.attribute("y").toPixels("y"),this.x+=this.getAnchorDelta(e,this,0);for(var t=0;t<this.children.length;t++)this.renderChild(e,this,t)},this.getAnchorDelta=function(e,t,n){var r=this.style("text-anchor").valueOrDefault("start");if(r!="start"){var i=0;for(var s=n;s<t.children.length;s++){var o=t.children[s];if(s>n&&o.attribute("x").hasValue())break;i+=o.measureTextRecursive(e)}return-1*(r=="end"?i:i/2)}return 0},this.renderChild=function(e,t,n){var r=t.children[n];r.attribute("x").hasValue()?r.x=r.attribute("x").toPixels("x")+this.getAnchorDelta(e,t,n):(this.attribute("dx").hasValue()&&(this.x+=this.attribute("dx").toPixels("x")),r.attribute("dx").hasValue()&&(this.x+=r.attribute("dx").toPixels("x")),r.x=this.x),this.x=r.x+r.measureText(e),r.attribute("y").hasValue()?r.y=r.attribute("y").toPixels("y"):(this.attribute("dy").hasValue()&&(this.y+=this.attribute("dy").toPixels("y")),r.attribute("dy").hasValue()&&(this.y+=r.attribute("dy").toPixels("y")),r.y=this.y),this.y=r.y,r.render(e);for(var n=0;n<r.children.length;n++)this.renderChild(e,r,n)}},t.Element.text.prototype=new t.Element.RenderedElementBase,t.Element.TextElementBase=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.getGlyph=function(e,t,n){var r=t[n],i=null;if(e.isArabic){var s="isolated";(n==0||t[n-1]==" ")&&n<t.length-2&&t[n+1]!=" "&&(s="terminal"),n>0&&t[n-1]!=" "&&n<t.length-2&&t[n+1]!=" "&&(s="medial"),n>0&&t[n-1]!=" "&&(n==t.length-1||t[n+1]==" ")&&(s="initial"),typeof e.glyphs[r]!="undefined"&&(i=e.glyphs[r][s],i==null&&e.glyphs[r].type=="glyph"&&(i=e.glyphs[r]))}else i=e.glyphs[r];return i==null&&(i=e.missingGlyph),i},this.renderChildren=function(e){var n=this.parent.style("font-family").getDefinition();if(n!=null){var r=this.parent.style("font-size").numValueOrDefault(t.Font.Parse(t.ctx.font).fontSize),i=this.parent.style("font-style").valueOrDefault(t.Font.Parse(t.ctx.font).fontStyle),s=this.getText();n.isRTL&&(s=s.split("").reverse().join(""));var o=t.ToNumberArray(this.parent.attribute("dx").value);for(var u=0;u<s.length;u++){var a=this.getGlyph(n,s,u),f=r/n.fontFace.unitsPerEm;e.translate(this.x,this.y),e.scale(f,-f);var l=e.lineWidth;e.lineWidth=e.lineWidth*n.fontFace.unitsPerEm/r,i=="italic"&&e.transform(1,0,.4,1,0,0),a.render(e),i=="italic"&&e.transform(1,0,-0.4,1,0,0),e.lineWidth=l,e.scale(1/f,-1/f),e.translate(-this.x,-this.y),this.x+=r*(a.horizAdvX||n.horizAdvX)/n.fontFace.unitsPerEm,typeof o[u]!="undefined"&&!isNaN(o[u])&&(this.x+=o[u])}return}e.fillStyle!=""&&e.fillText(t.compressSpaces(this.getText()),this.x,this.y),e.strokeStyle!=""&&e.strokeText(t.compressSpaces(this.getText()),this.x,this.y)},this.getText=function(){},this.measureTextRecursive=function(e){var t=this.measureText(e);for(var n=0;n<this.children.length;n++)t+=this.children[n].measureTextRecursive(e);return t},this.measureText=function(e){var n=this.parent.style("font-family").getDefinition();if(n!=null){var r=this.parent.style("font-size").numValueOrDefault(t.Font.Parse(t.ctx.font).fontSize),i=0,s=this.getText();n.isRTL&&(s=s.split("").reverse().join(""));var o=t.ToNumberArray(this.parent.attribute("dx").value);for(var u=0;u<s.length;u++){var a=this.getGlyph(n,s,u);i+=(a.horizAdvX||n.horizAdvX)*r/n.fontFace.unitsPerEm,typeof o[u]!="undefined"&&!isNaN(o[u])&&(i+=o[u])}return i}var f=t.compressSpaces(this.getText());if(!e.measureText)return f.length*10;e.save(),this.setContext(e);var l=e.measureText(f).width;return e.restore(),l}},t.Element.TextElementBase.prototype=new t.Element.RenderedElementBase,t.Element.tspan=function(e){this.captureTextNodes=!0,this.base=t.Element.TextElementBase,this.base(e),this.text=e.nodeValue||e.text||"",this.getText=function(){return this.text}},t.Element.tspan.prototype=new t.Element.TextElementBase,t.Element.tref=function(e){this.base=t.Element.TextElementBase,this.base(e),this.getText=function(){var e=this.getHrefAttribute().getDefinition();if(e!=null)return e.children[0].getText()}},t.Element.tref.prototype=new t.Element.TextElementBase,t.Element.a=function(e){this.base=t.Element.TextElementBase,this.base(e),this.hasText=!0;for(var n=0;n<e.childNodes.length;n++)e.childNodes[n].nodeType!=3&&(this.hasText=!1);this.text=this.hasText?e.childNodes[0].nodeValue:"",this.getText=function(){return this.text},this.baseRenderChildren=this.renderChildren,this.renderChildren=function(e){if(this.hasText)this.baseRenderChildren(e);else{var n=new t.Element.g;n.children=this.children,n.parent=this,n.render(e)}},this.onclick=function(){window.open(this.getHrefAttribute().value)},this.onmousemove=function(){t.ctx.canvas.style.cursor="pointer"}},t.Element.a.prototype=new t.Element.TextElementBase,t.Element.image=function(e){this.base=t.Element.RenderedElementBase,this.base(e);var n=this.getHrefAttribute().value;t.Images.push(this),this.loaded=!1,this.img=document.createElement("img");var r=this;this.img.onerror=this.img.onload=function(){r.loaded=!0,t.onImageLoaded()},this.img.src=n,this.renderChildren=function(e){var n=this.attribute("x").toPixels("x"),r=this.attribute("y").toPixels("y"),i=this.attribute("width").toPixels("x"),s=this.attribute("height").toPixels("y");if(i==0||s==0)return;e.save(),e.translate(n,r),t.AspectRatio(e,this.attribute("preserveAspectRatio").value,i,this.img.width,s,this.img.height,0,0),e.drawImage(this.img,0,0),e.restore()},this.getBoundingBox=function(){var e=this.attribute("x").toPixels("x"),n=this.attribute("y").toPixels("y"),r=this.attribute("width").toPixels("x"),i=this.attribute("height").toPixels("y");return new t.BoundingBox(e,n,e+r,n+i)}},t.Element.image.prototype=new t.Element.RenderedElementBase,t.Element.g=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.getBoundingBox=function(){var e=new t.BoundingBox;for(var n=0;n<this.children.length;n++)e.addBoundingBox(this.children[n].getBoundingBox());return e}},t.Element.g.prototype=new t.Element.RenderedElementBase,t.Element.symbol=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e);if(this.attribute("viewBox").hasValue()){var n=t.ToNumberArray(this.attribute("viewBox").value),r=n[0],i=n[1];width=n[2],height=n[3],t.AspectRatio(e,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,r,i),t.ViewPort.SetCurrent(n[2],n[3])}}},t.Element.symbol.prototype=new t.Element.RenderedElementBase,t.Element.style=function(e){this.base=t.Element.ElementBase,this.base(e);var n="";for(var r=0;r<e.childNodes.length;r++)n+=e.childNodes[r].nodeValue;n=n.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,""),n=t.compressSpaces(n);var i=n.split("}");for(var r=0;r<i.length;r++)if(t.trim(i[r])!=""){var s=i[r].split("{"),o=s[0].split(","),u=s[1].split(";");for(var a=0;a<o.length;a++){var f=t.trim(o[a]);if(f!=""){var l={};for(var c=0;c<u.length;c++){var h=u[c].indexOf(":"),p=u[c].substr(0,h),d=u[c].substr(h+1,u[c].length-h);p!=null&&d!=null&&(l[t.trim(p)]=new t.Property(t.trim(p),t.trim(d)))}t.Styles[f]=l}}}},t.Element.style.prototype=new t.Element.ElementBase,t.Element.use=function(e){this.base=t.Element.RenderedElementBase,this.base(e),this.baseSetContext=this.setContext,this.setContext=function(e){this.baseSetContext(e),this.attribute("x").hasValue()&&e.translate(this.attribute("x").toPixels("x"),0),this.attribute("y").hasValue()&&e.translate(0,this.attribute("y").toPixels("y"))},this.getDefinition=function(){var e=this.getHrefAttribute().getDefinition();return this.attribute("width").hasValue()&&(e.attribute("width",!0).value=this.attribute("width").value),this.attribute("height").hasValue()&&(e.attribute("height",!0).value=this.attribute("height").value),e},this.path=function(e){var t=this.getDefinition();t!=null&&t.path(e)},this.getBoundingBox=function(){var e=this.getDefinition();if(e!=null)return e.getBoundingBox()},this.renderChildren=function(e){var t=this.getDefinition();if(t!=null){var n=t.parent;t.parent=null,t.render(e),t.parent=n}}},t.Element.use.prototype=new t.Element.RenderedElementBase,t.Element.mask=function(e){this.base=t.Element.ElementBase,this.base(e),this.apply=function(e,n){var r=this.attribute("x").toPixels("x"),i=this.attribute("y").toPixels("y"),s=this.attribute("width").toPixels("x"),o=this.attribute("height").toPixels("y");if(s==0&&o==0){var u=new t.BoundingBox;for(var a=0;a<this.children.length;a++)u.addBoundingBox(this.children[a].getBoundingBox());var r=Math.floor(u.x1),i=Math.floor(u.y1),s=Math.floor(u.width()),o=Math.floor(u.height())}var f=n.attribute("mask").value;n.attribute("mask").value="";var l=document.createElement("canvas");l.width=r+s,l.height=i+o;var c=l.getContext("2d");this.renderChildren(c);var h=document.createElement("canvas");h.width=r+s,h.height=i+o;var p=h.getContext("2d");n.render(p),p.globalCompositeOperation="destination-in",p.fillStyle=c.createPattern(l,"no-repeat"),p.fillRect(0,0,r+s,i+o),e.fillStyle=p.createPattern(h,"no-repeat"),e.fillRect(0,0,r+s,i+o),n.attribute("mask").value=f},this.render=function(e){}},t.Element.mask.prototype=new t.Element.ElementBase,t.Element.clipPath=function(e){this.base=t.Element.ElementBase,this.base(e),this.apply=function(e){for(var n=0;n<this.children.length;n++){var r=this.children[n];if(typeof r.path!="undefined"){var i=null;r.attribute("transform").hasValue()&&(i=new t.Transform(r.attribute("transform").value),i.apply(e)),r.path(e),e.clip(),i&&i.unapply(e)}}},this.render=function(e){}},t.Element.clipPath.prototype=new t.Element.ElementBase,t.Element.filter=function(e){this.base=t.Element.ElementBase,this.base(e),this.apply=function(e,t){var n=t.getBoundingBox(),r=Math.floor(n.x1),i=Math.floor(n.y1),s=Math.floor(n.width()),o=Math.floor(n.height()),u=t.style("filter").value;t.style("filter").value="";var a=0,f=0;for(var l=0;l<this.children.length;l++){var c=this.children[l].extraFilterDistance||0;a=Math.max(a,c),f=Math.max(f,c)}var h=document.createElement("canvas");h.width=s+2*a,h.height=o+2*f;var p=h.getContext("2d");p.translate(-r+a,-i+f),t.render(p);for(var l=0;l<this.children.length;l++)this.children[l].apply(p,0,0,s+2*a,o+2*f);e.drawImage(h,0,0,s+2*a,o+2*f,r-a,i-f,s+2*a,o+2*f),t.style("filter",!0).value=u},this.render=function(e){}},t.Element.filter.prototype=new t.Element.ElementBase,t.Element.feMorphology=function(e){this.base=t.Element.ElementBase,this.base(e),this.apply=function(e,t,n,r,i){}},t.Element.feMorphology.prototype=new t.Element.ElementBase,t.Element.feColorMatrix=function(e){function n(e,t,n,r,i,s){return e[n*r*4+t*4+s]}function r(e,t,n,r,i,s,o){e[n*r*4+t*4+s]=o}this.base=t.Element.ElementBase,this.base(e),this.apply=function(e,t,i,s,o){var u=e.getImageData(0,0,s,o);for(var i=0;i<o;i++)for(var t=0;t<s;t++){var a=n(u.data,t,i,s,o,0),f=n(u.data,t,i,s,o,1),l=n(u.data,t,i,s,o,2),c=(a+f+l)/3;r(u.data,t,i,s,o,0,c),r(u.data,t,i,s,o,1,c),r(u.data,t,i,s,o,2,c)}e.clearRect(0,0,s,o),e.putImageData(u,0,0)}},t.Element.feColorMatrix.prototype=new t.Element.ElementBase,t.Element.feGaussianBlur=function(e){this.base=t.Element.ElementBase,this.base(e),this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue()),this.extraFilterDistance=this.blurRadius,this.apply=function(e,n,r,i,s){if(typeof stackBlurCanvasRGBA=="undefined"){console&&console.warn&&console.warn("ERROR: StackBlur.js must be included for blur to work");return}e.canvas.id=t.UniqueId(),e.canvas.style.display="none",document.body.appendChild(e.canvas),stackBlurCanvasRGBA(e.canvas.id,n,r,i,s,this.blurRadius),document.body.removeChild(e.canvas)}},t.Element.feGaussianBlur.prototype=new t.Element.ElementBase,t.Element.title=function(e){},t.Element.title.prototype=new t.Element.ElementBase,t.Element.desc=function(e){},t.Element.desc.prototype=new t.Element.ElementBase,t.Element.MISSING=function(e){},t.Element.MISSING.prototype=new t.Element.ElementBase,t.CreateElement=function(e){var n=e.nodeName.replace(/^[^:]+:/,"");n=n.replace(/\-/g,"");var r=null;return typeof t.Element[n]!="undefined"?r=new t.Element[n](e):r=new t.Element.MISSING(e),r.type=e.nodeName,r},t.loadXml=function(e,n){t.loadXmlDoc(e,t.parseXml(n))},t.loadXmlDoc=function(e,n){t.init(e);var r=t.CreateElement(n.documentElement);r.root=!0;var i=!0,s=function(){t.ViewPort.Clear();var n=e.canvas.clientWidth||e.canvas.width,i=e.canvas.clientHeight||e.canvas.height;t.ViewPort.SetCurrent(n,i);if(t.opts["scaleWidth"]!=null&&t.opts["scaleHeight"]!=null){var s=1,o=1,u=t.ToNumberArray(r.attribute("viewBox").value);r.attribute("width").hasValue()?s=r.attribute("width").toPixels("x")/t.opts.scaleWidth:isNaN(u[2])||(s=u[2]/t.opts.scaleWidth),r.attribute("height").hasValue()?o=r.attribute("height").toPixels("y")/t.opts.scaleHeight:isNaN(u[3])||(o=u[3]/t.opts.scaleHeight),r.attribute("width",!0).value=t.opts.scaleWidth,r.attribute("height",!0).value=t.opts.scaleHeight,r.attribute("viewBox",!0).value="0 0 "+n*s+" "+i*o,r.attribute("preserveAspectRatio",!0).value="none"}t.opts.beforeRender&&t.opts.beforeRender(e),r.render(e),t.opts.afterRender&&t.opts.afterRender()};t.imageLoadedCount=0,t.checkImageID=null,t.Images.length?t.onImageLoaded=function(){++t.imageLoadedCount,t.checkImageID&&(clearTimeout(t.checkImageID),t.checkImageID=null),t.imageLoadedCount>=t.Images.length?s():t.checkImageID=setTimeout(s,800)}:(t.onImageLoaded=function(){},s())},t}window.canvg=function(e,n,r){if(!e)return;r=r||{},typeof e=="string"&&(e=document.getElementById(e));var i=t();if(e.childNodes.length!=1||e.childNodes[0].nodeName!="OBJECT")e.svg=i;i.opts=r,i.loadXml(e.getContext("2d"),n)}}),define("UI.sortable",["jquery"],function(e){var t,n=e();e.fn.sortable=function(r){var i=String(r);return r=e.extend({connectWith:!1},r),this.each(function(){if(/^enable|disable|destroy$/.test(i)){var s=e(this).children(e(this).data("items")).attr("draggable",i=="enable");i=="destroy"&&s.add(this).removeData("connectWith items").off("dragstart.h5s dragend.h5s selectstart.h5s dragover.h5s dragenter.h5s drop.h5s");return}var o,u,s=e(this).children(r.items),a=e("<"+(/^ul|ol$/i.test(this.tagName)?"li":"div")+' class="sortable-placeholder">');s.find(r.handle).mousedown(function(){o=!0}).mouseup(function(){o=!1}),e(this).data("items",r.items),n=n.add(a),r.connectWith&&e(r.connectWith).add(this).data("connectWith",r.connectWith),s.attr("draggable","true").on("dragstart.h5s",function(n){if(r.handle&&!o)return!1;o=!1;var i=n.originalEvent.dataTransfer;i.effectAllowed="move",i.setData("Text","dummy"),u=(t=e(this)).addClass("sortable-dragging").index()}).on("dragend.h5s",function(){if(!t)return;t.removeClass("sortable-dragging").show(),n.detach(),u!=t.index()&&t.parent().trigger("sortupdate",{item:t}),t=null}).not("a[href], img").on("selectstart.h5s",function(){return this.dragDrop&&this.dragDrop(),!1}).end().add([this,a]).on("dragover.h5s dragenter.h5s drop.h5s",function(i){return!s.is(t)&&r.connectWith!==e(t).parent().data("connectWith")?!0:i.type=="drop"?(i.stopPropagation(),n.filter(":visible").after(t),t.trigger("dragend.h5s"),!1):(i.preventDefault(),i.originalEvent.dataTransfer.dropEffect="move",s.is(this)?(r.forcePlaceholderSize&&a.height(t.outerHeight()),t.hide(),e(this)[a.index()<e(this).index()?"after":"before"](a),n.not(a).detach()):!n.is(this)&&!e(this).children(r.items).length&&(n.detach(),e(this).append(a)),!1)})})}}),define("UI.parsley",["jquery"],function(){!function(e){var t={runOnceInSametime:function(e,t){var n=0;return function(){n++,t=t||this;var r=arguments;setTimeout(function(){n--;if(n>0)return;e.apply(t,r)},50)}},getCaretPosition:function(e){var t=0;if(document.selection){e.focus();var n=document.selection.createRange();n.moveStart("character",-e.value.length),t=n.text.length}else if(e.selectionStart||e.selectionStart=="0")t=e.selectionStart;return t},setCaretPosition:function(t,n){t instanceof e&&(t=t.get(0));if(t!=null)if(t.createTextRange){var r=t.createTextRange();r.move("character",n),r.select()}else t.selectionStart?(t.focus(),t.setSelectionRange(n,n)):t.focus()},prefixMatch:function(e,t,n){n=n||"";var r=e.slice(0,1)==="^"?1:0,i=e.slice(-1)==="$"?"":"$";for(var s=r;s<=e.length;s++){var o=e.slice(0,s);try{var u=(new RegExp(o+i,n)).test(t)}catch(a){continue}if(u)return!0}return!1},getCharFromKeyEvent:function(t){var n,r,i=t.which,s=t.shiftKey,o=t.ctrlKey||t.metaKey,u=i>=65&&i<=90,a=i>=48&&i<=57,f=i>=96&&i<=105,l=[8,9,13,16,19,20,27,33,34,35,36,37,38,39,40,45,46,112,113,114,115,116,117,118,119,120,121,122,123,144,145],c=["BackSpace","Tab","Enter","Shift","Pause","CapsLock","Escape","PageUp","PageDown","End","Move","Left","Up","Right","Down","Insert","Delete","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","NumsLock","Home"],h={192:"~",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",48:")",189:"_",187:"+",219:"{",221:"}",220:"|",186:":",222:'"',188:"<",190:">",191:"?"},p={106:"*",107:"+",108:"Enter",109:"-",110:".",111:"/",192:"`",189:"-",187:"=",219:"[",221:"]",220:"\\",186:";",222:"'",188:",",190:".",191:"/",32:" "};if(u)o?n="ctrlFunc":n=String.fromCharCode(i);else if(a&&!s)n=String.fromCharCode(i);else if(f)n=String.fromCharCode(i-48);else if(e.inArray(i,l)!==-1){var d=e.inArray(i,l);n=c[d]}else s?n=h[i]:i in p&&(n=p[i]);return n}};!function(e,t){var n=function(e){this.messages={defaultMessage:"This value seems to be invalid.",type:{email:"This value should be a valid email.",url:"This value should be a valid url.",urlstrict:"This value should be a valid url.",number:"This value should be a valid number.",digits:"This value should be digits.",dateIso:"This value should be a valid date (YYYY-MM-DD).",alphanum:"This value should be alphanumeric.",phone:"This value should be a valid phone number.",usPhone:"This value should be a valid US phone number.",ipaddress:"This value should be a valid ip address.",ipv4:"This value should be a valid IPv4 address.",cidr:"This value should be a valid CIDR.",awsCidr:"This value should be a valid CIDR and the netmask ('16') must be between 16 and 28.",awsName:"This value should be a valid AWS name.",domain:"This value should be a valid domain.",ascii:"This value should be a valid ascii."},notnull:"This value should not be null.",notblank:"This value should not be blank.",required:"This value is required.",regexp:"This value seems to be invalid.",min:"This value should be greater than or equal to %s.",max:"This value should be lower than or equal to %s.",range:"This value should be between %s and %s.",minlength:"This value is too short. It should have %s characters or more.",maxlength:"This value is too long. It should have %s characters or less.",rangelength:"This value length is invalid. It should be between %s and %s characters long.",mincheck:"You must select at least %s choices.",maxcheck:"You must select %s choices or less.",rangecheck:"You must select between %s and %s choices.",equalto:"This value should be the same."},this.init(e)};n.prototype={constructor:n,validators:{notnull:function(e){return e.length>0},notblank:function(e){return"string"==typeof e&&""!==e.replace(/^\s+/g,"").replace(/\s+$/g,"")},required:function(e){if("object"==typeof e){for(var t in e)if(this.required(e[t]))return!0;return!1}return this.notnull(e)&&this.notblank(e)},custom:function(e,t,n){var r,i,s;return r=t.thisArg||window,s=t.validator.call(r,e),s?(n.Validator.addMessage("custom",s),!1):!0},type:function(e,t){var n;switch(t){case"number":n=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/;break;case"digits":n=/^\d+$/;break;case"alphanum":n=/^\w+$/;break;case"email":n=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i;break;case"url":e=(new RegExp("(https?|s?ftp|git)","i")).test(e)?e:"http://"+e;case"urlstrict":n=/^(https?|s?ftp|git):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i;break;case"dateIso":n=/^(\d{4})\D?(0[1-9]|1[0-2])\D?([12]\d|0[1-9]|3[01])$/;break;case"phone":n=/^((\+\d{1,3}(-| )?\(?\d\)?(-| )?\d{1,5})|(\(?\d{2,6}\)?))(-| )?(\d{3,4})(-| )?(\d{4})(( x| ext)\d{1,5}){0,1}$/;break;case"ipaddress":n=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(\d|[1-2]\d|3[0-2]))?$/;break;case"ipv4":n=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;break;case"cidr":n=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(\d|[1-2]\d|3[0-2]))$/;break;case"awsCidr":n=/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/([1][6789]|[2]\d|3[0-2]))$/;break;case"awsName":n=/^[a-zA-Z0-9][a-zA-Z0-9-]*$/;break;case"domain":n=/^([a-zA-Z0-9-\u4e00-\u9fa5]+\.)+([a-zA-Z-\u4e00-\u9fa5]+)$/;break;case"ascii":n=/^[\x00-\x7F]+$/;break;case"usPhone":n=/^(?:(?:\+?1\s*(?:[.-]\s*)?)?(?:\(\s*([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9])\s*\)|([2-9]1[02-9]|[2-9][02-8]1|[2-9][02-8][02-9]))\s*(?:[.-]\s*)?)?([2-9]1[02-9]|[2-9][02-9]1|[2-9][02-9]{2})\s*(?:[.-]\s*)?([0-9]{4})(?:\s*(?:#|x\.?|ext\.?|extension)\s*(\d+))?$/;break;default:return!1}return""!==e?n.test(e):!1},regexp:function(e,t,n){return(new RegExp(t,n.options.regexpFlag||"")).test(e)},minlength:function(e,t){return e.length>=t},maxlength:function(e,t){return e.length<=t},rangelength:function(e,t){return this.minlength(e,t[0])&&this.maxlength(e,t[1])},min:function(e,t){return Number(e)>=t},max:function(e,t){return Number(e)<=t},range:function(e,t){return e>=t[0]&&e<=t[1]},equalto:function(t,n,r){return r.options.validateIfUnchanged=!0,t===e(n).val()},remote:function(t,n,r){var i=null,s={},o={};s[r.$element.attr("name")]=t,"undefined"!=typeof r.options.remoteDatatype&&(o={dataType:r.options.remoteDatatype});var u=function(t,n){"undefined"!=typeof n&&"undefined"!=typeof r.Validator.messages.remote&&n!==r.Validator.messages.remote&&e(r.ulError+" .remote").remove(),r.updtConstraint({name:"remote",valid:t},n),r.manageValidationResult()},a=function(t){if("object"==typeof t)return t;try{t=e.parseJSON(t)}catch(n){}return t},f=function(e){return"object"==typeof e&&null!==e?"undefined"!=typeof e.error?e.error:"undefined"!=typeof e.message?e.message:null:null};return e.ajax(e.extend({},{url:n,data:s,type:r.options.remoteMethod||"GET",success:function(e){e=a(e),u(1===e||!0===e||"object"==typeof e&&null!==e&&"undefined"!=typeof e.success,f(e))},error:function(e){e=a(e),u(!1,f(e))}},o)),i},mincheck:function(e,t){return this.minlength(e,t)},maxcheck:function(e,t){return this.maxlength(e,t)},rangecheck:function(e,t){return this.rangelength(e,t)}},init:function(e){var t=e.validators,n=e.messages,r;for(r in t)this.addValidator(r,t[r]);for(r in n)this.addMessage(r,n[r])},formatMesssage:function(e,t){if("object"==typeof t){for(var n in t)e=this.formatMesssage(e,t[n]);return e}return"string"==typeof e?e.replace(new RegExp("%s","i"),t):""},addValidator:function(e,t){this.validators[e]=t},addMessage:function(e,t,n){if("undefined"!=typeof n&&!0===n){this.messages.type[e]=t;return}if("type"===e){for(var r in t)this.messages.type[r]=t[r];return}this.messages[e]=t}};var r=function(e,t,r){this.options=t,this.Validator=new n(t);if(r==="ParsleyFieldMultiple")return this;this.init(e,r||"ParsleyField")};r.prototype={constructor:r,init:function(n,r){this.type=r,this.valid=!0,this.element=n,this.validatedOnce=!1,this.$element=e(n),this.val=this.$element.val(),this.isRequired=!1,this.isRequiredRollback=!1,this.constraints={},"undefined"==typeof this.isRadioOrCheckbox&&(this.isRadioOrCheckbox=!1,this.hash=this.generateHash(),this.errorClassHandler=this.options.errors.classHandler(n,this.isRadioOrCheckbox)||this.$element),this.ulErrorManagement(),this.bindHtml5Constraints(),this.addConstraints();if(this.hasConstraints()){this.bindValidationEvents();var i=this.Validator.validators.required(this.val)}var s=this;this.$element.data("required-rollback")===!0&&(this.isRequiredRollback=!0,this.$element.on("focus",function(){e(this).data("pre-value",e(this).val())}).on("blur",function(){var t=s.Validator.validators.required(e(this).val());t||(e(this).val(e(this).data("pre-value")),e(this).parsley("validate"))}));var s=this,o=[8,9,13,16,19,20,27,33,34,35,36,37,38,39,40,45,46,112,113,114,115,116,117,118,119,120,121,122,123,144,145];if(this.$element.data("ignore")===!0){var u,a,f;a={cidr:"^[0-9]?$|^[0-9][0-9./]+$",awsCidr:"^[0-9]?$|^[0-9][0-9./]+$",ipv4:"^[0-9]*$|^[0-9][0-9.]+$",ipaddress:"^[0-9]*$|^[0-9][0-9./]+$",domain:"^[a-zA-Z0-9]+[a-zA-Z0-9.-]*$",digits:"^[0-9]*$",ascii:"^[\0-]*$",number:"^-?[0-9]*$|^-?[0-9]+\\.[0-9]*$"},f=this.options.type,u=u||this.$element.data("ignore-regexp")||a[f]||"^[0-9a-zA-Z]+[0-9a-zA-Z-]*$";var l=[["。","."],["、","/"]],c=this.options.regexp,h=function(t,n,r){var i=function(e){return s.Validator.validators.regexp(e,u,s)};return function(s){if((r-=1)<0)return;var o=e(n).val();if(o==="")return;var u=i(o);u||e(n).val(t).parsley("validate")}};this.$element.on("drop paste",function(t){var n=e(this).val(),r=h(n,this,1);setTimeout(r,1)});var p=function(t){if(t.which===229){var n=e(this).val(),r=h(n,this,1);return e(this).one("keyup",r),!1}},d=function(e){for(var t=0;t<l.length;t++)if(l[t][0]===e)return l[t][1]},v=function(e){var n,r;if(e.which in o)return!0;n=String.fromCharCode(e.which);var i=d(n);i&&(n=i);var s=this.value.split(""),a=t.getCaretPosition(this);s.splice(a,0,n);var f=s.join("");r=(new RegExp(u,"i")).test(f);if(!r)return!1;if(i)return this.value=f,t.setCaretPosition(this,a+1),!1};this.$element.on("keypress",v),this.$element.on("keydown",p)}},setParent:function(t){this.$parent=e(t)},getParent:function(){return this.$parent},bindHtml5Constraints:function(){if(this.$element.hasClass("required")||this.$element.prop("required"))this.options.required=!0;"undefined"!=typeof this.$element.attr("type")&&(new RegExp(this.$element.attr("type"),"i")).test("email url number range")&&(this.options.type=this.$element.attr("type"),(new RegExp(this.options.type,"i")).test("number range")&&(this.options.type="number","undefined"!=typeof this.$element.attr("min")&&this.$element.attr("min").length&&(this.options.min=this.$element.attr("min")),"undefined"!=typeof this.$element.attr("max")&&this.$element.attr("max").length&&(this.options.max=this.$element.attr("max")))),"string"==typeof this.$element.attr("pattern")&&this.$element.attr("pattern").length&&(this.options.regexp=this.$element.attr("pattern"))},addConstraints:function(){for(var e in this.options){var t={};t[e]=this.options[e],this.addConstraint(t,!0)}},addConstraint:function(e,t){for(var n in e)n=n.toLowerCase(),"function"==typeof this.Validator.validators[n]&&(this.constraints[n]={name:n,requirements:e[n],valid:null},n==="required"&&(this.isRequired=!0),this.addCustomConstraintMessage(n));"undefined"==typeof t&&this.bindValidationEvents()},updateConstraint:function(e,t){for(var n in e)this.updtConstraint({name:n,requirements:e[n],valid:null},t)},updtConstraint:function(t,n){this.constraints[t.name]=e.extend(!0,this.constraints[t.name],t),"string"==typeof n&&(this.Validator.messages[t.name]=n),this.bindValidationEvents()},removeConstraint:function(e){var e=e.toLowerCase();delete this.constraints[e],e==="required"&&(this.isRequired=!1);if(!this.hasConstraints()){if("ParsleyForm"==typeof this.getParent()){this.getParent().removeItem(this.$element);return}this.destroy();return}this.bindValidationEvents()},addCustomConstraintMessage:function(e){var t=e+("type"===e&&"undefined"!=typeof this.options[e]?this.options[e].charAt(0).toUpperCase()+this.options[e].substr(1):"")+"Message";"undefined"!=typeof this.options[t]&&this.Validator.addMessage("type"===e?this.options[e]:e,this.options[t],"type"===e)},bindValidationEvents:function(){this.valid=null,this.$element.addClass("parsley-validated"),this.$element.off("."+this.type),this.options.remote&&!(new RegExp("change","i")).test(this.options.trigger)&&(this.options.trigger=this.options.trigger?" change":"change");var t=(this.options.trigger?this.options.trigger:"")+((new RegExp("key","i")).test(this.options.trigger)?"":" keyup");this.$element.is("select")&&(t+=(new RegExp("change","i")).test(t)?"":" change"),t=t.replace(/^\s+/g,"").replace(/\s+$/g,""),this.$element.on((t+" ").split(" ").join("."+this.type+" "),!1,e.proxy(this.eventValidation,this))},generateHash:function(){return"parsley-"+(Math.random()+"").substring(2)},getHash:function(){return this.hash},getVal:function(){return this.$element.data("value")||this.$element.val()},eventValidation:function(t){var n=this.getVal();if(t.type==="keyup"&&!/keyup/i.test(this.options.trigger)&&!this.validatedOnce)return!0;if(t.type==="change"&&!/change/i.test(this.options.trigger)&&!this.validatedOnce)return!0;if(!this.isRadioOrCheckbox&&n.length<this.options.validationMinlength&&!this.validatedOnce)return!0;var r=this.validate(),i=e(t.currentTarget);!r&&t.type==="focusout"&&i.data("focus-back")===!0&&i.focus()},isValid:function(){return this.validate(!1)},hasConstraints:function(){for(var e in this.constraints)return!0;return!1},validate:function(e){var t=this.getVal(),n=null;return!this.hasConstraints()&&!this.isRequiredRollback?!0:this.options.listeners.onFieldValidate(this.element,this)||""===t&&!this.isRequired&&!this.isRequiredRollback?(this.reset(),!0):this.needsValidation(t)?(n=this.applyValidators(),("undefined"!=typeof e?e:this.options.showErrors)&&this.manageValidationResult(),n===null&&(n=!0),n&&this.isRequiredRollback&&(n=this.Validator.validators.required(t)),n):this.valid},validateForm:function(){var e=this.getParent();e?e=e[0]:(e=this.$element.closest("form, [data-bind=true]"),e=e.parsley());for(var t in e.items){var n=e.items[t];n.options.validateIfUnchanged=!0}return e.validate()},needsValidation:function(e){return!this.options.validateIfUnchanged&&this.valid!==null&&this.val===e&&this.validatedOnce?!1:(this.val=e,this.validatedOnce=!0)},applyValidators:function(){var e=null;for(var t in this.constraints){var n=this.Validator.validators[this.constraints[t].name](this.val,this.constraints[t].requirements,this);!1===n?(e=!1,this.constraints[t].valid=e,this.options.listeners.onFieldError(this.element,this.constraints,this)):!0===n&&(this.constraints[t].valid=!0,e=!1!==e,this.options.listeners.onFieldSuccess(this.element,this.constraints,this))}return e},manageValidationResult:function(){var e=null;for(var t in this.constraints)!1===this.constraints[t].valid?(this.manageError(this.constraints[t]),e=!1):!0===this.constraints[t].valid&&(this.removeError(this.constraints[t].name),e=!1!==e);return this.valid=e,!0===this.valid?(this.removeErrors(),this.errorClassHandler.removeClass(this.options.errorClass).addClass(this.options.successClass),errortip.purge(this.hash),!0):!1===this.valid?(this.errorClassHandler.removeClass(this.options.successClass).addClass(this.options.errorClass),errortip.first(this.element),!1):e},showError:function(e){e&&(this.options.errorMessage=e),this.manageError({})},hideError:function(){this.removeErrors(),this.errorClassHandler.removeClass(this.options.errorClass).addClass(this.options.successClass)},custom:function(e){var t,n,r;typeof e=="function"?t=e:(t=e.validator,n=e.now,r=e.thisArg);var i={};i.custom={validator:t,thisArg:r},this.addConstraint(i,!0),this.bindValidationEvents(),n&&this.validate()},ulErrorManagement:function(){this.ulError="#"+this.hash,this.ulTemplate=e(this.options.errors.errorsWrapper).attr("id",this.hash).addClass("parsley-error-list")},removeError:function(t){var n=this.ulError+" ."+t,r=this;this.options.animate?e(n).fadeOut(this.options.animateDuration,function(){e(this).remove(),r.ulError&&e(r.ulError).children().length===0&&r.removeErrors()}):e(n).remove(),this.ulError&&e(this.ulError).children().length===0&&this.removeErrors()},addError:function(t){for(var n in t){var r=e(this.options.errors.errorElem).addClass(n);e(this.ulError).append(this.options.animate?e(r).html(t[n]).hide().fadeIn(this.options.animateDuration):e(r).html(t[n]))}},removeErrors:function(){this.options.animate?e(this.ulError).fadeOut(this.options.animateDuration,function(){e(this).remove()}):e(this.ulError).remove()},reset:function(){this.valid=null,this.removeErrors(),this.validatedOnce=!1,this.errorClassHandler.removeClass(this.options.successClass).removeClass(this.options.errorClass);for(var e in this.constraints)this.constraints[e].valid=null;return this},manageError:function(t){e(this.ulError).length||this.manageErrorContainer(),this.ulTemplate.data("uid",(Math.random()+"").substring(2)+e.now());if("required"===t.name&&null!==this.getVal()&&this.getVal().length>0)return;if(!(!this.isRequired||"required"===t.name||null!==this.getVal()&&0!==this.getVal().length))return;var n=t.name,r=!1!==this.options.errorMessage?"custom-error-message":n,i={},s=!1!==this.options.errorMessage?this.options.errorMessage:t.name==="type"?this.Validator.messages[n][t.requirements]:"undefined"==typeof this.Validator.messages[n]?this.Validator.messages.defaultMessage:this.Validator.formatMesssage(this.Validator.messages[n],t.requirements);e(this.ulError+" ."+r).length?r==="custom"&&e(this.ulError+" ."+r).text(s):(i[r]=s,this.addError(i))},manageErrorContainer:function(){var t=this.options.errorContainer||this.options.errors.container(this.element,this.isRadioOrCheckbox),n=this.options.animate?this.ulTemplate.show():this.ulTemplate;if("undefined"!=typeof t){e(t).append(n);return}this.isRadioOrCheckbox?this.$element.parent().after(n):this.$element.after(n)},addListener:function(e){for(var t in e)this.options.listeners[t]=e[t]},destroy:function(){this.$element.removeClass("parsley-validated"),this.reset().$element.off("."+this.type).removeData(this.type)}};var i=function(e,t,r){this.initMultiple(e,t),this.inherit(e,t),this.Validator=new n(t),this.init(e,r||"ParsleyFieldMultiple")};i.prototype={constructor:i,initMultiple:function(t,n){this.element=t,this.$element=e(t),this.group=n.group||!1,this.hash=this.getName(),this.siblings=this.group?'[data-group="'+this.group+'"]':'input[name="'+this.$element.attr("name")+'"]',this.isRadioOrCheckbox=!0,this.isRadio=this.$element.is("input[type=radio]"),this.isCheckbox=this.$element.is("input[type=checkbox]"),this.errorClassHandler=n.errors.classHandler(t,this.isRadioOrCheckbox)||this.$element.parent()},inherit:function(e,t){var n=new r(e,t,"ParsleyFieldMultiple");for(var i in n)"undefined"==typeof this[i]&&(this[i]=n[i])},getName:function(){return this.group?"parsley-"+this.group:"undefined"==typeof this.$element.attr("name")?"parsley-"+(Math.random()+"").substring(2):"parsley-"+this.$element.attr("name").replace(/(:|\.|\[|\])/g,"")},getVal:function(){if(this.isRadio)return e(this.siblings+":checked").val()||"";if(this.isCheckbox){var t=[];return e(this.siblings+":checked").each(function(){t.push(e(this).val())}),t}},bindValidationEvents:function(){this.valid=null,this.$element.addClass("parsley-validated"),this.$element.off("."+this.type);var t=this,n=(this.options.trigger?this.options.trigger:"")+((new RegExp("change","i")).test(this.options.trigger)?"":" change");n=n.replace(/^\s+/g,"").replace(/\s+$/g,""),e(this.siblings).each(function(){e(this).on(n.split(" ").join("."+t.type+" "),!1,e.proxy(t.eventValidation,t))})}};var s=function(e,t,n){this.init(e,t,n||"parsleyForm")};s.prototype={constructor:s,init:function(t,n,r){this.type=r,this.items=[],this.$element=e(t),this.options=n;var i=this;this.$element.find(n.inputs).each(function(){i.addItem(this)}),this.$element.on("submit."+this.type,!1,e.proxy(this.validate,this)),this.$element.addClass("parsley-validated")},addListener:function(e){for(var t in e)if((new RegExp("Field")).test(t))for(var n=0;n<this.items.length;n++)this.items[n].addListener(e);else this.options.listeners[t]=e[t]},addItem:function(t){if(e(t).is(this.options.excluded))return!1;var n=e(t).parsley(this.options);n.setParent(this),this.items.push(n)},removeItem:function(t){var n=e(t).parsley();for(var r=0;r<this.items.length;r++)if(this.items[r].hash===n.hash)return this.items[r].destroy(),this.items.splice(r,1),!0;return!1},validate:function(e){var t=!0;this.focusedField=!1;for(var n=0;n<this.items.length;n++){if(this.items[n].$element.is(":hidden"))continue;if("undefined"!=typeof this.items[n]&&!1===this.items[n].validate()){t=!1;if(!this.focusedField&&"first"===this.options.focus||"last"===this.options.focus)this.focusedField=this.items[n].$element}}return this.focusedField&&!t&&this.focusedField.focus(),this.options.listeners.onFormSubmit(t,e,this),t},isValid:function(){for(var e=0;e<this.items.length;e++)if(!1===this.items[e].isValid())return!1;return!0},removeErrors:function(){for(var e=0;e<this.items.length;e++)this.items[e].parsley("reset")},destroy:function(){for(var e=0;e<this.items.length;e++)this.items[e].destroy();this.$element.off("."+this.type).removeData(this.type)},reset:function(){for(var e=0;e<this.items.length;e++)this.items[e].reset()}},e.fn.parsley=function(t,n){function a(u,a){var f=e(u).data(a);if(!f){switch(a){case"parsleyForm":f=new s(u,o,"parsleyForm");break;case"parsleyField":f=new r(u,o,"parsleyField");break;case"parsleyFieldMultiple":f=new i(u,o,"parsleyFieldMultiple");break;default:return}e(u).data(a,f)}if("string"==typeof t&&"function"==typeof f[t]){var l=f[t](n);return"undefined"!=typeof l?l:e(u)}return f}var o=e.extend(!0,{},e.fn.parsley.defaults,"undefined"!=typeof window.ParsleyConfig?window.ParsleyConfig:{},t,this.data()),u=null;return e(this).is("form")||!0===e(this).data("bind")?u=a(e(this),"parsleyForm"):e(this).is(o.inputs)&&!e(this).is(o.excluded)&&(u=a(e(this),e(this).is("input[type=radio], input[type=checkbox]")?"parsleyFieldMultiple":"parsleyField")),t==="custom"?u:"function"==typeof n?n():u},e.fn.parsley.Constructor=s,e.fn.parsley.defaults={inputs:'input, textarea, select, [contenteditable="true"]',excluded:"input[type=hidden], input[type=file], :disabled",trigger:!1,animate:!1,animateDuration:300,focus:"first",validationMinlength:1,successClass:"parsley-success",errorClass:"parsley-error",errorMessage:!1,validators:{},showErrors:!0,messages:{},validateIfUnchanged:!0,errors:{classHandler:function(e,t){},container:function(e,t){},errorsWrapper:"<ul></ul>",errorElem:"<li></li>"},listeners:{onFieldValidate:function(e,t){return!1},onFormSubmit:function(e,t,n){},onFieldError:function(e,t,n){},onFieldSuccess:function(e,t,n){}}},e(window).on("load",function(){e('[data-validate="parsley"]').each(function(){e(this).parsley()})})}(window.jQuery||window.Zepto,t);var n="focus",r='form[data-validate="parsley"] input, [data-bind="true"] input, form[data-validate="parsley"] textarea, [data-bind="true"] textarea, [data-bind="true"]',i=function(t){return t=t instanceof e?t:e(t),t.hasClass("parsley-validated")},s=function(t){if(t.nodeName==="form"||!0===e(t).data("bind"))n=e(t);else var n=e(t).closest('form, [data-bind="true"]');return n},o=function(e,t){var n=e.data("parsleyForm");for(var r in n.items){var i=n.items[r];if(i.element.get(0)===t)return}n.addItem(t)},u=function(e){var t=s(this);if(!i(t))t.parsley();else{var n=t.find('input[type=text], input[type=radio], input[type=checkbox], [contenteditable="true"]');n.each(function(e){i(this)||o(t,this)})}},a=function(t){if(i(this))return;var n=s(this);n?i(n)?o(n,this):n.parsley({validationMinlength:1}):e(this).parsley({validationMinlength:1})},f=function(e){var t=s(this);t.parsley("validate")};e(document.body).on("submit",'form[data-validate="parsley"]',u),e(document.body).on("click",".parsley-submit",u),e(document.body).on("click",".parsley-submit",f),e(document.body).on(n,r,a)}(window.jQuery)}),define("UI.errortip",["jquery"],function(e){var t=function(t){var r=e(this),i=h(r),s,o,u,a,f,l;if(i.length){id=i.attr("id"),l="errortip-"+id,originTip=e("#"+l);if(originTip.length){originTip.html()!=i.html()&&(originTip.html(i.html()),originTip.show());return}errortip_box=i.clone(),errortip_box.addClass("errortip_box").attr("id",l).css("z-index",i.css("z-index")).appendTo(document.body),s=r.offset(),a=r.innerWidth(),f=r.innerHeight(),errortip_box.css({left:s.left,top:s.top+f+u-document.body.scrollTop+45>window.innerHeight?s.top-u-15+5:s.top+f+5,width:a-8-2}).show(),n[id]=setInterval(function(){i.closest("html").length===0&&b(i.attr("id"))},200)}},n={},r={},i=!1,s,o="parsley-error",u="parsley-error-list",a="<ul></ul>",f="<li></li>",l=function(t){return e(t).is("ul."+u)},c=function(){return"parsley-"+(Math.random()+"").substring(2)},h=function(e){return e.next(".parsley-error-list")},p=function(t){return $target=t instanceof e?t:e(t),h($target).attr("id")},d=function(t){var n;return t===Object(t)?n=p(t.currentTarget):n=t,e("#"+n).data("uid")},v=function(e){if(e)clearInterval(n[e]);else for(var e in n)clearInterval(n[e])},m=function(e){s=d(e),t.call(this,e)},g=function(e){s=!1,b.call(this,e)},y=function(n){if(e(n).is(":hidden"))return;t.call(n),id=p(n),r[id]=setTimeout(function(){b({currentTarget:n})},2e3)},b=function(t){var n,i,o=!1;if(t){var u="errortip-";t===Object(t)?n=h(e(t.currentTarget)).attr("id"):(o=!0,n=t),i=d(n),setTimeout(function(){(s!==i||o)&&e("#"+u+n).remove()},100)}else e(".errortip_box").remove();r[n]&&clearInterval(r[n]),v(n)},w={createError:function(t,n,r){r||(r=c());var i=e(a).attr("id",r).addClass(u).data("uid",(Math.random()+"").substring(2)+e.now()),s=e(f).html(t);i.append(s),e(n).after(i).addClass(o)},changeError:function(t,n){var r=h(e(n));r.find("li").text(t)},removeError:function(t){var n,r;Object.prototype.toString.call(t)==="[object String]"?(r=e("#"+t),n=r.prev()):(n=e(t),r=h(n)),n.removeClass(o),l(r)&&b(r.attr("id"))},hasError:function(t){return e(t).hasClass(o)}};t.first=y,t.purge=b,e.extend(t,w),window.errortip=t,e(document).ready(function(){e(document.body).on("mouseenter",".parsley-error",m),e(document.body).on("mouseleave",".parsley-error",g)})}),define("UI.tour",["jquery"],function(e){e.fn.showTour=function(t){$target=e(this),$tourBox=e('<div class="user-tour">				<span class="user-tour-title">This is title</span>				<div class="user-tour-pointer"></div>				<div class="user-tour-pointer animation"></div>			</div>').appendTo("body"),$tourPointer=$tourBox.children(".user-tour-pointer");var n={},r={};targetOffset=$target.offset(),targetWidth=$target.innerWidth(),targetHeight=$target.innerHeight(),tourWidth=$tourBox.width(),tourHeight=$tourBox.height(),targetOffset.left+targetWidth+tourWidth-document.documentElement.scrollLeft>window.innerWidth?(n.left=targetOffset.left-tourWidth-15,r["margin-left"]=tourWidth+5):(n.left=targetOffset.left+targetWidth+15,r["margin-left"]=-15),n.top=targetOffset.top-(tourHeight-targetHeight)/2,r["margin-top"]=tourHeight/2-5,$tourPointer.css(r),$tourBox.css(n).show()}}),define("jqpagination",["jquery"],function(e){e.jqPagination=function(t,n){var r=this;r.$el=e(t),r.el=t,r.$input=r.$el.find("input"),r.$el.data("jqPagination",r),r.init=function(){r.options=e.extend({},e.jqPagination.defaultOptions,n),r.options.max_page===null&&(r.$input.data("max-page")!==undefined?r.options.max_page=r.$input.data("max-page"):r.options.max_page=1),r.$input.data("current-page")!==undefined&&r.isNumber(r.$input.data("current-page"))&&(r.options.current_page=r.$input.data("current-page")),r.$input.removeAttr("readonly"),r.updateInput(!0),r.$input.on("focus.jqPagination mouseup.jqPagination",function(t){if(t.type==="focus"){var n=parseInt(r.options.current_page,10);e(this).val(n).select()}if(t.type==="mouseup")return!1}),r.$input.on("blur.jqPagination keydown.jqPagination",function(t){var n=e(this),i=parseInt(r.options.current_page,10);t.keyCode===27&&(n.val(i),n.blur()),t.keyCode===13&&n.blur(),t.type==="blur"&&r.setPage(n.val())}),r.$el.on("click.jqPagination","a",function(t){var n=e(this);if(n.hasClass("disabled"))return!1;!t.metaKey&&!t.ctrlKey&&(t.preventDefault(),r.setPage(n.data("action")))})},r.setPage=function(e,t){if(e===undefined)return r.options.current_page;var n=parseInt(r.options.current_page,10),i=parseInt(r.options.max_page,10);if(isNaN(parseInt(e,10)))switch(e){case"first":e=1;break;case"prev":case"previous":e=n-1;break;case"next":e=n+1;break;case"last":e=i}e=parseInt(e,10);if(isNaN(e)||e<1||e>i)return r.setInputValue(n),!1;r.options.current_page=e,r.$input.data("current-page",e),r.updateInput(t)},r.setMaxPage=function(e,t){if(e===undefined)return r.options.max_page;if(!r.isNumber(e))return console.error("jqPagination: max_page is not a number"),!1;if(e<r.options.current_page)return console.error("jqPagination: max_page lower than current_page"),!1;r.options.max_page=e,r.$input.data("max-page",e),r.updateInput(t)},r.updateInput=function(e){var t=parseInt(r.options.current_page,10);r.setInputValue(t),r.setLinks(t),e!==!0&&r.options.paged(t)},r.setInputValue=function(e){var t=r.options.page_string,n=r.options.max_page;t=t.replace("{current_page}",e).replace("{max_page}",n),r.$input.val(t)},r.isNumber=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},r.setLinks=function(e){var t=r.options.link_string,n=parseInt(r.options.current_page,10),i=parseInt(r.options.max_page,10);if(t!==""){var s=n-1;s<1&&(s=1);var o=n+1;o>i&&(o=i),r.$el.find("a.first").attr("href",t.replace("{page_number}","1")),r.$el.find("a.prev, a.previous").attr("href",t.replace("{page_number}",s)),r.$el.find("a.next").attr("href",t.replace("{page_number}",o)),r.$el.find("a.last").attr("href",t.replace("{page_number}",i))}r.$el.find("a").removeClass("disabled"),n===i&&r.$el.find(".next, .last").addClass("disabled"),n===1&&r.$el.find(".previous, .first").addClass("disabled")},r.callMethod=function(t,n,i){switch(t.toLowerCase()){case"option":var s={trigger:!0},o=!1;e.isPlainObject(n)&&!i?e.extend(s,n):s[n]=i;var u=s.trigger===!1;return s.max_page!==undefined&&(o=r.setMaxPage(s.max_page,u)),s.current_page!==undefined&&(o=r.setPage(s.current_page,u)),o===!1&&console.error("jqPagination: cannot get / set option "+n),o;case"destroy":r.$el.off(".jqPagination").find("*").off(".jqPagination");break;default:return console.error('jqPagination: method "'+t+'" does not exist'),!1}},r.init()},e.jqPagination.defaultOptions={current_page:1,link_string:"",max_page:null,page_string:"Page {current_page} of {max_page}",paged:function(){}},e.fn.jqPagination=function(){var t=this,n=Array.prototype.slice.call(arguments),r=!1;if(typeof n[0]=="string")return e.each(t,function(){var t=e(this).data("jqPagination");r=t.callMethod(n[0],n[1],n[2])}),r;t.each(function(){new e.jqPagination(this,n[0])})}}),define("jquerysort",["jquery"],function(e){e.browser=e.support,e.fn.dragsort=function(t){if(t=="destroy"){e(this.selector).trigger("dragsort-uninit");return}var n=e.extend({},e.fn.dragsort.defaults,t),r=[],i=null,s=null;return this.each(function(t,o){e(o).is("table")&&e(o).children().size()==1&&e(o).children().is("tbody")&&(o=e(o).children().get(0));var u={draggedItem:null,placeHolderItem:null,pos:null,offset:null,offsetLimit:null,scroll:null,container:o,init:function(){var r=e(this.container).children().size()==0?"li":e(this.container).children(":first").get(0).tagName.toLowerCase();n.itemSelector==""&&(n.itemSelector=r),n.dragSelector==""&&(n.dragSelector=r),n.placeHolderTemplate==""&&(n.placeHolderTemplate="<"+r+">&nbsp;</"+r+">"),e(this.container).attr("data-listidx",t).mousedown(this.grabItem).bind("dragsort-uninit",this.uninit),this.styleDragHandlers(!0)},uninit:function(){var t=r[e(this).attr("data-listidx")];e(t.container).unbind("mousedown",t.grabItem).unbind("dragsort-uninit"),t.styleDragHandlers(!1)},getItems:function(){return e(this.container).children(n.itemSelector)},styleDragHandlers:function(t){this.getItems().map(function(){return e(this).is(n.dragSelector)?this:e(this).find(n.dragSelector).get()})},grabItem:function(t){if(t.which!=1||e(t.target).is(n.dragSelectorExclude)||e(t.target).closest(n.dragSelectorExclude).size()>0||e(t.target).closest(n.itemSelector).size()==0)return;t.preventDefault();var i=t.target;while(!e(i).is(n.dragSelector)){if(i==this)return;i=i.parentNode}e(i).attr("data-cursor",e(i).css("cursor")),e(i).css("cursor","move");var s=r[e(this).attr("data-listidx")],o=this,u=function(){s.dragStart.call(o,t),e(s.container).unbind("mousemove",u)};e(s.container).mousemove(u).mouseup(function(){e(s.container).unbind("mousemove",u),e(i).css("cursor",e(i).attr("data-cursor"))})},dragStart:function(t){i!=null&&i.draggedItem!=null&&i.dropItem(),i=r[e(this).attr("data-listidx")],i.draggedItem=e(t.target).closest(n.itemSelector),n.dragStart.apply(i.draggedItem),i.oldIndex=e(i.draggedItem).index(),i.draggedItem.attr("data-origpos",e(this).attr("data-listidx")+"-"+i.getItems().index(i.draggedItem));var s=parseInt(i.draggedItem.css("marginTop")),o=parseInt(i.draggedItem.css("marginLeft"));i.offset=i.draggedItem.offset(),i.offset.top=t.pageY-i.offset.top+(isNaN(s)?0:s)-1,i.offset.left=t.pageX-i.offset.left+(isNaN(o)?0:o)-1;if(!n.dragBetween){var u=e(i.container).outerHeight()==0?Math.max(1,Math.round(.5+i.getItems().size()*i.draggedItem.outerWidth()/e(i.container).outerWidth()))*i.draggedItem.outerHeight():e(i.container).outerHeight();i.offsetLimit=e(i.container).offset(),i.offsetLimit.right=i.offsetLimit.left+e(i.container).outerWidth()-i.draggedItem.outerWidth(),i.offsetLimit.bottom=i.offsetLimit.top+u-i.draggedItem.outerHeight()}var a=i.draggedItem.height(),f=i.draggedItem.width();n.itemSelector=="tr"?(i.draggedItem.children().each(function(){e(this).width(e(this).width())}),i.placeHolderItem=i.draggedItem.clone().attr("data-placeholder",!0),i.draggedItem.after(i.placeHolderItem),i.placeHolderItem.children().each(function(){e(this).css({borderWidth:0,width:e(this).width()+1,height:e(this).height()+1}).html("&nbsp;")})):(i.draggedItem.after(n.placeHolderTemplate),i.placeHolderItem=i.draggedItem.next().css({height:a,width:f}).attr("data-placeholder",!0));if(n.itemSelector=="td"){var l=i.draggedItem.closest("table").get(0);e("<table id='"+l.id+"' style='border-width: 0px;' class='dragSortItem "+l.className+"'><tr></tr></table>").appendTo("body").children().append(i.draggedItem)}var c=i.draggedItem.attr("style");i.draggedItem.attr("data-origstyle",c?c:""),i.draggedItem.css({position:"absolute",opacity:.8,"z-index":999,height:a,width:f}),i.scroll={moveX:0,moveY:0,maxX:e(document).width()-e(window).width(),maxY:e(document).height()-e(window).height()},i.scroll.scrollY=window.setInterval(function(){if(n.scrollContainer!=window){e(n.scrollContainer).scrollTop(e(n.scrollContainer).scrollTop()+i.scroll.moveY);return}var t=e(n.scrollContainer).scrollTop();if(i.scroll.moveY>0&&t<i.scroll.maxY||i.scroll.moveY<0&&t>0)e(n.scrollContainer).scrollTop(t+i.scroll.moveY),i.draggedItem.css("top",i.draggedItem.offset().top+i.scroll.moveY+1)},10),i.scroll.scrollX=window.setInterval(function(){if(n.scrollContainer!=window){e(n.scrollContainer).scrollLeft(e(n.scrollContainer).scrollLeft()+i.scroll.moveX);return}var t=e(n.scrollContainer).scrollLeft();if(i.scroll.moveX>0&&t<i.scroll.maxX||i.scroll.moveX<0&&t>0)e(n.scrollContainer).scrollLeft(t+i.scroll.moveX),i.draggedItem.css("left",i.draggedItem.offset().left+i.scroll.moveX+1)},10),e(r).each(function(e,t){t.createDropTargets(),t.buildPositionTable()}),i.setPos(t.pageX,t.pageY),e(document).bind("mousemove",i.swapItems),e(document).bind("mouseup",i.dropItem),n.scrollContainer!=window&&e(window).bind("DOMMouseScroll mousewheel",i.wheel)},setPos:function(t,r){var s=r-this.offset.top,o=t-this.offset.left;n.dragBetween||(s=Math.min(this.offsetLimit.bottom,Math.max(s,this.offsetLimit.top)),o=Math.min(this.offsetLimit.right,Math.max(o,this.offsetLimit.left))),this.draggedItem.parents().each(function(){if(e(this).css("position")!="static"&&(!e.browser.mozilla||e(this).css("display")!="table")){var t=e(this).offset();return s-=t.top,o-=t.left,!1}});if(n.scrollContainer==window)r-=e(window).scrollTop(),t-=e(window).scrollLeft(),r=Math.max(0,r-e(window).height()+5)+Math.min(0,r-5),t=Math.max(0,t-e(window).width()+5)+Math.min(0,t-5);else{var u=e(n.scrollContainer),a=u.offset();r=Math.max(0,r-u.height()-a.top)+Math.min(0,r-a.top),t=Math.max(0,t-u.width()-a.left)+Math.min(0,t-a.left)}i.scroll.moveX=t==0?0:t*n.scrollSpeed/Math.abs(t),i.scroll.moveY=r==0?0:r*n.scrollSpeed/Math.abs(r),this.draggedItem.css({top:s+e(this.container).scrollTop()})},wheel:function(t){if((e.browser.safari||e.browser.mozilla)&&i&&n.scrollContainer!=window){var r=e(n.scrollContainer),s=r.offset();if(t.pageX>s.left&&t.pageX<s.left+r.width()&&t.pageY>s.top&&t.pageY<s.top+r.height()){var o=t.detail?t.detail*5:t.wheelDelta/-2;r.scrollTop(r.scrollTop()+o),t.preventDefault()}}},buildPositionTable:function(){var t=[];this.getItems().not([i.draggedItem[0],i.placeHolderItem[0]]).each(function(n){var r=e(this).offset();r.right=r.left+e(this).outerWidth(),r.bottom=r.top+e(this).outerHeight(),r.elm=this,t[n]=r}),this.pos=t},dropItem:function(){if(i.draggedItem==null)return;var t=i.draggedItem.attr("data-origstyle");return i.draggedItem.attr("style",t),t==""&&i.draggedItem.removeAttr("style"),i.draggedItem.removeAttr("data-origstyle"),i.styleDragHandlers(!0),i.placeHolderItem.before(i.draggedItem),i.placeHolderItem.remove(),e("[data-droptarget], .dragSortItem").remove(),window.clearInterval(i.scroll.scrollY),window.clearInterval(i.scroll.scrollX),i.draggedItem.attr("data-origpos")!=e(r).index(i)+"-"+i.getItems().index(i.draggedItem)&&n.dragEnd(i.draggedItem,i.oldIndex),i.draggedItem.removeAttr("data-origpos"),i.draggedItem=null,e(document).unbind("mousemove",i.swapItems),e(document).unbind("mouseup",i.dropItem),n.scrollContainer!=window&&e(window).unbind("DOMMouseScroll mousewheel",i.wheel),!1},swapItems:function(t){if(i.draggedItem==null)return!1;i.setPos(t.pageX,t.pageY);var o=i.findPos(t.pageX,t.pageY),u=i;for(var a=0;o==-1&&n.dragBetween&&a<r.length;a++)o=r[a].findPos(t.pageX,t.pageY),u=r[a];if(o==-1)return!1;var f=function(){return e(u.container).children().not(u.draggedItem)},l=f().not(n.itemSelector).each(function(e){this.idx=f().index(this)});return s==null||s.top>i.draggedItem.offset().top||s.left>i.draggedItem.offset().left?e(u.pos[o].elm).before(i.placeHolderItem):e(u.pos[o].elm).after(i.placeHolderItem),l.each(function(){var t=f().eq(this.idx).get(0);this!=t&&f().index(this)<this.idx?e(this).insertAfter(t):this!=t&&e(this).insertBefore(t)}),e(r).each(function(e,t){t.createDropTargets(),t.buildPositionTable()}),s=i.draggedItem.offset(),!1},findPos:function(e,t){for(var n=0;n<this.pos.length;n++)if(this.pos[n].left<e&&this.pos[n].right>e&&this.pos[n].top<t&&this.pos[n].bottom>t)return n;return-1},createDropTargets:function(){if(!n.dragBetween)return;e(r).each(function(){var t=e(this.container).find("[data-placeholder]"),r=e(this.container).find("[data-droptarget]");t.size()>0&&r.size()>0?r.remove():t.size()==0&&r.size()==0&&(n.itemSelector=="td"?e(n.placeHolderTemplate).attr("data-droptarget",!0).appendTo(this.container):e(this.container).append(i.placeHolderItem.removeAttr("data-placeholder").clone().attr("data-droptarget",!0)),i.placeHolderItem.attr("data-placeholder",!0))})}};u.init(),r.push(u)}),this},e.fn.dragsort.defaults={itemSelector:"",dragSelector:"",dragSelectorExclude:"input, textarea, .editable-area",dragEnd:function(){},dragStart:function(){},dragBetween:!1,placeHolderTemplate:"",scrollContainer:window,scrollSpeed:5}}),define("ui/ui",function(){});